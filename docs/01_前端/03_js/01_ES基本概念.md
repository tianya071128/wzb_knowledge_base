# ES 基础概念

## JavaScript 实现

虽然 JavaScript 和 ECMAScript 基本上是同义词，完整的 JavaScript 实现包含以下几个部分

- 核心（ECMAScript）：即 ECMA-262 定义的语言
- 文档对象模型（DOM）
- 浏览器对象模型（BOM）

## ECMAScript

ECMAScript，即 ECMA-262 定义的语言，并不局限于 Web 浏览器。Web 浏览器只是 ECMAScript 实现可能存在的一种宿主环境（host environment）。

::: warning 重要概念

事实上这门语言没有输入和输出，**ES 的语法更多是操作数据结构，并不能直接访问 I/O，以及不能输出内容**。

将这门语言作为一个基准来定义，可以在它之上构建更稳健的脚本语言。

在浏览器宿主环境中，通过 DOM 和 BOM 来提供浏览器环境下的功能。

在 Node 环境中，通过 Node 提供的核心模块访问系统 I/O。

:::

不涉及宿主环境（例如浏览器），在基本的层面上，ES 包括以下部分：

- 语法
- 类型
- 语句
- 关键字
- 保留字
- 运算符
- 全局对象

### 1. ES 版本

js 诞生于 1995 年，ECMA-262 的第 1 版本质上跟网景的 JavaScript 1.1 相同，只不过删除了所有浏览器特定的代码，外加少量细微的修改。

ECMA-262 第 2 版只是做了一些编校工作，主要是为了更新之后严格符合 ISO/IEC-16262 的要求，并没有增减或改变任何特性。

ECMA-262 第 3 版第一次真正对这个标准进行更新，更新了字符串处理、错误定义和数值输出。

ECMA-262 第 4 版是对这门语言的一次彻底修订。但是因为过于激进，ECMA-262 第 4 版在正式发布之前被放弃。

ECMAScript 3.1 变成了 ECMA-262 的第 5 版，于 2009 年 12 月 3 日正式发布。第 5 版致力于厘清第 3 版存在的歧义，也增加了新功能。

ECMA-262 第 6 版，俗称 ES6、ES2015 或 ES Harmony（和谐版），于 2015 年 6 月发布。这一版包含了大概这个规范有史以来最重要的一批增强特性。

后续每年发一次版本，对语言进行轻量的更新。

### 2. ES 符合性？

要成为 ECMAScript 实现，必须满足下列条件：

- 支持 ECMA-262 中描述的所有“类型、值、对象、属性、函数，以及程序语法与语义”；

- 支持 Unicode 字符标准。

此外，符合性实现还可以满足下列要求。

- 增加 ECMA-262 中未提及的“额外的类型、值、对象、属性和函数”。ECMA-262 所说的这些额外内容主要指规范中未给出的新对象或对象的新属性。
- 支持 ECMA-262 中没有定义的“程序和正则表达式语法”（意思是允许修改和扩展内置的正则表达式特性）。

**也就是说，要在 ES 语言基础上开发其他语言，需要满足上述条件**

### 3. ES 兼容性

ES 的实现因为有其标准遵循，所以浏览器对其实现最为规范。

但因为客户的浏览器版本不一致，所以我们在 ES 层面的兼容性主要是对于 ES 版本方面的兼容性。

一般而言，使用 babel 之类的语法编译器可以实现 ES 语法的兼容处理，还需要添加 polyfill 对于语法环境的模拟。

**但是有些语法是无法 polyfill 的，例如 vue 使用的 Object.defineProperty 语法。此时在低版本浏览器中是无法兼容的，例如 vue 不兼容 IE9-**

## ES 语法

::: warning 《你不知道的 JavaScript-中》p92

相比“词法”（syntax），“语法”一词对读者来说可能更陌生一些。很多时候二者是同一个意思，都是语言规则的定义。虽然它们之间有一些微小的差别，但我们这里可以忽略不计。JavaScript 语法定义了词法规则（syntax rule，如运算符和关键词等）是如何构成可运行的程序代码的。换句话说，只看词法不看语法会遗漏掉很多重要的细节。所以准确地说，本章介绍的是语法，虽然和开发人员直接打交道的是词法。

:::

### ES 是动态、弱类型语言

编程语言的两组划分：弱类型和强类型，动态类型和静态类型。如下图定义：

- 动态类型和静态类型：
  - 静态语言：使用之前就需要确认其变量数据类型
  - 动态语言：在运行过程中需要检查数据类型的语言
- 弱类型和强类型：
  - 弱类型：支持隐式类型转换的语言
  - 强类型：不支持隐式类型转换的语言

![img](/img/22.png)

### 语句和表达式

语句和表达式在 ES 中并不能混为一谈，他们有着一些重要差别

::: warning 《你不知道的 JavaScript-中》p93

“句子”（sentence）是完整表达某个意思的一组词，由一个或多个“短语”（phrase）组成，它们之间由标点符号或连接词（and 和 or 等）连接起来。短语可以由更小的短语组成。有些短语是不完整的，不能独立表达意思；有些短语则相对完整，并且能够独立表达某个意思。这些规则就是英语的语法。

JavaScript 的语法也是如此。**语句相当于句子，表达式相当于短语，运算符则相当于标点符号和连接词。**

:::

#### 语句的结果值

语句也是有结果值的，在浏览器的控制台就会返回。

在代码中，无法直接获取，但可以通过 `eval` 间接获取（禁止如此操作）

```js
// 这样会报错
var a, b;
a = if (true) {
	b = 4 + 38;
};

// 使用 eval
var a, b;
a = eval( "if (true) { b = 4 + 38; }" );
a; // 42
```

#### 表达式的结果值

表达式会产生一个结果值。

### 严格模式

ES5 新增的严格模式，是一种不同的 JS 解析和执行模型，对于不安全的活动将抛出错误。

- 全局严格模式：在脚本开头添加 `"use strict"`;

- 局部严格模式：在函数体开头添加 `"use strict"`;

  ```js
  function doSomething() {
    'use strict';
    // 函数体
  }
  ```

### 基础概念：标识符、关键字、保留字

- 标识符：就是变量、函数、属性或函数参数的名称。

  ::: warning 注意

  关键字、保留字、true、false 和 null 不能作为标识符。

  :::

- 关键字：这些关键字有特殊用途，比如表示控制语句的开始和结束，或者执行特定的操作。

- 保留字：未来可能会有特殊用途。

### 变量

在应用程序中，使用变量来作为值的符号名。变量的名称又叫做标识符。

声明变量的方式：

- var
- let
- const

### 运算符(也称操作符)

运算符优先级列表：[MDN-运算符优先级](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence)

运算符：可用于操作数据值，可用于各种值，**在应用在对象时，运算符通常会调用 valueOf() 和/或 toString()**

- 一元运算符：递增(++)、递减(--)、一元加(+)、一元减(-)

  - 递增和递减有前缀和后缀之分，前缀递增/递减(a = ++1)变量的值都会在语句被求值之前改变。（在计算机科学中，
    这通常被称为具有副作用。）
  - 一元加(+)：应用到非数值，会执行与使用 Number()转型函数一样的类型转换：
  - 一元减(-)：应用到非数值，会执行与使用 Number()转型函数一样的类型转换，**然后变成负值**：

- 位运算符：按位非(~)、按位与(&)、按位或(|)、按位异或(^)、左移(<<)、有符号右移(>>)、无符号右移(>>>)

- 布尔运算符：逻辑非(!)、逻辑与(&&)、逻辑或(||)

- 乘性运算符：乘法运算符(\*)、除法运算符(/)、取模运算符(%)

- 指数运算符：**ES7 新增**

  - \*\*：作用与 Math.pow() 相同

    ```js
    console.log(Math.pow(3, 2); // 9
    console.log(3 ** 2); // 9
    ```

  - \*\*=：指数赋值运算符

    ```js
    let squared = 3;
    squared **= 2;
    console.log(squared); // 9
    ```

- 加性运算符：加法运算符（+）、减法运算符（-）

- 关系运算符：小于（<）、大于（>）、小于等于（<=）和大于等于（>=）

- 相等运算符：等于运算符（==）、不等于运算符（!=）、全等运算符（===）、不全等运算符（!==）

- 条件运算符(*三目*运算符)：variable = boolean_expression ? true_value : false_value;

- 赋值运算符：简单赋值（=）、复合赋值使用乘性、加性或位运算符后跟等于号（=）表示。

- 逗号运算符：逗号运算符可以用来在一条语句中执行多个操作。例如：let num1 = 1, num2 = 2, num3 = 3;

### 数据类型

ES 将数据类型分为 7 种简单数据类型和 Object 复杂数据类型。

**因为在 ECMAScript 中不能定义自己的数据类型，所有值都可以用上述数据类型表示**

- 简单数据类型：

  Undefined、Null、Boolean、Number、String 和 Symbol（ES6 新增）、BigInt（ES10 新增）

- 复杂数据类型：Object

::: warning 注意

在 ECMAScript 中 Object 是所有对象的基类。例如 Array、Function 等等。

但严格来讲，宿主对象不受 ECMA-262 约束，它们可能会也可能不会继承 Object。

:::

#### 检测数据类型

- 检测基本数据类型使用 typeof -- 检测 null 返回 object（所以不要使用 typeof 检测 null）

  ```js
  typeof 1; // number
  typeof '1'; // string
  ```

- 检测 null 可以直接使用全等操作符 --- 因为 Null 数据类型只有一个值

  ```js
  null === null; // true
  ```

- 检查 undefined 和 null，可以使用不全等操作符（==）

  ```js
  undefined == null; // true
  ```

- 检测函数也可以使用 typeof 操作符

  ```js
  typeof function () {}; // function
  ```

- 检测数组可以使用 Array.isArray() 方法

- 检测复杂数据类型可以借用 Object.prototype.toString.call(检测值)

  ```js
  Object.prototype.toString.call(new Date()).slice(8, -1); // Date
  ```

- 检测是否原生构造函数：Number、String 等

  ```js
  typeof Ctor === 'function' && /native code/.test(Ctor.toString());
  ```

- 检测是否为 promise：因为 promise 可以是 polyfill 的，所以检测是否为对象，并且 .then 和 .catch 为函数

  ```js
  val != undefined &&
    typeof val.then === 'function' &&
    typeof val.catch === 'function';
  ```

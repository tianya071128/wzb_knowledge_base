# git reset

## 作用

- **移动当前分支的 `HEAD` 指针到指定提交**（改变分支指向）。
- **可选**地修改暂存区（`index`）和工作区的文件内容，与目标提交保持一致。

## 概述

```text
git reset [-q] [<tree-ish>] [--] <pathspec>…​
git reset [-q] [--pathspec-from-file=<file> [--pathspec-file-nul]] [<tree-ish>]
git reset (--patch | -p) [<tree-ish>] [--] [<pathspec>…​]
git reset [--soft | --mixed [-N] | --hard | --merge | --keep] [-q] [<commit>]
```

## 描述

`git reset` 是 Git 中用于修改提交历史、调整分支指向的核心命令，主要作用是**重置当前分支的 HEAD 指针**，并可选择修改工作区和暂存区的状态。

* **远程分支影响**：若重置的提交已推送到远程，需用 `git push -f` 强制推送，但会覆盖远程历史，团队协作中需谨慎。

## 模式参数

`git reset` 通过参数支持多种模式：

| <div style="width: 70px">模式</div>      | <div style="width: 100px">回滚内容</div> | 对 HEAD 的影响 | 原有暂存区 | 原有工作区 | 典型场景                               |
| --------- | -------------- | -------------------------- | -------------------------------- | -------------------------------------- | --------- |
| `--soft`  | 存放在暂存区 | 移动 | 不改变（保留原有暂存内容） | 不改变（保留工作区修改）         | 合并多个提交、撤销最近的提交但保留修改 |
| `--mixed`(默认模式) | 存放在工作区 | 移动 | 撤销到工作区 | 不改变（保留工作区修改）         | 撤销 `git add`、取消暂存修改           |
| `--hard`  | 丢弃 | 移动 | 丢弃     | 丢弃 | 彻底回滚到历史版本、丢弃本地所有修改   |
| `--merge` | 丢弃 | 移动 | 丢弃 | 保留未冲突的本地修改 | 拉取代码时处理冲突后重置 |
| `--keep` | 丢弃 | 移动 | 撤销到工作区 | 保留未冲突的本地修改 | 切换到历史版本并保留本地修改 |

## 目标参数（指定重置位置）

目标参数用于指定重置到哪个提交节点，支持多种格式：

| 目标格式        | 说明示例                                                     |
| --------------- | ------------------------------------------------------------ |
| `<commit-id>`   | 具体提交的哈希值（如 `a1b2c3d`），重置到该提交               |
| `HEAD~n`        | 相对于当前 HEAD 的前 n 个提交（如 `HEAD~1` 表示上一个提交，`HEAD~3` 表示前 3 个） |
| `HEAD`          | 当前提交，主要用于修改暂存区（`index`）和工作区的文件内容    |
| `HEAD^`         | 等价于 `HEAD~1`，`^` 可叠加（如 `HEAD^^` 等价于 `HEAD~2`）   |
| `<branch-name>` | 分支名（如 `main`），重置到该分支的当前最新提交              |
| `--` `<file>`   | 仅重置指定文件的暂存区（配合 `--mixed` 模式，如 `git reset HEAD -- file.txt`） |

## 选项

###  `<mode>`:  模式参数

* **作用**：[模式参数](#模式参数)决定了重置时对 **工作区**、**暂存区** 和 **HEAD 指针** 的处理方式，是 `git reset` 最关键的参数

### `<commit>`: 目标参数

* **作用**:  [目标参数](#目标参数-指定重置位置)用于指定重置到哪个提交节点
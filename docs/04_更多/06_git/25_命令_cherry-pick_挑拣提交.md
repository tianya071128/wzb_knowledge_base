# git cherry-pick

## 作用

用于**从一个分支选择性地复制单个或多个提交（commit）到当前分支**的命令。

- 与 `git merge` 的区别：`merge` 会合并目标分支的**所有历史**到当前分支，生成一个合并提交；`cherry-pick` 仅复制**指定的单个 / 多个提交**，不影响分支整体历史。
- 与 `git rebase` 的区别：`rebase` 会将当前分支的所有提交 “移到” 目标分支之上，改写历史；`cherry-pick` 是主动挑选其他分支的提交，当前分支原有历史不变。

## 概述

```bash
git cherry-pick [--edit] [-n] [-m parent-number] [-s] [-x] [--ff]
		  [-S[<键 ID>]] <提交>…
git cherry-pick (--continue | --skip | --abort | --quit)
```

- 执行前需切换到**目标分支**（即要应用提交的分支）。

## 基本原理

`git cherry-pick` 的本质是：**将目标提交（来自其他分支）的代码变更 “复制” 到当前分支，并在当前分支创建一个新的提交（哈希值与原提交不同，但变更内容相同）**。原提交仍保留在源分支中，不会被修改或删除。

```text
识别目标提交 → 2. 计算差异 → 3. 应用补丁 → 4. 解决冲突 → 5. 创建新提交
```

1. **步骤1：提交分析**

   ```bash
   # Git 分析目标提交的元数据
   git cat-file -p <target-commit>
   # 获取：
   # - tree:     文件树哈希
   # - parent:   父提交哈希
   # - author:   作者信息
   # - committer:提交者信息
   # - message:  提交信息
   ```

2. **步骤2：差异提取**

   ```bash
   # 提取目标提交引入的更改
   git diff-tree -p <parent-commit> <target-commit>
   # 这会生成一个补丁，包含所有文件更改
   ```

3. **步骤3：补丁应用**

   ```bash
   # 将补丁应用到当前工作树
   git apply --3way --index <patch-file>
   # --3way: 使用三向合并
   # --index: 同时更新暂存区
   ```

4. **步骤4：提交创建**

   ```bash
   # 创建新提交，重用原提交信息
   git commit -C <target-commit>
   # -C: 重用指定提交的提交信息
   ```

## 选项

### 基础操作参数（指定提交范围与方式）

#### `<提交>…`: 提交哈希 / 范围

- **作用**: 直接指定需要挑选的提交（单个、多个或范围），是 `cherry-pick` 最基础的用法。

- **单个提交**：`git cherry-pick <提交哈希>`

- **多个提交**：`git cherry-pick <提交1> <提交2> ...`

- **提交范围**：`git cherry-pick <开始>..<结束>`（左开右闭，不含开始）或 `git cherry-pick <开始>^..<结束>`（含开始）

#### `-n, --no-commit`：应用变更但不自动提交

- **作用**: 默认情况下，`cherry-pick` 会在应用完提交后自动创建新提交。`--no-commit` 仅将变更应用到工作区和暂存区，需手动 `git commit` 提交，适合需要修改后再提交的场景。

### 冲突处理参数（解决挑选过程中的冲突）

当挑选的提交与当前分支存在冲突（如修改同一行代码），`cherry-pick` 会暂停并提示冲突文件，以下参数用于控制后续操作：

#### `--continue`：解决冲突后继续挑选

- **作用**: 冲突解决后（编辑文件并 `git add` 冲突文件），用 `--continue` 完成当前提交的挑选，并继续处理后续提交（若挑选多个提交）。

  ```bash
  # 挑选时遇到冲突，编辑冲突文件后
  git add <冲突文件>
  git cherry-pick --continue  # 完成当前提交，继续下一个（若有）
  ```


#### `--abort`：放弃当前挑选，恢复到操作前状态

- **作用**: 当冲突难以解决，或想终止本次 `cherry-pick` 操作，`--abort` 会撤销已做的修改，将分支恢复到挑选前的状态。

  ```bash
  git cherry-pick a1b2c3d  # 遇到冲突
  git cherry-pick --abort  # 放弃操作，回到原样
  ```

#### `--skip`：跳过当前冲突的提交，继续处理后续提交

* **作用**: 若当前提交的冲突无需解决（或暂时跳过），`--skip` 会忽略当前提交，继续处理后续挑选的提交（谨慎使用，可能导致功能不完整）。

  ```bash
  git cherry-pick a1b2c3d d4e5f6g  # 挑选两个提交，第一个冲突
  git cherry-pick --skip  # 跳过 a1b2c3d，继续处理 d4e5f6g
  ```

### 提交信息控制参数（调整新提交的信息）

#### `-e, --edit`：应用后编辑提交信息

* **作用**: 默认情况下，`cherry-pick` 会复用原提交的信息（作者、说明等）。`-e` 会在应用后自动打开编辑器，允许修改提交信息（如补充来源分支、调整描述）。

#### `-x`：在提交信息中注明来源

* **作用**: 自动在新提交的信息末尾添加 `(cherry picked from commit <原提交哈希>)`，明确标记该提交是从哪个原提交挑选而来，便于团队协作时追踪来源。
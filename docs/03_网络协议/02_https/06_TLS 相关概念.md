# TLS 相关概念

记录一些 `TLS` 相关概念

## 前向加密(前向保密性)

**即使长期私钥（如服务器证书的 RSA 私钥）未来泄露，过去已完成的 TLS 会话加密数据也无法被解密**。因为每个会话的加密密钥是临时、独立生成的，与长期私钥无直接关联。

### 非前向安全算法(如 RSA 密钥交换)

RSA 密钥交换（TLS 早期常用，现因缺乏前向安全逐渐被淘汰 ）：

- **RSA 密钥交换逻辑**：客户端生成预主密钥（Pre-Master Secret），用服务器证书的 RSA 公钥加密后发送给服务器，服务器用长期 RSA 私钥解密。
- **风险**：若服务器的长期 RSA 私钥泄露，攻击者可解密**所有历史会话**的预主密钥，进而破解加密数据。

### ECDH 支持前向加密的核心原理

1. **临时密钥对的生成**

   在 ECDH 密钥交换中：

   - **服务器和客户端**会在**每次 TLS 握手时**，动态生成**临时的椭圆曲线密钥对**（公钥 + 私钥 ）。
   - 这些临时密钥对**仅用于本次会话**，会话结束后即销毁，不重复使用。

2. **共享密钥的推导逻辑**

   ECDH 通过 “椭圆曲线离散对数问题”（ECDLP）实现密钥协商：

   1. 客户端生成临时私钥 `d_C` 和对应公钥 `Q_C = d_C * G`（`G` 是椭圆曲线基点 ），并将 `Q_C` 发送给服务器。
   2. 服务器生成临时私钥 `d_S` 和对应公钥 `Q_S = d_S * G`，并将 `Q_S` 发送给客户端。
   3. 客户端计算共享密钥：`K = d_C * Q_S = d_C * (d_S * G)`
   4. 服务器计算共享密钥：`K = d_S * Q_C = d_S * (d_C * G)`
   5. 双方通过上述计算得到**相同的共享密钥 `K`**，用于后续会话加密。

3. **与长期私钥的解耦**

   - ECDH 的**临时私钥**（`d_C`、`d_S` ）是**随机生成的一次性密钥**，与服务器 / 客户端的**长期私钥**（如证书中的 RSA 私钥 ）**完全无关**。
   - 即使服务器的长期私钥（用于证书签名）未来被破解，攻击者也无法通过它推导出过去会话中 ECDH 生成的临时共享密钥 `K`，因为临时私钥是随机且无关联的。

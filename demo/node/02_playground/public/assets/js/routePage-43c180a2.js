import{d as S,r as u,bX as Ve,c as X,y as Z,z as we,d5 as ke,o as i,b as y,w as l,i as e,p as ne,B as k,c1 as xe,iK as Ce,k as M,f as B,e as ae,eA as Pe,aS as se,t as de,dQ as Ue,eu as Ae,a4 as Ee,m as N,lw as G,P as Re,Q as te,c3 as Ie,aU as pe,eB as Te,U as oe,ba as Fe,ca as Me,_ as j,v as Q,C as J,cR as Le,cS as ze,q as Be,ac as me,a5 as Ne,bC as $e,bK as De,pT as Se,bu as qe,d9 as ce,eI as ue,H as Ke,mP as We,F as le,g as Oe,l as K,bv as ve,pU as O,aN as H,av as je,E as Ge,ab as He,bm as Qe,j as Xe,bi as Je,iC as Ye,dN as ee,aa as Ze,pV as ea,pW as aa,cr as la,bn as ta,b4 as ie,pX as oa,iD as na}from"./index-b80d5ef5.js";import{_ as sa}from"./batch-53af5de6.js";import{_ as ua}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import{A as ia}from"./AzConfirmSwitch-689fcef9.js";import{A as ra}from"./EditAuthInfo-e7e23191.js";import{F as da}from"./ParamSettingFormTable-3b7d2b84.js";import pa from"./routePage-2805a8b4.js";import"./AzPasswordFormItem-db212711.js";import"./el-input-number-c15b1cc7.js";import"./processModel-1437813e.js";import"./defaultValue-7c7c87ea.js";import"./CodeBlockEdit-23586d14.js";const ma=S({__name:"PluginTypeManager",props:{modelValue:{}},emits:["update:modelValue"],setup(T,{emit:f}){const _=T,R=f,r=u(),d=u(!1),m=u(!1),v=()=>{d.value||(d.value=!0)},b=()=>{d.value=!1},{width:x}=Ve(r),C=u(""),a=u(!1),I=u(),P=u(),E=async p=>{try{m.value=!0;const c=await G.list({name:p||""});I.value=c,a.value=!0,m.value=!1,p||(P.value=c)}catch{m.value=!1}},L=u(),h=u(),t=p=>{p.edit=!0},V=async p=>{try{m.value=!0,await G.edit(p),p.edit=!1,_.modelValue&&(w.value=z()),E(),m.value=!1}catch{m.value=!1}},U=u(!1),$=async()=>{if(C.value.trim())try{U.value=!0,await G.add({name:C.value}),C.value="",await E(),U.value=!1,L.value.targetDomElement.scrollTop=0}catch{U.value=!1}},n=async p=>{try{m.value=!0,await G.del(p),E(),m.value=!1}catch{m.value=!1}},s=u(""),w=u(""),q=p=>{R("update:modelValue",p.id),b()},o=()=>{s.value="",w.value="",R("update:modelValue",""),setTimeout(()=>{r.value.blur()})},A=X(()=>_.modelValue?w.value:"请选择插件类型"),z=p=>{var c;return _.modelValue?(c=P.value.find(D=>D.id==(p||_.modelValue)))==null?void 0:c.name:""},F=X(()=>p=>{const c=document.createElement("span");c.style.display="inline-block",c.textContent=p,document.body.appendChild(c);const D=c.clientWidth;return document.body.removeChild(c),D<x.value-114});return Z(()=>_.modelValue,async p=>{p&&(a.value||await E(),s.value=z(p),w.value=s.value)},{immediate:!0}),we(()=>{h.value&&h.value.focus()}),Z(()=>d.value,p=>{p?(a.value||E(),s.value=""):(s.value=z(),setTimeout(()=>{r.value.blur()}))}),Z(()=>s.value,ke(p=>{d.value&&E(p)},300)),(p,c)=>{const D=Re,Y=te,fe=Ie,_e=pe,ge=Te,ye=oe,be=Fe,he=Me;return i(),y(be,{placement:"bottom",trigger:"contextmenu",title:"",width:k(x),visible:d.value,"onUpdate:visible":c[2]||(c[2]=g=>d.value=g),content:""},{reference:l(()=>[e(Y,{placeholder:A.value,onClick:v,ref_key:"inputRef",ref:r,modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=g=>s.value=g),class:"refer-input"},{suffix:l(()=>[e(D,{class:ne(["arrow",{roll:d.value}])},{default:l(()=>[e(k(xe))]),_:1},8,["class"]),e(D,{class:"close",onClick:o},{default:l(()=>[e(k(Ce))]),_:1})]),_:1},8,["placeholder","modelValue"])]),default:l(()=>[M("div",{class:"custom-content"},[a.value&&!I.value.length?(i(),B("div",{key:0,class:"empty-box"},[e(fe,{description:"暂无数据","image-size":50})])):ae((i(),y(k(Pe),{key:1,tag:"ul",ref_key:"draggableRef",ref:L,class:"options-wrap",list:I.value,handle:".move",animation:"300",itemKey:"id"},{item:l(({element:g})=>[M("li",{class:ne({selected:g.id==p.modelValue})},[g.edit?(i(),y(Y,{key:0,modelValue:g.name,"onUpdate:modelValue":W=>g.name=W,placeholder:"请输入类型名称",ref_key:"editRef",ref:h,maxlength:20,"show-word-limit":"",onBlur:W=>V(g),onKeydown:se(W=>V(g),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeydown"])):(i(),B("div",{key:1,class:"option-left",ref:"textWrapRef",onClick:W=>q(g)},[e(_e,{class:"box-item",effect:"dark",content:g.name,disabled:F.value(g.name),placement:"top"},{default:l(()=>[M("span",{ref:"textSpanRef"},de(g.name),513)]),_:2},1032,["content","disabled"])],8,["onClick"])),M("div",{class:"option-right"},[e(D,{class:"move"},{default:l(()=>[e(k(Ue))]),_:1}),e(D,{class:"edit",onClick:W=>t(g)},{default:l(()=>[e(k(Ae))]),_:2},1032,["onClick"]),e(ge,{onConfirm:W=>n(g.id),title:"删除后不可恢复。确定要删除？",width:"auto",teleported:!1},{reference:l(()=>[e(D,{class:"del"},{default:l(()=>[e(k(Ee))]),_:1})]),_:2},1032,["onConfirm"])])],2)]),_:1},8,["list"])),[[he,m.value]]),M("div",{class:"opts"},[e(Y,{class:"mr-5",placeholder:"请输入类型名称",clearable:!0,modelValue:C.value,"onUpdate:modelValue":c[1]||(c[1]=g=>C.value=g),onKeydown:se($,["enter"]),maxlength:20,"show-word-limit":""},null,8,["modelValue","onKeydown"]),e(ye,{type:"primary",onClick:$,loading:U.value},{default:l(()=>[N(" 新增 ")]),_:1},8,["loading"])])])]),_:1},8,["width","visible"])}}});const ca=j(ma,[["__scopeId","data-v-bebd9eda"]]),va=S({__name:"Input",props:{modelValue:{},isCheck:{type:Boolean}},emits:["update:modelValue","update:isCheck"],setup(T,{emit:f}){const _=T,R=f,r=Q(_,"modelValue",R),d=Q(_,"isCheck",R);return(m,v)=>{const b=te,x=Be,C=me;return i(),y(C,Le(ze(m.$attrs)),{default:l(()=>[M("div",{class:"input-box"},[e(b,{modelValue:k(r),"onUpdate:modelValue":v[0]||(v[0]=a=>J(r)?r.value=a:null),placeholder:"请输入",type:k(d)?"password":"text"},null,8,["modelValue","type"]),e(x,{modelValue:k(d),"onUpdate:modelValue":v[1]||(v[1]=a=>J(d)?d.value=a:null)},{default:l(()=>[N("加密显示")]),_:1},8,["modelValue"])])]),_:1},16)}}});const re=j(va,[["__scopeId","data-v-228e0e8a"]]),fa=S({__name:"CommonParams",props:{modelValue:{}},emits:["update:modelValue"],setup(T,{expose:f,emit:_}){const R=[{type:"input",key:"name",label:"名称",placeholder:"请输入名称",style:{marginRight:"20px",flex:1}},{type:"input",key:"paramName",placeholder:"请输入参数名称",label:"参数名称",style:{marginRight:"20px",flex:1}},{type:"input",key:"defaultValue",placeholder:"请输入参数值",label:"参数值",style:{marginRight:"20px",flex:1}},{type:"delIcon",label:"",key:""}],r=T,m=Q(r,"modelValue",_),v=u(),b=u({name:[{required:!0,message:"请输入名称",trigger:"blur"}],paramName:[{required:!0,message:"请选择参数名称",trigger:"blur"}],defaultValue:[{required:!0,message:"请输入参数值",trigger:"blur"}]}),x=u(r.modelValue.length>=1),C=I=>{const P=I??[];m.value=P,Array.isArray(P)&&P.length<=0&&(x.value=!1)};return f({validate:async()=>{var I;return await((I=v.value)==null?void 0:I.validateForm())}}),(I,P)=>{const E=$e,L=oe;return x.value?(i(),y(E,{key:0,style:{width:"100%"},"body-style":{padding:"10px"}},{default:l(()=>[e(da,{class:"publicForm",ref_key:"formTableRef",ref:v,list:R,rules:b.value,model:k(m),"id-prefix":"public","onUpdate:model":C},null,8,["rules","model"])]),_:1})):(i(),y(L,{key:1,style:{width:"100%"},icon:k(Ne),onClick:P[0]||(P[0]=h=>x.value=!0)},{default:l(()=>[N(" 添加公共参数 ")]),_:1},8,["icon"]))}}});const _a=j(fa,[["__scopeId","data-v-3dc7a486"]]),ga=S({__name:"PluginAdd",props:{id:{},visible:{type:Boolean}},emits:["refresh","update:visible"],setup(T,{expose:f,emit:_}){const R=_,r=T,d=Q(r,"visible",R),m=u(),v=h=>b.value===h,b=X(()=>r.id?"edit":"add"),x=X(()=>v("edit")),C={name:"",iconUrl:"",serviceName:"",remark:"",authMethod:void 0,authUrl:"",basicAuthParam:{userName:"",password:"",nameCryptoFlag:!1,pwdCryptoFlag:!1},apiKeyAuthParamList:[],publicParamLst:[]},a=u({...C}),I=De({name:[{required:!0,message:"请输入插件名称",trigger:"blur"}],authMethod:[{required:!0,message:"请选择鉴权方式",trigger:"change"}],"basicAuthParam.userName":[{required:!0,message:"请输入账号",trigger:"change"}],"basicAuthParam.password":[{required:!0,message:"请输入密码",trigger:"change"}],authUrl:[{pattern:Se,message:"请输入正确的网页地址",trigger:"change"}]}),P=async()=>{if(v("add"))a.value={...C};else{const h=await O.getById(r.id);a.value={...h}}},E=u(),L=async h=>{var t,V;await((t=m.value)==null?void 0:t.validate()),await((V=E.value)==null?void 0:V.validate()),v("add")?(await O.add(a.value),H.success("添加成功")):(await O.update({...a.value,id:r.id}),H.success("修改成功")),h==="submitContinue"&&(a.value={...C}),R("refresh")};return f({close}),(h,t)=>{const V=te,U=me,$=je,n=pe,s=Ge,w=He,q=Qe;return i(),y(ve,{modelValue:k(d),"onUpdate:modelValue":t[14]||(t[14]=o=>J(d)?d.value=o:null),size:"880px",title:b.value==="add"?"添加插件":"编辑插件","show-load":P},{footer:l(()=>[e(qe,{editMode:x.value,onClose:t[13]||(t[13]=o=>d.value=!1),"on-submit":L},null,8,["editMode"])]),default:l(()=>[e(q,{ref_key:"ruleFormRef",ref:m,rules:I,model:a.value,"label-width":"135px","label-position":"right"},{default:l(()=>[e(U,{label:"插件名称",prop:"name"},{default:l(()=>[e(V,{placeholder:"请输入插件名称",modelValue:a.value.name,"onUpdate:modelValue":t[0]||(t[0]=o=>a.value.name=o),"show-word-limit":"",maxlength:20},null,8,["modelValue"])]),_:1}),e(U,{label:"图标"},{default:l(()=>[e(ce,{ref:"AzUploadRef",limit:1,modelValue:a.value.iconUrl,"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.iconUrl=o),type:"img",size:30,accept:["jpg","jpeg","bmp","png"]},null,8,["modelValue"])]),_:1}),e(U,{label:"详细描述"},{default:l(()=>[e(V,{type:"textarea",maxlength:200,autosize:{minRows:3},"show-word-limit":"",placeholder:"请输入描述",modelValue:a.value.remark,"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.remark=o)},null,8,["modelValue"])]),_:1}),e(U,{label:"插件服务商"},{default:l(()=>[e(V,{placeholder:"请输入服务商",modelValue:a.value.serviceName,"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.serviceName=o),"show-word-limit":"",maxlength:50},null,8,["modelValue"])]),_:1}),e(U,{label:"业务类型",prop:"pluginTypeId"},{default:l(()=>[e(ca,{modelValue:a.value.pluginTypeId,"onUpdate:modelValue":t[4]||(t[4]=o=>a.value.pluginTypeId=o)},null,8,["modelValue"])]),_:1}),e(U,null,{label:l(()=>[M("span",null,[N(" 公共参数 "),e(n,{effect:"dark",content:"连接服务商插件的连接参数或公共参数",placement:"top"},{default:l(()=>[e($,{underline:!1,type:"primary",icon:k(ue)},null,8,["icon"])]),_:1})])]),default:l(()=>[e(_a,{ref_key:"commonParamsRef",ref:E,modelValue:a.value.publicParamLst,"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.publicParamLst=o)},null,8,["modelValue"])]),_:1}),e(Ke,{label:"鉴权方式",prop:"authMethod"},{label:l(()=>[M("span",null,[N(" 鉴权方式 "),e(n,{effect:"dark",content:"连接服务商所提供插件的权限认证方式",placement:"top"},{default:l(()=>[e($,{underline:!1,type:"primary",icon:k(ue)},null,8,["icon"])]),_:1})])]),default:l(()=>[e(We,{load:"auth_method"},{default:l(({options:o})=>[e(w,{disabled:x.value,modelValue:a.value.authMethod,"onUpdate:modelValue":t[6]||(t[6]=A=>a.value.authMethod=A)},{default:l(()=>[(i(!0),B(le,null,Oe(o,(A,z)=>(i(),y(s,{key:z,label:Number(A.value)},{default:l(()=>[N(de(A.label),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["disabled","modelValue"])]),_:1})]),_:1}),a.value.authMethod===1?(i(),y(U,{key:0},{default:l(()=>[e(ra,{"param-list":a.value.apiKeyAuthParamList,"onUpdate:paramList":t[7]||(t[7]=o=>a.value.apiKeyAuthParamList=o)},null,8,["param-list"])]),_:1})):K("",!0),a.value.authMethod===2?(i(),B(le,{key:1},[e(re,{prop:"basicAuthParam.userName",modelValue:a.value.basicAuthParam.userName,"onUpdate:modelValue":t[8]||(t[8]=o=>a.value.basicAuthParam.userName=o),"is-check":a.value.basicAuthParam.nameCryptoFlag,"onUpdate:isCheck":t[9]||(t[9]=o=>a.value.basicAuthParam.nameCryptoFlag=o),label:"账号"},null,8,["modelValue","is-check"]),e(re,{prop:"basicAuthParam.password",modelValue:a.value.basicAuthParam.password,"onUpdate:modelValue":t[10]||(t[10]=o=>a.value.basicAuthParam.password=o),"is-check":a.value.basicAuthParam.pwdCryptoFlag,"onUpdate:isCheck":t[11]||(t[11]=o=>a.value.basicAuthParam.pwdCryptoFlag=o),label:"密码"},null,8,["modelValue","is-check"])],64)):K("",!0),a.value.authMethod===1||a.value.authMethod===2?(i(),y(U,{key:2,label:"鉴权信息获取地址",prop:"authUrl"},{default:l(()=>[e(V,{modelValue:a.value.authUrl,"onUpdate:modelValue":t[12]||(t[12]=o=>a.value.authUrl=o),placeholder:"请输入,如http://www.123.com"},null,8,["modelValue"])]),_:1})):K("",!0)]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}});const ya=j(ga,[["__scopeId","data-v-d8bf34ca"]]),ba=S({__name:"PluginInfo",props:{data:{}},setup(T){return(f,_)=>(i(),B("div",{class:"plugin-info"},[f.data.iconUrl?(i(),B("img",{key:0,src:f.data.iconUrl,alt:"logo"},null,8,["src"])):K("",!0),e(Xe,{content:f.data.name,line:2},null,8,["content"])]))}});const ha=j(ba,[["__scopeId","data-v-936b056b"]]),Va=S({__name:"pluginDetail",props:{visible:{type:Boolean},id:{}},emits:["update:visible"],setup(T,{emit:f}){const r=Q(T,"visible",f),d=u(),m=()=>{var v,b;(v=d.value)==null||v.getInfo(),(b=d.value)==null||b.refreshTable()};return(v,b)=>(i(),y(ve,{modelValue:k(r),"onUpdate:modelValue":b[0]||(b[0]=x=>J(r)?r.value=x:null),title:"查看插件","show-load":m,size:"800"},{default:l(()=>[k(r)?(i(),y(pa,{key:0,id:v.id,ref_key:"pluginSettingRef",ref:d},null,8,["id"])):K("",!0)]),_:1},8,["modelValue"]))}}),wa=S({__name:"PluginManager",setup(T){const f=u(),_=u(!1),R={id:"lowcode_pluginManager",query:{list:[{type:"input",label:"插件名称",prop:"name"},{type:"input",label:"服务商名称",prop:"serviceName"},{type:"select",label:"业务类型",prop:"pluginTypeId",options:async()=>C(),extraOptions:[{label:"全部",value:""}]},{type:"select",label:"鉴权方式",prop:"authMethod",options:"auth_method",extraOptions:[{label:"全部",value:""}]},{type:"input",label:"描述",prop:"remark"}]},request:{api:O.listPage},table:{tableCols:[{type:"selection"},{prop:"name",label:"插件名称",minWidth:100,slots:{default({row:n}){return e(ha,{data:n},null)}}},{prop:"remark",minWidth:100,label:"描述",showOverflowTooltip:!0},{prop:"serviceName",label:"服务商名称",showOverflowTooltip:!0,minWidth:100},{prop:"pluginTypeName",label:"业务类型"},{prop:"authMethodName",label:"鉴权方式"},{prop:"updateTime",label:"创建时间"},{prop:"status",label:"上架状态",slots:{default({row:n}){return e(ia,{dictKey:"updown_status",tip:"下架后此插件将不可用。确定要下架？",modelValue:n.status,updateFetch:async()=>{await O.updateStatus(n.id),r()}},null)}}},{fixed:"right",width:120,label:"操作",slots:{default({row:n}){const z=[{type:"primary",onClick:()=>{ie(oa,{query:{id:n.id}})},text:"设置"},{type:"primary",onClick:()=>{m(n.id)},text:"编辑"},{type:"primary",onClick:()=>{x(n.id)},text:"查看"},{type:"danger",text:"删除",popconfirmProps:{title:"删除后此插件将不可恢复。确定要删除？",confirm:()=>{v(n.id)}}},{type:"primary",onClick:()=>{ie(na,{query:{applicationId:n.id}})},text:"查看日志"}];return e(ua,{num:2,rowId:n.id,list:z},null)}}}]}},r=()=>{var n;(n=f.value)==null||n.refresh()},d=u(""),m=n=>{d.value=n||"",_.value=!0},v=async n=>{await O.delete(n),H.success("删除成功"),r()},b=u(""),x=async n=>{b.value=n,a.value=!0},C=async()=>(await G.list({name:""})).map(s=>({label:s.name,value:s.id})),a=u(!1),I=u(),P=u(!1),E=()=>{$.value="",V.value="",P.value=!0},L=u(!1),h=u(!1),t=async()=>{var n,s;try{L.value=!0;const w=(n=f.value)==null?void 0:n.multipleSelection.map(A=>A.id);if(w.length>5){H.error("单次最多导出5条插件信息");return}const o=((s=f.value)==null?void 0:s.multipleSelection.map(A=>A.name)).map(A=>ee("p",{style:{"font-size":"12px","line-height":"1.6",color:"#5C6677"}},A));Ze.confirm(ee("p",null,[ee("span",{style:{color:"#020814","margin-bottom":"8px",display:"flex"}},"您正要导出以下插件，这需要一点时间，确定现在导出?"),...o]),"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{await ea(w.join(",")),H.success("导出成功"),r()})}finally{L.value=!1}},V=u(),U=async(n,s)=>{try{h.value=!0,await aa(s.id),V.value="success",r()}catch(w){V.value=w.msg}finally{h.value=!1}},$=u("");return(n,s)=>{const w=oe,q=Je("az-page"),o=la,A=ta,z=Ye("premission");return i(),B("div",{class:"layout_box",ref:"pendingRef"},[e(q,{ref_key:"azPageRef",ref:f,config:R},{operation:l(({multipleSelection:F})=>[e(w,{type:"primary",onClick:s[0]||(s[0]=p=>m())},{default:l(()=>[N(" 添加插件 ")]),_:1}),ae((i(),y(w,{type:"warning",class:"azt_warning",onClick:E,loading:h.value},{default:l(()=>[N(" 导入 ")]),_:1},8,["loading"])),[[z,"workbench:plugin:import"]]),ae((i(),y(w,{onClick:t,type:"primary",disabled:F.length==0,loading:L.value},{default:l(()=>[N(" 导出 ")]),_:2},1032,["disabled","loading"])),[[z,"workbench:plugin:export"]])]),_:1},512),e(ya,{id:d.value,visible:_.value,"onUpdate:visible":s[1]||(s[1]=F=>_.value=F),onRefresh:r},null,8,["id","visible"]),e(Va,{visible:a.value,"onUpdate:visible":s[2]||(s[2]=F=>a.value=F),id:b.value},null,8,["visible","id"]),e(A,{modelValue:P.value,"onUpdate:modelValue":s[4]||(s[4]=F=>P.value=F),title:"插件导入"},{default:l(()=>[V.value?(i(),B(le,{key:1},[V.value==="success"?(i(),y(o,{key:0,icon:"success",title:"导入成功"})):(i(),y(o,{key:1,icon:"error",title:"导入失败","sub-title":V.value},{extra:l(()=>[e(w,{type:"primary",onClick:E},{default:l(()=>[N("重新导入")]),_:1})]),_:1},8,["sub-title"]))],64)):(i(),B("div",{key:0,style:{"text-align":"center"}},[M("div",{class:"upload_tips"},[M("img",{src:sa,alt:"下载提示"}),M("span",{class:"tips_16"},"上传本地插件/API包，快速生成插件API")]),h.value?K("",!0):(i(),y(ce,{key:0,ref_key:"AzUploadRef",ref:I,limit:1,type:"file",onUploadFinish:U,modelValue:$.value,"onUpdate:modelValue":s[3]||(s[3]=F=>$.value=F),size:1024*10,isShowTip:!1,"show-file-list":!0,accept:["json"]},null,8,["modelValue"])),h.value?(i(),B("span",{key:1},"正在导入，请耐心等待...")):K("",!0)]))]),_:1},8,["modelValue"])],512)}}});const ka=j(wa,[["__scopeId","data-v-5d66eaaf"]]),za=S({__name:"routePage",setup(T){return(f,_)=>(i(),y(ka))}});export{za as default};

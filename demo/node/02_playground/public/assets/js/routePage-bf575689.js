import{d8 as w,d as K,v as ae,c as O,r as C,y as ye,tB as y,tC as M,o as d,b as r,w as u,i as n,bu as fe,H as Q,r$ as be,B as a,f as W,F as X,g as Z,mP as _e,tD as J,m as V,t as E,tE as R,l as p,bh as N,tF as x,tG as te,tH as ue,tI as Y,tJ as oe,tK as ne,C as se,bv as ie,cc as $,aN as de,ao as ge,E as Ve,ab as he,dO as we,ac as ke,Q as Ie,bm as Ce,bs as re,bz as G,by as me,bT as Me,bU as Ue,bi as Ee,iC as Se,e as j,tq as P,rW as De,U as Te,c7 as $e,Y as ee}from"./index-b80d5ef5.js";import{E as Ne}from"./el-input-number-c15b1cc7.js";import{S as qe}from"./SelectIcon-68324dc3.js";import{_ as Re}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";const Le=()=>w.value.request.get(`${w.value.SYSTEMURL}/module/listPulldown`),ze=v=>w.value.request.post(`${w.value.SYSTEMURL}/menu/add`,v),Ae=v=>w.value.request.post(`${w.value.SYSTEMURL}/menu/edit`,v),Pe=v=>w.value.request.post(`${w.value.SYSTEMURL}/menu/list`,v),le=v=>w.value.request.post(`${w.value.SYSTEMURL}/menu/batchUpdateStatus`,v),Be=v=>w.value.request.post(`${w.value.SYSTEMURL}/menu/delete/${v}`),H="0",Fe=K({__name:"AddAndEdit",props:{modelValue:{type:Boolean},edit:{},menus:{},subMenuInfo:{}},emits:["update:modelValue","submit"],setup(v,{emit:L}){const f=v,S=L,c=ae(f,"modelValue",S),b=O(()=>!!f.edit),s=O(()=>b.value?"编辑菜单":"新增菜单"),_=C(),g={id:void 0,moduleId:"",type:M,name:"",icon:"",status:$,sort:1,logo:"",url:"",parentId:"",permission:"",isDisplay:x,isCache:Y},e=C({...g});ye(c,()=>{c.value&&(e.value=b.value?{...f.edit}:{...g},f.subMenuInfo&&(e.value.moduleId=f.subMenuInfo.moduleId,e.value.type=y,e.value.parentId=f.subMenuInfo.id),setTimeout(()=>{var t;(t=_.value)==null||t.clearValidate()},100))},{immediate:!0});const h=()=>{e.value.parentId=""},T=t=>{var l;t=t,t==M&&e.value.parentId===H&&(e.value.parentId=""),(l=_.value)==null||l.clearValidate()},z={moduleId:[{required:!0,message:"模块（子系统）不能为空",trigger:"change"}],type:[{required:!0,message:"菜单类型不能为空",trigger:"change"}],name:[{required:!0,message:`${e.value.type==M?"按钮/权限":"菜单"}名称不能为空`,trigger:"blur"}],url:[{required:!0,message:"请输入菜单地址",trigger:"blur"}],parentId:[{required:!0,message:"请选择上级菜单",trigger:"change"}],permission:[{required:!0,message:"请输入权限标识",trigger:"blur"}]},B=O(()=>{const t=[];if(!e.value.moduleId)return[];e.value.type==y&&t.push({value:H,label:"顶级菜单"});const l=(I,U)=>{for(const m of I)if(m.moduleId===e.value.moduleId&&m.type!=R&&m.id!==e.value.id){const q=[];U.push({label:`${m.name}`,value:m.id,children:q}),Array.isArray(m.children)&&l(m.children,q)}};return l(f.menus,t),t}),F=()=>{const t={id:e.value.id,name:e.value.name,status:e.value.status,moduleId:e.value.moduleId,type:e.value.type},{type:l}=e.value;return l==M?(t.icon=e.value.icon,t.sort=e.value.sort):l==y?(t.parentId=e.value.parentId===H?void 0:e.value.parentId,t.logo=e.value.logo,t.sort=e.value.sort,t.icon=e.value.icon,t.url=e.value.url,t.isDisplay=e.value.isDisplay,t.isCache=e.value.isCache):(t.parentId=e.value.parentId,t.permission=e.value.permission),t},o=async t=>{var l;await((l=_.value)==null?void 0:l.validate()),await(b.value?Ae:ze)(F()),de.success((b.value?"编辑":"新增")+"成功"),S("submit"),t==="submitContinue"&&(e.value.name=g.name,e.value.icon=g.icon,e.value.logo=g.logo,e.value.url=g.url,e.value.permission=g.permission,setTimeout(()=>{var I;(I=_.value)==null||I.clearValidate()},40))};return(t,l)=>{const I=ge,U=Ve,m=he,q=we,k=ke,A=Ie,pe=Ne,ve=Ce;return d(),r(ie,{modelValue:a(c),"onUpdate:modelValue":l[14]||(l[14]=i=>se(c)?c.value=i:null),title:s.value},{footer:u(()=>[n(fe,{editMode:b.value,onClose:l[13]||(l[13]=i=>c.value=!1),"on-submit":o},null,8,["editMode"])]),default:u(()=>[n(ve,{model:e.value,rules:z,"label-position":"left","label-width":"120px",ref_key:"ruleFormRef",ref:_},{default:u(()=>[n(Q,{label:"模块(子系统)",prop:"moduleId"},{default:u(()=>[n(be,{modelValue:e.value.moduleId,"onUpdate:modelValue":l[0]||(l[0]=i=>e.value.moduleId=i),style:{width:"100%"},placeholder:"请选择模块（子系统）",load:a(Le),onChange:h,disabled:b.value},{default:u(({options:i})=>[(d(!0),W(X,null,Z(i,D=>(d(),r(I,{key:D.id,label:D.systemName,value:D.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","load","disabled"])]),_:1}),n(Q,{label:"菜单类型",prop:"type"},{default:u(()=>[n(_e,{load:a(J)},{default:u(({options:i})=>[n(m,{modelValue:e.value.type,"onUpdate:modelValue":l[1]||(l[1]=D=>e.value.type=D),onChange:T,disabled:b.value},{default:u(()=>[(d(!0),W(X,null,Z(i,(D,ce)=>(d(),r(U,{key:ce,label:D.value},{default:u(()=>[V(E(D.label),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","disabled"])]),_:1},8,["load"])]),_:1}),[a(y),a(R)].includes(Number(e.value.type))?(d(),r(k,{key:0,label:"上级菜单",prop:"parentId"},{default:u(()=>[n(q,{modelValue:e.value.parentId,"onUpdate:modelValue":l[2]||(l[2]=i=>e.value.parentId=i),placeholder:e.value.moduleId?"请选择上级菜单":"请先选择模块",style:{width:"100%"},data:B.value,"check-strictly":"","render-after-expand":!1,"show-checkbox":"",disabled:!e.value.moduleId},null,8,["modelValue","placeholder","data","disabled"])]),_:1})):p("",!0),[a(M),a(y)].includes(Number(e.value.type))?(d(),r(k,{key:1,label:"菜单名称",prop:"name"},{default:u(()=>[n(A,{modelValue:e.value.name,"onUpdate:modelValue":l[3]||(l[3]=i=>e.value.name=i),placeholder:"请输入菜单名称",maxlength:"20"},null,8,["modelValue"])]),_:1})):p("",!0),e.value.type==a(y)?(d(),r(k,{key:2,label:"菜单地址",prop:"url"},{default:u(()=>[n(A,{modelValue:e.value.url,"onUpdate:modelValue":l[4]||(l[4]=i=>e.value.url=i),placeholder:"请输入菜单地址"},null,8,["modelValue"])]),_:1})):p("",!0),[a(R)].includes(Number(e.value.type))?(d(),r(k,{key:3,label:"按钮/权限",prop:"name"},{default:u(()=>[n(A,{modelValue:e.value.name,"onUpdate:modelValue":l[5]||(l[5]=i=>e.value.name=i),placeholder:"请输入按钮/权限名称",maxlength:"100"},null,8,["modelValue"])]),_:1})):p("",!0),e.value.type===a(y)?(d(),r(k,{key:4,label:"菜单标识",prop:"path"},{default:u(()=>[n(A,{modelValue:e.value.logo,"onUpdate:modelValue":l[6]||(l[6]=i=>e.value.logo=i),placeholder:"请输入菜单标识",maxlength:"100"},null,8,["modelValue"])]),_:1})):p("",!0),[a(M),a(y)].includes(Number(e.value.type))&&e.value.icon!=null?(d(),r(k,{key:5,label:"菜单图标",prop:"icon"},{default:u(()=>[n(qe,{modelValue:e.value.icon,"onUpdate:modelValue":l[7]||(l[7]=i=>e.value.icon=i)},null,8,["modelValue"])]),_:1})):p("",!0),e.value.type==a(R)?(d(),r(k,{key:6,label:"权限标识",prop:"permission"},{default:u(()=>[n(A,{modelValue:e.value.permission,"onUpdate:modelValue":l[8]||(l[8]=i=>e.value.permission=i),placeholder:"请输入权限标识"},null,8,["modelValue"])]),_:1})):p("",!0),n(k,{label:"状态",prop:"status"},{default:u(()=>[n(N,{modelValue:e.value.status,"onUpdate:modelValue":l[9]||(l[9]=i=>e.value.status=i)},null,8,["modelValue"])]),_:1}),e.value.type==a(y)?(d(),r(k,{key:7,label:"显示状态",prop:"isDisplay"},{default:u(()=>[n(N,{modelValue:e.value.isDisplay,"onUpdate:modelValue":l[10]||(l[10]=i=>e.value.isDisplay=i),"active-value":a(x),"inactive-value":a(te),"dict-key":a(ue)},null,8,["modelValue","active-value","inactive-value","dict-key"])]),_:1})):p("",!0),e.value.type==a(y)?(d(),r(k,{key:8,label:"是否缓存",prop:"isCache"},{default:u(()=>[n(N,{modelValue:e.value.isCache,"onUpdate:modelValue":l[11]||(l[11]=i=>e.value.isCache=i),"active-value":a(Y),"inactive-value":a(oe),"dict-key":a(ne)},null,8,["modelValue","active-value","inactive-value","dict-key"])]),_:1})):p("",!0),[a(M),a(y)].includes(Number(e.value.type))?(d(),r(k,{key:9,label:"排序",prop:"sort"},{default:u(()=>[n(pe,{modelValue:e.value.sort,"onUpdate:modelValue":l[12]||(l[12]=i=>e.value.sort=i),min:1,"controls-position":"right"},null,8,["modelValue"])]),_:1})):p("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Oe=K({__name:"ViewMenu",props:{modelValue:{type:Boolean},view:{},menus:{}},emits:["update:modelValue"],setup(v,{emit:L}){const f=v,c=ae(f,"modelValue",L),b=s=>{if((s==null?void 0:s.length)<3)return"顶级菜单";try{(function _(g){var e;for(const h of g){if(h.id===s)throw h.name;h.children&&((e=h.children)!=null&&e.length)&&_(h.children)}})(f.menus)}catch(_){return _}};return(s,_)=>{const g=me,e=Me,h=Ue;return d(),r(ie,{modelValue:a(c),"onUpdate:modelValue":_[0]||(_[0]=T=>se(c)?c.value=T:null),title:"查看详情"},{default:u(()=>[s.view?(d(),r(h,{key:0,column:2,border:"",style:{"margin-top":"30px"}},{default:u(()=>[n(e,{label:"菜单类型"},{default:u(()=>[n(g,{type:s.view.type==a(M)?"success":s.view.type==a(y)?void 0:"info"},{default:u(()=>[V(E(a(re)(s.view.type,a(J))),1)]),_:1},8,["type"])]),_:1}),n(e,{label:"所属模块"},{default:u(()=>[V(E(s.view.moduleName),1)]),_:1}),s.view.type!=a(M)?(d(),r(e,{key:0,label:"上级菜单名称"},{default:u(()=>[V(E(b(s.view.parentId)),1)]),_:1})):p("",!0),s.view.permission?(d(),r(e,{key:1,label:"权限标识"},{default:u(()=>[V(E(s.view.permission),1)]),_:1})):p("",!0),n(e,{label:s.view.type==a(R)?"按钮/权限名称":"菜单名称"},{default:u(()=>[V(E(s.view.name),1)]),_:1},8,["label"]),s.view.logo?(d(),r(e,{key:2,label:"菜单标识"},{default:u(()=>[V(E(s.view.logo||"-"),1)]),_:1})):p("",!0),s.view.url?(d(),r(e,{key:3,label:"菜单地址"},{default:u(()=>[V(E(s.view.url||"-"),1)]),_:1})):p("",!0),s.view.icon?(d(),r(e,{key:4,label:"菜单图标"},{default:u(()=>[n(G,{style:{"font-size":"20px"},"icon-class":s.view.icon},null,8,["icon-class"])]),_:1})):p("",!0),n(e,{label:"状态"},{default:u(()=>[n(N,{"model-value":s.view.status??a($),disabled:""},null,8,["model-value"])]),_:1}),s.view.type==a(y)?(d(),r(e,{key:5,label:"显示状态"},{default:u(()=>[n(N,{"model-value":s.view.isDisplay??a($),"active-value":a(x),"inactive-value":a(te),"dict-key":a(ue),disabled:""},null,8,["model-value","active-value","inactive-value","dict-key"])]),_:1})):p("",!0),s.view.type==a(y)?(d(),r(e,{key:6,label:"是否缓存"},{default:u(()=>[n(N,{"model-value":s.view.isCache??a(Y),"active-value":a(Y),"inactive-value":a(oe),"dict-key":a(ne),disabled:""},null,8,["model-value","active-value","inactive-value","dict-key"])]),_:1})):p("",!0),s.view.sort?(d(),r(e,{key:7,label:"菜单排序"},{default:u(()=>[V(E(s.view.sort),1)]),_:1})):p("",!0)]),_:1})):p("",!0)]),_:1},8,["modelValue"])}}});function Ye(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!$e(v)}const je={name:"Menu"},Ke=K({...je,setup(v){const L={query:{list:[{type:"input",label:"菜单名称",prop:"name"}],webSearch:[{prop:"name"}]},request:{api:Pe},operation:{isExpand:!0},table:{tableProps:{rowKey:"id"},tableCols:[{type:"selection"},{prop:"moduleName",label:"所属模块",width:200,showOverflowTooltip:!0},{prop:"name",label:"菜单名称",width:200,showOverflowTooltip:!0},{prop:"type",label:"菜单类型",width:120,slots:{default({row:o}){let t;return n(me,{type:o.type===M?"success":o.type==y?void 0:"info"},Ye(t=re(o.type,J))?t:{default:()=>[t]})}}},{label:"菜单图标",width:100,slots:{default({row:o}){return o.icon?n(G,{style:{fontSize:"20px"},iconClass:o.icon},null):n("span",null,[V("-")])}}},{prop:"url",label:"菜单地址",width:200,showOverflowTooltip:!0},{prop:"logo",label:"菜单标识",width:180,showOverflowTooltip:!0,slots:{default({row:o}){return n("span",null,[o.logo||o.permission||"-"])}}},{prop:"sort",label:"排序",width:100},{prop:"status",label:"状态",slots:{default({row:o}){return n(N,{modelValue:o.status,"onUpdate:modelValue":t=>o.status=t,updateFetch:async()=>{await le([{id:o.id,status:o.status===$?P:$}]),S()},disabled:!De("system:menu:enable")},null)}}},{fixed:"right",label:"操作",minWidth:180,slots:{default({row:o}){const t=async()=>{await Be(o.id),de.success("删除成功"),S()},l=()=>{s.value=null,b.value=ee(o),c.value=!0},I=()=>{e.value=!0,h.value=o},U=()=>{b.value=null,s.value=ee(o),c.value=!0},m=[{type:"primary",onClick:l,text:"编辑",premission:"system:menu:edit"},{type:"primary",onClick:I,text:"查看",premission:"system:menu:detail"},{type:"danger",text:"删除",premission:"system:menu:delete",popconfirmProps:{title:"您确定要删除该菜单吗?",confirm:t}}];return o.type!=R&&m.unshift({type:"primary",onClick:U,text:"新增下级菜单",premission:"system:menu:addxj"}),n(Re,{num:2,rowId:o.id,list:m},null)}}}]},pagination:{hidePagination:!0}},f=C(),S=()=>{var o;(o=f.value)==null||o.refresh()},c=C(!1),b=C(),s=C(),_=()=>{b.value=null,s.value=null,c.value=!0},g=O(()=>{var o;return((o=f.value)==null?void 0:o.data)??[]}),e=C(!1),h=C(),T=C(!1),z=C(!1),B=(o,t)=>t.length?t.every(l=>l.status==o):!0,F=async(o,t)=>{o===P?T.value=!0:z.value=!0;try{await le(t.filter(l=>l.status!=o).map(l=>({id:l.id,status:Number(o)})))}finally{o===P?T.value=!1:z.value=!1}await S()};return(o,t)=>{const l=Te,I=Ee("az-page"),U=Se("premission");return d(),W("div",null,[n(I,{class:"layout_box",ref_key:"azPageRef",ref:f,config:L,maxHeight:"var(--az-layout-main-height) - 40px"},{operation:u(({multipleSelection:m})=>[j((d(),r(l,{type:"primary",onClick:_},{default:u(()=>[n(G,{"icon-class":"add-menu",style:{"margin-right":"5px"}}),V(" 新增菜单 ")]),_:1})),[[U,"system:menu:add"]]),j((d(),r(l,{type:"success",loading:T.value,disabled:B(a(P),m),onClick:q=>F(a(P),m)},{default:u(()=>[V(" 停用 ")]),_:2},1032,["loading","disabled","onClick"])),[[U,"system:menu:plstop"]]),j((d(),r(l,{type:"success",loading:z.value,disabled:B(a($),m),onClick:q=>F(a($),m)},{default:u(()=>[V(" 启用 ")]),_:2},1032,["loading","disabled","onClick"])),[[U,"system:menu:plstop"]])]),_:1},512),c.value?(d(),r(Fe,{key:0,modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=m=>c.value=m),edit:b.value,onSubmit:S,menus:g.value,subMenuInfo:s.value},null,8,["modelValue","edit","menus","subMenuInfo"])):p("",!0),n(Oe,{modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=m=>e.value=m),view:h.value,menus:g.value},null,8,["modelValue","view","menus"])])}}});export{Ke as default};

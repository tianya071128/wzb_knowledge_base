import{bK as Q,c as $,dw as ee,eK as te,aN as P,k_ as z,d as S,r as A,y as oe,bH as se,e as W,B as p,o as h,f as E,i as r,w as c,a2 as ne,j as H,m as G,t as re,a1 as le,bc as ae,l as J,Q as ie,q as ce,br as de,cI as ue,ca as Y,_ as X,v as pe,b as F,bu as fe,C as me,bn as ve,bf as _e,bd as ye,ad as ge,bz as Ie,F as N,g as be,I as j,U as he}from"./index-b80d5ef5.js";import{M as ke}from"./ModuleWrapper-dbe018a4.js";import{G as Ce}from"./GirdList-c2082769.js";import{V as Ve}from"./ViewMore-2edbc0b5.js";import{f as Ae,r as xe,g as Fe,h as Me,i as we}from"./homePage-3523f56f.js";import{u as Le}from"./createDesigner-82222fc7.js";/* empty css                          */import{A as Te}from"./AppIcon-5727720b.js";import{u as Ee}from"./processModel-1437813e.js";import"./defaultValue-7c7c87ea.js";import{A as q}from"./AppFavorites-b5587807.js";import{u as Se}from"./useAddModuleContext-27547570.js";import{S as Be}from"./SettingsFormWrapper-340ed4ef.js";import{_ as Re}from"./ModuleTitleEditor.vue_vue_type_script_setup_true_lang-41e118cc.js";import{G as K}from"./GridItem-674e6ecc.js";import{M as De}from"./ModuleEmpty-f80311b1.js";import"./dashboardDesigner-ce3c2e23.js";import"./enum-baae9292.js";import"./useTransformColor-38b5da33.js";import"./AppIconNew-704f70f4.js";const $e=[{id:"1702139737923403777",valid:!0,type:1,entryInfo:{appId:"1695981606189252610",entryId:null,icon:"b-5",color:"#478CFF",name:"示例数据1"},sort:1024},{id:"1702139740137996289",valid:!0,type:1,entryInfo:{appId:"1696054936594399233",entryId:null,icon:"cooperation_menu",color:"#20CC98",name:"示例数据2"},sort:1792}],Pe=y=>{const i=Le(),t=Q({loading:!1,collectionsList:[]}),n=$(()=>ee.design===i.mode),s=async()=>{t.loading=!0;try{const l=n.value?$e:await Ae();t.collectionsList=l.map(o=>(o.valid||(o.entryInfo={...o.entryInfo,name:"常用已失效",icon:"QuestionFilled",color:"#b5b8be"}),o))}finally{t.loading=!1}},u=async(l,o)=>{if(n.value){P.error("仅为样例数据");return}await xe(o.id),P.success("已取消常用"),s(),d()},d=()=>{i.getModuleContextByType([z.collections,z.myApp],i.moduleIds.filter(o=>o!==y.moduleId)).forEach(o=>{var f;o&&((f=o==null?void 0:o.refresh)==null||f.call(o))})};return{...te(t),getList:s,handleClickFavorites:u,handleRefreshFa:d,isDesignMode:n}},Ge=Pe,Oe=function(y){const i=[],t={};for(const n of y){const s=n.id,u=n.parentId,d=!1;t[s]||(t[s]={children:[]}),t[s]={...n,selected:d,favoritesType:2,children:t[s].children};const l=t[s];u==="0"?i.push(l):(t[u]||(t[u]={children:[]}),t[u].children.push(l))}return i},Ue=S({__name:"Tree",props:{isFavorite:{type:Boolean,default:!1},multipleSelection:{}},emits:["update:multipleSelection"],setup(y,{expose:i,emit:t}){const n=y,s=t,u=A([]),d=$({get(){return n.multipleSelection??u.value},set(a){Array.isArray(n.multipleSelection)?s("update:multipleSelection",a):u.value=a}}),l=A(""),o={value:"id",label:"name",children:"children"},f=A();oe(l,a=>{f.value.filter(a)});const m=(a,e)=>a?e.name.includes(a):!0,C=A([]),I=new Map,x=new Map,{isLoading:B,result:v}=Ee(async()=>{const a=await Fe();C.value=se(a);const{isFavorite:e}=n;return a.map(b=>{const{id:V,name:R,icon:D,favoriteId:M,color:k}=b.appVO;M&&e&&d.value.push(V),x.set(V,1),I.set(V,b.appVO);const T=Array.isArray(b.appEntryVOList);T&&b.appEntryVOList.forEach(w=>{var U;I.set(w.id,w),x.set(w.id,2),!!((U=w.favoritesVO)!=null&&U.valid)&&e&&d.value.push(w.id)});const Z=T?Oe(b.appEntryVOList):[];return{id:V,appId:V,name:R,icon:D,selected:!1,color:k,favoritesType:1,children:[...Z]}})}),g=$(()=>v.value??[]);return i({originalValue:C,oValueMap:I,favoritesTypeMap:x,getFavoriteById:()=>d.value.map(e=>({buId:e,type:x.get(e)})),getAppInfoById:()=>d.value.map(e=>I.get(e))}),(a,e)=>{const _=ie,b=ce,V=de,R=ue,D=Y;return W((h(),E("div",null,[r(_,{class:"mb-10",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=M=>l.value=M),placeholder:"请输入名称"},null,8,["modelValue"]),r(R,{"render-after-expand":"","highlight-current":"",ref_key:"treeRef",ref:f,class:"favorite_tree",data:g.value,"node-key":"id","filter-node-method":m,props:o},{default:c(({node:M,data:k})=>[r(Te,{"bg-color":k.color,icon:k.icon,class:"card_icon",style:ne({color:k.favoritesType===1?"#ffffff":k.color}),"is-gradient":k.favoritesType===1,type:"link"},null,8,["bg-color","icon","style","is-gradient"]),r(H,{style:{flex:"1","margin-left":"6px"}},{default:c(()=>[G(re(M.label),1)]),_:2},1024),k.type!==p(le).group?(h(),E("span",{key:0,style:{"padding-right":"5px"}},[r(V,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=T=>d.value=T)},{default:c(()=>[r(b,{onClick:e[1]||(e[1]=ae(()=>{},["stop"])),label:k.id},{default:c(()=>[G(" ")]),_:2},1032,["label"])]),_:2},1032,["modelValue"])])):J("",!0)]),_:1},8,["data"])])),[[D,p(B)]])}}});const ze=X(Ue,[["__scopeId","data-v-06727c3c"]]),Ne=S({__name:"AddCollections",props:{visible:{type:Boolean},title:{default:"未定义title"}},emits:["update:visible","refresh"],setup(y,{emit:i}){const t=i,s=pe(y,"visible",t),u=()=>{},d=()=>{},l=A(),o=async()=>{var m;const f=((m=l.value)==null?void 0:m.getFavoriteById())||[];await Me(f),P.success("收藏成功"),t("refresh")};return(f,m)=>{const C=ve;return h(),F(C,{modelValue:p(s),"onUpdate:modelValue":m[1]||(m[1]=I=>me(s)?s.value=I:null),title:f.title,width:"610px",class:"custom_az_dialog","append-to-body":"","destroy-on-close":"",onOpen:u,onClose:d},{footer:c(()=>[r(fe,{editMode:!0,onClose:m[0]||(m[0]=I=>s.value=!1),"on-submit":o})]),default:c(()=>[r(ze,{"is-favorite":"",ref_key:"TreeVueRef",ref:l},null,512)]),_:1},8,["modelValue","title"])}}}),je=S({__name:"Setting",props:{moduleItem:{}},setup(y){return(i,t)=>(h(),F(Be,null,{default:c(()=>[r(Re,{"module-item":i.moduleItem},null,8,["module-item"])]),_:1}))}});function qe(){const y=_e();return{goApp:({appId:t,entryId:n})=>{y(ye,{query:{appId:t,entryId:n}})}}}const Ke=S({__name:"render",props:{moduleItem:{}},setup(y){const i=y,{loading:t,collectionsList:n,getList:s,handleClickFavorites:u,handleRefreshFa:d,isDesignMode:l}=Ge({moduleId:i.moduleItem.moduleId}),{goApp:o}=qe(),f=A(!1),m=A(!1),C=v=>({name:v.entryInfo.name,icon:v.entryInfo.icon,color:v.entryInfo.color,isGradient:v.type.toString()==="1",isBackGroundColor:v.type.toString()==="1"}),I=v=>{if(v.valid){const{appId:g,entryId:L}=v.entryInfo;o({appId:g,entryId:L??void 0})}},x=Q({refresh(){s()}});Se(i.moduleItem.moduleId,x),s();const B=()=>{s(),d()};return(v,g)=>{const L=he,O=Y;return W((h(),F(ke,{"module-item":v.moduleItem},ge({edit:c(()=>[r(je,{"module-item":v.moduleItem},null,8,["module-item"])]),default:c(()=>{var a;return[(a=p(n))!=null&&a.length?(h(),F(Ce,{key:0,list:p(n)},{default:c(({list:e})=>[(h(!0),E(N,null,be(e,_=>(h(),F(K,j({key:_.id,class:_.valid?"":"error_text"},{...C(_)},{onClick:b=>I(_)}),{collect:c(()=>[r(q,{onClickFavorites:b=>p(u)(b,_),valid:!0},null,8,["onClickFavorites"])]),_:2},1040,["class","onClick"]))),128))]),_:1},8,["list"])):(h(),F(De,{key:1,description:"暂无收藏"})),p(l)?J("",!0):(h(),E(N,{key:2},[r(Ve,{"drawer-model":f.value,"onUpdate:drawerModel":g[1]||(g[1]=e=>f.value=e),title:"收藏",list:p(n),onRefresh:p(s),onAdd:g[2]||(g[2]=e=>m.value=!0),addAble:"",sortFn:p(we)},{default:c(({element:e})=>[r(K,j({...C(e)},{onClick:_=>I(e)}),{collect:c(()=>[r(q,{onClickFavorites:_=>p(u)(_,e),valid:!0},null,8,["onClickFavorites"])]),_:2},1040,["onClick"])]),_:1},8,["drawer-model","list","onRefresh","sortFn"]),r(Ne,{visible:m.value,"onUpdate:visible":g[3]||(g[3]=e=>m.value=e),onRefresh:B,title:"新增收藏"},null,8,["visible"])],64))]}),_:2},[p(l)?{name:"desc",fn:c(()=>[r(H,{style:{"margin-left":"10px",color:"var(--el-text-color-secondary)","font-size":"12px"},content:"由用户自主添加收藏，无需配置；效果如下","show-after":300})]),key:"0"}:void 0,p(l)?void 0:{name:"top-right",fn:c(()=>[r(L,{text:"",type:"primary",size:"small",class:"click-active",onClick:g[0]||(g[0]=a=>f.value=!0)},{default:c(()=>[G(" 更多  "),r(Ie,{"icon-class":"DArrowRight"})]),_:1})]),key:"1"}]),1032,["module-item"])),[[O,p(t)]])}}});const vt=X(Ke,[["__scopeId","data-v-03f75861"]]);export{vt as default};

import{d as z,v as H,o as u,f as S,i as e,w as a,k as m,B as C,ae as oe,C as Q,P as pe,bn as X,_ as Z,ea as be,r as x,b6 as se,bf as ye,bd as ge,c as U,cc as we,b as w,m as I,t as A,bz as Ce,a2 as Ve,bs as ke,F as W,bT as Ie,by as xe,bU as Ae,bK as Ee,bu as ee,l as B,cQ as Se,bv as Ue,aN as Y,Q as ie,ac as de,q as he,br as Fe,bm as ce,d8 as q,ad as Pe,lF as Me,lG as re,d9 as Te,g as ne,lH as Le,d2 as Ne,d3 as Re,bA as me,lI as Be,U as De,bB as fe,is as K,dk as P,dl as $e,dj as M,d4 as qe,ao as ze,ap as je}from"./index-b80d5ef5.js";/* empty css                          */import{q as _e,s as Oe,d as Ye,e as He}from"./homePage-3523f56f.js";import{S as ue}from"./SelectIcon-71b7daf2.js";import{E as Qe}from"./el-space-0d01b33a.js";const Ge=""+new URL("../png/create_app01-935a35f1.png",import.meta.url).href,Je=""+new URL("../png/create_app03-977b1a99.png",import.meta.url).href,Ke=z({__name:"AppCategory",props:{drawerModel:{type:Boolean}},emits:["update:drawerModel","handleClick"],setup(f,{emit:V}){const b=V,i=H(f,"drawerModel",b),n=l=>{b("handleClick",l)};return(l,s)=>{const d=pe,p=X;return u(),S("div",null,[e(p,{"append-to-body":"",modelValue:C(i),"onUpdate:modelValue":s[2]||(s[2]=k=>Q(i)?i.value=k:null),title:"创建应用",width:"580px"},{default:a(()=>[m("div",{class:"app_category"},[m("div",{class:"app_card",onClick:s[0]||(s[0]=k=>n("1"))},[m("div",{class:"app_card-content"},[e(d,{class:"app_card-icon"},{default:a(()=>[e(C(oe))]),_:1}),m("span",{class:"app_card-text"},"创建空白应用")]),m("img",{class:"app_card-img",src:Ge,alt:""})]),m("div",{class:"app_card",onClick:s[1]||(s[1]=k=>n("3"))},[m("div",{class:"app_card-content"},[e(d,{class:"app_card-icon"},{default:a(()=>[e(C(oe))]),_:1}),m("span",{class:"app_card-text"},"本地导入应用")]),m("img",{class:"app_card-img",src:Je,alt:""})])])]),_:1},8,["modelValue"])])}}});const da=Z(Ke,[["__scopeId","data-v-45e42048"]]),We=be("app.queryParams",()=>{const f=x({}),V=x(se);return{historyParams:f,historyPath:V,reset:()=>{f.value={},V.value=se}}});function Xe(){const f=We(),V=ye();return{goApp:({appId:i,entryId:n,manager:l})=>{V(ge,{query:{appId:i,entryId:n,manager:l}}),f.reset()},reset:()=>{f.reset()}}}const Ze=z({__name:"AppDetail",props:{details:{},isCooperateApp:{type:Boolean}},setup(f){const V=f,b=U(()=>V.details.status===we?"success":"danger");return(r,i)=>{const n=Ie,l=xe,s=Ae;return u(),w(s,{class:"user_center-desciptions",border:!0,column:2},{default:a(()=>[e(n,{label:"应用名称"},{default:a(()=>[I(A(r.details.name||"-"),1)]),_:1}),e(n,{label:"适用设备"},{default:a(()=>[I(A(r.details.platforms||"-"),1)]),_:1}),e(n,{label:"应用图标"},{default:a(()=>[r.details.icon?(u(),w(Ce,{key:0,"icon-class":r.details.icon,style:Ve({color:r.details.color})},null,8,["icon-class","style"])):(u(),S("span",{key:1},"-"))]),_:1}),e(n,{label:"状态"},{default:a(()=>[r.details.upgradeStatus==1?(u(),w(l,{key:0,type:"warning"},{default:a(()=>[I("升级中")]),_:1})):(u(),w(l,{key:1,type:b.value},{default:a(()=>[I(A(C(ke)(r.details.status,"status")||"-"),1)]),_:1},8,["type"]))]),_:1}),e(n,{label:"应用描述",span:2},{default:a(()=>[I(A(r.details.description||"-"),1)]),_:1}),r.isCooperateApp?(u(),w(n,{key:0,label:"来源方"},{default:a(()=>[I(A(r.details.collaborateCorp||"-"),1)]),_:1})):(u(),S(W,{key:1},[e(n,{label:"创建人"},{default:a(()=>[I(A(r.details.createUserName||"-"),1)]),_:1}),e(n,{label:"创建时间"},{default:a(()=>[I(A(r.details.createTime||"-"),1)]),_:1}),e(n,{label:"修改人"},{default:a(()=>[I(A(r.details.updateUserName||"-"),1)]),_:1}),e(n,{label:"修改时间"},{default:a(()=>[I(A(r.details.updateTime||"-"),1)]),_:1})],64))]),_:1})}}}),ca=z({__name:"AppAdd",props:{drawerModel:{type:Boolean},comState:{},appId:{},isCooperateApp:{type:Boolean}},emits:["update:drawerModel","refresh","updated"],setup(f,{emit:V}){const b=V,r=f,i=x(),{goApp:n}=Xe(),l=c=>r.comState===c,s=H(r,"drawerModel",b),d=U(()=>l("edit")),p=U({get(){return t.value.platforms?t.value.platforms.split(","):[]},set(c){t.value.platforms=c.join(",")}}),k=U(()=>l("view")?"查看应用":l("add")?"创建应用":"修改应用"),y={color:"#478CFF",icon:"b-5",description:"",name:"",platforms:"PC",mobileColor:"",mobileIcon:""},t=x({...y}),T=Ee({name:[{required:!0,message:"请输入应用名称",trigger:"blur"},{max:50,message:"应用名称最多50个字符",trigger:"blur"}],platforms:[{required:!0,message:"请选择适用设备",trigger:"blur"}],description:[{max:200,message:"应用描述最多200个字符",trigger:"blur"}]}),L=async()=>{if(l("add"))t.value={...y};else{const c=await _e(r.appId);t.value={...c,id:r.appId}}},h=async c=>{var R;await((R=i.value)==null?void 0:R.validate());const o=await Oe(t.value);c==="submitContinue"&&(t.value={...y}),l("add")?Y.success("创建应用成功"):(Y.success("修改应用成功"),b("updated",o)),c!=="submitContinue"&&l("add")&&n({appId:o.id,manager:"1"}),b("refresh")},D=c=>{t.value.mobileColor=c},j=c=>{t.value.mobileIcon=c},O=U(()=>{var c;return(c=t.value.platforms)==null?void 0:c.includes("H5")}),N=U({get(){return t.value.isPcSame==0||!t.value.isPcSame},set(c){"icon"in t.value&&(c?t.value.isPcSame=0:(t.value.isPcSame=1,t.value.mobileColor="#FFFFFF",t.value.mobileIcon="clue_pool"))}});return(c,o)=>{const R=ie,_=de,v=he,F=Fe,G=ce;return u(),w(Ue,{modelValue:C(s),"onUpdate:modelValue":o[7]||(o[7]=g=>Q(s)?s.value=g:null),size:"520px",title:k.value,"append-to-body":"","show-load":L},{footer:a(()=>[l("view")?B("",!0):(u(),w(ee,{key:0,editMode:d.value,onClose:o[6]||(o[6]=g=>s.value=!1),"on-submit":h},null,8,["editMode"]))]),default:a(()=>[l("view")?(u(),w(Ze,{key:1,details:t.value,isCooperateApp:c.isCooperateApp},null,8,["details","isCooperateApp"])):(u(),w(G,{key:0,ref_key:"ruleFormRef",ref:i,rules:T,model:t.value,"label-position":"left","label-width":"95px"},{default:a(()=>[e(_,{label:"应用名称",prop:"name"},{default:a(()=>[e(R,{modelValue:t.value.name,"onUpdate:modelValue":o[0]||(o[0]=g=>t.value.name=g),placeholder:"请输入应用名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(_,{label:"适用设备",prop:"platforms"},{default:a(()=>[e(F,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=g=>p.value=g)},{default:a(()=>[e(v,{label:"PC",value:"PC",disabled:""}),e(v,{label:"H5",value:"H5"})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"应用图标"},{default:a(()=>[e(ue,{color:t.value.color,"onUpdate:color":o[2]||(o[2]=g=>t.value.color=g),icon:t.value.icon,"onUpdate:icon":o[3]||(o[3]=g=>t.value.icon=g)},null,8,["color","icon"])]),_:1}),O.value?(u(),w(_,{key:0,label:"移动端图标"},{default:a(()=>[m("div",{style:{display:"flex","flex-direction":"column"}},[e(v,{modelValue:N.value,"onUpdate:modelValue":o[4]||(o[4]=g=>N.value=g)},{default:a(()=>[I("与pc端一致")]),_:1},8,["modelValue"]),N.value?B("",!0):(u(),w(ue,{key:0,types:[C(Se).mobile],color:t.value.mobileColor??t.value.color,icon:t.value.mobileIcon??t.value.icon,"onUpdate:color":D,"onUpdate:icon":j},null,8,["types","color","icon"]))])]),_:1})):B("",!0),e(_,{label:"应用描述",prop:"description"},{default:a(()=>[e(R,{type:"textarea",maxlength:"200",rows:3,modelValue:t.value.description,"onUpdate:modelValue":o[5]||(o[5]=g=>t.value.description=g),"show-word-limit":"",placeholder:"请输入应用描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]))]),_:1},8,["modelValue","title"])}}}),ea=f=>q.value.request.post(`${q.value.SYSTEMURL}/apptransfer/exportApp`,f,{downloadFile:!0,timeout:5*60*1e3}),aa=f=>q.value.request.post(`${q.value.SYSTEMURL}/apptransfer/importApp`,f,{timeout:5*60*1e3}),la=f=>q.value.request.post(`${q.value.SYSTEMURL}/apptransfer/downloadExcel/${f}`,{},{downloadFile:!0}),ta=z({__name:"AppImport",props:{visible:{type:Boolean}},emits:["update:visible","success"],setup(f,{emit:V}){const b=V,i=H(f,"visible",b),n=x(""),l=x(1),s=x(""),d=x(0),p=x(!1),k=x(),y=x(),t=x(!1),T=()=>{h.value?c():(i.value=!1,l.value=1,s.value="",n.value="")},L=async(_,v)=>{n.value=v.id},h=U(()=>{var _;return(_=k.value)==null?void 0:_.errorVOList.every(v=>v.errors.length===0)}),D=U(()=>{var _;return(_=k.value)==null?void 0:_.errorVOList.reduce((v,F)=>v+F.errors.length,0)}),j=U(()=>{var _;return(_=k.value)==null?void 0:_.errorVOList.reduce((v,F)=>v+(F.errors.length===0?1:0),0)}),O=_=>{y.value=_.errors,t.value=!0},N=async()=>{if(!n.value)return Y.warning("请先上传文件，再导入应用！"),!1;p.value=!0,o();try{return k.value=await aa({fileId:n.value}),l.value=2,!1}catch{p.value=!1}finally{p.value=!1}},c=()=>{i.value=!1,l.value=1,s.value="",n.value="",b("success")},o=()=>{(d.value>=100||!p.value)&&(d.value=100),d.value=Math.floor((100-d.value)/4*Math.random()+d.value),setTimeout(()=>{o()},400)},R=async()=>{var _;await la((_=k.value)==null?void 0:_.logId)};return(_,v)=>{const F=Ne,G=Re,g=me,ve=Be,ae=pe,J=De,le=fe,te=X;return u(),w(te,{"append-to-body":"",modelValue:C(i),"onUpdate:modelValue":v[3]||(v[3]=E=>Q(i)?i.value=E:null),"destroy-on-close":"",title:"导入应用",width:"800px",onClosed:T},{footer:a(()=>[e(ee,{"is-cancel":l.value===1,"is-submit":l.value===1,"submit-text":"开始导入",editMode:"","on-submit":N,onClose:v[1]||(v[1]=E=>i.value=!1)},Pe({_:2},[l.value===2?{name:"first",fn:a(()=>[e(J,{type:"primary",text:"",onClick:R},{default:a(()=>[I(" 下载导入结果明细 ")]),_:1}),e(J,{type:"primary",onClick:c},{default:a(()=>[I("完成")]),_:1})]),key:"0"}:void 0]),1032,["is-cancel","is-submit"])]),default:a(()=>[e(le,{justify:"center",class:"app-import"},{default:a(()=>[e(g,{span:18},{default:a(()=>[e(G,{class:"mb-4",style:{"max-width":"600px"},space:200,active:l.value,"finish-status":"success",simple:""},{default:a(()=>[e(F,{title:"1.上传本地文件",icon:C(Me)},null,8,["icon"]),e(F,{title:"2.完成",icon:C(re)},null,8,["icon"])]),_:1},8,["active"])]),_:1}),p.value?B("",!0):(u(),w(g,{key:0,span:18},{default:a(()=>[l.value===1?(u(),S("div",{key:0,class:"step-one"},[m("div",{class:"tips"},"1.导入本地应用文件；"),m("div",{class:"tips"},"2.应用包文件格式为zip文件；"),e(Te,{ref:"AzUploadRef",limit:1,type:"file",onUploadFinish:L,modelValue:s.value,"onUpdate:modelValue":v[0]||(v[0]=E=>s.value=E),accept:["zip"],isShowTip:!1,"show-file-list":!0,size:1024*2},null,8,["modelValue"])])):B("",!0)]),_:1})),p.value?(u(),w(g,{key:1,span:18},{default:a(()=>[m("div",{class:"progress-box"},[m("div",{class:"tips center"},"正在导入应用，请耐心等待..."),e(ve,{percentage:d.value,"stroke-width":15},null,8,["percentage"])])]),_:1})):B("",!0),e(g,{span:18},{default:a(()=>{var E;return[l.value===2?(u(),S("div",{key:0,class:"step-two"},[m("div",{class:"result-total center"},[I(" 成功数： "),m("span",{class:"success"},A(j.value),1),I(" 、 失败数： "),m("span",{class:"fail"},A(D.value),1)]),m("ul",{class:"result-list"},[(u(!0),S(W,null,ne((E=k.value)==null?void 0:E.errorVOList,$=>(u(),S("li",{class:"list-item",key:$.modelName},[m("div",{class:"item-name"},A($.modelName),1),m("div",{class:"item-status"},[$.errors.length===0?(u(),w(ae,{key:0,color:"var(--el-color-success)",size:16},{default:a(()=>[e(C(re))]),_:1})):(u(),w(le,{key:1,align:"middle"},{default:a(()=>[e(ae,{color:"var(--el-color-error)",size:16},{default:a(()=>[e(C(Le))]),_:1}),e(J,{type:"primary",text:"",onClick:sa=>O($)},{default:a(()=>[I(" 查看原因 ")]),_:2},1032,["onClick"])]),_:2},1024))])]))),128))])])):B("",!0)]}),_:1})]),_:1}),e(te,{modelValue:t.value,"onUpdate:modelValue":v[2]||(v[2]=E=>t.value=E),title:"查看原因",width:"600px"},{default:a(()=>[m("div",{class:"reason-list"},[(u(!0),S(W,null,ne(y.value,(E,$)=>(u(),S("div",{class:"reason-item",key:$},A(E),1))),128))])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}});const ma=Z(ta,[["__scopeId","data-v-411e9903"]]),fa=z({__name:"AppAuth",setup(f,{expose:V}){const b=x(""),r=x(!1),i=x([]),n=async s=>{const d=await Ye(s);b.value=s,i.value=d.referenceList.map(p=>{if(p.referenceId==="-1"){if(p.referenceType===M.corpCooperation)return{id:P.allCooperateEnterprise,type:M.dynamic};if(p.referenceType===M.userCooperation)return{id:P.allCooperatePersonnel,type:M.dynamic}}return{id:p.referenceId,type:p.referenceType}}),r.value=!0},l=async s=>{const d={appId:b.value,referenceList:[]};Array.isArray(s)?d.referenceList=s.map(p=>p.id===P.allCooperateEnterprise?{referenceId:"-1",referenceType:M.corpCooperation}:p.id===P.allCooperatePersonnel?{referenceId:"-1",referenceType:M.userCooperation}:{referenceId:p.id,referenceType:p.type}):s.id===P.allCooperateEnterprise?d.referenceList=[{referenceId:"-1",referenceType:M.corpCooperation}]:s.id===P.allCooperatePersonnel?d.referenceList=[{referenceId:"-1",referenceType:M.userCooperation}]:d.referenceList=[{referenceId:s.id,referenceType:s.type}],await He(d),b.value="",Y.success("应用权限设置成功")};return V({handleSetAppAuth:n}),(s,d)=>(u(),w($e,{"model-value":i.value,visible:r.value,"onUpdate:visible":d[0]||(d[0]=p=>r.value=p),"onUpdate:modelValue":l,"dialog-title":"应用权限",placeholder:"选定组织下的成员可访问使用此应用",tabs:[C(K).org,C(K).corpCooperation,C(K).userCooperation],dynamic:[C(P).allCooperateEnterprise,C(P).allCooperatePersonnel],multiple:"",class:"w100"},null,8,["model-value","visible","tabs","dynamic"]))}}),oa=z({__name:"AppExport",props:{visible:{type:Boolean},appId:{}},emits:["update:visible"],setup(f,{emit:V}){const b=V,r=f,i=H(r,"visible",b),n={appIds:[],appName:"",exportPackageName:"",exportFlag:!1,remark:""},l=x({...n}),s={exportPackageName:[{required:!0,message:"请输入压缩包名称",trigger:"blur"}],remark:[{max:200,message:"说明最多200个字符",trigger:"blur"}]},d=async()=>{await ea(l.value),Y.success("应用导出成功!")},p=async()=>{const k=await _e(r.appId);l.value={...n,appName:k.name,appIds:[r.appId],exportPackageName:`${k.name}_${qe(Date.now()).format("YYYYMMDD")}`}};return(k,y)=>{const t=me,T=fe,L=ie,h=de,D=ze,j=je,O=ce,N=Qe,c=X;return u(),w(c,{"append-to-body":"",modelValue:C(i),"onUpdate:modelValue":y[5]||(y[5]=o=>Q(i)?i.value=o:null),title:"导出应用",width:"800px",onOpen:p},{footer:a(()=>[e(ee,{"submit-text":"开始导出",editMode:"","on-submit":d,onClose:y[4]||(y[4]=o=>i.value=!1)})]),default:a(()=>[e(T,{justify:"center"},{default:a(()=>[e(N,{direction:"vertical",fill:"",size:"large"},{default:a(()=>[e(T,{justify:"center"},{default:a(()=>[e(t,null,{default:a(()=>[m("div",{class:"tips"}," 应用导出，配合导入功能，可用于不同环境下或不同企业下的应用快速迁移和创建 "),m("div",{class:"tips"}," 将应用内的表单、流程、列表、页面、扩展等所有相关文件，以压缩包的形式导出到本地。 ")]),_:1})]),_:1}),e(T,{justify:"center"},{default:a(()=>[e(t,null,{default:a(()=>[e(O,{model:l.value,rules:s,"label-width":"120px"},{default:a(()=>[e(h,{label:"应用名称"},{default:a(()=>[e(L,{modelValue:l.value.appName,"onUpdate:modelValue":y[0]||(y[0]=o=>l.value.appName=o),placeholder:"请输入",disabled:""},null,8,["modelValue"])]),_:1}),e(h,{label:"压缩包名称"},{default:a(()=>[e(L,{modelValue:l.value.exportPackageName,"onUpdate:modelValue":y[1]||(y[1]=o=>l.value.exportPackageName=o),placeholder:"请输入压缩包名称"},null,8,["modelValue"])]),_:1}),e(h,{label:"导出数据"},{default:a(()=>[e(j,{modelValue:l.value.exportFlag,"onUpdate:modelValue":y[2]||(y[2]=o=>l.value.exportFlag=o),disabled:""},{default:a(()=>[e(D,{label:"导出",value:!0}),e(D,{label:"不导出",value:!1})]),_:1},8,["modelValue"])]),_:1}),e(h,{label:"说明"},{default:a(()=>[e(L,{modelValue:l.value.remark,"onUpdate:modelValue":y[3]||(y[3]=o=>l.value.remark=o),type:"textarea",rows:3,maxlength:"200","show-word-limit":"",placeholder:"请输入说明",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const _a=Z(oa,[["__scopeId","data-v-db23bec1"]]);export{da as A,ca as _,ma as a,fa as b,_a as c,Xe as u};

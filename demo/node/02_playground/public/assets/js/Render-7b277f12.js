import{d as E,wA as D,r as p,c as B,g2 as C,y as R,o as S,f as N,i as s,B as c,w_ as U,w$ as M,w as v,k as A,m as $,aD as G,x0 as K,F as W,aN as j,x1 as Y,Y as q,x2 as x,wS as z,U as H,bn as J,jG as L,dW as I,b as O,l as P}from"./index-b80d5ef5.js";import{F as Q}from"./FormItemFieldWrapper-ec4d2a36.js";import{a as X}from"./use-a506f279.js";import{_ as Z}from"./BtnDisplay.vue_vue_type_script_setup_true_lang-cbe1b7c6.js";import"./useValidateError-9f6399dc.js";const ee=E({__name:"Base",props:{field:{},index:{}},setup(V){const d=V,{render:t,checkFileAndGetVal:r,handleSubmit:_,files:k}=X({field:d.field}),y=D(d.field,d.index),f=p(!1),u=p([]),h=()=>{var e,i;const l=r();if(typeof l=="string")return j.error(l);if(u.value=[],d.field.options.params.type===Y.currentFields)u.value=((e=d.field.options.params.fieldIds)==null?void 0:e.map(a=>{var w;const o=q((w=t.matchField(a))==null?void 0:w.field);return o&&(o.fieldId=`${t.entryId}${x}${o.fieldId}`),o}).filter(a=>!!a))??[];else if(d.field.options.params.dynamicFieldId&&(n.value=((i=z({fieldId:d.field.options.params.dynamicFieldId,render:t}))==null?void 0:i.shift())??"",n.value)){T();return}f.value=!0},n=p(""),m=p(!1),F=p(),g=B({get(){var l,e;return((e=((l=y.value)==null?void 0:l.entryId)===n.value?y.value.fieldIds:[])==null?void 0:e.map(i=>{var a;return C(i,((a=F.value)==null?void 0:a.totalFields)??[])?i:null}).filter(i=>!!i))??[]},set(l){y.value={entryId:n.value,fieldIds:[...l]}}}),T=()=>{m.value=!0},b=()=>{u.value=g.value.map(l=>{var i,a;const e=(a=C(l,((i=F.value)==null?void 0:i.totalFields)??[]))==null?void 0:a.field;return e&&(e.fieldId=`${n.value}${x}${e.fieldId}`),e}).filter(l=>!!l),m.value=!1,f.value=!0};return R(f,()=>{k.value,u.value,d.field.fieldId,t.entryId,d.field.options.version}),(l,e)=>{const i=H,a=J;return S(),N(W,null,[s(Z,{field:l.field,onClick:h},null,8,["field"]),s(M,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),files:c(k),file_mode:c(U).design,fields:u.value,fileConfig:{controlId:l.field.fieldId,entityId:c(t).entryId,versionType:l.field.options.version},onFormKeyValue:c(_)},null,8,["modelValue","files","file_mode","fields","fileConfig","onFormKeyValue"]),s(a,{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=o=>m.value=o),title:"选择控件",width:"30%","destroy-on-close":""},{footer:v(()=>[A("span",{class:"dialog-footer"},[s(i,{onClick:e[2]||(e[2]=o=>m.value=!1)},{default:v(()=>[$("取消")]),_:1}),s(i,{type:"primary",onClick:b},{default:v(()=>[$(" 确定 ")]),_:1})])]),default:v(()=>[s(G,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=o=>g.value=o),entryId:n.value,isSelect:"","max-height":400,filter:c(K),multiple:"",ref_key:"fieldTreeRef",ref:F},null,8,["modelValue","entryId","filter"])]),_:1},8,["modelValue"])],64)}}}),te=E({__name:"Render",props:{field:{},index:{}},setup(V){const d=L(),t=B(()=>[I.edit,I.enter,I.preview,I.simple].includes(d==null?void 0:d.mode));return(r,_)=>t.value?(S(),O(Q,{key:0,field:r.field},{default:v(()=>[s(ee,{field:r.field,index:r.index},null,8,["field","index"])]),_:1},8,["field"])):P("",!0)}});export{te as default};

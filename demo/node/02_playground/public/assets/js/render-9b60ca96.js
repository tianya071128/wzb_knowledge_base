import{M as O}from"./ModuleWrapper-dbe018a4.js";import{d as M,v as T,r as C,x as A,y as N,Y as x,o as _,b as g,w as c,k as S,i as r,m as w,aq as R,B as b,C as U,bv as j,a9 as q,aa as H,q as G,ac as P,ds as W,bm as Y,U as F,i5 as E,_ as D,er as J,c as K,l as B,f as Q}from"./index-b80d5ef5.js";import{F as X,c as Z,g as ee,_ as te}from"./index-4ee6cc8a.js";import{u as $}from"./createDesigner-82222fc7.js";import{M as le}from"./ModuleEmpty-f80311b1.js";import{S as oe}from"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import{u as se}from"./useEditState-4239cd64.js";import"./dashboardDesigner-ce3c2e23.js";import"./EditorDraggable-a06dbc71.js";/* empty css                          */import"./enum-baae9292.js";import"./useFieldMaxWidth-d82f063e.js";import"./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js";import"./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js";import"./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js";import"./index-318b68f4.js";import"./AzInputNumber-d6212644.js";import"./el-input-number-c15b1cc7.js";import"./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js";import"./useMultipleVal-904406c1.js";import"./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js";import"./el-dropdown-item-455a6589.js";import"./CardShowFieldItem-fd24f218.js";const ae=M({__name:"Setting",props:{visible:{type:Boolean},moduleItem:{}},emits:["update:visible"],setup(d,{emit:n}){const i=d,l=T(i,"visible",n),o=C(),a=A(),v=$(),t=C(i.moduleItem.options);N(l,()=>{l.value&&(t.value=x(i.moduleItem.options))},{immediate:!0});const I=()=>{if(!t.value.list.length)return E({title:"配置异常",message:"请至少添加一个筛选器",type:"error"}),!1;const s=C(new Map);if(t.value.list.forEach(e=>{const u=Z({pageDesigner:v,data:e,dataSystem:a});u&&s.value.set(e.id,u)}),s.value.size)return E({title:"配置异常",dangerouslyUseHTMLString:!0,type:"error",message:[...s.value].map(([e,u])=>{var p;return`${((p=t.value.list.find(V=>V.id===e))==null?void 0:p.name)??""}：${u}`}).join("<br />")}),!1},h=()=>{var s,e,u;(u=(e=(s=o.value)==null?void 0:s.drawerRef)==null?void 0:e.handleClose)==null||u.call(e)},y=s=>I()===!1?!1:(i.moduleItem.options=x(t.value),!s&&(l.value=!1),!0),z=s=>{if(q(i.moduleItem.options,t.value))return s(!1);H.confirm("您修改了筛选器的配置但没有保存，是否需要筛选器的配置？","配置有修改，是否保存?",{confirmButtonText:"保存",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(e,u,p){e==="confirm"?y(!0)&&(s(!1),p()):e==="cancel"?(s(!1),p()):e==="close"&&(s(!0),p())}})};return(s,e)=>{const u=G,p=P,V=W,L=Y,k=F;return _(),g(j,{modelValue:b(l),"onUpdate:modelValue":e[5]||(e[5]=m=>U(l)?l.value=m:null),"append-to-body":!0,direction:"btt",size:"90%",title:"筛选器设置",class:"page_filter-drawer","before-close":z,ref_key:"azDrawerRef",ref:o,"destroy-on-close":""},{footer:c(()=>[S("span",null,[r(k,{onClick:h},{default:c(()=>[w("取消")]),_:1}),r(k,{type:"primary",onClick:e[4]||(e[4]=m=>y())},{default:c(()=>[w("确认")]),_:1})])]),default:c(()=>[S("div",{class:"page_filter-setting"},[r(L,{class:"label-blod setting-header"},{default:c(()=>[r(p,{label:"标题"},{default:c(()=>[r(R,{modelValue:t.value.label,"onUpdate:modelValue":e[0]||(e[0]=m=>t.value.label=m),style:{width:"250px","margin-right":"10px"},maxlength:"10",isBlurCache:"",placeholder:"请输入标题"},null,8,["modelValue"]),r(u,{modelValue:t.value.showLabel,"onUpdate:modelValue":e[1]||(e[1]=m=>t.value.showLabel=m),label:"显示标题"},null,8,["modelValue"])]),_:1}),r(p,{label:"启用筛选按钮"},{default:c(()=>[r(V,{modelValue:t.value.isBtn,"onUpdate:modelValue":e[2]||(e[2]=m=>t.value.isBtn=m)},null,8,["modelValue"])]),_:1})]),_:1}),S("div",{class:"setting-container"},[r(X,{modelValue:t.value.list,"onUpdate:modelValue":e[3]||(e[3]=m=>t.value.list=m)},null,8,["modelValue"])])])]),_:1},8,["modelValue"])}}});const ne=D(ae,[["__scopeId","data-v-bac74bb2"]]);function ie(d){const n=$(),{getFieldInfo:i}=J();return{filterList:K(()=>d.options.list.map(o=>{const a=[...o.sources??[]].shift(),v=a==null?void 0:a.fieldId,t=v?i(v,{sourceId:a==null?void 0:a.sourceId}):void 0;return{id:o.id,alias:o.name,fieldInfo:t,operate:o.filterOption.operate,valueMap:o.filterOption.valueMap,fieldType:a==null?void 0:a.fieldType,isUserSelectable:o.filterOption.isUserSelectable!==!1}})),handleSearch:(o,a)=>{ee({list:d.options.list,pageDesigner:n,screenValue:a}).forEach((t,I)=>{n.moduleContextCallback({moduleId:I,id:d.moduleId,callback(h){h.handleFilter({id:d.moduleId,list:t,trigger:o})}})})}}}const re=M({__name:"Main",props:{moduleItem:{}},setup(d){const n=d,{filterList:i,handleSearch:f}=ie(n.moduleItem);return(l,o)=>(_(),g(te,{class:"filter_module-main",moduleItem:l.moduleItem},{default:c(()=>[l.moduleItem.options.list.length?(_(),g(oe,{key:0,list:b(i),isSelectOperate:"",isBtn:l.moduleItem.options.isBtn,onSearch:b(f)},null,8,["list","isBtn","onSearch"])):B("",!0),l.moduleItem.options.list.length?B("",!0):(_(),Q("div",{key:1,style:{height:"30px"}},[r(le,{description:"没有配置筛选器"})]))]),_:1},8,["moduleItem"]))}});const ue=D(re,[["__scopeId","data-v-88565255"]]),$e=M({__name:"render",props:{moduleItem:{}},setup(d){const{editVisible:n,isDesignMode:i}=se();return(f,l)=>(_(),g(O,{"module-item":f.moduleItem,onEdit:l[1]||(l[1]=o=>n.value=!0)},{default:c(()=>[b(i)?(_(),g(ne,{key:0,visible:b(n),"onUpdate:visible":l[0]||(l[0]=o=>U(n)?n.value=o:null),moduleItem:f.moduleItem},null,8,["visible","moduleItem"])):B("",!0),r(ue,{moduleItem:f.moduleItem},null,8,["moduleItem"])]),_:1},8,["module-item"]))}});export{$e as default};

import{d8 as $,d as A,r as b,c as L,is as H,bs as J,gj as Z,o as d,f as C,i as r,w as n,m as k,t as S,B as a,gv as ee,b as V,dl as ae,l as x,q as te,_ as I,v as W,k as w,L as le,F as U,g as D,C as T,it as F,N as q,O as G,bn as se,bX as ne,y as O,iu as M,p as N,iv as oe,c1 as ue,av as de,iw as Y,cu as j,d6 as K,ix as ie,iy as re,fA as ce,bp as pe,iz as me,fs as _e,iA as ve,iB as ge,ac as fe,bm as ye,U as Q,bC as be,iC as Ve,e as ke}from"./index-b80d5ef5.js";import{u as Ce}from"./useQueryTab-05fa7456.js";import{a as Re}from"./LoadingData-195d0581.js";import"./useExtractQuery-f96f705c.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";const xe=p=>$.value.request.post(`${$.value.SYSTEMURL}/core/sysmsgreceiveset/save`,p),we=p=>$.value.request.post(`${$.value.SYSTEMURL}/core/sysmsgreceiveset/list`,p),he=A({__name:"ConfigItem",props:{data:{}},setup(p){const e=b(p.data),i=L(()=>[H.memberByOrg]),c=L(()=>J(e.value.msgChannel,Z)),l=async()=>{await xe(e.value)},_=async v=>{v===0?e.value={...e.value,appAdminReceive:0,customReceive:1,selectors:[],sysAdminReceive:0}:e.value={...e.value,appAdminReceive:1,customReceive:1,selectors:[],sysAdminReceive:1},await l()};return(v,o)=>{const m=te;return d(),C("div",null,[r(m,{modelValue:a(e).isSwitch,"onUpdate:modelValue":o[0]||(o[0]=s=>a(e).isSwitch=s),"true-label":0,"false-label":1,disabled:a(e).msgChannel===a(ee).mail,onChange:_},{default:n(()=>[k(S(a(c)),1)]),_:1},8,["modelValue","disabled"]),a(e).isSwitch===0?(d(),C("div",{key:0,class:"checkbox-wrapper"},[r(m,{modelValue:a(e).sysAdminReceive,"onUpdate:modelValue":o[1]||(o[1]=s=>a(e).sysAdminReceive=s),"true-label":0,"false-label":1,onChange:l},{default:n(()=>[k(" 系统管理员 ")]),_:1},8,["modelValue"]),r(m,{modelValue:a(e).appAdminReceive,"onUpdate:modelValue":o[2]||(o[2]=s=>a(e).appAdminReceive=s),"true-label":0,"false-label":1,onChange:l},{default:n(()=>[k(" 应用管理员 ")]),_:1},8,["modelValue"]),r(m,{modelValue:a(e).customReceive,"onUpdate:modelValue":o[3]||(o[3]=s=>a(e).customReceive=s),"true-label":0,"false-label":1,onChange:l},{default:n(()=>[k(" 自定义 ")]),_:1},8,["modelValue"]),a(e).customReceive===0?(d(),V(ae,{key:0,multiple:"",tabs:a(i),modelValue:a(e).selectors,"onUpdate:modelValue":[o[4]||(o[4]=s=>a(e).selectors=s),l]},null,8,["tabs","modelValue"])):x("",!0)])):x("",!0)])}}});const Se=I(he,[["__scopeId","data-v-32f4a52f"]]),Te=A({__name:"index",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(p,{emit:y}){const c=W(p,"modelValue",y),l=b([]),_=async()=>{l.value=await we({msgType:F.system})};return(v,o)=>{const m=q,s=G,g=se;return d(),V(g,{title:"消息设置",modelValue:a(c),"onUpdate:modelValue":o[0]||(o[0]=t=>T(c)?c.value=t:null),width:"600px"},{default:n(()=>[r(s,{class:"tabs"},{default:n(()=>[r(m,{label:"系统消息设置"},{default:n(()=>[w("h4",{style:{"margin-bottom":"4px"}},"通知方式及通知对象"),w("p",{class:"tip"}," 设置系统类消息的接收方以及方式。包含插件执行异常消息、智慧助手执行异常消息、计划任务执行异常消息、对外服务执行异常消息等 "),w("br"),r(le,{load:_},{default:n(()=>[(d(!0),C(U,null,D(a(l),t=>(d(),V(Se,{key:t.id,data:t},null,8,["data"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const Ae=I(Te,[["__scopeId","data-v-3a0c4397"]]),Ie=p=>{const y=b(),{width:e}=ne(y),i=b([]),c=b(!1);function l(o,m){let s=[],g=M("全部")+32+2;for(const t of o){const u=M(t.label)+32+2+12;if(u+g>=m)break;g+=u,s=[...s,t]}i.value=s}const _=L(()=>c.value?p.value:i.value),v=L(()=>i.value.length<p.value.length);return O(()=>[p.value,e.value],()=>l(p.value,e.value),{immediate:!0}),{parentWrapperRef:y,viewData:_,isExpand:c,expandAble:v}},Ee=Ie,$e=A({__name:"ButtonRadioGroup",props:{options:{},load:{type:Function},modelValue:{}},emits:["update:modelValue","change"],setup(p,{emit:y}){const e=p,i=y,c=W(e,"modelValue",i),l=b([]),_=async()=>{e.options?l.value=e.options:e.load?l.value=await e.load():l.value=[]},v=t=>{t!==c.value&&(c.value=t,i("change",t))},{parentWrapperRef:o,viewData:m,isExpand:s,expandAble:g}=Ee(l);return(t,u)=>{const E=de;return d(),C("div",{class:"button_radio-wrapper"},[r(Re,{ref_key:"parentWrapperRef",ref:o,class:"button_radio-group",load:_},{default:n(()=>[w("div",{class:N(["button_radio-item",{"is-active":a(c)===0}]),onClick:u[0]||(u[0]=R=>v(0))}," 全部 ",2),(d(!0),C(U,null,D(a(m),R=>(d(),C("div",{class:N(["button_radio-item",{"is-active":R.value===a(c)}]),key:R.value,onClick:B=>v(R.value)},S(R.label),11,["onClick"]))),128))]),_:1},512),a(g)?(d(),V(E,{key:0,type:"primary",underline:!1,icon:a(s)?a(oe):a(ue),class:"toggle-link",onClick:u[1]||(u[1]=R=>s.value=!a(s))},{default:n(()=>[k(S(a(s)?"收起":"展开"),1)]),_:1},8,["icon"])):x("",!0)])}}});const P=I($e,[["__scopeId","data-v-9bbe9676"]]),Le=A({__name:"MessageList",props:{readState:{type:Boolean,default:void 0}},setup(p){const y=p,e=Y(),i=b(0),c=async()=>await pe(me),l=b(0),_=async()=>{const t=await _e({appId:"",name:"",orgIds:[]});return t==null?void 0:t.map(u=>({label:u.name,value:u.id}))},v=b(),o={id:"lowcode_message",operation:{hideField:!0},request:{api:async t=>(e.getNoReadCount(),await ve({...t,readState:y.readState,messageType:i.value,appId:l.value==0?"":l.value+""}))}},m=b(new Set),s=async t=>{try{m.value.add(t??"all"),t?await e.markMessageRead(t,ge.manual):await e.markAllMessageRead({messageType:i.value,appId:l.value==0?"":l.value+""})}finally{m.value.delete(t??"all")}};function g(){var t;(t=v.value)==null||t.refresh()}return O(()=>e.noticeReadChange,()=>{var t;(t=v.value)==null||t.refresh()}),j(K,()=>{var t;(t=v.value)==null||t.refresh(!0)}),(t,u)=>{const E=fe,R=ye,B=Q,X=be;return d(),V(ce,{ref_key:"azPageRef",ref:v,config:o,style:{padding:"16px 24px"}},{searchTop:n(()=>[r(R,{labelWidth:"86px"},{default:n(()=>[r(E,{label:"消息类型："},{default:n(()=>[r(P,{load:c,modelValue:a(i),"onUpdate:modelValue":u[0]||(u[0]=h=>T(i)?i.value=h:null),onChange:u[1]||(u[1]=()=>{g(),l.value=0})},null,8,["modelValue"])]),_:1}),a(i)==a(F).app_msg?(d(),V(E,{key:0,label:"所属应用："},{default:n(()=>[r(P,{load:_,modelValue:a(l),"onUpdate:modelValue":u[2]||(u[2]=h=>T(l)?l.value=h:null),onChange:g},null,8,["modelValue"])]),_:1})):x("",!0)]),_:1})]),operation:n(()=>[t.readState?x("",!0):(d(),V(B,{key:0,type:"primary",onClick:u[3]||(u[3]=h=>s()),disabled:!a(e).noReadCount,loading:a(m).has("all")},{default:n(()=>[k(" 全部已读 ")]),_:1},8,["disabled","loading"]))]),table:n(({tableData:h})=>[(d(!0),C(U,null,D(h,f=>(d(),V(X,{class:"message_item",key:f.id,shadow:"hover"},{header:n(()=>[w("div",{class:"message-header"},[f.title?(d(),C("span",{key:0,class:"header-title"},S(f.title),1)):x("",!0),w("span",{class:"header-time"},S(f.createTime),1),f.readState?x("",!0):(d(),V(B,{key:1,class:"header-btn",type:"primary",link:"",loading:a(m).has(f.id),onClick:Ue=>s(f.id)},{default:n(()=>[k(" 转为已读 ")]),_:2},1032,["loading","onClick"]))])]),default:n(()=>[r(ie,{readState:f.readState,msg:{content:f.content,link:f.link??"",linkText:f.linkText??"",msgId:f.id}},null,8,["readState","msg"]),f.fileId?(d(),V(re,{key:0,msg:f},null,8,["msg"])):x("",!0)]),_:2},1024))),128))]),_:1},512)}}});const z=I(Le,[["__scopeId","data-v-acdc16dc"]]),Be=A({__name:"routePage",setup(p){const{activeTab:y}=Ce(["0","1"],{queryKey:"type"}),e=b(!1),i=Y(),c=b();return j(K,()=>{var l;(l=c.value)==null||l.scrollIntoView(!1)}),(l,_)=>{const v=Q,o=q,m=G,s=Ve("premission");return d(),C("div",{class:"layout_box message_page"},[w("div",{ref_key:"el",ref:c},[ke((d(),V(v,{class:"message_btn",text:"",type:"primary",onClick:_[0]||(_[0]=g=>e.value=!0)},{default:n(()=>[k(" 消息设置 ")]),_:1})),[[s,"system:message:config"]])],512),r(m,{modelValue:a(y),"onUpdate:modelValue":_[1]||(_[1]=g=>T(y)?y.value=g:null),class:"message_tabs"},{default:n(()=>[r(o,{label:"全部",name:"1",lazy:""},{default:n(()=>[r(z)]),_:1}),r(o,{label:"未读",name:"0",lazy:""},{label:n(()=>[k(" 未读"+S(a(i).noReadCount?`（${a(i).noReadCount}）`:""),1)]),default:n(()=>[r(z,{readState:!1})]),_:1})]),_:1},8,["modelValue"]),r(Ae,{modelValue:a(e),"onUpdate:modelValue":_[2]||(_[2]=g=>T(e)?e.value=g:null)},null,8,["modelValue"])])}}});const We=I(Be,[["__scopeId","data-v-fc415187"]]);export{We as default};

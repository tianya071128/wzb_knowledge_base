import{d as b,eC as $,r as v,o as c,b as y,w as m,f as U,g as k,F as A,B as g,C as w,bt as J,fs as M,ao as T,v as x,y as C,vX as O,a1 as z,a3 as B,a as E,es as L,er as D,i as u,m as V,bm as P,ac as Y,gT as j,U as q,d8 as R}from"./index-b80d5ef5.js";const G=b({__name:"app",props:{appId:{},tenantId:{}},emits:["update:appId","update:tenantId"],setup(f,{emit:i}){const r=f,n=i,{appId:a,tenantId:I}=$(r,n),o=v([]),t=async()=>{const l=await M({appId:"",name:"",orgIds:[]});return o.value=l,l},e=()=>{setTimeout(()=>{const l=o.value.find(s=>s.id===a.value);l&&(I.value=l.tenantId)},300)};return(l,s)=>{const p=T;return c(),y(J,{modelValue:g(a),"onUpdate:modelValue":s[0]||(s[0]=d=>w(a)?a.value=d:null),style:{width:"100%"},filterable:"",load:t,onChange:e},{default:m(({options:d})=>[(c(!0),U(A,null,k(d,_=>(c(),y(p,{key:_.id,label:_.name,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])}}}),X=b({__name:"entry",props:{entryId:{},appId:{}},emits:["update:entryId"],setup(f,{emit:i}){const r=f,a=x(r,"entryId",i),I=v(),o=async()=>{const t=await O({appId:r.appId,isGroup:1,name:""}),e=[z.form];return t.filter(l=>e.includes(l.type))};return C(()=>r.appId,()=>{var t;a.value="",(t=I.value)==null||t.reload()}),(t,e)=>{const l=T;return c(),y(J,{ref_key:"AzSelectRef",ref:I,modelValue:g(a),"onUpdate:modelValue":e[0]||(e[0]=s=>w(a)?a.value=s:null),style:{width:"100%"},filterable:"",load:o},{default:m(({options:s})=>[(c(!0),U(A,null,k(s,p=>(c(),y(l,{key:p.id,label:p.name,value:p.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])}}}),h=b({__name:"org",props:{entryId:{},orgId:{}},emits:["update:orgId"],setup(f,{emit:i}){const r=f,a=x(r,"orgId",i),I=o=>{const t=[E.department,E.departmentSingle];return L(o,t)};return C(()=>r.entryId,()=>{a.value=""}),(o,t)=>(c(),y(B,{modelValue:g(a),"onUpdate:modelValue":t[0]||(t[0]=e=>w(a)?a.value=e:null),"entry-id":o.entryId,filter:I},null,8,["modelValue","entry-id"]))}}),H=b({__name:"member",props:{entryId:{},memberId:{}},emits:["update:memberId"],setup(f,{emit:i}){const r=f,a=x(r,"memberId",i),I=o=>{const t=[E.member,E.memberSingle];return L(o,t)};return C(()=>r.entryId,()=>{a.value=""}),(o,t)=>(c(),y(B,{modelValue:g(a),"onUpdate:modelValue":t[0]||(t[0]=e=>w(a)?a.value=e:null),"entry-id":o.entryId,filter:I},null,8,["modelValue","entry-id"]))}}),Q=b({__name:"test",setup(f){const{getFieldInfo:i}=D(),r=async t=>R.value.request.post(`${R.value.SYSTEMURL}/orgDataRefresh/executionOrgDataRefresh`,t),n=v({tenantId:"",appId:"",entryId:"",orgId:"",memberId:""}),a=v(),I=async()=>{var t,e;try{const{tenantId:l,appId:s,entryId:p,orgId:d,memberId:_}=n.value,F=await((t=i(d,{entryId:p}))==null?void 0:t.field),S=await((e=i(_,{entryId:p}))==null?void 0:e.field);if(F&&S){const N={tenantId:l,appId:s,entryId:p,orgColumnJson:JSON.stringify(F),memberColumnJson:JSON.stringify(S)};await r(N)}}catch{}},o=()=>{n.value={tenantId:"",appId:"",entryId:"",orgId:"",memberId:""}};return v(""),(t,e)=>{const l=Y,s=j,p=q;return c(),U("div",{style:{width:"100%","text-align":"center",padding:"20px",display:"flex","justify-content":"center"}},[u(g(P),{style:{width:"800px"},ref_key:"ElFormRef",ref:a,model:n.value,"label-width":"auto"},{default:m(()=>[u(l,{label:"选择应用"},{default:m(()=>[u(G,{"app-id":n.value.appId,"onUpdate:appId":e[0]||(e[0]=d=>n.value.appId=d),"tenant-id":n.value.tenantId,"onUpdate:tenantId":e[1]||(e[1]=d=>n.value.tenantId=d)},null,8,["app-id","tenant-id"])]),_:1}),u(l,{label:"选择表单"},{default:m(()=>[u(X,{"entry-id":n.value.entryId,"onUpdate:entryId":e[2]||(e[2]=d=>n.value.entryId=d),"app-id":n.value.appId},null,8,["entry-id","app-id"])]),_:1}),u(s,{"content-position":"center"},{default:m(()=>[V("规则配置")]),_:1}),u(l,{label:"选择需要刷新的机构控件"},{default:m(()=>[u(h,{orgId:n.value.orgId,"onUpdate:orgId":e[3]||(e[3]=d=>n.value.orgId=d),"entry-id":n.value.entryId},null,8,["orgId","entry-id"])]),_:1}),u(l,{label:"条件基于成员控件或者创建人"},{default:m(()=>[u(H,{memberId:n.value.memberId,"onUpdate:memberId":e[4]||(e[4]=d=>n.value.memberId=d),"entry-id":n.value.entryId},null,8,["memberId","entry-id"])]),_:1}),u(p,{type:"primary",onClick:I},{default:m(()=>[V("提交")]),_:1}),u(p,{onClick:o},{default:m(()=>[V("重置")]),_:1}),u(s,{"content-position":"center"},{default:m(()=>[V("预览列表")]),_:1})]),_:1},8,["model"])])}}});export{Q as default};

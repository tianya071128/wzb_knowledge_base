import{d as P,v as z,o as m,b as I,w as i,f as k,F as O,g as j,p as ae,B as s,k as g,i as u,bz as te,t as q,bC as B,_ as U,c as A,C as w,m as $,di as le,dj as E,dk as S,j as se,bG as ne,dl as Q,dm as oe,aN as G,av as re,ac as J,r as b,l as T,bu as de,bv as ue,dn as ie,dp as pe,dq as ce,Q as me,bm as _e,a5 as ye,dr as fe,U as H,c3 as be,y as ve,bn as he,aX as M,aZ as ge,b4 as N,bd as De,b6 as Ve,be as Ce}from"./index-b80d5ef5.js";import{u as F}from"./useQueryTab-05fa7456.js";import{a as W,L as Ie}from"./LoadingData-195d0581.js";import{L as Ee}from"./LoadingData-5a6f27a3.js";import{g as Se}from"./dashboardDesigner-ce3c2e23.js";import{D as ke}from"./DesignerTabs-a9795edf.js";import{D as xe}from"./DashboardDesignerWrapper-04981091.js";import{S as Le}from"./SelectDataSourece-70a968c3.js";import"./useExtractQuery-f96f705c.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";/* empty css              */import"./index-0e679d15.js";import"./use-id-d3187131.js";/* empty css              */import"./index-ae93b8ef.js";import"./use-route-c2b2b5be.js";import"./AzLink-d3d666fe.js";import"./el-dropdown-item-455a6589.js";import"./App-5a74fc11.js";import"./el-space-0d01b33a.js";import"./createDesigner-82222fc7.js";import"./enum-baae9292.js";import"./el-collapse-transition-4ed993c7.js";import"./el-input-number-c15b1cc7.js";/* empty css                        */import"./AzTabs.vue_vue_type_style_index_0_lang-d6635a7d.js";import"./TableChart.vue_vue_type_script_setup_true_lang-4c6079d0.js";import"./AzRadioGroup-8d978495.js";import"./enum-dc6240e9.js";import"./useProcessAnalysis-0a0845eb.js";const Re=P({__name:"CardTabs",props:{modelValue:{},tabList:{}},emits:["update:modelValue"],setup(D,{emit:p}){const o=z(D,"modelValue",p);return(d,n)=>{const e=B;return m(),I(e,{class:"tabs-card"},{default:i(()=>[(m(!0),k(O,null,j(d.tabList,a=>(m(),k("div",{key:a.id,class:ae(["tabs-item",{"tabs-active":s(o)===a.id}]),onClick:_=>o.value=a.id},[g("div",{class:"item-header"},[u(te,{"class-name":"item-icon","icon-class":a.icon},null,8,["icon-class"]),g("span",null,q(a.name),1)]),g("div",{class:"item-tip"},q(a.tip),1)],10,["onClick"]))),128))]),_:1})}}});const X=U(Re,[["__scopeId","data-v-c72a12e1"]]),Ae=P({__name:"ExpandSettings",props:{dashboardDesignerDetails:{},entryDetails:{}},setup(D,{expose:p}){const c=A(()=>[]),{activeTab:r}=F(A(()=>c.value.map(o=>o.id)),{queryKey:"expandTab"});return p({async beforeLeave(){}}),(o,d)=>{const n=B,e=le;return m(),k("div",{class:"expand_settings"},[u(X,{modelValue:s(r),"onUpdate:modelValue":d[0]||(d[0]=a=>w(r)?r.value=a:null),"tab-list":c.value},null,8,["modelValue","tab-list"]),g("div",{class:"settings-content"},[u(e,{height:"100%"},{default:i(()=>[u(n,{class:"settings-empty"},{default:i(()=>[$("功能暂未开放，敬请期待...")]),_:1})]),_:1})])])}}});const we=U(Ae,[["__scopeId","data-v-2fdc7e18"]]),Pe=P({__name:"AuthCard",props:{auth:{},entryId:{}},emits:["refresh"],setup(D,{emit:p}){const c=D,r=p,o=A(()=>{var e;return((e=c.auth.memberSelect)==null?void 0:e.selectedList.map(a=>a.id==="-1"?a.type===E.corpCooperation?{id:S.allCooperateEnterprise,type:E.dynamic}:a.type===E.userCooperation?{id:S.allCooperatePersonnel,type:E.dynamic}:a:a))??[]}),d=A(()=>{var e;return(e=c.auth.authRuleVos)==null?void 0:e.find(a=>a.entryId===c.entryId)}),n=async()=>{var e;await oe(((e=d.value)==null?void 0:e.id)??""),G.success("取消关联成功"),r("refresh")};return(e,a)=>{const _=re,v=J,V=B;return m(),I(V,{class:"auth_card"},{header:i(()=>[g("div",{class:"card-header"},[u(se,null,{default:i(()=>[g("b",null,q(e.auth.name),1)]),_:1}),g("div",null,[u(ne,{title:"确定取消关联？",confirm:n},{reference:i(()=>[u(_,{class:"ml-10",underline:!1,type:"primary"},{default:i(()=>[$(" 取消关联 ")]),_:1})]),_:1})])])]),default:i(()=>[u(v,{label:"权限成员",class:"mb-0"},{default:i(()=>[u(Q,{modelValue:s(o),"onUpdate:modelValue":a[0]||(a[0]=y=>w(o)?o.value=y:null),dynamic:[s(S).allCooperateEnterprise,s(S).allCooperatePersonnel],readonly:"",isCooperation:"",class:"auth_selectpane",multiple:"",placeholder:"请选择权限成员",customStrictly:""},null,8,["modelValue","dynamic"])]),_:1})]),_:1})}}});const Te=U(Pe,[["__scopeId","data-v-2b7e878e"]]),$e=P({__name:"AddAuth",props:{modelValue:{type:Boolean},authIds:{},entryDetails:{}},emits:["update:modelValue","refresh"],setup(D,{emit:p}){var L,f;const c=D,r=p,o=z(c,"modelValue",r),d={name:"",description:"",memberSelect:{selectedList:[]},authRuleVos:[{appId:((L=c.entryDetails.appEntryVO)==null?void 0:L.appId)??"",entryId:((f=c.entryDetails.appEntryVO)==null?void 0:f.id)??"",columnAuth:[]}]},n=b({...d}),e=b([]),a=async()=>{const t=await ie();return e.value=t,t},_=b(),v=async()=>{var t;await((t=_.value)==null?void 0:t.validate()),await pe(n.value),G.success("新增成功！"),r("refresh")},V=A({get(){var t,l;return((l=(t=n.value)==null?void 0:t.memberSelect)==null?void 0:l.selectedList.map(h=>h.id==="-1"?h.type===E.corpCooperation?{id:S.allCooperateEnterprise,type:E.dynamic}:h.type===E.userCooperation?{id:S.allCooperatePersonnel,type:E.dynamic}:h:h))??[]},set(t){n.value.memberSelect&&(t!=null&&t.length?n.value.memberSelect.selectedList=t.map(l=>(l==null?void 0:l.id)===S.allCooperateEnterprise?{id:"-1",type:E.corpCooperation}:(l==null?void 0:l.id)===S.allCooperatePersonnel?{id:"-1",type:E.userCooperation}:l)??[]:n.value.memberSelect.selectedList=[])}}),y=t=>{var l;if(t){const h=e.value.find(R=>R.id===t);h&&(n.value={...h,authRuleVos:d.authRuleVos},(l=_.value)==null||l.clearValidate())}else n.value={...d}},C=A(()=>e.value.map(t=>({label:t.name,value:t.id,disabled:c.authIds.includes(t.id??"")})));return(t,l)=>{const h=ce,R=J,Z=me,Y=_e;return m(),I(ue,{modelValue:s(o),"onUpdate:modelValue":l[4]||(l[4]=x=>w(o)?o.value=x:null),title:"新增权限组"},{default:i(()=>[u(Y,{model:s(n),ref_key:"formRef",ref:_,"label-width":"120px"},{default:i(()=>[u(R,{label:"选择已有权限组"},{default:i(()=>[u(Ee,{style:{width:"100%"},load:a,inline:""},{default:i(()=>[u(h,{modelValue:s(n).id,"onUpdate:modelValue":l[0]||(l[0]=x=>s(n).id=x),options:s(C),filterable:"",placeholder:"请选择",onChange:y,clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1}),u(R,{label:"权限组名称",prop:"name",rules:[{required:!0,message:"请输入权限组名称",trigger:"blur"}]},{default:i(()=>[u(Z,{placeholder:"请输入权限组名称",modelValue:s(n).name,"onUpdate:modelValue":l[1]||(l[1]=x=>s(n).name=x),disabled:!!s(n).id},null,8,["modelValue","disabled"])]),_:1}),u(R,{label:"权限成员",prop:"memberSelect"},{default:i(()=>{var x;return[(x=s(n))!=null&&x.memberSelect?(m(),I(Q,{key:0,modelValue:s(V),"onUpdate:modelValue":l[2]||(l[2]=ee=>w(V)?V.value=ee:null),disabled:!!s(n).id,dynamic:[s(S).allCooperateEnterprise,s(S).allCooperatePersonnel],isCooperation:"",class:"auth_selectpane",multiple:"",placeholder:"请选择权限成员",customStrictly:""},null,8,["modelValue","disabled","dynamic"])):T("",!0)]}),_:1})]),_:1},8,["model"]),u(de,{editMode:!0,onClose:l[3]||(l[3]=x=>o.value=!1),"on-submit":v})]),_:1},8,["modelValue"])}}}),Ue=P({__name:"SetAuth",props:{entryDetails:{}},setup(D){const p=D,c=b(),r=b(),o=async()=>{var e,a,_,v;r.value=await fe({appId:((a=(e=p.entryDetails)==null?void 0:e.appEntryVO)==null?void 0:a.appId)??"",entryId:((v=(_=p.entryDetails)==null?void 0:_.appEntryVO)==null?void 0:v.id)??""})},d=b(!1),n=()=>{var e;(e=c.value)==null||e.reload()};return(e,a)=>{var y;const _=H,v=be,V=B;return m(),k("div",{class:"set_auth"},[g("div",{class:"auth_body"},[u(V,{class:"auth_card"},{header:i(()=>[g("div",{class:"card-header"},[u(_,{icon:s(ye),type:"primary",class:"mr-10",onClick:a[0]||(a[0]=C=>d.value=!0)},{default:i(()=>[$(" 添加权限组 ")]),_:1},8,["icon"]),g("span",{class:"flex1"}," 设置组织内的部分成员可使用此表单添加数据，成员登录后可访问 ")])]),default:i(()=>[u(W,{load:o,ref_key:"loadingDataRef",ref:c},{default:i(()=>{var C;return[(C=s(r))!=null&&C.length?(m(),k("div",{key:0,class:"card_list"},[(m(!0),k(O,null,j(s(r),L=>{var f;return m(),I(Te,{key:L.id,auth:L,entryId:((f=e.entryDetails.appEntryVO)==null?void 0:f.id)??"",onRefresh:n},null,8,["auth","entryId"])}),128))])):(m(),I(v,{key:1,description:"暂无权限组"}))]}),_:1},512)]),_:1}),s(d)?(m(),I($e,{key:0,modelValue:s(d),"onUpdate:modelValue":a[1]||(a[1]=C=>w(d)?d.value=C:null),authIds:((y=s(r))==null?void 0:y.map(C=>C.id??""))??[],entryDetails:e.entryDetails,onRefresh:n},null,8,["modelValue","authIds","entryDetails"])):T("",!0)])])}}});const Be=U(Ue,[["__scopeId","data-v-6fde0dbe"]]),Oe=P({__name:"DashboardPublish",props:{dashboardDesignerDetails:{},entryDetails:{}},setup(D){const p=[{id:"auth",name:"权限设置",icon:"auth",tip:"对成员发布设置成员权限"}],{activeTab:c}=F(p.map(r=>r.id),{queryKey:"auth"});return(r,o)=>{const d=B;return m(),k("div",{class:"form_publish"},[u(X,{modelValue:s(c),"onUpdate:modelValue":o[0]||(o[0]=n=>w(c)?c.value=n:null),"tab-list":p},null,8,["modelValue"]),g("div",{class:"publish-content"},[s(c)==="auth"?(m(),I(Be,{key:0,entryDetails:r.entryDetails},null,8,["entryDetails"])):(m(),I(d,{key:1,class:"publish-empty"},{default:i(()=>[$("功能暂未开放，敬请期待...")]),_:1}))])])}}});const qe=U(Oe,[["__scopeId","data-v-c6964316"]]),ze=P({__name:"AddChartDialog",props:{modelValue:{type:Boolean},appId:{}},emits:["update:modelValue"],setup(D,{emit:p}){const o=z(D,"modelValue",p),d=b("");ve(o,()=>d.value="");const n=b(!1),e=async()=>{n.value=!0};return(a,_)=>{const v=H,V=he;return m(),I(V,{modelValue:s(o),"onUpdate:modelValue":_[2]||(_[2]=y=>w(o)?o.value=y:null),title:"创建统计图",width:"500","destroy-on-close":""},{footer:i(()=>[g("span",{class:"dialog-footer"},[u(v,{onClick:_[1]||(_[1]=y=>o.value=!1)},{default:i(()=>[$("取消")]),_:1}),u(v,{type:"primary",onClick:e,disabled:!d.value,loading:n.value},{default:i(()=>[$(" 确定 ")]),_:1},8,["disabled","loading"])])]),default:i(()=>[u(Le,{modelValue:d.value,"onUpdate:modelValue":_[0]||(_[0]=y=>d.value=y),appId:a.appId},null,8,["modelValue","appId"])]),_:1},8,["modelValue"])}}}),K="dashboard_designer_toolbar",Fe=P({__name:"routePage",setup(D){const p=b(),c=A(()=>[{label:"仪表盘设计",name:"dashboard"},{label:"扩展功能",name:"extension"},{label:"仪表盘发布",name:"publish"}]),{activeTab:r}=F(A(()=>c.value.map(f=>f.name)),{queryKey:"dashboardDesignerTab"}),o=M("appId"),d=M("appEntryId"),n=()=>{o?N(De,{replace:!0,query:{appId:o,entryId:d,manager:"1"}}):N(Ve,{replace:!0})},e=b(),a=b(),_=async()=>{if(d){if(p.value=await Ce(d),!p.value.appEntryVO)return Promise.reject({msg:"该仪表盘已被删除或者无权限访问",loadState:Ie.danger});e.value=await Se(d)}},v=f=>{e.value&&(e.value.pageeJson=f)},V=b(),y=b(),C=async()=>{var f,t;return r.value==="dashboard"?await((f=V.value)==null?void 0:f.beforeLeave()):r.value==="extension"?await((t=y.value)==null?void 0:t.beforeLeave()):!0};ge((f,t,l)=>{C().then(()=>{l()}).catch(()=>{l(!1)})});const L=b(!1);return(f,t)=>(m(),k(O,null,[u(ke,{style:{"z-index":"99","box-shadow":"0 0 8px 0 rgba(0, 0, 0, 0.1)"},modelValue:s(r),"onUpdate:modelValue":t[0]||(t[0]=l=>w(r)?r.value=l:null),tabs:c.value,onBack:n,entryDetails:p.value,"onUpdate:entryDetails":t[1]||(t[1]=l=>p.value=l),"before-leave":C},{default:i(()=>[g("div",{id:K})]),_:1},8,["modelValue","tabs","entryDetails"]),u(W,{queryKeys:["appEntryId","appId"],path:n,ref_key:"loadingPageRef",ref:a,class:"dashboard_designer_page",load:_,"element-loading-background":"transparent"},{default:i(()=>{var l;return[e.value&&((l=p.value)!=null&&l.appEntryVO)?(m(),k(O,{key:0},[s(r)==="dashboard"?(m(),k("div",{key:0,class:"designer_page-container"},[u(xe,{ref_key:"dashboardDesignerRef",ref:V,dashboardDesignerDetails:e.value,entryDetails:p.value,teleportTo:`#${K}`,onSaveForm:v,onRefresh:t[2]||(t[2]=h=>{var R;return(R=a.value)==null?void 0:R.reload()})},null,8,["dashboardDesignerDetails","entryDetails","teleportTo"])])):T("",!0),s(r)==="extension"?(m(),I(we,{key:1,ref_key:"expandSettingsRef",ref:y,class:"designer_page-container",dashboardDesignerDetails:e.value,entryDetails:p.value},null,8,["dashboardDesignerDetails","entryDetails"])):T("",!0),s(r)==="publish"?(m(),I(qe,{key:2,dashboardDesignerDetails:e.value,entryDetails:p.value,class:"designer_page-container"},null,8,["dashboardDesignerDetails","entryDetails"])):T("",!0),u(ze,{"app-id":s(o),modelValue:L.value,"onUpdate:modelValue":t[3]||(t[3]=h=>L.value=h)},null,8,["app-id","modelValue"])],64)):T("",!0)]}),_:1},512)],64))}});const va=U(Fe,[["__scopeId","data-v-e9412935"]]);export{va as default};

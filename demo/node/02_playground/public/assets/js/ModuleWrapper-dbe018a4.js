import{d as U,r as D,o as i,b as _,bc as u,B as r,bF as ae,k_ as $,aT as ne,bH as de,U as X,c as m,dw as z,h6 as ue,nm as ie,y as R,bX as re,ld as j,lb as me,f as M,k as H,h,a2 as x,bz as pe,l as I,m as ce,t as ve,p as G,i as b,w as S,F as ye,cH as fe,eu as O,a4 as Ie,ba as ge,eB as he,e3 as be,_ as _e}from"./index-b80d5ef5.js";import{u as V,r as P,s as ke,t as we,v as Ce,w as Me,b as He}from"./createDesigner-82222fc7.js";import{d as Se}from"./dashboardDesigner-ce3c2e23.js";const De=U({__name:"CopyControls",props:{moduleId:{}},setup(p){const y=p,o=V(),c=D(!1),l=async()=>{try{c.value=!0;const s=o.matchModule(y.moduleId);if(s){switch(s==null?void 0:s.module.type){case $.dashboard:case $.detailedChart:case $.processAnalysis:await n(s.module);break;default:o.copyModule(s.module);break}await ne(()=>{c.value=!1})}}catch{c.value=!1}finally{c.value=!1}},n=async s=>{if(s.options.dashboardId){const v=o.createIdByType(s.type),f=await Se.copy({id:s.options.dashboardId,type:"1",moduleId:v}),g=de(s);g.options.dashboardId=f,g.moduleId=v,o.copyModule(g)}else o.copyModule(s)};return(s,v)=>{const f=X;return i(),_(f,{loading:c.value,text:"",onClick:u(l,["stop"]),icon:r(ae),title:"复制",size:"small"},null,8,["loading","onClick","icon"])}}}),Be=p=>{const y=V();return{isHideDis:m(()=>"modules"in p.moduleItem?p.moduleItem.modules.length>=1:!1),handlePcHide:()=>{const n=y.matchModule(p.moduleItem.moduleId);n&&(n.module.layout={...n.module.layout,enable:!1})},handleH5Hide:()=>{const n=y.matchModule(p.moduleItem.moduleId);n&&(n.module.mobile={...n.module.mobile,enable:!1})}}},Ee=U({__name:"ModuleWrapper",props:{moduleItem:{},isEdit:{type:Boolean,default:!0},isMask:{type:Boolean,default:!0}},emits:["edit"],setup(p,{emit:y}){const o=p,c=y,l=V(),{handlePcHide:n,isHideDis:s}=Be(o),v=m(()=>z.design===l.mode),f=m(()=>z.selectDesign===l.mode),g=m(()=>z.preview===l.mode),q=()=>{l.handleHover(o.moduleItem.moduleId,"enter")},J=()=>{l.handleHover(o.moduleItem.moduleId,"leave")},K=()=>{l.setSelected(o.moduleItem.moduleId)},Q=()=>{l.deleteModule(o.moduleItem.moduleId)},Y=m(()=>!("modules"in o.moduleItem)),B=D(0),k=t=>{B.value=B.value+t},Z=ue(),W=ie(Z),E=D(!1),ee=R(W,()=>{W.value&&(E.value=!0),E.value&&ee()},{immediate:!0}),N=D(),{height:te}=re(N),A=m(()=>Math.ceil((te.value+j)/(me+j)));R(A,()=>{setTimeout(()=>{l.moduleLayoutHeightMap.set(o.moduleItem.moduleId,A.value)},100)},{immediate:!0});const T=He(),F=m(()=>{var e,a,d,w;return P(T.title,(a=(e=l.page.pcThemeStyles)==null?void 0:e.overallChart)==null?void 0:a.title,(w=(d=o.moduleItem.options)==null?void 0:d.pcStyles)==null?void 0:w.title).icon}),oe=m(()=>{var t,e,a,d;return ke(P(T.bg,(e=(t=l.page.pcThemeStyles)==null?void 0:t.overallChart)==null?void 0:e.bg,we((d=(a=o.moduleItem.options)==null?void 0:a.pcStyles)==null?void 0:d.bg)))}),le=m(()=>{var t,e,a,d;return Ce(P(T.title,(e=(t=l.page.pcThemeStyles)==null?void 0:t.overallChart)==null?void 0:e.title,Me((d=(a=o.moduleItem.options)==null?void 0:a.pcStyles)==null?void 0:d.title)))});return(t,e)=>{var L;const a=X,d=ge,w=he,se=be;return i(),M("div",{class:G(["module_wrapper",{"module_wrapper-design":v.value||f.value,"module_wrapper-hover":r(l).hoverModuleId===t.moduleItem.moduleId,"module_wrapper-active":r(l).selectedModuleIds.includes(t.moduleItem.moduleId),"module_wrapper-mask":(v.value||g.value||f.value)&&t.isMask,"module_wrapper-son":!!((L=r(l).matchModule(t.moduleItem.moduleId))!=null&&L.parentModule),"module_wrapper-autoH":t.moduleItem.layout.autoH}]),onClick:u(K,["stop"]),onMouseenter:u(q,["stop"]),onMouseleave:u(J,["stop"])},[H("div",{class:"module_wrapper-container",style:x(oe.value),ref_key:"moduleWrapperContainerRef",ref:N},[t.moduleItem.options.showLabel?(i(),M("div",{key:0,class:"module_wrapper-title"},[h(t.$slots,"title",{},()=>[H("div",{class:"module_wrapper-title-left",style:x(le.value)},[H("span",{class:"bold flex0 module_wrapper-title-text"},[F.value?(i(),_(pe,{key:0,"icon-class":F.value},null,8,["icon-class"])):I("",!0),ce(" "+ve(t.moduleItem.options.label),1)]),h(t.$slots,"desc",{},void 0,!0)],4)],!0),h(t.$slots,"top-right",{},void 0,!0)])):I("",!0),H("div",{class:"module_wrapper-content"},[E.value?h(t.$slots,"default",{key:0},void 0,!0):I("",!0)])],4),v.value?(i(),M("div",{key:0,class:G(["module-operate",{"module-operate-show":B.value>0}])},[b(se,null,{default:S(()=>[t.isEdit?(i(),M(ye,{key:0},[b(a,{text:"",onClick:u(r(n),["stop"]),icon:r(fe),title:"隐藏",size:"small"},null,8,["onClick","icon"]),Y.value?(i(),_(De,{key:0,"module-id":t.moduleItem.moduleId},null,8,["module-id"])):I("",!0),t.$slots.edit?(i(),_(d,{key:2,placement:"bottom",trigger:"click",width:"auto",onShow:e[2]||(e[2]=C=>k(1)),onHide:e[3]||(e[3]=C=>k(-1))},{reference:S(()=>[b(a,{onClick:e[1]||(e[1]=u(()=>{},["stop"])),text:"",icon:r(O),title:"编辑",size:"small"},null,8,["icon"])]),default:S(()=>[h(t.$slots,"edit",{},void 0,!0)]),_:3})):(i(),_(a,{key:1,text:"",onClick:e[0]||(e[0]=u(C=>c("edit"),["stop"])),icon:r(O),title:"编辑",size:"small"},null,8,["icon"]))],64)):I("",!0),b(w,{title:"确定删除？","confirm-button-type":"danger","confirm-button-text":"删除",onClick:e[5]||(e[5]=u(()=>{},["stop"])),onConfirm:u(Q,["stop"]),onShow:e[6]||(e[6]=C=>k(1)),onHide:e[7]||(e[7]=C=>k(-1))},{reference:S(()=>[b(a,{text:"",onClick:e[4]||(e[4]=u(()=>{},["stop"])),type:"danger",icon:r(Ie),title:"删除",size:"small"},null,8,["icon"])]),_:1},8,["onConfirm"])]),_:3})],2)):I("",!0)],42,["onClick","onMouseenter","onMouseleave"])}}});const Pe=_e(Ee,[["__scopeId","data-v-82e349b0"]]);export{Pe as M};

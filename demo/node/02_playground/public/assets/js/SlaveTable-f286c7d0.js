import{d as Y,AH as ee,r as u,c as _,dV as F,oy as ae,ov as o,Z as le,y as te,aT as se,o as t,f as i,k as r,i as m,w as R,p as D,B as l,e as ie,F as L,g as B,l as p,t as P,b as T,bc as ne,dA as de,ex as oe,ew as re,e1 as ce,aR as ue,b2 as ve,ou as fe,xe as _e,ka as me,o0 as A,q as pe,P as be,s as he,_ as ke}from"./index-b80d5ef5.js";import{R as ge}from"./Resize-eb80395d.js";const ye=Y({__name:"SlaveTable",setup(Ie){const{render:e,listFields:U,tableMode:z,getColumnLabel:M,hasCheck:H,switchCheck:O}=ee(),v=u(!1),S=u(!1),Z=_(()=>!v.value&&!b.value&&!e.tableData.length),b=u(!1),j=_(()=>v.value||S.value||b.value),h=u(0),C=u(50);let y=0;const V=u(0),G=_(()=>({sourceId:e.sourceId,params:{...e.getSearchParams(),limit:C.value},disableRequest:e.disabledLoad||e.disabledLoadPlus,mode:"list"})),x=async()=>{v.value=!0,b.value=!1;const a=h.value+1,s=++y;try{const n=await _e(G,a,C.value);if(s!==y)return;V.value=me(+n.total)?+n.total:0,h.value=a,S.value=h.value*C.value>=V.value,e.tableData=h.value===1?n.records??[]:[...e.tableData,...n.records??[]]}catch{if(s!==y)return;b.value=!0}finally{s===y&&(v.value=!1)}},J=_(()=>e.tableData.map(a=>({...a,__id__:F(a)}))),$=async()=>{e.refreshSingle({data:e.detailsItem})},K=A(x,300),Q=A($,300);e.on(ae,({mode:a})=>{if(a===o.readStatus)return $();a&&[o.add,o.import,o.quickScreen,o.statisticsScreen,o.delete].includes(a)&&(e.dataDetails=null,e.detailsItem=null),a&&o.batchDelete&&e.selectItems.some(s=>F(s)===c.value)&&(e.dataDetails=null,e.detailsItem=null),a&&[o.edit,o.componentOperating,o.editSelfOperating].includes(a)?Q():(e.tableData=[],v.value=!0,h.value=0,K())});const c=_(()=>e.detailsItem?F(e.detailsItem):""),W=a=>{a.__id__!==c.value&&(e.detailsItem=a)},w=u(),E=`id${le()}`;te([()=>[...e.tableData],c],(a,s)=>{se(()=>{var n,I;if(!c.value&&e.tableData.length&&(e.detailsItem=e.tableData[0]),!((n=s[0])!=null&&n.length)&&c.value&&e.tableData.length){const k=(I=w.value)==null?void 0:I.querySelector(`#${E}_${c.value.replaceAll(".","_")}`);k==null||k.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}})});const q=_({get(){return e.unreadFlag},set(a){e.unreadFlag=a,e.runSearch({isReset:!0,mode:o.quickScreen})}});return(a,s)=>{const n=pe,I=be,k=he;return t(),i("div",{class:"slave_table-wrapper"},[r("div",{class:"slave_table"},[m(ge,{style:{height:"100%"},options:{id:`slave-table-${l(e).view.id}`,init:220,max:300,min:200}},{default:R(()=>[r("div",{class:D(["slave-left-wrapper",{"is-readstatus":l(e).isReadStatus===0}])},[r("div",{class:"slave-header"},[m(n,{modelValue:q.value,"onUpdate:modelValue":s[0]||(s[0]=d=>q.value=d),label:"只看未读"},null,8,["modelValue"])]),ie((t(),i("div",{class:"slave-left",ref_key:"slaveTableLeftRef",ref:w,"infinite-scroll-distance":50,"infinite-scroll-disabled":j.value},[(t(!0),i(L,null,B(J.value,(d,N)=>(t(),i("div",{class:D(["slave-left-item",[l(e).isStriped&&N%2!==0&&"is-striped",`slave-size-${l(z)}`,d.__id__===c.value&&"is-active",l(e).isReadStatus===0&&"is-read"]]),key:d.__id__,id:`${E}_${d.__id__.replaceAll(".","_")}`,onClick:f=>W(d)},[(t(!0),i(L,null,B(l(U),(f,g)=>(t(),i("div",{class:D(["slave-left-content",[g===0&&"is-header"]]),key:g},[g===0&&l(e).hasUnread(d)?(t(),i("div",{key:0,class:"slave-read"})):p("",!0),g===0&&(l(e).isNumber||l(e).isCheckbox)?(t(),i("div",{key:1,style:{"margin-right":"5px",display:"flex"}},[l(e).isNumber?(t(),i("span",{key:0,style:{"margin-right":"3px"}},P(N+1)+". ",1)):p("",!0),l(e).isCheckbox?(t(),T(n,{key:1,onClick:s[1]||(s[1]=ne(()=>{},["stop"])),style:{height:"initial"},"model-value":l(H)(d),"onUpdate:modelValue":X=>l(O)(d,X),label:""},null,8,["model-value","onUpdate:modelValue"])):p("",!0)])):p("",!0),g!==0?(t(),i(L,{key:2},[m(de,{class:"content-label","field-id":f.fieldId,sourceId:l(e).sourceId,icon:!1},{default:R(()=>[r("span",null,P(l(M)(f)),1)]),_:2},1032,["field-id","sourceId"]),r("span",{class:"content-separation"},"：")],64)):p("",!0),r("div",{class:"content-wrapper"},[l(e).matchField(f.fieldId)?(t(),T(oe,{key:0,emptyText:"-",mode:l(re).list,content:l(ce)({fieldId:f.fieldId,rowData:d}),field:l(e).matchField(f.fieldId).field,bubble:""},null,8,["mode","content","field"])):p("",!0)])],2))),128))],10,["id","onClick"]))),128)),v.value?(t(),i("div",{key:0,class:"slave-left-loading"},[m(I,{class:"is-loading"},{default:R(()=>[m(l(ue))]),_:1}),r("span",{style:{"margin-left":"5px"}},"加载中")])):b.value?(t(),i("div",{key:1,class:"slave-left-error",onClick:s[2]||(s[2]=d=>x())}," 数据加载异常, 点击重新加载 ")):S.value&&!Z.value?(t(),i("div",{key:2,class:"slave-left-finished"}," 没有更多了 ")):(t(),T(ve,{key:3}))],8,["infinite-scroll-disabled"])),[[k,x]])],2)]),_:1},8,["options"]),r("div",{class:"slave-right"},[m(fe,{oneHideTab:""})])])])}}});const xe=ke(ye,[["__scopeId","data-v-a44aa759"]]);export{xe as default};

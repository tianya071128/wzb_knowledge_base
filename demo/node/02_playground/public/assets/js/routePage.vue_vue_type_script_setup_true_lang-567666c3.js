import{d as j,aV as X,c as _,v as Y,r as B,gk as Z,o as l,b as x,w as c,i as g,f as u,F as d,g as q,B as f,lx as b,ly as N,m as p,k as w,t as y,bs as G,gj as ee,l as U,fV as te,C as ae,bv as ne,lz as H,av as le,ba as se,bT as oe,bU as re,_ as ue,eP as ie,bi as pe,g7 as ce}from"./index-b80d5ef5.js";import{_ as de}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import{u as ge}from"./utils-a7200637.js";const fe=j({__name:"LogDetail",props:{visible:{type:Boolean},id:{},config:{},utils:{}},emits:["update:visible"],setup(C,{emit:D}){const m=C,E=D,V=X(),$=_(()=>{var n;return(n=m.config.table)==null?void 0:n.tableCols.filter(a=>a.prop!=="operation")}),v=Y(m,"visible",E),s=B(),L=async()=>{const n=await H.getLogById(m.id);s.value=n},I=_(()=>{var n,a,o;return((o=(a=(n=s.value)==null?void 0:n.executeAction)==null?void 0:a[0])==null?void 0:o.entryId)??V.query.appEntryId}),{dynamicOptions:A}=ge(_(()=>({entryId:I.value}))),t=_(()=>n=>n.map(o=>{const{label:T}=Z({type:o.type,id:o.id,dynamicOptions:A.value});return T.value??"-"}).join("、")),e=_(()=>{var a,o;const n=JSON.parse(((a=s.value)==null?void 0:a.extendJson)??"{}");return JSON.parse(n.aggregateJson??"{}"),`【${n.aggregateName??"-"}】输出到 【${(o=s.value)==null?void 0:o.fromName}】`});return(n,a)=>{const o=le,T=se,h=oe,K=re;return l(),x(ne,{modelValue:f(v),"onUpdate:modelValue":a[0]||(a[0]=i=>ae(v)?v.value=i:null),title:"日志详情","show-load":L,size:"800"},{default:c(()=>[g(K,{class:"margin-top",column:2,border:""},{default:c(()=>[(l(!0),u(d,null,q($.value,(i,Q)=>(l(),u(d,{key:Q},[i.prop==="executeAction"?(l(),x(h,{key:0,label:i.label},{default:c(()=>{var r,R,O;return[((r=s.value)==null?void 0:r.type)===f(b).form?(l(!0),u(d,{key:0},q((R=s.value)==null?void 0:R.executeAction,(k,W)=>{var P,z;return l(),u("div",{key:W},[k.taskType===f(N).message?(l(),u(d,{key:0},[p(" 发送 "),(l(!0),u(d,null,q((P=k.msgExpressions)==null?void 0:P.msgBase,(F,J)=>(l(),x(T,{title:F.title,width:300,trigger:"hover",content:F.rawContent,key:J},{reference:c(()=>{var M,S;return[w("span",null,[g(o,{type:"primary",underline:!1},{default:c(()=>[p(y(`【${f(G)(F.channel,f(ee))}】`),1)]),_:2},1024),J+1!=(((S=(M=k.msgExpressions)==null?void 0:M.msgBase)==null?void 0:S.length)??0)?(l(),u("span",{key:0}," , ")):U("",!0)])]}),default:c(()=>[g(te,{modelValue:F.rawContent,preview:"",group:[{id:"field",title:"当前表单控件",fieldOptions:{entryId:I.value}},{id:"msg",title:"模板关键字",dictOptions:{dictKey:"msg_template_keyword"}}]},null,8,["modelValue","group"])]),_:2},1032,["title","content"]))),128)),p(" 给 "+y(t.value(((z=k.msgExpressions)==null?void 0:z.selectors)??[])),1)],64)):k.taskType===f(N).components?(l(),u(d,{key:1},[p(" 执行内部组件 ")],64)):(l(),u(d,{key:2},[p(y(n.utils.getTaskDesc(k)),1)],64))])}),128)):((O=s.value)==null?void 0:O.type)===f(b).aggregate?(l(),u(d,{key:1},[p(y(e.value),1)],64)):U("",!0)]}),_:2},1032,["label"])):i.prop==="executeCondition"?(l(),x(h,{key:1,label:i.label},{default:c(()=>{var r;return[p(y(((r=s.value)==null?void 0:r.type)===f(b).form?`【${s.value.fromName}】`:"")+" 满足指定条件时 ",1)]}),_:2},1032,["label"])):i.prop==="duration"?(l(),x(h,{key:2,label:i.label},{default:c(()=>{var r;return[p(y(n.utils.formatDuration((r=s.value)==null?void 0:r.duration)),1)]}),_:2},1032,["label"])):(l(),x(h,{key:3,label:i.label},{default:c(()=>{var r;return[p(y(((r=s.value)==null?void 0:r[i.prop])||"-"),1)]}),_:2},1032,["label"]))],64))),128))]),_:1}),w("br")]),_:1},8,["modelValue"])}}});const me=ue(fe,[["__scopeId","data-v-7be512dd"]]),ve=j({__name:"routePage",props:{planId:{}},setup(C){const D=C,m=B(!1),E=B(),V=B(""),$=_(()=>function(t){if(t.type===b.aggregate)return`【${JSON.parse(t.extendJson??"{}").aggregateName??"-"}】输出到 【${t.fromName}】`;if(t.type===b.form)return I(t.executeAction[0]);if(t.type===b.dataFactory)return"执行 数据流"}),v=_(()=>{const t={type:"input",label:"计划任务",prop:"planTaskName"},e={type:"timerange",label:"执行时间",prop:["startTime","endTime"]},n={type:"select",label:"执行结果",prop:"reqResult",options:"log_result_type"};return{id:"lowcode_plan_log",query:{list:D.planId?[e,n]:[t,e,n]},request:{api:H.getLog,extraParams:{planTaskId:D.planId??""}},table:{tableCols:[{prop:"planTaskName",label:"计划任务"},{prop:"executeCondition",label:"执行条件",slots:{default({row:a}){return g("span",null,[a.type===b.form&&`【${a.fromName}】`,p("满足指定条件时")])}}},{prop:"executeAction",label:"执行动作",slots:{default({row:a}){return g("span",null,[$.value(a)])}}},{prop:"startTime",label:"执行时间"},{prop:"duration",label:"执行时长",slots:{default({row:a}){return g("span",null,[A(a.duration)])}}},{prop:"reqResultName",label:"执行结果"},{prop:"failReason",label:"失败原因"},{fixed:"right",width:100,prop:"operation",label:"操作",slots:{default({row:a}){const T=[{type:"primary",onClick:()=>{V.value=a.id,m.value=!0},text:"查看详情"}];return g(de,{num:3,rowId:a.id,list:T},null)}}}]},operation:{fullEl:E}}}),s=t=>G(t,ce),{getFormHtmlName:L}=ie(),I=t=>{var e,n,a;return t.taskType==N.plugin?`执行 ${(e=t.pluginTask)==null?void 0:e.name}`:t.taskType===N.components?"执行内部组件":t.taskType==N.data?`${s(((n=t==null?void 0:t.excuteAction)==null?void 0:n.executeType)??"").slice(0,-2)} 【${L(((a=t==null?void 0:t.excuteAction)==null?void 0:a.entryId)??"")}】 的数据`:""},A=t=>{const e=Number(t)??0;return e===0?e+"":e<1e3?e+"毫秒":e<6e4?(e/1e3).toFixed(2)+"秒":e<36e5?Math.floor(e/1e3/60)+"分"+((e%6e4/1e3).toFixed(2)?(e%6e4/1e3).toFixed(0)+"秒":""):e<36e5*24?Math.floor(e/1e3/60/60)+"时"+(e%36e5?(e%36e5/6e4).toFixed(0)+"分":""):Math.floor(e/1e3/60/60/24)+"天"+(e%(36e5*24)?(e%(36e5*24)/36e5).toFixed(0)+"时":"")};return(t,e)=>{const n=pe("az-page");return l(),u(d,null,[w("div",{class:"layout_box",ref_key:"pendingRef",ref:E},[g(n,{ref:"azPageRef",config:v.value},null,8,["config"])],512),g(me,{visible:m.value,"onUpdate:visible":e[0]||(e[0]=a=>m.value=a),id:V.value,config:v.value,utils:{getTaskDesc:I,formatDuration:A}},null,8,["visible","id","config","utils"])],64)}}});export{ve as _};

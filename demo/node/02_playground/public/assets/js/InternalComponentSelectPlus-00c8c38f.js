import{d as N,c as B,n as E,r as S,bp as q,da as J,y as O,o as s,f as _,i as p,B as w,J as Q,w as f,k as v,F as L,g as z,p as T,t as G,b as V,bz as H,l as b,b2 as K,L as A,df as M,Q as F,P as W,_ as x,x as R,j as U,md as j,bD as X,m as P,a4 as Y,me as Z,a$ as ee,mf as te,aT as ne,$ as le,mg as ae,h as oe,h7 as se,e as ie,S as ce,U as ue,bn as de}from"./index-b80d5ef5.js";import{a as re}from"./ComponentParamsSetWrapper-71afc840.js";import{d as pe}from"./default-component-4c80201b.js";const me=N({__name:"SelectComponentPane",props:{modelValue:{},scenario:{},multiple:{type:Boolean}},emits:["update:modelValue"],setup(h,{emit:D}){const l=h,y=D,i=B({get(){return E(l.modelValue)},set(e){const t=l.multiple?e:e[0]??"";y("update:modelValue",t)}}),m=S(),c=S(""),a=B(()=>{const e=q(J).filter(t=>!l.scenario||t.value===l.scenario);return[{label:"全部",value:""},...e]}),r=S(""),g=S([]),C=B(()=>g.value.filter(e=>{var t,u,k,o;return(!c.value.trim()||((t=e.name)==null?void 0:t.includes(c.value.trim()))||((u=e.refer)==null?void 0:u.includes(c.value.trim())))&&(!l.scenario||!e.useScene||((k=e.useScene)==null?void 0:k.split(",").includes(l.scenario)))&&(!r.value||((o=e.useScene)==null?void 0:o.split(",").includes(r.value)))})),I=async()=>{const e=await M({name:"",status:1,current:1,limit:3e3});g.value=e.records??[]};O(()=>l.scenario,()=>{var e;return(e=m.value)==null?void 0:e.reload()});const n=e=>{if(!e.id)return;let t=new Set([...i.value]);t.has(e.id)?t.delete(e.id):l.multiple?t.add(e.id):t=new Set([e.id]),i.value=[...t]};return(e,t)=>{const u=F,k=W;return s(),_("div",{class:"component_pane"},[p(u,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=o=>c.value=o),class:"component_pane--input","prefix-icon":w(Q),clearable:"",placeholder:"输入组件名称、描述进行搜索"},null,8,["modelValue","prefix-icon"]),p(A,{load:I,ref_key:"componentLoadingDataRef",ref:m,class:"component_pane-loading"},{default:f(()=>{var o;return[v("div",{class:"component_pane-content"},[v("div",{class:"content-left"},[(s(!0),_(L,null,z(a.value,(d,$)=>(s(),_("div",{class:T(["content-left-item",{selected:r.value===d.value}]),key:$,title:d.label,onClick:ge=>r.value=d.value},[v("span",{class:"az-ellipsis"},G(d.label),1)],10,["title","onClick"]))),128))]),v("div",{class:"az-flex-width content-right"},[(s(!0),_(L,null,z(C.value,d=>(s(),_("div",{class:"component-item",key:d.id,onClick:$=>n(d)},[p(re,{class:T({"component-select":d.id&&i.value.includes(d.id)}),"component-info":d},null,8,["class","component-info"]),d.id&&i.value.includes(d.id)?(s(),V(k,{key:0,class:"choose-icon"},{default:f(()=>[p(H,{"icon-class":"check_icon"})]),_:1})):b("",!0)],8,["onClick"]))),128)),(o=C.value)!=null&&o.length?b("",!0):(s(),V(K,{key:0,class:"w100",description:c.value?"搜索无组件":"暂无组件","image-size":60},null,8,["description"]))])])]}),_:1},512)])}}});const ve=x(me,[["__scopeId","data-v-265dc55b"]]),_e=N({__name:"SelectComponentDisplay",props:{componentId:{},scenario:{},isDelete:{type:Boolean},isEdit:{type:Boolean}},emits:["delete","edit"],setup(h,{emit:D}){const l=h,y=D,i=R(),m=S(),c=async()=>{const a=await i.getComponentData(l.componentId);if(a===null||!Z({scenario:l.scenario,componentInfo:a}))return Promise.reject({msg:"该组件已删除/不可使用!",loadState:ee.danger});m.value=a};return(a,r)=>(s(),V(A,{load:c,class:"select_component--display"},{default:f(()=>{var g,C;return[v("img",{class:"components-icon",src:m.value.icon||w(pe),alt:""},null,8,["src"]),v("div",{class:"components-other"},[v("div",{class:"other-header"},[v("div",{class:"components-name"},[p(U,{style:{width:"100%","vertical-align":"bottom"},content:`${(g=m.value)==null?void 0:g.name}`},null,8,["content"])]),v("div",{class:"components-operate"},[a.isEdit?(s(),V(j,{key:0,icon:w(X),type:"primary",text:"",size:"small",onClick:r[0]||(r[0]=I=>y("edit"))},{default:f(()=>[P(" 编辑 ")]),_:1},8,["icon"])):b("",!0),a.isEdit&&a.isDelete?(s(),_("div",{key:1,class:"operate-line"})):b("",!0),a.isDelete?(s(),V(j,{key:2,icon:w(Y),type:"danger",text:"",size:"small",onClick:r[1]||(r[1]=I=>y("delete"))},{default:f(()=>[P(" 删除 ")]),_:1},8,["icon"])):b("",!0)])]),(C=m.value)!=null&&C.refer?(s(),V(U,{key:0,class:"components-remark",content:m.value.refer},null,8,["content"])):b("",!0)])]}),_:1}))}});const fe=x(_e,[["__scopeId","data-v-beac5437"]]),ye=N({__name:"InternalComponentSelectPlus",props:{modelValue:{},multiple:{type:Boolean,default:!1},required:{type:Boolean,default:!0},scenario:{},btnConfig:{default(){return{name:"选择组件",icon:"CirclePlus",type:te.primary}}},isDelete:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","change","edit"],setup(h,{emit:D}){const l=h,y=D,i=B({get(){return E(l.modelValue)},set(n){const e=l.multiple?n:n[0]??"",t=new Set(i.value);(t.size!==n.length||n.some(u=>!t.has(u)))&&ne(()=>{y("change",e)}),y("update:modelValue",e)}}),m=R(),c=S(!1),a=S(),r=()=>{a.value=l.modelValue,c.value=!0},g=()=>{i.value=E(a.value),c.value=!1},{addRule:C}=le();C({validator(n,e,t){Promise.all(i.value.map(u=>ae({dataSystem:m,componentId:u,scenario:l.scenario}))).then(()=>t()).catch(u=>typeof u=="string"?t(new Error(u)):t())},trigger:"change"});const I=n=>{const e=[...i.value];e.splice(n,1),i.value=e};return(n,e)=>{const t=F,u=ue,k=de;return s(),_("div",{class:"select_component"},[oe(n.$slots,"btn",{handleClick:r},()=>[p(se,{class:"select_component-btn","model-value":n.btnConfig,preview:"",onClick:r},null,8,["model-value"])],!0),ie(p(t,{"model-value":JSON.stringify(i.value)},null,8,["model-value"]),[[ce,!1]]),i.value.length?(s(),_("div",{key:0,class:"select_component--display"},[(s(!0),_(L,null,z(i.value,(o,d)=>(s(),V(fe,{key:o,class:"display-item",onDelete:$=>I(d),onEdit:$=>y("edit",o),componentId:o,scenario:n.scenario,"is-edit":n.isEdit,"is-delete":n.isDelete},null,8,["onDelete","onEdit","componentId","scenario","is-edit","is-delete"]))),128))])):b("",!0),p(k,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=o=>c.value=o),"destroy-on-close":"",title:"选择组件",width:"840","append-to-body":""},{footer:f(()=>[v("span",{class:"dialog-footer"},[p(u,{onClick:e[1]||(e[1]=o=>c.value=!1)},{default:f(()=>[P("取消")]),_:1}),p(u,{type:"primary",onClick:g,disabled:n.required&&!w(E)(a.value).length},{default:f(()=>[P(" 确定 ")]),_:1},8,["disabled"])])]),default:f(()=>[p(ve,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value=o),scenario:n.scenario,multiple:n.multiple},null,8,["modelValue","scenario","multiple"])]),_:1},8,["modelValue"])])}}});const be=x(ye,[["__scopeId","data-v-5c136fbf"]]);export{be as I};

import{d as N,gc as j,v as R,c as T,r as i,x as F,y as L,iI as O,o as f,f as k,i as s,w as u,k as b,p as U,b as S,B as $,eu as z,l as K,L as M,j as Q,I as q,e as G,S as H,m as h,F as J,ms as W,a$ as X,n as A,V as Y,P as Z,U as ee,Q as ae,bn as le,_ as ne}from"./index-b80d5ef5.js";import{S as te}from"./ParamsSetWrapper.vue_vue_type_script_setup_true_lang-c3f6631f.js";const oe=N({inheritAttrs:!1,__name:"PluginSelect",props:{modelValue:{},scenario:{default:j.All},prop:{default(){return{pluginId:"pluginId",tenantApiId:"tenantApiId"}}}},emits:["update:modelValue","change"],setup(D,{emit:w}){const l=D,_=w,I=R(l,"modelValue",_),t=T(()=>{var e;return((e=l.modelValue)==null?void 0:e[l.prop.pluginId])??""}),y=i(),P=i(""),x=F(),C=async()=>{var a;if(!t.value)return;const e=await x.getPluginData(t.value);if(e===null||!W({pluginInfo:e,scenario:l.scenario}))return c.value=!0,Promise.reject({msg:"插件不可使用，请重新选择!",loadState:X.danger});c.value=!1,P.value=((a=e.apiVO)==null?void 0:a.name)??""};L(t,()=>{var e,a;(a=(e=y.value)==null?void 0:e.reload)==null||a.call(e)});const d=i(!1),V=i(),r=i(""),B=()=>{r.value=t.value??"",d.value=!0},E=()=>{const e=A(l.modelValue),a=A(r.value).map(p=>{var m;const o=e.find(n=>n==null?void 0:n[l.prop.pluginId])??{},g=(m=V.value)==null?void 0:m.getPluginInfoById(p);for(const[n,v]of Object.entries(l.prop))switch(n){case"pluginId":o[v]=p;break;case"tenantApiId":o[v]=g?g.tenantApiId??"":o[v]??"";break}return o});I.value={...Y(l.modelValue)?l.modelValue:{},...a[0]??{[l.prop.pluginId]:"",[l.prop.tenantApiId]:""}},d.value=!1,_("change",I.value)},c=i(!1);return O(c,"插件不可使用，请重新选择!"),(e,a)=>{const p=Z,o=ee,g=ae,m=le;return f(),k(J,null,[s(o,q({class:"select_plugin",type:c.value?"danger":t.value?"primary":void 0,plain:"",onClick:B},e.$attrs),{default:u(()=>[b("div",{class:U(["select_plugin-content",{"is-selected":t.value}])},[t.value?(f(),S(p,{key:0,style:{"margin-right":"6px"}},{default:u(()=>[s($(z))]),_:1})):K("",!0),s(M,{ref_key:"loadingDataRef",ref:y,load:C,loadingText:"加载插件信息中...",inline:"",class:"select_plugin-loading"},{default:u(()=>[t.value?(f(),S(Q,{key:0,content:P.value,style:{display:"block"}},null,8,["content"])):(f(),k("span",{key:1},"选择插件"))]),_:1},512)],2)]),_:1},16,["type"]),G(s(g,{"model-value":t.value},null,8,["model-value"]),[[H,!1]]),s(m,{modelValue:d.value,"onUpdate:modelValue":a[2]||(a[2]=n=>d.value=n),title:"选择插件",width:"600","append-to-body":"","destroy-on-close":""},{footer:u(()=>[b("span",{class:"dialog-footer"},[s(o,{onClick:a[1]||(a[1]=n=>d.value=!1)},{default:u(()=>[h("取消")]),_:1}),s(o,{type:"primary",onClick:E,disabled:!r.value},{default:u(()=>[h(" 确定 ")]),_:1},8,["disabled"])])]),default:u(()=>[s(te,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=n=>r.value=n),scenario:e.scenario,ref_key:"selectPluginPaneRef",ref:V},null,8,["modelValue","scenario"])]),_:1},8,["modelValue"])],64)}}});const de=ne(oe,[["__scopeId","data-v-d5f9ab1a"]]);export{de as P};

import{r as f,c as Q,i as o,aN as E,d as O,v as $,o as _,b as F,w as s,B as e,bt as P,f as q,F as z,g as A,m as B,bu as Y,C as M,bv as W,ac as j,ao as G,Q as H,U as S,bm as J,_ as K,bi as X,k as Z,a5 as ee,l as ae}from"./index-b80d5ef5.js";import{_ as te}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import{s as le,d as oe,c as se,g as L,a as re,e as ne}from"./dataConnection-4b645f76.js";import{d as de,a as h}from"./encryption-40d88f62.js";var V=(p=>(p.add="add",p.edit="edit",p))(V||{});const ie={add:{title:"新增数据库连接"},edit:{title:"编辑数据库连接"}},ue=()=>{const p=f(),x=f(),i=f(!1),b=f(""),g=f(V.add),m=()=>{var d;(d=x.value)==null||d.refresh()},w=(d,u)=>{i.value=!0,g.value=d,b.value=u??""},a=()=>{},C=()=>{};return{config:Q(()=>({query:{list:[{type:"input",label:"名称",prop:"titleName"},{type:"select",label:"类型",prop:"dbType",options:[{label:"MYSQL",value:"MYSQL"}],extraOptions:[{label:"全部",value:""}]}]},request:{api:u=>le(u)},table:{tableCols:[{prop:"titleName",label:"名称",showOverflowTooltip:!0},{prop:"dbType",label:"类型",showOverflowTooltip:!0},{prop:"username",label:"创建人",showOverflowTooltip:!0},{prop:"createTime",label:"创建时间",minWidth:110,showOverflowTooltip:!0},{fixed:"right",width:200,label:"操作",slots:{default({row:u}){const r=[{type:"primary",onClick:()=>{w(V.edit,u.id)},text:"编辑"},{type:"danger",text:"删除",popconfirmProps:{title:"您确定要删除该连接吗?",confirm:async()=>{await oe(u.id),E.success("删除成功"),m()}}}];return o(te,{num:2,rowId:u.id+"",list:r},null)}}}]},operation:{fullEl:p}})),rowId:b,pendingRef:p,azPageRef:x,dialogType:g,dataConnectionVisible:i,importFile:a,exportFile:C,onOpen:w,refreshTable:m}},pe=ue,me=O({__name:"DataConnectionAdd",props:{visible:{type:Boolean},type:{},id:{}},emits:["update:visible","success"],setup(p,{emit:x}){const i=p,b=x,g=f(),m=$(i,"visible",b),a=f({...{dbType:"",titleName:"",description:"",ip:"",port:"",username:"",password:"",dbName:"",configParams:""}}),C={dbType:[{required:!0,message:"请选择数据源类型",trigger:"change"}],titleName:[{required:!0,message:"请输入数据连接名称",trigger:"blur"}],ip:[{required:!0,message:"请输入数据库地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],dbName:[{required:!0,message:"请输入数据库名称",trigger:"blur"}],configParams:[{required:!0,message:"请输入连接参数",trigger:"blur"}]},N=f([{label:"MYSQL",value:"MYSQL"}]),d=f([]),u=async()=>{if(i.type===V.add)return;const r=await se(i.id),{configParams:t,dbName:n,dbType:D,description:c,id:R,ip:U,password:l,port:v,titleName:k,username:I}=r;a.value={configParams:t,dbName:n,dbType:D,description:c,id:R,ip:U,password:de(l),port:v,titleName:k,username:I},d.value=await L({...a.value,password:h(a.value.password)})},y=async()=>{var r;if(await((r=g.value)==null?void 0:r.validate()),i.type===V.add){await re({...a.value,password:h(a.value.password)}),E.success("新增连接成功！"),b("success");return}i.type===V.edit&&(await ne({...a.value,password:h(a.value.password)}),E.success("编辑连接成功！"),b("success"))},T=async()=>{var r;await((r=g.value)==null?void 0:r.validateField(["dbType","titleName","ip","port","username","password"]));try{d.value=await L({...a.value,password:h(a.value.password)})}catch{d.value=[]}};return(r,t)=>{const n=j,D=G,c=H,R=S,U=J;return _(),F(W,{modelValue:e(m),"onUpdate:modelValue":t[10]||(t[10]=l=>M(m)?m.value=l:null),title:e(ie)[r.type].title,"show-load":u},{default:s(()=>[o(U,{"label-suffix":":","label-width":"100px",rules:C,model:e(a),"scroll-to-error":"",ref_key:"formRef",ref:g},{default:s(()=>[o(n,{class:"info",label:"基本信息"}),o(n,{label:"数据源类型",prop:"dbType"},{default:s(()=>[o(P,{placeholder:"数据源类型",style:{width:"100%"},load:e(N),modelValue:e(a).dbType,"onUpdate:modelValue":t[0]||(t[0]=l=>e(a).dbType=l)},{default:s(({options:l})=>[(_(!0),q(z,null,A(l,({label:v,value:k})=>(_(),F(D,{value:k,label:v,key:k},null,8,["value","label"]))),128))]),_:1},8,["load","modelValue"])]),_:1}),o(n,{label:"名称",prop:"titleName"},{default:s(()=>[o(c,{placeholder:"请输入数据连接名称",modelValue:e(a).titleName,"onUpdate:modelValue":t[1]||(t[1]=l=>e(a).titleName=l)},null,8,["modelValue"])]),_:1}),o(n,{label:"说明"},{default:s(()=>[o(c,{autosize:{minRows:3,maxRows:6},type:"textarea",placeholder:"请输入说明","show-word-limit":"",maxlength:200,modelValue:e(a).description,"onUpdate:modelValue":t[2]||(t[2]=l=>e(a).description=l)},null,8,["modelValue"])]),_:1}),o(n,{label:"连接信息",class:"info"}),o(n,{label:"数据库地址",prop:"ip"},{default:s(()=>[o(c,{placeholder:"请输入数据库地址",modelValue:e(a).ip,"onUpdate:modelValue":t[3]||(t[3]=l=>e(a).ip=l)},null,8,["modelValue"])]),_:1}),o(n,{label:"端口",prop:"port"},{default:s(()=>[o(c,{placeholder:"请输入端口",modelValue:e(a).port,"onUpdate:modelValue":t[4]||(t[4]=l=>e(a).port=l)},null,8,["modelValue"])]),_:1}),o(n,{label:"用户名",prop:"username"},{default:s(()=>[o(c,{placeholder:"请输入用户名",modelValue:e(a).username,"onUpdate:modelValue":t[5]||(t[5]=l=>e(a).username=l)},null,8,["modelValue"])]),_:1}),o(n,{label:"密码",prop:"password"},{default:s(()=>[o(c,{type:"password",placeholder:"请输入密码",modelValue:e(a).password,"onUpdate:modelValue":t[6]||(t[6]=l=>e(a).password=l)},null,8,["modelValue"])]),_:1}),o(n,{label:"数据库名",prop:"dbName"},{default:s(()=>[o(P,{placeholder:"请先测试连接后选择数据库",style:{width:"100%"},load:e(d),modelValue:e(a).dbName,"onUpdate:modelValue":t[7]||(t[7]=l=>e(a).dbName=l)},{default:s(({options:l})=>[(_(!0),q(z,null,A(l,v=>(_(),F(D,{value:v,label:v,key:v},null,8,["value","label"]))),128))]),prefix:s(()=>[o(R,{type:"primary",onClick:T},{default:s(()=>[B(" 测试连接 ")]),_:1})]),_:1},8,["load","modelValue"])]),_:1}),o(n,{label:"连接参数"},{default:s(()=>[o(c,{autosize:{minRows:3,maxRows:6},type:"textarea",placeholder:"请输入连接参数,以a=b&c=d的格式","show-word-limit":"",maxlength:200,modelValue:e(a).configParams,"onUpdate:modelValue":t[8]||(t[8]=l=>e(a).configParams=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),o(Y,{editMode:!0,onClose:t[9]||(t[9]=l=>m.value=!1),"on-submit":y})]),_:1},8,["modelValue","title"])}}});const ce=K(me,[["__scopeId","data-v-1e059d9f"]]),ye=O({__name:"routePage",setup(p){const{config:x,rowId:i,pendingRef:b,azPageRef:g,dialogType:m,dataConnectionVisible:w,importFile:a,exportFile:C,onOpen:N,refreshTable:d}=pe();return(u,y)=>{const T=S,r=X("az-page");return _(),q("div",{class:"data-connection"},[Z("div",{class:"layout_box",ref_key:"pendingRef",ref:b},[o(r,{ref_key:"azPageRef",ref:g,config:e(x)},{operation:s(()=>[o(T,{type:"primary",icon:e(ee),onClick:y[0]||(y[0]=t=>e(N)(e(V).add))},{default:s(()=>[B(" 新增数据连接 ")]),_:1},8,["icon"])]),_:1},8,["config"])],512),e(w)?(_(),F(ce,{key:0,visible:e(w),"onUpdate:visible":y[1]||(y[1]=t=>M(w)?w.value=t:null),type:e(m),id:e(i),onSuccess:e(d)},null,8,["visible","type","id","onSuccess"])):ae("",!0)])}}});export{ye as default};

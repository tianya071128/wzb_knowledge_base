import{lL as R,xy as Te,lT as I,xH as J,d as F,lU as j,xx as _,xI as V,r as k,xF as xe,c as C,w5 as le,w6 as oe,z as Oe,xu as ce,i as m,lW as ie,xJ as X,y as M,xw as D,w3 as se,xK as pe,F as Ce,xL as ye,wa as W,w4 as ke,lN as we,xs as Se,xM as z,lK as Ee,I as Ie,aT as Z,xN as Pe,lO as Ne}from"./index-b80d5ef5.js";import{T as He,a as Me}from"./index-34056eca.js";const[Be,x,ee]=R("picker"),ue=e=>e.find(a=>!a.disabled)||e[0];function _e(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}function $(e,a){a=J(a,0,e.length);for(let n=a;n<e.length;n++)if(!e[n].disabled)return n;for(let n=a-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const te=(e,a,n)=>a!==void 0&&!!e.find(c=>c[n.value]===a);function Q(e,a,n){const c=e.findIndex(b=>b[n.value]===a),i=$(e,c);return e[i]}function De(e,a,n){const c=[];let i={[a.children]:e},b=0;for(;i&&i[a.children];){const v=i[a.children],g=n.value[b];if(i=Te(g)?Q(v,g,a):void 0,!i&&v.length){const u=ue(v)[a.value];i=Q(v,u,a)}b++,c.push(v)}return c}function $e(e){const{transform:a}=window.getComputedStyle(e),n=a.slice(7,a.length-1).split(", ")[5];return Number(n)}function Ve(e){return I({text:"text",value:"value",children:"children"},e)}const ne=200,ae=300,Re=15,[re,G]=R("picker-column"),de=Symbol(re);var Fe=F({name:re,props:{value:j,fields:_(Object),options:V(),readonly:Boolean,allowHtml:Boolean,optionHeight:_(Number),swipeDuration:_(j),visibleOptionNum:_(j)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:n}){let c,i,b,v,g;const u=k(),r=k(),f=k(0),d=k(0),O=xe(),h=()=>e.options.length,w=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,y=s=>{let t=$(e.options,s);const l=-t*e.optionHeight,o=()=>{t>h()-1&&(t=$(e.options,s));const p=e.options[t][e.fields.value];p!==e.value&&a("change",p)};c&&l!==f.value?g=o:o(),f.value=l},T=()=>e.readonly||!e.options.length,K=s=>{c||T()||(g=null,d.value=ne,y(s),a("clickOption",e.options[s]))},S=s=>J(Math.round(-s/e.optionHeight),0,h()-1),B=C(()=>S(f.value)),U=(s,t)=>{const l=Math.abs(s/t);s=f.value+l/.003*(s<0?-1:1);const o=S(s);d.value=+e.swipeDuration,y(o)},P=()=>{c=!1,d.value=0,g&&(g(),g=null)},L=s=>{if(!T()){if(O.start(s),c){const t=$e(r.value);f.value=Math.min(0,t-w())}d.value=0,i=f.value,b=Date.now(),v=i,g=null}},Y=s=>{if(T())return;O.move(s),O.isVertical()&&(c=!0,ie(s,!0));const t=J(i+O.deltaY.value,-(h()*e.optionHeight),e.optionHeight),l=S(t);l!==B.value&&a("scrollInto",e.options[l]),f.value=t;const o=Date.now();o-b>ae&&(b=o,v=t)},N=()=>{if(T())return;const s=f.value-v,t=Date.now()-b;if(t<ae&&Math.abs(s)>Re){U(s,t);return}const o=S(f.value);d.value=ne,y(o),setTimeout(()=>{c=!1},0)},E=()=>{const s={height:`${e.optionHeight}px`};return e.options.map((t,l)=>{const o=t[e.fields.text],{disabled:p}=t,H=t[e.fields.value],be={role:"button",style:s,tabindex:p?-1:0,class:[G("item",{disabled:p,selected:H===e.value}),t.className],onClick:()=>K(l)},ge={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:o};return m("li",be,[n.option?n.option(t,l):m("div",ge,null)])})};return le(de),oe({stopMomentum:P}),Oe(()=>{const s=c?Math.floor(-f.value/e.optionHeight):e.options.findIndex(o=>o[e.fields.value]===e.value),t=$(e.options,s),l=-t*e.optionHeight;c&&t<s&&P(),f.value=l}),ce("touchmove",Y,{target:u}),()=>m("div",{ref:u,class:G(),onTouchstartPassive:L,onTouchend:N,onTouchcancel:N},[m("ul",{ref:r,style:{transform:`translate3d(0, ${f.value+w()}px, 0)`,transitionDuration:`${d.value}ms`,transitionProperty:d.value?"all":"none"},class:G("wrapper"),onTransitionend:P},[E()])])}});const[Ae]=R("picker-toolbar"),A={title:String,cancelButtonText:String,confirmButtonText:String},me=["cancel","confirm","title","toolbar"],Ke=Object.keys(A);var fe=F({name:Ae,props:A,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const c=()=>{if(n.title)return n.title();if(e.title)return m("div",{class:[x("title"),"van-ellipsis"]},[e.title])},i=()=>a("cancel"),b=()=>a("confirm"),v=()=>{var u;const r=(u=e.cancelButtonText)!=null?u:ee("cancel");if(!(!n.cancel&&!r))return m("button",{type:"button",class:[x("cancel"),X],onClick:i},[n.cancel?n.cancel():r])},g=()=>{var u;const r=(u=e.confirmButtonText)!=null?u:ee("confirm");if(!(!n.confirm&&!r))return m("button",{type:"button",class:[x("confirm"),X],onClick:b},[n.confirm?n.confirm():r])};return()=>m("div",{class:x("toolbar")},[n.toolbar?n.toolbar():[v(),c(),g()]])}});const Ue=(e,a)=>{const n=k(e());return M(e,c=>{c!==n.value&&(n.value=c)}),M(n,c=>{c!==e()&&a(c)}),n},[ve,q]=R("picker-group"),he=Symbol(ve),Le=I({tabs:V(),activeTab:D(0),nextStepText:String},A);var Je=F({name:ve,props:Le,emits:["confirm","cancel","update:activeTab"],setup(e,{emit:a,slots:n}){const c=Ue(()=>e.activeTab,r=>a("update:activeTab",r)),{children:i,linkChildren:b}=se(he);b();const v=()=>+c.value<e.tabs.length-1&&e.nextStepText,g=()=>{v()?c.value=+c.value+1:a("confirm",i.map(r=>r.confirm()))},u=()=>a("cancel");return()=>{var r,f;let d=(f=(r=n.default)==null?void 0:r.call(n))==null?void 0:f.filter(h=>h.type!==pe).map(h=>h.type===Ce?h.children:h);d&&(d=ye(d));const O=v()?e.nextStepText:e.confirmButtonText;return m("div",{class:q()},[m(fe,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:O,onConfirm:g,onCancel:u},W(n,me)),m(He,{active:c.value,"onUpdate:active":h=>c.value=h,class:q("tabs"),shrink:!0,animated:!0,lazyRender:!1},{default:()=>[e.tabs.map((h,w)=>m(Me,{title:h,titleClass:q("tab-title")},{default:()=>[d==null?void 0:d[w]]}))]})])}}});const Ye=I({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:D(44),showToolbar:ke,swipeDuration:D(1e3),visibleOptionNum:D(6)},A),je=I({},Ye,{columns:V(),modelValue:V(),toolbarPosition:we("top"),columnsFieldNames:Object});var ze=F({name:Be,props:je,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:n}){const c=k(),i=k(e.modelValue.slice(0)),{parent:b}=le(he),{children:v,linkChildren:g}=se(de);g();const u=C(()=>Ve(e.columnsFieldNames)),r=C(()=>Se(e.optionHeight)),f=C(()=>_e(e.columns,u.value)),d=C(()=>{const{columns:t}=e;switch(f.value){case"multiple":return t;case"cascade":return De(t,u.value,i);default:return[t]}}),O=C(()=>d.value.some(t=>t.length)),h=C(()=>d.value.map((t,l)=>Q(t,i.value[l],u.value))),w=C(()=>d.value.map((t,l)=>t.findIndex(o=>o[u.value.value]===i.value[l]))),y=(t,l)=>{if(i.value[t]!==l){const o=i.value.slice(0);o[t]=l,i.value=o}},T=()=>({selectedValues:i.value.slice(0),selectedOptions:h.value,selectedIndexes:w.value}),K=(t,l)=>{y(l,t),f.value==="cascade"&&i.value.forEach((o,p)=>{const H=d.value[p];te(H,o,u.value)||y(p,H.length?H[0][u.value.value]:void 0)}),Z(()=>{a("change",I({columnIndex:l},T()))})},S=(t,l)=>{const o={columnIndex:l,currentOption:t};a("clickOption",I(T(),o)),a("scrollInto",o)},B=()=>{v.forEach(l=>l.stopMomentum());const t=T();return Z(()=>{a("confirm",t)}),t},U=()=>a("cancel",T()),P=()=>d.value.map((t,l)=>m(Fe,{value:i.value[l],fields:u.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:r.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:o=>K(o,l),onClickOption:o=>S(o,l),onScrollInto:o=>{a("scrollInto",{currentOption:o,columnIndex:l})}},{option:n.option})),L=t=>{if(O.value){const l={height:`${r.value}px`},o={backgroundSize:`100% ${(t-r.value)/2}px`};return[m("div",{class:x("mask"),style:o},null),m("div",{class:[Pe,x("frame")],style:l},null)]}},Y=()=>{const t=r.value*+e.visibleOptionNum,l={height:`${t}px`};return m("div",{ref:c,class:x("columns"),style:l},[P(),L(t)])},N=()=>{if(e.showToolbar&&!b)return m(fe,Ie(W(e,Ke),{onConfirm:B,onCancel:U}),W(n,me))};M(d,t=>{t.forEach((l,o)=>{l.length&&!te(l,i.value[o],u.value)&&y(o,ue(l)[u.value.value])})},{immediate:!0});let E;return M(()=>e.modelValue,t=>{!z(t,i.value)&&!z(t,E)&&(i.value=t.slice(0),E=t.slice(0))},{deep:!0}),M(i,t=>{z(t,e.modelValue)||(E=t.slice(0),a("update:modelValue",E))},{immediate:!0}),ce("touchmove",ie,{target:c}),oe({confirm:B,getSelectedOptions:()=>h.value}),()=>{var t,l;return m("div",{class:x()},[e.toolbarPosition==="top"?N():null,e.loading?m(Ee,{class:x("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),Y(),(l=n["columns-bottom"])==null?void 0:l.call(n),e.toolbarPosition==="bottom"?N():null])}}});const We=Ne(ze);export{We as P,Je as s};

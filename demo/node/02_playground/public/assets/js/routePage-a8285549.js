import{d as G,c as A,a8 as Oe,a as Te,r as I,o as k,f as $,i as e,w as s,m as z,k as C,dA as Ue,F as B,dB as Me,U as Y,dC as ge,dD as Ie,bn as he,_ as Z,dE as ae,Y as K,y as Q,ag as Ae,I as ne,B as a,at as ze,C as te,g as ee,l as le,aU as W,q as Be,ba as ue,dF as je,dG as qe,b as X,dH as He,z as Ge,dI as Ke,dJ as Ye,x as Je,d9 as Qe,t as re,ad as We,dK as Xe,dL as Ze,dM as el,aa as ll,dN as H,d2 as tl,d3 as al,dO as ol,bp as nl,dP as sl,dQ as dl,p as il,dR as rl,dS as pe,dT as cl,dU as be,dV as ce,a9 as Fe,dW as ke,dX as ul,L as we,as as pl,c1 as fl,b0 as Se,b1 as Ve,bv as ml,dY as _l,dZ as vl,d_ as de,d$ as ie,e0 as me,e1 as _e,e2 as yl,P as xe,e3 as Ee,aY as gl,bG as Il,a$ as fe,V as hl,e4 as bl,aN as Fl,a_ as kl,b4 as ve,bd as wl,b6 as Sl}from"./index-b80d5ef5.js";import{A as Vl}from"./AddFormDataBtnPlus-a775412e.js";import{F as xl}from"./FieldCondition-1c72aa9d.js";import{S as El}from"./SortSetField-face42ca.js";import{u as ye}from"./useExtractQuery-f96f705c.js";import"./SelectEntryAndOther-76a65b2d.js";import"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import"./useFieldMaxWidth-d82f063e.js";import"./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js";import"./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js";import"./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js";import"./index-318b68f4.js";import"./AzInputNumber-d6212644.js";import"./el-input-number-c15b1cc7.js";import"./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js";import"./useMultipleVal-904406c1.js";import"./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js";import"./el-dropdown-item-455a6589.js";import"./CardShowFieldItem-fd24f218.js";import"./EditorDraggable-a06dbc71.js";import"./ButtonSelectField.vue_vue_type_script_setup_true_lang-aae15f71.js";const Cl=G({__name:"ExportOperation",props:{selectItems:{},totalFields:{},params:{},sourceId:{},entryIds:{}},setup(M){const y=M,n=A(()=>{const o=Oe(y.totalFields,{excludeFilter(u,i){return!(i!=null&&i.isFormItem)||u.type===Te.plugin}});return h(Object.assign(o))}),h=(o,u)=>o.map(i=>(i.parentFieldId=u,i.fields&&i.fields.length&&h(i.fields,i.fieldId),i)),d=I(),c=I(!1),b=I(!1),x=()=>{var o;b.value=!0,(o=d.value)==null||o.clearSelection()},R=o=>o.map(u=>{var f;const[i,_]=u.fieldId.split("."),O={alias:`${i}-${_}`,column:_,label:(f=u.options)==null?void 0:f.label,children:[],type:u.type};return u.fields&&u.fields.forEach(p=>{var F,r,g;const m=o.findIndex(t=>t.fieldId===p.fieldId);if(m===-1)return;const[,v]=o[m].fieldId.split(".");O.children.push({alias:`${_}-${v}`,column:_,label:(r=(F=o[m])==null?void 0:F.options)==null?void 0:r.label,type:(g=o[m])==null?void 0:g.type}),o.splice(m,1)}),O}),w=o=>(o.forEach((u,i)=>{u.fields&&(o.splice(i,1),u.fields.forEach(_=>{const O=o.findIndex(f=>f.fieldId===_.fieldId);o.splice(O,1)}))}),o.map(u=>{const[i,_]=u.fieldId.split(".");return{alias:`${i}-${_}`,column:_,tableName:i}})),L=(o,u)=>{var O,f,p,m,v,F;const i=n.value.reduce((r,g)=>[...r,g,...(g==null?void 0:g.fields)??[]],[])??[],_=o.some(r=>r.fieldId===u.fieldId);if((O=u.fields)!=null&&O.length&&function r(g){g.forEach(t=>{var l,P;(l=d.value)==null||l.toggleRowSelection(t,_),(P=t.fields)!=null&&P.length&&r(t.fields)})}(u.fields),u.parentFieldId){const r=i.find(l=>l.fieldId===u.parentFieldId),g=((f=r==null?void 0:r.fields)==null?void 0:f.length)??0,t=((p=o.filter(l=>l.parentFieldId===(r==null?void 0:r.fieldId)))==null?void 0:p.length)??0;_?t>=g?((m=d.value)==null||m.toggleRowSelection(r,_),r!=null&&r.fields&&r.fields.forEach(l=>{var P;(P=d.value)==null||P.toggleRowSelection(l,_)})):(v=d.value)==null||v.toggleRowSelection(r,_):t<=0&&((F=d.value)==null||F.toggleRowSelection(r,_),r!=null&&r.fields&&r.fields.forEach(l=>{var P;(P=d.value)==null||P.toggleRowSelection(l,_)}))}},N=o=>{var i;const u=o.some(_=>_.fieldId===n.value[0].fieldId);u?o.forEach(_=>{_.fields&&function O(f){f.forEach(p=>{var m,v;(m=d.value)==null||m.toggleRowSelection(p,u),(v=p.fields)!=null&&v.length&&O(p.fields)})}(_.fields)}):(i=d.value)==null||i.clearSelection()},D=async()=>{var o,u;c.value=!0;try{b.value=!1;const i=y.params;i.select.columns=w((o=d.value)==null?void 0:o.getSelectionRows()),await Me({queryParam:i,sheetLabels:R((u=d.value)==null?void 0:u.getSelectionRows()).filter(_=>_!==null),fileName:"excel",dataList:y.selectItems,entryIds:y.entryIds??""})}finally{c.value=!1}};return(o,u)=>{const i=Y,_=ge,O=Ie,f=he;return k(),$(B,null,[e(i,{type:"success",onClick:x,loading:c.value},{default:s(()=>[z(" 导出 ")]),_:1},8,["loading"]),e(f,{modelValue:b.value,"onUpdate:modelValue":u[1]||(u[1]=p=>b.value=p),title:"导出Excel",width:"500","append-to-body":""},{footer:s(()=>[C("span",{class:"dialog-footer"},[e(i,{onClick:u[0]||(u[0]=p=>b.value=!1)},{default:s(()=>[z("取消")]),_:1}),e(i,{type:"primary",onClick:D},{default:s(()=>[z("确定")]),_:1})])]),default:s(()=>[e(O,{data:n.value,border:"",style:{width:"100%"},"row-key":"fieldId","max-height":"50vh","tree-props":{children:"fields"},"default-expand-all":"",onSelect:L,onSelectAll:N,ref_key:"tableRef",ref:d,class:"export_table"},{default:s(()=>[e(_,{type:"selection",width:"55"}),e(_,{prop:"date",label:"名称"},{default:s(({row:p})=>[e(Ue,{class:"az-flex-width",sourceId:o.sourceId,fieldId:p.fieldId},null,8,["sourceId","fieldId"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const Nl=Z(Cl,[["__scopeId","data-v-8b3b8d09"]]);function Rl(M){const{tableFields:y}=ae(M),n=I(K(y.value)),h=I(),d=A({set(R){n.value.forEach(w=>w.show=R)},get(){return n.value.every(R=>R.show)}}),c=A(()=>!(n.value.every(R=>R.show)||n.value.every(R=>!R.show)));return{tableFields:y,fields:n,fieldSetting:h,checkAll:d,isIndeterminate:c,saveFieldSetting:()=>{y.value=K(n.value)},handlerPopoverShow:()=>{n.value=K(y.value)}}}const Ce=G({inheritAttrs:!1,__name:"FieldsOperation",props:{configId:{},fields:{}},setup(M){const y=M,{tableFields:n,fields:h,checkAll:d,isIndeterminate:c,saveFieldSetting:b,handlerPopoverShow:x}=Rl(A(()=>y.configId));Q(()=>y.fields,()=>{if(!y.fields)return;const D=Ae(y.fields).map(o=>{var i;const u=o.options.label||"";return{prop:o.fieldId,label:u,show:((i=n.value.find(_=>_.prop===o.fieldId))==null?void 0:i.show)??!0}});n.value=D},{immediate:!0});const R=I(),w=I(),L=()=>{var D,o;(o=(D=a(w)).hide)==null||o.call(D)},N=()=>{L(),b()};return(D,o)=>{const u=Y,i=W,_=Be,O=ue;return k(),$(B,null,[e(i,{content:"字段管理",placement:"top","show-after":300},{default:s(()=>[e(u,ne({icon:a(ze),ref_key:"fieldSetting",ref:R},D.$attrs,{onClick:a(x)}),null,16,["icon","onClick"])]),_:1}),e(O,{ref_key:"popoverRef",ref:w,width:250,placement:"bottom-end",trigger:"click",offset:20,"virtual-triggering":"","virtual-ref":R.value,"hide-after":0,transition:"el-zoom-in-top"},{default:s(()=>[C("div",{class:"az_page-operation-field"},[C("div",{class:"field-all"},[e(_,{modelValue:a(d),"onUpdate:modelValue":o[0]||(o[0]=f=>te(d)?d.value=f:null),indeterminate:a(c)},{default:s(()=>[z(" 勾选您要显示的字段 ")]),_:1},8,["modelValue","indeterminate"])]),C("ul",{class:"field-select"},[(k(!0),$(B,null,ee(a(h),(f,p)=>(k(),$("li",{key:p},[e(_,{class:"w100",modelValue:f.show,"onUpdate:modelValue":m=>f.show=m,label:f.label},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),a(h).length?le("",!0):(k(),$("li",{key:0,class:"az-data-empty"},"没有可勾选的字段"))]),C("div",{class:"field-submit"},[e(u,{onClick:L},{default:s(()=>[z("取消")]),_:1}),e(u,{type:"primary",onClick:N},{default:s(()=>[z("保存")]),_:1})])])]),_:1},8,["virtual-ref"])],64)}}}),$l=G({inheritAttrs:!1,__name:"FilterOperation",props:{configId:{},fields:{},sourceId:{}},setup(M){const y=M,n=I(),h=I(!1),d=I(),c=I(),{filterFields:b}=ae(A(()=>y.configId)),x=I(K(b.value)),R=()=>{if(h.value){h.value=!1;return}x.value=K(b.value),h.value=!0},w=()=>{h.value=!1},L=async()=>{var N;await((N=c.value)==null?void 0:N.validate()),w(),b.value=K(x.value)};return je(document,"click",N=>{var D;h.value&&(D=document.getElementById("app"))!=null&&D.contains(N.target)&&setTimeout(()=>{h.value=!1},40)},{capture:!0}),(N,D)=>{const o=Y,u=W,i=ue;return k(),$(B,null,[e(u,{content:"筛选条件",placement:"top","show-after":300},{default:s(()=>[e(o,ne({icon:a(qe),ref_key:"fieldSetting",ref:n,plain:""},N.$attrs,{onClick:R,class:{"is-action":!!a(b).length}}),null,16,["icon","class"])]),_:1}),e(i,{visible:h.value,ref_key:"popoverRef",ref:d,width:700,placement:"bottom-end",trigger:"click",offset:20,"virtual-ref":n.value,"virtual-triggering":"","hide-after":0,transition:"el-zoom-in-top"},{default:s(()=>[C("div",{class:"filter_field"},[h.value?(k(),X(xl,{key:0,condition:x.value,"onUpdate:condition":D[0]||(D[0]=_=>x.value=_),ref_key:"fieldConditionRef",ref:c,fields:N.fields,sourceId:N.sourceId},null,8,["condition","fields","sourceId"])):le("",!0),C("div",{class:"field-submit"},[e(o,{onClick:w},{default:s(()=>[z("取消")]),_:1}),e(o,{type:"primary",onClick:L},{default:s(()=>[z("保存")]),_:1})])])]),_:1},8,["visible","virtual-ref"])],64)}}});const Ne=Z($l,[["__scopeId","data-v-52d85293"]]),Re=G({__name:"FullOperation",props:{fullEl:{}},setup(M){const y=M,{isFullscreen:n,toggle:h}=He();return Ge(()=>{const d=Ke(y.fullEl);d&&d.classList[n.value?"add":"remove"]("az-full")}),(d,c)=>{const b=Y,x=W;return k(),X(x,{content:a(n)?"退出全屏":"全屏",placement:"top","show-after":300},{default:s(()=>[e(b,{icon:a(Ye),onClick:a(h)},null,8,["icon","onClick"])]),_:1},8,["content"])}}}),Dl=G({__name:"ImportOperation",props:{sourceId:{}},emits:["refresh"],setup(M,{emit:y}){const n=M,h=y,d=Je(),c=I(),b=I(!1),x=I(0),R=I(),w=()=>{b.value=!0},L=I([]),N=async()=>{await Xe({daSourceId:n.sourceId,fileName:"downExcel"})},D=async(f,p)=>{try{R.value=p.id;const m=await Ze({daSourceId:n.sourceId,fileId:p.id});x.value=1,m.headList.forEach(v=>{var F;if((F=v==null?void 0:v.child)!=null&&F.length)v==null||v.child.forEach(r=>{const{columnValue:g,columnName:t,aliasValue:l,type:P}=r;r.option={columnValue:g,columnName:t,aliasValue:l,type:P}});else{const{columnValue:r,columnName:g,aliasValue:t,type:l}=v;v.option={columnValue:r,columnName:g,aliasValue:t,type:l}}}),c.value=m,c.value}catch{L.value=[]}},o=()=>{L.value=[],x.value=0},u=()=>{var f;(f=c.value)==null||f.dataList.unshift({}),x.value=2},i=()=>{var f,p,m;(p=(f=c.value)==null?void 0:f.headList)==null||p.forEach(v=>{var F;if((F=v==null?void 0:v.child)!=null&&F.length)v==null||v.child.forEach(r=>{const{columnValue:g,columnName:t,aliasValue:l,type:P}=r;r.option={columnValue:g,columnName:t,aliasValue:l,type:P}});else{const{columnValue:r,columnName:g,aliasValue:t,type:l}=v;v.option={columnValue:r,columnName:g,aliasValue:t,type:l}}}),(m=c.value)==null||m.dataList.splice(0,1),x.value=1},_=async()=>{var v,F,r,g,t;const f=await d.getSoureceData(n.sourceId),p=((F=(v=c.value)==null?void 0:v.headList)==null?void 0:F.map(l=>{var P,E,T,U;return{columnValue:l.columnValue,columnName:((P=l.option)==null?void 0:P.columnName)??l.columnName??"",type:((E=l.option)==null?void 0:E.type)??l.type??"",aliasValue:((T=l.option)==null?void 0:T.aliasValue)??l.aliasValue??"",child:(U=l.child)==null?void 0:U.map(q=>{var se,S,V;return{columnValue:q.columnValue,columnName:((se=q.option)==null?void 0:se.columnName)??"",type:((S=q.option)==null?void 0:S.type)??"",aliasValue:((V=q.option)==null?void 0:V.aliasValue)??""}})}}))??[];(r=c.value)==null||r.headList;const m=await el({daSourceId:n.sourceId,fileId:R.value,colunmList:p,entryId:f==null?void 0:f.entryIds.map(l=>l.entryId).join(",")});b.value=!1,o(),ll({title:"导入成功",message:H("p",null,[H("span",null,"导入总数： "),H("span",{style:"margin-right: 8px;"},m.dataCount),H("span",null,"成功： "),H("span",{style:"color: var(--el-color-success);margin-right: 8px;"},m.successCount),H("span",null,"失败： "),H("span",{style:"color: var(--el-color-danger);margin-right: 8px;"},m.failureCount),H("br"),H("span",{style:`display: ${m.failureFileInfo?"flex":"none"}`},"失败文件： "),H("a",{style:`color: var(--el-color-primary);display: ${m.failureFileInfo?"flex":"none"}`,href:(g=m.failureFileInfo)==null?void 0:g.url},(t=m.failureFileInfo)==null?void 0:t.fileName)]),showCancelButton:!1,confirmButtonText:"我知道了"}),h("refresh")},O=(f,p)=>{var r,g;const m=((r=c.value)==null?void 0:r.headList.reduce((t,l)=>[...t,l,...l.child??[]],[]))??[],F=(((g=c.value)==null?void 0:g.headFieldMap.reduce((t,l)=>[...t,l,...l.children??[]],[]))??[]).find(t=>t.alias===f);m.forEach(t=>{var l;t.aliasValue!==p&&((l=t.option)==null?void 0:l.aliasValue)===f&&(t.option.aliasValue="0",t.option.columnName="不导入"),F&&t.option&&t.aliasValue===p&&t.type!=="subform"&&(t.option.columnName=F.label,t.option.type=F.type)})};return(f,p)=>{const m=Y,v=W,F=tl,r=al,g=ge,t=Ie,l=ol,P=he;return k(),$(B,null,[e(v,{effect:"dark",content:"仅导入数据",placement:"top-start"},{default:s(()=>[e(m,{type:"success",onClick:w},{default:s(()=>[z("导入")]),_:1})]),_:1}),e(P,{modelValue:b.value,"onUpdate:modelValue":p[1]||(p[1]=E=>b.value=E),title:"导入数据",width:"800","append-to-body":""},{default:s(()=>[e(r,{active:x.value,"finish-status":"success","align-center":"",style:{"margin-bottom":"20px"}},{default:s(()=>[e(F,{title:"选择Excel"}),e(F,{title:"预览数据"}),e(F,{title:"配置表单"})]),_:1},8,["active"]),x.value===0?(k(),$("div",{key:0},[C("div",null,[z(" 1.请先下载模板: "),e(m,{type:"primary",link:"",onClick:N},{default:s(()=>[z(" 下载导入模板 ")]),_:1})]),C("div",null,"2.按模板格式填入数据；"),C("div",null,"3.上传填好数据的excel文件，导入数据。"),C("div",{class:"upload-box"},[e(Qe,{modelValue:L.value,"onUpdate:modelValue":p[0]||(p[0]=E=>L.value=E),limit:1,type:"file",onUploadFinish:D,accept:["xlsx","xls"],imgWidth:"80px",size:5120},null,8,["modelValue"])])])):le("",!0),x.value===1?(k(),$("div",{key:1},[e(t,{data:c.value.dataList,style:{width:"100%"},height:"250"},{default:s(()=>[(k(!0),$(B,null,ee(c.value.headList,E=>(k(),X(g,{key:E.aliasValue,prop:String(E.columnValue),label:E.columnName},{default:s(()=>[E.child?(k(!0),$(B,{key:0},ee(E.child,T=>(k(),X(g,{key:T.aliasValue,prop:String(T.columnValue),label:T.columnName},null,8,["prop","label"]))),128)):le("",!0)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data"]),C("div",{class:"handle-btn-box"},[e(m,{onClick:o},{default:s(()=>[z("上一步")]),_:1}),e(m,{type:"primary",onClick:u},{default:s(()=>[z("下一步")]),_:1})])])):le("",!0),x.value===2?(k(),$("div",{key:2},[e(t,{data:c.value.dataList,style:{width:"100%"},height:"250"},{default:s(()=>[e(g,{width:"100"},{default:s(E=>[E.$index===0?(k(),$("span",{key:0},"表单字段")):(k(),$("span",{key:1},re(E.$index),1))]),_:1}),(k(!0),$(B,null,ee(c.value.headList,E=>(k(),X(g,{label:E.columnName,key:E.aliasValue,"min-width":"120"},We({default:s(()=>[(k(!0),$(B,null,ee(E.child,T=>(k(),X(g,{key:T.aliasValue,label:T.columnName},{default:s(U=>[U.$index!==0?(k(),$("span",{key:0},re(U.row[T.columnValue]),1)):(k(),$("span",{key:1},[e(l,{props:{value:"alias"},"node-key":"alias",modelValue:T.option.aliasValue,"onUpdate:modelValue":q=>T.option.aliasValue=q,data:c.value.headFieldMap,"render-after-expand":!1,style:{width:"100%"},onChange:q=>O(q,T.aliasValue)},null,8,["modelValue","onUpdate:modelValue","data","onChange"])]))]),_:2},1032,["label"]))),128))]),_:2},[E.child?void 0:{name:"default",fn:s(T=>[T.$index!==0?(k(),$("span",{key:0},re(T.row[E.columnValue]),1)):(k(),$("span",{key:1},[e(l,{props:{value:"alias"},"node-key":"alias",modelValue:E.option.aliasValue,"onUpdate:modelValue":U=>E.option.aliasValue=U,data:c.value.headFieldMap,"render-after-expand":!1,style:{width:"100%"},onChange:U=>O(U,E.aliasValue)},null,8,["modelValue","onUpdate:modelValue","data","onChange"])]))]),key:"0"}]),1032,["label"]))),128))]),_:1},8,["data"]),C("div",{class:"handle-btn-box"},[e(m,{onClick:i},{default:s(()=>[z("上一步")]),_:1}),e(m,{type:"primary",onClick:_},{default:s(()=>[z("导入")]),_:1})])])):le("",!0)]),_:1},8,["modelValue"])],64)}}});const Pl=Z(Dl,[["__scopeId","data-v-7a34c589"]]),$e=G({inheritAttrs:!1,__name:"ModeOperation",props:{configId:{}},setup(M){const y=M,n=I(),{tableMode:h}=ae(A(()=>y.configId)),d=A(()=>nl(sl)),c=b=>{h.value=b};return(b,x)=>{const R=Y,w=W,L=ue;return k(),$(B,null,[e(w,{content:"表格模式",placement:"top","show-after":300},{default:s(()=>[e(R,ne({icon:a(dl),ref_key:"buttonRef",ref:n},b.$attrs),null,16,["icon"])]),_:1}),e(L,{width:150,placement:"bottom",trigger:"click",offset:20,"virtual-triggering":"","virtual-ref":n.value,"hide-after":0,transition:"el-zoom-in-top","popper-class":"az-custom-popper"},{default:s(()=>[C("ul",{class:"az-custom-popper-menu"},[(k(!0),$(B,null,ee(d.value,(N,D)=>(k(),$("li",{key:D,class:il(["az-custom-popper-menu__item",{"az-custom-popper-menu__active":a(h)===N.value}]),onClick:o=>c(N.value)},re(N.label),11,["onClick"]))),128))])]),_:1},8,["virtual-ref"])],64)}}}),Ll=G({inheritAttrs:!1,__name:"SortFieldOperation",props:{configId:{},fields:{}},setup(M){const y=M,n=I(),h=I(),{sortFields:d}=ae(A(()=>y.configId)),c=I(K(d.value)),b=()=>{c.value=K(d.value)},x=()=>{var w,L;(L=(w=a(h)).hide)==null||L.call(w)},R=()=>{x(),d.value=K(c.value)};return(w,L)=>{const N=Y,D=W,o=ue;return k(),$(B,null,[e(D,{content:"排序",placement:"top","show-after":300},{default:s(()=>[e(N,ne({icon:a(rl),ref_key:"fieldSetting",ref:n},w.$attrs,{onClick:b,class:{"is-action":!!a(d).length}}),null,16,["icon","class"])]),_:1}),e(o,{ref_key:"popoverRef",ref:h,width:350,placement:"bottom-end",trigger:"click",offset:20,"virtual-triggering":"","virtual-ref":n.value,"hide-after":0,transition:"el-zoom-in-top"},{default:s(()=>[C("div",{class:"sort_field"},[e(El,{modelValue:c.value,"onUpdate:modelValue":L[0]||(L[0]=u=>c.value=u),fields:w.fields,teleported:!1,btnClass:"sort_field-btn"},null,8,["modelValue","fields"]),C("div",{class:"field-submit"},[e(N,{onClick:x},{default:s(()=>[z("取消")]),_:1}),e(N,{type:"primary",onClick:R},{default:s(()=>[z("保存")]),_:1})])])]),_:1},8,["virtual-ref"])],64)}}});const De=Z(Ll,[["__scopeId","data-v-60652def"]]),Ol=G({inheritAttrs:!1,__name:"RecycleOperation",props:{configId:{},entryId:{},sourceId:{},fields:{}},emits:["refresh"],setup(M,{emit:y}){const n=M,h=y,d=I(!1),c=A(()=>n.configId),b=I([]),x=I(),R=I(""),w=A(()=>b.value.map(S=>pe(S.fieldId).fieldId===cl?{...S,options:{...S.options,label:"删除时间"}}:S)),L=async()=>{R.value=n.sourceId??"",b.value=n.fields??[]};Q([()=>n.fields,()=>n.sourceId,()=>n.entryId],()=>{var S;(S=x.value)==null||S.reload()});const N=async(S=!1)=>{await vl(S?[{tableNames:[n.entryId]}]:p.value.map(V=>({tableNames:[n.entryId],conditions:[{cn:de.or,conditionSets:[{cn:de.and,leftTableName:n.entryId,leftFieldName:ie,leftFieldType:"id",type:me.equal,value:[_e({rowData:V,fieldId:ie,entryId:n.entryId})]}]}]}))),F(),h("refresh")},D=A(()=>[{id:"restore",text:"恢复已选项",disabled:!p.value.length,popconfirmProps:{title:"数据将恢复成删除前的状态，确定要恢复？",async confirm(){await N()}}},{id:"restore_all",text:"恢复全部",popconfirmProps:{title:"数据将恢复成删除前的状态，确定要恢复？",async confirm(){await N(!0)}}}]),o=async(S=!1)=>{await yl(S?[{tableNames:[n.entryId],sqlOperate:2}]:p.value.map(V=>({tableNames:[n.entryId],conditions:[{cn:de.or,conditionSets:[{cn:de.and,leftTableName:n.entryId,leftFieldName:ie,leftFieldType:"id",type:me.equal,value:[_e({rowData:V,fieldId:ie,entryId:n.entryId})]}]}]}))),F(),h("refresh")};A(()=>[{id:"remove",text:"删除已选项",disabled:!p.value.length,popconfirmProps:{title:"数据将被永久性删除，且不可再恢复，确定要彻底删除？",async confirm(){await o()}}},{id:"remove_all",text:"删除全部",popconfirmProps:{title:"数据将被永久性删除，且不可再恢复，确定要彻底删除？",async confirm(){await o(!0)}}}]);const u=I(),{sortFields:i,filterFields:_,tableFields:O,tableMode:f}=ae(c),p=I([]),m=A(()=>O.value.filter(S=>S.show).map(S=>({fieldId:S.prop}))),v=A(()=>{var V;return{sourceId:R.value,conditions:(V=_.value)==null?void 0:V.map(J=>({...J,conditionSets:J.conditionSets.map(oe=>({...oe,leftTableName:pe(oe.leftFieldName??"").entryId,leftFieldName:pe(oe.leftFieldName??"").fieldId}))})),sortField:i.value,showField:[],mode:"delete"}}),{getData:F,tableData:r,loading:g,current:t,limit:l,total:P}=be(v);Q(r,S=>{p.value=p.value.map(V=>S.find(J=>ce(J)===ce(V))).filter(V=>!!V)}),Q(v,(S,V)=>{v.value.sourceId&&!Fe(S,V)&&F()},{immediate:!0});const E=I(!1);Q(d,()=>{d.value&&(E.value&&F(),E.value=!0)},{immediate:!0});const T=I(!1),U=I({}),q=A(()=>({renderOptions:{entryId:n.entryId,mode:ke.view,formData:ul({entryId:n.entryId,rowData:U.value})},hideDataInfo:!0})),se=S=>{T.value=!0,U.value=S};return(S,V)=>{const J=Y,oe=xe,Pe=W,Le=Ee;return k(),$(B,null,[e(J,ne({type:"primary",onClick:V[0]||(V[0]=j=>d.value=!0)},S.$attrs),{default:s(()=>[z(" 数据回收站 ")]),_:1},16),e(ml,{modelValue:d.value,"onUpdate:modelValue":V[5]||(V[5]=j=>d.value=j),title:"数据回收站","destroy-on-close":"",size:"90%","append-to-body":"",direction:"btt"},{default:s(()=>[e(we,{load:L,style:{height:"100%"},ref_key:"loadingPageRef",ref:x},{default:s(()=>[C("div",{class:"recycle_oper",ref_key:"containerEl",ref:u},[C("div",{class:"recycle-header"},[C("div",{class:"header-btns"},[e(pl,{list:D.value,num:0,style:{display:"inline-block"}},{default:s(()=>[e(J,{type:"primary"},{default:s(()=>[z(" 恢复 "),e(oe,{class:"el-icon--right"},{default:s(()=>[e(a(fl))]),_:1})]),_:1})]),_:1},8,["list"])]),C("div",{class:"header-other"},[e(Le,null,{default:s(()=>[e(Pe,{content:"刷新",placement:"top","show-after":300},{default:s(()=>[e(J,{icon:a(Se),onClick:V[1]||(V[1]=j=>a(F)())},null,8,["icon"])]),_:1}),e(Re,{fullEl:u.value},null,8,["fullEl"]),e($e,{configId:c.value},null,8,["configId"]),e(Ce,{configId:c.value,fields:w.value},null,8,["configId","fields"]),e(De,{configId:c.value,fields:w.value},null,8,["configId","fields"]),e(Ne,{configId:c.value,fields:w.value},null,8,["configId","fields"])]),_:1})])]),C("div",{class:"recycle-body"},[e(Ve,{current:a(t),"onUpdate:current":V[2]||(V[2]=j=>te(t)?t.value=j:null),limit:a(l),"onUpdate:limit":V[3]||(V[3]=j=>te(l)?l.value=j:null),selected:p.value,"onUpdate:selected":V[4]||(V[4]=j=>p.value=j),onRefresh:a(F),multiple:"",data:a(r),total:a(P),loading:a(g),showFields:m.value,fields:w.value,tableMode:a(f),border:"",isSelect:"",autoHeight:"",isClick:"",onRowClick:se},null,8,["current","limit","selected","onRefresh","data","total","loading","showFields","fields","tableMode"])])],512)]),_:1},512)]),_:1},8,["modelValue"]),e(_l,{modelValue:T.value,"onUpdate:modelValue":V[6]||(V[6]=j=>T.value=j),prop:q.value},null,8,["modelValue","prop"])],64)}}});const Tl=Z(Ol,[["__scopeId","data-v-892ce4a9"]]),Ul=G({__name:"DataManagement",props:{appId:{},entryId:{}},setup(M){const y=M,n=I(),h=I(),d=A(()=>{var t,l;return((l=(t=h.value)==null?void 0:t.formInfo)==null?void 0:l.daSourceId)??""}),c=I(),b=gl(),x=async()=>{var l;if(!y.appId||!y.entryId)return Promise.reject({msg:"参数异常",loadState:fe.danger});const t=await b.getFormAllInfo(y.entryId);if(!hl(t))return Promise.reject({msg:"该表单已被删除或者无权限访问",loadState:fe.danger});if(h.value=t,!d.value)return Promise.reject({msg:"关键参数缺失, 请联系管理员",loadState:fe.danger});c.value=(l=await b.getSoureceData(d.value))==null?void 0:l.fields};Q([()=>y.entryId,()=>y.appId],()=>{var t;(t=n.value)==null||t.reload(),i.value=[]});const R=I(),w=A(()=>`${y.entryId}.dataManage`),L=async()=>{await bl({list:i.value}),Fl.success("批量删除成功"),f()},{sortFields:N,filterFields:D,tableFields:o,tableMode:u}=ae(w),i=I([]),_=A(()=>o.value.filter(t=>t.show).map(t=>({fieldId:t.prop}))),O=A(()=>({sourceId:d.value,conditions:D.value,sortField:N.value,showField:[]})),{getData:f,tableData:p,loading:m,current:v,limit:F,total:r}=be(O),g=A(()=>({current:v.value,limit:F.value,daSourceId:d.value,viewId:"",select:{orderBys:N.value.map(l=>({column:l.fieldId,sort:l.type})),conditions:D.value,tableNames:[y.entryId]}}));return Q(p,t=>{i.value=i.value.map(l=>t.find(P=>ce(P)===ce(l))).filter(l=>!!l)}),Q(O,(t,l)=>{O.value.sourceId&&!Fe(t,l)&&f()},{immediate:!0}),(t,l)=>{const P=Y,E=W,T=Ee;return k(),X(we,{load:x,class:"data_manage",ref_key:"loadingPageRef",ref:n},{default:s(()=>[C("div",{class:"data_manage-content",ref_key:"containerEl",ref:R},[C("div",{class:"data_manage-header"},[C("div",{class:"header-btns"},[e(Vl,{prop:{renderOptions:{mode:a(ke).enter,entryId:t.entryId}},onSuccess:a(f)},null,8,["prop","onSuccess"]),e(Pl,{sourceId:a(d),onRefresh:a(f)},null,8,["sourceId","onRefresh"]),e(Nl,{selectItems:a(i),totalFields:a(c)??[],params:a(g),sourceId:a(d),entryIds:t.entryId},null,8,["selectItems","totalFields","params","sourceId","entryIds"]),e(Il,{title:"确定要删除所选中项数据吗?",confirm:L},{reference:s(()=>{var U;return[e(P,{type:"danger",disabled:!((U=a(i))!=null&&U.length)},{default:s(()=>[z(" 批量删除 ")]),_:1},8,["disabled"])]}),_:1}),e(Tl,{entryId:t.entryId,configId:`${a(w)}_recycle`,sourceId:a(d),fields:a(c),onRefresh:a(f)},null,8,["entryId","configId","sourceId","fields","onRefresh"])]),C("div",{class:"operation-other"},[e(T,null,{default:s(()=>[e(E,{content:"刷新",placement:"top","show-after":300},{default:s(()=>[e(P,{icon:a(Se),onClick:l[0]||(l[0]=U=>a(f)())},null,8,["icon"])]),_:1}),e(Re,{fullEl:a(R)},null,8,["fullEl"]),e($e,{configId:a(w)},null,8,["configId"]),e(Ce,{configId:a(w),fields:a(c)},null,8,["configId","fields"]),e(De,{configId:a(w),fields:a(c)},null,8,["configId","fields"]),e(Ne,{configId:a(w),sourceId:a(d)},null,8,["configId","sourceId"])]),_:1})])]),C("div",{class:"data_manage-body"},[e(Ve,{current:a(v),"onUpdate:current":l[1]||(l[1]=U=>te(v)?v.value=U:null),limit:a(F),"onUpdate:limit":l[2]||(l[2]=U=>te(F)?F.value=U:null),selected:a(i),"onUpdate:selected":l[3]||(l[3]=U=>te(i)?i.value=U:null),onRefresh:a(f),multiple:"",data:a(p),total:a(r),loading:a(m),showFields:a(_),fields:a(c),tableMode:a(u),border:"",isSelect:"",autoHeight:"",clickToDetails:"",detailsPrevAndNext:"",sourceId:a(d),operatorByView:["edit","delete","print"],isAllowShowAndEdit:"",hideValidate:["edit"],saveNoLink:["edit"]},null,8,["current","limit","selected","onRefresh","data","total","loading","showFields","fields","tableMode","sourceId"])])],512)]),_:1},512)}}});const Ml=Z(Ul,[["__scopeId","data-v-f722ba65"]]),Al=G({__name:"routePage",setup(M){const y=ye("appId"),n=ye("entryId"),h=()=>{y?ve(wl,{replace:!0,query:{appId:y.value,entryId:n.value,manager:"1"}}):ve(Sl,{replace:!0})};return(d,c)=>{const b=xe;return k(),$("div",{class:"dataManagement-page"},[C("div",{class:"dataManagement-header"},[e(b,{class:"dataManagement-back",onClick:h},{default:s(()=>[e(a(kl))]),_:1}),C("span",{style:{"line-height":"1"}},"数据管理")]),C("div",{class:"dataManagement-body"},[e(Ml,{appId:a(y)??"","entry-id":a(n)??""},null,8,["appId","entry-id"])])])}}});const it=Z(Al,[["__scopeId","data-v-3aeca1f8"]]);export{it as default};

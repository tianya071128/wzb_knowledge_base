import{bI as G,bJ as X,bK as Y,d as B,r as m,c as I,o as x,b as w,w as r,i as l,d9 as Z,B as t,bt as ee,bp as z,da as N,C as R,f as L,F as le,g as ae,ac as O,Q as $,ao as te,bm as H,v as oe,k,m as E,l as ne,bv as se,db as re,bH as P,aN as T,dc as de,dd as ie,a9 as ue,aa as ce,U as K,N as pe,O as me,_ as fe,de as F,df as _e,j as be,by as q,bs as W,dg as ge,bi as ve,c7 as ye,dh as xe}from"./index-b80d5ef5.js";import{_ as Ve}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import{d as Me}from"./default-component-4c80201b.js";const A=Symbol("组件创建数据控制中心");function he(){return Y({createModel:{...S},cloneModel:{...S}})}function j(){const f=G(A,void 0);if(f)return f;{const _=he();return X(A,_),_}}const S={icon:"",name:"",useScene:"",version:"",refer:"",className:"",classId:""},Ce=B({__name:"BasicInfo",setup(f,{expose:_}){const o=j(),c=m(),d=I({get(){var a;return o.createModel.useScene?(a=o.createModel.useScene)==null?void 0:a.split(","):[]},set(a){o.createModel.useScene=a.join(",")}});return _({validForm:async()=>{var a;try{return await((a=c.value)==null?void 0:a.validate())}catch{throw"basic"}}}),(a,e)=>{const i=O,g=$,b=te,s=H;return x(),w(s,{"label-width":"90px","label-suffix":":",model:t(o).createModel,ref_key:"formRef",ref:c},{default:r(()=>[l(i,{label:"图标"},{default:r(()=>[l(Z,{limit:1,modelValue:t(o).createModel.icon,"onUpdate:modelValue":e[0]||(e[0]=n=>t(o).createModel.icon=n),size:500,accept:["bmp","png","jpg","jpeg"]},null,8,["modelValue"])]),_:1}),l(i,{label:"组件名称",prop:"name",rules:[{required:!0,message:"请输入组件名称",trigger:"blur"}]},{default:r(()=>[l(g,{modelValue:t(o).createModel.name,"onUpdate:modelValue":e[1]||(e[1]=n=>t(o).createModel.name=n),placeholder:"请输入组件名称","show-word-limit":"",maxlength:50},null,8,["modelValue"])]),_:1}),l(i,{label:"使用场景",prop:"useScene",rules:[{required:!0,message:"请选择使用场景",trigger:"change"}]},{default:r(()=>[l(ee,{load:t(z)(t(N)),modelValue:t(d),"onUpdate:modelValue":e[2]||(e[2]=n=>R(d)?d.value=n:null),multiple:""},{default:r(({options:n})=>[(x(!0),L(le,null,ae(n,u=>(x(),w(b,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["load","modelValue"])]),_:1}),l(i,{label:"版本号",prop:"version",rules:[{required:!0,message:"请输入版本号",trigger:"blur"},{min:1,max:10,message:"长度在 1 到 10 个字符",trigger:"blur"}]},{default:r(()=>[l(g,{modelValue:t(o).createModel.version,"onUpdate:modelValue":e[3]||(e[3]=n=>t(o).createModel.version=n),placeholder:"请输入版本号"},null,8,["modelValue"])]),_:1}),l(i,{label:"描述"},{default:r(()=>[l(g,{modelValue:t(o).createModel.refer,"onUpdate:modelValue":e[4]||(e[4]=n=>t(o).createModel.refer=n),placeholder:"请输入组件描述",type:"textarea",autosize:{minRows:3,maxRows:20},"show-word-limit":"",maxlength:2e3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),we=B({__name:"Config",setup(f,{expose:_}){const o=j(),c=m();return _({validForm:async()=>{var d;try{return await((d=c.value)==null?void 0:d.validate())}catch{throw"config"}}}),(d,a)=>{const e=$,i=O,g=H;return x(),w(g,{"label-width":"130px","label-suffix":":",model:t(o).createModel,ref_key:"formRef",ref:c},{default:r(()=>[l(i,{label:"组件服务方法/类",prop:"className",rules:[{required:!0,message:"请输入组件服务方法/类",trigger:"blur"}]},{default:r(()=>[l(e,{modelValue:t(o).createModel.className,"onUpdate:modelValue":a[0]||(a[0]=b=>t(o).createModel.className=b),placeholder:"请输入方法路径"},null,8,["modelValue"])]),_:1}),l(i,{label:"组件惟一标识",prop:"classId",rules:[{required:!0,message:"请输入组件惟一标识",trigger:"blur"}]},{default:r(()=>[l(e,{modelValue:t(o).createModel.classId,"onUpdate:modelValue":a[1]||(a[1]=b=>t(o).createModel.classId=b),placeholder:"请输入组件惟一标识"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),ke=B({__name:"Create",props:{modelValue:{type:Boolean},mode:{},componentId:{}},emits:["update:modelValue","refresh"],setup(f,{emit:_}){const o=f,c=_,d=oe(o,"modelValue",c),a=m("basic"),e=j(),i=m(),g=m(),b=m(!1),s=m(!1),n=async()=>{var y,v;try{b.value=!0,await((y=i.value)==null?void 0:y.validForm()),await((v=g.value)==null?void 0:v.validForm());const p=await re(e.createModel);e.createModel.id=p,e.cloneModel=P(e.createModel),T.success("保存成功"),c("refresh")}catch(p){throw p==="basic"&&a.value!=="basic"?a.value="basic":p==="config"&&a.value!=="config"&&(a.value="config"),p}finally{b.value=!1}},u=I(()=>o.mode==="edit"),V=async()=>{a.value="basic",u.value?(e.createModel=await de(o.componentId),e.cloneModel=P(e.createModel)):(e.createModel={...S},e.cloneModel={...S})},M=I(()=>!!e.createModel.id),J=async()=>{try{s.value=!0,await ie(e.createModel.id??""),T.success("发布成功"),c("refresh"),d.value=!1}finally{s.value=!1}},Q=y=>{ue(e.createModel,e.cloneModel)?y():ce.confirm("当前页面有内容修改后未保存，是否保存？","页面修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(p,h,C){p==="confirm"?(h.confirmButtonLoading=!0,n().then(()=>{y()}).finally(()=>{C(),h.confirmButtonLoading=!1})):p==="cancel"?(C(),y()):p==="close"&&C()}})};return(y,v)=>{const p=K,h=pe,C=me;return x(),w(se,{modelValue:t(d),"onUpdate:modelValue":v[1]||(v[1]=U=>R(d)?d.value=U:null),direction:"btt",size:"90%","show-load":V,"before-close":Q},{header:r(()=>[k("span",null,"创建组件")]),default:r(()=>[k("div",{class:"button-wrapper"},[l(p,{type:"primary",onClick:n,loading:t(b)},{default:r(()=>[E(" 保存 ")]),_:1},8,["loading"]),t(a)==="config"?(x(),w(p,{key:0,type:"primary",disabled:!t(M),onClick:J},{default:r(()=>[E(" 发布 ")]),_:1},8,["disabled"])):ne("",!0)]),l(C,{class:"my-tabs",modelValue:t(a),"onUpdate:modelValue":v[0]||(v[0]=U=>R(a)?a.value=U:null)},{default:r(()=>[l(h,{label:"基础信息",name:"basic"},{default:r(()=>[k("div",{class:"form-wrapper"},[l(Ce,{ref_key:"basicRef",ref:i},null,512)])]),_:1}),l(h,{label:"组件配置",name:"config"},{default:r(()=>[k("div",{class:"form-wrapper"},[l(we,{ref_key:"configRef",ref:g},null,512)])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}});const Ie=fe(ke,[["__scopeId","data-v-8c284fd6"]]);function D(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!ye(f)}const Be=B({__name:"routePage",setup(f){const _=m(),o=I(()=>({query:{list:[{type:"input",label:"组件名称",prop:"name"},{type:"select",label:"使用场景",prop:"useScene",options:z(N)},{type:"select",label:"状态",prop:"status",options:z(F)}]},request:{api:_e},operation:{fullEl:_},table:{tableCols:[{label:"图标",prop:"icon",minWidth:"55px",slots:{default(s){return l("img",{src:s.row.icon||Me,style:"width: 24px"},null)}}},{label:"组件名称",prop:"name",minWidth:"150px"},{label:"说明",prop:"refer",minWidth:"300px",slots:{default({row:s}){return l(be,{content:s.refer,line:4},null)}}},{label:"使用场景",prop:"useScene",minWidth:"240px",slots:{default({row:s}){var u;if(!s.useScene)return l("span",null,[E("-")]);const n=((u=s.useScene)==null?void 0:u.split(","))??[];return l("div",{style:"display: flex; gap: 4px;flex-wrap: wrap"},[n.map(V=>{let M;return l(q,{type:"info"},D(M=W(V,N))?M:{default:()=>[M]})})])}}},{label:"版本号",prop:"version",minWidth:"80px"},{label:"创建时间",prop:"createTime",minWidth:"170px"},{label:"状态",prop:"status",slots:{default({row:s}){let n;const u=s.status==ge.publish?"primary":"info";return l(q,{type:u},D(n=W(s.status,F))?n:{default:()=>[n]})}}},{label:"操作",fixed:"right",minWidth:"96px",slots:{default({row:s}){return l(Ve,{num:3,list:[{type:"primary",onClick:()=>{a.value="edit",e.value=s.id,d.value=!0},text:"编辑"},{type:"danger",text:"删除",popconfirmProps:{title:"删除后组件将不可恢复，确定要删除？",confirm:async()=>{await xe(s.id),T.success("删除成功"),i()}}}],rowId:s.id},null)}}}]}})),c=m(),d=m(!1),a=m("add"),e=m(""),i=()=>{c.value.refresh()},g=()=>{a.value="add",e.value="",d.value=!0};return(b,s)=>{const n=K,u=ve("az-page");return x(),L("div",{class:"layout_box",ref_key:"pendingRef",ref:_},[l(u,{config:t(o),ref_key:"azPageRef",ref:c,maxHeight:"var(--az-layout-main-height) - 40px"},{operation:r(()=>[l(n,{type:"primary",onClick:g},{default:r(()=>[E("创建组件")]),_:1})]),_:1},8,["config"]),l(Ie,{modelValue:t(d),"onUpdate:modelValue":s[0]||(s[0]=V=>R(d)?d.value=V:null),mode:t(a),componentId:t(e),onRefresh:i},null,8,["modelValue","mode","componentId"])],512)}}});export{Be as default};

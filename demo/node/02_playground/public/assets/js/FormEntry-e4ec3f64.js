import{d as V,v as P,r as D,p5 as N,o as y,b as f,w as d,i as h,B as e,m as w,bt as H,bp as J,p9 as G,f as U,F as R,g as q,C as S,p6 as X,p7 as Y,ao as j,ac as Q,bm as K,U as M,bn as O,c as A,e9 as Z,k as b,bF as ee,t as ae,fo as te,Q as oe,_ as L,h as se,L as le,dH as ne,b0 as re,l as v,dJ as ie,bD as W,dx as de,dw as ue,bv as pe,cg as me,ch as ye,b4 as B,zd as ce,dW as fe,y as he,bz as _e,ze as ge,p8 as be,e as Ie,ij as xe,S as Te,cW as De,zf as ve}from"./index-b80d5ef5.js";import{_ as we}from"./form-success-1777d0da.js";import{d as Ce}from"./dataShare-2d7ae3f7.js";import{u as $,a as k}from"./routePage-d8a1866d.js";import{Q as Ve}from"./Qrcode-850531ac.js";import{D as Ae,O as Se,a as Me}from"./usePublicRelease-2335b254.js";import ke from"./FormDraft-2c526b4f.js";import{P as Ee}from"./PageContainer-f97fee2b.js";import{e as E}from"./index-c4a56c4a.js";import{a as F,e as Be}from"./dashboardDesigner-ce3c2e23.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";import"./useExtractQuery-f96f705c.js";import"./TemplateIcon-2baf2fac.js";import"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import"./homePage-3523f56f.js";import"./SelectDataSourece-70a968c3.js";import"./SelectIcon-71b7daf2.js";import"./AppIconNew-704f70f4.js";import"./useTransformColor-38b5da33.js";import"./enum-baae9292.js";import"./LoadingData-195d0581.js";import"./useQueryTab-05fa7456.js";import"./store-3b56af45.js";import"./index-c8016e23.js";import"./appManage-8a2e3832.js";import"./html2canvas.esm-0543ed55.js";import"./EditDraft-5267672c.js";function Pe(r){return r===null}const Ue=V({__name:"GenerateDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(r,{emit:a}){const o=r,_=a,p=P(o,"modelValue",_),l=$(),t=D({shareRange:N.public}),u=D(!1),m=async()=>{var i,n;try{u.value=!0;const c={isSendMsg:X.no,shareData:((i=l.selectedEntry)==null?void 0:i.name)??"",entryId:((n=l.selectedEntry)==null?void 0:n.id)??"",shareRange:t.value.shareRange,shareType:Y.form},I=await Ce(c);_("success",I),p.value=!1}finally{u.value=!1}};return(i,n)=>{const c=j,I=Q,s=K,x=M,T=O;return y(),f(T,{title:"分享",width:"500","append-to-body":"",modelValue:e(p),"onUpdate:modelValue":n[1]||(n[1]=g=>S(p)?p.value=g:null)},{footer:d(()=>[h(x,{type:"primary",onClick:m,loading:e(u)},{default:d(()=>[w(" 生成分享链接 ")]),_:1},8,["loading"])]),default:d(()=>[h(s,null,{default:d(()=>[h(I,{label:"分享范围"},{default:d(()=>[h(H,{modelValue:e(t).shareRange,"onUpdate:modelValue":n[0]||(n[0]=g=>e(t).shareRange=g),load:e(J)(e(G))},{default:d(({options:g})=>[(y(!0),U(R,null,q(g,C=>(y(),f(c,{key:C.value,label:C.label,value:C.value,disabled:C.value===e(N).designee},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","load"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Le=V({__name:"LinkDialog",props:{modelValue:{type:Boolean},data:{}},emits:["update:modelValue"],setup(r,{emit:a}){const o=r,p=P(o,"modelValue",a),l=A(()=>{var i,n;let m=`#/sharePage?shareId=${(i=o.data)==null?void 0:i.id}&sign=${(n=o.data)==null?void 0:n.sign}`;return m=Z.join(location.host,location.pathname,m),`${location.protocol}//${m}`}),t=()=>{te(l.value)},u=A(()=>{var i,n,c,I;switch((i=o.data)==null?void 0:i.expiraDateSelect){case Me:return"永久有效";case Se:return"一次性链接";case Ae:return`${(n=o.data)==null?void 0:n.expiraStartDate}-${(c=o.data)==null?void 0:c.expiraEndDate}`;default:return`至${(I=o.data)==null?void 0:I.expiraEndDate}`}});return(m,i)=>{const n=oe,c=M,I=O;return y(),f(I,{title:"外部公开分享链接",width:"600","append-to-body":"",modelValue:e(p),"onUpdate:modelValue":i[0]||(i[0]=s=>S(p)?p.value=s:null)},{default:d(()=>[b("div",null,"生成独立的公开访问链接，获得链接的人员无需登录即可访问"),b("div",{class:"code_wrapper"},[h(Ve,{style:{margin:"0 auto"},ref:"qrcodeRef",text:e(l),filename:"邀请成员","tip-text":"录入信息后加入我们",title:"邀请您加入我们"},null,8,["text"])]),b("div",{class:"link-wrapper"},[h(n,{modelValue:e(l),readonly:""},null,8,["modelValue"]),h(c,{onClick:t,type:"primary",plain:"",icon:e(ee)},{default:d(()=>[w(" 复制 ")]),_:1},8,["icon"])]),b("div",null,"有效期： "+ae(e(u)),1)]),_:1},8,["modelValue"])}}});const Ne=L(Le,[["__scopeId","data-v-9e9718bc"]]),Fe=V({__name:"FormShare",setup(r,{expose:a}){const o=D(!1),_=D(!1),p=D(),l=t=>{p.value=t,_.value=!0};return a({share:()=>{o.value=!0}}),(t,u)=>(y(),U(R,null,[h(Ue,{modelValue:e(o),"onUpdate:modelValue":u[0]||(u[0]=m=>S(o)?o.value=m:null),onSuccess:l},null,8,["modelValue"]),h(Ne,{modelValue:e(_),"onUpdate:modelValue":u[1]||(u[1]=m=>S(_)?_.value=m:null),data:e(p)},null,8,["modelValue","data"])],64))}}),z=[{moduleId:"_processAnalysis_0",label:"已创建",layout:{h:5,w:12,x:0,y:0,minH:1,minW:12},flowIndexType:0,dashboardType:"indicatorsChart",dataConfig:{xArrangeData:[],xData:[],yData:[{proportion:0,summaryMethod:"COUNT",dataFormat:{unit:0,isPrecision:!1,toPrecision:2,format:1,isNumberLevel:!1,isTextUnit:!1,isThousandth:!1,textUnit:""},formula:"",orderBy:"0",label:"数据条数",position:"left",tag:"a_20264211854",isMissTime:"off",fieldType:"input",fieldId:"id_"}],conditions:[],orderBys:[],target:[]},dashboardStyle:{size:1,allStyle:{bg:{img:"",type:"color",color:"",fillType:"auto"},title:{color:""}},customColors:[],colorScheme:0}},{moduleId:"_processAnalysis_1",label:"进行中",layout:{h:5,w:12,x:12,y:0,minH:1,minW:12},flowIndexType:1,dashboardType:"indicatorsChart",dataConfig:{xArrangeData:[],xData:[],yData:[{proportion:0,summaryMethod:"COUNT",dataFormat:{unit:0,isPrecision:!1,toPrecision:2,format:1,isNumberLevel:!1,isTextUnit:!1,isThousandth:!1,textUnit:""},formula:"",orderBy:"0",label:"数据条数",position:"left",tag:"a_158347389322",isMissTime:"off",fieldType:"input",fieldId:"id_"}],conditions:[],orderBys:[],target:[]},dashboardStyle:{size:1,allStyle:{bg:{img:"",type:"color",color:"",fillType:"auto"},title:{color:""}},customColors:[],colorScheme:0}},{moduleId:"_processAnalysis_2",label:"已完成",layout:{h:5,w:12,x:24,y:0,minH:1,minW:12},flowIndexType:2,dashboardType:"indicatorsChart",dataConfig:{xArrangeData:[],xData:[],yData:[{proportion:0,summaryMethod:"COUNT",dataFormat:{unit:0,isPrecision:!1,toPrecision:2,format:1,isNumberLevel:!1,isTextUnit:!1,isThousandth:!1,textUnit:""},formula:"",orderBy:"0",label:"数据条数",position:"left",tag:"a_864291043023",isMissTime:"off",fieldType:"input",fieldId:"id_"}],conditions:[],orderBys:[],target:[]},dashboardStyle:{size:1,allStyle:{bg:{img:"",type:"color",color:"",fillType:"auto"},title:{color:""}},customColors:[],colorScheme:0}},{moduleId:"_processAnalysis_3",label:"已中止",layout:{h:5,w:12,x:36,y:0,minH:1,minW:12},dashboardType:"indicatorsChart",flowIndexType:3,dataConfig:{xArrangeData:[],xData:[],yData:[{proportion:0,summaryMethod:"COUNT",dataFormat:{unit:0,isPrecision:!1,toPrecision:2,format:1,isNumberLevel:!1,isTextUnit:!1,isThousandth:!1,textUnit:""},formula:"",orderBy:"0",label:"数据条数",position:"left",tag:"a_687704953260",isMissTime:"off",fieldType:"input",fieldId:"id_"}],conditions:[],orderBys:[],target:[]},dashboardStyle:{size:1,allStyle:{bg:{img:"",type:"color",color:"",fillType:"auto"},title:{color:""}},customColors:[],colorScheme:0}},{moduleId:"_processAnalysis_4",label:"平均处理时间",layout:{h:5,w:12,x:48,y:0,minH:1,minW:12},dashboardType:"indicatorsChart",flowIndexType:6,dataConfig:{xArrangeData:[],xData:[],yData:[{proportion:0,summaryMethod:"AVG",dataFormat:{unit:0,isPrecision:!0,toPrecision:2,format:1,isNumberLevel:!1,isTextUnit:!0,isThousandth:!1,textUnit:"小时"},formula:"",orderBy:"0",label:"平均处理时间(小时)",position:"left",tag:"a_638108673777",isMissTime:"off",fieldType:"time",fieldId:"duration_"}],conditions:[],orderBys:[],target:[]},dashboardStyle:{size:1,allStyle:{bg:{img:"",type:"color",color:"",fillType:"auto"},title:{color:""}},customColors:[],colorScheme:0}},{moduleId:"_processAnalysis_5",dashboardType:"columnChart",label:"节点待办数量",layout:{h:10,w:30,x:0,y:5,minH:1,minW:12},flowIndexType:5,dataConfig:{xArrangeData:[],xData:[{summaryMethod:"",formula:"",orderBy:"0",label:"节点",tag:"a_549455048551",isMissTime:"off",fieldType:"input",fieldId:"act_name_"}],yData:[{proportion:0,summaryMethod:"COUNT",dataFormat:{unit:0,isPrecision:!1,toPrecision:2,format:1,isNumberLevel:!1,isTextUnit:!1,isThousandth:!1,textUnit:""},formula:"",orderBy:"0",label:"数据条数",position:"left",tag:"a_240115158847",isMissTime:"off",fieldType:"input",fieldId:"act_name_"}],conditions:[],orderBys:[],target:[]},dashboardStyle:{barWidth:null,xDisplay:{title:"节点",maxVal:null,minVal:null,textDir:0,showTitle:!0},yDisplay:{title:"待办数量",maxVal:null,minVal:null,textDir:0,lineStyle:1,showTitle:!0},graphType:"1",showDataLabel:!0,showTitle:!0,customColors:[],showLegend:!0,showY:!0,showX:!0,colorScheme:0,legendType:"1"}},{moduleId:"_processAnalysis_6",label:"节点平均处理时间",layout:{h:10,w:30,x:30,y:5,minH:1,minW:12},dashboardType:"columnChart",flowIndexType:6,dataConfig:{xArrangeData:[],xData:[{summaryMethod:"",formula:"",orderBy:"0",label:"节点",tag:"a_836892336915",isMissTime:"off",fieldType:"input",fieldId:"act_name_"}],yData:[{proportion:0,summaryMethod:"AVG",dataFormat:{unit:0,isPrecision:!0,toPrecision:2,format:1,isNumberLevel:!1,isTextUnit:!1,isThousandth:!1,textUnit:""},formula:"",orderBy:"0",label:"平均处理时间(小时)",position:"left",tag:"a_274433024418",isMissTime:"off",fieldType:"time",fieldId:"duration_"}],conditions:[],orderBys:[],target:[]},dashboardStyle:{barWidth:null,xDisplay:{title:"节点",maxVal:null,minVal:null,textDir:0,showTitle:!0},yDisplay:{title:"时间/小时",maxVal:null,minVal:null,textDir:0,lineStyle:1,showTitle:!0},graphType:"1",showDataLabel:!0,showTitle:!0,customColors:[],showLegend:!0,showY:!0,showX:!0,colorScheme:0,legendType:"1"}},{moduleId:"_processAnalysis_7",label:"成员待办数量",layout:{h:10,w:30,x:0,y:15,minH:1,minW:12},dashboardType:"columnChart",flowIndexType:1,dataConfig:{xArrangeData:[],xData:[{summaryMethod:"",formula:"",orderBy:"0",label:"成员",tag:"a_302259774656",isMissTime:"off",fieldType:"member",fieldId:"assignee_"}],yData:[{proportion:0,summaryMethod:"COUNT",dataFormat:{unit:0,isPrecision:!1,toPrecision:2,format:1,isNumberLevel:!1,isTextUnit:!1,isThousandth:!1,textUnit:""},formula:"",orderBy:"0",label:"数据条数",position:"left",tag:"a_727466323994",isMissTime:"off",fieldType:"input",fieldId:"id_"}],conditions:[],orderBys:[],target:[]},dashboardStyle:{barWidth:null,xDisplay:{title:"成员",maxVal:null,minVal:null,textDir:0,showTitle:!0},yDisplay:{title:"待办数量",maxVal:null,minVal:null,textDir:0,lineStyle:1,showTitle:!0},graphType:"1",showDataLabel:!0,showTitle:!0,customColors:[],showLegend:!0,showY:!0,showX:!0,colorScheme:0,legendType:"1"}},{moduleId:"_processAnalysis_8",label:"成员平均处理时间",layout:{h:10,w:30,x:30,y:15,minH:1,minW:12},dashboardType:"columnChart",flowIndexType:6,dataConfig:{xArrangeData:[],xData:[{summaryMethod:"",formula:"",orderBy:"0",label:"成员",tag:"a_397627052720",isMissTime:"off",fieldType:"member",fieldId:"assignee_"}],yData:[{proportion:0,summaryMethod:"AVG",dataFormat:{unit:0,isPrecision:!0,toPrecision:2,format:1,isNumberLevel:!1,isTextUnit:!1,isThousandth:!1,textUnit:""},formula:"",orderBy:"0",label:"平均处理时间(小时)",position:"left",tag:"a_150267008855",isMissTime:"off",fieldType:"time",fieldId:"duration_"}],conditions:[],orderBys:[],target:[]},dashboardStyle:{barWidth:null,xDisplay:{title:"成员",maxVal:null,minVal:null,textDir:0,showTitle:!0},yDisplay:{title:"时间/小时",maxVal:null,minVal:null,textDir:0,lineStyle:1,showTitle:!0},graphType:"1",showDataLabel:!0,showTitle:!0,customColors:[],showLegend:!0,showY:!0,showX:!0,colorScheme:0,legendType:"1"}}],Re=()=>z.map((r,a)=>({type:"processAnalysis",layout:r.layout,mobile:{h:5,w:60,x:0,y:0,minH:5,minW:60},options:{label:r.label,entryId:"",sourceId:"",showLabel:!0,dashboardId:""},moduleId:r.moduleId})),Oe=()=>z.map(r=>({id:"",entryId:"",type:1,frontType:1,flowIndexType:r.flowIndexType,auth:"ALL",moduleId:r.moduleId,sourceIds:[],dashboardName:null,columnJson:[],dashboardType:r.dashboardType,dataConfig:r.dataConfig,dashboardStyle:r.dashboardStyle})),We=V({__name:"AnalysisVerify",props:{loadData:{type:Function},entryId:{},appId:{}},setup(r){const a=r,o=async()=>{const t=await _();if(Pe(t.pageeJson)){const u=await p(t.daSourceId),m={modules:Re().map((n,c)=>({...n,options:{label:n.options.label,entryId:a.entryId,sourceId:u[c].sourceIds.join(","),showLabel:n.options.showLabel,dashboardId:u[c].id}}))};await l({id:t.id,pageeJson:m,pageConfig:t.pageeConfig});const i=await _();await a.loadData(i)}else await a.loadData(t)},_=async()=>await F.getByBindEntryId({appId:a.appId,entryId:a.entryId}),p=async t=>{const m=Oe().map(i=>({...i,entryId:a.entryId,sourceIds:[t]}));return await F.batchSave(m)},l=async t=>await Be({appId:a.appId,entryId:a.entryId,id:t.id,pageeJson:t.pageeJson,pageeConfig:t.pageConfig});return(t,u)=>(y(),f(le,{load:o},{default:d(()=>[se(t.$slots,"default")]),_:3}))}}),$e=V({__name:"Analysis",props:{visible:{type:Boolean},appId:{},entryId:{}},emits:["update:visible"],setup(r,{emit:a}){const o=r,p=P(o,"visible",a),l=D(),t=D(),u=me(()=>ye(()=>import("./render-bd995381.js"),["./render-bd995381.js","./createDesigner-82222fc7.js","./index-b80d5ef5.js","..\\css\\index-13cb634b.css","./enum-baae9292.js","..\\css\\createDesigner-305fe05d.css","..\\css\\render-a1eee7d5.css"],import.meta.url)),m=async s=>{t.value=s.pageeJson,l.value=s},i=D(),{toggle:n}=ne(i),c=async()=>{var s;(s=i.value)==null||s.asyncRefreshAll()},I=async()=>{B(ce,{query:{appEntryId:o.entryId,appId:o.appId}})};return(s,x)=>{const T=M;return y(),f(pe,{class:"analysis-drawer",size:"80%",title:"流程分析",modelValue:e(p),"onUpdate:modelValue":x[0]||(x[0]=g=>S(p)?p.value=g:null)},{header:d(()=>{var g,C;return[b("div",{class:"dr-box"},[b("div",{class:"title"},"流程分析"),(g=l.value)!=null&&g.pageeConfig.manualRefresh?(y(),f(T,{key:0,class:"header-btn",text:"",icon:e(re),type:"primary",onClick:c},{default:d(()=>[w(" 刷新 ")]),_:1},8,["icon"])):v("",!0),(C=l.value)!=null&&C.pageeConfig.fullScreen?(y(),f(T,{key:1,class:"header-btn",text:"",icon:e(ie),type:"primary",onClick:e(n)},{default:d(()=>[w(" 全屏 ")]),_:1},8,["icon","onClick"])):v("",!0),l.value?(y(),f(T,{key:2,class:"header-btn",text:"",icon:e(W),type:"primary",onClick:I},{default:d(()=>[w(" 自定义流程分析 ")]),_:1},8,["icon"])):v("",!0)])]}),default:d(()=>[h(We,{loadData:m,entryId:s.entryId,appId:s.appId},{default:d(()=>[l.value?(y(),f(e(u),{key:0,ref_key:"dashboardRef",ref:i,pageDesigner:t.value,pageConfig:l.value.pageeConfig,scene:e(de).dashboard,style:{height:"100%"},mode:e(ue).render,appId:s.appId,entryId:s.entryId},null,8,["pageDesigner","pageConfig","scene","mode","appId","entryId"])):v("",!0)]),_:1},8,["entryId","appId"])]),_:1},8,["modelValue"])}}});const ze=L($e,[["__scopeId","data-v-f5c1193c"]]),He=V({__name:"FormEntry",props:{appId:{},entry:{}},setup(r){const a=r,o=$(),_=()=>{B(De,{query:{appEntryId:a.entry.id,appId:a.appId}})},p=A(()=>({mode:fe.enter,entryId:a.entry.id,other:{enableAutoSave:!0}})),l=D(!1);he(()=>a.entry.id,()=>{l.value=!1});const t=A(()=>a.entry.hasFlow===1&&o.getOperatingPremission(k.entryAuth,{entryAuthtype:E.writeable,entryId:a.entry.id})),u=D(!1),m=()=>{u.value=!0},i=()=>{B(ve,{query:{entryId:a.entry.id,appId:a.appId}})},n=A(()=>{var s;return((s=o.selectedEntry)==null?void 0:s.publicReleaseStatus)===0}),c=D(),I=()=>{var s;(s=c.value)==null||s.share()};return(s,x)=>{const T=M;return y(),f(Ee,{entry:s.entry},{header:d(()=>[b("span",{style:{"margin-left":"auto"}},[e(o).getOperatingPremission(e(k).entryAuth,{entryAuthtype:e(E).writeable,entryId:a.entry.id})?(y(),f(T,{key:0,class:"header-btn",text:"",icon:e(W),type:"primary",onClick:_},{default:d(()=>[w(" 编辑 ")]),_:1},8,["icon"])):v("",!0),e(o).getOperatingPremission(e(k).entryAuth,{entryAuthtype:e(E).dataManage,entryId:a.entry.id})?(y(),f(T,{key:1,class:"header-btn",text:"",type:"primary",onClick:i},{default:d(()=>[h(_e,{iconClass:"other_table",style:{"margin-right":"7px"}}),w(" 数据管理 ")]),_:1})):v("",!0),e(t)?(y(),f(T,{key:2,class:"header-btn",text:"",icon:e(ge),type:"primary",onClick:m},{default:d(()=>[w(" 流程分析 ")]),_:1},8,["icon"])):v("",!0),e(n)?(y(),f(T,{key:3,class:"header-btn",text:"",icon:e(be),type:"primary",onClick:I},{default:d(()=>[w(" 分享 ")]),_:1},8,["icon"])):v("",!0),h(Fe,{ref_key:"shareRef",ref:c},null,512),h(ke,{entryId:s.entry.id,"empty-hide":"",type:"primary"},null,8,["entryId"])])]),default:d(()=>[b("div",{class:"form_entry"},[b("div",{class:"form_entry-container"},[Ie(b("div",{style:{height:"100%"}},[h(xe,{"render-options":e(p),onSuccess:x[0]||(x[0]=g=>l.value=!0)},null,8,["render-options"])],512),[[Te,!l.value]]),l.value?(y(),U("div",{key:0,class:"form-success-wrap"},[b("div",{class:"form-success"},[b("img",{class:"success-img",src:we,alt:""}),b("div",{class:"success-tip"},"提交成功"),h(T,{type:"primary",style:{width:"170px"},onClick:x[1]||(x[1]=g=>l.value=!1)},{default:d(()=>[w(" 继续添加 ")]),_:1})])])):v("",!0)])]),e(t)?(y(),f(ze,{key:0,visible:u.value,"onUpdate:visible":x[2]||(x[2]=g=>u.value=g),appId:s.appId,entryId:s.entry.id},null,8,["visible","appId","entryId"])):v("",!0)]),_:1},8,["entry"])}}});const ga=L(He,[["__scopeId","data-v-58707bb1"]]);export{ga as default};

import{M as ae}from"./ModuleWrapper-dbe018a4.js";import{u as oe}from"./useEditState-4239cd64.js";import{d as B,v as ne,r as L,x as se,y as M,Y as w,o as m,b as v,w as d,k as V,i as u,m as x,aq as q,f as E,F,g as S,B as p,t as ie,a5 as re,bF as ue,eu as de,l as N,C as U,bv as me,nz as ce,a9 as pe,aa as fe,q as _e,ac as ve,c5 as ge,ab as ye,bm as be,by as he,U as j,av as ke,c3 as Ve,Z as Ce,i5 as O,_ as G,e0 as T,j as Ee,ao as Ie,ap as xe,e3 as Le}from"./index-b80d5ef5.js";/* empty css                        */import{u as H,x as Me,y as De}from"./createDesigner-82222fc7.js";import{E as we}from"./EditorDraggable-a06dbc71.js";import{F as Fe,f as Se,c as Be,g as Ue,_ as $e}from"./index-4ee6cc8a.js";import{M as ze}from"./ModuleEmpty-f80311b1.js";import"./dashboardDesigner-ce3c2e23.js";import"./enum-baae9292.js";/* empty css                          */import"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import"./useFieldMaxWidth-d82f063e.js";import"./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js";import"./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js";import"./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js";import"./index-318b68f4.js";import"./AzInputNumber-d6212644.js";import"./el-input-number-c15b1cc7.js";import"./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js";import"./useMultipleVal-904406c1.js";import"./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js";import"./el-dropdown-item-455a6589.js";import"./CardShowFieldItem-fd24f218.js";const Ae=B({__name:"Setting",props:{moduleItem:{},visible:{type:Boolean}},emits:["update:visible"],setup(f,{emit:c}){const i=f,n=ne(i,"visible",c),r=L(),s=L(),g=se(),y=H(),t=L(i.moduleItem.options);M(n,()=>{n.value?t.value=w(i.moduleItem.options):s.value=void 0},{immediate:!0});const a=()=>Ce(t.value.filterList.map(l=>l.id)),b=()=>{const l={id:a(),name:`快捷选项${ce.cn.encodeS(t.value.filterList.length+1)}`,list:[]};t.value.filterList.push(l),$(l)},C=(l,e)=>{t.value.filterList.splice(e+1,0,{...w(l),name:`${l.name}_副本`.slice(0,10),id:a()})},P=l=>!!l.isDefault,Q=(l,e)=>{t.value.filterList.forEach(_=>_.isDefault=void 0),e&&(l.isDefault=!0)},$=l=>{s.value=l},W=l=>{var e;if(l.id===((e=s.value)==null?void 0:e.id))return"is-edit"};M(()=>[...t.value.filterList],()=>{t.value.filterList.some(l=>{var e;return l.id===((e=s.value)==null?void 0:e.id)})||(s.value=void 0)});const Y=()=>{if(!t.value.filterList.length)return O({title:"配置异常",message:"请至少添加一个快捷选项",type:"error"}),!1;const l=[];return t.value.filterList.forEach(e=>{if(!e.list.length){l.push(`${e.name}：请至少添加一个筛选条件`);return}e.list.forEach(_=>{const h=Be({pageDesigner:y,data:_,dataSystem:g});h&&l.push(`${e.name}的${_.name}：${h}`)})}),l.length?(O({title:"配置异常",dangerouslyUseHTMLString:!0,type:"error",message:l.join("<br />")}),!1):!0},Z=()=>{var l,e,_;(_=(e=(l=r.value)==null?void 0:l.drawerRef)==null?void 0:e.handleClose)==null||_.call(e)},z=l=>Y()===!1?!1:(i.moduleItem.options=w(t.value),!l&&(n.value=!1),!0),J=l=>{if(pe(i.moduleItem.options,t.value))return l(!1);fe.confirm("您修改了配置但没有保存，是否需要快速筛选的配置？","配置有修改，是否保存?",{confirmButtonText:"保存",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(e,_,h){e==="confirm"?z(!0)&&(l(!1),h()):e==="cancel"?(l(!1),h()):e==="close"&&(l(!0),h())}})};return(l,e)=>{const _=_e,h=ve,K=ge,X=ye,ee=be,te=he,D=j,A=ke,R=Ve;return m(),v(me,{modelValue:p(n),"onUpdate:modelValue":e[6]||(e[6]=o=>U(n)?n.value=o:null),"append-to-body":!0,direction:"btt",size:"90%",title:"快捷筛选设置",class:"page_filterquick-drawer",ref_key:"azDrawerRef",ref:r,"before-close":J},{footer:d(()=>[V("span",null,[u(D,{onClick:Z},{default:d(()=>[x("取消")]),_:1}),u(D,{type:"primary",onClick:e[5]||(e[5]=o=>z())},{default:d(()=>[x("确认")]),_:1})])]),default:d(()=>[V("div",{class:"page_filterquick-setting"},[u(ee,{class:"label-blod setting-header"},{default:d(()=>[u(h,{label:"标题"},{default:d(()=>[u(q,{modelValue:t.value.label,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.label=o),style:{width:"250px","margin-right":"10px"},maxlength:"10",isBlurCache:"",placeholder:"请输入标题"},null,8,["modelValue"]),u(_,{modelValue:t.value.showLabel,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.showLabel=o),label:"显示标题"},null,8,["modelValue"])]),_:1}),u(h,{label:"快捷选项样式"},{default:d(()=>[u(X,{modelValue:t.value.style,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.style=o)},{default:d(()=>[(m(!0),E(F,null,S(p(Me),o=>(m(),v(K,{key:o.value,label:o.value},{default:d(()=>[x(ie(o.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),V("div",{class:"setting-container"},[V("div",{class:"setting-container-left"},[V("div",{class:"left-title"},[u(te,{effect:"dark",round:"",size:"small","disable-transitions":""},{default:d(()=>[x(" 1 ")]),_:1}),V("span",{class:"ml-5"},"设置快捷选项")]),u(D,{type:"primary",text:"",icon:p(re),size:"large",onClick:b},{default:d(()=>[x(" 添加快捷选项 ")]),_:1},8,["icon"]),V("div",{class:"left-list"},[u(we,{class:"left-drag",modelValue:t.value.filterList,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.filterList=o),itemClass:W},{default:d(({element:o,index:le})=>[u(_,{"model-value":P(o),"onUpdate:modelValue":I=>Q(o,I),class:"checkbox-round"},null,8,["model-value","onUpdate:modelValue"]),u(q,{modelValue:o.name,"onUpdate:modelValue":I=>o.name=I,style:{width:"200px","margin-right":"10px"},maxlength:"10",isBlurCache:"",placeholder:"请输入筛选器名称"},null,8,["modelValue","onUpdate:modelValue"]),u(A,{underline:!1,title:"复制",icon:p(ue),onClick:I=>C(o,le)},null,8,["icon","onClick"]),u(A,{underline:!1,title:"编辑",icon:p(de),onClick:I=>$(o)},null,8,["icon","onClick"])]),_:1},8,["modelValue"]),t.value.filterList.length?N("",!0):(m(),v(R,{key:0,description:"请添加快捷选项"}))])]),V("div",{class:"setting-container-right"},[s.value?(m(),E("div",{style:{height:"100%"},key:s.value.id},[u(Fe,{modelValue:s.value.list,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.list=o),mode:p(Se).quick},null,8,["modelValue","mode"])])):(m(),v(R,{key:0,style:{height:"100%"},description:"请从左边选择要配置的筛选选项"}))])])])]),_:1},8,["modelValue"])}}});const Re=G(Ae,[["__scopeId","data-v-65f94deb"]]);function qe(f){const c=H(),i=L("");M(()=>{var s;return(s=f.options.filterList.find(g=>g.isDefault))==null?void 0:s.id},r=>{i.value=r??""},{immediate:!0});const k=r=>{if(i.value===r)return i.value="";i.value=r},n=r=>{const s=f.options.filterList.find(t=>r&&t.id===r),g=new Map;if(!s)return g;const y=new Map;return s.list.forEach(t=>{var C;const a=t.filterOption.operate;if(!a)return;const b=((C=t.filterOption.valueMap)==null?void 0:C[a])??null;(b!=null||[T.empty,T.noEmpty].includes(a))&&y.set(t.id,{operate:a,value:b})}),Ue({list:s.list,pageDesigner:c,screenValue:y})};return M(i,(r,s)=>{const g=n(r),y=n(s);g.forEach((t,a)=>{t!=null&&t.length&&(y.delete(a),c.moduleContextCallback({moduleId:a,id:f.moduleId,callback(b){b.handleFilter({id:f.moduleId,list:t})}}))}),y.forEach((t,a)=>{c.moduleContextCallback({moduleId:a,id:f.moduleId,callback(b){b.handleFilter({id:f.moduleId,list:[]})}})})},{immediate:!0}),{val:i,handleSelected:k}}const Oe=B({__name:"Main",props:{moduleItem:{}},setup(f){const c=f,{val:i,handleSelected:k}=qe(c.moduleItem);return(n,r)=>{const s=Ie,g=xe,y=j,t=Le;return m(),v($e,{style:{height:"100%"},moduleItem:n.moduleItem},{default:d(()=>[n.moduleItem.options.filterList.length?(m(),E("div",{key:0,class:"filter_quick-main"},[n.moduleItem.options.style===p(De).select?(m(),v(g,{key:0,modelValue:p(i),"onUpdate:modelValue":r[0]||(r[0]=a=>U(i)?i.value=a:null),class:"w100",placeholder:"请选择",clearable:""},{default:d(()=>[(m(!0),E(F,null,S(n.moduleItem.options.filterList,a=>(m(),v(s,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(m(),E("div",{key:1,class:"main-card",ref:"mainCardRef"},[u(t,{class:"ml-4"},{default:d(()=>[(m(!0),E(F,null,S(n.moduleItem.options.filterList,a=>(m(),v(y,{onClick:b=>p(k)(a.id),key:a.id,class:"filter_quick-button",tag:"span",type:a.id===p(i)?"primary":void 0},{default:d(()=>[u(Ee,{class:"main-option",content:a.name},null,8,["content"])]),_:2},1032,["onClick","type"]))),128))]),_:1})],512))])):(m(),v(ze,{key:1,description:"没有配置快捷选项"}))]),_:1},8,["moduleItem"])}}});const Te=G(Oe,[["__scopeId","data-v-116d3578"]]),ct=B({__name:"render",props:{moduleItem:{}},setup(f){const{editVisible:c,isDesignMode:i}=oe();return(k,n)=>(m(),v(ae,{"module-item":k.moduleItem,onEdit:n[1]||(n[1]=r=>c.value=!0)},{default:d(()=>[p(i)?(m(),v(Re,{key:0,visible:p(c),"onUpdate:visible":n[0]||(n[0]=r=>U(c)?c.value=r:null),moduleItem:k.moduleItem},null,8,["visible","moduleItem"])):N("",!0),u(Te,{moduleItem:k.moduleItem},null,8,["moduleItem"])]),_:1},8,["module-item"]))}});export{ct as default};

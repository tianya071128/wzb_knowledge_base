import{e9 as b,jG as g,r as f,c as d,wS as w,dW as r,a as y,wT as u,wU as m,wV as $,wW as T,wX as x,dX as V}from"./index-b80d5ef5.js";const A=t=>{var o;const e=(o=b.extname(t.name).slice(1))==null?void 0:o.toLocaleLowerCase();return t.accept.includes(e)};function k(t){const e=g(),o=f({}),F=d(()=>(e&&w({fieldId:t.field.options.fileSource,render:e}))??[]),p=f(new Map),h=d(()=>[r.edit,r.enter,r.preview,r.simple].includes(e==null?void 0:e.mode)),S=d(()=>t.field.type===y.fileEdit&&t.field.options.mode===u.create),I=f(m.edit),E=f(""),M=f($.no),v=l=>{if(t.field.type===y.fileEdit){const i=t.field.options.mode;(i===u.create||!l.length)&&(E.value=`${t.field.options.fileSource}.${l.length}`),M.value=i===u.create?$.no:t.field.options.version,I.value=i===u.create?m.create:i===u.editAndTrace?m.editAndTrace:l.length?m.edit:m.create}p.value=S.value?new Map:new Map(l.map((i,n)=>[`${t.field.options.fileSource}.${n}`,i]))};return{isShow:h,render:e,files:p,fieldValue:o,editMode:I,versionType:M,fileFieldVal:F,checkFileAndGetVal(){let l=!1,i=["pdf","ofd"];t.isMobile&&(i=["pdf"]),t.field.type===y.fileEdit&&(l=!!t.field.options.isCreate,i=["doc","docx"]);const n=t.field.options.fileSource?e.matchField(t.field.options.fileSource):null,a=n==null?void 0:n.field;if(!a||a.type!==y.uploadFile)return"没有找到需要设计的文件字段";const s=w({fieldId:a.fieldId,render:e})??[];if(!S.value){if(!l&&!(s!=null&&s.length))return`${a.options.label}：文件为空`;if(!s.every(c=>c.name&&A({name:c.name,accept:i})))return`${a.options.label}：文件格式不正确，仅支持 ${i.map(c=>c.toLocaleUpperCase()).join("、")} 类型`}o.value=T({formData:e.packageNormlData({format:!0}),entryId:e.entryId}),v(s)},handleSubmit(l,i,n){l==null&&(l=E.value);const[a,s]=(l==null?void 0:l.split("."))??"";if(!a||s==null||!(i!=null&&i.file)){console.error(`数据异常，${l}，${i}`);return}const c=[...w({fieldId:a,render:e})??[]];if(c[Number(s)]=i.file,x({fieldId:a,val:c,render:e}),n!=null&&n.isEnter){const D=V({entryId:e.entryId,rowData:(i==null?void 0:i.formData)??{}});e.fillVal(D)}}}}function L({field:t}){const e=g(),o=d(()=>e==null?void 0:e.matchField(t.options.fileSource)),F=d(()=>e&&t.options.fileSource&&w({fieldId:t.options.fileSource,render:e})||[]),p=d(()=>[r.edit,r.enter,r.preview,r.simple].includes(e==null?void 0:e.mode)),h=d(()=>o.value?`${o.value.field.options.label}：文件为空`:"没有找到对应的文件字段");return{render:e,fileFieldVal:F,isShow:p,fileFieldInfo:o,emptyErrorMsg:h}}export{k as a,L as u};

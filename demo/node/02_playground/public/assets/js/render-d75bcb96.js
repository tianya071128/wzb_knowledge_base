import{d as h,o as d,b as g,w as i,i as p,bf as pe,bd as me,pF as fe,f as V,F as $,g as R,I as Y,_ as Z,bK as P,c as M,dw as z,eK as ee,aN as L,k_ as H,v as ve,r as A,bu as ye,B as y,C as ge,bn as _e,ad as Ie,j as ke,m as be,bz as Ce,bt as Fe,l as Ae,U as Le,ao as we,ac as Me,bm as he}from"./index-b80d5ef5.js";import{M as Se}from"./ModuleWrapper-dbe018a4.js";import{j as Ve,k as $e,f as Ge,r as Ue,h as Ee,u as k,i as xe,m as Te,n as De}from"./homePage-3523f56f.js";import{V as Be}from"./ViewMore-2edbc0b5.js";import{S as Re}from"./SettingsFormWrapper-340ed4ef.js";import{_ as Pe}from"./ModuleTitleEditor.vue_vue_type_script_setup_true_lang-41e118cc.js";import{O as X}from"./enum-baae9292.js";import{G}from"./GridItem-674e6ecc.js";import{A as B}from"./AppFavorites-b5587807.js";import{G as oe}from"./GirdList-c2082769.js";import{M as te}from"./ModuleEmpty-f80311b1.js";import{u as N,f as ze}from"./createDesigner-82222fc7.js";import{S as Ne}from"./SelectEntry-8e2dec0a.js";import{u as We}from"./useAddModuleContext-27547570.js";import{s as Oe}from"./skeleton-9235483f.js";import"./dashboardDesigner-ce3c2e23.js";import"./AppIconNew-704f70f4.js";import"./useTransformColor-38b5da33.js";import"./AppIcon-5727720b.js";const Ke=h({__name:"Setting",props:{moduleItem:{}},setup(_){return(l,o)=>(d(),g(Re,null,{default:i(()=>[p(Pe,{"module-item":l.moduleItem},null,8,["module-item"])]),_:1}))}});function W(){const _=pe();return{goApp:({appId:r,entryId:e,openWith:u})=>{_(me,{query:{appId:r,entryId:e}},{isNewPage:u===X.newPage})},goMyTasks:(r,e)=>{_(fe,{query:r},{isNewPage:e===X.newPage})}}}const je=h({__name:"Auto",props:{list:{}},setup(_){const{goApp:l}=W(),o=e=>{l({appId:e==null?void 0:e.appId,entryId:e==null?void 0:e.entryId,openWith:"1"})},r=e=>({name:e.name,icon:e.icon,color:e.color,isGradient:!0,isBackGroundColor:!0});return(e,u)=>{var a;return(a=e.list)!=null&&a.length?(d(),g(oe,{key:0,list:e.list},{default:i(({list:m})=>[(d(!0),V($,null,R(m,t=>(d(),g(G,Y({key:t.id,onClick:b=>o(t)},{...r(t)}),null,16,["onClick"]))),128))]),_:1},8,["list"])):(d(),g(te,{key:1,description:"暂无常用"}))}}}),qe=h({__name:"Manual",props:{list:{}},emits:["change"],setup(_,{emit:l}){const o=l,{goApp:r}=W(),e=a=>{if(a.valid){const{appId:m,entryId:t}=a.entryInfo;r({appId:m,entryId:t??void 0})}},u=a=>({name:a.entryInfo.name,icon:a.entryInfo.icon,color:a.entryInfo.color,isGradient:a.type.toString()==="1",isBackGroundColor:a.type.toString()==="1"});return(a,m)=>{var t;return(t=a.list)!=null&&t.length?(d(),g(oe,{key:0,list:a.list},{default:i(({list:b})=>[(d(!0),V($,null,R(b,f=>(d(),g(G,Y({key:f.id,class:f.valid?"":"error_text"},{...u(f)},{onClick:c=>e(f)}),{collect:i(()=>[p(B,{onClickFavorites:c=>o("change",{type:c,item:f}),valid:!0},null,8,["onClickFavorites"])]),_:2},1040,["class","onClick"]))),128))]),_:1},8,["list"])):(d(),g(te,{key:1,description:"暂无常用"}))}}});const Je=Z(qe,[["__scopeId","data-v-a47b1c87"]]),Qe=[{id:"1701416808856264706",tenantId:"0",entryId:"1701416496955236353",appId:"1696054936594399233",entryType:"form",hasFlow:0,name:"示例数据",icon:"b-1",color:"#666666",counter:1,userId:"1696038156362694658",createTime:"2023-09-12 10:05:53",updateTime:"2023-09-12 10:05:53"},{id:"1701416475727863809",tenantId:"0",entryId:"1696060528885088257",appId:"1696054936594399233",entryType:"form",hasFlow:1,name:"示例数据",icon:"b-1",color:"#666666",counter:1,userId:"1696038156362694658",createTime:"2023-09-12 10:04:33",updateTime:"2023-09-12 10:04:33"}],He=()=>{const _=N(),l=P({loading:!1,oftenUseList:[]}),o=M(()=>z.design===_.mode),r=async()=>{l.loading=!0;try{const u=o.value?Qe:await Ve();l.oftenUseList=u.map(a=>({...a,color:"#478CFF"}))}finally{l.loading=!1}},e=async u=>{if(o.value){L.error("仅为样例数据");return}await $e({id:u}),L.success("已取消常用"),r()};return{...ee(l),getList:r,isDesignMode:o,handleClickAuto:e}},Xe=He,Ye=[{id:"1702139737923403777",valid:!0,type:1,entryInfo:{appId:"1695981606189252610",entryId:null,icon:"b-5",color:"#478CFF",name:"示例数据1"},sort:1024},{id:"1702139740137996289",valid:!0,type:1,entryInfo:{appId:"1696054936594399233",entryId:null,icon:"cooperation_menu",color:"#20CC98",name:"示例数据2"},sort:1792}],Ze=_=>{const l=N(),o=P({loading:!1,collectionsList:[]}),r=M(()=>z.design===l.mode),e=async()=>{o.loading=!0;try{const m=r.value?Ye:await Ge();o.collectionsList=m.map(t=>(t.valid||(t.entryInfo={...t.entryInfo,name:"常用已失效",icon:"QuestionFilled",color:"#b5b8be"}),t))}finally{o.loading=!1}},u=async(m,t)=>{if(r.value){L.error("仅为样例数据");return}await Ue(t.id),L.success("已取消常用"),e(),a()},a=()=>{l.getModuleContextByType([H.usually,H.myApp],l.moduleIds.filter(t=>t!==_.moduleId)).forEach(t=>{var b;t&&((b=t==null?void 0:t.refresh)==null||b.call(t))})};return{...ee(o),getList:e,handleClickFavorites:u,handleRefreshFa:a,isDesignMode:r}},eo=Ze,oo=h({__name:"AddCollections",props:{visible:{type:Boolean},title:{default:"未定义title"},collectionsList:{}},emits:["update:visible","refresh"],setup(_,{emit:l}){const o=l,r=_,e=ve(r,"visible",o),u=A([]),a=()=>{u.value=r.collectionsList.map(f=>{const c=f.entryInfo;return f.type===1?c.appId:`${c.appId}.${c.entryId??""}`}),u.value},m=()=>{},t=ze(),b=async()=>{const f=u.value.map(c=>{const I=t.id2Obj(c),C=I!=null&&I.entryId?I.entryId:I.appId,U=I!=null&&I.entryId?2:1;return{buId:C,type:U}});await Ee(f),L.success("添加成功"),o("refresh")};return(f,c)=>{const I=_e;return d(),g(I,{modelValue:y(e),"onUpdate:modelValue":c[2]||(c[2]=C=>ge(e)?e.value=C:null),title:f.title,width:"1000px",class:"custom_az_dialog","append-to-body":"","destroy-on-close":"",onOpen:a,onClose:m},{footer:i(()=>[p(ye,{editMode:!0,onClose:c[1]||(c[1]=C=>e.value=!1),"on-submit":b})]),default:i(()=>[p(Ne,{modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=C=>u.value=C)},null,8,["modelValue"])]),_:1},8,["modelValue","title"])}}}),to=h({__name:"render",props:{moduleItem:{}},setup(_){const l=_,o=A(k.auto),r=[{label:"自动生成",value:k.auto},{label:"手动管理",value:k.manual}],e=A(),u=P({refresh(){var s;o.value===k.manual&&((s=e.value)==null||s.reload())}});We(l.moduleItem.moduleId,u);const a=N(),m=M(()=>z.design===a.mode),{loading:t,oftenUseList:b,getList:f,handleClickAuto:c}=Xe(),{loading:I,collectionsList:C,getList:U,handleClickFavorites:E,handleRefreshFa:ne}=eo({moduleId:l.moduleItem.moduleId}),O=A(""),se=async()=>{const s=await Te();O.value=s.id,o.value=s.recentUseSetting,o.value===k.auto?f():U()},ae=async()=>{var s;await De({recentUseSetting:o.value,id:O.value}),await((s=e.value)==null?void 0:s.reload()),L.success("切换成功")};M(()=>o.value===k.auto?t.value:I.value);const le=M(()=>o.value===k.auto?b.value:C.value),{goApp:K}=W(),x=A(!1),re=s=>{K({appId:s==null?void 0:s.appId,entryId:s==null?void 0:s.entryId,openWith:"1"})},ie=s=>{if(s.valid){const{appId:v,entryId:D}=s.entryInfo;K({appId:v,entryId:D??void 0})}},T=A(!1),j=()=>{var s;(s=e.value)==null||s.reload(),ne()};return(s,v)=>{const D=Le,ue=we,de=Me,ce=he;return d(),g(Se,{"module-item":s.moduleItem},Ie({edit:i(()=>[p(Ke,{"module-item":s.moduleItem},null,8,["module-item"])]),default:i(()=>[p(Oe,{ref_key:"skeletonRef",ref:e,load:se,style:{display:"unset !important"}},{default:i(()=>[o.value===y(k).auto?(d(),g(je,{key:0,list:y(b)},null,8,["list"])):(d(),g(Je,{key:1,list:y(C),onChange:v[1]||(v[1]=({type:n,item:F})=>y(E)(n,F))},null,8,["list"]))]),_:1},512),m.value?Ae("",!0):(d(),V($,{key:0},[p(Be,{"drawer-model":x.value,"onUpdate:drawerModel":v[3]||(v[3]=n=>x.value=n),title:"常用",list:le.value,onRefresh:j,"no-sort":o.value===y(k).auto,addAble:o.value===y(k).manual,onAdd:v[4]||(v[4]=n=>T.value=!0),sortFn:y(xe)},{default:i(({element:n})=>{var F,S,q,J,Q;return[o.value===y(k).auto?(d(),g(G,{key:0,name:n.name,icon:n.icon,color:n.color,isGradient:"",isBackGroundColor:"",onClick:w=>re(n)},{collect:i(()=>[p(B,{onClickFavorites:w=>{o.value===y(k).auto?y(c)(n.id):y(E)(w,n)},valid:!0},null,8,["onClickFavorites"])]),_:2},1032,["name","icon","color","onClick"])):(d(),g(G,{key:1,name:(F=n.entryInfo)==null?void 0:F.name,icon:(S=n.entryInfo)==null?void 0:S.icon,color:(q=n.entryInfo)==null?void 0:q.color,isGradient:((J=n.type)==null?void 0:J.toString())==="1",isBackGroundColor:((Q=n.type)==null?void 0:Q.toString())==="1",onClick:w=>ie(n)},{collect:i(()=>[p(B,{onClickFavorites:w=>y(E)(w,n),valid:!0},null,8,["onClickFavorites"])]),_:2},1032,["name","icon","color","isGradient","isBackGroundColor","onClick"]))]}),prefix:i(()=>[p(ce,null,{default:i(()=>[p(de,{label:"常用数据生成规则"},{default:i(()=>[p(Fe,{modelValue:o.value,"onUpdate:modelValue":v[2]||(v[2]=n=>o.value=n),placeholder:"请选择",class:"w100",load:r,onChange:ae},{default:i(({options:n})=>[(d(!0),V($,null,R(n,(F,S)=>(d(),g(ue,{key:S,label:F.label,value:F.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["drawer-model","list","no-sort","addAble","sortFn"]),p(oo,{visible:T.value,"onUpdate:visible":v[5]||(v[5]=n=>T.value=n),collectionsList:y(C),onRefresh:j,title:"新增常用"},null,8,["visible","collectionsList"])],64))]),_:2},[m.value?{name:"desc",fn:i(()=>[p(ke,{style:{"margin-left":"10px",color:"var(--el-text-color-secondary)","font-size":"12px"},content:"自动生成或由用户手动添加常用数据，无需配置；效果如下","show-after":300})]),key:"0"}:void 0,m.value?void 0:{name:"top-right",fn:i(()=>[p(D,{text:"",type:"primary",size:"small",class:"click-active",onClick:v[0]||(v[0]=n=>x.value=!0)},{default:i(()=>[be(" 更多  "),p(Ce,{"icon-class":"DArrowRight"})]),_:1})]),key:"1"}]),1032,["module-item"])}}});const Fo=Z(to,[["__scopeId","data-v-75bcb8b3"]]);export{Fo as default};

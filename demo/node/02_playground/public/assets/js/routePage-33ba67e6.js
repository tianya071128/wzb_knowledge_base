import{d as M,hd as At,qe as J,c as A,o as d,b as O,w as t,h as Me,f as C,l as U,p as _e,H as z,_ as K,v as Te,k as x,i as l,B as e,a2 as pl,eu as Ge,F as q,g as j,nK as Ut,d9 as $t,P as Bt,aU as Il,N as Xl,O as et,ba as wl,qf as al,qg as Rt,qh as Pt,r as R,Y as N,qi as qt,m as $,t as H,qj as ol,qk as Le,ql as Rl,dA as ve,qm as Pl,qn as ql,a3 as Fe,qo as Lt,E as de,ab as re,ac as se,ds as Mt,ao as Oe,ap as De,q as oe,bm as ue,U as X,bn as xe,oF as Y,qp as Wt,eP as lt,oT as nl,jM as We,qq as Ze,qr as zt,qs as Ll,fV as cl,qt as Ml,oV as sl,qu as Ht,qv as Nt,a8 as Be,a as P,np as Gt,qw as Wl,qx as Ye,qy as zl,mf as Hl,qz as pe,K as tt,qA as jt,T as je,qB as Kt,p1 as Jt,qC as at,qD as ml,qE as ot,br as Re,x as Ke,aq as ze,qF as Qt,n as nt,aa as Tl,p0 as st,qG as it,aN as Pe,av as be,eh as Xe,y as we,ae as Zt,L as dt,j as fl,a5 as kl,I as He,h1 as Yt,Q as ye,R as ke,qH as Nl,ox as il,er as rt,hQ as Xt,qI as ea,n3 as Gl,bC as Je,b2 as ut,qJ as la,eA as pt,gT as ct,bK as Ee,C as ne,mv as mt,qK as ee,eR as $e,e as te,S as ae,qL as Ve,mp as ft,ga as vl,qM as jl,gh as hl,cG as vt,cF as ta,qN as _t,qO as aa,aM as oa,qP as dl,$ as Fl,aT as Cl,qQ as na,fx as _l,eo as Kl,dS as sa,a4 as ia,M as Sl,dC as Ol,ns as da,qR as ra,qS as ua,nt as pa,bv as el,Z as Ce,eB as ca,qT as ma,qU as fa,qV as va,qW as _a,qX as ba,g2 as Ne,dD as ya,qY as Se,qZ as ga,es as Dl,q_ as Va,q$ as Ia,gZ as wa,ar as Ta,r0 as bl,oH as Ie,r1 as ka,bu as xl,r2 as ha,h7 as Fa,r3 as Jl,z as El,r4 as Ql,at as Zl,r5 as fe,r6 as bt,r7 as rl,hP as yt,r8 as Ca,cC as Sa,g$ as Oa,eK as Da,bJ as xa,r9 as Ea,i5 as Aa,a9 as Ua,ra as $a,nn as Ba,dp as gt,bH as Ra,dj as ce,dk as me,bG as Pa,dl as Vt,dm as qa,cm as La,dn as Ma,dq as Wa,rb as za,c3 as Ha,pO as Na,bb as ul,aY as Ga,aZ as ja,b4 as Yl,bd as Ka,b6 as Ja,rc as Qa,hB as Za}from"./index-b80d5ef5.js";import{D as Ya}from"./DesignerTabs-a9795edf.js";import{u as It}from"./useQueryTab-05fa7456.js";import{a as wt,L as Xa}from"./LoadingData-195d0581.js";import{D as eo}from"./DataSoureceWrapper-047a1c9d.js";import{S as lo}from"./SortSetField-face42ca.js";import{u as ll}from"./formDesigner-462b10d7.js";import{C as Al,F as Ul,_ as to}from"./AddOrEditValidate.vue_vue_type_style_index_0_lang-5bd5a73c.js";import{A as yl}from"./AzInputNumber-d6212644.js";import{b as Tt}from"./SelectEntryAndOther-76a65b2d.js";import{S as kt,a as ao}from"./SetFieldDefault-5fc1ae2a.js";import{t as oo,T as no}from"./TableRender-bab4d661.js";/* empty css                          */import{C as ht}from"./CloumnSetField-0ab83820.js";import{_ as so}from"./FilterSetField.vue_vue_type_script_setup_true_lang-899d6e0d.js";import{_ as $l}from"./ButtonSelectField.vue_vue_type_script_setup_true_lang-aae15f71.js";import{E as gl}from"./EditorDraggable-a06dbc71.js";import{C as tl}from"./ConditionWrapper-43da1676.js";import{F as Bl}from"./FieldConditionView-ad1b057c.js";import{F as io}from"./FieldCondition-1c72aa9d.js";import{I as Ft}from"./InternalComponentSelectPlus-00c8c38f.js";import{C as ro}from"./ComponentParamsSetWrapper-71afc840.js";import{C as uo}from"./ComponentPostAction-12970ad1.js";import{B as Qe}from"./ButtonState-cb54910b.js";import{P as po}from"./PluginSelect-032e797b.js";import{_ as co}from"./ParamsSetWrapper.vue_vue_type_script_setup_true_lang-c3f6631f.js";import{S as Ct}from"./SetFieldAuth-3d0b80a0.js";import{C as mo}from"./CardTabs-ca59b5e9.js";import{L as fo}from"./LoadingData-5a6f27a3.js";import"./useExtractQuery-f96f705c.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";import"./SelectDataSourece-70a968c3.js";import"./Formula.vue_vue_type_style_index_0_lang-ef444f24.js";import"./index-8e050109.js";import"./el-input-number-c15b1cc7.js";import"./fieldDefaultComponent-58752d9c.js";import"./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js";import"./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js";import"./useFieldMaxWidth-d82f063e.js";import"./Base.vue_vue_type_script_setup_true_lang-4fbdbc85.js";import"./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js";import"./index-318b68f4.js";import"./DaterangeBase.vue_vue_type_script_setup_true_lang-bec97540.js";import"./InputBase.vue_vue_type_script_setup_true_lang-ffcf63f1.js";import"./Base-9b7f3306.js";import"./index-f0ed738f.js";import"./NumberBase.vue_vue_type_script_setup_true_lang-745b39c5.js";import"./Base-c9aa1df0.js";/* empty css                        */import"./SliderBase.vue_vue_type_script_setup_true_lang-5d73415b.js";import"./TextareaBase.vue_vue_type_script_setup_true_lang-7091b2cb.js";import"./TimeBase.vue_vue_type_script_setup_true_lang-ea537bf3.js";import"./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js";import"./TimerangeBase.vue_vue_type_script_setup_true_lang-0827c241.js";import"./UploadFileBase.vue_vue_type_script_setup_true_lang-0c253daa.js";import"./UploadImgBase.vue_vue_type_script_setup_true_lang-d23c1306.js";import"./CooperateEnterpriseBase.vue_vue_type_script_setup_true_lang-23720971.js";import"./useMultipleVal-904406c1.js";import"./CooperatePersonnelBase.vue_vue_type_script_setup_true_lang-adcd0db7.js";import"./Base.vue_vue_type_script_setup_true_lang-0e9a0e2c.js";import"./Base.vue_vue_type_script_setup_true_lang-aa25657d.js";import"./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js";import"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import"./el-dropdown-item-455a6589.js";import"./CardShowFieldItem-fd24f218.js";import"./FormulaWrapper-92a83208.js";import"./Resize-eb80395d.js";import"./FormShare-9773b44c.js";import"./dataShare-2d7ae3f7.js";import"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import"./default-component-4c80201b.js";import"./SelectFieldByMultEntry-84abd0c3.js";import"./SelectCascaderEntry.vue_vue_type_script_setup_true_lang-673c5dca.js";import"./SelectForm.vue_vue_type_script_setup_true_lang-0170236d.js";import"./ParamsSet.vue_vue_type_script_setup_true_lang-37c252c5.js";/* empty css              */import"./index-0e679d15.js";import"./use-id-d3187131.js";/* empty css              */import"./index-ae93b8ef.js";import"./use-route-c2b2b5be.js";import"./AzLink-d3d666fe.js";const vo=M({__name:"EditorWrapper",props:{id:{},type:{},label:{},labelWidth:{default:"70px"}},setup(E){At(r=>({"2cecc98a":r.labelWidth}));const a=E,m=ll(),I=J(),o=A(()=>{if(!a.id)return;const r=`${I.id}.${a.id}`;return m.errorMap.get(r)});return(r,n)=>{var s;return d(),O(z,{label:r.label,class:_e(["editor_wrapper",{"is-secondary":r.type==="secondary","is-tip":r.type==="tip","is-label-empty":!r.label}]),error:(s=o.value)==null?void 0:s.msg},{default:t(()=>[Me(r.$slots,"default",{},void 0,!0),r.$slots.titleRight?(d(),C("div",{key:0,class:"editor-wrapper-title"},[Me(r.$slots,"titleRight",{},void 0,!0)])):U("",!0)]),_:3},8,["label","class","error"])}}});const le=K(vo,[["__scopeId","data-v-9dd06cd3"]]),_o=M({__name:"ImgConfig",props:{modelValue:{},imgList:{},imgW:{default:"148px"},imgH:{default:"148px"}},emits:["update:modelValue"],setup(E,{emit:a}){const m=E,o=Te(m,"modelValue",a),r=A({get(){var n;return o.value&&((n=m.imgList)!=null&&n.includes(o.value))?"":o.value},set(n){n&&(o.value=n)}});return(n,s)=>{const g=Bt,v=Il,c=Xl,f=et,w=wl;return d(),O(w,{placement:"bottom",width:520,trigger:"click","hide-after":0},{reference:t(()=>[x("span",null,[l(v,{effect:"dark",content:"点击设置",placement:"top"},{default:t(()=>[x("div",{class:_e(["img_config-display",{"is-empty":!e(o)}]),style:pl({width:n.imgW,height:n.imgH})},[e(o)?(d(),C("img",{key:0,class:"img_config-img",src:e(o),alt:""},null,8,["src"])):(d(),O(g,{key:1,class:"display-empty"},{default:t(()=>[l(e(Ge))]),_:1}))],6)]),_:1})])]),default:t(()=>[l(f,{type:"border-card"},{default:t(()=>[l(c,{label:"选择图片"},{default:t(()=>[x("div",{class:"img-list"},[(d(!0),C(q,null,j(n.imgList,(b,h)=>(d(),C("div",{class:"img-item",key:h,onClick:y=>o.value=b,style:pl({width:n.imgW,height:n.imgH})},[x("img",{class:"img_config-img",src:b},null,8,["src"]),e(o)===b?(d(),C("div",{key:0,class:"img-active"},[l(g,null,{default:t(()=>[l(e(Ut))]),_:1})])):U("",!0)],12,["onClick"]))),128))])]),_:1}),l(c,{label:"自定义图片"},{default:t(()=>[l($t,{modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=b=>r.value=b),limit:1,type:"img",size:30,hideDelete:"",accept:["jpg","jpeg","bmp","png"]},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})}}});const bo=K(_o,[["__scopeId","data-v-17da24e3"]]),yo=M({__name:"CoverSettings",setup(E){const a=J(),m=()=>{a.selectedTableView.basis.coverOptions.type===ol.hide?a.selectedTableView.basis.coverOptions.appointCover=void 0:g()},I={type:al.fix,position:Rt.top,coverWay:Pt.fill,coverFieldId:"",imgSrc:"./img/tableCard/01.png",isViewCover:!1},o=R(!1),r=R(),n=R(N(I)),s={type:[{required:!0,message:"请选择封面类型",trigger:"change"}],position:[{required:!0,message:"请选择显示位置",trigger:"change"}],displayArreaW:[{required:!0,message:"请输入",trigger:"blur"}],displayArreaH:[{required:!0,message:"请输入",trigger:"blur"}],coverWay:[{required:!0,message:"请选择显示方式",trigger:"change"}],isViewCover:[{required:!0,message:"请选择显示方式",trigger:"change"}],coverFieldId:[{required:!0,message:"请选择封面字段",trigger:"change"}]},g=()=>{o.value=!0,n.value=N(a.selectedTableView.basis.coverOptions.appointCover??I),setTimeout(()=>{var h;(h=r.value)==null||h.clearValidate()},40)},v=()=>{n.value.coverFieldId="",n.value.imgSrc||(n.value.imgSrc="./img/tableCard/01.png")},c=()=>{o.value=!1,a.selectedTableView.basis.coverOptions.appointCover||(a.selectedTableView.basis.coverOptions.type=ol.hide)},f=async()=>{var h;await Promise.all([(h=r.value)==null?void 0:h.validate()]),o.value=!1,a.selectedTableView.basis.coverOptions.appointCover=N(n.value)},w=A({get(){return n.value.displayArea??!1},set(h){n.value.displayArea=h,n.value.displayArreaW=1,n.value.displayArreaH=1}}),b=["./img/tableCard/01.png","./img/tableCard/02.png","./img/tableCard/03.png","./img/tableCard/04.png","./img/tableCard/05.png"];return(h,y)=>{const u=de,_=re,p=se,i=Mt,V=Oe,T=De,k=oe,B=ue,D=X,F=xe;return d(),C(q,null,[l(le,{label:"封面",class:"card_setting-cover"},{default:t(()=>[l(_,{modelValue:e(a).selectedTableView.basis.coverOptions.type,"onUpdate:modelValue":y[0]||(y[0]=S=>e(a).selectedTableView.basis.coverOptions.type=S),onChange:m},{default:t(()=>[(d(!0),C(q,null,j(e(qt),S=>(d(),O(u,{label:S.value,key:S.value},{default:t(()=>[$(H(S.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),e(a).selectedTableView.basis.coverOptions.type===e(ol).appoint?(d(),O(Al,{key:0,onClick:g,isSet:!!e(a).selectedTableView.basis.coverOptions.appointCover},{default:t(()=>{var S;return[e(a).selectedTableView.basis.coverOptions.appointCover?(d(),C(q,{key:0},[l(p,{label:"封面类型："},{default:t(()=>{var L;return[$(H(e(Le)(e(Rl),(L=e(a).selectedTableView.basis.coverOptions.appointCover)==null?void 0:L.type)),1)]}),_:1}),((S=e(a).selectedTableView.basis.coverOptions.appointCover)==null?void 0:S.type)===e(al).field?(d(),C(q,{key:0},[l(p,{label:"封面字段："},{default:t(()=>[l(ve,{sourceId:e(a).sourceId,fieldId:e(a).selectedTableView.basis.coverOptions.appointCover.coverFieldId??""},null,8,["sourceId","fieldId"])]),_:1}),l(p,{label:"点击查看封面："},{default:t(()=>[l(i,{modelValue:e(a).selectedTableView.basis.coverOptions.appointCover.isViewCover,"onUpdate:modelValue":y[1]||(y[1]=L=>e(a).selectedTableView.basis.coverOptions.appointCover.isViewCover=L),disabled:""},null,8,["modelValue"])]),_:1})],64)):U("",!0),l(p,{label:"显示位置："},{default:t(()=>{var L;return[$(H(e(Le)(e(Pl),(L=e(a).selectedTableView.basis.coverOptions.appointCover)==null?void 0:L.position)),1)]}),_:1}),l(p,{label:"显示方式："},{default:t(()=>{var L;return[$(H(e(Le)(e(ql),(L=e(a).selectedTableView.basis.coverOptions.appointCover)==null?void 0:L.coverWay)),1)]}),_:1})],64)):U("",!0)]}),_:1},8,["isSet"])):U("",!0)]),_:1}),l(F,{modelValue:o.value,"onUpdate:modelValue":y[11]||(y[11]=S=>o.value=S),title:"封面配置",width:"500","append-to-body":""},{footer:t(()=>[x("span",{class:"dialog-footer"},[l(D,{onClick:c},{default:t(()=>[$("取消")]),_:1}),l(D,{type:"primary",onClick:f},{default:t(()=>[$("确定")]),_:1})])]),default:t(()=>[l(B,{ref_key:"ruleFormRef",ref:r,model:n.value,rules:s,"label-position":"right","label-width":"120",class:"label-blod"},{default:t(()=>[l(p,{label:"封面类型",prop:"type"},{default:t(()=>[l(T,{modelValue:n.value.type,"onUpdate:modelValue":y[2]||(y[2]=S=>n.value.type=S),placeholder:"请选择",class:"w100",onChange:v},{default:t(()=>[(d(!0),C(q,null,j(e(Rl),(S,L)=>(d(),O(V,{key:L,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n.value.type===e(al).fix?(d(),O(p,{key:0,label:"封面图片",prop:"type"},{default:t(()=>[l(bo,{modelValue:n.value.imgSrc,"onUpdate:modelValue":y[3]||(y[3]=S=>n.value.imgSrc=S),imgList:b,imgW:"148px",imgH:"77px"},null,8,["modelValue"])]),_:1})):(d(),C(q,{key:1},[l(z,{label:"封面字段",prop:"coverFieldId"},{default:t(()=>[l(Fe,{modelValue:n.value.coverFieldId,"onUpdate:modelValue":y[4]||(y[4]=S=>n.value.coverFieldId=S),sourceId:e(a).sourceId,filter:e(Lt),clearable:"",placeholder:"选择作为封面的字段，可选择图片字段"},null,8,["modelValue","sourceId","filter"])]),_:1}),l(p,{label:"点击查看封面",prop:"isViewCover"},{default:t(()=>[l(i,{modelValue:n.value.isViewCover,"onUpdate:modelValue":y[5]||(y[5]=S=>n.value.isViewCover=S)},null,8,["modelValue"])]),_:1})],64)),l(p,{label:"显示位置",prop:"position"},{default:t(()=>[l(T,{modelValue:n.value.position,"onUpdate:modelValue":y[6]||(y[6]=S=>n.value.position=S),placeholder:"请选择",class:"w100"},{default:t(()=>[(d(!0),C(q,null,j(e(Pl),(S,L)=>(d(),O(V,{key:L,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"显示方式",prop:"coverWay"},{default:t(()=>[l(T,{modelValue:n.value.coverWay,"onUpdate:modelValue":y[7]||(y[7]=S=>n.value.coverWay=S),placeholder:"请选择",class:"w100"},{default:t(()=>[(d(!0),C(q,null,j(e(ql),(S,L)=>(d(),O(V,{key:L,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(z,{label:"显示区域",tip:"未勾选，按固定高度显示",alignItems:"flex-start"},{default:t(()=>[x("div",{class:"w100"},[l(k,{modelValue:w.value,"onUpdate:modelValue":y[8]||(y[8]=S=>w.value=S),label:"按比例显示"},null,8,["modelValue"])]),w.value?(d(),C("div",{key:0,class:"display_area"},[x("span",{style:{"margin-right":"5px"}},"宽"),l(p,{prop:"displayArreaW"},{default:t(()=>[l(yl,{modelValue:n.value.displayArreaW,"onUpdate:modelValue":y[9]||(y[9]=S=>n.value.displayArreaW=S),style:{width:"70px"},precision:0,valueOnClear:1,min:1,max:100,placeholder:"请输入",controls:!1},null,8,["modelValue"])]),_:1}),x("span",{style:{margin:"0 5px"}},"："),x("span",{style:{"margin-right":"5px"}},"高"),l(p,{prop:"displayArreaH"},{default:t(()=>[l(yl,{modelValue:n.value.displayArreaH,"onUpdate:modelValue":y[10]||(y[10]=S=>n.value.displayArreaH=S),style:{width:"70px"},precision:0,valueOnClear:1,min:1,max:100,placeholder:"请输入",controls:!1},null,8,["modelValue"])]),_:1})])):U("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});const go=K(yo,[["__scopeId","data-v-a030a8bf"]]),Vo=M({__name:"CardSettings",setup(E){const a=J(),m=A(()=>a.selectedTableView.basis.style===Y.card);return(I,o)=>{const r=de,n=re;return m.value?(d(),C("div",{key:0,class:"card_setting"},[l(go),l(le,{label:"卡片大小"},{default:t(()=>[l(n,{modelValue:e(a).selectedTableView.basis.cardSize,"onUpdate:modelValue":o[0]||(o[0]=s=>e(a).selectedTableView.basis.cardSize=s)},{default:t(()=>[(d(!0),C(q,null,j(e(Wt),s=>(d(),O(r,{label:s.value,key:s.value},{default:t(()=>[$(H(s.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})])):U("",!0)}}});const Io=K(Vo,[["__scopeId","data-v-11803e3f"]]),wo=M({__name:"ClickDataSettings",setup(E){const a=J(),{getFormHtmlName:m}=lt(),I=R(!1),o=()=>{a.selectedTableView.basis.clickDataOptions.type===Ze.default?a.selectedTableView.basis.clickDataOptions.appointOptions=void 0:c()},r={type:nl.form},n=R(N(r)),s={type:[{required:!0,message:"请选择打开类型",trigger:"change"}],link:[{required:!0,message:"请输入目标地址",trigger:"change"}],targetEntryId:[{required:!0,message:"请选择目标表单",trigger:"change"}],formType:[{required:!0,message:"请选择打开表单类型",trigger:"change"}],trendsFormFieldId:[{required:!0,message:"请选择动态表单",trigger:"change"}]},g=R(),v=R(),c=()=>{I.value=!0,n.value=N(a.selectedTableView.basis.clickDataOptions.appointOptions??r),setTimeout(()=>{var p;(p=g.value)==null||p.clearValidate()},40)},f=()=>{n.value={type:n.value.type}},w=()=>{n.value={type:n.value.type,formType:n.value.formType}},b=()=>{n.value.transferValueField=void 0},h=()=>{I.value=!1,a.selectedTableView.basis.clickDataOptions.appointOptions||(a.selectedTableView.basis.clickDataOptions.type=Ze.default)},y=async()=>{var p,i;await Promise.all([(p=g.value)==null?void 0:p.validate(),(i=v.value)==null?void 0:i.validate()]),I.value=!1,a.selectedTableView.basis.clickDataOptions.appointOptions=N(n.value)},u=A(()=>{var p;return a.soureceInfo&&[We.currentAppForm,We.form].includes((p=a.soureceInfo)==null?void 0:p.source)}),_=A(()=>u.value&&a.selectedTableView.basis.clickDataOptions.type===Ze.default);return(p,i)=>{const V=de,T=re,k=se,B=Oe,D=De,F=ue,S=X,L=xe;return d(),C(q,null,[e(a).selectedTableView.basis.style!==e(Y).slave||_.value?(d(),O(le,{key:0,label:"点击数据效果"},{default:t(()=>[e(a).selectedTableView.basis.style!==e(Y).slave?(d(),O(T,{key:0,modelValue:e(a).selectedTableView.basis.clickDataOptions.type,"onUpdate:modelValue":i[0]||(i[0]=W=>e(a).selectedTableView.basis.clickDataOptions.type=W),onChange:o},{default:t(()=>[(d(!0),C(q,null,j(e(zt),W=>(d(),O(V,{label:W.value,key:W.value},{default:t(()=>[$(H(W.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])):U("",!0),_.value?(d(),O(Ul,{key:1,modelValue:e(a).selectedTableView.basis.fileMode,"onUpdate:modelValue":i[1]||(i[1]=W=>e(a).selectedTableView.basis.fileMode=W),fields:e(a).fields},null,8,["modelValue","fields"])):U("",!0),e(a).selectedTableView.basis.clickDataOptions.type===e(Ze).appoint?(d(),O(Al,{key:2,onClick:c,isSet:!!e(a).selectedTableView.basis.clickDataOptions.appointOptions},{default:t(()=>{var W,Z;return[e(a).selectedTableView.basis.clickDataOptions.appointOptions?(d(),C(q,{key:0},[l(k,{label:"打开页面类型："},{default:t(()=>{var G;return[$(H(e(Le)(e(Ll),(G=e(a).selectedTableView.basis.clickDataOptions.appointOptions)==null?void 0:G.type)),1)]}),_:1}),((W=e(a).selectedTableView.basis.clickDataOptions.appointOptions)==null?void 0:W.type)===e(nl).link?(d(),O(k,{key:0,label:"目标地址："},{default:t(()=>{var G;return[l(cl,{"model-value":(G=e(a).selectedTableView.basis.clickDataOptions.appointOptions)==null?void 0:G.link,preview:"",group:[{id:"field",title:"当前数据集控件",fieldOptions:{sourceId:e(a).sourceId}}]},null,8,["model-value","group"])]}),_:1})):(d(),C(q,{key:1},[l(k,{label:"打开表单类型："},{default:t(()=>{var G;return[$(H(e(Le)(e(Ml),(G=e(a).selectedTableView.basis.clickDataOptions.appointOptions)==null?void 0:G.formType)),1)]}),_:1}),((Z=e(a).selectedTableView.basis.clickDataOptions.appointOptions)==null?void 0:Z.formType)===e(sl).fix?(d(),O(k,{key:0,label:"目标表单："},{default:t(()=>{var G;return[x("span",{class:"bold",innerHTML:e(m)(((G=e(a).selectedTableView.basis.clickDataOptions.appointOptions)==null?void 0:G.targetEntryId)??"")},null,8,["innerHTML"])]}),_:1})):(d(),O(k,{key:1,label:"动态表单："},{default:t(()=>[l(ve,{sourceId:e(a).sourceId,fieldId:e(a).selectedTableView.basis.clickDataOptions.appointOptions.trendsFormFieldId??""},null,8,["sourceId","fieldId"])]),_:1}))],64))],64)):U("",!0)]}),_:1},8,["isSet"])):U("",!0)]),_:1})):U("",!0),l(L,{modelValue:I.value,"onUpdate:modelValue":i[9]||(i[9]=W=>I.value=W),title:"打开指定页面设置",width:"700","append-to-body":""},{footer:t(()=>[x("span",{class:"dialog-footer"},[l(S,{onClick:h},{default:t(()=>[$("取消")]),_:1}),l(S,{type:"primary",onClick:y},{default:t(()=>[$("确定")]),_:1})])]),default:t(()=>[l(F,{ref_key:"ruleFormRef",ref:g,model:n.value,rules:s,"label-position":"right","label-width":"120",class:"label-blod"},{default:t(()=>[l(k,{label:"打开页面类型",prop:"type"},{default:t(()=>[l(D,{modelValue:n.value.type,"onUpdate:modelValue":i[2]||(i[2]=W=>n.value.type=W),class:"w100",placeholder:"请选择",onChange:f},{default:t(()=>[(d(!0),C(q,null,j(e(Ll),(W,Z)=>(d(),O(B,{key:Z,label:W.label,value:W.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n.value.type===e(nl).link?(d(),O(z,{key:0,label:"目标地址",prop:"link"},{default:t(()=>[l(cl,{modelValue:n.value.link,"onUpdate:modelValue":i[3]||(i[3]=W=>n.value.link=W),group:[{id:e(oo).listClickData,title:"当前数据集控件",fieldOptions:{sourceId:e(a).sourceId}}]},null,8,["modelValue","group"])]),_:1})):(d(),C(q,{key:1},[l(k,{label:"打开表单类型",prop:"formType"},{default:t(()=>[l(D,{modelValue:n.value.formType,"onUpdate:modelValue":i[4]||(i[4]=W=>n.value.formType=W),class:"w100",placeholder:"请选择",onChange:w},{default:t(()=>[(d(!0),C(q,null,j(e(Ml),(W,Z)=>(d(),O(B,{key:Z,label:W.label,value:W.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n.value.formType===e(sl).fix?(d(),C(q,{key:0},[l(z,{label:"目标表单",prop:"targetEntryId"},{default:t(()=>[l(Tt,{modelValue:n.value.targetEntryId,"onUpdate:modelValue":i[5]||(i[5]=W=>n.value.targetEntryId=W),"app-id":e(a).appId,onChange:b,class:"w100"},null,8,["modelValue","app-id"])]),_:1}),l(k,{label:"表单传递值"},{default:t(()=>[x("div",{class:"w100"},[l(kt,{modelValue:n.value.transferValueField,"onUpdate:modelValue":i[6]||(i[6]=W=>n.value.transferValueField=W),ref_key:"SetFieldDefaultRef",ref:v,leftEntryId:n.value.targetEntryId,rightSourceId:e(a).sourceId,leftFieldColumnName:"目标表单字段名称",isSubform:""},null,8,["modelValue","leftEntryId","rightSourceId"])])]),_:1})],64)):U("",!0),n.value.formType===e(sl).trends?(d(),C(q,{key:1},[l(z,{label:"动态表单",prop:"trendsFormFieldId"},{default:t(()=>[l(Fe,{modelValue:n.value.trendsFormFieldId,"onUpdate:modelValue":i[7]||(i[7]=W=>n.value.trendsFormFieldId=W),sourceId:e(a).sourceId,filter:e(Ht),clearable:"",placeholder:"请选择"},null,8,["modelValue","sourceId","filter"])]),_:1}),l(z,{label:"表单传递值"},{default:t(()=>[l(Fe,{modelValue:n.value.trendsFormPamras,"onUpdate:modelValue":i[8]||(i[8]=W=>n.value.trendsFormPamras=W),multiple:"",sourceId:e(a).sourceId,filter:e(Nt),placeholder:"请选择",isSelectSubform:""},null,8,["modelValue","sourceId","filter"])]),_:1})],64)):U("",!0)],64))]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});const To=K(wo,[["__scopeId","data-v-5d03be4d"]]),ko=M({__name:"GanteSettings",setup(E){const a=J(),m=A(()=>a.selectedTableView.basis.style===Y.gantt),I=()=>({calibration:Kt.day,colorType:Ye.common}),o=R(!1),r=R(),n=()=>{o.value=!0,s.value=N(a.selectedTableView.basis.ganteOptions??I()),setTimeout(()=>{var y,u,_,p;a.selectedTableView.basis.ganteOptions?(u=(y=r.value)==null?void 0:y.ruleFormRef)==null||u.validate():(p=(_=r.value)==null?void 0:_.ruleFormRef)==null||p.clearValidate()},40)},s=R(I()),g={startDateField:[{required:!0,message:"请选择开始时间",trigger:"change"}],endDateField:[{required:!0,message:"请选择结束时间",trigger:"change"}],calibration:[{required:!0,message:"请选择时间刻度",trigger:"change"}],colorFieldId:[{required:!0,message:"请选择颜色字段",trigger:"change"}]},v=()=>{var y,u,_;(y=s.value.startDateField)!=null&&y.fieldId&&((u=s.value.startDateField)==null?void 0:u.fieldId)===((_=s.value.endDateField)==null?void 0:_.fieldId)&&(s.value.endDateField=void 0)},c=A(()=>Be(a.fields,{blockFilter(y){return y.type===P.subform},excludeFilter(y){return![P.date,P.daterange].includes(y.type)}})),f=A(()=>Be(a.fields,{blockFilter(y){return y.type===P.subform},excludeFilter(y){var u;return![P.date].includes(y.type)||y.fieldId===((u=s.value.startDateField)==null?void 0:u.fieldId)}})),w=A(()=>Be(a.fields,{blockFilter(y){return y.type===P.subform},excludeFilter(y){return![P.radio].includes(y.type)}})),b=()=>{s.value.commonColor=void 0,s.value.colorFieldId=void 0},h=async()=>{var y,u;await((u=(y=r.value)==null?void 0:y.ruleFormRef)==null?void 0:u.validate()),a.selectedTableView.basis.ganteOptions=N(s.value),o.value=!1};return(y,u)=>{const _=de,p=re,i=Oe,V=De,T=X;return d(),C(q,null,[m.value?(d(),O(le,{key:0,label:"甘特图设置",id:`${e(pe).basis}.gantt`},{default:t(()=>[l(Al,{onClick:n,isSet:!!e(a).selectedTableView.basis.ganteOptions,labelSuffix:":"},{default:t(()=>[e(a).selectedTableView.basis.ganteOptions?(d(),C("div",{key:0,class:"gante-display"},[l(z,{label:"时间区间"},{default:t(()=>{var k,B,D,F;return[x("div",{class:"display-date"},[l(ve,{class:_e(["display-date-label",{"is-range":((k=e(a).selectedTableView.basis.ganteOptions.startDateField)==null?void 0:k.fieldType)===e(P).daterange}]),sourceId:e(a).sourceId,fieldId:((B=e(a).selectedTableView.basis.ganteOptions.startDateField)==null?void 0:B.fieldId)??""},null,8,["class","sourceId","fieldId"]),((D=e(a).selectedTableView.basis.ganteOptions.startDateField)==null?void 0:D.fieldType)!==e(P).daterange?(d(),C(q,{key:0},[x("span",{class:"display-date-separation"},"-"),l(ve,{class:"display-date-label",sourceId:e(a).sourceId,fieldId:((F=e(a).selectedTableView.basis.ganteOptions.endDateField)==null?void 0:F.fieldId)??""},null,8,["sourceId","fieldId"])],64)):U("",!0)])]}),_:1}),l(z,{label:"时间刻度"},{default:t(()=>[$(H(e(Gt)(e(a).selectedTableView.basis.ganteOptions.calibration,e(Wl))),1)]),_:1}),e(a).selectedTableView.basis.ganteOptions.groupFieldId?(d(),O(z,{key:0,label:"分组字段"},{default:t(()=>[l(ve,{sourceId:e(a).sourceId,fieldId:e(a).selectedTableView.basis.ganteOptions.groupFieldId},null,8,["sourceId","fieldId"])]),_:1})):U("",!0),l(z,{label:"视图配色"},{default:t(()=>[e(a).selectedTableView.basis.ganteOptions.colorType===e(Ye).common?(d(),O(zl,{key:0,"model-value":e(a).selectedTableView.basis.ganteOptions.commonColor,defaultColor:e(Hl).primary,readonly:""},null,8,["model-value","defaultColor"])):(d(),O(ve,{key:1,sourceId:e(a).sourceId,fieldId:e(a).selectedTableView.basis.ganteOptions.colorFieldId??""},null,8,["sourceId","fieldId"]))]),_:1})])):U("",!0)]),_:1},8,["isSet"])]),_:1},8,["id"])):U("",!0),l(je,{modelValue:o.value,"onUpdate:modelValue":u[8]||(u[8]=k=>o.value=k),title:"甘特图设置",width:"700","append-to-body":""},{footer:t(()=>[x("span",{class:"dialog-footer"},[l(T,{onClick:u[7]||(u[7]=k=>o.value=!1)},{default:t(()=>[$("取消")]),_:1}),l(T,{type:"primary",onClick:h},{default:t(()=>[$("确定")]),_:1})])]),default:t(()=>[l(tt,{ref_key:"azFormRef",ref:r,model:s.value,rules:g,"label-position":"top"},{default:t(()=>[l(z,{label:"时间区间"},{default:t(()=>{var k;return[l(z,{class:"gante-inline",label:"开始时间",prop:"startDateField"},{default:t(()=>[l(Fe,{modelValue:s.value.startDateField,"onUpdate:modelValue":u[0]||(u[0]=B=>s.value.startDateField=B),style:{width:"200px"},prop:{fieldId:"fieldId",fieldType:"fieldType"},fields:c.value,onChange:v,placeholder:"请选择开始时间"},null,8,["modelValue","fields"])]),_:1}),((k=s.value.startDateField)==null?void 0:k.fieldType)!==e(P).daterange?(d(),O(z,{key:0,class:"gante-inline",label:"结束时间",prop:"endDateField"},{default:t(()=>{var B;return[l(Fe,{modelValue:s.value.endDateField,"onUpdate:modelValue":u[1]||(u[1]=D=>s.value.endDateField=D),style:{width:"200px"},prop:{fieldId:"fieldId",fieldType:"fieldType"},fields:f.value,disabled:!((B=s.value.startDateField)!=null&&B.fieldId),placeholder:"请选择结束时间"},null,8,["modelValue","fields","disabled"])]}),_:1})):U("",!0)]}),_:1}),l(z,{label:"时间刻度",prop:"calibration"},{default:t(()=>[l(p,{modelValue:s.value.calibration,"onUpdate:modelValue":u[2]||(u[2]=k=>s.value.calibration=k),style:{"padding-left":"16px"}},{default:t(()=>[(d(!0),C(q,null,j(e(Wl),(k,B)=>(d(),O(_,{key:B,label:k.value},{default:t(()=>[$(H(k.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(z,{label:"分组字段",prop:"groupFieldId"},{default:t(()=>[l(Fe,{modelValue:s.value.groupFieldId,"onUpdate:modelValue":u[3]||(u[3]=k=>s.value.groupFieldId=k),style:{width:"300px","padding-left":"16px"},fields:w.value,placeholder:"请选择分组字段",clearable:""},null,8,["modelValue","fields"])]),_:1}),l(z,{label:"视图配色",prop:"color"},{default:t(()=>[l(V,{style:{width:"300px","padding-left":"16px"},modelValue:s.value.colorType,"onUpdate:modelValue":u[4]||(u[4]=k=>s.value.colorType=k),onChange:b,placeholder:"请选择"},{default:t(()=>[(d(!0),C(q,null,j(e(jt),(k,B)=>(d(),O(i,{key:B,label:k.label,value:k.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s.value.colorType===e(Ye).common?(d(),O(z,{key:0,class:"gante-inline gante-color",label:"颜色"},{default:t(()=>[l(zl,{modelValue:s.value.commonColor,"onUpdate:modelValue":u[5]||(u[5]=k=>s.value.commonColor=k),defaultColor:e(Hl).primary},null,8,["modelValue","defaultColor"])]),_:1})):U("",!0),s.value.colorType===e(Ye).option?(d(),O(z,{key:1,class:"gante-inline gante-color",style:{"padding-left":"16px"},prop:"colorFieldId",hideLabel:""},{default:t(()=>[l(Fe,{modelValue:s.value.colorFieldId,"onUpdate:modelValue":u[6]||(u[6]=k=>s.value.colorFieldId=k),style:{width:"285px"},fields:w.value,placeholder:"请选择颜色字段"},null,8,["modelValue","fields"])]),_:1})):U("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});const ho=K(ko,[["__scopeId","data-v-0307d4e3"]]),Fo=M({__name:"PlatformSettings",setup(E){const a=J(),m=A(()=>a.selectedTableView.basis),I=A(()=>{var c;let v=ot;return((c=a.soureceInfo)==null?void 0:c.source)!==We.currentAppForm&&(v=v.filter(f=>f.value!==Y.addOrView)),a.soureceInfo&&Jt(a.soureceInfo)?v:v.filter(f=>f.value!==Y.tree)}),o=A({get(){return m.value.style},set(v){m.value.style=v}}),r=()=>{a.selectedTableView.display=a.selectedTableView.display.filter(v=>{var c;return!((c=v.child)!=null&&c.length)}),a.selectedTableView.display.forEach(v=>{v.merge=void 0})},n=A(()=>o.value!==Y.addOrView),s=A(()=>{const v=a.selectedTableView.basis.style;return[...at].filter(c=>!(v===Y.card&&[ml.discoloration].includes(c.value))&&!(v===Y.gantt&&[ml.number].includes(c.value)))}),g=A({get(){return m.value.settings},set(v){m.value.settings=[...v]}});return(v,c)=>{const f=Il,w=de,b=re,h=oe,y=Re;return d(),C(q,null,[l(le,{label:"列表样式",id:`${e(pe).basis}.style`},{default:t(()=>[l(b,{modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=u=>o.value=u),onChange:r},{default:t(()=>[(d(!0),C(q,null,j(I.value,u=>(d(),O(w,{class:"style-set",label:u.value,key:u.value},{default:t(()=>[$(H(u.label)+" ",1),l(f,{disabled:!u.tip,effect:"dark",content:u.tip,placement:"top"},{default:t(()=>[x("img",{class:"style-set-img",src:u.img,alt:""},null,8,["src"])]),_:2},1032,["disabled","content"])]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["id"]),n.value?(d(),O(le,{key:0,label:"列表设置"},{default:t(()=>[l(y,{modelValue:g.value,"onUpdate:modelValue":c[1]||(c[1]=u=>g.value=u)},{default:t(()=>[(d(!0),C(q,null,j(s.value,u=>(d(),O(h,{label:u.value,key:u.value},{default:t(()=>[x("img",{src:"",alt:""}),$(" "+H(u.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):U("",!0)],64)}}});const Co=K(Fo,[["__scopeId","data-v-8d8da3aa"]]),So=M({__name:"BasicSettings",setup(E){const a=J(),m=Ke(),I=r=>{const n=nt(r)[0]??"";if(n!==a.sourceId)return Tl.confirm("更换数据集后，当前表格的设计将被重置，且不可恢复。确定要更换数据集吗？","确认更换数据集",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",async beforeClose(s,g,v){if(s==="confirm"){g.confirmButtonLoading=!0;try{const c=await m.getSoureceData(n);if(c){const f=st(it(a.selectedTableView.id,{sheetId:a.selectedTableView.sheetId}),c);a.list=[f],a.setSelectedTableView(f.table_id),a.sourceId=n,a.selectedTableView.basis.sourceId=n,v()}}finally{g.confirmButtonLoading=!1}}else v()}}).then(()=>{Pe.success("更换数据集成功")})},o=A(()=>a.selectedTableView.basis.style!==Y.addOrView);return(r,n)=>{const s=de,g=re;return d(),C("div",null,[l(le,{required:"",label:"数据集"},{default:t(()=>[l(eo,{modelValue:e(a).sourceId,class:"w100",appId:e(a).appId,customSubmit:I},null,8,["modelValue","appId"])]),_:1}),l(le,{label:"视图名称"},{default:t(()=>[l(ze,{modelValue:e(a).selectedTableView.name,"onUpdate:modelValue":n[0]||(n[0]=v=>e(a).selectedTableView.name=v),placeholder:"请输入视图名称",isBlurCache:"",maxlength:"10"},null,8,["modelValue"])]),_:1}),e(a).soureceInfo?(d(),C(q,{key:0},[l(Co),l(Io),l(ho),o.value?(d(),O(le,{key:0,label:"数据加载方式"},{default:t(()=>[l(g,{modelValue:e(a).selectedTableView.basis.loading,"onUpdate:modelValue":n[1]||(n[1]=v=>e(a).selectedTableView.basis.loading=v)},{default:t(()=>[(d(!0),C(q,null,j(e(Qt),v=>(d(),O(s,{label:v.value,key:v.value},{default:t(()=>[$(H(v.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):U("",!0),o.value?(d(),O(To,{key:1})):U("",!0),l(le,{label:"数据排序",tip:"设置数据排序的依据字段，设置多个时按先后顺序进行排列。"},{default:t(()=>[l(lo,{modelValue:e(a).selectedTableView.basis.sort,"onUpdate:modelValue":n[2]||(n[2]=v=>e(a).selectedTableView.basis.sort=v),sourceId:e(a).sourceId},null,8,["modelValue","sourceId"])]),_:1})],64)):U("",!0)])}}});const Oo=K(So,[["__scopeId","data-v-b074f8ac"]]),Do=M({__name:"DisplaySettings",setup(E){const a=J(),m=R(),I=()=>{var g;(g=m.value)==null||g.switchAll(!0)},o=()=>{var g;(g=m.value)==null||g.switchAll(!1)},r=A(()=>a.selectedTableView.basis.style===Y.card),n=A({get(){return a.selectedTableView.basis.cardShowTitle},set(g){a.selectedTableView.basis.cardShowTitle=g}}),s=A({get(){return a.selectedTableView.display},set(g){a.selectedTableView.display=N(g)}});return(g,v)=>{const c=oe,f=be;return d(),O(le,{label:"表格显示列"},{default:t(()=>[x("div",{class:"w100"},[x("div",{class:"display_setting-other"},[r.value?(d(),O(c,{key:0,modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=w=>n.value=w),class:"mr-10",style:{height:"initial"}},{default:t(()=>[$(" 显示字段标题 ")]),_:1},8,["modelValue"])):U("",!0),x("div",{style:{"margin-left":"auto"}},[l(f,{underline:!1,type:"primary",class:"mr-10",onClick:I},{default:t(()=>[$(" 显示全部 ")]),_:1}),l(f,{underline:!1,type:"primary",onClick:o},{default:t(()=>[$(" 隐藏全部 ")]),_:1})])]),l(ht,{modelValue:s.value,"onUpdate:modelValue":v[1]||(v[1]=w=>s.value=w),isSubform:e(a).selectedTableView.basis.style===e(Y).plain,sourceId:e(a).sourceId,isMerge:e(a).selectedTableView.basis.style===e(Y).plain,ref_key:"cloumnSetFieldRef",ref:m},null,8,["modelValue","isSubform","sourceId","isMerge"])])]),_:1})}}});const xo=K(Do,[["__scopeId","data-v-cb330c80"]]),Eo=M({__name:"QuickFilterSettings",setup(E){const a=J();return(m,I)=>{const o=Xe;return d(),C("div",null,[l(o,{title:"将所选字段选项作为查询条件，供快速筛选记录。",type:"success",closable:!1,class:"mb-10"}),l(so,{modelValue:e(a).selectedTableView.quickFilter,"onUpdate:modelValue":I[0]||(I[0]=r=>e(a).selectedTableView.quickFilter=r),isSubform:"",sourceId:e(a).sourceId,isOptionaRange:""},null,8,["modelValue","sourceId"])])}}}),Ao=M({__name:"ButtonSelect",props:{modelValue:{},text:{},options:{},prop:{},multiple:{type:Boolean,default:!0},emptyDataText:{default:"没有数据"},isAdd:{type:Boolean},addText:{default:"新建"},disable:{type:Boolean}},emits:["update:modelValue","clickItem","add"],setup(E,{emit:a}){const m=E,I=a,o=A(()=>{var h;return((h=m.prop)==null?void 0:h.label)??"label"}),r=A(()=>{var h;return((h=m.prop)==null?void 0:h.value)??"value"}),n=(h,y)=>{const u=new Set(m.modelValue);h?u.add(y):u.delete(y),I("update:modelValue",[...u])},s=R(""),g=R([]),v=async()=>{Yt(m.options)?g.value=await m.options():g.value=m.options},c=R();we(()=>m.options,()=>{var h;(h=c.value)==null||h.reload()});const f=A(()=>{let h=[...g.value];return s.value.trim()&&(h=h.filter(y=>{var u;return(u=y[o.value])==null?void 0:u.includes(s.value.trim())})),h}),w=R(),b=h=>{var y;m.multiple||(I("clickItem",h),(y=w.value)==null||y.hide())};return(h,y)=>{const u=X,_=ye,p=oe,i=be,V=wl;return d(),O(V,He({placement:"bottom",width:360,trigger:"click","popper-class":"select-field","hide-after":0,ref_key:"ElPopoverRef",ref:w},h.$attrs),{reference:t(()=>[l(u,{class:"w100",icon:e(Zt),disabled:h.disable},{default:t(()=>[$(H(h.text),1)]),_:1},8,["icon","disabled"])]),default:t(()=>[x("div",{class:"select-body"},[x("div",{class:"pl-10 pr-10"},[l(_,{modelValue:s.value,"onUpdate:modelValue":y[0]||(y[0]=T=>s.value=T),placeholder:"搜索",clearable:"","validate-event":!1},null,8,["modelValue"])]),l(dt,{ref_key:"LoadingDataRef",ref:c,load:v},{default:t(()=>[x("ul",{class:"select-ul mt-10"},[(d(!0),C(q,null,j(f.value,(T,k)=>{var B;return d(),C("li",{key:k,onClick:D=>b(T)},[h.multiple?(d(),O(p,{key:0,modelValue:(B=h.modelValue)==null?void 0:B.includes(T[r.value]),"onUpdate:modelValue":D=>n(D,T[r.value]),"validate-event":!1},{default:t(()=>[x("div",{style:{width:"calc(100% - 20px)"}},[Me(h.$slots,"optionItem",{value:T[r.value]},()=>[l(fl,{style:{"max-width":"100%"},content:T[o.value]},null,8,["content"])],!0)])]),_:2},1032,["modelValue","onUpdate:modelValue"])):(d(),O(fl,{key:1,style:{"max-width":"calc(100%)"},content:T[o.value]},null,8,["content"]))],8,["onClick"])}),128)),f.value.length?U("",!0):(d(),C("div",{key:0,class:"az-data-empty"},H(h.emptyDataText),1))])]),_:3},512),h.isAdd?(d(),C("div",{key:0,class:"select-add"},[x("div",{class:"select-add-body",onClick:y[1]||(y[1]=T=>I("add"))},[l(i,{icon:e(kl),underline:!1,type:"primary"},{default:t(()=>[$(H(h.addText),1)]),_:1},8,["icon"])])])):U("",!0)])]),_:3},16)}}});const Vl=K(Ao,[["__scopeId","data-v-7d4f4ff9"]]),Uo=M({__name:"DisplayItemsConfig",props:{modelValue:{},item:{}},emits:["update:modelValue"],setup(E,{emit:a}){const m=E,o=ke(m,"modelValue",a),r=J(),n=A(()=>r.matchField(m.item.fieldId)),s=A(()=>{var f;return((f=n.value)==null?void 0:f.field.type)===P.linkData?n.value.field.options.sourceId:r.sourceId}),g=A(()=>{var f,w;return(f=n.value)!=null&&f.field.type&&[P.radio,P.multiple,P.switch,P.parent,P.cascader,P.departmentSingle,P.department].includes((w=n.value)==null?void 0:w.field.type)?Nl.filter(b=>b.value!==il.condition):Nl}),v=A({get(){return o.value.type??il.all},set(f){o.value={...o.value??{},type:f,condition:void 0}}}),c=()=>{var f;Tl.prompt('对"为空"项重命名',"重命名",{inputPlaceholder:"请输入",inputValue:((f=o.value.emptyOptions)==null?void 0:f.alias)??"",confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:w})=>{o.value.emptyOptions={...o.value.emptyOptions??{},alias:w}})};return(f,w)=>{const b=Oe,h=De,y=oe,u=X,_=Il,p=se;return d(),O(p,{label:"显示项"},{default:t(()=>[g.value.length?(d(),C("div",{key:0,style:{"margin-bottom":"5px",width:"100%"}},[l(h,{modelValue:v.value,"onUpdate:modelValue":w[0]||(w[0]=i=>v.value=i),placeholder:"请选择"},{default:t(()=>[(d(!0),C(q,null,j(g.value,(i,V)=>(d(),O(b,{key:V,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),v.value===e(il).condition?(d(),O(tl,{key:0,condition:e(o).condition,"onUpdate:condition":w[1]||(w[1]=i=>e(o).condition=i),class:"mt-10",btnText:"设置筛选条件",sourceId:s.value},null,8,["condition","sourceId"])):U("",!0)])):U("",!0),x("div",{class:"display_config-empty"},[l(y,{modelValue:e(o).isEmpty,"onUpdate:modelValue":w[2]||(w[2]=i=>e(o).isEmpty=i),label:'显示"为空"项'},null,8,["modelValue"]),l(_,{class:"box-item",effect:"dark",content:"重命名",placement:"top"},{default:t(()=>[l(u,{icon:e(Ge),link:"",type:"primary",onClick:c},null,8,["icon"])]),_:1})]),x("div",null,[l(y,{modelValue:e(o).isStatistics,"onUpdate:modelValue":w[3]||(w[3]=i=>e(o).isStatistics=i),label:"根据字段值统计数据量"},null,8,["modelValue"])])]),_:1})}}});const $o=K(Uo,[["__scopeId","data-v-f616c66b"]]),Bo=M({__name:"FilterItem",props:{item:{},isLeft:{type:Boolean}},emits:["remove"],setup(E,{emit:a}){const m=E,I=a,o=J(),{getFieldInfo:r}=rt(),n=(T,k)=>{const B=r(T,{sourceId:o.sourceId});if(!(!B||!("dataOptions"in B.field.options)))return ea(B.field.options.dataOptions,k)},s=async T=>{const k=r(T,{sourceId:o.sourceId});if(!k||!("dataOptions"in k.field.options))return;const B=await Gl(k.field.options.dataOptions),D=m.item;D&&(D.options?D.options=D.options.filter(F=>B.some(S=>S.value===F.value)):D.options=B.map(F=>({alias:"",value:F.value})))},g=async T=>{const k=r(T,{sourceId:o.sourceId});return!k||!("dataOptions"in k.field.options)?[]:await Gl(k.field.options.dataOptions)},v=T=>{m.item.options=T.map(k=>{var B;return((B=m.item.options)==null?void 0:B.find(D=>D.value===k))??{alias:"",value:k}})},c=A(()=>{var T;return(T=o.matchField(m.item.fieldId))==null?void 0:T.field}),f=A(()=>{var T;return(T=c.value)==null?void 0:T.type}),w=A(()=>f.value&&[P.radio,P.multiple].includes(f.value)),b=A(()=>m.isLeft&&f.value&&[P.parent,P.department,P.cascader].includes(f.value)),h=A(()=>{var T;return m.isLeft&&f.value&&[P.parent,P.cascader].includes(f.value)&&!(((T=c.value)==null?void 0:T.type)===P.cascader&&c.value.options.cascaderData.type===Xt.custom)}),y=A({get(){var T,k;return!!((k=(T=m.item.isSource)==null?void 0:T.auth)!=null&&k.length)},set(T){m.item.isSource||(m.item.isSource={}),m.item.isSource.auth=T?[0,1,2]:[]}}),u=A({get(){var T;return[...((T=m.item.isSource)==null?void 0:T.auth)??[]]},set(T){m.item.isSource||(m.item.isSource={}),m.item.isSource.auth=[...T]}}),_=[P.linkData,P.input,P.textarea,P.number,P.slider,P.switch,P.radio,P.multiple,P.parent,P.cascader,P.departmentSingle,P.department],p=A(()=>m.isLeft&&f.value&&_.includes(f.value)),i=T=>{m.item.displayItems=T},V=A({get(){return m.item.isAll??!0},set(T){m.item.isAll=T}});return(T,k)=>{const B=X,D=se,F=oe,S=Re,L=ue,W=Je;return d(),O(W,{class:_e(["statisics-card",{"hide-body":!w.value&&!p.value}]),shadow:"hover"},{header:t(()=>[x("div",{class:"card-header"},[l(ve,{sourceId:e(o).sourceId,fieldId:T.item.fieldId},null,8,["sourceId","fieldId"]),l(B,{type:"danger",text:"",onClick:k[0]||(k[0]=Z=>I("remove"))},{default:t(()=>[$(" 删除字段 ")]),_:1})])]),default:t(()=>[l(L,{class:"statisics-form"},{default:t(()=>[w.value?(d(),O(D,{key:0,label:"数据项"},{default:t(()=>[l(dt,{class:"w100",load:()=>s(T.item.fieldId)},{default:t(()=>{var Z;return[T.item.options?(d(),O(gl,{key:0,modelValue:T.item.options,"onUpdate:modelValue":k[1]||(k[1]=G=>T.item.options=G),"item-key":"value"},{default:t(({element:G})=>[l(ze,{readonly:"",class:"draggable-name"},{prefix:t(()=>[$(H(n(T.item.fieldId,G.value)),1)]),_:2},1024),l(ze,{modelValue:G.alias,"onUpdate:modelValue":ie=>G.alias=ie,style:{flex:"0 0 80px"},placeholder:"显示别名"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue"])):U("",!0),l(Vl,{options:()=>g(T.item.fieldId),placement:"top",text:"添加数据项","model-value":(Z=T.item.options)==null?void 0:Z.map(G=>G.value),"onUpdate:modelValue":v},null,8,["options","model-value"])]}),_:1},8,["load"])]),_:1})):U("",!0),p.value?(d(),O($o,{key:1,"model-value":T.item.displayItems??{},"onUpdate:modelValue":i,item:T.item},null,8,["model-value","item"])):U("",!0),l(D,{label:"其他"},{default:t(()=>[l(F,{modelValue:V.value,"onUpdate:modelValue":k[2]||(k[2]=Z=>V.value=Z),label:'显示"全部"项"'},null,8,["modelValue"]),b.value?(d(),O(F,{key:0,modelValue:T.item.isContainChild,"onUpdate:modelValue":k[3]||(k[3]=Z=>T.item.isContainChild=Z),label:"同时筛选出本级数据和子级数据"},null,8,["modelValue"])):U("",!0),h.value?(d(),C(q,{key:1},[l(F,{modelValue:y.value,"onUpdate:modelValue":k[4]||(k[4]=Z=>y.value=Z),label:"允许操作源数据"},null,8,["modelValue"]),l(S,{modelValue:u.value,"onUpdate:modelValue":k[5]||(k[5]=Z=>u.value=Z),class:"statisics-checkbox"},{default:t(()=>[l(F,{label:0},{default:t(()=>[$("允许新增源数据")]),_:1}),l(F,{label:1},{default:t(()=>[$("允许更新源数据")]),_:1}),l(F,{label:2},{default:t(()=>[$("允许删除源数据")]),_:1})]),_:1},8,["modelValue"])],64)):U("",!0)]),_:1})]),_:1})]),_:1},8,["class"])}}});const St=K(Bo,[["__scopeId","data-v-60f115d7"]]),Ro=M({__name:"LeftTreeFilter",setup(E){const a=J(),m=[P.department,P.departmentSingle,P.radio,P.multiple,P.parent,P.cascader,P.linkData,P.input,P.textarea,P.number,P.slider,P.switch],I={excludeFilter(r){return!m.includes(r.type)||la(r.fieldId)}},o=A({get(){var r;return((r=a.selectedTableView.basis.treeFilter)==null?void 0:r.fieldId)??""},set(r){a.selectedTableView.basis.treeFilter=r?{fieldId:r,options:null}:null}});return(r,n)=>(d(),C(q,null,[l($l,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=s=>o.value=s),placeholder:"添加左侧筛选",sourceId:e(a).sourceId,filterOptions:I,class:"mt-10"},null,8,["modelValue","sourceId"]),e(a).selectedTableView.basis.treeFilter?(d(),O(St,{key:e(a).selectedTableView.basis.treeFilter.fieldId,isLeft:"",item:e(a).selectedTableView.basis.treeFilter,onRemove:n[1]||(n[1]=s=>e(a).selectedTableView.basis.treeFilter=null)},null,8,["item"])):(d(),O(ut,{key:1,description:"没有数据",class:"pb-0"}))],64))}}),Po=M({__name:"StatisticsFilterSettings",setup(E){const a=J(),m=[P.radio,P.multiple],I=r=>Be(r,{blockFilter(n){return n.type===P.subform},excludeFilter(n){return!m.includes(n.type)}}),o=r=>{a.selectedTableView.statisticsFilter.splice(r,1)};return(r,n)=>{var v;const s=Xe,g=ct;return d(),C("div",null,[l(s,{title:"将所选字段选项作为统计筛选项，供快速查看记录。",type:"success",closable:!1}),l(s,{title:"可分别设置放于顶部、左侧的统计筛选项：",type:"info",class:"mt-10",closable:!1}),l(Ro),l(g),l($l,{modelValue:e(a).selectedTableView.statisticsFilter,"onUpdate:modelValue":n[0]||(n[0]=c=>e(a).selectedTableView.statisticsFilter=c),class:"mt-10",placeholder:"添加顶部筛选",sourceId:e(a).sourceId,filter:I,prop:{fieldId:"fieldId"},multiple:""},null,8,["modelValue","sourceId"]),l(e(pt),{tag:"div",modelValue:e(a).selectedTableView.statisticsFilter,"onUpdate:modelValue":n[1]||(n[1]=c=>e(a).selectedTableView.statisticsFilter=c),group:{name:"optionItem",pull:!1},class:"statisics-drag",handle:".el-card__header","ghost-class":"statisics-draggable-ghost-item",chosenClass:"statisics-draggable-ghost-item",animation:"300","item-key":"fieldId"},{item:t(({element:c,index:f})=>[l(St,{item:c,onRemove:()=>o(f)},null,8,["item","onRemove"])]),_:1},8,["modelValue"]),(v=e(a).selectedTableView.statisticsFilter)!=null&&v.length?U("",!0):(d(),O(ut,{key:0,description:"没有数据",class:"pb-0"}))])}}});const qo=K(Po,[["__scopeId","data-v-4899f3e3"]]),Lo=M({__name:"DataFilterSettings",setup(E){const a=J(),m=A(()=>{var o;const I=((o=a.soureceInfo)==null?void 0:o.entryIds.map(r=>r.entryId))??[];return I.length<2?I[0]:I});return(I,o)=>{var n;const r=Xe;return d(),C("div",null,[l(r,{title:"设置数据过滤条件",type:"success",closable:!1}),l(tl,{condition:e(a).selectedTableView.dataFilter,"onUpdate:condition":o[0]||(o[0]=s=>e(a).selectedTableView.dataFilter=s),class:"mt-10",btnText:"设置筛选条件",conditionForm:m.value,appId:e(a).appId},null,8,["condition","conditionForm","appId"]),(n=e(a).selectedTableView.dataFilter)!=null&&n.length?(d(),O(Bl,{key:0,class:"mt-10",condition:e(a).selectedTableView.dataFilter,"app-id":e(a).appId,isConditionForm:Array.isArray(m.value)},null,8,["condition","app-id","isConditionForm"])):U("",!0)])}}}),Mo=M({__name:"ConfirmSettings",props:{modelValue:{type:Boolean},confirmConfig:{}},emits:["update:modelValue","submit"],setup(E,{emit:a}){const m=E,I=a,o=Te(m,"modelValue",I),r={cancel:"取消",confirmBtnName:"确定",content:"",title:""},n=R(),s=R(N(r)),g=Ee({title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入提示内容",trigger:"blur"}],confirmBtnName:[{required:!0,message:"请输入确定按钮名称",trigger:"blur"}]});we(o,()=>{o.value&&(s.value=N(m.confirmConfig??r)),setTimeout(()=>{var c;(c=n.value)==null||c.clearValidate()},40)});const v=async()=>{var c;await((c=n.value)==null?void 0:c.validate()),I("submit",N(s.value)),o.value=!1};return(c,f)=>{const w=ye,b=se,h=X,y=ue,u=xe;return d(),O(u,{modelValue:e(o),"onUpdate:modelValue":f[5]||(f[5]=_=>ne(o)?o.value=_:null),title:"确认信息设置",width:"500"},{footer:t(()=>[x("span",{class:"dialog-footer"},[l(h,{onClick:f[4]||(f[4]=_=>o.value=!1)},{default:t(()=>[$("取消")]),_:1}),l(h,{type:"primary",onClick:v},{default:t(()=>[$("确定")]),_:1})])]),default:t(()=>[l(y,{ref_key:"ruleFormRef",ref:n,model:s.value,rules:g,"label-position":"right","label-width":"100",class:"label-blod confirm_settings"},{default:t(()=>[l(b,{label:"标题",prop:"title"},{default:t(()=>[l(w,{modelValue:s.value.title,"onUpdate:modelValue":f[0]||(f[0]=_=>s.value.title=_),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),l(b,{label:"提示内容",prop:"content"},{default:t(()=>[l(w,{modelValue:s.value.content,"onUpdate:modelValue":f[1]||(f[1]=_=>s.value.content=_),rows:3,type:"textarea",placeholder:"请输入提示内容"},null,8,["modelValue"])]),_:1}),l(b,{label:"按钮名称",prop:"confirmBtnName",class:"mb-5"},{default:t(()=>[x("div",{class:"mr-10"},[l(ze,{modelValue:s.value.confirmBtnName,"onUpdate:modelValue":f[2]||(f[2]=_=>s.value.confirmBtnName=_),placeholder:"请输入确认按钮名称","is-blur-cache":"","blur-value":"确定",maxlength:7},null,8,["modelValue"])]),l(h,{type:"primary"},{default:t(()=>[$(H(s.value.confirmBtnName),1)]),_:1})]),_:1}),l(b,{prop:"cancel"},{default:t(()=>[x("div",{class:"mr-10"},[l(ze,{modelValue:s.value.cancel,"onUpdate:modelValue":f[3]||(f[3]=_=>s.value.cancel=_),placeholder:"请输入取消按钮名称","is-blur-cache":"","blur-value":"取消",maxlength:7},null,8,["modelValue"])]),l(h,null,{default:t(()=>[$(H(s.value.cancel),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),Wo=M({__name:"AddOtherFormSetting",props:{modelValue:{},btnItem:{}},emits:["update:modelValue"],setup(E,{emit:a}){const m=E,o=Te(m,"modelValue",a),{getFormHtmlName:r}=lt(),n=J(),s=R(!1),g=()=>{s.value=!0,c.value=N(o.value??v),setTimeout(()=>{var p;(p=b.value)==null||p.clearValidate()},40)},v={targetEntryId:"",transferValueField:[]},c=R(N(v)),f=R(),w=R(),b=R(),h=Ee({targetEntryId:[{required:!0,message:"请选择目标表单",trigger:"change"}],conditions:[{required:!0,message:"条件不能为空",trigger:"change"}]}),y=async()=>{var p,i,V;await Promise.all([(p=b.value)==null?void 0:p.validate(),(i=f.value)==null?void 0:i.validate(),(V=w.value)==null?void 0:V.validate()]),s.value=!1,o.value=N(c.value)},u=A(()=>mt({isFunction:!0}).filter(p=>!(m.btnItem.position===ee.event&&p.value===$e.currentField)).map(p=>{const i={...p};return p.value===$e.currentField&&(i.label="数据集字段值"),i})),_=()=>{c.value.transferValueField=[],c.value.conditions=void 0,c.value.fileMode=void 0};return(p,i)=>{const V=be,T=ye,k=se,B=oe,D=ue,F=X,S=xe;return d(),O(k,{class:"mb-10",prop:"addOtherFormData",rules:[{required:!0,message:"请设置动作规则",trigger:"change"}]},{default:t(()=>[x("div",{class:"config-info mt-10"},[l(V,{type:"primary",underline:!1,icon:e(Ge),class:"config-info-edit",onClick:g,title:"编辑"},null,8,["icon"]),e(o)?(d(),C("div",{key:1},[$(" 新增目标表单： "),x("span",{class:"bold",innerHTML:e(r)(e(o).targetEntryId)},null,8,["innerHTML"])])):(d(),C("div",{key:0,class:"config-info-empty"},"未设置动作规则"))]),te(l(T,{"model-value":JSON.stringify(e(o)??null)},null,8,["model-value"]),[[ae,!1]]),l(S,{modelValue:s.value,"onUpdate:modelValue":i[6]||(i[6]=L=>s.value=L),title:p.btnItem.customAction===e(Ve).addOrEditOtherForm?"新增或修改表单数据设置":"新增表单数据设置",width:"800","close-on-click-modal":!1,"append-to-body":""},{footer:t(()=>[x("div",{class:"table_designer-addother-footer"},[x("div",null,[c.value.targetEntryId?(d(),O(Ul,{key:0,modelValue:c.value.fileMode,"onUpdate:modelValue":i[4]||(i[4]=L=>c.value.fileMode=L),entryId:c.value.targetEntryId,showConfig:!1},null,8,["modelValue","entryId"])):U("",!0)]),x("span",{style:{"margin-left":"auto"}},[l(F,{onClick:i[5]||(i[5]=L=>s.value=!1)},{default:t(()=>[$("取消")]),_:1}),l(F,{type:"primary",onClick:y},{default:t(()=>[$("确定")]),_:1})])])]),default:t(()=>[l(D,{ref_key:"ruleFormRef",ref:b,model:c.value,rules:h,"label-position":"right","label-width":"150",class:"label-blod"},{default:t(()=>[l(z,{label:"目标表单",prop:"targetEntryId",tip:"新增数据的表单"},{default:t(()=>[l(Tt,{modelValue:c.value.targetEntryId,"onUpdate:modelValue":i[0]||(i[0]=L=>c.value.targetEntryId=L),"app-id":e(n).appId,onChange:_,class:"w30"},null,8,["modelValue","app-id"])]),_:1}),p.btnItem.customAction===e(Ve).addOrEditOtherForm?(d(),O(k,{key:0,prop:"conditions",label:"修改哪些目标数据"},{default:t(()=>[l(io,{condition:c.value.conditions,"onUpdate:condition":i[1]||(i[1]=L=>c.value.conditions=L),class:"w100",ref_key:"fieldConditionRef",ref:w,conditionForm:c.value.targetEntryId},null,8,["condition","conditionForm"]),te(l(T,{"model-value":String(c.value.conditions)},null,8,["model-value"]),[[ae,!1]])]),_:1})):U("",!0),l(k,{label:"表单传递值"},{default:t(()=>[x("div",{class:"w100"},[l(kt,{modelValue:c.value.transferValueField,"onUpdate:modelValue":i[2]||(i[2]=L=>c.value.transferValueField=L),ref_key:"SetFieldDefaultRef",ref:f,leftEntryId:c.value.targetEntryId,rightSourceId:e(n).sourceId,leftFieldColumnName:"目标表单字段名称",customTypeList:u.value,isSubform:"",formulaProp:{group:[{id:e(n).sourceId,sourceTransformEntry:!0,fieldOptions:{sourceId:e(n).sourceId}}]}},null,8,["modelValue","leftEntryId","rightSourceId","customTypeList","formulaProp"])])]),_:1}),x("div",null,[l(B,{modelValue:c.value.isDirectSumbit,"onUpdate:modelValue":i[3]||(i[3]=L=>c.value.isDirectSumbit=L),label:"允许直接提交表单"},null,8,["modelValue"]),l(ft,{tip:"无需查看,编辑字段时,点击自定义按钮直接提交数据"})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])]),_:1})}}});const zo=K(Wo,[["__scopeId","data-v-d5be306d"]]),Ho=M({inheritAttrs:!1,__name:"ComponentSetting",props:{modelValue:{}},emits:["update:modelValue"],setup(E,{emit:a}){const m=E,I=a,o=J(),r=ke(m,"modelValue",I),n={componentId:[{required:!0,message:"请选择组件",trigger:"change"}]},s=v=>{var c;return(c=r.value.component)==null?void 0:c[v]},g=(v,c)=>{r.value.component||(r.value.component={componentId:""}),v==="componentId"?r.value.component={componentId:c}:r.value.component[v]=c};return(v,c)=>(d(),C(q,null,[l(z,{label:"选择组件",rules:n.componentId,alignItems:"flex-start",prop:"component.componentId"},{default:t(()=>[l(Ft,{scenario:m.modelValue.position===e(ee).event?e(vl).list_event_btn:e(vl).list_operation_btn,"onUpdate:modelValue":c[0]||(c[0]=f=>g("componentId",f)),"model-value":s("componentId")},null,8,["scenario","model-value"])]),_:1},8,["rules"]),s("componentId")?(d(),C("div",{key:s("componentId")},[l(z,{label:"请求参数配置",prop:"component.requestParams"},{default:t(()=>[l(ro,{"onUpdate:modelValue":c[1]||(c[1]=f=>g("requestParams",f)),"model-value":s("requestParams"),"custom-params":s("customParams"),"onUpdate:customParams":c[2]||(c[2]=f=>g("customParams",f)),componentId:s("componentId"),appId:e(o).appId,clientScene:m.modelValue.position===e(ee).event?e(jl).list_event_btn:e(jl).list_operation_btn,"current-entry-info":{sourceId:e(o).sourceId},hideCurrentEntryInfo:"",group:[{id:"field",title:"数据集控件",fieldOptions:{sourceId:e(o).sourceId}},e(hl)({title:"系统数据"})]},null,8,["model-value","custom-params","componentId","appId","clientScene","current-entry-info","group"])]),_:1}),l(z,{alignItems:"flex-start",label:"返回结果处理",prop:"component.postAction",style:{"margin-bottom":"10px"}},{default:t(()=>[l(uo,{style:{width:"100%"},"onUpdate:modelValue":c[3]||(c[3]=f=>g("postAction",f)),"model-value":s("postAction"),componentId:s("componentId")},null,8,["model-value","componentId"])]),_:1})])):U("",!0)],64))}}),Ot=()=>({pageOpenWay:vt.embed,type:ta.out}),No=E=>{var m,I;const a=[hl()];return(m=E.currentEntryInfo)!=null&&m.sourceId&&a.unshift({id:_t,title:"当前数据集",fieldOptions:{sourceId:(I=E.currentEntryInfo)==null?void 0:I.sourceId}}),a},Dt=E=>{var m,I;const a=[hl({isClient:!0})];return a.push({id:aa,title:"前置动作参数",pluginOptions:{pluginId:E.pluginId,pluginIdByPrefix:!0},hidden:!E.pluginId}),(m=E.currentEntryInfo)!=null&&m.sourceId&&a.unshift({id:_t,title:"当前数据集",fieldOptions:{sourceId:(I=E.currentEntryInfo)==null?void 0:I.sourceId}}),a},xt=async E=>{},Go=async E=>{var o;const{dataSystem:a,openPage:m,currentEntryInfo:I}=E;await Promise.all([xt({dataSystem:a,openPreAction:m==null?void 0:m.openPreAction,currentEntryInfo:I}),oa({dataSystem:a,group:Dt({currentEntryInfo:I,pluginId:(o=m==null?void 0:m.openPreAction)==null?void 0:o.pluginId}),value:(m==null?void 0:m.externalPageUrl)??""})])},jo=M({__name:"BeforeAction",props:{modelValue:{},currentEntryInfo:{}},emits:["update:modelValue"],setup(E,{emit:a}){const m=E,o=Te(m,"modelValue",a),r=A(()=>No({currentEntryInfo:m.currentEntryInfo})),n={type:dl.plugin},s=R(N(n)),g=R(!1),v=()=>{g.value=!0,s.value=N(o.value??n),o.value&&Cl(()=>{var y;(y=c.value)==null||y.validate()})},c=R(),f={pluginId:[{required:!0,message:"请选择插件",trigger:"change"}]},w=async()=>{var y;await((y=c.value)==null?void 0:y.validate()),o.value=N(s.value),g.value=!1},b=Ke(),{addRule:h}=Fl();return h({validator(y,u,_){xt({dataSystem:b,openPreAction:o.value,currentEntryInfo:m.currentEntryInfo}).then(()=>_()).catch(p=>_(typeof p=="string"?new Error(p):new Error((p==null?void 0:p.msg)??"未知异常")))},trigger:"change"}),(y,u)=>{const _=ye,p=de,i=re,V=se,T=ue,k=X;return d(),C("div",{style:{width:"250px"}},[l(Qe,{text:"设置动作",isSet:!!e(o),onClick:v,clear:"",onClear:u[0]||(u[0]=B=>o.value=void 0)},null,8,["isSet"]),te(l(_,{"model-value":JSON.stringify(e(o)??"")},null,8,["model-value"]),[[ae,!1]]),l(je,{modelValue:g.value,"onUpdate:modelValue":u[6]||(u[6]=B=>g.value=B),"append-to-body":"",title:"设置动作","destroy-on-close":""},{footer:t(()=>[x("span",{class:"dialog-footer"},[l(k,{onClick:u[5]||(u[5]=B=>g.value=!1)},{default:t(()=>[$("取消")]),_:1}),l(k,{type:"primary",onClick:w},{default:t(()=>[$("确定")]),_:1})])]),default:t(()=>[l(T,{ref_key:"ruleFormRef",ref:c,model:s.value,"label-suffix":"：",rules:f,"label-width":"100px"},{default:t(()=>[l(V,{label:"动作类型"},{default:t(()=>[l(i,{modelValue:s.value.type,"onUpdate:modelValue":u[1]||(u[1]=B=>s.value.type=B)},{default:t(()=>[l(p,{label:e(dl).plugin},{default:t(()=>[$("调用插件")]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),s.value.type===e(dl).plugin?(d(),C(q,{key:0},[l(z,{label:"选择插件",prop:"pluginId"},{default:t(()=>[l(po,{style:{width:"60%"},modelValue:s.value,"onUpdate:modelValue":u[2]||(u[2]=B=>s.value=B),onChange:u[3]||(u[3]=B=>s.value.params=void 0)},null,8,["modelValue"])]),_:1}),s.value.pluginId?(d(),O(z,{label:"请求参数",prop:"params",key:s.value.pluginId},{default:t(()=>[l(co,{style:{width:"60%"},modelValue:s.value.params,"onUpdate:modelValue":u[4]||(u[4]=B=>s.value.params=B),pluginId:s.value.pluginId,group:r.value},null,8,["modelValue","pluginId","group"])]),_:1})):U("",!0)],64)):U("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ko=M({__name:"OpenPageSet",props:{modelValue:{},currentEntryInfo:{},excludePageOpenType:{default(){return[vt.embed]}}},emits:["update:modelValue"],setup(E,{expose:a,emit:m}){const I=E,r=ke(I,"modelValue",m),n={externalPageUrl:[{required:!0,message:"请输入",trigger:"change"}],pageOpenWay:[{required:!0,message:"请选择",trigger:"change"}]},s=A(()=>na.filter(f=>!I.excludePageOpenType.includes(f.value)));we([s,()=>{var f;return(f=r.value)==null?void 0:f.pageOpenWay}],()=>{s.value.some(f=>{var w;return f.value===((w=r.value)==null?void 0:w.pageOpenWay)})||g(s.value[0].value,"pageOpenWay")},{immediate:!0});function g(f,w){r.value||(r.value=Ot()),r.value[w]=f}const v=A(()=>{var f,w;return Dt({currentEntryInfo:I.currentEntryInfo,pluginId:(w=(f=r.value)==null?void 0:f.openPreAction)==null?void 0:w.pluginId})}),c=R();return a({validate(){var f,w;return(w=(f=c.value)==null?void 0:f.ruleFormRef)==null?void 0:w.validate()}}),(f,w)=>{const b=de,h=re;return d(),O(tt,{model:e(r),ref_key:"azFormRef",ref:c,rules:n},{default:t(()=>[l(z,{label:"页面打开前动作"},{default:t(()=>{var y;return[l(jo,{"model-value":(y=e(r))==null?void 0:y.openPreAction,"onUpdate:modelValue":w[0]||(w[0]=u=>g(u,"openPreAction")),currentEntryInfo:f.currentEntryInfo},null,8,["model-value","currentEntryInfo"])]}),_:1}),l(z,{label:"页面链接地址",class:"desiger-inputare",prop:"externalPageUrl"},{default:t(()=>{var y;return[l(cl,{"model-value":(y=e(r))==null?void 0:y.externalPageUrl,"onUpdate:modelValue":w[1]||(w[1]=u=>g(u,"externalPageUrl")),group:v.value,minHeight:"64px"},null,8,["model-value","group"])]}),_:1}),l(z,{label:"页面打开方式",prop:"pageOpenWay"},{default:t(()=>{var y;return[l(h,{"model-value":(y=e(r))==null?void 0:y.pageOpenWay,"onUpdate:modelValue":w[2]||(w[2]=u=>g(u,"pageOpenWay")),class:"ml-4"},{default:t(()=>[(d(!0),C(q,null,j(s.value,u=>(d(),O(b,{key:u.value,label:u.value},{default:t(()=>[$(H(u.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["model-value"])]}),_:1})]),_:1},8,["model"])}}}),Jo=M({__name:"OpenPageWrapper",props:{modelValue:{},currentEntryInfo:{}},emits:["update:modelValue"],setup(E,{emit:a}){const m=E,o=Te(m,"modelValue",a),r=R(!1),n=R(),s=R(),g=()=>{s.value=N(o.value??Ot()),r.value=!0},v=async()=>{var w;await((w=n.value)==null?void 0:w.validate()),o.value=N(s.value),r.value=!1},c=Ke(),{addRule:f}=Fl();return f({validator(w,b,h){Go({dataSystem:c,openPage:o.value,currentEntryInfo:m.currentEntryInfo}).then(()=>h()).catch(y=>{typeof y=="string"?h(new Error(y)):h()})},trigger:"change"}),(w,b)=>{const h=ye,y=X;return d(),C("div",{class:_e(["paramsset_wrapper",w.$attrs.class]),style:pl(w.$attrs.style)},[x("div",{onClick:g},[Me(w.$slots,"default",{},()=>{var u;return[l(Qe,{isSet:!!((u=e(o))!=null&&u.externalPageUrl),text:"设置页面"},null,8,["isSet"])]})]),te(l(h,{"model-value":JSON.stringify(e(o)??"")},null,8,["model-value"]),[[ae,!1]]),l(je,{modelValue:r.value,"onUpdate:modelValue":b[2]||(b[2]=u=>r.value=u),title:"页面设置",width:"600","destroy-on-close":"","close-on-click-modal":!1,"append-to-body":""},{footer:t(()=>[x("span",{class:"dialog-footer"},[l(y,{onClick:b[1]||(b[1]=u=>r.value=!1)},{default:t(()=>[$("取消")]),_:1}),l(y,{type:"primary",onClick:v},{default:t(()=>[$("确定")]),_:1})])]),default:t(()=>[l(Ko,He({ref_key:"openPageSetRef",ref:n,modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=u=>s.value=u),currentEntryInfo:w.currentEntryInfo},e(_l)(w.$attrs,["class","style"])),null,16,["modelValue","currentEntryInfo"])]),_:1},8,["modelValue"])],6)}}}),Qo=M({inheritAttrs:!1,__name:"OpenPageSetting",props:{modelValue:{}},emits:["update:modelValue"],setup(E,{emit:a}){const o=ke(E,"modelValue",a),r=J();return(n,s)=>(d(),O(z,{label:"页面设置",prop:"openPage",style:{"margin-top":"18px"},rules:[{required:!0,message:"请设置",trigger:"change"}]},{default:t(()=>[l(Jo,{modelValue:e(o).openPage,"onUpdate:modelValue":s[0]||(s[0]=g=>e(o).openPage=g),style:{width:"100%"},"current-entry-info":e(o).position===e(ee).operate?{sourceId:e(r).sourceId}:void 0},null,8,["modelValue","current-entry-info"])]),_:1}))}}),Zo=M({__name:"EditSelfForm",props:{modelValue:{},btnItem:{}},emits:["submit"],setup(E,{emit:a}){const m=E,o=Te(m,"modelValue",a),r=J(),n=A(()=>m.btnItem.position===ee.event),s=[{required:!0,message:"请设置动作规则",trigger:"change"},{validator:(D,F,S)=>{var L;(L=F==null?void 0:F.editFields)!=null&&L.length?S():S(new Error("请设置完成的动作规则"))},trigger:"change"}],g=R(!1),v=()=>{g.value=!0,b.value=N(o.value??f.value),setTimeout(()=>{var D;(D=w.value)==null||D.clearValidate()},40)},c=D=>{var S;const F=(S=r.soureceInfo)==null?void 0:S.forms.find(L=>L.entryId===D);return(F==null?void 0:F.name)??'<span class="red">该表单不在该数据集下或者该表单已被删除</span>'},f=A(()=>{var D,F;return{entryId:((F=(D=r.soureceInfo)==null?void 0:D.forms[0])==null?void 0:F.entryId)??"",editFields:[]}}),w=R(),b=R(N(f.value)),h=Ee({entryId:[{required:!0,message:"请选择表单",trigger:"change"}],editFields:[{required:!0,message:"请至少选择一个字段",trigger:"change"}]}),y=A(()=>b.value.entryId?Be(r.fields,{excludeFilter(D){return D.source===Kl.system||sa(D.fieldId).entryId!==b.value.entryId}}):null),u=A({get(){return b.value.editFields.map(D=>D.fieldId)},set(D){b.value.editFields=D.map(F=>{var S;return b.value.editFields.find(L=>L.fieldId===F)||{fieldId:F,readable:!0,writeable:!0,defaultType:n.value?$e.custom:$e.currentField,currentFieldId:F,currentFieldType:(S=r.matchField(F))==null?void 0:S.field.type}})}}),_=A(()=>Be(y.value??[],{excludeFilter(D){return D.source===Kl.system||!u.value.some(F=>F===D.fieldId)}})),p=({fieldId:D})=>b.value.editFields.find(F=>F.fieldId===D),i=(D,F)=>{const S=b.value.editFields.findIndex(L=>L.fieldId===D.fieldId);S>-1&&(b.value.editFields[S]=F)},V=D=>{var F;if(D!=null&&D.fieldId){const S=(F=r.matchField(D.fieldId))==null?void 0:F.parentField;if((S==null?void 0:S.type)===P.subform)return{parentFieldDefault:b.value.editFields.find(L=>L.fieldId===S.fieldId),totalFields:r.fields}}return{totalFields:r.fields}},T=A(()=>mt({isFunction:!0}).filter(D=>!(m.btnItem.position===ee.event&&D.value===$e.currentField)).map(D=>{const F={...D};return D.value===$e.currentField&&(F.label="数据集字段值",F.disabled=!0),F})),k=D=>{Sl(b.value.editFields,F=>{const S=r.matchField(F.fieldId);return!!(S!=null&&S.matched.some(L=>L.fieldId===D.fieldId))})},B=async()=>{var D;await((D=w.value)==null?void 0:D.validate()),o.value=N(b.value),g.value=!1};return(D,F)=>{const S=be,L=ye,W=se,Z=de,G=re,ie=Ol,qe=oe,Ae=ue,he=X,Et=xe;return d(),C(q,null,[l(W,He({prop:"editSelfFormData",rules:s,class:"mb-10"},D.$attrs),{default:t(()=>[x("div",{class:"config-info mt-10 w100"},[l(S,{type:"primary",underline:!1,icon:e(Ge),class:"config-info-edit",onClick:v,title:"编辑"},null,8,["icon"]),e(o)?(d(),C("div",{key:1},[$(" 编辑目标表单： "),x("span",{class:"bold",innerHTML:c(e(o).entryId)},null,8,["innerHTML"])])):(d(),C("div",{key:0,class:"config-info-empty"},"未设置动作规则"))]),te(l(L,{"model-value":JSON.stringify(D.btnItem.editSelfFormData??null)},null,8,["model-value"]),[[ae,!1]])]),_:1},16),l(Et,{modelValue:g.value,"onUpdate:modelValue":F[7]||(F[7]=Q=>g.value=Q),title:"编辑本表单数据设置",width:"1100","close-on-click-modal":!1,"append-to-body":""},{footer:t(()=>[x("div",{class:"table_designer-editself-footer"},[x("div",null,[b.value.entryId?(d(),O(Ul,{key:0,modelValue:b.value.fileMode,"onUpdate:modelValue":F[5]||(F[5]=Q=>b.value.fileMode=Q),entryId:b.value.entryId,showConfig:!1},null,8,["modelValue","entryId"])):U("",!0)]),x("span",{style:{"margin-left":"auto"}},[l(he,{onClick:F[6]||(F[6]=Q=>g.value=!1)},{default:t(()=>[$("取消")]),_:1}),l(he,{type:"primary",onClick:B},{default:t(()=>[$("确定")]),_:1})])])]),default:t(()=>[l(Ae,{ref_key:"ruleFormRef",ref:w,model:b.value,rules:h,"label-position":"right","label-width":"120",class:"label-blod confirm_settings"},{default:t(()=>[l(W,{label:"需编辑的表单",prop:"entryId"},{default:t(()=>[l(G,{modelValue:b.value.entryId,"onUpdate:modelValue":F[0]||(F[0]=Q=>b.value.entryId=Q),onChange:F[1]||(F[1]=Q=>{b.value.editFields=[],b.value.fileMode=void 0})},{default:t(()=>{var Q;return[(d(!0),C(q,null,j((Q=e(r).soureceInfo)==null?void 0:Q.forms,ge=>(d(),O(Z,{label:ge.entryId,key:ge.entryId},{default:t(()=>[$(H(ge.name),1)]),_:2},1032,["label"]))),128))]}),_:1},8,["modelValue"])]),_:1}),l(W,{label:"需编辑的字段",prop:"editFields"},{default:t(()=>[x("div",{style:{width:"300px"}},[l($l,{modelValue:u.value,"onUpdate:modelValue":F[2]||(F[2]=Q=>u.value=Q),isSelectSubform:"",fields:y.value,text:"选择字段",multiple:""},null,8,["modelValue","fields"])])]),_:1}),l(Ct,{modelValue:b.value.editFields,"onUpdate:modelValue":F[3]||(F[3]=Q=>b.value.editFields=Q),isRequired:"",fields:_.value,"empty-text":"请选择要编辑的字段",isDownload:"",auth:{isTemplate:!0}},{default:t(()=>[l(ie,{label:"默认值","min-width":"200"},{default:t(({row:Q})=>[l(ao,He({"model-value":p(Q),"onUpdate:modelValue":ge=>i(Q,ge),field:Q,prop:`editFields.${b.value.editFields.findIndex(ge=>ge.fieldId===Q.fieldId)}`,customTypeList:T.value,sourceId:e(r).sourceId,formulaProp:{group:[{id:e(r).sourceId,sourceTransformEntry:!0,fieldOptions:{sourceId:e(r).sourceId}}]}},{...V(Q)}),null,16,["model-value","onUpdate:modelValue","field","prop","customTypeList","sourceId","formulaProp"])]),_:1}),l(ie,{width:"50"},{default:t(({row:Q})=>[l(S,{underline:!1,icon:e(ia),type:"danger",onClick:ge=>k(Q)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["modelValue","fields"]),x("div",null,[l(qe,{modelValue:b.value.isDirectSumbit,"onUpdate:modelValue":F[4]||(F[4]=Q=>b.value.isDirectSumbit=Q),label:"允许直接提交表单"},null,8,["modelValue"]),l(ft,{tip:"无需查看,编辑字段时,点击自定义按钮直接提交数据"})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}});const Yo=K(Zo,[["__scopeId","data-v-6ebd521e"]]),Xo=M({inheritAttrs:!1,__name:"DataValidate",props:{modelValue:{},formulaProp:{},isMultiple:{type:Boolean}},emits:["update:modelValue"],setup(E,{emit:a}){const m=E,o=ke(m,"modelValue",a),r=R(!1),n=R(!1),s=()=>{r.value=!0},g=R(0),v=R(da.only),c=u=>{v.value=u,f()},f=u=>{var _;n.value=!0,g.value=u??((_=o.value)==null?void 0:_.length)??0},w=u=>{var p;const _={...u,clientId:u.clientId||Ce((p=o.value)==null?void 0:p.map(i=>i.clientId))};o.value||(o.value=[]),o.value[g.value]=_},b=Ke(),h=R(new Map),{addRule:y}=Fl();return y({validator(u,_,p){var i;Promise.all(((i=o.value)==null?void 0:i.map(async V=>{try{return await ra({data:V,dataSystem:b,formulaProp:m.formulaProp}),h.value.delete(V.clientId),!0}catch(T){return typeof T=="string"?(h.value.set(V.clientId,T),!1):(h.value.delete(V.clientId),!0)}}))??[]).then(V=>{h.value,V.every(T=>T)?p():p(new Error("规则配置异常")),p()})},trigger:"change"}),(u,_)=>{var L,W,Z;const p=ye,i=X,V=wl,T=se,k=ue,B=be,D=ct,F=ca,S=Je;return d(),C(q,null,[l(Qe,{text:"设置校验规则",onClick:s,"is-set":!!((L=e(o))!=null&&L.length),setText:`已设置 ${(W=e(o))==null?void 0:W.length} 条规则`},null,8,["is-set","setText"]),te(l(p,{"model-value":JSON.stringify(e(o)??"")},null,8,["model-value"]),[[ae,!1]]),l(el,{modelValue:r.value,"onUpdate:modelValue":_[1]||(_[1]=G=>r.value=G),"append-to-body":"",title:"设置校验规则",size:"90%",direction:"btt",class:"data_validate"},{default:t(()=>[l(S,{class:"rule-card"},{header:t(()=>[l(V,{placement:"bottom",width:180,trigger:"click",disabled:!u.isMultiple,"popper-class":"az-custom-popper",transition:"el-zoom-in-top",content:"123"},{reference:t(()=>[l(i,{type:"primary",icon:e(kl),onClick:_[0]||(_[0]=()=>!u.isMultiple&&f())},{default:t(()=>[$(" 添加规则 ")]),_:1},8,["icon"])]),default:t(()=>[x("ul",{class:"az-custom-popper-menu"},[(d(!0),C(q,null,j(e(ua),(G,ie)=>(d(),C("li",{class:"az-custom-popper-menu__item",key:ie,onClick:qe=>c(G.value)},[x("span",{class:"ml-5"},H(G.label),1)],8,["onClick"]))),128))])]),_:1},8,["disabled"])]),default:t(()=>{var G;return[l(e(pt),{tag:"div",list:e(o),group:{name:"data_validate",pull:!1},animation:"300","ghost-class":"rule-describe-ghost-item",chosenClass:"rule-describe-ghost-item",handle:".rule-describe",class:"rule-describe-container","item-key":"clientId"},{item:t(({element:ie,index:qe})=>[x("div",{class:"rule-item"},[x("div",{class:"rule-item-body"},[x("div",{class:"rule-describe"},[l(k,{"label-suffix":":"},{default:t(()=>[l(T,{label:"规则名称",style:{"margin-bottom":"0"}},{default:t(()=>[$(H(ie.name),1)]),_:2},1024),l(T,{label:"不满足校验规则时",style:{"margin-bottom":"0"}},{default:t(()=>{var Ae;return[$(H((Ae=e(pa).find(he=>he.value===ie.errorAfterAction))==null?void 0:Ae.label),1)]}),_:2},1024),l(T,{label:"不满足校验规则时提示文字",style:{"margin-bottom":"0"}},{default:t(()=>[$(H(ie.tip),1)]),_:2},1024)]),_:2},1024)]),x("div",{class:"rule-operate"},[l(B,{type:"primary",underline:!1,onClick:Ae=>f(qe)},{default:t(()=>[$(" 编辑 ")]),_:2},1032,["onClick"]),l(D,{direction:"vertical"}),l(F,{title:"确定要删除该规则?",onConfirm:Ae=>{var he;return(he=e(o))==null?void 0:he.splice(qe,1)}},{reference:t(()=>[l(B,{type:"danger",underline:!1},{default:t(()=>[$("删除")]),_:1})]),_:2},1032,["onConfirm"])])]),h.value.has(ie.clientId)?(d(),C("div",{key:0,class:"rule-error"},H(h.value.get(ie.clientId)),1)):U("",!0)])]),_:1},8,["list"]),(G=e(o))!=null&&G.length?U("",!0):(d(),C("div",{key:0,class:"rule-empty"}," 通过函数计算数据是否满足特定条件，当不满条件时，执行对应动作。 "))]}),_:1})]),_:1},8,["modelValue"]),l(to,{modelValue:n.value,"onUpdate:modelValue":_[2]||(_[2]=G=>n.value=G),onSubmit:w,data:(Z=e(o))==null?void 0:Z[g.value],formulaProp:u.formulaProp,addType:v.value},null,8,["modelValue","data","formulaProp","addType"])],64)}}});const en=K(Xo,[["__scopeId","data-v-3fef249f"]]),ln=M({__name:"CustomSettings",props:{modelValue:{},visible:{type:Boolean}},emits:["update:modelValue"],setup(E,{emit:a}){const m=E,I=a,o=ke(m,"modelValue",I),r=J(),n=A(()=>{var w;return ma({sourceAuth:((w=r.soureceInfo)==null?void 0:w.sourceAuth)??fa.currentAppForm})});we(()=>m.visible,()=>{Cl(()=>{var w;m.visible&&!o.value.customAction&&((w=n.value[0])!=null&&w.value)&&(o.value.customAction=n.value[0].value)})},{immediate:!0});const s=Ee({confirmConfig:[{required:!0,message:"请设置确认信息",trigger:"change"}],customAction:[{required:!0,message:"请选择按钮动作",trigger:"change"}]}),g=w=>{w!==m.modelValue.customAction&&I("update:modelValue",{...m.modelValue,customAction:w,editSelfFormData:void 0,addOtherFormData:void 0})},v=R(!1),c=()=>{v.value=!0},f=w=>{I("update:modelValue",{...m.modelValue,isConfirm:w,confirmConfig:void 0}),w&&c()};return(w,b)=>{const h=Oe,y=De,u=se,_=oe,p=be,i=ye;return d(),C("div",{class:"custom_settings"},[l(u,{label:"按钮动作",prop:"customAction",rules:s.customAction,class:_e({"mb-0":e(o).customAction&&![e(Ve).component].includes(e(o).customAction)})},{default:t(()=>[l(y,{"model-value":e(o).customAction,"onUpdate:modelValue":g,placeholder:"请选择按钮动作"},{default:t(()=>[(d(!0),C(q,null,j(n.value,(V,T)=>(d(),O(h,{key:T,label:V.label,value:V.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"])]),_:1},8,["rules","class"]),e(o).customAction===e(Ve).editSelfForm?(d(),O(Yo,{key:0,modelValue:e(o).editSelfFormData,"onUpdate:modelValue":b[0]||(b[0]=V=>e(o).editSelfFormData=V),"btn-item":e(o)},null,8,["modelValue","btn-item"])):U("",!0),e(o).customAction&&[e(Ve).addOtherForm,e(Ve).addOrEditOtherForm].includes(e(o).customAction)?(d(),O(zo,{key:1,modelValue:e(o).addOtherFormData,"onUpdate:modelValue":b[1]||(b[1]=V=>e(o).addOtherFormData=V),"btn-item":e(o)},null,8,["modelValue","btn-item"])):U("",!0),e(o).customAction===e(Ve).component?(d(),O(Ho,{key:2,modelValue:e(o),"onUpdate:modelValue":b[2]||(b[2]=V=>ne(o)?o.value=V:null)},null,8,["modelValue"])):U("",!0),e(o).customAction===e(Ve).openPage?(d(),O(Qo,{key:3,modelValue:e(o),"onUpdate:modelValue":b[3]||(b[3]=V=>ne(o)?o.value=V:null)},null,8,["modelValue"])):U("",!0),l(u,{label:"操作确认",class:_e({"mb-0":e(o).isConfirm})},{default:t(()=>[l(_,{"model-value":!!e(o).isConfirm,"onUpdate:modelValue":f,class:"w100"},{default:t(()=>[$(" 点击时是否需要二次确认 ")]),_:1},8,["model-value"])]),_:1},8,["class"]),e(o).isConfirm?(d(),O(u,{key:4,prop:"confirmConfig",rules:s.confirmConfig,class:"mb-10"},{default:t(()=>{var V,T,k,B;return[x("div",{class:"config-info"},[l(p,{type:"primary",underline:!1,icon:e(Ge),class:"config-info-edit",onClick:c,title:"编辑"},null,8,["icon"]),e(o).confirmConfig?U("",!0):(d(),C("div",{key:0,class:"config-info-empty"}," 未设置确认信息 ")),(V=e(o).confirmConfig)!=null&&V.title?(d(),C("div",{key:1,class:"config-info-text","data-title":"标题"},H((T=e(o).confirmConfig)==null?void 0:T.title),1)):U("",!0),(k=e(o).confirmConfig)!=null&&k.content?(d(),C("div",{key:2,class:"config-info-text","data-title":"提示内容"},H((B=e(o).confirmConfig)==null?void 0:B.content),1)):U("",!0)]),te(l(i,{"model-value":JSON.stringify(e(o).confirmConfig??null)},null,8,["model-value"]),[[ae,!1]])]}),_:1},8,["rules"])):U("",!0),l(z,{label:"数据校验",tip:"数据校验通过, 方可进行操作",prop:"dataValidate"},{default:t(()=>[l(en,{modelValue:e(o).dataValidate,"onUpdate:modelValue":b[4]||(b[4]=V=>e(o).dataValidate=V),isMultiple:e(o).position===e(ee).event,formulaProp:{group:[{id:"source",sourceTransformEntry:!0,fieldOptions:{sourceId:e(r).sourceId}}]}},null,8,["modelValue","isMultiple","formulaProp"])]),_:1}),l(Mo,{modelValue:v.value,"onUpdate:modelValue":b[5]||(b[5]=V=>v.value=V),confirmConfig:e(o).confirmConfig,onSubmit:b[6]||(b[6]=V=>e(o).confirmConfig=V)},null,8,["modelValue","confirmConfig"])])}}});const tn=K(ln,[["__scopeId","data-v-b7f37faa"]]),an=M({__name:"ExportSettings",props:{modelValue:{}},emits:["update:modelValue"],setup(E,{emit:a}){const o=ke(E,"modelValue",a),r=[{required:!0,message:"至少选择一种导出类型",trigger:"change"}],n=J(),s=R(!1),g=A(()=>va(n.fields)),v=()=>{s.value=!0,Cl(()=>{var h;(h=o.value.exportDefaultFieldIds)==null||h.forEach(y=>{var _,p;const u=(_=Ne(y,g.value))==null?void 0:_.field;u&&((p=c.value)==null||p.toggleRowSelection(u,!0))})})},c=R(),f=(h,y)=>{var p,i;const u=h.some(V=>V.fieldId===y.fieldId),_=Ne(y.fieldId,g.value);if((_==null?void 0:_.field.type)===P.subform)_.field.fields.forEach(V=>{var T;(T=c.value)==null||T.toggleRowSelection(V,u)});else if(((p=_==null?void 0:_.parentField)==null?void 0:p.type)===P.subform){const V=_.parentField,T=new Set(V.fields.map(k=>k.fieldId));(i=c.value)==null||i.toggleRowSelection(V,h.some(k=>T.has(k.fieldId)))}},w=h=>{var u;const y=h.some(_=>_.fieldId===g.value[0].fieldId);y?h.forEach(_=>{"fields"in _&&_.fields.forEach(p=>{var i;(i=c.value)==null||i.toggleRowSelection(p,y)})}):(u=c.value)==null||u.clearSelection()},b=()=>{var h;o.value.exportDefaultFieldIds=((h=c.value)==null?void 0:h.getSelectionRows().map(y=>y.fieldId))??[],s.value=!1};return(h,y)=>{var T;const u=oe,_=Re,p=Ol,i=ya,V=X;return d(),C(q,null,[l(z,{label:"导出类型",prop:"exportType",rules:r},{default:t(()=>[l(_,{modelValue:e(o).exportType,"onUpdate:modelValue":y[0]||(y[0]=k=>e(o).exportType=k)},{default:t(()=>[(d(!0),C(q,null,j(e(_a),(k,B)=>(d(),O(u,{key:B,label:k.value},{default:t(()=>[$(H(k.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),(T=e(o).exportType)!=null&&T.includes(e(ba).excel)?(d(),O(z,{key:0,label:"导出设置"},{default:t(()=>{var k;return[l(Qe,{onClick:v,text:"设置","is-set":!!((k=e(o).exportDefaultFieldIds)!=null&&k.length)},null,8,["is-set"])]}),_:1})):U("",!0),l(je,{modelValue:s.value,"onUpdate:modelValue":y[2]||(y[2]=k=>s.value=k),title:"导出设置",width:"650","append-to-body":""},{header:t(()=>[x("div",{class:"export_field-header"},[x("span",null,"导出设置"),x("span",{class:"header-tip"}," * 保存导出设置后，用户导出Excel的字段默认为以下字段，可自行修改。 ")])]),footer:t(()=>[x("span",{class:"dialog-footer"},[l(V,{onClick:y[1]||(y[1]=k=>s.value=!1)},{default:t(()=>[$("取消")]),_:1}),l(V,{type:"primary",onClick:b},{default:t(()=>[$("确定")]),_:1})])]),default:t(()=>[l(i,{data:g.value,border:"",style:{width:"100%"},"row-key":"fieldId","max-height":"50vh","tree-props":{children:"fields"},"default-expand-all":"",ref_key:"tableRef",ref:c,class:"export_table",onSelect:f,onSelectAll:w},{default:t(()=>[l(p,{type:"selection",width:"55"}),l(p,{prop:"date",label:"名称"},{default:t(({row:k})=>[l(ve,{class:"az-flex-width",sourceId:e(n).sourceId,fieldId:k.fieldId},null,8,["sourceId","fieldId"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const on=K(an,[["__scopeId","data-v-ffffeee8"]]),nn=[{label:"仅导入数据",value:Se.data},{label:"导入数据，并联动业务（流程、智慧助手等）",value:Se.dataAndLink},{label:"使用组件服务进行导入",value:Se.components}],sn=M({__name:"ImportSettings",props:{modelValue:{}},emits:["update:modelValue"],setup(E,{emit:a}){const o=ke(E,"modelValue",a),r=J(),n=[{required:!0,message:"至少选择一种导入类型",trigger:"change"}],s=A({get(){return o.value.importWay??Se.data},set(_){o.value.importWay=_,o.value.maxLength=_===Se.dataAndLink?500:void 0,o.value.componentId=""}}),g=A(()=>{var _;return ga(((_=r.soureceInfo)==null?void 0:_.fields)??[])}),v=A(()=>Dl(g.value)),c=R(!1),f=R([]),w=()=>{c.value=!0,f.value=(o.value.importFieldIds??[]).filter(_=>!!Ne(_,g.value)),f.value.length||(b.value=!0)},b=A({get(){return v.value.length&&v.value.length===f.value.length},set(_){f.value=_?v.value.map(p=>p.fieldId):[]}}),h=A(()=>!b.value&&!!f.value.length),y=(_,p)=>{var T;const i=new Set(f.value),V=r.matchField(p);V&&(_?i.add(p):i.delete(p),V.field.type===P.subform?V.field.fields.forEach(k=>_?i.add(k.fieldId):i.delete(k.fieldId)):((T=V.parentField)==null?void 0:T.type)===P.subform&&(V.parentField.fields.some(B=>i.has(B.fieldId))?i.add(V.parentField.fieldId):i.delete(V.parentField.fieldId)),f.value=[...i])},u=()=>{o.value.importFieldIds=[...f.value],c.value=!1};return(_,p)=>{const i=oe,V=Re,T=de,k=re,B=Ol,D=X;return d(),C(q,null,[l(z,{label:"导入类型",prop:"importType",rules:n},{default:t(()=>[l(V,{modelValue:e(o).importType,"onUpdate:modelValue":p[0]||(p[0]=F=>e(o).importType=F)},{default:t(()=>[(d(!0),C(q,null,j(e(Va),(F,S)=>(d(),O(i,{key:S,label:F.value},{default:t(()=>[$(H(F.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(o).importType&&e(o).importType.includes(e(Ia).excel)?(d(),C(q,{key:0},[l(z,{label:"导入字段",prop:"importFieldIds"},{default:t(()=>{var F;return[l(Qe,{onClick:w,text:"设置",isSet:!!((F=e(o).importFieldIds)!=null&&F.length)},null,8,["isSet"])]}),_:1}),l(z,{label:"导入方式",alignItems:"flex-start"},{default:t(()=>[l(k,{modelValue:s.value,"onUpdate:modelValue":p[1]||(p[1]=F=>s.value=F)},{default:t(()=>[(d(!0),C(q,null,j(e(nn),(F,S)=>(d(),O(T,{key:S,label:F.value},{default:t(()=>[$(H(F.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),s.value===e(Se).dataAndLink?(d(),O(z,{key:0,label:"最大可导入数"},{default:t(()=>[l(yl,{modelValue:e(o).maxLength,"onUpdate:modelValue":p[2]||(p[2]=F=>e(o).maxLength=F),placeholder:"请输入",min:1,max:1e3,valueOnClear:500},null,8,["modelValue"])]),_:1})):U("",!0),s.value===e(Se).components?(d(),O(z,{key:1,label:"组件服务"},{default:t(()=>[l(Ft,{modelValue:e(o).componentId,"onUpdate:modelValue":p[3]||(p[3]=F=>e(o).componentId=F),scenario:e(vl).list_event_btn},null,8,["modelValue","scenario"])]),_:1})):U("",!0)],64)):U("",!0),l(je,{modelValue:c.value,"onUpdate:modelValue":p[6]||(p[6]=F=>c.value=F),width:"450px","append-to-body":"",title:"设置","destroy-on-close":"","close-on-click-modal":!1},{footer:t(()=>[x("span",{class:"dialog-footer"},[l(D,{onClick:p[5]||(p[5]=F=>c.value=!1)},{default:t(()=>[$("取消")]),_:1}),l(D,{type:"primary",disabled:!f.value.length,onClick:u},{default:t(()=>[$(" 确定 ")]),_:1},8,["disabled"])])]),default:t(()=>[l(wa,{data:g.value,border:"",style:{width:"100%"},"tree-props":{children:"fields"},class:"import_field","row-key":"fieldId","max-height":"50vh","default-expand-all":""},{default:t(()=>[l(B,{prop:"date",label:"选择需导入内容的字段","class-name":"import_field-label-column"},{default:t(({row:F})=>{var S;return[x("div",{class:_e(["import_field-label",{"az-required":F.options.required}])},[l(Ta,{"field-id":F.fieldId,fields:(S=e(r).soureceInfo)==null?void 0:S.fields},null,8,["field-id","fields"])],2)]}),_:1}),l(B,{width:"50"},{header:t(()=>[l(i,{modelValue:b.value,"onUpdate:modelValue":p[4]||(p[4]=F=>b.value=F),class:"subform_field-checkbox",label:"",indeterminate:h.value},null,8,["modelValue","indeterminate"])]),default:t(({row:F})=>[l(i,{class:"subform_field-checkbox","model-value":f.value.includes(F.fieldId),"onUpdate:modelValue":S=>y(!!S,F.fieldId),label:""},null,8,["model-value","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const dn=K(sn,[["__scopeId","data-v-2ad07e28"]]),rn=M({__name:"AddOrEditButton",props:{modelValue:{type:Boolean},addType:{},editBtn:{}},emits:["update:modelValue"],setup(E,{emit:a}){const m=E,o=Te(m,"modelValue",a),r=A(()=>!!m.editBtn),n=A(()=>r.value?"修改按钮":"添加按钮"),s=A(()=>m.editBtn?m.editBtn.position:m.addType),g=A(()=>{var _;return((_=bl.find(p=>p.systemType===b.value.systemType))==null?void 0:_.name)??""}),v=J(),c=A(()=>{var p;const _=((p=v.soureceInfo)==null?void 0:p.entryIds.map(i=>i.entryId))??[];return _.length<2?_[0]:_}),f=A(()=>({btnId:"",name:"",position:s.value,type:Ie.custom,theme:"primary",systemType:""})),w=R(),b=R(N(f.value)),h=Ee({name:[{required:!0,message:"请输入按钮文案",trigger:"blur"}]});we(o,()=>{o.value&&(b.value=N(m.editBtn?m.editBtn:{...f.value,position:s.value,type:Ie.custom,name:"自定义按钮"}),setTimeout(()=>{var _,p;b.value.btnId?(_=w.value)==null||_.validate():(p=w.value)==null||p.clearValidate()},40))});const y=A({get(){return ka(b.value)},set(_){b.value.btnConfig={..._},b.value.name=_.name??"",b.value.themeColor=_.color??""}}),u=async()=>{var V;await((V=w.value)==null?void 0:V.validate());const _=b.value.position===ee.event?v.selectedTableView.operate.eventBtns:v.selectedTableView.operate.operateBtns;let p=_.findIndex(T=>T.btnId===b.value.btnId);p<0&&(p=_.length);const i=N(b.value);if(!i.btnId){const T=`_button_${Ce(_.map(k=>k.btnId))}`;i.btnId=T,i.systemType=T}_.splice(p,1,i),Pe.success(`${n.value}成功`)};return(_,p)=>{const i=se,V=ue;return d(),O(el,{modelValue:e(o),"onUpdate:modelValue":p[6]||(p[6]=T=>ne(o)?o.value=T:null),width:"600",title:n.value,"append-to-body":"","destroy-on-close":""},{footer:t(()=>[l(xl,{editMode:"",onClose:p[5]||(p[5]=T=>o.value=!1),"on-submit":u})]),default:t(()=>[l(V,{ref_key:"ruleFormRef",ref:w,model:b.value,rules:h,"label-position":"right","label-width":"120",class:"label-blod","label-suffix":":"},{default:t(()=>{var T;return[l(i,{label:"按钮类型",prop:"type"},{default:t(()=>{var k;return[x("span",{class:"bold"},H(((k=e(ha).find(B=>B.value===b.value.type))==null?void 0:k.label)??""),1)]}),_:1}),b.value.type===e(Ie).system?(d(),O(i,{key:0,label:"按钮功能"},{default:t(()=>[x("span",{class:"bold"},H(g.value),1)]),_:1})):U("",!0),x("div",{class:"button-style"},[l(i,{label:"按钮设置"},{default:t(()=>[l(Fa,{modelValue:y.value,"onUpdate:modelValue":p[0]||(p[0]=k=>y.value=k)},null,8,["modelValue"])]),_:1})]),b.value.position===e(ee).operate?(d(),C(q,{key:1},[l(z,{label:"显示条件",prop:"displayCondition"},{default:t(()=>[l(tl,{condition:b.value.displayCondition,"onUpdate:condition":p[1]||(p[1]=k=>b.value.displayCondition=k),validate:"",btnText:"设置显示条件",conditionForm:c.value,appId:e(v).appId},null,8,["condition","conditionForm","appId"])]),_:1}),(T=b.value.displayCondition)!=null&&T.length?(d(),O(i,{key:0,label:""},{default:t(()=>[l(Bl,{class:"w100",condition:b.value.displayCondition,"app-id":e(v).appId,isConditionForm:Array.isArray(c.value)},null,8,["condition","app-id","isConditionForm"])]),_:1})):U("",!0)],64)):U("",!0),b.value.systemType===e(Jl).export?(d(),O(on,{key:2,modelValue:b.value,"onUpdate:modelValue":p[2]||(p[2]=k=>b.value=k)},null,8,["modelValue"])):U("",!0),b.value.systemType===e(Jl).import?(d(),O(dn,{key:3,modelValue:b.value,"onUpdate:modelValue":p[3]||(p[3]=k=>b.value=k)},null,8,["modelValue"])):U("",!0),b.value.type===e(Ie).custom?(d(),O(tn,{key:4,modelValue:b.value,"onUpdate:modelValue":p[4]||(p[4]=k=>b.value=k),visible:e(o)},null,8,["modelValue","visible"])):U("",!0)]}),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});const un=K(rn,[["__scopeId","data-v-dcdf8735"]]),pn=M({__name:"OperateSettings",setup(E){const a=J(),m=R(!1),I=R("0"),o=R(),r=async u=>{if(u.type!==Ie.system)return o.value=u,m.value=!0,I.value="0",!1},n=()=>{var p;const u=((p=o.value)==null?void 0:p.position)===ee.event?a.selectedTableView.operate.eventBtns:a.selectedTableView.operate.operateBtns,_=u.findIndex(i=>{var V;return i.btnId===((V=o.value)==null?void 0:V.btnId)});u.splice(_,1),m.value=!1,I.value==="0"&&o.value&&!a.selectedTableView.operate.createCustomBtns.some(i=>{var V;return i.systemType===((V=o.value)==null?void 0:V.systemType)})&&a.selectedTableView.operate.createCustomBtns.push(N(o.value))},s=A(()=>{var p;const u=(p=a.soureceInfo)==null?void 0:p.sourceAuth;if(u==null)return[];const _=new Set(a.selectedTableView.operate.eventBtns.map(i=>i.systemType));return[...bl.filter(i=>(!(i!=null&&i.allow)||i.allow.includes(u))&&(i.multiple||!_.has(i.systemType))).map(i=>({..._l(i,["defaultBtn","allow","multiple"])})),...a.selectedTableView.operate.createCustomBtns??[]].filter(i=>i.position===ee.event)}),g=u=>{const _=N(u);if(u.type===Ie.system){let p=`${u.btnId}_${Ce()}`;const i=a.selectedTableView.operate.operateBtns.map(V=>V.btnId);for(;i.includes(p);)p=`${u.btnId}_${Ce()}`;_.btnId=p}a.selectedTableView.operate.eventBtns.push(u)},v=A(()=>{var p;const u=(p=a.soureceInfo)==null?void 0:p.sourceAuth;if(u==null)return[];const _=new Set(a.selectedTableView.operate.operateBtns.map(i=>i.systemType));return[...bl.filter(i=>(!(i!=null&&i.allow)||i.allow.includes(u))&&(i.multiple||!_.has(i.systemType))).map(i=>({..._l(i,["defaultBtn","allow","multiple"])})),...a.selectedTableView.operate.createCustomBtns??[]].filter(i=>i.position===ee.operate)}),c=u=>{const _=N(u);if(u.type===Ie.system){let p=`${u.btnId}_${Ce()}`;const i=a.selectedTableView.operate.operateBtns.map(V=>V.btnId);for(;i.includes(p);)p=`${u.btnId}_${Ce()}`;_.btnId=p}a.selectedTableView.operate.operateBtns.push(_)},f=R(ee.event),w=R(null),b=R(!1),h=u=>{f.value=u,w.value=null,b.value=!0},y=u=>{w.value=N(u),b.value=!0};return El(()=>{Sl(a.selectedTableView.operate.createCustomBtns,u=>[...a.selectedTableView.operate.eventBtns,...a.selectedTableView.operate.operateBtns].some(_=>_.systemType===u.systemType))}),(u,_)=>{const p=Xe,i=be,V=de,T=re,k=X,B=xe;return d(),C("div",null,[l(p,{title:"对当前视图下的数据设置操作按钮，实现数据的变更处理。",type:"success",closable:!1}),e(a).selectedTableView.basis.style!==e(Y).addOrView?(d(),O(le,{key:0,label:"事件按钮",class:"mt-10"},{default:t(()=>[l(Vl,{text:"添加事件按钮",options:s.value,prop:{label:"name",value:"btnId"},multiple:!1,onClickItem:g,"empty-data-text":"没有可选择的按钮","is-add":"","add-text":"创建新按钮",onAdd:_[0]||(_[0]=D=>h(e(ee).event))},null,8,["options"]),l(gl,{class:"mt-10",modelValue:e(a).selectedTableView.operate.eventBtns,"onUpdate:modelValue":_[1]||(_[1]=D=>e(a).selectedTableView.operate.eventBtns=D),deleteCallback:r,itemKey:"btnId"},{default:t(({element:D})=>[x("div",{style:{flex:"1"}},[l(Ql,{style:{"max-width":"290px"},btn:D},null,8,["btn"])]),l(i,{underline:!1,title:"设置",icon:e(Zl),class:"editor-draggable-icon",onClick:F=>y(D)},null,8,["icon","onClick"])]),_:1},8,["modelValue"])]),_:1})):U("",!0),l(le,{label:"操作按钮",class:"mt-10",id:`${e(pe).operate}.operateBtns`},{default:t(()=>[l(Vl,{text:"添加操作按钮",options:v.value,prop:{label:"name",value:"btnId"},multiple:!1,onClickItem:c,"empty-data-text":"没有可选择的按钮","is-add":"","add-text":"创建新按钮",onAdd:_[2]||(_[2]=D=>h(e(ee).operate))},null,8,["options"]),l(gl,{class:"mt-10",modelValue:e(a).selectedTableView.operate.operateBtns,"onUpdate:modelValue":_[3]||(_[3]=D=>e(a).selectedTableView.operate.operateBtns=D),deleteCallback:r,itemKey:"btnId"},{default:t(({element:D})=>[x("div",{style:{flex:"1",position:"relative"}},[l(Ql,{style:{"max-width":"290px"},btn:D},null,8,["btn"])]),l(i,{underline:!1,title:"设置",icon:e(Zl),class:"editor-draggable-icon",onClick:F=>y(D)},null,8,["icon","onClick"])]),_:1},8,["modelValue"])]),_:1},8,["id"]),l(B,{modelValue:m.value,"onUpdate:modelValue":_[6]||(_[6]=D=>m.value=D),title:"删除按钮",width:"400","close-on-click-modal":!1},{footer:t(()=>[x("span",{class:"dialog-footer"},[l(k,{onClick:_[5]||(_[5]=D=>m.value=!1)},{default:t(()=>[$("取消")]),_:1}),l(k,{type:"primary",onClick:n},{default:t(()=>[$(" 确定 ")]),_:1})])]),default:t(()=>[l(T,{modelValue:I.value,"onUpdate:modelValue":_[4]||(_[4]=D=>I.value=D)},{default:t(()=>[l(V,{label:"0"},{default:t(()=>[$(" 仅从当前视图中删除，可再加入视图 ")]),_:1},8,["label"]),l(V,{label:"1"},{default:t(()=>[$("彻底删除按钮，不可恢复")]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(un,{modelValue:b.value,"onUpdate:modelValue":_[7]||(_[7]=D=>b.value=D),addType:f.value,editBtn:w.value},null,8,["modelValue","addType","editBtn"])])}}}),cn=M({__name:"MobileBasic",setup(E){const a=J(),m=A(()=>a.selectedTableView.basis.mobileOptions),I=()=>m.value.style?fe.custom:fe.same,o=A({get(){return I()},set(v){const c=I();v!==c&&(v===fe.same?(m.value.style=void 0,m.value.settings=void 0):(m.value.style=r.value.map(f=>f.value).includes(a.selectedTableView.basis.style)?a.selectedTableView.basis.style:Y.brief,m.value.settings=a.selectedTableView.basis.settings.filter(f=>s.value.some(w=>w.value===f))))}}),r=A(()=>[...ot].filter(v=>[Y.brief,Y.card].includes(v.value))),n=A({get(){return a.selectedTableView.basis.mobileOptions.style},set(v){a.selectedTableView.basis.mobileOptions.style=v}}),s=A(()=>[...at].filter(v=>![ml.discoloration].includes(v.value))),g=A({get(){return a.selectedTableView.basis.mobileOptions.settings??[]},set(v){a.selectedTableView.basis.mobileOptions.settings=[...v]}});return(v,c)=>{const f=Oe,w=De,b=de,h=re,y=oe,u=Re;return d(),C("div",null,[l(w,{class:"display_setting-select mb-15",modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=_=>o.value=_),placeholder:"请选择"},{default:t(()=>[(d(!0),C(q,null,j(e(bt),(_,p)=>(d(),O(f,{key:p,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o.value===e(fe).custom?(d(),C(q,{key:0},[l(le,{label:"列表样式"},{default:t(()=>[l(h,{modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=_=>n.value=_)},{default:t(()=>[(d(!0),C(q,null,j(r.value,_=>(d(),O(b,{class:"style-set",label:_.value,key:_.value},{default:t(()=>[$(H(_.label)+" ",1),x("img",{class:"style-set-img",src:_.img,alt:""},null,8,["src"])]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(le,{label:"列表设置"},{default:t(()=>[l(u,{modelValue:g.value,"onUpdate:modelValue":c[2]||(c[2]=_=>g.value=_)},{default:t(()=>[(d(!0),C(q,null,j(s.value,_=>(d(),O(y,{label:_.value,key:_.value},{default:t(()=>[x("img",{src:"",alt:""}),$(" "+H(_.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})],64)):U("",!0)])}}});const mn=K(cn,[["__scopeId","data-v-828434da"]]),fn=M({__name:"MobileDisplay",setup(E){const a=J(),m=()=>a.selectedTableView.basis.mobileOptions.display?fe.custom:fe.same,I=A({get(){return m()},set(c){const f=m();c!==f&&(a.selectedTableView.basis.mobileOptions.display=c===fe.same?void 0:N(a.selectedTableView.display.filter(w=>{var b;return!((b=w.child)!=null&&b.length)})),a.selectedTableView.basis.mobileOptions.cardShowTitle=c===fe.same?void 0:a.selectedTableView.basis.cardShowTitle)}}),o=A(()=>a.selectedTableView.basis.style===Y.card),r=A({get(){return a.selectedTableView.basis.mobileOptions.cardShowTitle},set(c){a.selectedTableView.basis.mobileOptions.cardShowTitle=c}}),n=R(),s=()=>{var c;(c=n.value)==null||c.switchAll(!0)},g=()=>{var c;(c=n.value)==null||c.switchAll(!1)},v=A({get(){return a.selectedTableView.basis.mobileOptions.display??[]},set(c){a.selectedTableView.basis.mobileOptions.display=N(c)}});return(c,f)=>{const w=Oe,b=De,h=oe,y=be;return d(),C("div",null,[l(b,{class:"display_setting-select",modelValue:I.value,"onUpdate:modelValue":f[0]||(f[0]=u=>I.value=u),placeholder:"请选择"},{default:t(()=>[(d(!0),C(q,null,j(e(bt),(u,_)=>(d(),O(w,{key:_,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),I.value===e(fe).custom?(d(),C("div",{key:0,class:"w100 mt-10"},[x("div",{class:"display_setting-other"},[o.value?(d(),O(h,{key:0,modelValue:r.value,"onUpdate:modelValue":f[1]||(f[1]=u=>r.value=u),class:"mr-10",style:{height:"initial"}},{default:t(()=>[$(" 显示字段标题 ")]),_:1},8,["modelValue"])):U("",!0),x("div",{style:{"margin-left":"auto"}},[l(y,{underline:!1,type:"primary",class:"mr-10",onClick:s},{default:t(()=>[$(" 显示全部 ")]),_:1}),l(y,{underline:!1,type:"primary",onClick:g},{default:t(()=>[$(" 隐藏全部 ")]),_:1})])]),l(ht,{modelValue:v.value,"onUpdate:modelValue":f[2]||(f[2]=u=>v.value=u),isSubform:!1,sourceId:e(a).sourceId,ref_key:"cloumnSetFieldRef",ref:n},null,8,["modelValue","sourceId"])])):U("",!0)])}}});const vn=K(fn,[["__scopeId","data-v-a577fc26"]]),_n=M({__name:"MobileSettings",setup(E){const a=R("0"),m=[{label:"基础设置",value:"0"},{label:"显示设置",value:"1"}];return(I,o)=>{const r=Xl,n=et;return d(),C("div",{class:"mobile_settings"},[l(n,{modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=s=>a.value=s),class:"mobile_settings-tabs"},{default:t(()=>[(d(),C(q,null,j(m,s=>l(r,{key:s.value,label:s.label,name:s.value},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),x("div",{class:"mobile_settings-content"},[a.value==="0"?(d(),O(mn,{key:0})):U("",!0),a.value==="1"?(d(),O(vn,{key:1})):U("",!0)])])}}});const bn=K(_n,[["__scopeId","data-v-d4f2dd85"]]),yn=M({__name:"OtherSettings",setup(E){const a=J();return(m,I)=>{const o=oe;return d(),O(le,{label:"其他设置"},{default:t(()=>[x("div",{class:"w100"},[l(o,{modelValue:e(a).selectedTableView.basis.isReadStatus,"onUpdate:modelValue":I[0]||(I[0]=r=>e(a).selectedTableView.basis.isReadStatus=r),label:"显示未读标识"},null,8,["modelValue"])]),x("div",{class:"w100"},[l(o,{modelValue:e(a).selectedTableView.basis.isReadDetail,"onUpdate:modelValue":I[1]||(I[1]=r=>e(a).selectedTableView.basis.isReadDetail=r),label:"显示阅读状态"},null,8,["modelValue"])])]),_:1})}}}),gn=M({__name:"DesignerSettings",setup(E){const a=J(),m=A(()=>{const g=a.selectedTableView;return a.soureceInfo&&[We.currentAppForm,We.form].includes(a.soureceInfo.source)&&[Y.slave].includes(g.basis.style)});we(m,g=>{!g&&a.selectedTableView.basis.isReadStatus&&(a.selectedTableView.basis.isReadStatus=!1),!g&&a.selectedTableView.basis.isReadDetail&&(a.selectedTableView.basis.isReadDetail=!1)});const I=A(()=>{let g=rl;return a.soureceInfo?(m.value||(g=rl.filter(v=>v.value!==pe.other)),a.selectedTableView.basis.style===Y.addOrView&&(g=rl.filter(v=>[pe.basis,pe.dataFilter,pe.operate].includes(v.value))),g):g.filter(v=>v.value===pe.basis)}),{activeTab:o}=It(A(()=>I.value.map(g=>g.value)),{noQuery:!0}),r=R(new Set);we(o,()=>{r.value.add(o.value)},{immediate:!0});const n=ll(),s=A(()=>Object.values(pe).filter(g=>n.checkError(`${a.id}.${g}`)));return(g,v)=>{const c=ue;return d(),C("div",{class:"designer_set"},[x("div",{class:"set-header"},[x("span",{class:"header-name"},[$(" 视图配置 "),x("span",{class:"header-tip"},"修改后，需要保存才能更新预览")])]),x("div",{class:"set-body"},[x("div",{class:"set-tabs"},[(d(!0),C(q,null,j(I.value,(f,w)=>(d(),C("div",{class:_e(["set-tab",{"tab-active":e(o)===f.value,"is-tab-error":s.value.includes(f.value)}]),key:w,onClick:b=>o.value=f.value},[x("span",null,H(f.label),1)],10,["onClick"]))),128))]),x("div",{class:"set-content"},[l(c,{"label-position":"top"},{default:t(()=>[r.value.has("0")?te((d(),C("div",{key:0},[l(Oo)],512)),[[ae,e(o)==="0"]]):U("",!0),r.value.has("1")?te((d(),C("div",{key:1},[l(xo)],512)),[[ae,e(o)==="1"]]):U("",!0),r.value.has("2")?te((d(),C("div",{key:2},[l(Eo)],512)),[[ae,e(o)==="2"]]):U("",!0),r.value.has("3")?te((d(),C("div",{key:3},[l(qo)],512)),[[ae,e(o)==="3"]]):U("",!0),r.value.has("4")?te((d(),C("div",{key:4},[l(Lo)],512)),[[ae,e(o)==="4"]]):U("",!0),r.value.has("5")?te((d(),C("div",{key:5},[l(pn)],512)),[[ae,e(o)==="5"]]):U("",!0),r.value.has("6")?te((d(),C("div",{key:6},[l(yn)],512)),[[ae,e(o)==="6"]]):U("",!0),r.value.has("7")?te((d(),C("div",{key:7},[l(bn)],512)),[[ae,e(o)==="7"]]):U("",!0)]),_:1})])])])}}});const Vn=K(gn,[["__scopeId","data-v-69460250"]]);function In(E){const a=it(),{getSoureceInfo:m}=yt(),I=Ee({id:`table_${Ce()}`,appId:"",entryId:"",list:[a],selectedTableView:a,selectedTableViewId:a.table_id,setSelectedTableView(o){const r=this.matchTableView(o);r&&(this.selectedTableView=r,this.selectedTableViewId=r.table_id)},matchTableView(o){return Ca(o,this.list)},sourceId:"",soureceInfo:null,fields:[],fieldsMap:new Map,matchField(o){return o?this.fieldsMap.get(o)??null:null}});return El(()=>{var o;I.soureceInfo=I.sourceId?m(I.sourceId)??null:null,I.appId=E.appId,I.entryId=E.entryId,I.fields=((o=I.soureceInfo)==null?void 0:o.fields)??[],I.fieldsMap=new Map(Dl(I.fields).map(r=>[r.fieldId,Ne(r.fieldId,I.fields)]))}),we([()=>[...E.listViews]],()=>{var o,r;I.sourceId=((r=(o=E.listViews[0])==null?void 0:o.basis)==null?void 0:r.sourceId)??"",I.list=N(E.listViews),I.setSelectedTableView(I.list[0].table_id)},{immediate:!0}),I}const Ue=ll();function wn(E){const a=A(()=>E.id),{checkField:m}=rt();Sa(()=>{Ue.removeError(a.value)}),El(()=>{var I,o,r,n,s;Ue.removeError(a.value);for(const g of E.list){let v=pe.basis;if(E.soureceInfo||Ue.addError(`${a.value}.${v}.sourceId`,{label:"基础设置",name:"数据集",msg:"数据集不可使用，请重新选择数据集"}),g.basis.style===Y.tree&&!(((I=E.soureceInfo)==null?void 0:I.forms.length)===1&&Dl(E.fields).some(c=>c.type===P.parent))&&Ue.addError(`${a.value}.${v}.style`,{label:"基础设置",name:"列表样式",msg:"该数据集不支持树形列表，请重新选择"}),g.basis.style===Y.gantt){let c;g.basis.ganteOptions?[(o=g.basis.ganteOptions.startDateField)==null?void 0:o.fieldId,(r=g.basis.ganteOptions.endDateField)==null?void 0:r.fieldId,g.basis.ganteOptions.colorFieldId,g.basis.ganteOptions.groupFieldId].filter(f=>!!f).some(f=>m(f,{fields:E.fields})===!1)&&(c={label:"基础设置",name:"甘特图设置",msg:"配置异常"}):c={label:"基础设置",name:"甘特图设置",msg:"不能为空"},c&&Ue.addError(`${a.value}.${v}.gantt`,c)}v=pe.operate;for(const c of[...g.operate.eventBtns,...g.operate.operateBtns])c.type===Ie.custom&&((n=c.editSelfFormData)!=null&&n.entryId)&&!((s=E.soureceInfo)!=null&&s.forms.some(f=>{var w;return f.entryId===((w=c.editSelfFormData)==null?void 0:w.entryId)}))&&Ue.addError(`${a.value}.${v}.${c.position===ee.event?"eventBtns":"operateBtns"}`,{label:"操作设置",msg:`按钮“${c.name}”配置异常`})}})}const Tn=M({__name:"APP",props:{listViews:{},entryId:{},appId:{}},setup(E,{expose:a}){const m=E,{key:I,reload:o}=Oa(),r=In(Ee({...Da(m)}));xa(Ea,r),Ke();const n=ll();wn(r);const s=R(N(r.selectedTableView));a({getViews(){return N(r.list)},getSoureceId(){return r.sourceId},validate(){const v=n.extractError(r.id);if(v.length)return Aa({title:"error",dangerouslyUseHTMLString:!0,message:v.map(c=>`${c.label?"「"+c.label+"」：":""}${c.name??""}${c.msg}`).join("<br />"),type:"error"}),Promise.reject("validate error")},updatePreview(){o(),s.value=N(r.selectedTableView)}});const g={resizable:!0,onHeaderDragend(v,c,f){const w=f==null?void 0:f.property,b=r.selectedTableView.display.reduce((h,y)=>[...h,y,...y.child??[]],[]).find(h=>h.fieldId===w);b&&(b.width=v-24)}};return(v,c)=>{const f=Je;return d(),C("div",{class:"table_designer"},[x("div",{class:"table_designer-render"},[(d(),O(f,{class:"table_designer-tablerender",key:e(I)},{default:t(()=>[l(no,{view:s.value,active:"",options:{appId:v.appId,entryId:v.entryId,preview:!0,tableProps:g}},null,8,["view","options"])]),_:1}))]),x("div",{class:"table_designer-settings"},[x("div",{class:"table_designer-content"},[l(Vn)]),x("div",{class:"table_designer-btn"},[Me(v.$slots,"btns",{},void 0,!0)])])])}}});const kn=K(Tn,[["__scopeId","data-v-1b8dd07d"]]),hn=M({__name:"ListDesigner",props:{tableView:{},entryDetails:{},entryId:{},appId:{}},emits:["update:tableView"],setup(E,{expose:a,emit:m}){const I=E,o=m,r=A(()=>I.tableView),n=R(!1),s=R(),g=async()=>{var v,c,f,w,b,h;n.value=!0;try{await((v=s.value)==null?void 0:v.validate());const y=((c=s.value)==null?void 0:c.getSoureceId())??"",u=(w=(f=s.value)==null?void 0:f.getViews())==null?void 0:w[0];if(!u){Pe.error("数据异常!");return}await $a({appId:I.appId,entryId:I.entryId,sheetName:((b=I.entryDetails.appEntryVO)==null?void 0:b.name)??"",sourceId:y,view:u}),o("update:tableView",N(u)),(h=s.value)==null||h.updatePreview()}finally{n.value=!1}};return a({beforeLeave(){var c;const v=(c=s.value)==null?void 0:c.getViews();if(!Ua(r.value,v==null?void 0:v[0]))return new Promise((f,w)=>{Tl.confirm("您修改了列表设计但没有保存，是否需要保存列表设计并继续？","列表设计有修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(b,h,y){b==="confirm"?(h.confirmButtonLoading=!0,g().then(()=>{y(),f()}).finally(()=>{h.confirmButtonLoading=!1})):b==="cancel"?(y(),f()):b==="close"&&(y(),w())}})})}}),(v,c)=>{const f=X;return d(),O(e(kn),He({ref_key:"tableDesignerRef",ref:s},v.$attrs,{listViews:e(nt)(v.tableView),entryId:v.entryId,appId:v.appId}),{btns:t(()=>[l(f,{type:"primary",onClick:g,loading:n.value,size:"large",style:{width:"20%"}},{default:t(()=>[$(" 保存 ")]),_:1},8,["loading"])]),_:1},16,["listViews","entryId","appId"])}}}),Fn=M({__name:"AuthContent",props:{auth:{},appId:{},tableView:{},soureceInfo:{}},emits:["refresh"],setup(E,{emit:a}){const m=E,I=a,o=R(!1),r={operAuth:[],columnAuth:[],appId:m.appId},n=R({...r}),s=async()=>{await gt({...m.auth,authRuleVos:[n.value]}),Pe.success("设置成功！"),I("refresh")},g=async()=>{var i;const p=(i=m.auth.authRuleVos)==null?void 0:i.find(V=>{var T;return V.viewId===((T=m.tableView)==null?void 0:T.id)});p&&(n.value=Ra(p)),_(),c()},v=A(()=>{var i,V;const p=m.tableView;return[...((i=p==null?void 0:p.operate)==null?void 0:i.eventBtns)??[],...((V=p==null?void 0:p.operate)==null?void 0:V.operateBtns)??[]]}),c=()=>{n.value.operAuth=v.value.map(p=>{var V;return((V=n.value.operAuth)==null?void 0:V.find(T=>T.btnId===p.btnId))??{btnId:p.btnId,checked:!0,name:p.name,position:p.position,type:p.type}})},f=A({get(){var p;return!!((p=n.value.operAuth)!=null&&p.every(i=>i.checked))},set(p){var i;(i=n.value.operAuth)==null||i.forEach(V=>V.checked=p)}}),w=A(()=>{var p;return!!((p=n.value.operAuth)!=null&&p.length&&!f.value&&n.value.operAuth.some(i=>i.checked))}),b=A({get(){var p,i;return((i=(p=n.value.operAuth)==null?void 0:p.filter(V=>V.checked))==null?void 0:i.map(V=>V.btnId))??[]},set(p){var i;(i=n.value.operAuth)==null||i.forEach(V=>{V.checked=p.includes(V.btnId)})}}),h=A(()=>{var i;const p=((i=m.soureceInfo)==null?void 0:i.forms.map(V=>V.entryId))??[];return p.length<2?p[0]:p}),y=R(!1),u=A(()=>{var p;return Ba(((p=m.soureceInfo)==null?void 0:p.fields)??[])}),_=()=>{(function p(i){var V;for(const T of i)(V=n.value.columnAuth)!=null&&V.some(k=>k.fieldId===T.fieldId)||(n.value.columnAuth||(n.value.columnAuth=[]),n.value.columnAuth.push({entryId:T.fieldId.split(".").shift()??"",fieldId:T.fieldId,readable:!0,writeable:!1,required:!1})),"fields"in T&&p(T.fields)})(u.value),Sl(n.value.columnAuth,p=>{var i;return!Ne(p.fieldId,((i=m.soureceInfo)==null?void 0:i.fields)??[])})};return(p,i)=>{const V=X,T=oe,k=Re,B=se,D=ue,F=xe;return d(),C(q,null,[l(V,{onClick:i[0]||(i[0]=S=>o.value=!0),plain:""},{default:t(()=>[$("设置")]),_:1}),l(el,{modelValue:e(o),"onUpdate:modelValue":i[6]||(i[6]=S=>ne(o)?o.value=S:null),title:"设置权限","show-load":g,"append-to-body":""},{default:t(()=>[l(D,{ref:"ruleFormRef",model:e(n),"label-width":"80px"},{default:t(()=>[l(B,{label:"操作权限"},{default:t(()=>[l(T,{modelValue:e(f),"onUpdate:modelValue":i[1]||(i[1]=S=>ne(f)?f.value=S:null),class:"w100",indeterminate:e(w)},{default:t(()=>[$(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),l(k,{modelValue:e(b),"onUpdate:modelValue":i[2]||(i[2]=S=>ne(b)?b.value=S:null)},{default:t(()=>[(d(!0),C(q,null,j(e(v),S=>(d(),O(T,{key:S.btnId,label:S.btnId},{default:t(()=>[$(H(S.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(B,{label:"字段权限"},{default:t(()=>[l(V,{type:"primary",onClick:i[3]||(i[3]=S=>y.value=!0)},{default:t(()=>[$(" 点击设置 ")]),_:1})]),_:1}),l(B,{label:"数据筛选"},{default:t(()=>[l(tl,{condition:e(n).dataAuth,"onUpdate:condition":i[4]||(i[4]=S=>e(n).dataAuth=S),btnText:"设置数据筛选条件",conditionForm:e(h),appId:p.appId},{default:t(()=>{var S;return[(S=e(n).dataAuth)!=null&&S.length?(d(),O(Bl,{key:0,class:"w100",condition:e(n).dataAuth,"app-id":p.appId,isConditionForm:Array.isArray(e(h))},null,8,["condition","app-id","isConditionForm"])):(d(),C("div",{key:1,class:"condition-empty"},"点击此区域筛选数据"))]}),_:1},8,["condition","conditionForm","appId"])]),_:1})]),_:1},8,["model"]),l(xl,{editMode:!0,onClose:i[5]||(i[5]=S=>o.value=!1),"on-submit":s})]),_:1},8,["modelValue"]),l(F,{modelValue:e(y),"onUpdate:modelValue":i[9]||(i[9]=S=>ne(y)?y.value=S:null),title:"字段权限",width:"600"},{footer:t(()=>[l(V,{type:"primary",onClick:i[8]||(i[8]=S=>y.value=!1)},{default:t(()=>[$(" 确定 ")]),_:1})]),default:t(()=>[l(Ct,{modelValue:e(n).columnAuth,"onUpdate:modelValue":i[7]||(i[7]=S=>e(n).columnAuth=S),fields:e(u),isDownload:"",auth:{isTemplate:!0}},{fieldLabel:t(({field:S})=>{var L;return[S.fieldId?(d(),O(ve,{key:0,fieldId:S.fieldId,sourceId:(L=p.soureceInfo)==null?void 0:L.sourceId},null,8,["fieldId","sourceId"])):U("",!0)]}),_:1},8,["modelValue","fields"])]),_:1},8,["modelValue"])],64)}}}),Cn=M({__name:"AuthCard",props:{auth:{},appId:{},tableView:{},soureceInfo:{}},emits:["refresh"],setup(E,{emit:a}){const m=E,I=a,o=A(()=>{var s;return((s=m.auth.memberSelect)==null?void 0:s.selectedList.map(g=>g.id==="-1"?g.type===ce.corpCooperation?{id:me.allCooperateEnterprise,type:ce.dynamic}:g.type===ce.userCooperation?{id:me.allCooperatePersonnel,type:ce.dynamic}:g:g))??[]}),r=A(()=>{var s;return(s=m.auth.authRuleVos)==null?void 0:s.find(g=>g.viewId===m.tableView.id)});A({get(){var s;return(s=r.value)==null?void 0:s.ruleStatus},set(s){var v;const g=(v=m.auth.authRuleVos)==null?void 0:v.find(c=>c.viewId===m.tableView.id);g&&(g.ruleStatus=s)}});const n=async()=>{var s;await qa(((s=r.value)==null?void 0:s.id)??""),Pe.success("取消关联成功"),I("refresh")};return(s,g)=>{const v=be,c=se,f=Je;return d(),O(f,{class:"auth_card"},{header:t(()=>[x("div",{class:"card-header"},[l(fl,null,{default:t(()=>[x("b",null,H(s.auth.name),1)]),_:1}),x("div",null,[l(Pa,{title:"确定取消关联？",confirm:n},{reference:t(()=>[l(v,{class:"ml-10",underline:!1,type:"primary"},{default:t(()=>[$(" 取消关联 ")]),_:1})]),_:1})])])]),default:t(()=>[l(c,{label:"权限成员"},{default:t(()=>[l(Vt,{modelValue:e(o),"onUpdate:modelValue":g[0]||(g[0]=w=>ne(o)?o.value=w:null),dynamic:[e(me).allCooperateEnterprise,e(me).allCooperatePersonnel],readonly:"",isCooperation:"",class:"auth_selectpane",multiple:"",placeholder:"请选择权限成员",customStrictly:""},null,8,["modelValue","dynamic"])]),_:1}),l(c,{label:"权限内容",class:"mb-0"},{default:t(()=>[l(Fn,{auth:s.auth,appId:s.appId,tableView:s.tableView,soureceInfo:s.soureceInfo,onRefresh:g[1]||(g[1]=w=>I("refresh"))},null,8,["auth","appId","tableView","soureceInfo"])]),_:1})]),_:1})}}});const Sn=K(Cn,[["__scopeId","data-v-667f2b43"]]),On=M({__name:"AddAuth",props:{modelValue:{type:Boolean},authIds:{},entryDetails:{},tableView:{}},emits:["update:modelValue","refresh"],setup(E,{emit:a}){var h,y,u,_,p;const m=E,I=a,o=Te(m,"modelValue",I),r={name:"",description:"",memberSelect:{selectedList:[]},authRuleVos:[{type:(y=(h=m.entryDetails)==null?void 0:h.appEntryVO)==null?void 0:y.type,appId:((u=m.entryDetails.appEntryVO)==null?void 0:u.appId)??"",entryId:((_=m.entryDetails.appEntryVO)==null?void 0:_.id)??"",viewId:((p=m.tableView)==null?void 0:p.id)??"",columnAuth:[]}]},n=R({...r}),s=La([]),g=async()=>{const i=await Ma();s.value=i},v=R(),c=async()=>{var i;await((i=v.value)==null?void 0:i.validate()),await gt(n.value),Pe.success("新增成功！"),I("refresh")},f=A({get(){var i,V;return((V=(i=n.value)==null?void 0:i.memberSelect)==null?void 0:V.selectedList.map(T=>T.id==="-1"?T.type===ce.corpCooperation?{id:me.allCooperateEnterprise,type:ce.dynamic}:T.type===ce.userCooperation?{id:me.allCooperatePersonnel,type:ce.dynamic}:T:T))??[]},set(i){n.value.memberSelect&&(i!=null&&i.length?n.value.memberSelect.selectedList=i.map(V=>(V==null?void 0:V.id)===me.allCooperateEnterprise?{id:"-1",type:ce.corpCooperation}:(V==null?void 0:V.id)===me.allCooperatePersonnel?{id:"-1",type:ce.userCooperation}:V)??[]:n.value.memberSelect.selectedList=[])}}),w=i=>{var V;if(i){const T=s.value.find(k=>k.id===i);T&&(n.value={...T,authRuleVos:r.authRuleVos},(V=v.value)==null||V.clearValidate())}else n.value={...r}},b=A(()=>s.value.map(i=>({label:i.name,value:i.id,disabled:m.authIds.includes(i.id??"")})));return(i,V)=>{const T=Wa,k=se,B=ye,D=ue;return d(),O(el,{modelValue:e(o),"onUpdate:modelValue":V[4]||(V[4]=F=>ne(o)?o.value=F:null),title:"新增权限组"},{default:t(()=>[l(D,{model:e(n),ref_key:"formRef",ref:v,"label-width":"120px"},{default:t(()=>[l(k,{label:"选择已有权限组"},{default:t(()=>[l(fo,{style:{width:"100%"},load:g,inline:""},{default:t(()=>[l(T,{modelValue:e(n).id,"onUpdate:modelValue":V[0]||(V[0]=F=>e(n).id=F),options:e(b),filterable:"",placeholder:"请选择",onChange:w,clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1}),l(k,{label:"权限组名称",prop:"name",rules:[{required:!0,message:"请输入权限组名称",trigger:"blur"}]},{default:t(()=>[l(B,{placeholder:"请输入权限组名称",modelValue:e(n).name,"onUpdate:modelValue":V[1]||(V[1]=F=>e(n).name=F),disabled:!!e(n).id},null,8,["modelValue","disabled"])]),_:1}),l(k,{label:"权限成员",prop:"memberSelect"},{default:t(()=>{var F;return[(F=e(n))!=null&&F.memberSelect?(d(),O(Vt,{key:0,modelValue:e(f),"onUpdate:modelValue":V[2]||(V[2]=S=>ne(f)?f.value=S:null),disabled:!!e(n).id,dynamic:[e(me).allCooperateEnterprise,e(me).allCooperatePersonnel],isCooperation:"",class:"auth_selectpane",multiple:"",placeholder:"请选择权限成员",customStrictly:""},null,8,["modelValue","disabled","dynamic"])):U("",!0)]}),_:1})]),_:1},8,["model"]),l(xl,{editMode:!0,onClose:V[3]||(V[3]=F=>o.value=!1),"on-submit":c})]),_:1},8,["modelValue"])}}}),Dn=M({__name:"SetAuth",props:{entryId:{},appId:{},tableView:{},entryDetails:{},soureceInfo:{}},setup(E){const a=E,m=R(),I=R(),o=async()=>{var s;I.value=await za({appId:a.entryId,viewId:(s=a.tableView)==null?void 0:s.id})},r=R(!1),n=()=>{var s;(s=m.value)==null||s.reload()};return(s,g)=>{var w;const v=X,c=Ha,f=Je;return d(),C("div",{class:"set_auth"},[x("div",{class:"auth_body"},[l(f,{class:"auth_card"},{header:t(()=>[x("div",{class:"card-header"},[l(v,{icon:e(kl),type:"primary",class:"mr-10",onClick:g[0]||(g[0]=b=>r.value=!0)},{default:t(()=>[$(" 添加权限组 ")]),_:1},8,["icon"]),x("span",{class:"flex1"}," 设置组织内的部分成员可使用此表单添加数据，成员登录后可访问 ")])]),default:t(()=>[l(wt,{load:o,ref_key:"loadingDataRef",ref:m},{default:t(()=>{var b;return[(b=e(I))!=null&&b.length?(d(),C("div",{key:0,class:"card_list"},[(d(!0),C(q,null,j(e(I),h=>(d(),O(Sn,{key:h.id,auth:h,appId:s.appId,tableView:s.tableView,soureceInfo:s.soureceInfo,onRefresh:n},null,8,["auth","appId","tableView","soureceInfo"]))),128))])):(d(),O(c,{key:1,description:"暂无权限组"}))]}),_:1},512)]),_:1}),e(r)?(d(),O(On,{key:0,modelValue:e(r),"onUpdate:modelValue":g[1]||(g[1]=b=>ne(r)?r.value=b:null),authIds:((w=e(I))==null?void 0:w.map(b=>b.id??""))??[],tableView:s.tableView,entryDetails:s.entryDetails,onRefresh:n},null,8,["modelValue","authIds","tableView","entryDetails"])):U("",!0)])])}}});const xn=K(Dn,[["__scopeId","data-v-8aeb1a6f"]]),En=M({__name:"ListPublish",props:{entryId:{},appId:{},entryDetails:{},tableView:{}},setup(E){const a=E,{getSoureceInfo:m}=yt(),I=A(()=>m(a.tableView.basis.sourceId)),o=[{id:"auth",name:"权限设置",icon:"auth",tip:"对成员发布设置成员权限"}],{activeTab:r}=Na(o.map(n=>n.id),{queryKey:"publishTab"});return(n,s)=>(d(),C("div",{class:"form_publish"},[l(mo,{modelValue:e(r),"onUpdate:modelValue":s[0]||(s[0]=g=>ne(r)?r.value=g:null),"tab-list":o},null,8,["modelValue"]),x("div",{class:"publish-content"},[x("div",{class:"table_designer_page"},[e(r)==="auth"?(d(),O(xn,{key:0,"entry-id":n.entryId,"app-id":n.appId,soureceInfo:I.value,entryDetails:n.entryDetails,tableView:n.tableView},null,8,["entry-id","app-id","soureceInfo","entryDetails","tableView"])):U("",!0)])])]))}});const An=K(En,[["__scopeId","data-v-334f6146"]]),Un=M({__name:"routePage",setup(E){const a=ul("appId"),m=ul("appEntryId"),I=ul("viewId"),o=()=>{a?Yl(Ka,{replace:!0,query:{appId:a,entryId:m,listViewId:I,manager:"1"}}):Yl(Ja,{replace:!0})},r=[{label:"视图设计",name:"table"},{label:"视图发布",name:"publish"}],{activeTab:n}=It(r.map(h=>h.name),{queryKey:"tableDesignerTab"}),s=Ga(),g=R(),v=R(),c=R(!1),f=async()=>{if(c.value=!1,!m||!I)return;if(g.value=await Qa({entryId:m,viewId:I}),!g.value.appEntryVO)return Promise.reject({msg:"该数据列表已被删除或者无权限访问",loadState:Xa.danger});v.value=await Za(I);const h=await s.getSoureceData(v.value.basis.sourceId);h&&(v.value=st(v.value,h)),c.value=!0},w=R(),b=async()=>{var h;return n.value==="table"?await((h=w.value)==null?void 0:h.beforeLeave()):!0};return ja((h,y,u)=>{b().then(()=>u()).catch(()=>u(!1))}),(h,y)=>(d(),C(q,null,[l(Ya,{modelValue:e(n),"onUpdate:modelValue":y[0]||(y[0]=u=>ne(n)?n.value=u:null),tabs:r,onBack:o,entryDetails:g.value,"onUpdate:entryDetails":y[1]||(y[1]=u=>g.value=u),"before-leave":b},null,8,["modelValue","entryDetails"]),l(wt,{queryKeys:["appEntryId","appId","viewId"],path:o,ref:"loadingPageRef",class:"table_designer_page",load:f,"element-loading-background":"transparent"},{default:t(()=>{var u;return[(u=g.value)!=null&&u.appEntryVO&&v.value&&c.value?(d(),C(q,{key:0},[e(n)==="table"?(d(),C("div",{key:0,class:"table_designer-container"},[l(hn,{ref_key:"ListDesignerRef",ref:w,tableView:v.value,"onUpdate:tableView":y[2]||(y[2]=_=>v.value=_),appId:e(a)??"",entryId:e(m)??"",entryDetails:g.value},null,8,["tableView","appId","entryId","entryDetails"])])):U("",!0),e(n)==="publish"?(d(),C("div",{key:1,class:"table_designer-container"},[l(An,{ref_key:"ListDesignerRef",ref:w,appId:e(a)??"",entryId:e(m)??"",entryDetails:g.value,tableView:v.value},null,8,["appId","entryId","entryDetails","tableView"])])):U("",!0)],64)):U("",!0)]}),_:1},512)],64))}});const ri=K(Un,[["__scopeId","data-v-77805f41"]]);export{ri as default};

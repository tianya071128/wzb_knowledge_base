import{d as B,c as L,dj as m,dk as _,o as b,b as A,w as r,k as I,i as o,j as q,t as G,bG as Q,m as P,dl as U,B as l,C as w,dm as H,aN as O,av as J,ac as $,bC as M,_ as N,v as K,r as g,L as W,l as F,bu as X,bv as Y,dn as Z,dp as ee,dq as te,Q as ae,bm as le,f as x,a5 as se,F as ne,g as oe,dr as re,U as de,c3 as ue}from"./index-b80d5ef5.js";import{a as ie}from"./LoadingData-195d0581.js";const pe=B({__name:"AuthCard",props:{auth:{},entryId:{}},emits:["refresh"],setup(D,{emit:C}){const d=D,f=C,i=L(()=>{var t;return((t=d.auth.memberSelect)==null?void 0:t.selectedList.map(n=>n.id==="-1"?n.type===m.corpCooperation?{id:_.allCooperateEnterprise,type:m.dynamic}:n.type===m.userCooperation?{id:_.allCooperatePersonnel,type:m.dynamic}:n:n))??[]}),u=L(()=>{var t;return(t=d.auth.authRuleVos)==null?void 0:t.find(n=>n.entryId===d.entryId)}),s=async()=>{var t;await H(((t=u.value)==null?void 0:t.id)??""),O.success("取消关联成功"),f("refresh")};return(t,n)=>{const p=J,V=$,v=M;return b(),A(v,{class:"auth_card"},{header:r(()=>[I("div",{class:"card-header"},[o(q,null,{default:r(()=>[I("b",null,G(t.auth.name),1)]),_:1}),I("div",null,[o(Q,{title:"确定取消关联？",confirm:s},{reference:r(()=>[o(p,{class:"ml-10",underline:!1,type:"primary"},{default:r(()=>[P(" 取消关联 ")]),_:1})]),_:1})])])]),default:r(()=>[o(V,{label:"权限成员",class:"mb-0"},{default:r(()=>[o(U,{modelValue:l(i),"onUpdate:modelValue":n[0]||(n[0]=E=>w(i)?i.value=E:null),dynamic:[l(_).allCooperateEnterprise,l(_).allCooperatePersonnel],readonly:"",isCooperation:"",class:"auth_selectpane",multiple:"",placeholder:"请选择权限成员",customStrictly:""},null,8,["modelValue","dynamic"])]),_:1})]),_:1})}}});const ce=N(pe,[["__scopeId","data-v-24be0399"]]),me=B({__name:"AddAuth",props:{modelValue:{type:Boolean},authIds:{},entryDetails:{}},emits:["update:modelValue","refresh"],setup(D,{emit:C}){var S,R;const d=D,f=C,i=K(d,"modelValue",f),u={name:"",description:"",memberSelect:{selectedList:[]},authRuleVos:[{appId:((S=d.entryDetails.appEntryVO)==null?void 0:S.appId)??"",entryId:((R=d.entryDetails.appEntryVO)==null?void 0:R.id)??"",columnAuth:[]}]},s=g({...u}),t=g([]),n=async()=>{const a=await Z();t.value=a},p=g(),V=async()=>{var a;await((a=p.value)==null?void 0:a.validate()),await ee(s.value),O.success("新增成功！"),f("refresh")},v=L({get(){var a,e;return((e=(a=s.value)==null?void 0:a.memberSelect)==null?void 0:e.selectedList.map(c=>c.id==="-1"?c.type===m.corpCooperation?{id:_.allCooperateEnterprise,type:m.dynamic}:c.type===m.userCooperation?{id:_.allCooperatePersonnel,type:m.dynamic}:c:c))??[]},set(a){s.value.memberSelect&&(a!=null&&a.length?s.value.memberSelect.selectedList=a.map(e=>(e==null?void 0:e.id)===_.allCooperateEnterprise?{id:"-1",type:m.corpCooperation}:(e==null?void 0:e.id)===_.allCooperatePersonnel?{id:"-1",type:m.userCooperation}:e)??[]:s.value.memberSelect.selectedList=[])}}),E=a=>{var e;if(a){const c=t.value.find(k=>k.id===a);c&&(s.value={...c,authRuleVos:u.authRuleVos},(e=p.value)==null||e.clearValidate())}else s.value={...u}},y=L(()=>t.value.map(a=>({label:a.name,value:a.id,disabled:d.authIds.includes(a.id??"")})));return(a,e)=>{const c=te,k=$,T=ae,z=le;return b(),A(Y,{modelValue:l(i),"onUpdate:modelValue":e[4]||(e[4]=h=>w(i)?i.value=h:null),title:"新增权限组"},{default:r(()=>[o(z,{model:l(s),ref_key:"formRef",ref:p,"label-width":"120px"},{default:r(()=>[o(k,{label:"选择已有权限组"},{default:r(()=>[o(W,{style:{width:"100%"},load:n,inline:""},{default:r(()=>[o(c,{modelValue:l(s).id,"onUpdate:modelValue":e[0]||(e[0]=h=>l(s).id=h),options:l(y),filterable:"",placeholder:"请选择",onChange:E,clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1}),o(k,{label:"权限组名称",prop:"name",rules:[{required:!0,message:"请输入权限组名称",trigger:"blur"}]},{default:r(()=>[o(T,{placeholder:"请输入权限组名称",modelValue:l(s).name,"onUpdate:modelValue":e[1]||(e[1]=h=>l(s).name=h),disabled:!!l(s).id},null,8,["modelValue","disabled"])]),_:1}),o(k,{label:"权限成员",prop:"memberSelect"},{default:r(()=>{var h;return[(h=l(s))!=null&&h.memberSelect?(b(),A(U,{key:0,modelValue:l(v),"onUpdate:modelValue":e[2]||(e[2]=j=>w(v)?v.value=j:null),disabled:!!l(s).id,dynamic:[l(_).allCooperateEnterprise,l(_).allCooperatePersonnel],isCooperation:"",class:"auth_selectpane",multiple:"",placeholder:"请选择权限成员",customStrictly:""},null,8,["modelValue","disabled","dynamic"])):F("",!0)]}),_:1})]),_:1},8,["model"]),o(X,{editMode:!0,onClose:e[3]||(e[3]=h=>i.value=!1),"on-submit":V})]),_:1},8,["modelValue"])}}}),_e=B({__name:"SetAuth",props:{entryDetails:{}},setup(D){const C=D,d=g(),f=g(),i=async()=>{var t,n,p,V;f.value=await re({appId:((n=(t=C.entryDetails)==null?void 0:t.appEntryVO)==null?void 0:n.appId)??"",entryId:((V=(p=C.entryDetails)==null?void 0:p.appEntryVO)==null?void 0:V.id)??""})},u=g(!1),s=()=>{var t;(t=d.value)==null||t.reload()};return(t,n)=>{var E;const p=de,V=ue,v=M;return b(),x("div",{class:"set_auth"},[I("div",{class:"auth_body"},[o(v,{class:"auth_card"},{header:r(()=>[I("div",{class:"card-header"},[o(p,{icon:l(se),type:"primary",class:"mr-10",onClick:n[0]||(n[0]=y=>u.value=!0)},{default:r(()=>[P(" 添加权限组 ")]),_:1},8,["icon"]),I("span",{class:"flex1"}," 设置组织内的部分成员可使用此表单添加数据，成员登录后可访问 ")])]),default:r(()=>[o(ie,{load:i,ref_key:"loadingDataRef",ref:d},{default:r(()=>{var y;return[(y=l(f))!=null&&y.length?(b(),x("div",{key:0,class:"card_list"},[(b(!0),x(ne,null,oe(l(f),S=>{var R,a;return b(),A(ce,{key:S.id,auth:S,entryId:((a=(R=t.entryDetails)==null?void 0:R.appEntryVO)==null?void 0:a.id)??"",onRefresh:s},null,8,["auth","entryId"])}),128))])):(b(),A(V,{key:1,description:"暂无权限组"}))]}),_:1},512)]),_:1}),l(u)?(b(),A(me,{key:0,modelValue:l(u),"onUpdate:modelValue":n[1]||(n[1]=y=>w(u)?u.value=y:null),authIds:((E=l(f))==null?void 0:E.map(y=>y.id??""))??[],entryDetails:t.entryDetails,onRefresh:s},null,8,["modelValue","authIds","entryDetails"])):F("",!0)])])}}});const he=N(_e,[["__scopeId","data-v-44f51c2d"]]);export{he as S};

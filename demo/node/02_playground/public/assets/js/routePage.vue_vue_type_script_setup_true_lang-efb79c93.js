import{g8 as _,d as z,aV as W,v as H,r as T,dW as J,c as q,gk as Q,o as p,f,i as t,w as r,m as s,t as i,B as m,k as A,F as x,g as L,b as U,bs as X,gj as Y,l as $,fV as Z,C as ee,bv as O,ij as te,gi as P,bT as le,av as ae,ba as se,bU as re,_ as ne,bi as oe}from"./index-b80d5ef5.js";import{_ as ue}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import{u as ie}from"./utils-a7200637.js";const F=o=>{switch(o){case _.add:return"新增";case _.edit:return"修改";case _.del:return"删除";case _.addOrEdit:return"新增或修改"}},M=o=>o.executeType===_.plugin?`执行 【${o.executeName||"未命名插件"}】`:o.executeType===_.message?"发送消息":o.executeType===_.component?`执行 ${o.executeName??"-"}`:`${F(o.executeType)} 【${o.executeName}】 的数据`,j=o=>{const l=Number(o)??0;return l===0?l+"":l<1e3?l+"毫秒":l<6e4?(l/1e3).toFixed(2)+"秒":l<36e5?Math.floor(l/1e3/60)+"分"+((l%6e4/1e3).toFixed(2)?(l%6e4/1e3).toFixed(0)+"秒":""):l<36e5*24?Math.floor(l/1e3/60/60)+"时"+(l%36e5?(l%36e5/6e4).toFixed(0)+"分":""):Math.floor(l/1e3/60/60/24)+"天"+(l%(36e5*24)?(l%(36e5*24)/36e5).toFixed(0)+"时":"")},de=z({__name:"LogDetail",props:{visible:{type:Boolean},id:{}},emits:["update:visible"],setup(o,{emit:l}){const I=o,w=l,N=W(),k=H(I,"visible",w),a=T(null),g=T(!1),V=async()=>{var c,n,b;const v=await P.getLog({id:I.id});a.value=(c=v.records)!=null&&c.length?v.records[0]:null,u.appId=((n=a.value)==null?void 0:n.appId)??"",u.entryId=((b=a.value)==null?void 0:b.entryId)??"",g.value=!0},y=T(!1),u={mode:J.view,appId:"",entryId:""},E=q(()=>{var v;return((v=a.value)==null?void 0:v.entryId)??N.query.appEntryId}),{dynamicOptions:C}=ie(q(()=>({entryId:E.value}))),S=q(()=>v=>v.map(n=>{const{label:b}=Q({type:n.type,id:n.id,dynamicOptions:C.value});return b.value??"-"}).join("、"));return(v,c)=>{const n=le,b=ae,G=se,K=re;return p(),f(x,null,[t(O,{modelValue:m(k),"onUpdate:modelValue":c[1]||(c[1]=e=>ee(k)?k.value=e:null),title:"日志详情","show-load":V,size:"800"},{default:r(()=>[t(K,{class:"margin-top",column:2,border:""},{default:r(()=>[t(n,{label:"使用企业"},{default:r(()=>{var e;return[s(i(((e=a.value)==null?void 0:e.enterpriseName)||"-"),1)]}),_:1}),t(n,{label:"应用-表单"},{default:r(()=>{var e;return[s(i(((e=a.value)==null?void 0:e.applicationName)||"-"),1)]}),_:1}),t(n,{label:"执行者"},{default:r(()=>{var e;return[s(i(((e=a.value)==null?void 0:e.actionUser)||"-"),1)]}),_:1}),t(n,{label:"执行时间"},{default:r(()=>{var e;return[s(i(((e=a.value)==null?void 0:e.startTime)||"-"),1)]}),_:1}),t(n,{label:"结束时间"},{default:r(()=>{var e;return[s(i(((e=a.value)==null?void 0:e.endTime)||"-"),1)]}),_:1}),t(n,{label:"执行时长"},{default:r(()=>{var e;return[s(i(m(j)((e=a.value)==null?void 0:e.duration)||"-"),1)]}),_:1}),t(n,{label:"执行结果"},{default:r(()=>{var e;return[s(i(((e=a.value)==null?void 0:e.reqResult)==200?"成功":"失败"),1)]}),_:1}),t(n,{label:"失败原因"},{default:r(()=>{var e;return[s(i(((e=a.value)==null?void 0:e.failReason)||"-"),1)]}),_:1}),t(n,{label:"执行条件"},{default:r(()=>{var e,d;return[s(" 【"+i((e=a.value)==null?void 0:e.triggerName)+"】 "+i(m(F)((d=a.value)==null?void 0:d.triggerType))+"数据后，满足指定条件 ",1),A("div",null,[t(b,{underline:!1,type:"primary",onClick:c[0]||(c[0]=R=>y.value=!0)},{default:r(()=>[s(" 查看数据 ")]),_:1})])]}),_:1}),t(n,{label:"执行动作"},{default:r(()=>{var e;return[(p(!0),f(x,null,L((e=a.value)==null?void 0:e.executeAction,(d,R)=>(p(),f("div",{key:R},[d.executeType===m(_).message?(p(),f(x,{key:0},[s(" 发送 "),(p(!0),f(x,null,L(d.msgBase,(D,h)=>(p(),U(G,{title:D.title,width:300,trigger:"hover",content:D.rawContent,key:h},{reference:r(()=>{var B;return[A("span",null,[t(b,{type:"primary",underline:!1},{default:r(()=>[s(i(`【${m(X)(D.channel,m(Y))}】`),1)]),_:2},1024),h+1!=(((B=d==null?void 0:d.msgBase)==null?void 0:B.length)??0)?(p(),f("span",{key:0},",")):$("",!0)])]}),default:r(()=>[t(Z,{modelValue:D.rawContent,preview:"",group:[{id:"field",title:"当前表单控件",fieldOptions:{entryId:m(E)}},{id:"msg",title:"模板关键字",dictOptions:{dictKey:"msg_template_keyword"}}]},null,8,["modelValue","group"])]),_:2},1032,["title","content"]))),128)),s(" 给 "+i(m(S)(d.selectors??[])),1)],64)):d.executeType===m(_).component?(p(),f(x,{key:1},[s(" 执行 "+i(d.executeName??"-"),1)],64)):(p(),f(x,{key:2},[s(i(m(M)(d)),1)],64))]))),128))]}),_:1})]),_:1}),A("br")]),_:1},8,["modelValue"]),t(O,{modelValue:y.value,"onUpdate:modelValue":c[2]||(c[2]=e=>y.value=e),title:"查看数据",direction:"btt",size:"90%","destroy-on-close":""},{default:r(()=>{var e;return[g.value?(p(),U(te,{key:0,renderOptions:u,dataId:(e=a.value)==null?void 0:e.dataId},null,8,["dataId"])):$("",!0)]}),_:1},8,["modelValue"])],64)}}});const pe=ne(de,[["__scopeId","data-v-f39d6b53"]]),_e=z({__name:"routePage",props:{AssistId:{}},setup(o){const l=o,I=T(!1),w=T(),N=T(""),k=q(()=>{const a={type:"input",label:"智慧助手",prop:"smartName"},g={type:"input",label:"执行人",prop:"actionUser"},V={type:"timerange",label:"执行时间",prop:["startTime","endTime"]},y={type:"select",label:"执行结果",prop:"reqResult",options:"log_result_type"};return{id:"lowcode_assist_log",query:{list:l.AssistId?[g,V,y]:[a,g,V,y]},request:{api:P.getLog,extraParams:{smartId:l.AssistId??""}},table:{tableCols:[{prop:"smartName",label:"智慧助手名称"},{prop:"executeCondition",label:"执行条件",slots:{default({row:u}){return t("span",null,[s("【"),u.triggerName,s("】"),F(u.triggerType),s("数据后，满足指定条件")])}}},{prop:"executeAction",label:"执行动作",slots:{default({row:u}){return t("div",null,[u.executeAction.map(E=>t("div",null,[M(E),s(" ")]))])}}},{prop:"actionUser",label:"执行人"},{prop:"startTime",label:"执行时间"},{prop:"duration",label:"执行时长",slots:{default({row:u}){return t("span",null,[j(u.duration)])}}},{prop:"reqResult",label:"执行结果",slots:{default({row:u}){return t("span",null,[u.reqResult=="200"?"成功":"失败"])}}},{prop:"failReason",label:"失败原因"},{fixed:"right",width:100,prop:"operation",label:"操作",slots:{default({row:u}){const C=[{type:"primary",onClick:()=>{N.value=u.id,I.value=!0},text:"查看详情"}];return t(ue,{num:3,rowId:u.id,list:C},null)}}}]},operation:{fullEl:w}}});return(a,g)=>{const V=oe("az-page");return p(),f(x,null,[A("div",{class:"layout_box",ref_key:"pendingRef",ref:w},[t(V,{ref:"azPageRef",config:k.value},null,8,["config"])],512),t(pe,{visible:I.value,"onUpdate:visible":g[0]||(g[0]=y=>I.value=y),id:N.value},null,8,["visible","id"])],64)}}});export{_e as _};

import{d as E,y as x,r as c,o as i,b as _,w as m,B as D,l as U,L as h,ii as z,v as O,bK as $,c as w,i as n,bu as j,f as A,bt as G,F as J,g as K,C as Q,bv as W,AX as X,AY as Y,Q as H,ac as P,ao as T,bm as Z,c3 as ee,_ as te}from"./index-b80d5ef5.js";import{u as oe,e as ae,b as re,d as se}from"./app.vue_vue_type_script_setup_true_lang-59fd2507.js";import{D as le}from"./enum-7a2ae6a9.js";/* empty css                          */import"./AddOrEditValidate.vue_vue_type_style_index_0_lang-5bd5a73c.js";import"./Formula.vue_vue_type_style_index_0_lang-ef444f24.js";import"./index-8e050109.js";import"./utils-a7200637.js";import"./MessageRemindConfig-98484405.js";import"./messageTemplate-8658e6b4.js";import"./index-20639231.js";import"./FieldConditionView-ad1b057c.js";import"./index-318b68f4.js";import"./el-space-0d01b33a.js";import"./ButtonSelectField.vue_vue_type_script_setup_true_lang-aae15f71.js";import"./cloneDeep-dc1c677b.js";import"./isTypedArray-10beecc7.js";/* empty css                        */import"./SetFieldAuth-3d0b80a0.js";import"./el-dropdown-item-455a6589.js";import"./el-collapse-transition-4ed993c7.js";import"./FieldCondition-1c72aa9d.js";import"./SelectEntryAndOther-76a65b2d.js";import"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import"./useFieldMaxWidth-d82f063e.js";import"./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js";import"./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js";import"./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js";import"./AzInputNumber-d6212644.js";import"./el-input-number-c15b1cc7.js";import"./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js";import"./useMultipleVal-904406c1.js";import"./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js";import"./CardShowFieldItem-fd24f218.js";import"./defaultValue-7c7c87ea.js";import"./keyBy-8fcfdd74.js";import"./_createAggregator-d66ed64c.js";import"./InternalComponentSelectPlus-00c8c38f.js";import"./ComponentParamsSetWrapper-71afc840.js";import"./default-component-4c80201b.js";import"./ButtonState-cb54910b.js";import"./SelectFieldByMultEntry-84abd0c3.js";import"./fieldDefaultComponent-58752d9c.js";import"./Base.vue_vue_type_script_setup_true_lang-4fbdbc85.js";import"./DaterangeBase.vue_vue_type_script_setup_true_lang-bec97540.js";import"./InputBase.vue_vue_type_script_setup_true_lang-ffcf63f1.js";import"./Base-9b7f3306.js";import"./index-f0ed738f.js";import"./NumberBase.vue_vue_type_script_setup_true_lang-745b39c5.js";import"./Base-c9aa1df0.js";import"./SliderBase.vue_vue_type_script_setup_true_lang-5d73415b.js";import"./TextareaBase.vue_vue_type_script_setup_true_lang-7091b2cb.js";import"./TimeBase.vue_vue_type_script_setup_true_lang-ea537bf3.js";import"./TimerangeBase.vue_vue_type_script_setup_true_lang-0827c241.js";import"./UploadFileBase.vue_vue_type_script_setup_true_lang-0c253daa.js";import"./UploadImgBase.vue_vue_type_script_setup_true_lang-d23c1306.js";import"./CooperateEnterpriseBase.vue_vue_type_script_setup_true_lang-23720971.js";import"./CooperatePersonnelBase.vue_vue_type_script_setup_true_lang-adcd0db7.js";import"./Base.vue_vue_type_script_setup_true_lang-0e9a0e2c.js";import"./Base.vue_vue_type_script_setup_true_lang-aa25657d.js";import"./SelectCascaderEntry.vue_vue_type_script_setup_true_lang-673c5dca.js";import"./SelectForm.vue_vue_type_script_setup_true_lang-0170236d.js";import"./useExtractQuery-f96f705c.js";import"./EditorDraggable-a06dbc71.js";import"./typeof-7fd5df1e.js";const ne=E({__name:"SelectRender",props:{nodes:{},state:{},form:{},entryId:{},appId:{},modelValue:{},multiple:{type:Boolean},selectAbleList:{}},emits:["update:modelValue"],setup(I,{emit:g}){const e=I,f=g,p=Object.keys(e.state).reduce((r,o)=>(e.state[o]===1?r[o]=e.state[o]:e.selectAbleList.includes(o)?r[o]=2:r[o]=0,r),{});oe(p);const d=ae();x(()=>e.modelValue,()=>{d.setIds(e.modelValue)}),x(()=>d.selectIds,()=>{f("update:modelValue",d.selectIds)});const u=c(),v=c([]),b=async()=>{var r;if(u.value=se({appId:e.appId,entryId:e.entryId}),e.entryId){const o=await z(e.entryId);v.value=((r=o==null?void 0:o.formJson)==null?void 0:r.fields)??[]}u.value.nodes=e.nodes};return(r,o)=>(i(),_(h,{load:b},{default:m(()=>[u.value?(i(),_(re,{key:0,flowDesigner:u.value,fields:v.value,mode:D(le).Select,ref:"AppRef"},null,8,["flowDesigner","fields","mode"])):U("",!0)]),_:1}))}}),me=E({__name:"Back",props:{visible:{type:Boolean},required:{type:Boolean},processInstanceId:{},taskId:{},entryId:{},appId:{},enabled:{type:Boolean}},emits:["update:visible","submit"],setup(I,{emit:g}){const e=I,f=g,p=O(e,"visible",f),d=c(),u=$({target:[{required:!0,message:"请选择需要退回的节点",trigger:"change"}]}),v=w(()=>e.entryId),b=w(()=>e.appId),r=c(),o=c([]),s=c({target:"",comment:""}),V=w({get(){return[s.value.target]},set(t){s.value.target=t==null?void 0:t.join(",")}}),L=t=>{t!=null&&t.length&&(s.value.target=t[0].nodeId)},k=async()=>await X({processInstanceId:e.processInstanceId,taskId:e.taskId}),N=async()=>{const t=await Y({processInstanceId:e.processInstanceId}),a=await k();o.value=(a==null?void 0:a.map(y=>y.nodeId))??[],r.value=t},R=async()=>{var t;await((t=d.value)==null?void 0:t.validate()),s.value,f("submit",{...s.value})};return(t,a)=>{const y=H,B=P,S=T,q=Z,C=ee;return i(),_(W,{"append-to-body":"",modelValue:D(p),"onUpdate:modelValue":a[4]||(a[4]=l=>Q(p)?p.value=l:null),title:"退回",direction:"btt",class:"custom_drawer",size:"95%","show-load":N},{footer:m(()=>[n(j,{editMode:!0,onClose:a[3]||(a[3]=l=>p.value=!1),"on-submit":R})]),default:m(()=>[r.value?(i(),A("div",{key:0,class:"back_node-wrap"},[n(q,{ref_key:"ruleFormRef",ref:d,model:s.value,rules:u,class:"p-12"},{default:m(()=>[n(B,{required:t.required,rules:[{required:!0,message:"请输入审批意见",trigger:["blur","change"]},{min:2,max:2e3,message:"长度应为2-2000之间",trigger:["blur","change"]}],label:"退回意见",prop:"comment"},{default:m(()=>[n(y,{modelValue:s.value.comment,"onUpdate:modelValue":a[0]||(a[0]=l=>s.value.comment=l),placeholder:"请输入退回意见",type:"textarea",autosize:{minRows:2,maxRows:3},"show-word-limit":"",maxlength:"2000"},null,8,["modelValue"])]),_:1},8,["required"]),n(B,{label:"退回到",prop:"target"},{default:m(()=>[n(G,{modelValue:s.value.target,"onUpdate:modelValue":a[1]||(a[1]=l=>s.value.target=l),filterable:"",load:k,onLoadFinish:L},{default:m(({options:l})=>[(i(!0),A(J,null,K(l,(F,M)=>(i(),_(S,{key:M,label:F.name,value:F.nodeId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),n(ne,{style:{flex:"1",overflow:"auto"},modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=l=>V.value=l),nodes:r.value.nodes,state:r.value.state,entryId:v.value,appId:b.value,form:{},selectAbleList:o.value},null,8,["modelValue","nodes","state","entryId","appId","selectAbleList"])])):(i(),_(C,{key:1,description:"暂无流程数据"}))]),_:1},8,["modelValue"])}}});const yt=te(me,[["__scopeId","data-v-f563ea22"]]);export{yt as default};

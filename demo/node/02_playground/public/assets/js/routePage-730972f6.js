import{d as R,r as m,v as K,c as D,bK as Q,o as y,b as h,w as a,i as e,bu as ae,d9 as j,H as N,bt as O,f as q,F as $,g as H,B as P,mJ as te,C as W,bv as oe,Q as X,ac as Y,ao as se,q as ne,br as re,ap as ue,bm as Z,y as de,l as z,k as F,m as E,e as L,S as J,aN as A,U as ee,bn as ie,bi as pe,ae as me,lF as ce,is as ve,dl as fe,bs as G,P as be,b4 as _e,re as ye,dj as ge,_ as Ve}from"./index-b80d5ef5.js";import{g as we,s as Ie,o as xe,a as ke,b as Ce,c as he,d as Ue,q as Ee}from"./templateCenter-d2dd516d.js";/* empty css                          */import{_ as Pe}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";const De=R({__name:"addTemplate",props:{drawerModel:{type:Boolean},comState:{},templateId:{}},emits:["update:drawerModel","refresh"],setup(S,{emit:x}){const g=x,c=S,k=m(),w=n=>c.comState===n,r=K(c,"drawerModel",g),b=D(()=>w("edit")),f=D(()=>w("add")?"创建模板":"编辑模板"),i=D({get(){return o.value.platforms?o.value.platforms.split(","):[]},set(n){o.value.platforms=n.join(",")}}),V=D({get(){return o.value.tags?o.value.tags.split(","):[]},set(n){o.value.tags=n.join(",")}}),C=D({get(){return o.value.posterImg?o.value.posterImg.split(","):[]},set(n){o.value.posterImg=n.join(",")}}),I={category:"",coverImg:"",description:"",detail:"",industry:"",name:"",platforms:"",posterImg:"",tags:"",version:"",prefixUrl:""},o=m({...I}),v=Q({name:[{required:!0,message:"请输入模板名称",trigger:"blur"}]}),l=async()=>{if(w("add"))o.value={...I};else{const n=await we(c.templateId);o.value={...n}}},u=async n=>{var t;await((t=k.value)==null?void 0:t.validate()),await Ie(o.value),n==="submitContinue"&&(o.value={...I}),g("refresh")};return(n,t)=>{const _=X,d=Y,p=se,M=ne,T=re,B=ue,le=Z;return y(),h(oe,{size:750,modelValue:P(r),"onUpdate:modelValue":t[11]||(t[11]=s=>W(r)?r.value=s:null),title:f.value,"show-load":l},{footer:a(()=>[e(ae,{editMode:b.value,onClose:t[10]||(t[10]=s=>r.value=!1),"on-submit":u},null,8,["editMode"])]),default:a(()=>[e(le,{ref_key:"ruleFormRef",ref:k,rules:v,model:o.value,"label-width":"100px","label-position":"left"},{default:a(()=>[e(d,{label:"模板名称",prop:"name"},{default:a(()=>[e(_,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.name=s),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),e(d,{label:"简短宣传语"},{default:a(()=>[e(_,{modelValue:o.value.description,"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.description=s),placeholder:"请输入简短宣传语"},null,8,["modelValue"])]),_:1}),e(d,{label:"封面图片"},{default:a(()=>[e(j,{accept:["jpg","jpeg","png","bmp"],modelValue:o.value.coverImg,"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.coverImg=s)},null,8,["modelValue"])]),_:1}),e(d,{label:"详细图片"},{default:a(()=>[e(j,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=s=>C.value=s),limit:3,accept:["jpg","jpeg","png","bmp"]},null,8,["modelValue"])]),_:1}),e(N,{label:"行业"},{default:a(()=>[e(O,{modelValue:o.value.industry,"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.industry=s),style:{width:"100%"},placeholder:"请选择行业",load:"template_industry"},{default:a(({options:s})=>[(y(!0),q($,null,H(s,U=>(y(),h(p,{key:U.value,label:U.label,value:U.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(N,{label:"使用场景"},{default:a(()=>[e(O,{modelValue:o.value.category,"onUpdate:modelValue":t[5]||(t[5]=s=>o.value.category=s),style:{width:"100%"},placeholder:"请选择使用场景",load:"template_scene"},{default:a(({options:s})=>[(y(!0),q($,null,H(s,U=>(y(),h(p,{key:U.value,label:U.label,value:U.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"适用设备"},{default:a(()=>[e(T,{modelValue:i.value,"onUpdate:modelValue":t[6]||(t[6]=s=>i.value=s)},{default:a(()=>[e(M,{label:"PC",value:"PC"}),e(M,{label:"H5",value:"H5"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"标签"},{default:a(()=>[e(B,{modelValue:V.value,"onUpdate:modelValue":t[7]||(t[7]=s=>V.value=s),multiple:"",style:{width:"100%"},filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"宣传标签,请输入标签,如热门、必备"},null,8,["modelValue"])]),_:1}),e(d,{label:"版本编号"},{default:a(()=>[e(_,{modelValue:o.value.version,"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.version=s),placeholder:"请输入版本编号,如v1.0.1"},null,8,["modelValue"])]),_:1}),e(d,{label:"详细描述"},{default:a(()=>[e(P(te),{style:{width:"100%"},placeholder:"请描述此模板的功能、特点、解决的问题等",modelValue:o.value.detail,"onUpdate:modelValue":t[9]||(t[9]=s=>o.value.detail=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}}),Se=R({__name:"onlineAndOffline",props:{drawerModel:{type:Boolean},comState:{},version:{},templateId:{}},emits:["update:drawerModel","refresh"],setup(S,{emit:x}){const g=x,c=S,k={releaseDescription:"",releaseVersion:"",templateId:""},w={releaseDescription:"",releaseVersion:"",templateId:""},r=m({...k}),b=Q({releaseDescription:[{required:!0,message:"请描述此应用的功能、特点、解决的问题等",trigger:"blur"}],releaseVersion:[{required:!0,message:"请输入版本编号,如v1.0.1",trigger:"blur"}]}),f=K(c,"drawerModel",g);de(f,()=>{f.value&&(i("online")&&(r.value={...k,templateId:c.templateId}),i("offline")&&(r.value={...w,templateId:c.templateId}))});const i=v=>c.comState===v,V=m(!1),C=m(),I=async()=>{var v;await((v=C.value)==null?void 0:v.validate()),V.value=!0},o=async()=>{var v;await((v=C.value)==null?void 0:v.validate()),i("online")?await xe(r.value):await ke(r.value),A.success("操作成果"),V.value=!1,f.value=!1,g("refresh")};return(v,l)=>{const u=X,n=Y,t=Z,_=ee,d=ie;return y(),h(d,{modelValue:P(f),"onUpdate:modelValue":l[6]||(l[6]=p=>W(f)?f.value=p:null),width:"600px",title:i("online")?"模板发布":"模板下线"},{default:a(()=>[e(t,{ref_key:"ruleFormRef",ref:C,rules:b,model:r.value,"label-width":"100px","label-position":"left"},{default:a(()=>[i("online")?(y(),h(n,{key:0,label:"当前版本号"},{default:a(()=>[e(u,{"model-value":v.version,disabled:"",placeholder:"请输入版本编号,如v1.0.1"},null,8,["model-value"])]),_:1})):z("",!0),i("online")?(y(),h(n,{key:1,label:"发布版本",prop:"releaseVersion"},{default:a(()=>[e(u,{modelValue:r.value.releaseVersion,"onUpdate:modelValue":l[0]||(l[0]=p=>r.value.releaseVersion=p),placeholder:"请输入版本编号,如v1.0.1"},null,8,["modelValue"])]),_:1})):z("",!0),i("online")?(y(),h(n,{key:2,label:"发布说明",prop:"releaseDescription"},{default:a(()=>[e(u,{type:"textarea",modelValue:r.value.releaseDescription,"onUpdate:modelValue":l[1]||(l[1]=p=>r.value.releaseDescription=p),placeholder:"请描述此应用的功能、特点、解决的问题等"},null,8,["modelValue"])]),_:1})):z("",!0),i("offline")?(y(),h(n,{key:3,label:"下线原因",prop:"releaseDescription"},{default:a(()=>[e(u,{type:"textarea",modelValue:r.value.releaseDescription,"onUpdate:modelValue":l[2]||(l[2]=p=>r.value.releaseDescription=p),placeholder:"请描述此应用的功能、特点、解决的问题等"},null,8,["modelValue"])]),_:1})):z("",!0)]),_:1},8,["rules","model"]),e(d,{modelValue:V.value,"onUpdate:modelValue":l[4]||(l[4]=p=>V.value=p),width:"30%",title:i("online")?"发布确认":"下线确认","append-to-body":""},{footer:a(()=>[F("div",{class:"dialog-footer"},[e(_,{onClick:l[3]||(l[3]=p=>V.value=!1)},{default:a(()=>[E("取消")]),_:1}),e(_,{type:"primary",onClick:o},{default:a(()=>[E("确定")]),_:1})])]),default:a(()=>[L(F("span",null," 发布后企业可安装此应用，期间模板内容不可改，如需修 改可下线后处理。确定要发布？ ",512),[[J,i("online")]]),L(F("span",null," 下线后企业将不可见此模板。确定要下线？ ",512),[[J,i("offline")]])]),_:1},8,["modelValue","title"])]),footer:a(()=>[F("div",{class:"dialog-footer"},[e(_,{onClick:l[5]||(l[5]=p=>f.value=!1)},{default:a(()=>[E("取消")]),_:1}),e(_,{type:"primary",onClick:I},{default:a(()=>[E("确定")]),_:1})])]),_:1},8,["modelValue","title"])}}}),ze=R({__name:"routePage",setup(S){const x=m(!1),g=m(!1),c=m(!1),k=m(),w=m("add"),r=m("online"),b=m(""),f=m(""),i=m([]),V={query:{list:[{type:"input",label:"模板名称",prop:"name"},{type:"select",label:"类型",prop:"tabType",options:[{label:"全部",value:""},{label:"未发布",value:"1"},{label:"我创建的",value:"2"}]},{type:"select",label:"行业",prop:"industry",options:"template_industry",extraOptions:[{label:"全部",value:""}]},{type:"select",label:"使用场景",prop:"category",options:"template_scene",extraOptions:[{label:"全部",value:""}]}]},request:{api:Ce},table:{tableCols:[{prop:"name",label:"模板名称"},{prop:"authScope",label:"权限范围"},{prop:"platforms",label:"适用设备"},{prop:"version",label:"版本号"},{prop:"category",label:"使用场景",slots:{default({row:l}){return e("span",null,[G(l.category,"template_scene")||"-"])}}},{prop:"createTime",label:"创建时间"},{prop:"updateTime",label:"最后更新"},{prop:"status",label:"状态",slots:{default({row:l}){return e("span",null,[G(l.status,"template_status")])}}},{fixed:"right",width:200,label:"操作",slots:{default({row:l}){const B=[{type:"primary",onClick:()=>{g.value=!0,b.value=l.id,f.value=l.version,r.value="online"},text:"发布"},{type:"primary",onClick:()=>{o(l.id)},text:"权限"},{type:"primary",onClick:()=>{w.value="edit",b.value=l.id,x.value=!0},text:"编辑"},{type:"danger",text:"下线",onClick:()=>{g.value=!0,b.value=l.id,r.value="offline"}},{type:"primary",onClick:()=>{_e(ye,{query:{id:l.id}})},text:"查看信息"},{type:"primary",onClick:()=>{},text:"导出"},{type:"primary",onClick:()=>{},text:"复制"},{type:"danger",text:"删除",popconfirmProps:{title:"删除后模板信息将不可恢复，确认要删除",confirm:async()=>{await Ue(l.id),A.success("删除模板成功"),I()}}}];return e(Pe,{num:3,rowId:l.id,list:B},null)}}}]}},C=()=>{w.value="add",x.value=!0},I=async()=>{var l;await((l=k.value)==null?void 0:l.refresh())},o=async l=>{b.value=l;const u=await Ee(l);i.value=u.map(n=>({type:ge.corp,id:n.tenantId})),c.value=!0},v=async l=>{const u={templateId:b.value,tenantIds:[]};Array.isArray(l)?u.tenantIds=l.map(n=>n.id):u.tenantIds=[l.id],await he(u),A.success("设置权限成功"),c.value=!1};return(l,u)=>{const n=be,t=ee,_=pe("az-page");return y(),q("div",{class:"layout_box"},[e(_,{ref_key:"azPageRef",ref:k,config:V},{operation:a(()=>[e(t,{type:"primary",class:"azt_primary",onClick:C},{default:a(()=>[e(n,{size:16,style:{"margin-right":"8px"}},{default:a(()=>[e(P(me))]),_:1}),E(" 创建模板 ")]),_:1}),e(t,{type:"warning",class:"azt_warning"},{default:a(()=>[e(n,{size:16,style:{"margin-right":"8px"}},{default:a(()=>[e(P(ce))]),_:1}),E(" 导入 ")]),_:1})]),_:1},512),e(De,{"drawer-model":x.value,"onUpdate:drawerModel":u[0]||(u[0]=d=>x.value=d),onRefresh:I,templateId:b.value,"com-state":w.value},null,8,["drawer-model","templateId","com-state"]),e(Se,{"com-state":r.value,"template-id":b.value,onRefresh:I,"drawer-model":g.value,"onUpdate:drawerModel":u[1]||(u[1]=d=>g.value=d),version:f.value},null,8,["com-state","template-id","drawer-model","version"]),e(fe,{visible:c.value,"onUpdate:visible":u[2]||(u[2]=d=>c.value=d),"model-value":i.value,"onUpdate:modelValue":v,"dialog-title":"模板权限",placeholder:"选定企业下的成员可访问安装此应用",isCorp:"",multiple:"",tabs:[P(ve).corp],class:"w100"},null,8,["visible","model-value","tabs"])])}}});const Ae=Ve(ze,[["__scopeId","data-v-2e039293"]]);export{Ae as default};

import{hP as m,aT as k,a9 as F,er as E,i8 as S,gM as y,fu as v}from"./index-b80d5ef5.js";import{u as w}from"./formDesigner-462b10d7.js";const i=w();function g(e){k(()=>{i.removeError(e)})}const h=(e,r,c)=>{k(()=>{if(r){const l=i.errorMap.get(e);F(l,c)||i.addError(e,c)}else i.checkError(e)&&i.removeError(e)})},P=(e,r,c)=>{if(r=`${r}.dataOptions`,g(r),e.type===v.custom){const l=new Set;e.custom.options.forEach(t=>{if(l.has(t.value)){h(r+".custom."+t.value,!0,{msg:"不允许重复选项",...c??{}});return}l.add(t.value)})}},p=e=>{if(!e.sourceId)return!0;const{checkTree:r}=m({dataSystemParams:e.dataSystem});return r(e.sourceId)!==!1},x=e=>{if(!e.sourceId)return!0;const{checkSource:r}=m({dataSystemParams:e.dataSystem});return r(e.sourceId)!==!1},I=e=>{const{checkField:r}=E(e.dataSystem);return r(e.fieldId,{entryId:e.entryId,fields:e.fields,sourceId:e.sourceId})!==!1},n=e=>{const{checkField:r}=E(e.dataSystem);return!e.fieldIds.some(c=>r(c,{entryId:e.entryId,fields:e.fields,sourceId:e.sourceId})===!1)};function C({entryId:e,sourceId:r,dataSystem:c,id:l,showField:t,error:o}){h(l,!n({dataSystem:c,entryId:e,sourceId:r,fieldIds:t.reduce((s,f)=>{var d;return[...s,f.fieldId,...((d=f.child)==null?void 0:d.map(a=>a.fieldId))??[]]},[])}),{msg:"控件已被删除/不可选择",...o??{}})}const M=({designer:e,condition:r,dataSystem:c,entryId:l,sourceId:t,isLeftFieldBeCurrent:o})=>{try{r==null||r.forEach(s=>s.conditionSets.forEach(({leftTableName:f,leftFieldName:d,controlType:a,rightFieldName:u})=>{if(!I({dataSystem:c,fieldId:t?`${f}${S}${d}`:d??"",entryId:t?void 0:f??l,sourceId:t,fields:o?e.totalFields:void 0}))throw new Error("条件控件被删除");if(a===y.field&&!I({dataSystem:c,fieldId:u??"",fields:e.totalFields}))throw new Error("比较控件被删除")}))}catch{return!1}return!0},O=({rules:e,id:r,designer:c,error:l})=>{let t=!0;try{e==null||e.forEach(o=>{var s,f;(s=o.action)==null||s.forEach(d=>{d.effectFields.forEach(a=>{if(!c.matchField(a))throw"执行动作中存在被删除控件"})}),(f=o.condition)==null||f.forEach(d=>{var a;(a=d.conditionSets)==null||a.forEach(u=>{if(u.leftFieldName&&!c.matchField(u.leftFieldName))throw"条件中存在被删除控件"})})})}catch{t=!1}h(r,!t,{msg:"子表单规则存在异常",...l??{}})};function b({id:e,designer:r,error:c,dataSystem:l,sourceId:t,addValTransfer:o}){h(e,t&&(!n({dataSystem:l,sourceId:t,fieldIds:((o==null?void 0:o.reduce((s,f)=>{var d;return[...s,f.fieldId,...((d=f.child)==null?void 0:d.map(a=>a.fieldId))??[]].filter(a=>!!a)},[]))??[]).filter(s=>s)})||!n({dataSystem:l,fields:r.form.fields,fieldIds:((o==null?void 0:o.reduce((s,f)=>{var d;return[...s,f.currentFieldId??"",...((d=f.child)==null?void 0:d.map(a=>a.currentFieldId??""))??[]]},[]))??[]).filter(s=>s)})),{msg:"新增数据设置存在错误",...c??{}})}export{h as a,I as b,n as c,g as d,p as e,M as f,O as g,x as h,b as i,C as j,P as k};

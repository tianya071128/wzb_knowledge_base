import{d as C,c as V,hZ as m,is as E,dk as A,v as z,o as p,b as y,B as d,C as S,dl as W,r as w,lG as G,mD as J,f as N,k as q,i as k,w as F,m as D,t as R,mE as H,l as U,d9 as Q,aT as Z,aN as K,U as X,aU as x,av as ee,_ as Y,fV as ae,bw as le,Q as re,h_ as b,bi as se,F as $,g as j,p as te,a2 as oe,mp as ue,bt as ne,mF as pe,H as B,a3 as de,mG as ie,ao as me,R as ce,x as fe,y as ye,z as ve,Y as O,M as ge,a9 as he,L as _e,a$ as M,ms as Ve,eh as be,c3 as Te,bm as Pe}from"./index-b80d5ef5.js";import{A as Ie}from"./AzInputNumber-d6212644.js";const ke=C({__name:"MemberSelect",props:{type:{},modelValue:{}},emits:["update:modelValue"],setup(T,{emit:i}){const c=T,f=i,o=V(()=>{if(c.type===m.dept)return"部门列表";if(c.type===m.personnel)return"部门成员列表";if(c.type===m.job)return"岗位列表"}),v=V(()=>{if(c.type===m.dept)return[E.org];if(c.type===m.personnel)return[E.memberByOrg];if(c.type===m.job)return[E.jobByOrg]}),h=V(()=>{if(c.type===m.dept)return[A.org];if(c.type===m.personnel)return[A.user]}),e=z(c,"modelValue",f);return(r,t)=>(p(),y(W,{modelValue:d(e),"onUpdate:modelValue":t[0]||(t[0]=P=>S(e)?e.value=P:null),"dialog-title":o.value,tabs:v.value,multiple:"",dynamic:h.value},null,8,["modelValue","dialog-title","tabs","dynamic"]))}}),Fe=C({__name:"UploadFile",props:{modelValue:{}},emits:["update:modelValue"],setup(T,{emit:i}){const c=T,f=i,o=w(),v=()=>{h.value="",Z(()=>{var g;(g=o.value)==null||g.uploadFile()})},h=w(""),e=z(c,"modelValue",f),r=V(()=>e.value?"已上传附件":"上传附件"),t=V(()=>e.value?"success":""),P=V(()=>e.value?G:J),l=V(()=>!e.value),a=(g,_)=>{setTimeout(()=>{e.value=h.value,K.success("上传成功")},300)};return(g,_)=>{const I=X,u=x,n=ee;return p(),N("div",{class:"PluginUpdateFile"},[q("div",{style:{flex:"1"}},[k(u,{disabled:l.value,effect:"dark",content:"已上传文件,再次点击可重新上传",placement:"top"},{default:F(()=>[k(I,{icon:P.value,style:{width:"100%"},type:t.value,onClick:v},{default:F(()=>[D(R(r.value),1)]),_:1},8,["icon","type"])]),_:1},8,["disabled"])]),l.value?U("",!0):(p(),N("div",{key:0,class:"refresh"},[k(u,{effect:"dark",content:"重置",placement:"top"},{default:F(()=>[k(n,{underline:!1,onClick:_[0]||(_[0]=s=>e.value=""),icon:d(H)},null,8,["icon"])]),_:1})])),q("div",{style:{display:"none"}},[k(Q,{ref_key:"AzUploadRef",ref:o,limit:1,type:"file",onUploadFinish:a,modelValue:h.value,"onUpdate:modelValue":_[1]||(_[1]=s=>h.value=s),size:1024*10,isShowTip:!1,"is-show-trigger":!1,"show-file-list":!1,accept:[]},null,8,["modelValue"])])])}}});const Ne=Y(Fe,[["__scopeId","data-v-7d34eefa"]]),Ue=C({__name:"PluginParamsDefault",props:{modelValue:{},paramType:{},group:{}},emits:["update:modelValue"],setup(T,{emit:i}){const c=T,o=z(c,"modelValue",i),v=V(()=>[m.array,m.arrayObject].includes(c.paramType)?"默认值,例如:[ ]":"默认值"),h=V({get(){return o.value?JSON.parse(o.value??"[]"):[]},set(r){o.value=JSON.stringify(r)}}),e=V({get(){return o.value??""},set(r){o.value=r}});return(r,t)=>{const P=le,l=re;return r.paramType===d(m).number?(p(),y(Ie,{key:0,modelValue:d(o),"onUpdate:modelValue":t[0]||(t[0]=a=>S(o)?o.value=a:null),style:{width:"100%"},"controls-position":"right",placeholder:"默认值"},null,8,["modelValue"])):r.paramType===d(m).dateTime?(p(),y(P,{key:1,modelValue:d(o),"onUpdate:modelValue":t[1]||(t[1]=a=>S(o)?o.value=a:null),style:{width:"100%",display:"inline-flex"},class:"date-time",type:"datetime",placeholder:"默认值",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD h:m:s"},null,8,["modelValue"])):r.paramType===d(m).personnel||r.paramType===d(m).dept||r.paramType===d(m).job?(p(),y(ke,{key:2,modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=a=>h.value=a),type:r.paramType},null,8,["modelValue","type"])):r.paramType===d(m).annex?(p(),y(Ne,{key:3,modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value=a)},null,8,["modelValue"])):r.paramType===d(m).text&&r.group?(p(),y(ae,{key:4,modelValue:d(o),"onUpdate:modelValue":t[4]||(t[4]=a=>S(o)?o.value=a:null),placeholder:v.value,group:r.group},null,8,["modelValue","placeholder","group"])):(p(),y(l,{key:5,modelValue:d(o),"onUpdate:modelValue":t[5]||(t[5]=a=>S(o)?o.value=a:null),placeholder:v.value},null,8,["modelValue","placeholder"]))}}}),qe=C({__name:"ParamsSetItem",props:{requestParmas:{},inputParams:{},propPrefix:{default:""},search:{type:Boolean,default:!1},fatherParmas:{},entryId:{},fields:{},sourceId:{},group:{},labelWidth:{default:"120px"}},setup(T){const i=T,c=V(()=>{const e=[];return(i.sourceId||i.entryId||i.fields)&&e.push(b.field),i.search&&e.push(b.search),e.push(b.custom),e}),f=e=>{var r;return(r=i.inputParams.find(t=>t.paramName===e))==null?void 0:r.name},o=e=>i.search?e:e.filter(r=>r.value!==b.search),v=(e,r)=>{var t;return ie(r.paramType,e,{subformId:(t=i.fatherParmas)==null?void 0:t.value})},h=(e,r)=>{e.value=r.value,e.valueType=r.valueType};return(e,r)=>{const t=me,P=se("ParamsSetItem",!0);return p(),N("ul",null,[(p(!0),N($,null,j(e.requestParmas,(l,a)=>{var g,_,I;return p(),N("li",{key:l.paramName},[q("div",{class:"params-item"},[q("span",{class:te(["params-label",{"az-required":l.requiredFlag}]),style:oe({width:e.labelWidth}),title:f(l.paramName)??""},[q("span",{class:"az-ellipsis"},R(f(l.paramName)),1),(g=e.inputParams.find(u=>u.paramName===l.paramName))!=null&&g.remark?(p(),y(ue,{key:0,tip:((_=e.inputParams.find(u=>u.paramName===l.paramName))==null?void 0:_.remark)??""},null,8,["tip"])):U("",!0)],14,["title"]),c.value.length>1?(p(),y(B,{key:0,style:{width:"150px"},required:"","show-message":!1,prop:`${e.propPrefix}${a}.fillType`,"hide-label":""},{default:F(()=>[k(ne,{modelValue:l.fillType,"onUpdate:modelValue":u=>l.fillType=u,load:d(pe),isCheckRemove:"",removeText:"该类型不可选择",onChange:u=>{l.value=void 0,l.valueType=void 0}},{default:F(({options:u})=>[(p(!0),N($,null,j(o(u),(n,s)=>(p(),y(t,{key:s,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","load","onChange"])]),_:2},1032,["prop"])):U("",!0),l.fillType!==d(b).search?(p(),y(B,{key:1,class:"params-value",required:l.requiredFlag,"show-message":!1,prop:`${e.propPrefix}${a}.value`,"hide-label":""},{default:F(()=>{var u,n;return[l.fillType===d(b).field?(p(),y(de,{key:0,"model-value":{value:l.value,valueType:l.valueType},"onUpdate:modelValue":s=>h(l,s),fields:e.fields,entryId:e.entryId,sourceId:e.sourceId,filter:s=>v(s,l),"is-select-subform":l.paramType===d(m).arrayObject,clearable:"",disabled:i.fatherParmas&&!((u=i.fatherParmas)!=null&&u.value),prop:{fieldId:"value",fieldType:"valueType"},placeholder:i.fatherParmas&&!((n=i.fatherParmas)!=null&&n.value)?"请先选择子表单控件":l.requiredFlag?"请选择控件":"非必填，选择控件"},null,8,["model-value","onUpdate:modelValue","fields","entryId","sourceId","filter","is-select-subform","disabled","placeholder"])):(p(),y(Ue,{key:1,modelValue:l.value,"onUpdate:modelValue":s=>l.value=s,paramType:l.paramType,group:e.group},null,8,["modelValue","onUpdate:modelValue","paramType","group"]))]}),_:2},1032,["required","prop"])):U("",!0)]),Array.isArray(l.child)&&l.fillType===d(b).field&&l.child.length?(p(),N("div",{key:0,class:"params-son"},[k(P,{inputParams:((I=e.inputParams.find(u=>u.paramName===l.paramName))==null?void 0:I.subControls)??[],requestParmas:l.child,fatherParmas:l,propPrefix:`${e.propPrefix}${a}.child.`,fields:e.fields,entryId:e.entryId,sourceId:e.sourceId,search:e.search,group:e.group},null,8,["inputParams","requestParmas","fatherParmas","propPrefix","fields","entryId","sourceId","search","group"])])):U("",!0)])}),128))])}}});const Se=Y(qe,[["__scopeId","data-v-0ac208d5"]]),Ee=C({__name:"ParamsSet",props:{modelValue:{},pluginId:{},search:{type:Boolean},entryId:{},fields:{},sourceId:{},group:{},scenario:{},labelWidth:{}},emits:["update:modelValue"],setup(T,{expose:i,emit:c}){const f=T,v=ce(f,"modelValue",c),h=V(()=>{const a=[];return(f.sourceId||f.entryId||f.fields)&&a.push(b.field),f.search&&a.push(b.search),a.push(b.custom),a}),e=w(),r=fe(),t=w(),P=async()=>{if(!f.pluginId)return Promise.reject({msg:"缺少必要参数",loadState:M.danger});const a=await r.getPluginData(f.pluginId);if(!a||f.scenario&&!Ve({pluginInfo:a,scenario:f.scenario}))return Promise.reject({msg:"插件不可使用!",loadState:M.danger});e.value=a};ye(()=>f.pluginId,()=>{var a,g;return(g=(a=t.value)==null?void 0:a.reload)==null?void 0:g.call(a)}),ve(()=>{var g;if(!e.value)return;const a=O(v.value??[]);(function _(I,u){for(const n of I){let s=u.find(L=>L.paramName===n.paramName);s?(s.requiredFlag=n.requiredFlag,s.paramType!==n.paramType&&(delete s.child,s.paramType=n.paramType)):(s={fillType:h.value[0],paramName:n.paramName,paramType:n.paramType,requiredFlag:n.requiredFlag},u.push(s)),s.paramType===m.arrayObject&&(Array.isArray(s.child)||(s.child=[]),_(n.subControls??[],s.child))}u.sort((n,s)=>Number(s.requiredFlag)-Number(n.requiredFlag)),ge(u,n=>!I.some(s=>s.paramName===n.paramName))})(((g=e.value)==null?void 0:g.inputControls)??[],a),he(a,v.value)||(v.value=O(a))});const l=w();return i({validate(){var a;return(a=l.value)==null?void 0:a.validate()}}),(a,g)=>{const _=be,I=Te,u=Pe;return p(),y(_e,{class:"plugin_request",load:P,ref_key:"loadingDataRef",ref:t},{default:F(()=>{var n,s;return[k(_,{class:"mb-10",type:"info",closable:!1},{title:F(()=>[q("span",null,[D(" 配置插件需要的参数，名称有红星( "),q("span",{class:"az-required"}),D(" )的为必填参数，没有红星的可以选填。 ")])]),_:1}),(s=(n=e.value)==null?void 0:n.inputControls)!=null&&s.length?U("",!0):(p(),y(I,{key:0,description:"没有需要填充的参数"})),k(u,{model:d(v),ref_key:"ruleFormRef",ref:l},{default:F(()=>[e.value?(p(),y(Se,{key:0,labelWidth:a.labelWidth,search:a.search,inputParams:e.value.inputControls,"request-parmas":d(v),fields:a.fields,entryId:a.entryId,sourceId:a.sourceId,group:a.group},null,8,["labelWidth","search","inputParams","request-parmas","fields","entryId","sourceId","group"])):U("",!0)]),_:1},8,["model"])]}),_:1},512)}}});export{Ee as _};

import{d as k,r as v,bK as x,v as B,c as S,dj as T,dk as D,o as g,b as f,w as o,i as t,bu as M,f as I,F as O,g as P,m as $,t as h,dl as j,B as b,is as q,C as A,f8 as G,E as H,ab as K,ac as L,Q,bm as z,bn as J}from"./index-b80d5ef5.js";const X=k({__name:"Sign",props:{visible:{type:Boolean},flowNode:{},validateForm:{type:Function}},emits:["update:visible","submit"],setup(_,{emit:R}){const s=_,p=R,c=v(),w=x({signUsers:[{required:!0,message:"请选择加签用户",trigger:"change"}]}),e=v({signRule:s.flowNode.signRule==="3"?"1":s.flowNode.signRule,signUsers:[],comment:""}),n=B(s,"visible",p),U=()=>{n.value=!1},y=async()=>{var l,i;await((l=c.value)==null?void 0:l.validate()),e.value.signRule!=="1"&&await((i=s==null?void 0:s.validateForm)==null?void 0:i.call(s)),G(e.value.signUsers)||(e.value.signUsers=[e.value.signUsers]);const u={signRule:e.value.signRule,comment:e.value.comment,signUsers:e.value.signUsers.map(r=>r.id)};p("submit",{...u})},V={1:[{label:"在我审批前加签",value:"1"}],2:[{label:"在我审批后加签(确定加签，执行我审批通过并加签)",value:"2"}],3:[{label:"在我审批前加签",value:"1"},{label:"在我审批后加签(确定加签，执行我审批通过并加签)",value:"2"}],4:[{label:"添加审批人",value:"4"}]},E=S(()=>s.flowNode.hasDeptCascade.signHasDeptCascade?[...s.flowNode.signUsers,{type:T.dynamic,id:D.selectedOrgToChild}]:s.flowNode.signUsers);return(u,l)=>{const i=H,r=K,m=L,F=Q,N=z,C=J;return g(),f(C,{"append-to-body":"",modelValue:b(n),"onUpdate:modelValue":l[4]||(l[4]=a=>A(n)?n.value=a:null),title:"加签",width:"600px",onClose:U},{footer:o(()=>[t(M,{editMode:!0,onClose:l[3]||(l[3]=a=>n.value=!1),"on-submit":y})]),default:o(()=>[t(N,{ref_key:"ruleFormRef",ref:c,model:e.value,rules:w,"label-width":"140px"},{default:o(()=>[t(m,{label:"加签方式",prop:"signRule"},{default:o(()=>[t(r,{modelValue:e.value.signRule,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.signRule=a)},{default:o(()=>[(g(!0),I(O,null,P(V[u.flowNode.signRule],(a,d)=>(g(),f(i,{key:d,label:a.value,value:a.value},{default:o(()=>[$(h(a.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"加签人员",prop:"signUsers"},{default:o(()=>{var a;return[t(j,{tabs:[b(q).memberByOrg],multiple:((a=u.flowNode)==null?void 0:a.countersignType)!==4,selectRange:E.value,modelValue:e.value.signUsers,"onUpdate:modelValue":l[1]||(l[1]=d=>e.value.signUsers=d)},null,8,["tabs","multiple","selectRange","modelValue"])]}),_:1}),t(m,{label:e.value.signRule=="2"?"审批通过及加签原因":"加签原因"},{default:o(()=>[t(F,{type:"textarea",row:3,modelValue:e.value.comment,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.comment=a),placeholder:"请输入加签原因","show-word-limit":"",maxlength:"2000"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}});export{X as default};

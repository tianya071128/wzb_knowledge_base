import{u as Sa,A as U,a as Y,G as ie,d as D,r as b,c as B,n as H,o as v,b as P,w as g,e as oe,f as A,F as Q,g as ae,h as Ce,i as s,j as Ue,k as h,t as le,l as R,m as N,p as Pe,L as ea,E as qe,q as aa,s as ka,_ as j,v as ue,x as re,y as Z,z as ha,B as m,C as se,D as wa,H as ne,I as ge,J as Be,K as be,M as Fa,N as la,O as ta,P as De,Q as pe,R as ke,S as de,T as _e,U as ce,V as Ke,W as Ca,X as Ie,Y as X,Z as Ae,$ as na,a0 as Aa,a1 as Te,a2 as $e,a3 as Ta,a4 as $a,a5 as he,a6 as He,a7 as xa,a8 as Ea,a9 as Re,aa as Se,ab as oa,ac as Oe,ad as La,ae as Ua,af as ze,ag as Pa,ah as qa,ai as Ba,aj as Qe,ak as Da,al as Ra,am as Oa,an as Ye,ao as sa,ap as ra,aq as fe,ar as da,as as ia,at as ua,au as za,av as Ne,aw as Na,ax as Wa,ay as ja,az as Ma,aA as Ga,aB as Ja,aC as Ka,aD as Ha,aE as Qa,aF as Ya,aG as Xa,aH as Za,aI as el,aJ as al,aK as ll,aL as tl,aM as pa,aN as ca,aO as nl,aP as ol,aQ as sl,aR as rl,aS as dl,aT as il,aU as ma,aV as ul,aW as pl,aX as cl,aY as ml,aZ as gl,a_ as fl,a$ as Fe,b0 as vl,b1 as _l,b2 as yl,b3 as Il,b4 as Xe,b5 as bl,b6 as Vl,b7 as Sl,b8 as kl,b9 as hl,ba as wl}from"./index-b80d5ef5.js";import{B as ga}from"./ButtonState-cb54910b.js";import{D as ve,a as te,S as me}from"./SelectEntryAndOther-76a65b2d.js";import{E as We}from"./EditorDraggable-a06dbc71.js";import{_ as fa,a as va}from"./FormLabel.vue_vue_type_script_setup_true_lang-ceed9d28.js";import{_ as Fl}from"./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js";import{S as Cl}from"./SelectFieldByMultEntry-84abd0c3.js";import{C as Al}from"./ConditionWrapper-43da1676.js";import{E as Tl}from"./el-input-number-c15b1cc7.js";import{_ as $l,h as xl}from"./Formula.vue_vue_type_style_index_0_lang-ef444f24.js";import{_ as El}from"./SelectForm.vue_vue_type_script_setup_true_lang-0170236d.js";import{c as Ll,a as Ul}from"./index-8e050109.js";import{u as Pl}from"./useExtractQuery-f96f705c.js";import"./FieldCondition-1c72aa9d.js";import"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import"./useFieldMaxWidth-d82f063e.js";import"./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js";import"./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js";import"./index-318b68f4.js";import"./AzInputNumber-d6212644.js";import"./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js";import"./useMultipleVal-904406c1.js";import"./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js";import"./el-dropdown-item-455a6589.js";import"./CardShowFieldItem-fd24f218.js";function ye(){return{name:"未命名聚合表",isSql:"2"}}async function ql(V){var t;const{dataSystem:I,dataSources:n}=V,{checkForm:d,checkField:r,checkAggregate:e}=Sa(I),a=[...[(n==null?void 0:n.singleEntryId)&&{type:U,id:n==null?void 0:n.singleEntryId},...(n==null?void 0:n.multiples)??[]].filter(o=>!!o).map(o=>o.type===U.aggregate?e(o.id):d(o.id)),...(((t=n==null?void 0:n.link)==null?void 0:t.map(o=>o.join.map(u=>r(u.fieldId,{entryId:u.fieldSource===U.aggregate?void 0:u.entryId,aggregateId:u.fieldSource===U.aggregate?u.entryId:void 0}))))??[]).flat(1)];return(await Promise.all(a)).every(o=>o)}function Bl(V){return V.options??_a(V)}function _a(V){switch(V.fieldType){case Y.date:return{groupUnit:ie.D};case Y.cascader:return{groupUnit:ie.LEVEL_LAST};default:return}}const Dl=[{label:"年",value:ie.Y,types:[Y.date]},{label:"年-月",value:ie.M,types:[Y.date]},{label:"年-月-日",value:ie.D,types:[Y.date]},{label:"第一级",value:ie.LEVEL_1,types:[Y.cascader]},{label:"第二级",value:ie.LEVEL_2,types:[Y.cascader]},{label:"末级",value:ie.LEVEL_LAST,types:[Y.cascader]}];function Rl(V){return Dl.filter(I=>I.types.includes(V.fieldType))}const Ol=[{label:"条目",name:ve.entry},{label:"聚合表",name:ve.aggregation}],zl=D({__name:"PaneWrapper",props:{modelValue:{},multiple:{type:Boolean},load:{type:Function},type:{}},emits:["update:modelValue","change"],setup(V,{expose:I,emit:n}){const d=V,r=n,e=b([]),p=b(0),a=b(100),c=b(1),t=b(100),o=B(()=>!!p.value||t.value<=a.value*c.value),u=async()=>{p.value=p.value+1;const F=p.value;try{const O=await d.load(c.value,a.value);if(F===p.value){const W=O.records;e.value=c.value===1?W:[...e.value,...W],t.value=Number(O.total)||0}}catch{t.value=0}finally{p.value=p.value-1}},i=async()=>{c.value=c.value+1,await u()},l=async()=>{c.value=1,await u()},y=B({get(){return H(d.modelValue)},set(F){const O=F.map(M=>e.value.find(K=>K.__id__===M)),W=d.multiple?F:F[0];r("update:modelValue",W),r("change",W,d.multiple?O:O[0])}}),k=F=>y.value.includes(F.__id__),T=(F,O)=>{if(!d.multiple)y.value=[F.__id__];else{const W=new Set([...d.modelValue??[]]);O?W.add(F.__id__):W.delete(F.__id__),y.value=[...W]}},C=b();return I({list:e,refresh(){var F;(F=C.value)==null||F.reload()}}),(F,O)=>{const W=qe,M=aa,K=ka;return v(),P(ea,{load:l,class:Pe(["pane_wrapper",{"is-highlight":!F.multiple&&F.type==="highlight"}]),ref_key:"loadingDataRef",ref:C},{default:g(()=>[oe((v(),A("div",{class:"pane_wrapper-select","infinite-scroll-disabled":o.value,"infinite-scroll-distance":20,"infinite-scroll-immediate":!1},[e.value.length?(v(),A("div",{key:0},[F.multiple?R("",!0):(v(!0),A(Q,{key:0},ae(e.value,_=>(v(),P(W,{key:_.__id__,"model-value":k(_),"onUpdate:modelValue":w=>T(_,w),label:!0},{default:g(()=>[Ce(F.$slots,"item",{item:_},()=>[s(Ue,{class:"pane_wrapper-label"},{default:g(()=>[h("span",null,le(_.__label__),1),h("span",{class:"pane_wrapper-secondary"},le(_.__secondaryLabel__),1)]),_:2},1024)],!0)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128)),F.multiple?(v(!0),A(Q,{key:1},ae(e.value,_=>(v(),P(M,{key:_.__id__,"model-value":k(_),"onUpdate:modelValue":w=>T(_,w),label:!0},{default:g(()=>[Ce(F.$slots,"item",{item:_},()=>[N(le(_.__label__),1)],!0)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128)):R("",!0)])):p.value?R("",!0):(v(),A("div",{key:1,class:"az-data-empty"},"暂无数据"))],8,["infinite-scroll-disabled"])),[[K,i]])]),_:3},8,["class"])}}});const je=j(zl,[["__scopeId","data-v-05caedf7"]]),Nl=D({__name:"AppPane",props:{modelValue:{},appId:{},defaultSelected:{type:Boolean},multiple:{type:Boolean}},emits:["update:modelValue"],setup(V,{emit:I}){const n=V,r=ue(n,"modelValue",I),e=re(),p=async()=>({total:0,records:[...await e.getApply()].sort(o=>o.id===n.appId?-1:0).map(o=>({...o,__id__:o.id??"",__label__:o.name,__secondaryLabel__:o.id===n.appId?"（当前表单）":void 0}))});Z(()=>n.appId,()=>{var c;(c=a.value)==null||c.refresh()});const a=b();return ha(()=>{var c;if(n.defaultSelected){const t=(c=a.value)==null?void 0:c.list;t!=null&&t.length&&!n.multiple&&!t.some(o=>o.__id__===r.value)&&(r.value=t[0].__id__)}}),(c,t)=>(v(),P(je,{modelValue:m(r),"onUpdate:modelValue":t[0]||(t[0]=o=>se(r)?r.value=o:null),load:p,ref_key:"paneWrapperRef",ref:a,multiple:c.multiple},null,8,["modelValue","multiple"]))}});const ya=j(Nl,[["__scopeId","data-v-cfd4983f"]]),Wl=D({__name:"EntryPane",props:{modelValue:{},appId:{},isAllApp:{type:Boolean},multiple:{type:Boolean},type:{},name:{}},emits:["update:modelValue"],setup(V,{emit:I}){const n=V,d=I,r=b(n.appId??"");Z(()=>n.appId,()=>{n.isAllApp||(r.value=n.appId??"")});const e=b(),p=re(),a=async()=>({total:0,records:(await p.getForm(r.value)).filter(i=>{var l;return!(n.type&&i.type!==n.type||(l=n.name)!=null&&l.trim()&&!i.name.includes(n.name))}).map(i=>({...i,__id__:i.id??"",__label__:i.name}))});Z([r,()=>n.name,()=>n.type],()=>{var u;(u=e.value)==null||u.refresh()});const c=B({get(){return H(n.modelValue)},set(u){d("update:modelValue",n.multiple?u:u[0])}}),t=B(()=>{const u=c.value.map(i=>i.id);return n.multiple?u:u[0]}),o=(u,i)=>{const l=H(i).filter(k=>!!k),y=H(u).map(k=>{const T=l.find(F=>F.id===k),C=c.value.find(F=>F.id===k);return{...C,id:k,type:te.entry,appId:(T==null?void 0:T.appId)??(C==null?void 0:C.appId),entryType:(T==null?void 0:T.type)??(C==null?void 0:C.entryType)}});c.value=y};return(u,i)=>(v(),A("div",{class:"form_pane"},[u.isAllApp?(v(),P(ya,{key:0,modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=l=>r.value=l),class:"form_pane-left",appId:u.appId,type:"highlight",defaultSelected:""},null,8,["modelValue","appId"])):R("",!0),h("div",{class:"form_pane-right"},[s(je,{modelValue:t.value,onChange:o,load:a,multiple:u.multiple,ref_key:"paneWrapperRef",ref:e},null,8,["modelValue","multiple"])])]))}});const jl=j(Wl,[["__scopeId","data-v-006f4082"]]),Ml=D({__name:"AggregationPane",props:{modelValue:{},appId:{},isAllApp:{type:Boolean},multiple:{type:Boolean},name:{},currentAggregation:{},hideCurrentAggregation:{type:Boolean}},emits:["update:modelValue"],setup(V,{emit:I}){const n=V,d=I,r=b(n.appId??"");Z(()=>n.appId,()=>{n.isAllApp||(r.value=n.appId??"")});const e=re(),p=b(),a=async()=>{var i;const u=(await wa({appId:r.value,name:((i=n.name)==null?void 0:i.trim())??"",current:1,limit:1e3})).records;return u.forEach(l=>{e.aggregateBaseInfo[l.id]=l}),{total:0,records:u.filter(l=>!(n.hideCurrentAggregation&&n.currentAggregation&&l.id===n.currentAggregation)).map(l=>({...l,__id__:l.id??"",__label__:l.name}))}};Z([r,()=>n.name],()=>{var u;(u=p.value)==null||u.refresh()});const c=B({get(){return H(n.modelValue)},set(u){d("update:modelValue",n.multiple?u:u[0])}}),t=B(()=>{const u=c.value.map(i=>i.id);return n.multiple?u:u[0]}),o=(u,i)=>{const l=H(i).filter(k=>!!k),y=H(u).map(k=>{const T=l.find(F=>F.id===k),C=c.value.find(F=>F.id===k);return{...C,id:k,type:te.aggregation,appId:(T==null?void 0:T.appId)??(C==null?void 0:C.appId)}});c.value=y};return(u,i)=>(v(),A("div",{class:"aggregation_pane"},[u.isAllApp?(v(),P(ya,{key:0,modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=l=>r.value=l),class:"aggregation_pane-left",appId:u.appId,type:"highlight",defaultSelected:""},null,8,["modelValue","appId"])):R("",!0),h("div",{class:"aggregation_pane-right"},[s(je,{modelValue:t.value,onChange:o,load:a,multiple:u.multiple,ref_key:"paneWrapperRef",ref:p},null,8,["modelValue","multiple"])])]))}});const Gl=j(Ml,[["__scopeId","data-v-872d61fe"]]),Jl=D({__name:"DialogSelectTabPane",props:{modelValue:{},appId:{},tabsList:{},tabs:{},isAllApp:{type:Boolean},multiple:{type:Boolean},entryProp:{},aggregationProps:{}},emits:["update:modelValue"],setup(V,{emit:I}){const n=V,d=I,r=b(""),e=B(()=>{let t=[];return n.tabsList?t=n.tabsList:n.tabs&&(t=n.tabs.map(o=>Ol.find(u=>u.name===o)).filter(o=>!!o)),t}),p=b();Z(e,()=>{e.value.length&&!e.value.some(t=>t.name===p.value)&&(p.value=e.value[0].name)},{immediate:!0});const a=t=>n.modelValue.filter(o=>o.type===t),c=(t,o)=>{const u=[...H(o)];if(!n.multiple)d("update:modelValue",u);else{const i=[...n.modelValue];Fa(i,l=>l.type===t&&!u.some(y=>y.id===l.id)),u.forEach(l=>{i.some(y=>y.type===l.type&&y.id===l.id)||i.push(l)}),d("update:modelValue",i)}};return(t,o)=>{const u=la,i=ta,l=De,y=pe;return v(),A("div",{class:"select_tab-pane"},[s(be,null,{default:g(()=>[s(ne,null,{default:g(()=>[s(i,{modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=k=>p.value=k),type:"border-card",class:"tab_pane"},{default:g(()=>[(v(!0),A(Q,null,ae(e.value,(k,T)=>(v(),P(u,{key:T,label:k.label,name:k.name,lazy:""},{default:g(()=>[h("div",{class:"tab_pane-content"},[k.name===m(ve).entry?(v(),P(jl,ge({key:0,"model-value":a(m(te).entry),"onUpdate:modelValue":o[0]||(o[0]=C=>c(m(te).entry,C)),appId:t.appId,isAllApp:t.isAllApp,multiple:t.multiple,name:r.value},t.entryProp),null,16,["model-value","appId","isAllApp","multiple","name"])):R("",!0),k.name===m(ve).aggregation?(v(),P(Gl,ge({key:1,"model-value":a(m(te).aggregation),"onUpdate:modelValue":o[1]||(o[1]=C=>c(m(te).aggregation,C)),appId:t.appId,isAllApp:t.isAllApp,multiple:t.multiple,name:r.value},t.aggregationProps),null,16,["model-value","appId","isAllApp","multiple","name"])):R("",!0)])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"]),s(y,{modelValue:r.value,"onUpdate:modelValue":o[3]||(o[3]=k=>r.value=k),class:"tab_pane-search",placeholder:"搜索",clearable:""},{prefix:g(()=>[s(l,{class:"el-input__icon"},{default:g(()=>[s(m(Be))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])}}});const Kl=j(Jl,[["__scopeId","data-v-5d109efa"]]),Hl=D({__name:"SelectedLabel",props:{item:{}},setup(V){return(I,n)=>(v(),A(Q,null,[I.item.type===m(te).entry?(v(),P(fa,{key:0,entryId:I.item.id},null,8,["entryId"])):R("",!0),I.item.type===m(te).aggregation?(v(),P(va,{key:1,id:I.item.id},null,8,["id"])):R("",!0)],64))}}),Ql=D({__name:"BtnDisplay",props:{modelValue:{}},emits:["handleStart","update:modelValue"],setup(V,{emit:I}){const n=V,d=I,r=ke(n,"modelValue",d);return(e,p)=>(v(),A("div",{class:"btn_display"},[s(ga,{text:"选择",setText:"重新选择",isSet:!!m(r).length,class:"wrapper-btn",onClick:p[0]||(p[0]=a=>d("handleStart"))},null,8,["isSet"]),s(We,{list:m(r),"onUpdate:list":p[1]||(p[1]=a=>se(r)?r.value=a:null),itemKey:"id",widthExpansion:"0",style:{"margin-top":"5px"}},{default:g(({element:a})=>[h("div",{class:"btn_display-label"},[s(Hl,{item:a},null,8,["item"])])]),_:1},8,["list"])]))}});const Yl=j(Ql,[["__scopeId","data-v-10a53de2"]]),Xl=D({__name:"DialogSelectWrapper",props:{modelValue:{},isAllApp:{type:Boolean},appId:{},title:{default:"选择"},tabsList:{},tabs:{},multiple:{type:Boolean},isDrag:{type:Boolean,default:!1},entryProp:{},aggregationProps:{}},emits:["update:modelValue"],setup(V,{emit:I}){const n=V,d=I,r=b(!1);re();const e=B({get(){return H(n.modelValue)},set(t){d("update:modelValue",n.multiple?t:t[0])}}),p=b([]),a=()=>{r.value=!0,p.value=e.value},c=()=>{e.value=p.value,r.value=!1};return(t,o)=>{const u=pe,i=ce;return v(),A("div",{class:"dialog_select-wrapper"},[s(Yl,{modelValue:e.value,"onUpdate:modelValue":o[0]||(o[0]=l=>e.value=l),onHandleStart:a},null,8,["modelValue"]),oe(s(u,{"model-value":e.value.length},null,8,["model-value"]),[[de,!1]]),s(_e,{modelValue:r.value,"onUpdate:modelValue":o[3]||(o[3]=l=>r.value=l),title:t.title,"append-to-body":""},{footer:g(()=>[h("div",{class:"select_member-footer"},[h("span",{class:"footer-btns"},[s(i,{onClick:o[2]||(o[2]=l=>r.value=!1)},{default:g(()=>[N("取消")]),_:1}),s(i,{type:"primary",onClick:c},{default:g(()=>[N("确定")]),_:1})])])]),default:g(()=>[s(Kl,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=l=>p.value=l),appId:t.appId,tabsList:t.tabsList,tabs:t.tabs,isAllApp:t.isAllApp,multiple:t.multiple,entryProp:t.entryProp,aggregationProps:t.aggregationProps},null,8,["modelValue","appId","tabsList","tabs","isAllApp","multiple","entryProp","aggregationProps"])]),_:1},8,["modelValue","title"])])}}});const Zl=j(Xl,[["__scopeId","data-v-d7f107b5"]]),et=D({__name:"CascaderEntry",props:{modelValue:{},multiple:{type:Boolean,default:!1},appId:{},isType:{type:Boolean,default:!1},hideCurrentAppId:{type:Boolean,default:!1},type:{},isObject:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(V,{emit:I}){const n=V,d=I,r=re(),e=B({get(){const i=H(n.modelValue).map(l=>Ke(l)?l.entryId:l);return n.multiple?i:i[0]},set(i){const l=H(i).map(y=>{var C;if(!n.isObject)return y;const k=H(n.modelValue).find(F=>Ke(F)&&F.entryId===y),T={...k??{},entryId:y,appId:(k==null?void 0:k.appId)??((C=c.value.get(y))==null?void 0:C.appId)??""};return n.isType&&(T.type=T.appId===n.appId?0:1),T});d("update:modelValue",n.multiple?l:l[0])}}),p=b(!1),a=b([]),c=B(()=>new Map(a.value.map(i=>i.childList??[]).flat().map(i=>[i.id,i]))),t=B(()=>({lazy:!p.value,async lazyLoad(){const l=await r.getAppAndEntryAll();p.value=!0,a.value=l.map(y=>{const k=[];return Ca(y.childList??[],"childList",T=>{k.push({...T,leaf:!0,childList:void 0})}),{...y,childList:k,leaf:!1}})},label:"name",value:"id",children:"childList",multiple:n.multiple,emitPath:!1})),o=B(()=>a.value.filter(i=>!(n.hideCurrentAppId&&i.id===n.appId)).map(i=>{var l;return{...i,name:i.id===n.appId?"当前应用":i.name,childList:(l=i.childList)==null?void 0:l.filter(y=>!(n.type&&!H(n.type).includes(y.type)))}}).sort(i=>i.id===n.appId?-1:0)),u=B(()=>p.value?H(e.value).filter(i=>!c.value.has(i)):[]);return(i,l)=>(v(),P(Fl,{modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=y=>e.value=y),options:o.value,props:t.value,removeOptions:u.value,removeText:"已删除/不可选择"},null,8,["modelValue","options","props","removeOptions"]))}}),at=D({__name:"DataSourcesSet",props:{modelValue:{},aggregate:{},appId:{},aggregateId:{}},emits:["update:modelValue","reset"],setup(V,{emit:I}){const n=V,d=I,r=ue(n,"modelValue",d),e={type:Ie.single},p=b(!1),a=b(X(e)),c={singleEntryId:[{required:!0,message:"请选择",trigger:"change"}],multiples:[{required:!0,message:"请选择",trigger:"change"},{validator(_,w,E){if((w==null?void 0:w.length)<2){E(new Error("至少选择两个表单"));return}E()},trigger:"change"}],link:[{required:!0,message:"请设置关联关系",trigger:"change"}]},t=()=>{a.value=X(r.value??e),p.value=!0},o=()=>{a.value={type:a.value.type}},u=B({get(){var _;return(_=a.value.multiples)==null?void 0:_.map(w=>({id:w.id,type:w.type===U.aggregate?te.aggregation:te.entry}))},set(_){a.value.multiples=_==null?void 0:_.map(w=>({id:w.id,type:w.type===te.aggregation?U.aggregate:U.form,appId:w.appId})),i()}}),i=()=>{var w,E,q;const _=((w=a.value.multiples)==null?void 0:w.map(G=>`${G.id}.${G.type}`))??[];_.length<2?a.value.link=void 0:((E=a.value.link)==null||E.forEach(G=>{G.join=G.join.filter(S=>_.includes(`${S.entryId}.${S.fieldSource??U.form}`)).sort((S,f)=>_.findIndex($=>$===`${S.entryId}.${S.fieldSource??U.form}`)-_.findIndex($=>$===`${f.entryId}.${f.fieldSource??U.form}`))}),(q=a.value.link)!=null&&q.length||l())},l=()=>{var _;a.value.link||(a.value.link=[]),a.value.link.push({fieldId:`_join_${Ae(a.value.link.map(w=>w.fieldId.slice(6)))}`,join:((_=a.value.multiples)==null?void 0:_.map(w=>({entryId:w.id,fieldId:"",fieldType:Y.input,fieldSource:w.type})))??[]})},y=(_,w)=>`link.${w}.join.${_}.fieldId`,k=(_,w,E)=>{var S,f,$,L;const q=w===0?[]:He((L=($=(f=(S=a.value.link)==null?void 0:S[E])==null?void 0:f.join)==null?void 0:$[0])==null?void 0:L.fieldType),G=new Set(q.length?q:xa);return Ea(_,{blockFilter(z){return z.type===Y.subform},excludeFilter(z){return!G.has(z.type)}})},T=_=>{var w;(w=a.value.link)==null||w.splice(_,1)},C=(_,w)=>{var q;const E=(q=a.value.link)==null?void 0:q[w];if(E)return E.join[_]},F=(_,w,E)=>{var S,f;const q=(S=a.value.link)==null?void 0:S[w];if(!q)return;const G=(f=q.join[_])==null?void 0:f.fieldType;if(q.join[_]={fieldId:E.fieldId,entryId:E.entryId||E.aggregateId,fieldType:E.fieldType,fieldSource:E.aggregateId?U.aggregate:U.form},_===0){const $=E.fieldType;He($).includes(G)||q.join.splice(1,q.join.length-1)}},O=b(),W=async()=>{var _,w;await((w=(_=O.value)==null?void 0:_.ruleFormRef)==null?void 0:w.validate()),r.value&&!Re(r.value,a.value)?Se.confirm("修改数据来源设置会清空已有的配置，是否确认修改?","您确定要修改数据来源吗?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var q;const E=X(a.value);E.link=(q=E.link)==null?void 0:q.map(G=>{var S;return{...G,fieldId:`_join_${Ae((S=E.link)==null?void 0:S.map(f=>f.fieldId.slice(6)))}`}}),r.value=E,p.value=!1,d("reset")}):(r.value||(r.value=X(a.value)),p.value=!1)},M=re(),{addRule:K}=na();return K({validator(_,w,E){ql({appId:n.appId,dataSystem:M,dataSources:r.value}).then(q=>q?E():E(new Error("配置异常"))).catch(q=>{console.warn("验证过程中异常",q),E()})},trigger:"change"}),(_,w)=>{const E=pe,q=qe,G=oa,S=Oe,f=ce;return v(),A("div",null,[s(ga,{text:"添加",isSet:!!m(r),onClick:t},null,8,["isSet"]),oe(s(E,{"model-value":JSON.stringify(m(r)??"")},null,8,["model-value"]),[[de,!1]]),s(_e,{modelValue:p.value,"onUpdate:modelValue":w[4]||(w[4]=$=>p.value=$),"append-to-body":"",title:"数据来源","destroy-on-close":"","close-on-click-modal":!1},{footer:g(()=>[h("span",{class:"dialog-footer"},[s(f,{onClick:w[3]||(w[3]=$=>p.value=!1)},{default:g(()=>[N("取消")]),_:1}),s(f,{type:"primary",onClick:W},{default:g(()=>[N("确定")]),_:1})])]),default:g(()=>[s(be,{model:a.value,rules:c,"label-position":"top",ref_key:"azFormRef",ref:O},{default:g(()=>{var $;return[s(S,{label:"类型"},{default:g(()=>[s(G,{modelValue:a.value.type,"onUpdate:modelValue":w[0]||(w[0]=L=>a.value.type=L),onChange:o},{default:g(()=>[(v(!0),A(Q,null,ae(m(Aa),L=>(v(),P(q,{key:L.value,label:L.value},{default:g(()=>[N(le(L.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a.value.type===m(Ie).single?(v(),P(ne,{key:0,label:"选择表单",prop:"singleEntryId"},{default:g(()=>[s(et,{modelValue:a.value.singleEntryId,"onUpdate:modelValue":w[1]||(w[1]=L=>a.value.singleEntryId=L),style:{"max-width":"350px"},appId:_.appId,type:m(Te).form,isObject:!1},null,8,["modelValue","appId","type"])]),_:1})):R("",!0),a.value.type===m(Ie).multiplePlus?(v(),A(Q,{key:1},[s(ne,{label:"选择表单",prop:"multiples"},{default:g(()=>[s(Zl,{modelValue:u.value,"onUpdate:modelValue":w[2]||(w[2]=L=>u.value=L),style:{width:"50%"},isAllApp:"",isDrag:"",appId:_.appId,tabsList:[{label:"表单",name:m(ve).entry},{label:"聚合表",name:m(ve).aggregation}],title:"选择数据来源",entryProp:{type:m(Te).form},aggregationProps:{currentAggregation:_.aggregateId??"",hideCurrentAggregation:!0},multiple:""},null,8,["modelValue","appId","tabsList","entryProp","aggregationProps"])]),_:1}),((($=a.value.multiples)==null?void 0:$.length)??0)>1?(v(),P(ne,{key:0,label:"设置关联关系",prop:"link"},{default:g(()=>{var L,z;return[(L=a.value.link)!=null&&L.length?(v(),A("div",{key:0,class:"source-link"},[h("div",{class:"link-left"},[(v(!0),A(Q,null,ae(a.value.multiples,(x,J)=>(v(),A("div",{key:x.id+x.type,class:"link-column"},[h("div",{style:{width:"100%",height:"32px"}},[x.type===m(U).form?(v(),P(fa,{key:0,"entry-id":x.id,style:$e({"max-width":J===0?"calc(100% - 70px)":"100%"})},null,8,["entry-id","style"])):R("",!0),x.type===m(U).aggregate?(v(),P(va,{key:1,id:x.id,style:$e({"max-width":J===0?"calc(100% - 70px)":"100%"})},null,8,["id","style"])):R("",!0),J===0?(v(),A("span",{key:2},"(核心表)")):R("",!0)]),(v(!0),A(Q,null,ae(a.value.link,(ee,Ve)=>{var Ge;return v(),A("div",{key:ee.fieldId,class:"link-field"},[s(ne,{"hide-label":"",prop:y(J,Ve),rules:[{required:!0,message:"请选择",trigger:"change"}]},{default:g(()=>{var Je;return[s(Ta,{"model-value":C(J,Ve),"onUpdate:modelValue":we=>F(J,Ve,we),prop:{fieldId:"fieldId",fieldType:"fieldType",entryId:"entryId",aggregateId:"aggregateId"},filter:we=>k(we,J,Ve),disabled:J!==0&&!((Je=ee.join[0])!=null&&Je.fieldId),style:{width:"150px"},entryId:x.type===m(U).form?x.id:void 0,aggregateId:x.type===m(U).aggregate?x.id:void 0},null,8,["model-value","onUpdate:modelValue","filter","disabled","entryId","aggregateId"])]}),_:2},1032,["prop"]),J!==(((Ge=a.value.multiples)==null?void 0:Ge.length)??0)-1?(v(),A("span",{key:0,class:"field-operator"}," = ")):R("",!0)])}),128))]))),128))]),h("div",{class:"link-right"},[(v(!0),A(Q,null,ae(a.value.link,(x,J)=>(v(),A("div",{class:"link-right-icon",key:J,onClick:ee=>T(J)},[s(f,{type:"danger",icon:m($a),link:"",disabled:a.value.link.length<2},null,8,["icon","disabled"])],8,["onClick"]))),128))])])):R("",!0),s(f,{link:"",icon:m(he),type:"primary",onClick:l},{default:g(()=>[N(" 添加 ")]),_:1},8,["icon"]),oe(s(E,{modelValue:(z=a.value.link)!=null&&z.length?"1":"2"},null,8,["modelValue"]),[[de,!1]])]}),_:1})):R("",!0)],64)):R("",!0)]}),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const lt=j(at,[["__scopeId","data-v-91d366b8"]]),Ia=D({__name:"ButtonSelectFieldByMultEntry",props:{placeholder:{default:"选择控件"},disabled:{type:Boolean},filterOptions:{},filter:{},prop:{},buttonProps:{},entryInfo:{}},setup(V){const I=V;return(n,d)=>{const r=ce;return v(),P(Cl,ge(I,{entryInfo:n.entryInfo}),La({reference:g(()=>[s(r,ge({class:"w100",icon:m(Ua),disabled:n.disabled},n.buttonProps),{default:g(()=>[N(le(n.placeholder),1)]),_:1},16,["icon","disabled"])]),_:2},[n.$slots.fieldTip?{name:"fieldTip",fn:g(({field:e})=>[Ce(n.$slots,"fieldTip",{field:e})]),key:"0"}:void 0]),1040,["entryInfo"])}}}),tt=D({__name:"SelectGroupField",props:{modelValue:{},aggregate:{},disabled:{type:Boolean},clientIds:{},sources:{}},emits:["update:modelValue"],setup(V,{emit:I}){const n=V,d=I,r=B({get(){return H(n.modelValue).map(e=>({...e,entryId:e.fieldSource===U.aggregate?void 0:e.entryId,aggregateId:e.fieldSource===U.aggregate?e.entryId:void 0}))},set(e){const p=(e==null?void 0:e.map(a=>{const c={...a,fieldSource:a.aggregateId?U.aggregate:U.form,entryId:(a.entryId||a.aggregateId)??"",clienId:a.clienId??ze(a.fieldType,{fieldIds:n.clientIds})};return c.options=c.options??_a(c),"aggregateId"in c&&delete c.aggregateId,c}))??[];d("update:modelValue",p)}});return(e,p)=>(v(),A("div",null,[s(Ia,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=a=>r.value=a),prop:{fieldId:"fieldId",entryId:"entryId",fieldType:"fieldType",aggregateId:"aggregateId"},"entry-info":{sources:e.sources.map(a=>({id:a.id,type:a.type===m(U).aggregate?m(me).aggregation:m(me).entry}))},buttonProps:{icon:m(he),link:!0,type:"primary"},filter:m(Pa),placeholder:"添加字段",multiple:"",disabled:e.disabled,isAll:""},null,8,["modelValue","entry-info","buttonProps","filter","disabled"])]))}}),nt=D({__name:"SelectAggregateField",props:{modelValue:{},aggregate:{},disabled:{type:Boolean},clientIds:{},sources:{}},emits:["update:modelValue"],setup(V,{emit:I}){const n=V,d=I,r=B({get(){return H(n.modelValue).filter(e=>!!e.entryId).map(e=>({...e,entryId:e.fieldSource===U.aggregate?void 0:e.entryId,aggregateId:e.fieldSource===U.aggregate?e.entryId:void 0}))},set(e){var c;const p=new Set(((c=n.modelValue)==null?void 0:c.map(t=>`${t.entryId}.${t.fieldId}`))??[]),a=new Set((e==null?void 0:e.map(t=>`${t.entryId||t.aggregateId}.${t.fieldId}`))??[]);d("update:modelValue",[...(n.modelValue??[]).filter(t=>!t.entryId||a.has(`${t.entryId}.${t.fieldId}`)),...(e??[]).filter(t=>!p.has(`${t.entryId||t.aggregateId}.${t.fieldId}`)).map(t=>({...t,entryId:(t.entryId||t.aggregateId)??"",fieldSource:t.aggregateId?U.aggregate:U.form,clienId:t.clienId??ze(t.fieldType,{fieldIds:n.clientIds}),manner:t.manner??qa.sum}))])}});return(e,p)=>(v(),A("div",null,[s(Ia,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=a=>r.value=a),prop:{fieldId:"fieldId",entryId:"entryId",fieldType:"fieldType",aggregateId:"aggregateId"},"entry-info":{sources:e.sources.map(a=>({id:a.id,type:a.type===m(U).aggregate?m(me).aggregation:m(me).entry}))},buttonProps:{icon:m(he),link:!0,type:"primary"},"filter-options":{blockFilter(a,c,t){return a.type===m(Y).subform},excludeFilter(a,c,t){return!m(Ba).includes(a.type)}},placeholder:"添加字段",multiple:"",disabled:e.disabled,isAll:""},null,8,["modelValue","entry-info","buttonProps","filter-options","disabled"])]))}}),ot=D({__name:"AzNumDataFormat",props:{visible:{type:Boolean},dataFormat:{}},emits:["update:visible","update:dataFormat","confirm"],setup(V,{emit:I}){const n=V,d=I,r=ue(n,"visible",d),e=b(Qe());Z(r,i=>{i&&(e.value=X(n.dataFormat??Qe()))},{immediate:!0});const p=()=>{e.value.isNumberLevel=void 0,e.value.unit=void 0,e.value.isTextUnit=void 0,e.value.textUnit=void 0},a=i=>{e.value.toPrecision=i?2:void 0},c=i=>{e.value.unit=i?Ye[0].value:void 0},t=i=>{e.value.textUnit=i?"":void 0},o=B(()=>Da(99999999,e.value)),u=()=>{const i=X(e.value);d("update:dataFormat",i),d("confirm",i),r.value=!1};return(i,l)=>{const y=qe,k=oa,T=Oe,C=aa,F=Tl,O=sa,W=ra,M=pe,K=ce;return v(),P(_e,{modelValue:m(r),"onUpdate:modelValue":l[9]||(l[9]=_=>se(r)?r.value=_:null),"destroy-on-close":"","append-to-body":"",title:"数据格式",width:"500px"},{footer:g(()=>[h("span",{class:"dialog-footer"},[s(K,{onClick:l[8]||(l[8]=_=>r.value=!1)},{default:g(()=>[N("取消")]),_:1}),s(K,{type:"primary",onClick:u},{default:g(()=>[N("确定")]),_:1})])]),default:g(()=>[s(be,null,{default:g(()=>[s(T,{label:"显示格式"},{default:g(()=>[s(k,{modelValue:e.value.format,"onUpdate:modelValue":l[0]||(l[0]=_=>e.value.format=_),onChange:p},{default:g(()=>[(v(!0),A(Q,null,ae(m(Ra),_=>(v(),P(y,{key:_.value,label:_.value},{default:g(()=>[N(le(_.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(T,{label:"显示设置"},{default:g(()=>[h("div",null,[h("div",{class:"center"},[s(C,{modelValue:e.value.isThousandth,"onUpdate:modelValue":l[1]||(l[1]=_=>e.value.isThousandth=_),label:"千分符"},null,8,["modelValue"])]),h("div",{class:"center"},[s(C,{modelValue:e.value.isPrecision,"onUpdate:modelValue":l[2]||(l[2]=_=>e.value.isPrecision=_),onChange:a,class:"mr-10",label:"小数位数"},null,8,["modelValue"]),e.value.isPrecision?(v(),P(F,{key:0,modelValue:e.value.toPrecision,"onUpdate:modelValue":l[3]||(l[3]=_=>e.value.toPrecision=_),min:0,max:9,style:{width:"220px"},"controls-position":"right"},null,8,["modelValue"])):R("",!0)]),e.value.format===m(Oa).number?(v(),A(Q,{key:0},[h("div",{class:"center"},[s(C,{modelValue:e.value.isNumberLevel,"onUpdate:modelValue":l[4]||(l[4]=_=>e.value.isNumberLevel=_),class:"mr-10",onChange:c,label:"数值量级"},null,8,["modelValue"]),e.value.isNumberLevel?(v(),P(W,{key:0,modelValue:e.value.unit,"onUpdate:modelValue":l[5]||(l[5]=_=>e.value.unit=_),style:{width:"220px"}},{default:g(()=>[(v(!0),A(Q,null,ae(m(Ye),_=>(v(),P(O,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):R("",!0)]),h("div",{class:"center"},[s(C,{modelValue:e.value.isTextUnit,"onUpdate:modelValue":l[6]||(l[6]=_=>e.value.isTextUnit=_),class:"mr-10",onChange:t,label:"显示单位"},null,8,["modelValue"]),e.value.isTextUnit?(v(),P(M,{key:0,style:{width:"220px"},modelValue:e.value.textUnit,"onUpdate:modelValue":l[7]||(l[7]=_=>e.value.textUnit=_),placeholder:"请输入单位,如个、元等"},null,8,["modelValue"])):R("",!0)])],64)):R("",!0)])]),_:1}),h("div",{class:"format-view"},le(o.value),1)]),_:1})]),_:1},8,["modelValue"])}}});const st=j(ot,[["__scopeId","data-v-21f5268d"]]),rt=D({__name:"AggregateFieldSet",props:{modelValue:{},aggregate:{},computedFields:{}},emits:["update:modelValue","aliasSet","compuedSet"],setup(V,{emit:I}){const n=V,d=I,r=ke(n,"modelValue",d),e=(o,u)=>{const i=[{id:"3",text:"数据格式",onClick(){c.value=!0,p.value=u,a.value=X(o.format)}}];return o.fieldType===Y.compute&&!o.entryId?i.unshift({id:"4",text:"编辑",onClick(){d("compuedSet",u)}}):i.unshift({id:"1",text:"重命名",onClick(){d("aliasSet",o)}},{text:"聚合方式",id:"2",sonClickNoHide:!0,children:za.map(l=>({id:l.value,text:l.label,selected:o.manner===l.value,onClick(){o.manner=l.value}}))}),i},p=b(0),a=b(),c=b(!1),t=o=>{r.value&&r.value[p.value]&&(r.value[p.value].format=o)};return(o,u)=>{const i=Ne;return v(),A(Q,null,[s(We,{"model-value":m(r)??[],isEmpty:"",itemKey:"fieldId"},{default:g(({element:l,index:y})=>[s(fe,{class:"az-input-prefix az-flex-width",readonly:""},{prefix:g(()=>[s(da,{isEntryName:"","field-id":l.fieldId,"entry-id":l.fieldSource===m(U).aggregate?void 0:l.entryId,aggregateId:l.fieldSource===m(U).aggregate?l.entryId:void 0,fields:l.fieldType===m(Y).compute&&!l.entryId?o.computedFields:void 0,class:"color-text"},null,8,["field-id","entry-id","aggregateId","fields"])]),_:2},1024),l.alias?(v(),P(fe,{key:0,class:"az-input-prefix",readonly:"",style:{"max-width":"120px"}},{prefix:g(()=>[s(Ue,{style:{color:"var(--el-text-color-primary)"},content:l.alias},null,8,["content"])]),_:2},1024)):R("",!0),s(ia,{list:e(l,y),num:0},{default:g(()=>[s(i,{underline:!1,title:"设置",icon:m(ua),style:{"font-size":"16px","margin-top":"-2px"}},null,8,["icon"])]),_:2},1032,["list"])]),_:1},8,["model-value"]),s(st,{visible:c.value,"onUpdate:visible":u[0]||(u[0]=l=>c.value=l),"data-format":a.value,"onUpdate:dataFormat":u[1]||(u[1]=l=>a.value=l),onConfirm:t},null,8,["visible","data-format"])],64)}}}),dt=D({__name:"ComputeFieldSet",props:{modelValue:{},title:{default:"添加计算字段"}},emits:["update:modelValue","confirm"],setup(V,{expose:I,emit:n}){const e=ke(V,"modelValue",n),p=b(),a=b(),c=(o,u)=>{e.value={...e.value,[u]:o}},t={label:[{required:!0,message:"请输入",trigger:"change"}],dataType:[{required:!0,message:"请选择",trigger:"change"}],formula:[{required:!0,message:"请输入",trigger:"change"}]};return I({async validate(){var o,u,i;await Promise.all([(u=(o=p.value)==null?void 0:o.ruleFormRef)==null?void 0:u.validate(),(i=a.value)==null?void 0:i.validate()])},clearValidate(){var o,u;return(u=(o=p.value)==null?void 0:o.ruleFormRef)==null?void 0:u.clearValidate()}}),(o,u)=>{const i=pe,l=Oe,y=sa,k=ra;return v(),P(be,{model:m(e),rules:t,"label-position":"top",ref_key:"azFormRef",ref:p},{default:g(()=>{var T;return[h("div",{class:"inline"},[s(l,{label:"字段名称",prop:"label"},{default:g(()=>{var C;return[s(i,{placeholder:"请输入",modelValue:(C=m(e))==null?void 0:C.label,maxlength:"30","onUpdate:modelValue":u[0]||(u[0]=F=>c(F,"label"))},null,8,["modelValue"])]}),_:1}),s(l,{label:"字段类型",prop:"dataType"},{default:g(()=>{var C;return[s(k,{modelValue:(C=m(e))==null?void 0:C.dataType,"onUpdate:modelValue":u[1]||(u[1]=F=>c(F,"dataType")),placeholder:"请选择"},{default:g(()=>[(v(!0),A(Q,null,ae(m(Na),(F,O)=>(v(),P(y,{key:O,label:F.label,value:F.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]}),_:1})]),s(ne,{label:"计算公式",style:{"margin-bottom":"0"},required:""}),h("div",{class:"w100"},[s($l,ge({ref_key:"formulaRef",ref:a,style:{height:"45vh"},modelValue:((T=m(e))==null?void 0:T.formula)??"","onUpdate:modelValue":u[2]||(u[2]=C=>c(C,"formula")),mode:m(Wa).server,scenes:[m(ja).aggregationMethod]},o.$attrs),null,16,["modelValue","mode","scenes"])]),s(l,{prop:"formula"},{default:g(()=>{var C;return[oe(s(i,{modelValue:(C=m(e))==null?void 0:C.formula},null,8,["modelValue"]),[[de,!1]])]}),_:1})]}),_:1},8,["model"])}}});const it=j(dt,[["__scopeId","data-v-a3708b90"]]),ut=D({__name:"ComputeFieldSetDialog",props:{visible:{type:Boolean},modelValue:{},title:{default:"添加计算字段"}},emits:["update:visible","update:modelValue","confirm"],setup(V,{emit:I}){const n=V,d=I,r=b(),e=ue(n,"visible",d),p=b(X(n.modelValue));Z([()=>n.modelValue,()=>n.visible],()=>{n.visible&&(p.value=X(n.modelValue??{}),setTimeout(()=>{var c;(c=r.value)==null||c.clearValidate()},100))});const a=async()=>{var t;await((t=r.value)==null?void 0:t.validate());const c=X(p.value);c&&(d("update:modelValue",c),d("confirm",c),e.value=!1)};return(c,t)=>{const o=ce;return v(),P(_e,{modelValue:m(e),"onUpdate:modelValue":t[2]||(t[2]=u=>se(e)?e.value=u:null),title:c.title,width:"950",appendToBody:"","close-on-click-modal":!1},{footer:g(()=>[h("span",{class:"dialog-footer"},[s(o,{onClick:t[1]||(t[1]=u=>e.value=!1)},{default:g(()=>[N("取消")]),_:1}),s(o,{type:"primary",onClick:a},{default:g(()=>[N("确定")]),_:1})])]),default:g(()=>[s(it,ge({ref_key:"computeFieldSetRef",ref:r,modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=u=>p.value=u)},c.$attrs),null,16,["modelValue"])]),_:1},8,["modelValue","title"])}}}),pt=D({__name:"GroupFieldSet",props:{modelValue:{},aggregate:{}},emits:["update:modelValue","aliasSet","compuedSet"],setup(V,{emit:I}){const n=V,d=I,r=ke(n,"modelValue",d),e=(p,a)=>{const c=[{id:"1",text:"重命名",onClick(){d("aliasSet",p)}}],t=Rl(p);return t.length&&c.push({text:"分组方式",id:"2",sonClickNoHide:!0,children:t.map(o=>{var u;return{id:o.value,text:o.label,selected:((u=Bl(p))==null?void 0:u.groupUnit)===o.value,onClick(){p.options={...p.options??{},groupUnit:o.value}}}})}),c};return(p,a)=>{const c=Ne;return v(),P(We,{list:m(r),"onUpdate:list":a[0]||(a[0]=t=>se(r)?r.value=t:null),isEmpty:""},{default:g(({element:t,index:o})=>[s(fe,{class:"az-input-prefix az-flex-width",readonly:""},{prefix:g(()=>[s(da,{isEntryName:"","field-id":t.fieldId,"entry-id":t.fieldSource===m(U).aggregate?void 0:t.entryId,aggregateId:t.fieldSource===m(U).aggregate?t.entryId:void 0,class:"color-text"},null,8,["field-id","entry-id","aggregateId"])]),_:2},1024),t.alias?(v(),P(fe,{key:0,class:"az-input-prefix",readonly:"",style:{"max-width":"120px"}},{prefix:g(()=>[s(Ue,{style:{color:"var(--el-text-color-primary)"},content:t.alias},null,8,["content"])]),_:2},1024)):R("",!0),s(ia,{list:e(t,o),num:0},{default:g(()=>[s(c,{underline:!1,title:"设置",icon:m(ua),style:{"font-size":"16px"}},null,8,["icon"])]),_:2},1032,["list"])]),_:1},8,["list"])}}}),xe=[{name:"select"},{name:"from"},{name:"where"},{name:"and"},{name:"or"},{name:"not"},{name:"in"},{name:"between"},{name:"join"},{name:"group by"},{name:"order by"},{name:"limit"},{name:"distinct"},{name:"union"}],Ee=[{name:"count",tip:"计数"},{name:"sum",tip:"求和"},{name:"max",tip:"最大值"},{name:"min",tip:"最小值"},{name:"avg",tip:"平均值"}],ct=/\$([^$]+-[^$]+)\$/g,ba="form",Le="field",Me=[{id:ba,entryOptions:{}},{id:Le,fieldOptions:{isExtractEntryId:!0,isDisplayEntryName:!0}}],Ze=V=>Ma(V,{group:Me}),mt=D({__name:"index",emits:["select"],setup(V,{emit:I}){const n=I,d=p=>{n("select",p)},r=b(""),e=B(()=>r.value.trim()?xe.filter(p=>p.name.toLocaleLowerCase().includes(r.value.trim().toLocaleLowerCase())):xe);return(p,a)=>{var t;const c=pe;return v(),A("div",{class:"sql-keywords"},[s(c,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=o=>r.value=o),class:"keywords-search",placeholder:"搜索关键字","prefix-icon":m(Be),clearable:""},null,8,["modelValue","prefix-icon"]),h("div",{class:"keywords-container"},[h("ul",{class:"keywords-list"},[(v(!0),A(Q,null,ae(e.value,o=>(v(),A("li",{key:o.name,onClick:u=>d(o.name),class:"keywords-item"},le(o.name),9,["onClick"]))),128)),(t=e.value)!=null&&t.length?R("",!0):(v(),A("li",{key:0,class:"keywords-empty"},"没有对应的关键字"))])])])}}});const gt=j(mt,[["__scopeId","data-v-1061d1ea"]]),ft=D({__name:"index",props:{appId:{}},emits:["select"],setup(V,{emit:I}){const n=I,d=r=>{n("select",r)};return(r,e)=>(v(),A("div",{class:"sql-form"},[s(Ga,{type:[m(Te).form],appIds:r.appId,hideNonOption:"",optionMinHeight:"40px",isSelect:!1,onClickMenu:d},null,8,["type","appIds"])]))}});const vt=j(ft,[["__scopeId","data-v-3614cc40"]]),_t=D({__name:"index",props:{appId:{}},emits:["select"],setup(V,{emit:I}){const n=I,d=b(),r=b(),e=B(()=>{var c;return(c=r.value)==null?void 0:c.list});Z(()=>e.value,()=>{var c,t,o;(!d.value||!((c=e.value)!=null&&c.some(u=>u.id!==d.value)))&&(d.value=((o=(t=e.value)==null?void 0:t[0])==null?void 0:o.id)??"")},{immediate:!0});const p=c=>Qa(c,{isSubform:!0}),a=(c,t)=>{n("select",c,t)};return(c,t)=>(v(),A("div",{class:"sql-field"},[h("div",{class:"field-entry"},[s(El,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o),appId:c.appId,ref_key:"selectFormRef",ref:r},null,8,["modelValue","appId"])]),d.value?(v(),P(Ha,{key:0,class:"az-flex-height",onClickField:a,entryId:d.value,filter:p,"is-select":!1},{append:g(({field:o})=>[h("span",{class:"sql-field-type",style:$e(m(Ja)(o))},le(m(Ka)(o)),5)]),_:1},8,["entryId"])):R("",!0)]))}});const yt=j(_t,[["__scopeId","data-v-57875e6b"]]),It=D({__name:"index",emits:["select"],setup(V,{emit:I}){const n=I,d=p=>{n("select",p)},r=b(""),e=B(()=>r.value.trim()?Ee.filter(p=>p.name.toLocaleLowerCase().includes(r.value.trim().toLocaleLowerCase())):Ee);return(p,a)=>{var t;const c=pe;return v(),A("div",{class:"sql-aggregation"},[s(c,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=o=>r.value=o),class:"aggregation-search",placeholder:"搜索聚合函数","prefix-icon":m(Be),clearable:""},null,8,["modelValue","prefix-icon"]),h("div",{class:"aggregation-container"},[h("ul",{class:"aggregation-list"},[(v(!0),A(Q,null,ae(e.value,o=>(v(),A("li",{key:o.name,onClick:u=>d(o.name),class:"aggregation-item"},[h("div",null,le(o.name),1),h("div",{class:"aggregation-label"},le(o.tip),1)],8,["onClick"]))),128)),(t=e.value)!=null&&t.length?R("",!0):(v(),A("li",{key:0,class:"aggregation-empty"}," 没有对应的聚合函数 "))])])])}}});const bt=j(It,[["__scopeId","data-v-ce71e17a"]]),Vt=D({__name:"CodeWrapper",props:{modelValue:{},preview:{type:Boolean}},emits:["update:modelValue"],setup(V,{expose:I,emit:n}){const e=ue(V,"modelValue",n),p=re(),a=b(),c=[Ya.lineWrapping,Xa(),Ll(),Za(),el.of([...Ul,...al]),xl(B(()=>[...xe.map(l=>({name:l.name,color:"#b15ef2"})),...Ee.map(l=>({name:l.name,color:"#c643e0",suffix:"("}))]))],t=b(),o=async l=>{var F;const{domId:y,contentId:k,groupItem:T}=l,C=await tl({contentId:k,dataSystem:p,groupItem:T});if(C){const O=(F=t.value)==null?void 0:F.querySelector(`#${y}`);O&&(T.id===Le?O.classList.add(C.isError?"field-widget-remove":"field-widget"):O.classList.add(C.isError?"form-widget-remove":"form-widget"),O.innerText=C.label)}},i=[{format:l=>{const{contentId:y,groupItem:k}=Ze(l),T=`field-${Ae()}`;return k?(o({text:l,domId:T,groupItem:k,contentId:y}),{dom:`<span id="${T}"></span>`}):""},regexp:ct,validate(l){const{groupItem:y}=Ze(l);if(!y)return!1}}];return I({addKey(l){var y;(y=a.value)==null||y.insert(`${l}`)},addForm(l){var y;(y=a.value)==null||y.insert(`$${ba}-${l.id}$`)},addField(l){var y;(y=a.value)==null||y.insert(`$${Le}-${l.entryId}.${l.fieldId}$`)},addAggregation(l){var y;(y=a.value)==null||y.insert(`${l}()`,k=>k-1)},cursorPosition:B(()=>{var l;return(l=a.value)==null?void 0:l.cursorPosition})}),(l,y)=>(v(),A("div",{class:Pe(["sql-code",{"is-preview":l.preview}]),ref_key:"CodeWrapperRef",ref:t},[s(m(ll),{modelValue:m(e),"onUpdate:modelValue":y[0]||(y[0]=k=>se(e)?e.value=k:null),ref_key:"CodeEditorRef",ref:a,style:{width:"100%",height:"100%"},widgetOptions:i,customBasicSetup:c,preview:l.preview,placeholder:"请输入sql语句"},null,8,["modelValue","preview"])],2))}});const Va=j(Vt,[["__scopeId","data-v-31b34b88"]]),St=D({__name:"CustomSql",props:{modelValue:{},appId:{}},emits:["update:modelValue"],setup(V,{expose:I,emit:n}){const e=ue(V,"modelValue",n),p=re(),a=b(),c=i=>{var l;(l=a.value)==null||l.addKey(i)},t=i=>{var l;(l=a.value)==null||l.addForm(i)},o=i=>{var l;(l=a.value)==null||l.addField(i)},u=i=>{var l;(l=a.value)==null||l.addAggregation(i)};return I({validate(){return pa({dataSystem:p,group:Me,value:e.value??""})}}),(i,l)=>{const y=la,k=ta;return v(),A("div",{class:"sql-container"},[s(k,{class:"sql-tabs",type:"border-card",tabPosition:"left"},{default:g(()=>[s(y,{label:"关键字"},{default:g(()=>[s(gt,{class:"sql-pane",onSelect:c})]),_:1}),s(y,{label:"表"},{default:g(()=>[s(vt,{class:"sql-pane",appId:i.appId,onSelect:t},null,8,["appId"])]),_:1}),s(y,{label:"字段"},{default:g(()=>[s(yt,{class:"sql-pane",appId:i.appId,onSelect:o},null,8,["appId"])]),_:1}),s(y,{label:"聚合"},{default:g(()=>[s(bt,{class:"sql-pane",onSelect:u})]),_:1})]),_:1}),h("div",{class:"sql-right"},[h("div",{class:"sql-code"},[s(Va,{modelValue:m(e),"onUpdate:modelValue":l[0]||(l[0]=T=>se(e)?e.value=T:null),ref_key:"CodeWrapperRef",ref:a},null,8,["modelValue"])])])])}}});const kt=j(St,[["__scopeId","data-v-352ad748"]]),ht=D({__name:"CustomSqlDialog",props:{visible:{type:Boolean,default:!0},confirm:{},modelValue:{}},emits:["update:visible","update:modelValue"],setup(V,{emit:I}){const n=V,d=I,r=ue(n,"visible",d),e=b(n.modelValue??""),p=b();Z([()=>n.modelValue,()=>n.visible],()=>{n.visible&&(e.value=n.modelValue??"")});const a=b(!1),c=async()=>{var t,o;a.value=!0;try{await((t=p.value)==null?void 0:t.validate()),await((o=n.confirm)==null?void 0:o.call(n,e.value??""))}catch(u){typeof u=="string"&&ca.error(u);return}finally{a.value=!1}d("update:modelValue",e.value??""),r.value=!1};return(t,o)=>{const u=ce;return v(),P(_e,{modelValue:m(r),"onUpdate:modelValue":o[2]||(o[2]=i=>se(r)?r.value=i:null),title:"自定义SQL脚本",width:"950",class:"sql-dialog",appendToBody:"","close-on-click-modal":!1},{footer:g(()=>{var i;return[h("span",{class:"dialog-footer"},[s(u,{onClick:o[1]||(o[1]=l=>r.value=!1)},{default:g(()=>[N("取消")]),_:1}),s(u,{type:"primary",onClick:c,loading:a.value,disabled:!((i=e.value)!=null&&i.trim())},{default:g(()=>[N(" 确定 ")]),_:1},8,["loading","disabled"])])]}),default:g(()=>[s(kt,ge({ref_key:"customSqlRef",ref:p,modelValue:e.value,"onUpdate:modelValue":o[0]||(o[0]=i=>e.value=i)},t.$attrs),null,16,["modelValue"])]),_:1},8,["modelValue"])}}});const wt=j(ht,[["__scopeId","data-v-63fbe2e6"]]),Ft=D({__name:"CustomSqlView",props:{sql:{default:""}},setup(V){const I=V,n=re(),{addRule:d}=na();return d({validator(r,e,p){pa({dataSystem:n,group:Me,value:I.sql??""}).then(()=>p()).catch(a=>{typeof a=="string"?p(new Error(a)):p()})},trigger:"change"}),(r,e)=>(v(),A("div",null,[s(Va,{modelValue:r.sql,preview:""},null,8,["modelValue"])]))}}),Ct=D({name:"AggregateDesigner",__name:"index",props:{appId:{},options:{},aggregateId:{}},setup(V,{expose:I}){const n=V;re();const d=b(ye()),r=B(()=>{var f,$;let S=((f=d.value.dataSources)==null?void 0:f.multiples)??[];return(($=d.value.dataSources)==null?void 0:$.type)===Ie.single&&d.value.dataSources.singleEntryId&&(S=[{id:d.value.dataSources.singleEntryId,type:U.form}]),S}),e={dataSources:[{required:!0,message:"该项为必填项",trigger:"change"}],groupFields:[{required:!0,message:"该项为必填项",trigger:"change"}],aggregateFields:[{required:!0,message:"该项为必填项",trigger:"change"}]};Z(()=>n.options,(S,f)=>{Re(S,f)||(d.value=X(S??ye()))},{immediate:!0});const p=()=>{d.value={...ye(),dataSources:d.value.dataSources}},a=B(()=>[...d.value.groupFields??[],...d.value.aggregateFields??[]].map(S=>S.clienId)),c=B(()=>{var f,$,L;const S=[];return((f=d.value.dataSources)==null?void 0:f.type)===Ie.single?d.value.dataSources.singleEntryId&&S.push({id:d.value.dataSources.singleEntryId,type:me.entry}):S.push(...((L=($=d.value.dataSources)==null?void 0:$.multiples)==null?void 0:L.map(z=>({id:z.id,type:z.type===U.aggregate?me.aggregation:me.entry})))??[]),S}),t=b(!1),o=b("");let u;const i=S=>{u=S,o.value=u.alias??"",t.value=!0},l=()=>{u&&(u.alias=o.value),t.value=!1},y=b(!1),k=b(),T=b(),C=B(()=>(d.value.aggregateFields??[]).map(S=>{var f;return nl(Y.compute,{fieldId:S.fieldId,options:{label:((f=S.computeOptions)==null?void 0:f.label)??""}})}).filter(S=>!!S)),F=S=>{var f;T.value=S,k.value=S==null?{dataType:ol.num}:(f=d.value.aggregateFields)==null?void 0:f[S].computeOptions,y.value=!0},O=B(()=>r.value.map(S=>({id:S.id,fieldOptions:{entryId:S.type===U.aggregate?void 0:S.id,aggregateId:S.type===U.aggregate?S.id:void 0}}))),W=S=>{var f;if(T.value==null){d.value.aggregateFields||(d.value.aggregateFields=[]);const $=ze(Y.compute,{fieldIds:a.value});d.value.aggregateFields.push({clienId:$,fieldId:$,fieldType:Y.compute,computeOptions:S})}else(f=d.value.aggregateFields)!=null&&f[T.value]&&(d.value.aggregateFields[T.value].computeOptions=S)},M=b(""),K=b(!1),_=async()=>{await Se.confirm("已设置的聚合表配置项将失效，确定进入自定义SQL脚本?","自定义 SQL 脚本",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),M.value="",K.value=!0},w=()=>{M.value=d.value.customSql??"",K.value=!0},E=async S=>{const f=await sl({aggregateJson:S});d.value={name:d.value.name,customSql:S,resolveFieldInfos:H(f),isSql:"1"}},q=async()=>{await Se.confirm("删除后将不能回复, 确定要删除?","删除 SQL 脚本",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.value=X(ye())},G=b();return I({async validate(){var S,f;await((f=(S=G.value)==null?void 0:S.ruleFormRef)==null?void 0:f.validate())},getOptions(){return d.value}}),(S,f)=>{const $=Ne,L=ce,z=pe;return v(),A("div",{class:"aggregate-designer"},[h("div",{class:"designer-header"},[h("span",{class:"header-name"},[N(" 聚合表配置 "),h("span",{class:"header-tip"},"修改后，点击图标才能更新预览")])]),h("div",{class:"designer-body"},[s(be,{ref_key:"azFormRef",ref:G,model:d.value,rules:e,"label-position":"top"},{default:g(()=>[d.value.isSql!=="1"?(v(),A(Q,{key:0},[s(ne,{label:"数据来源",prop:"dataSources"},{default:g(()=>[s(lt,{modelValue:d.value.dataSources,"onUpdate:modelValue":f[0]||(f[0]=x=>d.value.dataSources=x),aggregate:d.value,appId:S.appId,aggregateId:S.aggregateId,style:{width:"200px"},onReset:p},null,8,["modelValue","aggregate","appId","aggregateId"]),h("div",{class:"aggregate-field-select"},[s($,{type:"primary",underline:!1,onClick:_},{default:g(()=>[N(" 自定义SQL脚本 ")]),_:1})])]),_:1}),s(ne,{label:"数据过滤"},{default:g(()=>[h("div",{style:{width:"200px"}},[s(Al,{condition:d.value.dataFilter,"onUpdate:condition":f[1]||(f[1]=x=>d.value.dataFilter=x),btnText:"设置过滤条件",appId:S.appId,conditionSources:c.value,disabled:!c.value.length},null,8,["condition","appId","conditionSources","disabled"])])]),_:1}),s(ne,{class:"aggregate-field",label:"分组字段",prop:"groupFields"},{default:g(()=>[h("div",{class:"aggregate-field-select"},[s(tt,{modelValue:d.value.groupFields,"onUpdate:modelValue":f[2]||(f[2]=x=>d.value.groupFields=x),aggregate:d.value,disabled:!r.value.length,sources:r.value,clientIds:a.value},null,8,["modelValue","aggregate","disabled","sources","clientIds"])]),h("div",{style:{width:"100%"}},[s(pt,{modelValue:d.value.groupFields,"onUpdate:modelValue":f[3]||(f[3]=x=>d.value.groupFields=x),aggregate:d.value,onAliasSet:i},null,8,["modelValue","aggregate"])])]),_:1}),s(ne,{class:"aggregate-field",label:"聚合字段",prop:"aggregateFields",ref:"aggregateFieldFormItemRef"},{default:g(()=>[h("div",{class:"aggregate-field-select"},[s(nt,{modelValue:d.value.aggregateFields,"onUpdate:modelValue":f[4]||(f[4]=x=>d.value.aggregateFields=x),disabled:!r.value.length,sources:r.value,aggregate:d.value,clientIds:a.value},null,8,["modelValue","disabled","sources","aggregate","clientIds"]),s(L,{onClick:f[5]||(f[5]=x=>F()),link:"",icon:m(he),type:"primary",disabled:!O.value.length},{default:g(()=>[N(" 添加计算字段 ")]),_:1},8,["icon","disabled"])]),oe(h("div",null,[s(z,{"model-value":JSON.stringify(d.value.aggregateFields??"")},null,8,["model-value"])],512),[[de,!1]]),s(rt,{modelValue:d.value.aggregateFields,"onUpdate:modelValue":f[6]||(f[6]=x=>d.value.aggregateFields=x),aggregate:d.value,computedFields:C.value,onAliasSet:i,onCompuedSet:F},null,8,["modelValue","aggregate","computedFields"])]),_:1},512)],64)):(v(),A("div",{key:1,class:"custom_sql"},[s(Ft,{style:{"font-size":"var(--az-font-size-medium)"},sql:d.value.customSql??""},null,8,["sql"]),h("div",{class:"custom_sql-btn",style:{"margin-top":"30px"}},[s(L,{type:"primary",onClick:w},{default:g(()=>[N(" 编辑SQL脚本 ")]),_:1})]),h("div",{class:"custom_sql-btn"},[s(L,{type:"danger",plain:"",onClick:q},{default:g(()=>[N(" 删除 ")]),_:1})])]))]),_:1},8,["model"])]),s(_e,{modelValue:t.value,"onUpdate:modelValue":f[9]||(f[9]=x=>t.value=x),title:"重命名",width:"420","append-to-body":""},{footer:g(()=>[h("span",{class:"dialog-footer"},[s(L,{onClick:f[8]||(f[8]=x=>t.value=!1)},{default:g(()=>[N("取消")]),_:1}),s(L,{type:"primary",onClick:l},{default:g(()=>[N("确定")]),_:1})])]),default:g(()=>[s(z,{modelValue:o.value,"onUpdate:modelValue":f[7]||(f[7]=x=>o.value=x),maxlength:"20",placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1},8,["modelValue"]),s(ut,{visible:y.value,"onUpdate:visible":f[10]||(f[10]=x=>y.value=x),"model-value":k.value,group:O.value,onConfirm:W},null,8,["visible","model-value","group"]),s(wt,{modelValue:M.value,"onUpdate:modelValue":f[11]||(f[11]=x=>M.value=x),visible:K.value,"onUpdate:visible":f[12]||(f[12]=x=>K.value=x),appId:S.appId,confirm:E},null,8,["modelValue","visible","appId"])])}}});const At=j(Ct,[["__scopeId","data-v-9a7bb268"]]),Tt=D({__name:"AzInputRename",props:{modelValue:{},renameHook:{type:Function}},emits:["update:modelValue"],setup(V,{emit:I}){const n=V,r=ue(n,"modelValue",I),e=b(),p=b(!1),a=b(!1),c=b(""),t=async()=>{var i;if(c.value!==r.value){a.value=!0;try{if(n.renameHook&&await((i=n.renameHook)==null?void 0:i.call(n,c.value))===!1)return;r.value=c.value}finally{a.value=!1}}p.value=!1},o=()=>{var i;(i=e.value)==null||i.blur()},u=()=>{p.value=!0,c.value=r.value??"",il(()=>{var i;(i=e.value)==null||i.focus()})};return(i,l)=>{const y=De,k=ma;return v(),A("div",{class:"az_rename"},[oe(s(fe,{class:"ml-5 input-rename",modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=T=>c.value=T),isBlurCache:"",placeholder:"请输入名称",onBlur:t,readonly:a.value,onKeyup:dl(o,["enter"]),ref_key:"renameInputRef",ref:e,maxlength:"10",title:"重命名"},{suffix:g(()=>[a.value?(v(),P(y,{key:0,class:"is-loading"},{default:g(()=>[s(m(rl))]),_:1})):R("",!0)]),_:1},8,["modelValue","readonly","onKeyup"]),[[de,p.value]]),s(k,{effect:"dark",content:"重命名",placement:"bottom","show-after":200},{default:g(()=>[oe(h("div",{class:"rename-display",onClick:u},[h("span",{class:"rename-name az-ellipsis"},le(m(r)),1)],512),[[de,!p.value]])]),_:1})])}}});const $t=j(Tt,[["__scopeId","data-v-d775260e"]]),xt=D({__name:"routePage",setup(V){const I=ul(),n=pl(),d=Pl("appId"),r=b("");Z(()=>cl("id",I),f=>{r.value=f??""},{immediate:!0});const e={desc:"",name:"未命名聚合表",isEnable:1,aggregateJson:ye()},p=b(X(e)),a=b(X(e)),c=b(),t=b(),o=b(!1),u=ml(),i=async()=>{if(r.value){const f=await Il(r.value);if(f==null)return Promise.reject({msg:"该聚合表已被删除, 请重新创建",loadState:Fe.danger});a.value=f,p.value=f,K(f.aggregateJson)}else a.value=X(e),p.value=X(e)};Z(r,()=>{var f;o.value||(f=c.value)==null||f.reload(),o.value=!1});const l=B(()=>{var f;return(f=c.value)==null?void 0:f.state}),y=()=>{d?Xe(bl,{replace:!0,query:{appId:d.value,app_setting_menu:"aggregation_table"}}):Xe(Vl,{replace:!0})},k=b(!1),T=async(f=!0)=>{var $,L;k.value=!0;try{await(($=t.value)==null?void 0:$.validate());const z=(L=t.value)==null?void 0:L.getOptions();if(!z)return;a.value=await Sl({...a.value,aggregateJson:z,appId:d.value??"",isSql:z.isSql}),r.value||(o.value=!0,n.replace({...I,query:{...I.query,id:a.value.id}})),r.value=a.value.id??"",f&&K(z)}finally{k.value=!1}};gl(async()=>{var f;if(!(!t.value||Re(JSON.parse(JSON.stringify(p.value)),JSON.parse(JSON.stringify({...a.value,aggregateJson:(f=t.value)==null?void 0:f.getOptions()})))))try{await new Promise(($,L)=>{Se.confirm("您修改了聚合表设计但没有保存，是否需要保存聚合表设计并继续？","聚合表设计有修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(z,x,J){z==="confirm"?(x.confirmButtonLoading=!0,T(!1).then(()=>{J(),$()}).finally(()=>{x.confirmButtonLoading=!1})):z==="cancel"?(J(),$()):z==="close"&&(J(),L())}})})}catch{return!1}});const C=b(!1),F=b([]),O=B(()=>F.value.map(f=>({fieldId:f.fieldId}))),W=b([]),M=b(),K=async f=>{var $,L;C.value=!0;try{await(($=t.value)==null?void 0:$.validate().catch(z=>(ca.error("请先检查您的配置再预览!"),Promise.reject(z)))),M.value=f??((L=t.value)==null?void 0:L.getOptions()),q.value=1,await S()}finally{C.value=!1}},_=async()=>{C.value||K()},w=b(!1),E=b(10),q=b(1),G=b(0),S=async()=>{if(M.value){w.value=!0;try{F.value=(await kl({...a.value,aggregateJson:M.value},{dataSystem:u})).fields;const f=await hl({aggregateJson:M.value,current:q.value,limit:E.value,id:r.value,isSql:M.value.isSql});W.value=f.records,G.value=+f.total}finally{w.value=!1}}};return Z([E,q],()=>S()),(f,$)=>{const L=De,z=ce,x=wl,J=ma;return v(),A("div",{class:"aggregate"},[h("div",{class:"aggregate-header"},[h("div",{class:"header-left"},[s(L,{class:"header-back",onClick:y},{default:g(()=>[s(m(fl))]),_:1}),oe(s($t,{modelValue:m(a).name,"onUpdate:modelValue":$[0]||($[0]=ee=>m(a).name=ee)},null,8,["modelValue"]),[[de,m(l)===m(Fe).success]])]),oe(h("div",{class:"aggregate-btns"},[s(x,{placement:"bottom",width:200,trigger:"click","hide-after":0},{reference:g(()=>[s(z,{type:"primary",link:""},{default:g(()=>[N("备注")]),_:1})]),default:g(()=>[s(fe,{modelValue:m(a).desc,"onUpdate:modelValue":$[1]||($[1]=ee=>m(a).desc=ee),clearable:"",placeholder:"请输入"},null,8,["modelValue"])]),_:1}),s(z,{type:"primary",onClick:$[2]||($[2]=ee=>T(!0)),loading:m(k)},{default:g(()=>[N(" 保存 ")]),_:1},8,["loading"])],512),[[de,m(l)===m(Fe).success]])]),s(ea,{queryKeys:["appId"],path:y,ref_key:"loadingDataRef",ref:c,class:"aggregate-container",load:i,"element-loading-background":"transparent"},{default:g(()=>[h("div",{class:"aggregate-preview-wrapper"},[h("div",{class:"aggregate-preview"},[h("div",{class:"preview-icon"},[s(J,{effect:"dark",content:"点击刷新预览",placement:"top"},{default:g(()=>[s(L,{class:Pe({"is-loading":m(C)}),onClick:_},{default:g(()=>[s(m(vl))]),_:1},8,["class"])]),_:1})]),h("div",{class:"preview-content"},[m(M)?(v(),P(_l,{key:0,current:m(q),"onUpdate:current":$[3]||($[3]=ee=>se(q)?q.value=ee:null),limit:m(E),"onUpdate:limit":$[4]||($[4]=ee=>se(E)?E.value=ee:null),total:m(G),loading:m(w),fields:m(F),showFields:m(O),autoHeight:"",data:m(W),style:{height:"100%"}},null,8,["current","limit","total","loading","fields","showFields","data"])):(v(),A("div",{key:1,class:"preview-empty"},[s(yl,{description:"请在右侧对聚合表进行配置后预览"})]))])])]),m(d)?(v(),A("div",{key:0},[s(At,{ref_key:"aggregateDesignerRef",ref:t,aggregateId:m(a).id,appId:m(d),options:m(a).aggregateJson},null,8,["aggregateId","appId","options"])])):R("",!0)]),_:1},512)])}}});const tn=j(xt,[["__scopeId","data-v-276507b7"]]);export{tn as default};

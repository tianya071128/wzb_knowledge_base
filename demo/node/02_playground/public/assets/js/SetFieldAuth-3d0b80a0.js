import{d as X,h6 as ae,r as T,nm as te,y as ne,o as g,b as k,w as u,h as M,c as U,nn as re,v as de,a9 as oe,a as N,eo as K,z as se,M as ie,g2 as W,W as ue,i as v,k as j,m as q,t as I,f as $,F as G,g as J,B as pe,c1 as ce,l as O,nh as Q,es as H,dC as fe,q as _e,P as he,dD as me,_ as be}from"./index-b80d5ef5.js";import{b as ye,E as ve,a as ge}from"./el-dropdown-item-455a6589.js";const Fe=X({__name:"AzDropdown",props:{teleported:{type:Boolean,default:!0},elementHideClose:{type:Boolean}},setup(R){const C=R,c=ae(),o=T(),B=T(),y=te(B),E=T(!1),S=f=>{E.value=f,B.value=f&&C.teleported&&C.elementHideClose?c.value:void 0};return ne(y,f=>{var F;!f&&B.value&&E.value&&((F=o.value)==null||F.handleClose())}),(f,F)=>{const V=ye;return g(),k(V,{teleported:f.teleported,onVisibleChange:S,ref_key:"dropdownRef",ref:o},{default:u(()=>[M(f.$slots,"default")]),dropdown:u(()=>[M(f.$slots,"dropdown")]),_:3},8,["teleported"])}}}),Ve=X({__name:"SetFieldAuth",props:{fields:{},modelValue:{},hideReadable:{type:Boolean},hideEdit:{type:Boolean},isRequired:{type:Boolean},auths:{},firstLabelWidth:{default:180},isDownload:{type:Boolean,default:!1},auth:{},isIndeterminate:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(R,{emit:C}){const c=U(()=>re(o.fields)),o=R,y=de(o,"modelValue",C,{deep:!0,clone:!0,passive:!0,shouldEmit(e){return!oe(e,o.modelValue)}}),E=[N.autoNumber],S=U(()=>{var l,a,r;const e=[];if(!o.hideReadable){const t={label:"可见",prop:"readable",children:[]};o.isDownload&&((l=t.children)==null||l.push({label:"可下载文件",prop:"download",defaultValue:"readable",ignoreFieldAuth(d){return d.type!==N.uploadFile}})),e.push(t)}if(!o.hideEdit){const t={label:"可编辑",prop:"writeable",ignoreFieldAuth(d,p){return!(p!=null&&p.isFormItem)||d.source===K.system||E.includes(d.type)},limitation:["readable"],children:[]};if((a=o.auth)!=null&&a.isTemplate){const d=[{prop:"add_template",label:"可新增"},{prop:"delete_template",label:"可删除"},{prop:"design_template",label:"可设计模版"},{prop:"entry_template",label:"可填写"},{prop:"preview_template",label:"可预览"}];(r=t.children)==null||r.push(...d.map(p=>({label:p.label,prop:p.prop,defaultValue:"writeable",ignoreFieldAuth(m){return m.type!==N.templateFile}})))}e.push(t)}return o.isRequired&&e.push({label:"必填",prop:"required",limitation:["readable"],ignoreFieldAuth(t,d){return!(d!=null&&d.isFormItem)||t.source===K.system||E.includes(t.type)},disable(t){return"required"in t.options&&t.options.required===!0}}),Array.isArray(o.auths)&&e.push(...o.auths),e}),f=e=>{let l=y.value.find(a=>a.fieldId===e);return l||(l={fieldId:e},y.value.push(l)),l},F=(e,l)=>{var d,p;const{prop:a,defaultValue:r}=l;let t=(d=y.value.find(m=>m.fieldId===e))==null?void 0:d[a];return t==null&&r!=null&&(typeof r=="boolean"?t=r:typeof r=="string"&&(t=(p=y.value.find(m=>m.fieldId===e))==null?void 0:p[r])),!!t},V=(e,l)=>{var r;const a=Q(l.type);return((r=e.ignoreFieldAuth)==null?void 0:r.call(e,l,a,W(l.fieldId,c.value)))===!0},x=(e,l)=>{var r;const a=Q(l.type);return((r=e.disable)==null?void 0:r.call(e,l,a))===!0},z=(e,l)=>{var a;return((a=e.children)==null?void 0:a.filter(r=>!V(r,l)))??[]},P=e=>c.value.length&&H(c.value).every(l=>V(e,l)||F(l.fieldId,e)),Y=(e,l)=>{H(c.value).forEach(a=>{_(e,l,a)})},Z=e=>!!(c.value.length&&!P(e)&&H(c.value).some(l=>!V(e,l)&&F(l.fieldId,e))),w=(e,l)=>{const{prop:a}=e;return a==="required"&&l&&x(e,l)?!0:F(l.fieldId,e)},_=(e,l,a,r=!0,t)=>{var h,D,L;const d=f(a.fieldId),p=w(l,a),m=V(l,a)||x(l,a)||p===e;if(d&&!(l.prop in d)&&(d[l.prop]=e),m)return;d[l.prop]=e,"fields"in a&&r&&a.fields.forEach(i=>_(e,l,i));const n=W(a.fieldId,c.value);if(n!=null&&n.parentField&&"fields"in n.parentField){const i=n.parentField.fields.some(b=>w(l,b));i!==w(l,n.parentField)&&_(i,l,n.parentField,!1)}const s=S.value.filter(i=>{var b;return(b=i.limitation)==null?void 0:b.includes(l.prop)});if(s.length&&!e&&s.forEach(i=>{_(e,i,a,!1)}),e){const i=(h=l.limitation)==null?void 0:h.map(b=>S.value.find(le=>le.prop===b));i==null||i.forEach(b=>{b&&_(e,b,a,!1)})}t!=null&&t.noSon||(D=l.children)==null||D.forEach(i=>_(e,i,a,!1)),t!=null&&t.parentSetAuthItem&&e&&!w(t.parentSetAuthItem,a)&&_(e,t.parentSetAuthItem,a,!1,{noSon:!0}),t!=null&&t.parentSetAuthItem&&!e&&!l.notSelectedLinkParent&&((L=t.parentSetAuthItem.children)!=null&&L.every(i=>!w(i,a)))&&_(e,t.parentSetAuthItem,a,!1,{noSon:!0})};se(()=>{ie(y.value,e=>!W(e.fieldId,c.value))});const ee=U(()=>{if(o.firstLabelWidth)return o.firstLabelWidth;let e=1;return ue(c.value,"fields",(l,a)=>{e=Math.max(e,a.length)}),Math.max(Math.min(300,e*12+44+100))}),A=(e,l)=>{var a;return o.isIndeterminate?((a=y.value.find(r=>r.fieldId===l.fieldId))==null?void 0:a[e.prop])===void 0:!1};return(e,l)=>{const a=fe,r=_e,t=he,d=ve,p=ge,m=me;return g(),k(m,{data:c.value,border:"",style:{width:"100%"},stripe:"","tree-props":{children:"fields"},"row-key":"fieldId","default-expand-all":"","max-height":"50vh",class:"field_auth"},{default:u(()=>[v(a,{prop:"date",label:"字段名称",width:ee.value,"class-name":"field_auth-label-column"},{default:u(({row:n})=>[j("div",{class:"field_auth-label"},[M(e.$slots,"fieldLabel",{field:n},()=>[q(I(n.options.label),1)],!0)])]),_:3},8,["width"]),(g(!0),$(G,null,J(S.value,n=>(g(),k(a,{key:n.prop,prop:n.prop,label:n.label,width:110},{header:u(()=>[v(r,{"model-value":P(n),"onUpdate:modelValue":s=>Y(s,n),indeterminate:Z(n)},{default:u(()=>[q(I(n.label),1)]),_:2},1032,["model-value","onUpdate:modelValue","indeterminate"])]),default:u(({row:s})=>[V(n,s)?O("",!0):(g(),$("div",{key:0,class:"field_auth-wrapper"},[v(r,{disabled:x(n,s),"model-value":w(n,s),indeterminate:A(n,s),"onUpdate:modelValue":h=>_(h,n,s)},{default:u(()=>[q(I(n.label),1)]),_:2},1032,["disabled","model-value","indeterminate","onUpdate:modelValue"]),z(n,s).length?(g(),k(Fe,{key:0,"hide-on-click":!1,trigger:"click","popper-class":"field_auth-child-popper",elementHideClose:""},{dropdown:u(()=>[v(p,null,{default:u(()=>[(g(!0),$(G,null,J(z(n,s),(h,D)=>(g(),k(d,{key:D},{default:u(()=>[v(r,{disabled:x(h,s),"model-value":w(h,s),indeterminate:A(h,s),"onUpdate:modelValue":L=>_(L,h,s,!0,{parentSetAuthItem:n})},{default:u(()=>[q(I(h.label),1)]),_:2},1032,["disabled","model-value","indeterminate","onUpdate:modelValue"])]),_:2},1024))),128))]),_:2},1024)]),default:u(()=>[j("span",{class:"field_auth-child"},[v(t,{class:"el-icon--right"},{default:u(()=>[v(pe(ce))]),_:1})])]),_:2},1024)):O("",!0)]))]),_:2},1032,["prop","label"]))),128)),M(e.$slots,"default",{},void 0,!0),v(a,{"min-width":"1","class-name":"table-column-holder"})]),_:3},8,["data"])}}});const Se=be(Ve,[["__scopeId","data-v-dee04404"]]);export{Se as S};

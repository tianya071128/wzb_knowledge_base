import{c as g,jC as Z,nT as Q,r as $,dU as ue,jG as ce,jK as fe,hP as pe,x as me,jL as ve,dW as j,kw as ge,bK as ye,g2 as _e,b_ as we,a as Ie,nU as ne,d as X,o as i,f as u,k as z,h as O,p as G,i as k,I as be,k3 as se,F as P,w as K,m as ke,U as he,_ as H,nV as W,nW as ze,bJ as Se,B as e,nX as De,v as Y,h6 as Fe,bX as Ce,nY as Re,y as Ve,C as D,nZ as $e,aT as x,n_ as ee,g as te,b as E,e as q,S as oe,dV as de,a2 as Be,b2 as re,bC as Le,l as V,L as Te,n$ as Ae,ca as Ee,j as Pe,ex as Ue,e1 as Me,ew as Ne}from"./index-b80d5ef5.js";import{A as ie}from"./AddFormDataBtnPlus-a775412e.js";import{u as je,C as qe,F as Oe}from"./CardShowFieldItem-fd24f218.js";function Ke(t){const I=g(()=>t.field.options.showNum===Z.multiple&&t.field.options.displayMode===Q.timeline),l=g(()=>t.field.options.showNum===Z.multiple&&t.field.options.displayMode===Q.card),d=$({sourceId:t.field.options.sourceId,showField:t.field.options.showField,conditions:[],sortField:t.field.options.sortField,limit:I.value||t.isMobile?50:10,disableRequest:!0}),{getData:o,tableData:a,loading:m,current:y,limit:_,total:F}=ue(d),s=ce();t.isRender&&fe(t.field.options.condition??[],s,w=>{const{normlConditionResult:b}=w;a.value=[],d.value.disableRequest=!b.length,d.value.conditions=b,o()});const{checkCurrentAppForm:c,getSoureceInfo:B}=pe(),p=g(()=>c(t.field.options.sourceId)),v=g(()=>{var w,b,N;return p.value?((N=(b=(w=B(t.field.options.sourceId))==null?void 0:w.entryIds)==null?void 0:b[0])==null?void 0:N.entryId)??"":""}),C=me(),S=g(()=>{if(s&&t.field.options.addValTransfer)return ve(t.field.options.addValTransfer??[],{formData:(s==null?void 0:s.packageNormlData())??{},isFieldIdKey:!0,dataSystem:C})}),U=g(()=>p.value&&v&&t.field.options.add&&(s==null?void 0:s.mode)!==j.view),r=g(()=>a.value.length&&t.field.options.showNum===Z.single&&t.field.options.isClickRow),f=$(!1),L=$(new Map),n=w=>{t.field.options.isClickRow&&(f.value=!0,L.value=ne(w))},{totalFields:h,LoadingDataRef:M,loadFields:J}=ge(ye({sourceId:g(()=>t.field.options.sourceId??"")})),T=g(()=>(t.field.options.showField??[]).map(w=>{const b=_e(w.fieldId,h.value);return!b||!we(b.field.type,"isFormItem")||b.field.type===Ie.subform&&t.field.options.displayMode&&[Q.card,Q.timeline].includes(t.field.options.displayMode)?null:{fieldInfo:b,showField:w}}).filter(w=>w));return{render:s,tableData:a,current:y,limit:_,total:F,loading:m,entryId:v,isAddAuth:p,getData:o,formData:S,isAdd:U,isViewBtn:r,isTimeline:I,isCard:l,LoadingDataRef:M,loadFields:J,normlShowFields:T,detailsVisible:f,detailsDataIds:L,handleViewDetails:n}}const We=X({inheritAttrs:!1,__name:"ViewSoureceBtn",props:{sourceId:{},data:{},disabled:{type:Boolean}},setup(t){const I=t,l=$(!1),d=()=>{I.disabled||(l.value=!0)},o=g(()=>ne(I.data));return(a,m)=>{const y=he;return i(),u(P,null,[z("span",{onClick:d,class:G(a.$attrs.class)},[O(a.$slots,"default",{},()=>[k(y,{type:"primary",disabled:a.disabled},{default:K(()=>[ke("查看")]),_:1},8,["disabled"])],!0)],2),k(se,be({modelValue:l.value,"onUpdate:modelValue":m[0]||(m[0]=_=>l.value=_),sourceId:a.sourceId,dataIds:o.value},a.$attrs),null,16,["modelValue","sourceId","dataIds"])],64)}}});const Ge=H(We,[["__scopeId","data-v-e83a8f30"]]),Xe=X({__name:"AzTimeline",props:{mode:{default:W.vertical},align:{default:ze.left}},setup(t){return Se(De,t),(l,d)=>(i(),u("div",{class:G(["az_timeline",[l.mode===e(W).vertical&&`is-${l.align}`,`is-${l.mode}`]])},[l.mode===e(W).horizontal?(i(),u(P,{key:0},[z("div",{class:"az_timeline-wrapper"},[O(l.$slots,"default")]),z("div",{class:"az_timeline-wrapper"},[O(l.$slots,"default")])],64)):O(l.$slots,"default",{key:1})],2))}});const He={};function Je(t,I){return i(),u("div",{class:"az_timeline-item"},[z("div",{class:"az_timeline-wrapper"},[z("div",{class:"az_timeline-node"}),z("div",{class:"az_timeline-content"},[O(t.$slots,"default",{},void 0,!0)])])])}const Qe=H(He,[["render",Je],["__scopeId","data-v-8ae3d83b"]]),Ye=X({__name:"AzPagination",props:{total:{default:0},current:{default:1},limit:{default:10},layout:{default:"total, sizes, prev, pager, next, jumper"},pageSizes:{default(){return[10,20,50,100]}}},emits:["update:current","update:limit"],setup(t,{emit:I}){const l=t,d=I,o=Y(l,"current",d),a=Y(l,"limit",d),m=g(()=>l.total),y=["sizes","jumper","pager"],_=$([]),F=g(()=>l.layout.split(/, /)),s=g(()=>{const r=new Set(F.value);return _.value.forEach(f=>r.delete(f)),[...r]}),c=$([]),B=g(()=>{const r=new Set(F.value);return c.value.forEach(f=>r.delete(f)),[...r]}),p=Fe(),v=$(),{width:C}=Ce(p),S=$(!1),U=async()=>{if(v.value){if(S.value=!0,ee(v.value)){for(const r of y)if(!c.value.includes(r)&&(c.value.push(r),await x(),!S.value||!ee(v.value)))break}else{let r;for(;(r=c.value.pop())&&(await x(),!!S.value);)if(ee(v.value)){c.value.push(r);break}}S.value&&(_.value=[...c.value]),S.value=!1}};return Re([C,()=>m,o,a],()=>{C.value<=0||!p.value||!v.value||(S.value?(S.value=!1,c.value=[..._.value],x(()=>{U()})):U())},{throttle:500,flush:"post"}),Ve([()=>l.pageSizes,a],()=>{l.pageSizes.includes(a.value)||(a.value=l.pageSizes[0])},{immediate:!0}),(r,f)=>{const L=$e;return i(),u("div",{class:"page_pagination"},[k(L,{class:"pagination-item",ref:"paginationRef","current-page":e(o),"onUpdate:currentPage":f[0]||(f[0]=n=>D(o)?o.value=n:null),"page-size":e(a),"onUpdate:pageSize":f[1]||(f[1]=n=>D(a)?a.value=n:null),background:"",total:m.value,"pager-count":5,layout:s.value.join(","),pageSizes:r.pageSizes},null,8,["current-page","page-size","total","layout","pageSizes"]),z("div",{class:"pagination-reference",ref_key:"paginationReferenceRef",ref:v},[k(L,{"current-page":e(o),"onUpdate:currentPage":f[2]||(f[2]=n=>D(o)?o.value=n:null),"page-size":e(a),"onUpdate:pageSize":f[3]||(f[3]=n=>D(a)?a.value=n:null),background:"",total:m.value,"pager-count":5,layout:B.value.join(","),pageSizes:r.pageSizes},null,8,["current-page","page-size","total","layout","pageSizes"])],512)])}}});const Ze=H(Ye,[["__scopeId","data-v-33844e3f"]]),xe=X({__name:"CardMode",props:{field:{},total:{},current:{},limit:{},tableData:{}},emits:["update:current","update:limit","click-row"],setup(t,{emit:I}){const l=t,d=I,o=$(),{itemWidth:a,num:m}=je({target:o,numList:[[400,1],[800,2],[1200,3],[1/0,4]]}),y=Y(l,"current",d),_=Y(l,"limit",d),F=g(()=>m.value===1?[3,6,12,20]:m.value===2?[4,8,12,20]:m.value===3?[6,12,18,30]:[8,16,24,40]);return(s,c)=>{const B=Le;return i(),u("div",{class:"link_query-card",ref_key:"carPresentationRef",ref:o},[s.tableData.length>0?(i(),u("div",{key:0,class:"link_query-card-wrapper"},[(i(!0),u(P,null,te(s.tableData,p=>(i(),u("div",{class:G(["card-item",{"is-detail":s.field.options.isClickRow}]),key:e(de)(p),style:Be({width:e(a)}),onClick:v=>d("click-row",p)},[k(B,{class:"card-main",shadow:"hover"},{default:K(()=>{var v,C;return[z("div",{class:"card-content"},[k(qe,{rowData:p,headerFieldId:(C=(v=s.field.options.showField)==null?void 0:v[0])==null?void 0:C.fieldId,sourceId:s.field.options.sourceId,"show-fields":s.field.options.showField,num:s.field.options.cardShowColumns??2},null,8,["rowData","headerFieldId","sourceId","show-fields","num"])])]}),_:2},1024)],14,["onClick"]))),128))])):(i(),E(re,{key:1,style:{padding:"10px 0"},description:"暂无数据","image-size":32})),q(z("div",{style:{"margin-top":"10px"}},[k(Ze,{current:e(y),"onUpdate:current":c[0]||(c[0]=p=>D(y)?y.value=p:null),limit:e(_),"onUpdate:limit":c[1]||(c[1]=p=>D(_)?_.value=p:null),total:s.total,layout:"total, sizes, prev, pager, next",pageSizes:F.value},null,8,["current","limit","total","pageSizes"])],512),[[oe,s.total>F.value[0]]])],512)}}});const et=H(xe,[["__scopeId","data-v-f15e5fbb"]]),tt=X({__name:"Base",props:{field:{},isRender:{type:Boolean}},setup(t){const I=t,{render:l,tableData:d,current:o,limit:a,total:m,loading:y,entryId:_,getData:F,formData:s,isAdd:c,isViewBtn:B,isTimeline:p,LoadingDataRef:v,loadFields:C,normlShowFields:S,detailsDataIds:U,detailsVisible:r,handleViewDetails:f,isCard:L}=Ke(I);return(n,h)=>{var J;const M=Ee;return n.field.options.sourceId&&(e(p)||e(L))?(i(),E(Te,{key:0,load:e(C),ref_key:"LoadingDataRef",ref:v},{default:K(()=>{var T,w,b,N,ae;return[e(c)?(i(),E(ie,{key:0,class:"mb-10",disabled:((T=e(l))==null?void 0:T.mode)===e(j).preview,prop:{renderOptions:{mode:e(j).enter,entryId:e(_),formData:e(s),useDefault:!0}},onSuccess:e(F)},null,8,["disabled","prop","onSuccess"])):V("",!0),e(p)?q((i(),u("div",{key:1,class:G(["ilnkquery_timeline",{"ilnkquery_timeline-vertical":((w=n.field.options.timelineOpt)==null?void 0:w.position)!==e(W).horizontal,"ilnkquery_timeline-horizontal":((b=n.field.options.timelineOpt)==null?void 0:b.position)===e(W).horizontal}])},[k(Xe,{mode:(N=n.field.options.timelineOpt)==null?void 0:N.position,align:(ae=n.field.options.timelineOpt)==null?void 0:ae.align},{default:K(()=>[(i(!0),u(P,null,te(e(d),R=>(i(),E(Qe,{key:e(de)(R)},{default:K(()=>[z("div",{class:G({"is-detail":n.field.options.isClickRow}),onClick:A=>e(f)(R)},[(i(!0),u(P,null,te(e(S),A=>{var le;return i(),u(P,{key:A==null?void 0:A.showField.fieldId},[A?(i(),u("div",{key:0,class:"display-field-label"},[(le=n.field.options.timelineOpt)!=null&&le.isLabel?(i(),u(P,{key:0},[k(Pe,{class:"label-name",content:`${A.fieldInfo.field.options.label}`},null,8,["content"]),z("span",null,"：")],64)):V("",!0),k(Ue,{content:e(Me)({rowData:R,fieldId:A.fieldInfo.field.fieldId}),mode:e(Ne).list,field:A.fieldInfo.field,bubble:""},null,8,["content","mode","field"])])):V("",!0)],64)}),128))],10,["onClick"])]),_:2},1024))),128))]),_:1},8,["mode","align"]),!e(y)&&!e(d).length?(i(),u("div",{key:0,class:"ilnkquery_timeline-empty"}," 没有数据 ")):V("",!0)],2)),[[M,e(y)]]):e(L)?q((i(),u("div",{key:2},[k(et,{limit:e(a),"onUpdate:limit":h[0]||(h[0]=R=>D(a)?a.value=R:null),current:e(o),"onUpdate:current":h[1]||(h[1]=R=>D(o)?o.value=R:null),total:e(m),tableData:e(d),field:n.field,onClickRow:e(f)},null,8,["limit","current","total","tableData","field","onClickRow"])])),[[M,e(y)]]):V("",!0),k(se,{modelValue:e(r),"onUpdate:modelValue":h[2]||(h[2]=R=>D(r)?r.value=R:null),"source-id":n.field.options.sourceId,dataIds:e(U)},null,8,["modelValue","source-id","dataIds"])]}),_:1},8,["load"])):q((i(),u("div",{key:1},[e(c)||e(B)?(i(),u("div",{key:0,class:"mb-10"},[e(c)?(i(),E(ie,{key:0,class:"mr-5",disabled:((J=e(l))==null?void 0:J.mode)===e(j).preview,prop:{renderOptions:{mode:e(j).enter,entryId:e(_),formData:e(s),useDefault:!0}},onSuccess:e(F)},null,8,["disabled","prop","onSuccess"])):V("",!0),e(B)?(i(),E(Ge,{key:1,"source-id":n.field.options.sourceId,data:e(d)[0]},null,8,["source-id","data"])):V("",!0)])):V("",!0),q(z("div",null,[k(Oe,{current:e(o),"onUpdate:current":h[3]||(h[3]=T=>D(o)?o.value=T:null),limit:e(a),"onUpdate:limit":h[4]||(h[4]=T=>D(a)?a.value=T:null),sourceId:n.field.options.sourceId,"show-field":n.field.options.showField,"show-num":n.field.options.showNum,"table-data":e(d),total:e(m),clickToDetails:n.field.options.isClickRow,layout:"total, sizes, prev, pager, next",hidePagination:e(m)<=10,span:e(Ae)(n.field),isFull:""},null,8,["current","limit","sourceId","show-field","show-num","table-data","total","clickToDetails","hidePagination","span"])],512),[[oe,e(d).length>0]]),e(d).length<=0?(i(),E(re,{key:1,style:{padding:"10px 0"},description:"暂无数据","image-size":32})):V("",!0)])),[[M,e(y)]])}}});const nt=H(tt,[["__scopeId","data-v-bcebc908"]]);export{Ze as A,nt as B};

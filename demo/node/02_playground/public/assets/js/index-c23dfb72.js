import{lL as q,d as V,r as T,cB as ge,c as D,wb as A,xy as fe,y as L,wi as he,du as we,bx as ie,aT as U,i as c,lU as Z,w4 as k,lN as W,e as ye,iC as xe,I as K,lS as ne,lO as le,bK as se,xF as Se,xu as Ie,w6 as re,xx as H,lW as j,xH as Y,xm as Pe,lK as be,w2 as ce,x_ as Ce,w0 as ze,w1 as ke,wa as Te,wc as Oe,xI as Re,xw as M,w8 as oe,xJ as Ye,wh as Le}from"./index-b80d5ef5.js";import{a as Xe,S as $e}from"./index-30749bf5.js";const[Ee,$]=q("image"),Ze={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:Z,height:Z,radius:Z,lazyLoad:Boolean,iconSize:Z,showError:k,errorIcon:W("photo-fail"),iconPrefix:String,showLoading:k,loadingIcon:W("photo"),crossorigin:String,referrerpolicy:String};var Be=V({name:Ee,props:Ze,emits:["load","error"],setup(e,{emit:v,slots:m}){const o=T(!1),r=T(!0),l=T(),{$Lazyload:d}=ge().proxy,O=D(()=>{const t={width:A(e.width),height:A(e.height)};return fe(e.radius)&&(t.overflow="hidden",t.borderRadius=A(e.radius)),t});L(()=>e.src,()=>{o.value=!1,r.value=!0});const g=t=>{r.value&&(r.value=!1,v("load",t))},P=()=>{const t=new Event("load");Object.defineProperty(t,"target",{value:l.value,enumerable:!0}),g(t)},b=t=>{o.value=!0,r.value=!1,v("error",t)},f=(t,w,I)=>I?I():c(ne,{name:t,size:e.iconSize,class:w,classPrefix:e.iconPrefix},null),h=()=>{if(r.value&&e.showLoading)return c("div",{class:$("loading")},[f(e.loadingIcon,$("loading-icon"),m.loading)]);if(o.value&&e.showError)return c("div",{class:$("error")},[f(e.errorIcon,$("error-icon"),m.error)])},R=()=>{if(o.value||!e.src)return;const t={alt:e.alt,class:$("img"),style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?ye(c("img",K({ref:l},t),null),[[xe("lazy"),e.src]]):c("img",K({ref:l,src:e.src,onLoad:g,onError:b},t),null)},S=({el:t})=>{const w=()=>{t===l.value&&r.value&&P()};l.value?w():U(w)},X=({el:t})=>{t===l.value&&!o.value&&b()};return d&&he&&(d.$on("loaded",S),d.$on("error",X),we(()=>{d.$off("loaded",S),d.$off("error",X)})),ie(()=>{U(()=>{var t;(t=l.value)!=null&&t.complete&&!e.lazyLoad&&P()})}),()=>{var t;return c("div",{class:$({round:e.round,block:e.block}),style:O.value},[R(),h(),(t=m.default)==null?void 0:t.call(m)])}}});const De=le(Be),ae=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),_e=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),F=q("image-preview")[1],te=2.6,He={src:String,show:Boolean,active:Number,minZoom:H(Z),maxZoom:H(Z),rootWidth:H(Number),rootHeight:H(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var Me=V({props:He,emits:["scale","close","longPress"],setup(e,{emit:v,slots:m}){const o=se({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),r=Se(),l=T(),d=T(),O=T(!1),g=T(!1);let P=0;const b=D(()=>{const{scale:a,moveX:i,moveY:n,moving:u,zooming:x,initializing:z}=o,_={transitionDuration:x||u||z?"0s":".3s"};return(a!==1||g.value)&&(_.transform=`matrix(${a}, 0, 0, ${a}, ${i}, ${n})`),_}),f=D(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:i}=e,n=O.value?i/o.imageRatio:a;return Math.max(0,(o.scale*n-a)/2)}return 0}),h=D(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:i}=e,n=O.value?i:a*o.imageRatio;return Math.max(0,(o.scale*n-i)/2)}return 0}),R=(a,i)=>{var n;if(a=Y(a,+e.minZoom,+e.maxZoom+1),a!==o.scale){const u=a/o.scale;if(o.scale=a,i){const x=ce((n=l.value)==null?void 0:n.$el),z={x:x.width*.5,y:x.height*.5},_=o.moveX-(i.x-x.left-z.x)*(u-1),de=o.moveY-(i.y-x.top-z.y)*(u-1);o.moveX=Y(_,-f.value,f.value),o.moveY=Y(de,-h.value,h.value)}else o.moveX=0,o.moveY=g.value?P:0;v("scale",{scale:a,index:e.active})}},S=()=>{R(1)},X=()=>{const a=o.scale>1?1:2;R(a,a===2||g.value?{x:r.startX.value,y:r.startY.value}:void 0)};let t,w,I,s,C,y,B,G,N=!1;const ue=a=>{const{touches:i}=a;if(t=i.length,t===2&&e.disableZoom)return;const{offsetX:n}=r;r.start(a),w=o.moveX,I=o.moveY,G=Date.now(),N=!1,o.moving=t===1&&(o.scale!==1||g.value),o.zooming=t===2&&!n.value,o.zooming&&(s=o.scale,C=ae(i))},ve=a=>{const{touches:i}=a;if(r.move(a),o.moving){const{deltaX:n,deltaY:u}=r,x=n.value+w,z=u.value+I;if((e.vertical?r.isVertical()&&Math.abs(z)>h.value:r.isHorizontal()&&Math.abs(x)>f.value)&&!N){o.moving=!1;return}N=!0,j(a,!0),o.moveX=Y(x,-f.value,f.value),o.moveY=Y(z,-h.value,h.value)}if(o.zooming&&(j(a,!0),i.length===2)){const n=ae(i),u=s*n/C;y=_e(i),R(u,y)}},J=a=>{var i;const n=(i=d.value)==null?void 0:i.$el,u=n.firstElementChild,x=a.target===n,z=u==null?void 0:u.contains(a.target);!e.closeOnClickImage&&z||!e.closeOnClickOverlay&&x||v("close")},me=a=>{if(t>1)return;const i=Date.now()-G,n=250;r.isTap.value&&(i<n?e.doubleScale?B?(clearTimeout(B),B=null,X()):B=setTimeout(()=>{J(a),B=null},n):J(a):i>Ce&&v("longPress"))},Q=a=>{let i=!1;if((o.moving||o.zooming)&&(i=!0,o.moving&&w===o.moveX&&I===o.moveY&&(i=!1),!a.touches.length)){o.zooming&&(o.moveX=Y(o.moveX,-f.value,f.value),o.moveY=Y(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,w=0,I=0,s=1,o.scale<1&&S();const n=+e.maxZoom;o.scale>n&&R(n,y)}j(a,i),me(a),r.reset()},p=()=>{const{rootWidth:a,rootHeight:i}=e,n=i/a,{imageRatio:u}=o;O.value=o.imageRatio>n&&u<te,g.value=o.imageRatio>n&&u>=te,g.value&&(P=(u*a-i)/2,o.moveY=P,o.initializing=!0,Pe(()=>{o.initializing=!1})),S()},ee=a=>{const{naturalWidth:i,naturalHeight:n}=a.target;o.imageRatio=n/i,p()};return L(()=>e.active,S),L(()=>e.show,a=>{a||S()}),L(()=>[e.rootWidth,e.rootHeight],p),Ie("touchmove",ve,{target:D(()=>{var a;return(a=d.value)==null?void 0:a.$el})}),re({resetScale:S}),()=>{const a={loading:()=>c(be,{type:"spinner"},null)};return c(Xe,{ref:d,class:F("swipe-item"),onTouchstartPassive:ue,onTouchend:Q,onTouchcancel:Q},{default:()=>[m.image?c("div",{class:F("image-wrap")},[m.image({src:e.src,onLoad:ee,style:b.value})]):c(De,{ref:l,src:e.src,fit:"contain",class:F("image",{vertical:O.value}),style:b.value,onLoad:ee},a)]})}}});const[We,E]=q("image-preview"),Ne=["show","teleport","transition","overlayStyle","closeOnPopstate"],Ae={show:Boolean,loop:k,images:Re(),minZoom:M(1/3),maxZoom:M(3),overlay:k,vertical:Boolean,closeable:Boolean,showIndex:k,className:oe,closeIcon:W("clear"),transition:String,beforeClose:Function,doubleScale:k,overlayClass:oe,overlayStyle:Object,swipeDuration:M(300),startPosition:M(0),showIndicators:Boolean,closeOnPopstate:k,closeOnClickImage:k,closeOnClickOverlay:k,closeIconPosition:W("top-right"),teleport:[String,Object]};var je=V({name:We,props:Ae,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:v,slots:m}){const o=T(),r=T(),l=se({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),d=()=>{if(o.value){const s=ce(o.value.$el);l.rootWidth=s.width,l.rootHeight=s.height,o.value.resize()}},O=s=>v("scale",s),g=s=>v("update:show",s),P=()=>{Le(e.beforeClose,{args:[l.active],done:()=>g(!1)})},b=s=>{s!==l.active&&(l.active=s,v("change",s))},f=()=>{if(e.showIndex)return c("div",{class:E("index")},[m.index?m.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},h=()=>{if(m.cover)return c("div",{class:E("cover")},[m.cover()])},R=()=>{l.disableZoom=!0},S=()=>{l.disableZoom=!1},X=()=>c($e,{ref:o,lazyRender:!0,loop:e.loop,class:E("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:b,onDragEnd:S,onDragStart:R},{default:()=>[e.images.map((s,C)=>c(Me,{ref:y=>{C===l.active&&(r.value=y)},src:s,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:O,onClose:P,onLongPress:()=>v("longPress",{index:C})},{image:m.image}))]}),t=()=>{if(e.closeable)return c(ne,{role:"button",name:e.closeIcon,class:[E("close-icon",e.closeIconPosition),Ye],onClick:P},null)},w=()=>v("closed"),I=(s,C)=>{var y;return(y=o.value)==null?void 0:y.swipeTo(s,C)};return re({resetScale:()=>{var s;(s=r.value)==null||s.resetScale()},swipeTo:I}),ie(d),L([ze,ke],d),L(()=>e.startPosition,s=>b(+s)),L(()=>e.show,s=>{const{images:C,startPosition:y}=e;s?(b(+y),U(()=>{d(),I(+y,{immediate:!0})})):v("close",{index:l.active,url:C[l.active]})}),()=>c(Oe,K({class:[E(),e.className],overlayClass:[E("overlay"),e.overlayClass],onClosed:w,"onUpdate:show":g},Te(e,Ne)),{default:()=>[t(),X(),f(),h()]})}});const Ke=le(je);export{Ke as I,De as a,je as s};

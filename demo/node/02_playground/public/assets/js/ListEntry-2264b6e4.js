import{d as C,r as f,c as E,o as d,f as k,k as V,i as p,B as v,F as A,w as r,g as M,b as g,m as P,t as T,l as h,E as N,ab as O,ac as H,q,br as z,bw as G,U,_ as R,d5 as J,z as Q,a9 as K,e as W,bh as j,bH as L,aT as X,c3 as Z,bC as ee,ca as te,bb as ae,v as se,C as le,be as ie,dt as ne,y as re,bD as oe,cO as de}from"./index-b80d5ef5.js";import{a as Y}from"./LoadingData-195d0581.js";import{M as ue}from"./Designer.vue_vue_type_script_setup_true_lang-3c7dafd1.js";import{u as B,L as pe,D as me,p as S,d as ce}from"./usePublicRelease-2335b254.js";/* empty css                          */import{Q as _e}from"./Qrcode-850531ac.js";import{L as ve,D as fe}from"./DesignerDialog-22d70853.js";import{C as ye}from"./CardTabs-ca59b5e9.js";import{P as be}from"./PageContainer-f97fee2b.js";import{u as ge,a as De}from"./routePage-d8a1866d.js";import{g as we}from"./index-c4a56c4a.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";import"./form-success-1777d0da.js";import"./keyBy-8fcfdd74.js";import"./_createAggregator-d66ed64c.js";import"./el-dropdown-item-455a6589.js";import"./TableRender-bab4d661.js";import"./Resize-eb80395d.js";import"./useQueryTab-05fa7456.js";import"./useExtractQuery-f96f705c.js";import"./FormShare-9773b44c.js";import"./dataShare-2d7ae3f7.js";import"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import"./useFieldMaxWidth-d82f063e.js";import"./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js";import"./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js";import"./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js";import"./index-318b68f4.js";import"./AzInputNumber-d6212644.js";import"./el-input-number-c15b1cc7.js";import"./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js";import"./useMultipleVal-904406c1.js";import"./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js";import"./CardShowFieldItem-fd24f218.js";import"./SelectDataSourece-70a968c3.js";import"./useTransformColor-38b5da33.js";import"./html2canvas.esm-0543ed55.js";import"./TemplateIcon-2baf2fac.js";import"./homePage-3523f56f.js";import"./SelectIcon-71b7daf2.js";import"./AppIconNew-704f70f4.js";import"./enum-baae9292.js";import"./store-3b56af45.js";import"./index-c8016e23.js";import"./appManage-8a2e3832.js";const Ve=C({__name:"LinkPane",setup(x){const e=B(),m=f(!1),D=E(()=>{var t;return((t=e.listDesignerDetails)==null?void 0:t.views)??[]}),y=E({get(){return e.details?[e.details.expiraStartDate,e.details.expiraEndDate]:[]},set(t){(t==null?void 0:t.length)>=2?(e.details.expiraStartDate=t[0],e.details.expiraEndDate=t[1]):(e.details.expiraStartDate="",e.details.expiraEndDate="")}}),i=E({get(){var t;return((t=e.details)==null?void 0:t.releaseView)??[]},set(t){e.details&&(e.details.releaseView=t)}}),n=E({get(){var t;return((t=e.details)==null?void 0:t.releaseAllFlag)??0},set(t){e.details&&(e.details.releaseAllFlag=t,t===0&&(e.details.releaseView=[...D.value.map(l=>l.id)]))}});return(t,l)=>{const b=N,u=O,s=H,_=q,c=z,o=G,w=U;return d(),k("div",null,[V("div",{class:"flex"},[p(_e,{style:{margin:"0 auto"},ref:"qrcodeRef",text:v(e).link,filename:"邀请成员","tip-text":"录入信息后加入我们",title:"邀请您加入我们"},null,8,["text"])]),p(ve,{class:"flex","is-refresh":""}),v(e).details?(d(),k(A,{key:0},[p(s,{"label-width":"100",label:"链接有效期",class:"mb-0 mt-10"},{default:r(()=>[p(u,{modelValue:v(e).details.expiraDateSelect,"onUpdate:modelValue":l[0]||(l[0]=a=>v(e).details.expiraDateSelect=a)},{default:r(()=>[(d(!0),k(A,null,M(v(pe),(a,I)=>(d(),g(b,{key:I,label:a.value},{default:r(()=>[P(T(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),p(s,{"label-width":"100",label:"发布视图",class:"mb-0 mt-10"},{default:r(()=>[p(_,{style:{"margin-right":"30px"},label:"全部视图","true-label":0,"false-label":1,modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value=a)},null,8,["modelValue"]),n.value===1?(d(),g(c,{key:0,modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=a=>i.value=a)},{default:r(()=>[(d(!0),k(A,null,M(D.value,a=>(d(),g(_,{disabled:i.value.length<=1&&a.id===i.value[0],key:a.id,label:a.id},{default:r(()=>[P(T(a.name),1)]),_:2},1032,["disabled","label"]))),128))]),_:1},8,["modelValue"])):h("",!0)]),_:1}),v(e).details.expiraDateSelect===v(me)?(d(),g(s,{key:0,"label-width":"100",label:"有效时间",class:"mb-0 mt-10"},{default:r(()=>[p(o,{modelValue:y.value,"onUpdate:modelValue":l[3]||(l[3]=a=>y.value=a),type:"datetimerange","range-separator":"至",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":"有效期开始时间","end-placeholder":"有效期结束时间"},null,8,["modelValue"])]),_:1})):h("",!0),p(s,{"label-width":"100",label:"列表页外观设置",class:"mb-0 mt-10"},{default:r(()=>[p(w,{type:"primary",onClick:l[4]||(l[4]=a=>m.value=!0)},{default:r(()=>[P("设置列表")]),_:1})]),_:1}),v(e).details?(d(),g(fe,{key:1,visible:m.value,"onUpdate:visible":l[5]||(l[5]=a=>m.value=a)},null,8,["visible"])):h("",!0)],64)):h("",!0)])}}});const Ee=R(Ve,[["__scopeId","data-v-78ec9f1a"]]),ke=C({__name:"PublicRelease",props:{entryDetails:{},listDesignerDetails:{}},setup(x){const e=f(1),m=x,D=E(()=>{var o;return((o=m.entryDetails.appEntryVO)==null?void 0:o.id)??""}),y=f(),i=f(),n=B({mode:"design"}),t=f(!1),l=async()=>{t.value=!0;try{const o=await S.getDetails(D.value);o?e.value=o.status:e.value=1,y.value={...o},n.details={...o},i.value=L({...o}),n.listDesignerDetails={...m.listDesignerDetails}}finally{t.value=!1}},b=f(!1),s=J(async o=>{b.value=!0;try{const w=await S.save(o);n.details=L({...w}),i.value=L({...w})}finally{b.value=!1}},1e3,{maxWait:1500});Q(async()=>{b.value=!0,n.details&&i.value&&!K(i.value,n.details)&&(n.details,s(n.details))}),l();const _=f(!1),c=async()=>{var o,w;_.value=!0;try{const a=await S.updateStatus({entryId:D.value,status:((o=n.details)==null?void 0:o.status)===0?1:0});n.details=L({...a,releaseView:m.listDesignerDetails.views.map(I=>I.id),formEditJson:a.formEditJson??{...ce,name:(w=m.entryDetails.appEntryVO)==null?void 0:w.name}}),i.value=L({...a}),X(()=>{e.value=a.status})}finally{_.value=!1}};return(o,w)=>{const a=U,I=Z,$=ee,F=te;return d(),k("div",{class:"set_auth"},[W((d(),k("div",{class:"auth_body"},[p($,{class:"auth_card"},{header:r(()=>[V("div",{class:"card-header"},[V("span",{class:"header-bold mr-8"},"公开发布"),V("span",null,"公开发布启用后，将列表公开发布给应用外的用户查询"),p(j,{class:"c-switch","model-value":e.value,"update-fetch":c},null,8,["model-value"])])]),default:r(()=>[e.value?(d(),g(I,{key:1,description:"暂未启用公开发布"},{default:r(()=>[p(a,{type:"primary",loading:_.value,onClick:c},{default:r(()=>[P(" 启用 ")]),_:1},8,["loading"])]),_:1})):(d(),g(Ee,{key:0}))]),_:1})])),[[F,t.value]])])}}});const xe=R(ke,[["__scopeId","data-v-8d8b299e"]]),he=C({__name:"Drawer",props:{visible:{type:Boolean},listDesignerDetails:{}},emits:["update:visible"],setup(x,{emit:e}){const m=x,D=e,y=ae("entryId"),i=se(m,"visible",D),n=f(),t=async()=>{y&&(n.value=await ie(y))},l=[{id:"public",name:"公开发布",icon:"public",tip:"将列表公开发布给应用外的用户查询"}],b=f("public");return(u,s)=>{const _=ne;return d(),g(_,{size:"100%",title:"列表公开发布",modelValue:v(i),"onUpdate:modelValue":s[1]||(s[1]=c=>le(i)?i.value=c:null),direction:"btt",class:"public-release-drawer",style:{"background-color":"var(--az-dialog-header-bg-color)"}},{default:r(()=>[p(Y,{load:t,queryKeys:["appId","entryId"]},{default:r(()=>[u.listDesignerDetails&&n.value?(d(),k("div",{key:0,class:"form_publish"},[p(ye,{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=c=>b.value=c),"tab-list":l},null,8,["modelValue"]),V("div",{class:"publish-content"},[V("div",{class:"table_designer_page"},[p(xe,{"entry-details":n.value,"list-designer-details":u.listDesignerDetails},null,8,["entry-details","list-designer-details"])])])])):h("",!0)]),_:1})]),_:1},8,["modelValue"])}}});const Ie=R(he,[["__scopeId","data-v-5d66f1b3"]]),Le=C({__name:"ListEntry",props:{appId:{},entry:{}},setup(x){const e=x,m=ge(),D=f(),y=f(),i=f([]),n=async()=>{y.value=await de(e.entry.id,m.manager),i.value=y.value.views};re(()=>e.entry.id,()=>{var u;return(u=D.value)==null?void 0:u.reload()});const t=E(()=>{if(!m.appAuth)return[];if(m.appAuth.appEntryRuleVos){const u=m.appAuth.appEntryRuleVos.filter(s=>s.entryId===e.entry.id);return i.value.map(s=>{var _,c;return{[s.id]:((c=(_=u.find(o=>o.viewId===s.id))==null?void 0:_.operAuth)==null?void 0:c.split(","))??[]}})}else return i.value.map(u=>({[u.id]:we("view").split(",")}))}),l=f(!1),b=E(()=>m.getOperatingPremission(De.design));return(u,s)=>{const _=U;return d(),g(be,{entry:u.entry},{header:r(()=>[V("span",{style:{"margin-left":"auto"}},[v(b)?(d(),g(_,{key:0,class:"header-btn",text:"",icon:v(oe),type:"primary",onClick:s[0]||(s[0]=c=>l.value=!0)},{default:r(()=>[P(" 公开发布 ")]),_:1},8,["icon"])):h("",!0)])]),default:r(()=>[V("div",{class:"list_entry"},[p(Y,{class:"list_entry-container",ref_key:"loadingDataRef",ref:D,load:n},{default:r(()=>[(d(),g(ue,{views:i.value,"onUpdate:views":s[1]||(s[1]=c=>i.value=c),options:{appId:e.appId,entryId:u.entry.id,sheetName:u.entry.name},key:u.entry.id,isEditPremission:v(b),auth:v(t)},null,8,["views","options","isEditPremission","auth"])),p(Ie,{visible:l.value,"onUpdate:visible":s[2]||(s[2]=c=>l.value=c),listDesignerDetails:y.value},null,8,["visible","listDesignerDetails"])]),_:1},512)])]),_:1},8,["entry"])}}});const wt=R(Le,[["__scopeId","data-v-fbbe7619"]]);export{wt as default};

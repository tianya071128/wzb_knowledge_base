import{d as P,v as J,r as m,bK as j,o as c,b as w,w as o,i as a,bu as H,B as b,C as K,bv as Q,id as D,Q as G,ac as X,bm as Z,c as L,nn as ee,W as le,k as S,t as z,f as C,F as B,g as M,m as W,c1 as te,l as R,a as E,dC as ae,q as oe,P as ne,dD as se,nh as re,g2 as ie,_ as de,ii as ue,x as pe,bh as ce,by as me,as as fe,bi as _e,a5 as be,a1 as ye,b4 as $,zc as O,U as ve}from"./index-b80d5ef5.js";import{u as he}from"./useExtractQuery-f96f705c.js";import{E as ge,a as Fe,b as we}from"./el-dropdown-item-455a6589.js";import{g as Ie}from"./index-20639231.js";import{N as U}from"./enum-7a2ae6a9.js";const ke=P({__name:"EditName",props:{visible:{type:Boolean},editInfo:{}},emits:["update:visible","refresh"],setup(V,{emit:y}){const n=V,v=y,r=J(n,"visible",v),i=m({id:"",title:"",remark:""}),h=m(),g=j({title:[{required:!0,message:"请输入流程名称",trigger:"blur"},{min:3,max:15,message:"名称长度3~15个字符",trigger:"blur"}],remark:[{min:3,max:200,message:"名称长度3~200个字符",trigger:"blur"}]}),f=async()=>{n.editInfo&&(i.value={...n.editInfo})},u=async()=>{var p;await((p=h.value)==null?void 0:p.validate()),await D.editFlowInfo(i.value),v("refresh")};return(p,s)=>{const l=G,d=X,e=Z;return c(),w(Q,{modelValue:b(r),"onUpdate:modelValue":s[3]||(s[3]=t=>K(r)?r.value=t:null),showLoad:f},{footer:o(()=>[a(H,{editMode:!0,onClose:s[2]||(s[2]=t=>r.value=!1),"on-submit":u})]),default:o(()=>[a(e,{ref_key:"ruleFormRef",ref:h,model:i.value,rules:b(g),"label-width":"100px"},{default:o(()=>[a(d,{label:"流程名称",prop:"title"},{default:o(()=>[a(l,{modelValue:i.value.title,"onUpdate:modelValue":s[0]||(s[0]=t=>i.value.title=t)},null,8,["modelValue"])]),_:1}),a(d,{label:"说明",prop:"remark"},{default:o(()=>[a(l,{modelValue:i.value.remark,"onUpdate:modelValue":s[1]||(s[1]=t=>i.value.remark=t),rows:5,type:"textarea",placeholder:"请输入说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),Ve=P({__name:"FieldsAuth",props:{fields:{},fieldsAuth:{}},setup(V){const y=V,n=L(()=>ee(y.fields)),v=L(()=>{let l=1;return le(n.value,"fields",(d,e)=>{l=Math.max(l,e.length)}),Math.max(Math.min(300,l*12+44+100))}),r=(l,d)=>{var t;const e=re(d.type);return((t=l.ignoreFieldAuth)==null?void 0:t.call(l,d,e,ie(d.fieldId,n.value)))===!0},i=(l,d)=>{var e;return((e=l.children)==null?void 0:e.filter(t=>!r(t,d)))??[]},g=[{label:"可见",prop:"readable",children:[{label:"可下载文件",prop:"download",ignoreFieldAuth(l){return l.type!==E.uploadFile}}]},{label:"可编辑",prop:"writeable",children:[{prop:"add_template",label:"可新增",ignoreFieldAuth(l){return l.type!==E.templateFile}},{prop:"delete_template",label:"可删除",ignoreFieldAuth(l){return l.type!==E.templateFile}},{prop:"design_template",label:"可设计模版",ignoreFieldAuth(l){return l.type!==E.templateFile}},{prop:"entry_template",label:"可填写",ignoreFieldAuth(l){return l.type!==E.templateFile}},{prop:"preview_template",label:"可预览",ignoreFieldAuth(l){return l.type!==E.templateFile}}]},{label:"必填",prop:"required"},...[{label:"摘要",prop:"summary"}]],f=[U.Approval,U.StartEvent,U.CC],u=L(()=>y.fieldsAuth.filter(l=>f.includes(l.type))),p=(l,d)=>l===U.StartEvent?d.prop==="summary":!0,s=(l,d,e)=>{const t=d.find(I=>I.id===l);return t?Ie(t)[e]??!1:!1};return(l,d)=>{const e=ae,t=oe,x=ne,I=ge,k=Fe,N=we,Y=se;return c(),w(Y,{data:b(n),border:"",style:{width:"100%",height:"100%"},stripe:"","tree-props":{children:"fields"},"row-key":"fieldId","default-expand-all":"",class:"field_auth"},{default:o(()=>[a(e,{fixed:"",prop:"date",label:"",width:b(v)},{default:o(({row:_})=>[S("div",{class:"field_auth-label"},z(_.options.label),1)]),_:1},8,["width"]),(c(!0),C(B,null,M(b(u),_=>(c(),w(e,{key:_.nodeId,label:_.name},{default:o(()=>[(c(),C(B,null,M(g,F=>(c(),C(B,{key:F.prop},[p(_.type,F)?(c(),w(e,{key:0,prop:F.prop,label:F.label},{default:o(({row:A})=>{var q;return[S("div",{class:"field_auth-label"},[a(t,{"true-label":"0","false-label":"0",disabled:!s(A.fieldId,_.fields,F.prop),checked:s(A.fieldId,_.fields,F.prop)},null,8,["disabled","checked"]),(q=i(F,A))!=null&&q.length?(c(),w(N,{key:0},{dropdown:o(()=>[a(k,null,{default:o(()=>[(c(!0),C(B,null,M(F.children,T=>(c(),w(I,{key:T.prop},{default:o(()=>[a(t,{"true-label":"0","false-label":"0",disabled:!s(A.fieldId,_.fields,T.prop),checked:s(A.fieldId,_.fields,T.prop)},{default:o(()=>[W(z(T.label),1)]),_:2},1032,["disabled","checked"])]),_:2},1024))),128))]),_:2},1024)]),default:o(()=>[S("span",{class:"el-dropdown-link"},[a(x,{class:"el-icon--right"},{default:o(()=>[a(b(te))]),_:1})])]),_:2},1024)):R("",!0)])]}),_:2},1032,["prop","label"])):R("",!0)],64))),64))]),_:2},1032,["label"]))),128))]),_:1},8,["data"])}}});const xe=de(Ve,[["__scopeId","data-v-3d610c0a"]]),Ee=P({__name:"ViewFieldsAuth",props:{visible:{type:Boolean},entryId:{},dataId:{}},emits:["update:visible"],setup(V,{emit:y}){const n=V,r=J(n,"visible",y),i=m([]),h=m([]),g=async()=>{var p;if(!(n!=null&&n.dataId))return;const f=await D.getFlowNodeField(n.dataId),u=await ue(n.entryId??"");i.value=((p=u==null?void 0:u.formJson)==null?void 0:p.fields)??[],h.value=f};return(f,u)=>(c(),w(Q,{size:"90%",title:"查看字段权限",modelValue:b(r),"onUpdate:modelValue":u[0]||(u[0]=p=>K(r)?r.value=p:null),showLoad:g},{default:o(()=>[i.value?(c(),w(xe,{key:0,fields:i.value,fieldsAuth:h.value},null,8,["fields","fieldsAuth"])):R("",!0)]),_:1},8,["modelValue"]))}}),Be=P({__name:"flowList",setup(V){const y=pe(),n=m(),v=()=>{var e;(e=n.value)==null||e.refresh()},r=he("appId"),i=m(),h=async()=>r.value?(await y.getForm(r.value)).filter(t=>t.type===ye.form&&t.hasFlow).map(t=>({label:t.name,value:t.id})):[],g=m(),f=m(!1),u=m(),p=m(),s=m(!1),l=()=>{$(O,{query:{appId:r.value}})},d=L(()=>({id:"lowCode_wFlowList",query:{list:[{type:"input",label:"流程名称",prop:"flowName"},{type:"select",label:"关联表单",prop:"entryId",options:h,isAll:!0}]},request:{api:D.pageFlowList,extraParams:{appId:r.value}},table:{tableCols:[{label:"流程名称",prop:"title",showOverflowTooltip:!0},{label:"关联表单",prop:"entryName",showOverflowTooltip:!0},{label:"说明",prop:"remark",showOverflowTooltip:!0},{label:"创建人",prop:"createUserName"},{label:"创建时间",prop:"createTime"},{prop:"enabled",width:80,label:"状态",slots:{default({row:e}){return a(ce,{activeValue:!0,inactiveValue:!1,modelValue:e.enabled,"onUpdate:modelValue":t=>e.enabled=t,updateFetch:()=>D.updateState(e.id)},null)}}},{prop:"state",width:80,label:"发布状态",slots:{default({row:e}){return a(me,{type:String(e.state)==="2"?"success":"info"},{default:()=>[String(e.state)==="2"?"已发布":"未发布"]})}}},{fixed:"right",width:200,label:"操作",slots:{default({row:e}){const t=async()=>{$(O,{query:{appId:r.value,flowId:e.flowId}})},x=async()=>{p.value={id:e.id,title:e.title,remark:e.remark},s.value=!0},I=async()=>{g.value=e.id,u.value=e.entryId,f.value=!0},k=async()=>{await D.deleteFlow(e.id),v()},N=[{id:"1",type:"primary",onClick:t,text:"设计"},{id:"2",type:"primary",onClick:x,text:"编辑"},{id:"3",type:"primary",onClick:I,text:"查看字段权限"}];return e.enabled||N.push({id:"4",type:"danger",text:"删除",popconfirmProps:{title:"删除后，将不可恢复，确认要删除？",confirm:k}}),a(fe,{key:e.id,num:3,list:N},null)}}}]},operation:{fullEl:i}}));return(e,t)=>{const x=ve,I=_e("az-page");return c(),C("div",{ref_key:"pendingRef",ref:i,class:"layout_box"},[a(I,{config:b(d),ref_key:"azPageRef",ref:n},{operation:o(()=>[a(x,{type:"primary",icon:b(be),onClick:l},{default:o(()=>[W(" 新增流程 ")]),_:1},8,["icon"])]),_:1},8,["config"]),a(ke,{visible:s.value,"onUpdate:visible":t[0]||(t[0]=k=>s.value=k),"edit-info":p.value,onRefresh:v},null,8,["visible","edit-info"]),a(Ee,{visible:f.value,"onUpdate:visible":t[1]||(t[1]=k=>f.value=k),entryId:u.value,dataId:g.value},null,8,["visible","entryId","dataId"])],512)}}});export{Be as default};

import{d as F,r as I,c as N,ag as O,o as m,b as P,ad as S,w as o,k as p,i as r,m as T,t as x,B as g,eu as w,a4 as L,f as h,l as R,F as z,g as A,ex as U,ew as $,m4 as j,aN as G,eJ as H,U as M,eB as K,bC as Q,_ as q,m5 as W,fA as X,aa as Y,m6 as Z}from"./index-b80d5ef5.js";import{d as ee,E as ae}from"./EditDraft-5267672c.js";const te=F({__name:"DraftCard",props:{data:{}},emits:["edit","refresh"],setup(D,{emit:E}){const d=D,c=E,C=I(!1),k=async()=>{c("edit",{entryId:d.data.entryId,draftId:d.data.id,draftEditData:_.value})},v=async()=>{await j(d.data.id),G.success("删除成功"),c("refresh")},_=N(()=>B(d.data)),i=N(()=>{var n,a;return(a=O((n=d.data)==null?void 0:n.formJson.fields))==null?void 0:a.map(e=>{var t;return{...e,label:e.options.label,value:(t=_.value)==null?void 0:t[e.fieldId]}}).filter(e=>e.type!=="subform").splice(0,5)}),B=n=>{const a={};for(const e in n){const t=e.indexOf("-");t>-1&&(a[e.slice(t+1)]=n[e],n[e]instanceof Array&&(a[e.slice(t)]=n[e].map(l=>{for(const f in l){const y=f.indexOf("-");l[f.slice(y+1)]=l[f]}return l})))}return a};return(n,a)=>{var y;const e=H,t=M,l=K,f=Q;return m(),P(f,{class:"drafts-card"},S({default:o(()=>{var s,u,V;return[(s=i.value)!=null&&s.length?R("",!0):(m(),h("div",{key:0,class:"card-header"},[p("header",null,[r(e,{tag:"b"},{default:o(()=>{var b;return[T(x(((b=n.data)==null?void 0:b.formName)??"-"),1)]}),_:1})]),p("span",{class:"mr-10 time"},x(((u=n.data)==null?void 0:u.createTime)??""),1),p("div",null,[r(t,{type:"primary",icon:g(w),circle:"",text:"",loading:g(C),size:"small",onClick:k},null,8,["icon","loading"]),r(l,{title:"删除后数据不可恢复，确认要删除?",onConfirm:v},{reference:o(()=>[r(t,{text:"",circle:"",type:"danger",size:"small",icon:g(L)},null,8,["icon"])]),_:1})])])),(V=i.value)!=null&&V.length?(m(),h("div",{key:1,class:"descriptions"},[(m(!0),h(z,null,A(i.value,(b,J)=>(m(),h("div",{class:"descriptions-item",key:J},[p("span",{class:"label"},x(b.label)+":",1),r(U,{mode:g($).list,content:b.value,field:b},null,8,["mode","content","field"])]))),128))])):R("",!0)]}),_:2},[(y=i.value)!=null&&y.length?{name:"header",fn:o(()=>{var s;return[p("div",{class:"card-header"},[p("header",null,[r(e,{tag:"b"},{default:o(()=>{var u;return[T(x(((u=n.data)==null?void 0:u.formName)??"-"),1)]}),_:1})]),p("span",{class:"mr-10 time"},x(((s=n.data)==null?void 0:s.createTime)??""),1),p("div",null,[r(t,{type:"primary",icon:g(w),circle:"",text:"",loading:g(C),onClick:k},null,8,["icon","loading"]),r(l,{title:"删除后数据不可恢复，确认要删除?",onConfirm:v},{reference:o(()=>[r(t,{text:"",circle:"",type:"danger",icon:g(L)},null,8,["icon"])]),_:1})])])]}),key:"0"}:void 0]),1024)}}});const ne=q(te,[["__scopeId","data-v-ddf70bbf"]]),re=F({__name:"routePage",props:{appId:{}},setup(D){const E=I(),d=I(),c=D,C=I([{type:"input",label:"业务类型",prop:"formName"},{type:"input",label:"应用名称",prop:"appName"},{type:"timerange",label:"创建时间",prop:["startTime","endTime"]}]),k=N(()=>({id:"lowcode_drafts",query:{list:c.appId?C.value.filter(a=>a.prop!=="appName"):C.value},table:{tableCols:[]},request:{api:async a=>{const e=await W({...a,appId:c==null?void 0:c.appId});return{...e,records:ee(e.records)}}},operation:{fullEl:d}})),v=()=>{var a;(a=E.value)==null||a.refresh()},_=I({entryId:"",draftId:""}),i=I(!1),B=async a=>{_.value=a,i.value=!0},n=async()=>{Y.confirm("清空后数据不可恢复，确认要清空？",{type:"warning",confirmButtonText:"确认",cancelButtonText:"取消",beforeClose(a,e,t){a==="confirm"?(e.confirmButtonLoading=!0,Z({appId:c.appId??""}).then(()=>{e.confirmButtonLoading=!1,v(),t()}).catch(()=>{e.confirmButtonLoading=!1,t()})):t()}})};return(a,e)=>{var l,f,y;const t=M;return m(),h("div",{ref_key:"pendingRef",ref:d,class:"layout_box"},[r(X,{ref_key:"azPageRef",ref:E,config:k.value},{operation:o(()=>[r(t,{type:"warning",onClick:n},{default:o(()=>[T("清空草稿箱")]),_:1})]),table:o(({tableData:s})=>[(m(!0),h(z,null,A(s,u=>(m(),P(ne,{key:u.id,data:u,onEdit:B,onRefresh:v},null,8,["data"]))),128))]),_:1},8,["config"]),r(ae,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=s=>i.value=s),onRefresh:v,entryId:(l=_.value)==null?void 0:l.entryId,draftId:(f=_.value)==null?void 0:f.draftId,formData:(y=_.value)==null?void 0:y.draftEditData},null,8,["modelValue","entryId","draftId","formData"])],512)}}});const oe=q(re,[["__scopeId","data-v-a53c3502"]]);export{oe as default};

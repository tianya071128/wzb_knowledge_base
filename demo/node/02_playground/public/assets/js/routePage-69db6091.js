import{d as N,r as d,bI as U,bx as te,aT as z,o as g,f as S,k as D,i as p,cI as q,_ as Y,bp as ce,t1 as pe,bi as le,b as M,v as G,B,C as se,c as ee,w as k,t as Q,F as oe,g as ne,m as L,l as J,p as ue,c1 as me,t3 as ve,P as H,t2 as fe,J as be,lE as _e,uN as he,U as X,Q as ye,bJ as Ae,bu as De,e as O,S as ae,bv as ge,uO as we,uP as ke,uQ as Ee,aN as W,d2 as Ce,d3 as Te,iC as Ie,ae as xe,rT as Re,cf as Me,cc as j,sl as Be,rW as Pe,uR as Se,tq as Ne,bh as Ve,as as Ke,uS as Je,uT as Fe,uU as ze,bH as Le}from"./index-b80d5ef5.js";import{R as Qe}from"./RoleAddAndEdit-9b2fe5c2.js";import{l as P}from"./lodash-ae95bc60.js";import{E as We,a as Ye,b as je}from"./el-dropdown-item-455a6589.js";import{_ as Oe}from"./SelectOrg.vue_vue_type_script_setup_true_lang-3e503345.js";function Z(_){let l=[];for(const n of _){const{children:e,...t}=n;l.push({...t}),e&&e.length>0&&(l=l.concat(Z(e)))}return l}const re=(_,l)=>{const n=[],e={};for(const t of _){const i=t.id,o=t.parentId;e[i]||(e[i]={children:[]}),e[i]={...t,children:e[i].children};const m=e[i];l.includes(o)?n.push(m):(e[o]||(e[o]={children:[]}),e[o].children.push(m))}return n},Ue=N({__name:"button-permissions",props:{menuTree:{},roleDisable:{type:Boolean}},setup(_){const l=_,n=d(),e=d(U("RoleAuthData")),t=d([]),i=d(!0),o=d([]),m={children:"children",label:"name",disabled:"disabled"};te(()=>{o.value=e.value.menuIds,t.value=b(P.cloneDeep(P.map(P.pick(P.keyBy(l.menuTree,"id"),e.value.menuIds),u=>u))),z(()=>{setTimeout(()=>{i.value=!1},500)})});function b(u){return u.filter(a=>{a.children=b(a==null?void 0:a.children),a.disabled=l.roleDisable;const v=a.type===0||a.type===1,C=e.value.menuIds.includes(a.id),c=e.value.moduleIds.includes(a.moduleId);return v&&C&&c||a.type===2})}const h=()=>{const u=n.value.getCheckedNodes(!1,!0).map(a=>a.id);e.value.menuIds=u};return(u,a)=>{const v=q;return g(),S("div",null,[D("div",{class:"title"},"为已选择的所属应用，已设定功能权限设定按钮权限"),D("div",null,[p(v,{ref_key:"elTreeRef",ref:n,data:t.value,"expand-on-click-node":!1,"check-on-click-node":!0,"check-strictly":i.value,"default-checked-keys":o.value,"default-expand-all":"",onCheckChange:h,"show-checkbox":"","node-key":"id",props:m},null,8,["data","check-strictly","default-checked-keys"])])])}}});const qe=Y(Ue,[["__scopeId","data-v-98bc038c"]]),Ge=_=>{const l=t=>re(t,["0"]),n=(t,i)=>(i??_??[]).filter(o=>t.includes(o.type));return{getMenuTree:l,getMenuByType:n,getMenu:t=>l(n([0,1],t))}},de=()=>{const _=d(),l=async()=>{_.value=await ce(pe)},n=e=>P.map(P.pick(P.keyBy(_.value,"value"),e),"label").join();return l(),{getLabel:n,load:l,dictData:_}},He=N({__name:"AuthTable",props:{tableData:{},roleDisable:{type:Boolean},DataAll:{}},emits:["delete"],setup(_,{expose:l,emit:n}){const e=_,t=n,i=d(),o=async a=>{const v=Z(e.tableData).filter(c=>Number(c.dataScope)&&Number(c.dataScope)!==e.DataAll),C=v.slice((Number(a.current)-1)*a.limit,a.current*a.limit);return Promise.resolve({current:"1",limit:"10",records:C,total:v.length})},m=async()=>{var a;await((a=i.value)==null?void 0:a.refresh())},b=a=>{e.roleDisable||(a.dataScope=e.DataAll,t("delete",a))},{getLabel:h}=de(),u={query:{list:[{type:"input",label:"功能权限名称",prop:"name"}]},request:{api:o},operation:{hideTableOperation:!0},table:{tableProps:{"onRow-dblclick":b},tableCols:[{prop:"moduleName",label:"所属系统"},{prop:"name",label:"菜单"},{prop:"name",label:"功能权限"},{prop:"dataScope",label:"数据权限",slots:{default({row:a}){return p("span",null,[h(a.dataScope)])}}}]}};return l({refreshTable:m}),(a,v)=>{const C=le("az-page");return g(),M(C,{ref_key:"azPageRef",ref:i,config:u},null,512)}}}),Xe=N({__name:"SetAuth",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","confirm"],setup(_,{emit:l}){const n=_,e=l,t=G(n,"visible",e),i=o=>{const m=Array.isArray(o)?o:[];e("confirm",m)};return(o,m)=>(g(),M(Oe,{"model-value":o.modelValue,"onUpdate:modelValue":i,visible:B(t),"onUpdate:visible":m[0]||(m[0]=b=>se(t)?t.value=b:null),multiple:""},null,8,["model-value","visible"]))}}),Ze="1613793396076593153",$e=N({__name:"data-permission",props:{menuDataScopes:{},authData:{},menuTree:{},id:{},roleDisable:{type:Boolean}},emits:["update:menuDataScopes"],setup(_,{emit:l}){const n=_,e=l,t=ve,i=fe,o=d(),{getMenu:m}=Ge(n.menuTree),{getLabel:b,dictData:h}=de(),u=ee(()=>{const y=n.authData.menuIds,A=n.authData.moduleIds;return n.menuTree,Z(n.menuTree).filter(r=>{const E=y.includes(r.id),R=A.includes(r.moduleId),x=r.moduleId===Ze;return E&&R&&x}).map(r=>{const E=n.menuDataScopes.find(R=>R.menuId===r.id);return r.dataScope=Number((E==null?void 0:E.dataScope)??t),r.dataAuth=(E==null?void 0:E.dataAuth)??[],r})}),a=ee(()=>m([...u.value])),v=G(n,"menuDataScopes",e),C=(y,A)=>{const r=Number(y);if(Number(r)===i)I.value=!0,T.value=A;else{const E=A.id,R=v.value.find(x=>x.menuId===E);R?R.dataScope=r:v.value.push({menuId:E,dataScope:r,dataAuth:[]}),z(()=>{var x;(x=o.value)==null||x.refreshTable()})}},c=y=>{const A=y.id;v.value=v.value.filter(r=>r.menuId!==A),z(()=>{var r;(r=o.value)==null||r.refreshTable()})},w=d(new Set),s=y=>{w.value.add(y.id)},f=(y,A)=>{},I=d(!1),T=d(),K=y=>{var R;const A=(R=T.value)==null?void 0:R.id;if(!A)return;const r=y.length>=1?i:t,E=v.value.find(x=>x.menuId===A);E?(E.dataScope=r,E.dataAuth=y):v.value.push({menuId:A,dataScope:r,dataAuth:[...y]}),z(()=>{var x;(x=o.value)==null||x.refreshTable()})};return(y,A)=>{var $;const r=H,E=We,R=Ye,x=je,ie=q;return g(),S("div",{class:"az_layout_tree data_permission"},[D("div",{class:"az_page_tree"},[D("div",{class:"title"},"为已设置功能权限的角色设置数据权限"),p(ie,{onNodeExpand:s,onNodeCollapse:f,"default-expanded-keys":[...w.value],data:a.value,class:"role_tree--height","expand-on-click-node":!1,style:{width:"100%"},"node-key":"id",ref:"elTreeRef",props:{children:"children",label:"name"}},{default:k(({data:V})=>[D("div",{style:{width:"100%"}},[D("span",null,Q(V.name),1),V.level!==1?(g(),M(x,{key:0,class:"dropdown_item",onCommand:F=>C(F,V)},{dropdown:k(()=>[n.roleDisable?J("",!0):(g(),M(R,{key:0},{default:k(()=>[(g(!0),S(oe,null,ne(B(h),F=>(g(),M(E,{key:F.value,command:F.value},{default:k(()=>[L(Q(F.label),1)]),_:2},1032,["command"]))),128))]),_:1}))]),default:k(()=>[D("div",{class:ue(["dropdown_item_link",Number(V.dataScope)!==0&&"text-color"])},[D("span",{style:{"margin-right":"10px"}},Q(B(b)(String(V.dataScope))),1),p(r,null,{default:k(()=>[p(B(me))]),_:1})],2)]),_:2},1032,["onCommand"])):J("",!0)])]),_:1},8,["default-expanded-keys","data"]),p(Xe,{modelValue:($=T.value)==null?void 0:$.dataAuth,visible:I.value,"onUpdate:visible":A[0]||(A[0]=V=>I.value=V),onConfirm:K},null,8,["modelValue","visible"])]),D("div",{class:"az_page_table"},[D("div",{class:"title sub_title"},[L(" 权限列表 "),D("span",{class:"sub_title_text"}," （双击即取消，与左边组织树权限设置实现联动） ")]),p(He,{ref_key:"AuthTableRef",ref:o,roleDisable:y.roleDisable,tableData:a.value,DataAll:B(t),onDelete:c},null,8,["roleDisable","tableData","DataAll"])])])}}});const ea=Y($e,[["__scopeId","data-v-d3334b50"]]),aa=N({__name:"function-permission",props:{menuTree:{},roleDisable:{type:Boolean}},setup(_){const l=_,n=d(),e=d(U("RoleAuthData")),t=d([]),i=d(!0),o=d([]);function m(u){return u.filter(a=>(a.children=m(a==null?void 0:a.children),a.disabled=l.roleDisable,a.type===0||a.type===1))}te(()=>{o.value=e.value.menuIds,t.value=m(P.cloneDeep(l.menuTree.filter(u=>e.value.moduleIds.includes(u.moduleId)))),z(()=>{setTimeout(()=>{i.value=!1},500)})});const b={children:"children",label:"name",disabled:"disabled"},h=(u,a,v)=>{v&&!e.value.menuIds.includes(u.id)&&e.value.menuIds.push(u.id),a&&!e.value.menuIds.includes(u.id)&&e.value.menuIds.push(u.id),!a&&!v&&e.value.menuIds.includes(u.id)&&(e.value.menuIds=e.value.menuIds.filter(C=>C!==u.id))};return(u,a)=>{const v=q;return g(),S("div",null,[D("div",{class:"title"},"为已选择的所属应用设定功能权限"),D("div",null,[p(v,{ref_key:"elTreeRef",ref:n,"check-on-click-node":!0,"expand-on-click-node":!1,data:t.value,"default-checked-keys":o.value,"default-expand-all":"","check-strictly":i.value,onCheckChange:h,"show-checkbox":"","node-key":"id",props:b},null,8,["data","default-checked-keys","check-strictly"])])])}}});const ta=Y(aa,[["__scopeId","data-v-252f957f"]]),la="data:image/png;base64,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",sa=""+new URL("../png/module_message-3544a9e9.png",import.meta.url).href,oa=""+new URL("../png/module_workbench-64b2a83c.png",import.meta.url).href,na=N({__name:"module",props:{id:{},roleDisable:{type:Boolean}},setup(_){const l=_,n=d(U("RoleAuthData")),e=d(""),t=d(),i=async()=>{const h=await he(l.id);t.value=h,t.value};i();const o=h=>{const u=h;return n.value.moduleIds.includes(u)},m=h=>{if(l.roleDisable)return;const u=h;o(u)?P.remove(n.value.moduleIds,a=>a===u):n.value.moduleIds.push(u)},b={"/system":la,"/work":oa,"/user":sa};return(h,u)=>{const a=X,v=ye,C=H;return g(),S("div",{class:"module_layout"},[p(v,{modelValue:e.value,"onUpdate:modelValue":u[0]||(u[0]=c=>e.value=c),style:{width:"300px"},onBlur:i,placeholder:"请输入系统名关键字搜索"},{append:k(()=>[p(a,{icon:B(be)},null,8,["icon"])]),_:1},8,["modelValue"]),D("div",{class:"module_box"},[(g(!0),S(oe,null,ne(t.value,c=>(g(),S("div",{class:ue(["module_item",h.roleDisable&&"isDis",o(c.id)&&"isActive"]),key:c.id,onClick:w=>m(c.id)},[D("label",null,[p(C,null,{default:k(()=>[p(B(_e))]),_:1})]),D("div",{class:"module_img_box"},[D("img",{src:b[c.modulePath],alt:"logo"},null,8,["src"])]),D("span",null,Q(c.systemName),1)],10,["onClick"]))),128))])])}}});const ua=Y(na,[["__scopeId","data-v-5a9dcdb9"]]),ra=N({__name:"RoleAuth",props:{drawerModel:{type:Boolean},rowData:{},roleDisable:{type:Boolean}},emits:["update:drawerModel"],setup(_,{emit:l}){const n=l,e=_,t=d(0),i=d(!1),o=d({menuIds:[],moduleIds:[],menuDataScopes:[]}),m=d([]),b=d();Ae("RoleAuthData",o);const h=G(e,"drawerModel",n),u=async()=>{const c=await we(e.rowData.id);o.value={...c,menuDataScopes:c.menuDataScopes.map(s=>{const f=Array.isArray(s.dataAuth)?s.dataAuth??[]:JSON.parse(s.dataAuth);return{...s,dataAuth:f}})};const w=await ke(e.rowData.id);m.value=re(w,["0"]),o.value,t.value=0,i.value=!1},a=async()=>{await Ee(o.value),W.success("授权成功")},v=()=>{var c,w;if(!((c=o.value)!=null&&c.moduleIds)||((w=o.value)==null?void 0:w.moduleIds.length)<1)return W.error("请选择模块"),!1;t.value<3&&(t.value+=1),t.value===3&&(i.value=!0)},C=()=>{t.value>0&&(t.value-=1),t.value!==3&&(i.value=!1)};return(c,w)=>{const s=Ce,f=Te,I=X;return g(),M(ge,{modelValue:B(h),"onUpdate:modelValue":w[2]||(w[2]=T=>se(h)?h.value=T:null),title:"角色授权",size:"1200px","show-load":u},{footer:k(()=>[p(De,{editMode:!0,isSubmit:i.value&&!c.roleDisable,onClose:w[1]||(w[1]=T=>h.value=!1),"on-submit":a},{first:k(()=>[O(p(I,{type:"primary",onClick:C,plain:""},{default:k(()=>[L(" 上一步 ")]),_:1},512),[[ae,t.value>0]]),O(p(I,{type:"primary",onClick:v},{default:k(()=>[L(" 下一步 ")]),_:1},512),[[ae,t.value<3]])]),last:k(()=>[]),_:1},8,["isSubmit"])]),default:k(()=>[p(f,{active:t.value,"finish-status":"success","process-status":"process",simple:""},{default:k(()=>[p(s,{title:"模块(系统)"}),p(s,{title:"功能权限"}),p(s,{title:"按钮权限"}),p(s,{title:"数据权限(选填)"})]),_:1},8,["active"]),D("div",null,[t.value===0?(g(),M(ua,{key:0,roleDisable:c.roleDisable,id:c.rowData.id},null,8,["roleDisable","id"])):J("",!0),t.value===1?(g(),M(ta,{key:1,roleDisable:c.roleDisable,menuTree:m.value},null,8,["roleDisable","menuTree"])):J("",!0),t.value===2?(g(),M(qe,{key:2,roleDisable:c.roleDisable,menuTree:m.value},null,8,["roleDisable","menuTree"])):J("",!0),t.value===3?(g(),M(ea,{key:3,menuDataScopes:o.value.menuDataScopes,"onUpdate:menuDataScopes":w[0]||(w[0]=T=>o.value.menuDataScopes=T),"auth-data":o.value,id:c.rowData.id,ref_key:"permissionRef",ref:b,roleDisable:c.roleDisable,menuTree:m.value},null,8,["menuDataScopes","auth-data","id","roleDisable","menuTree"])):J("",!0)])]),_:1},8,["modelValue"])}}}),da={name:"Role"},fa=N({...da,setup(_){let l=function(s){return s.P_ADD="system:role:add",s.P_Auth="system:role:auth",s.P_USER="system:role:user",s.P_DETAIL="system:role:detail",s.P_EDIT="system:role:edit",s.P_ENABLE="system:role:enable",s.P_DELETE="system:role:delete",s}({});const n=d(!1),e=d(!1),t=d(!1),i=d(),o=d([]),m=d("add"),b=d({}),h=d(!0),u={query:{list:[{type:"input",label:"角色名称",prop:"name"},{type:"select",label:"状态",prop:"status",options:Me,extraOptions:[{label:"全部",value:""}],initValue:j}]},request:{api:Be},table:{tableCols:[{prop:"name",label:"角色名称"},{prop:"status",label:"状态",slots:{default({row:s}){return p(Ve,{disabled:!Pe(l.P_ENABLE)||!s.editable,modelValue:s.status,"onUpdate:modelValue":f=>s.status=f,updateFetch:()=>Se({id:s.id,status:s.status==j?Ne:j})},null)}}},{fixed:"right",width:200,label:"操作",slots:{default({row:s}){const f=async()=>{await Fe(s.id),W.success("删除成功"),await a()},I=()=>{v("edit",s)},T=()=>{b.value={...s},m.value="view",n.value=!0},K=async()=>{await c(s)},y=()=>{h.value=!0,e.value=!0,b.value={...s}},A=[{id:l.P_USER,type:"primary",premission:l.P_USER,onClick:K,text:"角色成员"},{id:l.P_Auth,type:"primary",premission:l.P_Auth,onClick:()=>{e.value=!0,h.value=!1,b.value={...s}},text:"权限"},{id:l.P_EDIT,type:"primary",premission:l.P_EDIT,onClick:I,text:"编辑"},{id:`${l.P_DETAIL}_0`,type:"primary",premission:l.P_DETAIL,onClick:y,text:"查看权限"},{id:`${l.P_DETAIL}_1`,type:"primary",premission:l.P_DETAIL,onClick:T,text:"查看角色"},{id:l.P_DELETE,type:"danger",text:"删除",premission:l.P_DELETE,popconfirmProps:{title:"您确定要删除该角色吗?",confirm:f}}],r=[{id:`${l.P_USER}_2`,type:"primary",premission:l.P_USER,onClick:K,text:"角色成员"},{id:`${l.P_DETAIL}_3`,type:"primary",premission:l.P_DETAIL,onClick:y,text:"查看权限"}];return p(Ke,{num:3,list:s.editable?A:r},null)}}}]}},a=async()=>{var s;await((s=i.value)==null?void 0:s.refresh())},v=(s,f)=>{s==="add"?b.value={}:b.value={...f},m.value=s,n.value=!0},C=d([]),c=async s=>{const f=s.id;b.value=s;const I=await ze(f);o.value=I.map(T=>T.memberId),C.value=Le(I),t.value=!0},w=async s=>{const f={memberIds:o.value,roleId:b.value.id};await Je(f),W.success("保存成功")};return(s,f)=>{var A;const I=H,T=X,K=le("az-page"),y=Ie("premission");return g(),S("div",null,[p(K,{class:"layout_box",ref_key:"azPageRef",ref:i,config:u,maxHeight:"var(--az-layout-main-height) - 40px"},{operation:k(()=>[O((g(),M(T,{onClick:f[0]||(f[0]=r=>v("add")),type:"primary"},{default:k(()=>[p(I,{size:16,style:{"margin-right":"8px"}},{default:k(()=>[p(B(xe))]),_:1}),L(" 新增角色 ")]),_:1})),[[y,l.P_ADD]])]),_:1},512),p(Qe,{"drawer-model":n.value,"onUpdate:drawerModel":f[1]||(f[1]=r=>n.value=r),"row-data":b.value,onRefresh:a,"com-state":m.value},null,8,["drawer-model","row-data","com-state"]),p(ra,{"drawer-model":e.value,"onUpdate:drawerModel":f[2]||(f[2]=r=>e.value=r),"row-data":b.value,"role-disable":h.value},null,8,["drawer-model","row-data","role-disable"]),p(Re,{modelValue:o.value,"onUpdate:modelValue":f[3]||(f[3]=r=>o.value=r),visible:t.value,"onUpdate:visible":f[4]||(f[4]=r=>t.value=r),label:"角色成员","mini-title":(A=b.value)==null?void 0:A.name,multiple:!0,onChange:w,"init-options":C.value,type:"member"},null,8,["modelValue","visible","mini-title","init-options"])])}}});export{fa as default};

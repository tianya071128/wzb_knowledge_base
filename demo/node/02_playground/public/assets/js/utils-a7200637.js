import{x as j,r as B,c as C,B as G,y as _,a9 as k,lA as A,Y as E,a8 as D,a as r,eo as K,W as M}from"./index-b80d5ef5.js";const V="url";var h=(i=>(i.phone="phone",i.email="email",i))(h||{});const N=[{id:"memeber",name:"成员字段",children:[]},{id:"dept",name:"部门字段",children:[]},{id:"enterprise",name:"协作企业",children:[]},{id:"individuals",name:"协作个人",children:[]},{id:"creator",name:"发起人",children:[{id:"creator",name:"发起人"},{id:"creatorDept",name:"发起人所属部门"}]},{id:"custom",name:"自定义",children:[{id:"custom@phone@input@_input_440977421072",name:"手机号"}]}],P=async({sourceId:i,entryId:p,dataSystem:l,extraDynamicOptions:d})=>{let n=[];const t=await A({dataSystem:l,entryId:p,sourceId:i});let s=!1;if(i){const e=await l.getSoureceData(i);s=((e==null?void 0:e.forms.length)??0)>1}function a(e){return`${s&&e.entryName?e.entryName+".":""}${e.options.label}`}n=d!=null&&d.length?[...E(N),...d]:E(N);const c=[];D(t,{blockFilter(e){return e.type===r.subform},excludeFilter(e){var o,f,m,y,$,g,F,I,b,v,w,S;return e.source===K.system?!0:(e.type===r.input&&c.push(e),e.type===r.member&&((f=(o=n[0])==null?void 0:o.children)==null||f.push({name:a(e),id:`${e.fieldId}`})),e.type===r.memberSingle&&((y=(m=n[0])==null?void 0:m.children)==null||y.push({name:a(e),id:`${e.fieldId}`})),e.type===r.department&&((g=($=n[1])==null?void 0:$.children)==null||g.push({name:a(e),id:`${e.fieldId}`})),e.type===r.departmentSingle&&((I=(F=n[1])==null?void 0:F.children)==null||I.push({name:a(e),id:`${e.fieldId}`})),e.type===r.cooperateEnterprise&&((v=(b=n[2])==null?void 0:b.children)==null||v.push({name:a(e),id:`${e.fieldId}`})),e.type===r.cooperatePersonnel&&((S=(w=n[3])==null?void 0:w.children)==null||S.push({name:a(e),id:`${e.fieldId}`})),!1)}});const u=c.map(e=>({id:`custom@${h.phone}@${e.type}@${e.fieldId}`,name:`手机号（${a(e)}）`})),O=c.map(e=>({id:`custom@${h.email}@${e.type}@${e.fieldId}`,name:`邮箱（${a(e)}）`}));return n[5].children=[...u,...O],n=n.filter(e=>{var o;return(o=e.children)==null?void 0:o.length}),{dynamicOptions:n,fields:t}},W=i=>{const p=j(),l=B([]),d=C(()=>G(i)),n=async()=>{const t=await P({...d.value,dataSystem:p}),s=[];M(t.dynamicOptions,"children",(a,c)=>{!a.children&&a.id&&s.push({id:a.id,name:c.map(u=>u.name).join(" | ")})}),l.value=s};return _(()=>d.value,(t,s)=>{k(t,s)||n()},{deep:!0,immediate:!0}),{dynamicOptions:l}};export{V as a,h as c,P as g,W as u};

import{d as P,r as b,z as L,Y as B,a9 as $,iq as T,o as v,f as D,e as S,i as o,w as g,k as V,b as I,dl as M,l as x,ac as H,bC as q,ca as O,_ as E,pO as Q,B as h,C as K,m as N,c as G,dv as Y,aa as Z,aN as F,dy as j,dz as W,F as A,U as X,v as ee,y as ae,S as R,aR as te,eu as se,aS as le,aq as ne,bz as oe,t as ue,aT as ie,P as re,aU as ce,bb as C,aZ as pe,dw as de,b4 as U,bd as me,b6 as ge}from"./index-b80d5ef5.js";import{D as _e}from"./DesignerTabs-a9795edf.js";import{u as fe}from"./useQueryTab-05fa7456.js";import{a as J}from"./LoadingData-195d0581.js";import{C as ve}from"./CardTabs-ca59b5e9.js";import{A as ye}from"./App-5a74fc11.js";import"./useExtractQuery-f96f705c.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";import"./el-space-0d01b33a.js";import"./createDesigner-82222fc7.js";import"./enum-baae9292.js";import"./el-collapse-transition-4ed993c7.js";import"./el-input-number-c15b1cc7.js";/* empty css                        */import"./AzTabs.vue_vue_type_style_index_0_lang-d6635a7d.js";import"./TableChart.vue_vue_type_script_setup_true_lang-4c6079d0.js";import"./AzRadioGroup-8d978495.js";import"./enum-dc6240e9.js";import"./dashboardDesigner-ce3c2e23.js";import"./useProcessAnalysis-0a0845eb.js";const be=P({__name:"SetAuth",props:{pageDetails:{}},setup(k){const y=k,t=b(),e=b(),_=b(!1);return L(async()=>{t.value=B(y.pageDetails.memberSelect),e.value=B(y.pageDetails.memberSelect)}),L(async()=>{if(e.value&&t.value&&!$(t.value,e.value))try{_.value=!0,await T.saveHomePageAuth({...y.pageDetails,memberSelect:e.value}),t.value=B(e.value)}catch{e.value=B(t.value)}finally{_.value=!1}}),(s,u)=>{const i=H,r=q,n=O;return v(),D("div",{class:"set_auth"},[S((v(),D("div",{class:"auth_body"},[o(r,{class:"auth_card"},{header:g(()=>[V("div",{class:"card-header"},[V("span",{class:"header-bold mr-8"},"查看数据"),V("span",null,"在此分组内的成员可以访问此页面")])]),default:g(()=>[o(i,{label:"权限成员",class:"mb-0"},{default:g(()=>[e.value?(v(),I(M,{key:0,modelValue:e.value.selectedList,"onUpdate:modelValue":u[0]||(u[0]=c=>e.value.selectedList=c),class:"auth_selectpane",multiple:"",placeholder:"请选择权限成员",customStrictly:""},null,8,["modelValue"])):x("",!0)]),_:1})]),_:1})])),[[n,_.value]])])}}});const he=E(be,[["__scopeId","data-v-03382879"]]),De=P({__name:"Publish",props:{pageDetails:{}},setup(k){const y=async()=>{},t=[{id:"auth",name:"权限设置",icon:"auth",tip:"对成员发布设置成员权限"},{id:"public",name:"公开发布",icon:"public",tip:"将表单公开发布给应用外的用户填写"}],{activeTab:e}=Q(t.map(_=>_.id),{queryKey:"publishTab"});return(_,s)=>{const u=q;return v(),D("div",{class:"page_publish"},[o(ve,{modelValue:h(e),"onUpdate:modelValue":s[0]||(s[0]=i=>K(e)?e.value=i:null),"tab-list":t},null,8,["modelValue"]),V("div",{class:"publish-content"},[o(J,{load:y},{default:g(()=>[h(e)==="auth"?(v(),I(he,{key:0,pageDetails:_.pageDetails},null,8,["pageDetails"])):(v(),I(u,{key:1,class:"publish-empty"},{default:g(()=>[N(" 功能暂未开放，敬请期待... ")]),_:1}))]),_:1})])])}}});const Ve=E(De,[["__scopeId","data-v-b70044a6"]]),ke=P({__name:"Designer",props:{mode:{},scene:{},teleportTo:{},pageDetails:{}},emits:["submit"],setup(k,{expose:y,emit:t}){const e=k,_=t,s=G(()=>e.pageDetails&&e.pageDetails.pageeJson?e.pageDetails.pageeJson:Y()),u=b();y({async beforeLeave(){var f;const c=(f=u.value)==null?void 0:f.pageDesignerData();if(!(c&&$(s.value,c)))return new Promise((a,p)=>{Z.confirm("您修改了页面设计但没有保存，是否需要保存页面设计并继续？","页面设计有修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(d,l,m){d==="confirm"?(l.confirmButtonLoading=!0,r().then(()=>{m(),a()}).finally(()=>{l.confirmButtonLoading=!1})):d==="cancel"?(m(),a()):d==="close"&&(m(),p())}})})}});const i=b(!1),r=async()=>{var c;if(i.value=!0,e.pageDetails)try{const f=(c=u.value)==null?void 0:c.pageDesignerData();if(f){const{id:a,...p}=e.pageDetails,d=await T.savePageInfo({...a?e.pageDetails:p,pageeJson:f});F.success("保存成功"),_("submit",d)}}finally{i.value=!1}},n=b(!1);return(c,f)=>{var p;const a=X;return v(),D(A,null,[o(h(ye),{ref_key:"PageDesignerRef",ref:u,scene:c.scene,pageDesigner:s.value,mode:c.mode},null,8,["scene","pageDesigner","mode"]),(v(),I(j,{to:c.teleportTo},[o(a,{type:"primary",plain:"",onClick:f[0]||(f[0]=d=>n.value=!0)},{default:g(()=>[N(" 预览 ")]),_:1}),o(a,{loading:i.value,type:"primary",onClick:r},{default:g(()=>[N("保存")]),_:1},8,["loading"])],8,["to"])),o(W,{visible:n.value,"onUpdate:visible":f[1]||(f[1]=d=>n.value=d),scene:c.scene,"page-designer-data":(p=u.value)==null?void 0:p.pageDesignerData()},null,8,["visible","scene","page-designer-data"])],64)}}}),we=P({__name:"EditName",props:{modelValue:{}},emits:["update:modelValue","name"],setup(k,{emit:y}){const t=k,e=y,_=ee(t,"modelValue",e),s=b(""),u=b(!1),i=b();ae(()=>{var a;return(a=t.modelValue)==null?void 0:a.name},()=>{var a;s.value=((a=t.modelValue)==null?void 0:a.name)??""});const r=b(!1),n=async()=>{var a,p;if(t.modelValue&&s.value!==((a=t.modelValue)==null?void 0:a.name)){u.value=!0;try{(p=_.value)!=null&&p.id&&(await T.updateName({name:s.value,id:_.value.id}),F.success("名称修改成功")),e("name",s.value)}catch{s.value=t.modelValue.name}finally{u.value=!1}}r.value=!1},c=()=>{var a;(a=i.value)==null||a.blur()},f=()=>{r.value=!0,ie(()=>{var a;(a=i.value)==null||a.focus()})};return(a,p)=>{const d=re,l=ce;return v(),D(A,null,[V("div",{class:"designer-rename"},[S(o(ne,{class:"rename-input",modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=m=>s.value=m),isBlurCache:"",placeholder:"请输入名称",onBlur:n,readonly:u.value,onKeyup:le(c,["enter"]),ref_key:"renameInputRef",ref:i,maxlength:"10",title:"重命名"},{suffix:g(()=>[u.value?(v(),I(d,{key:0,class:"is-loading"},{default:g(()=>[o(h(te))]),_:1})):x("",!0)]),prefix:g(()=>[o(d,null,{default:g(()=>[o(h(se))]),_:1})]),_:1},8,["modelValue","readonly","onKeyup"]),[[R,r.value]])]),o(l,{effect:"dark",content:"重命名",placement:"bottom","show-after":200},{default:g(()=>[S(V("div",{class:"rename-display",onClick:f},[o(oe,{class:"mr-7",iconClass:"Edit",style:{fontSize:"16px",color:"#333"}}),V("span",{class:"rename-name az-ellipsis"},ue(s.value),1)],512),[[R,!r.value]])]),_:1})],64)}}});const Ie=E(we,[["__scopeId","data-v-e0a9b114"]]),z="page_designer_toolbar",Ce=P({__name:"routePage",setup(k){const y=C("appId"),t=C("pageId"),e=C("scene"),_=C("appEntryId"),s=C("type"),u=()=>{y?U(me,{replace:!0,query:{appId:y,entryId:_,manager:"1"}}):U(ge,{replace:!0})},i=[{label:"页面设计",name:"designer"},{label:"页面发布",name:"publish"}];i.map(l=>l.name);const{activeTab:r}=fe(i.map(l=>l.name),{queryKey:"pageDesignerTab"}),n=b(),c=async()=>{if(!(!t&&!s)&&t){const l=await T.getPageInfoById(t);if(l)n.value={...l};else{const m=await T.getDefaultAuth(t);n.value={id:t,icon:"b-1",color:"#478CFF",name:"未命名页面",memberSelect:(m==null?void 0:m.memberSelect)??[],pageeJson:null,type:parseInt(s??"2")}}}},f=l=>{n.value=l},a=l=>{n.value&&(n.value.name=l)},p=b(),d=async()=>{var l;return r.value==="designer"?await((l=p.value)==null?void 0:l.beforeLeave()):!0};return pe((l,m,w)=>{d().then(()=>w()).catch(()=>w(!1))}),(l,m)=>(v(),D(A,null,[o(_e,{style:{"z-index":"99","box-shadow":"0 0 8px 0 rgba(0, 0, 0, 0.1)"},modelValue:h(r),"onUpdate:modelValue":m[1]||(m[1]=w=>K(r)?r.value=w:null),tabs:h(s)==="2"?[i[0]]:i,onBack:u,"before-leave":d},{tabsName:g(()=>[o(Ie,{modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=w=>n.value=w),onName:a},null,8,["modelValue"])]),default:g(()=>[V("div",{id:z})]),_:1},8,["modelValue","tabs"]),o(J,{queryKeys:["scene","type"],path:u,ref:"loadingPageRef",class:"page_designer_page",load:c,"element-loading-background":"transparent"},{default:g(()=>[h(r)==="designer"?(v(),D("div",{key:0,class:"page_designer-container"},[o(ke,{ref_key:"PageDesignerRef",ref:p,pageDetails:n.value,scene:h(e),mode:h(de).design,teleportTo:`#${z}`,onSubmit:f},null,8,["pageDetails","scene","mode","teleportTo"])])):x("",!0),h(r)==="publish"?(v(),D("div",{key:1,class:"page_designer-container"},[n.value?(v(),I(Ve,{key:0,pageDetails:n.value},null,8,["pageDetails"])):x("",!0)])):x("",!0)]),_:1},512)],64))}});const Qe=E(Ce,[["__scopeId","data-v-1fef789e"]]);export{Qe as default};

import{d as S,r as s,cu as H,vZ as J,y as L,o as y,f as O,b,w as r,m as h,t as j,I as G,l as M,i as d,L as Z,b1 as q,B as c,C as x,bG as K,b2 as Q,F as W,v_ as X,m8 as Y,es as ee,ag as ae,a as te,m4 as le,aN as ne,U as oe,dC as se,bn as re,_ as de}from"./index-b80d5ef5.js";import{u as ie,E as fe}from"./EditDraft-5267672c.js";const ue=S({inheritAttrs:!1,__name:"FormDraft",props:{entryId:{},emptyHide:{type:Boolean}},setup(B){const i=B,{getData:R,formartTableData:T,loading:N,current:p,limit:v,total:U}=ie({entryId:i.entryId}),F=e=>{const a={};for(const l in e){const n=l.indexOf("-");n>-1&&(a[l.slice(n+1)]=e[l],e[l]instanceof Array&&(a[l.slice(n)]=e[l].map(o=>{for(const t in o){const w=t.indexOf("-");o[t.slice(w+1)]=o[t]}return o})))}return a},_=s(0),m=async()=>{_.value=await X({entryId:i.entryId})};m();const A=()=>{I.value=!0};H(J,({entryId:e})=>{e===i.entryId&&m()});const I=s(!1),f=s(),u=s([]),k=s([]),C=s();L(()=>i.entryId,()=>{var e;(e=C.value)==null||e.reload()});const D=async()=>{var e,a;if(await R(),f.value=await Y(i.entryId),f.value){const l=f.value.formAuth??ee(((e=f.value)==null?void 0:e.formJson.fields)??[]).reduce((n,o)=>({...n,[o.fieldId]:{readable:!!o.options.show}}),{});u.value=ae(((a=f.value)==null?void 0:a.formJson.fields)??[],{isSubform:!0,auth:l}),k.value=u.value.map(n=>({fieldId:n.fieldId,child:n.type===te.subform?n.fields.map(o=>({fieldId:o.fieldId})):void 0}))}},g=s(!1),E=s(""),V=s({}),$=e=>{F(e),E.value=e.id,V.value=F(e),g.value=!0},z=async e=>{await le(e),D(),m(),ne.success("删除成功")},P=()=>{D(),m()};return(e,a)=>{const l=oe,n=se,o=re;return y(),O(W,null,[e.emptyHide&&_.value===0?M("",!0):(y(),b(l,G({key:0,class:"form_draft",text:"",onClick:A},e.$attrs),{default:r(()=>[h(" 草稿箱("+j(_.value)+") ",1)]),_:1},16)),d(o,{modelValue:I.value,"onUpdate:modelValue":a[2]||(a[2]=t=>I.value=t),title:"草稿箱",width:"800","destroy-on-close":""},{default:r(()=>[d(Z,{class:"form_enter",ref_key:"loadingDataRef",ref:C,load:D},{default:r(()=>[u.value&&u.value.length?(y(),b(q,{key:0,current:c(p),"onUpdate:current":a[0]||(a[0]=t=>x(p)?p.value=t:null),limit:c(v),"onUpdate:limit":a[1]||(a[1]=t=>x(v)?v.value=t:null),loading:c(N),total:c(U),showFields:k.value,fields:u.value,data:c(T),entryId:e.entryId,"max-height":"500"},{column:r(()=>[d(n,{fixed:"right",label:"操作",width:"120"},{default:r(({row:t})=>[d(l,{link:"",type:"primary",size:"small",onClick:w=>$(t)},{default:r(()=>[h(" 编辑 ")]),_:2},1032,["onClick"]),d(K,{title:"确定要删除该条数据？",confirm:()=>z(t.id)},{reference:r(()=>[d(l,{link:"",type:"danger",size:"small"},{default:r(()=>[h("删除")]),_:1})]),_:2},1032,["confirm"])]),_:1})]),_:1},8,["current","limit","loading","total","showFields","fields","data","entryId"])):(y(),b(Q,{key:1,description:"没有可显示的字段"}))]),_:1},512)]),_:1},8,["modelValue"]),d(fe,{modelValue:g.value,"onUpdate:modelValue":a[3]||(a[3]=t=>g.value=t),onRefresh:P,entryId:e.entryId,draftId:E.value,formData:V.value},null,8,["modelValue","entryId","draftId","formData"])],64)}}});const ye=de(ue,[["__scopeId","data-v-4bba8647"]]);export{ye as default};

import{d as E,o as n,f as c,k as u,_ as S,r as b,c as I,aX as fe,F as K,b as h,B as p,ib as ve,l as g,i as a,w as r,m as x,a2 as X,nL as ye,mb as be,m9 as ge,aN as oe,U as le,aY as Ie,bf as we,h6 as ke,y as he,bX as ae,nM as Ee,hN as Ve,p as Ce,t as G,bc as De,eu as xe,bF as Re,a4 as Se,nN as $e,eA as Je,nO as Te,ae as Be,K as Pe,H as te,g as Fe,I as Me,nP as ze,cP as se,aa as Ue,nQ as Oe,nR as Ae,nS as Le,P as Ne,bn as We,eh as Ge,Q as Qe,N as qe,O as He,c3 as je,h as Xe,cR as Ke,cS as Ye,ad as Ze,cj as ea,dW as aa}from"./index-b80d5ef5.js";import{u as z,p as ta,G as sa}from"./usePublicRelease-2335b254.js";import{_ as oa}from"./form-success-1777d0da.js";import{k as la}from"./keyBy-8fcfdd74.js";import{E as na,a as ra,b as da}from"./el-dropdown-item-455a6589.js";import{u as ia,T as ua}from"./TableRender-bab4d661.js";import{S as ca}from"./SelectDataSourece-70a968c3.js";import{u as pa}from"./useTransformColor-38b5da33.js";const ma=E({__name:"Success",setup(_){return(d,t)=>(n(),c("div",{class:"form-success"},[u("img",{class:"success-img",src:oa,alt:""}),u("div",{class:"success-tip"},"提交成功")]))}});const _a=S(ma,[["__scopeId","data-v-b536fc7f"]]),fa=E({__name:"FormEntry",props:{formEditJson:{},mode:{}},setup(_){const d=_,t=b(!0),e=z(),y=I(()=>{if(e.formJson)try{return e.formJson}catch{return null}}),f=I(()=>({backgroundColor:d.formEditJson.themeColors})),i=I(()=>{var D;const w=la((D=e.details)==null?void 0:D.formFields,"fieldId");return{appId:e.appId??"",entryId:e.entryId??"",fieldAuth:{auth:w,authDefault:{readable:!1}},mode:d.mode}}),m=I(()=>e.mode!=="submit"),v=b(),k=b(),T=fe("shareId"),V=b(!1),B=async()=>{var w,C,D,U,$;if(!m.value){await((w=v.value)==null?void 0:w.validate()),V.value=!0;try{const J=await((C=v.value)==null?void 0:C.getFormDataPromise());if(J){const R={save:be(J,e.entryId),id:((D=e.details)==null?void 0:D.id)??"",phone:"",verifyCode:"",shareId:T},O=await ge({appId:e.appId??"",entryId:e.entryId??"",formData:J,dataId:""});R.flowId=O.flowId,R.creatorDept=O.creatorDept,await ta.submit(R),oe.success(((U=e.details)==null?void 0:U.submitSuccessInfo)??"提交成功!"),($=v.value)==null||$.reset(),t.value=!1}}catch{V.value=!1}finally{V.value=!1}}},Q=async()=>{var w,C;((w=e.details)==null?void 0:w.submitVerification)===sa?(C=k.value)==null||C.show():await B()};return(w,C)=>{const D=le;return n(),c("div",{class:"form-box"},[t.value?(n(),c(K,{key:0},[y.value?(n(),h(p(ve),{key:0,"form-designer":y.value,ref_key:"formRenderRef",ref:v,options:i.value},null,8,["form-designer","options"])):g("",!0),u("div",{class:"content-footer"},[a(D,{style:X(f.value),class:"btn-box",size:"large",loading:V.value,disabled:m.value,onClick:Q},{default:r(()=>[x(" 提交 ")]),_:1},8,["style","loading","disabled"]),m.value?g("",!0):(n(),h(ye,{key:0,onSuccess:B,captchaType:"blockPuzzle",imgSize:{width:"330px",height:"190px"},ref_key:"VerifyRef",ref:k},null,512))])],64)):(n(),h(_a,{key:1}))])}}});const va=S(fa,[["__scopeId","data-v-342f8919"]]),ya=E({__name:"ManyTableRender",props:{views:{},options:{},isEditPremission:{type:[Boolean,null]},auth:{}},emits:["update:views"],setup(_,{emit:d}){const t=_,e=d;Ie();const y=we(),f=I(()=>!!t.isEditPremission&&!t.options.publish),i=I({get(){return[...(t.views??[]).filter(s=>{var o;return t.options.publish&&((o=t.options.publishOpt)!=null&&o.viewIds)?t.options.publishOpt.viewIds.includes(s.id):!0})]},set(s){e("update:views",[...s])}}),{activeTab:m,filterMap:v}=ia(i),k=ke(),T=b(!1),V=b(""),B=b(!1),Q=async()=>{B.value=!0;try{const s=await ze({entryId:t.options.entryId,sourceId:V.value});await w(s)}finally{B.value=!1}},w=async s=>{await y(se,{query:{appEntryId:t.options.entryId,appId:t.options.appId,viewId:s}})},C=async(s,o)=>{Ue.confirm("删除后该视图不可恢复，确认要删除？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",async beforeClose(F,M,L){if(F==="confirm"){M.confirmButtonLoading=!0;try{await Oe({entryId:t.options.entryId,id:s}),oe.success("删除视图成功");const N=[...i.value];N.splice(o,1),i.value=[...N],L()}finally{M.confirmButtonLoading=!1}}else L()}})},D=async()=>{const s=i.value.map(o=>o.id??"");s.length<2||await Ae({entryId:t.options.entryId,viewIds:s})},U=s=>{m.value=s};he(m,()=>{setTimeout(()=>{const s=k.value.querySelector(`#table_${m.value}`);s==null||s.scrollIntoView({behavior:"smooth",block:"end",inline:"center"})},100)},{immediate:!0});const $=b(!1),J=b(i.value[0]),P=b(""),R=b(!1),O=s=>{J.value=s,$.value=!0,P.value=s.name+"_副本",R.value=!1},ne=async()=>{R.value=!0;try{const s=await Le({id:J.value.id,name:P.value});await y(se,{query:{appEntryId:t.options.entryId,appId:t.options.appId,viewId:s}})}finally{R.value=!1}},q=b(),Y=b(),{width:H}=ae(q),{width:re}=ae(Y),Z=I(()=>re.value>H.value),{x:A}=Ee(q,{behavior:"smooth"}),de=s=>{s.wheelDelta>0?A.value-=120:A.value+=120};return(s,o)=>{const F=Ne,M=na,L=ra,N=da,W=le,ee=We,ie=Ge,ue=Qe,ce=qe,pe=He,me=je;return n(),c("div",{class:"many_table"},[f.value||i.value.length>1?(n(),c("div",{key:0,class:"many_table-tabs"},[Z.value?(n(),c("div",{key:0,class:"many_table-arraw",onClick:o[0]||(o[0]=l=>A.value-=p(H)-10)},[a(F,null,{default:r(()=>[a(p(Ve))]),_:1})])):g("",!0),u("div",{class:"many_table-container",ref_key:"headerContainerRef",ref:q,onMousewheel:de},[u("div",{class:"many_table-wrapper",ref_key:"headerWrapperRef",ref:Y},[a(p(Je),{modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=l=>i.value=l),group:"itxst","item-key":"id",disabled:!f.value,class:"many_table-drag",chosenClass:"many_table-chosen",onEnd:D},{item:r(({element:l,index:_e})=>[u("div",{class:Ce(["tab-item",{"is-active":p(m)===l.id}]),onClick:j=>U(l.id),id:`table_${l.id}`},[u("span",{class:"tab-name"},G(l.name),1),u("div",{onClick:o[1]||(o[1]=De(()=>{},["stop"])),style:{display:"flex","align-items":"center","padding-top":"2px","margin-left":"7px"}},[f.value?(n(),h(N,{key:0,trigger:"click",class:"tab-more"},{dropdown:r(()=>[a(L,null,{default:r(()=>[a(M,{icon:p(xe),onClick:j=>w(l.id)},{default:r(()=>[x(" 编辑视图 ")]),_:2},1032,["icon","onClick"]),a(M,{icon:p(Re),onClick:j=>O(l)},{default:r(()=>[x(" 复制视图 ")]),_:2},1032,["icon","onClick"]),a(M,{icon:p(Se),disabled:i.value.length===1,onClick:j=>C(l.id,_e)},{default:r(()=>[x(" 删除视图 ")]),_:2},1032,["icon","disabled","onClick"])]),_:2},1024)]),default:r(()=>[a(F,{style:{transform:"rotate(90deg)"}},{default:r(()=>[a(p($e))]),_:1})]),_:2},1024)):g("",!0)])],10,["onClick","id"])]),_:1},8,["modelValue","disabled"])],512)],544),Z.value?(n(),c("div",{key:1,class:"many_table-arraw",onClick:o[3]||(o[3]=l=>A.value+=p(H)-10)},[a(F,null,{default:r(()=>[a(p(Te))]),_:1})])):g("",!0),f.value?(n(),c("div",{key:2,class:"tab-item tab-add",onClick:o[4]||(o[4]=l=>T.value=!0)},[a(F,{class:"mr-7"},{default:r(()=>[a(p(Be))]),_:1}),u("span",null,"新增视图")])):g("",!0)])):g("",!0),a(ee,{modelValue:T.value,"onUpdate:modelValue":o[7]||(o[7]=l=>T.value=l),title:"新增视图",width:"500","destroy-on-close":""},{footer:r(()=>[u("span",{class:"dialog-footer"},[a(W,{onClick:o[6]||(o[6]=l=>T.value=!1)},{default:r(()=>[x("取消")]),_:1}),a(W,{type:"primary",onClick:Q,disabled:!V.value,loading:B.value},{default:r(()=>[x(" 确定 ")]),_:1},8,["disabled","loading"])])]),default:r(()=>[a(ca,{modelValue:V.value,"onUpdate:modelValue":o[5]||(o[5]=l=>V.value=l),appId:s.options.appId},null,8,["modelValue","appId"])]),_:1},8,["modelValue"]),a(ee,{modelValue:$.value,"onUpdate:modelValue":o[10]||(o[10]=l=>$.value=l),title:"复制视图",width:"500","destroy-on-close":""},{footer:r(()=>[u("span",{class:"dialog-footer"},[a(W,{onClick:o[9]||(o[9]=l=>$.value=!1)},{default:r(()=>[x("取消")]),_:1}),a(W,{type:"primary",onClick:ne,disabled:!P.value,loading:R.value},{default:r(()=>[x(" 确定 ")]),_:1},8,["disabled","loading"])])]),default:r(()=>[a(ie,{title:"您即将复制以下视图：",type:"success",closable:!1,style:{"margin-bottom":"5px"}}),a(Pe,null,{default:r(()=>[a(te,{label:"复制视图名称"},{default:r(()=>[x(G(J.value.name),1)]),_:1}),a(te,{label:"新视图名称"},{default:r(()=>[a(ue,{modelValue:P.value,"onUpdate:modelValue":o[8]||(o[8]=l=>P.value=l),placeholder:"请输入",maxlength:"15"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i.value.length?(n(),h(pe,{key:1,"model-value":p(m),class:"hide-header many_table-body"},{default:r(()=>[(n(!0),c(K,null,Fe(i.value,l=>(n(),h(ce,{key:l.id,label:l.name,name:l.id,lazy:""},{default:r(()=>[a(ua,Me(s.$attrs,{options:s.options,view:l,active:l.id===p(m),filter:p(v).get(l.id)}),null,16,["options","view","active","filter"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["model-value"])):g("",!0),i.value.length?g("",!0):(n(),h(me,{key:2,description:"没有可查看的视图"}))])}}});const ba=S(ya,[["__scopeId","data-v-fb2c7b69"]]),ga=E({__name:"ListEntry",setup(_){const d=z(),t=I(()=>d.listDesignerDetails),e=I(()=>{var f,i;const y={viewIds:(f=d.details)==null?void 0:f.releaseView};return{appId:d.appId,entryId:d.entryId,publish:!0,...((i=d.details)==null?void 0:i.releaseAllFlag)===1?{publishOpt:y}:{}}});return(y,f)=>t.value?(n(),c("div",{key:0},[a(ba,{options:e.value,views:t.value.views},null,8,["options","views"])])):g("",!0)}}),Ia={form:va,sheet:ga},wa=_=>Ia[_],ka=E({__name:"Logo",props:{modelValue:{}},setup(_){const d=z(),t=I(()=>d.mode==="design");return(e,y)=>(n(),c("div",null,[e.modelValue?(n(),c("img",{key:1,class:"logo-box form-content-box img-logo",src:e.modelValue},null,8,["src"])):(n(),c(K,{key:0},[t.value?(n(),c("div",{key:0,class:"logo-box form-content-box"},[u("div",{class:"logo"},[u("span",null,"L O G O")])])):g("",!0)],64))]))}});const ha=S(ka,[["__scopeId","data-v-5c54cc59"]]),Ea=E({__name:"Title",props:{modelValue:{}},setup(_){return(d,t)=>(n(),c("div",{class:"title-box"},G(d.modelValue),1))}});const Va=S(Ea,[["__scopeId","data-v-8169bc08"]]),Ca=E({__name:"Desc",props:{modelValue:{}},setup(_){return(d,t)=>(n(),c("div",{class:"desc"},G(d.modelValue),1))}});const Da=S(Ca,[["__scopeId","data-v-cefb4a82"]]),xa=E({__name:"BodyWrap",props:{formEditJson:{}},setup(_){const d=_,t=z(),e=I(()=>d.formEditJson??t.details.formEditJson),y=I(()=>{const{rgba:m}=f.hex2Rgba(e.value.themeColors,.5);return{background:`linear-gradient(180deg,transparent,${f.rgba2Hex(m)})`,backgroundSize:"100%, contain",backgroundPosition:"top","background-repeat":"no-repeat",height:"100%"}}),f=pa(),i=I(()=>({background:f.hex2Rgba(e.value.themeColors,.5).rgba}));return(m,v)=>(n(),c("div",{class:"designer-layout",style:X(i.value)},[u("div",{class:"designer-bg"},[e.value.bgImgUrl?(n(),c("div",{key:0,class:"designer-bg-size"},[u("img",{src:e.value.bgImgUrl,alt:"",class:"backgroundImg"},null,8,["src"]),u("div",{class:"linearGradient",style:X(y.value)},null,4)])):g("",!0)]),u("div",{class:"body-form"},[u("div",{class:"content"},[a(ha,{modelValue:e.value.logoUrl,"onUpdate:modelValue":v[0]||(v[0]=k=>e.value.logoUrl=k)},null,8,["modelValue"]),u("div",{class:"form-content-box"},[a(Va,{modelValue:e.value.name,"onUpdate:modelValue":v[1]||(v[1]=k=>e.value.name=k)},null,8,["modelValue"]),a(Da,{modelValue:e.value.desc,"onUpdate:modelValue":v[2]||(v[2]=k=>e.value.desc=k)},null,8,["modelValue"]),e.value.desc?(n(),c("div",{key:0,class:"hr"})):g("",!0)]),Xe(m.$slots,"default",Ke(Ye({formEditJson:e.value})),void 0,!0)])])],4))}});const Ra=S(xa,[["__scopeId","data-v-300973d5"]]),Sa=E({__name:"Designer",props:{formEditJson:{},mode:{}},setup(_){const d=z();return(t,e)=>(n(),h(Ra,{formEditJson:t.formEditJson},Ze({_:2},[p(d).details?{name:"default",fn:r(({formEditJson:y})=>[(n(),h(ea(p(wa)(p(d).details.type)),{mode:t.mode,formEditJson:y},null,8,["mode","formEditJson"]))]),key:"0"}:void 0]),1032,["formEditJson"]))}});const $a=S(Sa,[["__scopeId","data-v-79a6b76c"]]),Oa=E({__name:"Designer",props:{formEditJson:{},mode:{default:aa.enter}},setup(_){return(d,t)=>(n(),h($a,{formEditJson:d.formEditJson,mode:d.mode},null,8,["formEditJson","mode"]))}});export{ba as M,Oa as _};

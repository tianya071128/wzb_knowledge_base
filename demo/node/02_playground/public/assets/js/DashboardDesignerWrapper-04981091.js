import{d as N,v as S,r as f,o as C,b as F,w as r,k as o,i as s,B as t,f as O,F as H,g as Q,C as Y,ao as j,ap as q,ds as G,dt as K,_ as W,bb as M,c as R,du as X,a9 as Z,aa as L,dv as ee,y as ae,Y as $,I as le,dw as se,dx as A,m as y,dy as ne,dz as oe,aN as te,U as re,av as ie}from"./index-b80d5ef5.js";import{E as de,a as pe,b as ue}from"./el-dropdown-item-455a6589.js";import{e as ce}from"./dashboardDesigner-ce3c2e23.js";import{$ as T,m as ge,p as fe,A as ve}from"./App-5a74fc11.js";const me=N({__name:"PageConfig",props:{visibleDrawer:{type:Boolean},modelValue:{}},emits:["update:visibleDrawer","update:modelValue"],setup(h,{emit:I}){const w=h,p=I,u=S(w,"visibleDrawer",p),i=S(w,"modelValue",p),x=[{label:"关闭",value:0},{label:"30秒",value:30},{label:"1分钟",value:60},{label:"2分钟",value:60*2},{label:"3分钟",value:60*3},{label:"4分钟",value:60*4},{label:"5分钟",value:60*5}];return f(["#f2f3f5","#ff8c00","#ffd700","#90ee90","#00ced1","#c71585","rgba(255, 69, 0, 0.68)","rgba(144, 240, 144, 0.5)","rgba(31, 147, 255, 0.73)","rgba(199, 21, 133, 0.46)"]),(v,a)=>{const m=j,b=q,c=G,B=K;return C(),F(B,{modelValue:t(u),"onUpdate:modelValue":a[3]||(a[3]=n=>Y(u)?u.value=n:null),title:"页面配置",direction:"rtl",size:300},{default:r(()=>[o("div",{class:"config-cell"},[o("div",{class:"title"},"自动刷新"),o("div",{class:"body"},[s(b,{modelValue:t(i).autoRefresh,"onUpdate:modelValue":a[0]||(a[0]=n=>t(i).autoRefresh=n),placeholder:"请选择刷新时间",style:{width:"100%"}},{default:r(()=>[(C(),O(H,null,Q(x,n=>s(m,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])]),o("div",{class:"config-cell"},[o("div",{class:"title"},"页面操作"),o("div",{class:"body"},[o("div",{class:"operate-cell"},[o("div",{class:"operate-tip"},"手动刷新"),s(c,{modelValue:t(i).manualRefresh,"onUpdate:modelValue":a[1]||(a[1]=n=>t(i).manualRefresh=n),"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue"])]),o("div",{class:"operate-cell"},[o("div",{class:"operate-tip"},"全屏"),s(c,{modelValue:t(i).fullScreen,"onUpdate:modelValue":a[2]||(a[2]=n=>t(i).fullScreen=n),"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue"])])])])]),_:1},8,["modelValue"])}}});const be=W(me,[["__scopeId","data-v-31852bca"]]),_e=N({__name:"DashboardDesignerWrapper",props:{dashboardDesignerDetails:{},teleportTo:{}},emits:["savePage","refresh"],setup(h,{expose:I,emit:w}){const p=h,u=w,i=M("appId"),x=M("appEntryId"),v=R(()=>p.dashboardDesignerDetails.pageeConfig),a=f(),m=f(!1),b=async()=>{var l;const e=(l=a.value)==null?void 0:l.pageDesignerData();if(e){m.value=!0;try{await ce({appId:i,entryId:x,id:p.dashboardDesignerDetails.id,pageeJson:e,pageeConfig:v.value}),te.success("保存成功"),c.value=$(e),u("savePage",e)}finally{m.value=!1}}},c=f(),B=()=>{b()};T.on(ge,B);const n=()=>{u("refresh")};T.on(fe,n),X(()=>{T.all.clear()}),I({async beforeLeave(){var e,l;if(!((e=a.value)!=null&&e.pageDesignerData()&&Z(c.value,(l=a.value)==null?void 0:l.pageDesignerData())))return new Promise((_,P)=>{L.confirm("您修改了表单设计但没有保存，是否需要保存表单设计并继续？","表单设计有修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(g,V,D){g==="confirm"?(V.confirmButtonLoading=!0,b().then(()=>{D(),_()}).finally(()=>{V.confirmButtonLoading=!1})):g==="cancel"?(D(),_()):g==="close"&&(D(),P())}})})}});const E=f(!1),z=()=>{L.confirm("您确定要清空所有控件?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{var e;(e=a.value)==null||e.clear()})},k=f(!1),U=R(()=>p.dashboardDesignerDetails.pageeJson??{...ee()});ae(U,()=>{setTimeout(()=>{var e;c.value=$((e=a.value)==null?void 0:e.pageDesignerData())},100)},{immediate:!0});const J=R(()=>{var e;return(e=a.value)==null?void 0:e.pageDesignerData()});return(e,l)=>{const _=re,P=ie,g=de,V=pe,D=ue;return C(),O("div",{class:"dash-box"},[s(t(ve),le(e.$attrs,{ref_key:"pageRenderRef",ref:a,mode:t(se).design,scene:t(A).dashboard,dataId:e.dashboardDesignerDetails.id,appId:e.dashboardDesignerDetails.appId,entryId:e.dashboardDesignerDetails.entryId,"page-designer":U.value,"page-config":v.value}),null,16,["mode","scene","dataId","appId","entryId","page-designer","page-config"]),(C(),F(ne,{to:e.teleportTo},[o("div",{class:"toolbar_panel"},[o("div",{class:"panel-left"}),o("div",{class:"panel-right"},[s(_,{type:"primary",onClick:l[0]||(l[0]=d=>E.value=!0),plain:""},{default:r(()=>[y(" 预览 ")]),_:1}),s(_,{type:"primary",onClick:b,loading:m.value},{default:r(()=>[y(" 保存 ")]),_:1},8,["loading"]),s(D,{trigger:"click",class:"panel-more"},{dropdown:r(()=>[s(V,null,{default:r(()=>[s(g,{onClick:l[1]||(l[1]=d=>k.value=!0)},{default:r(()=>[y(" 页面配置 ")]),_:1}),s(g,{onClick:z},{default:r(()=>[y(" 清空 ")]),_:1})]),_:1})]),default:r(()=>[s(P,{type:"primary",underline:!1},{default:r(()=>[y("...")]),_:1})]),_:1})])])],8,["to"])),s(oe,{visible:E.value,"onUpdate:visible":l[2]||(l[2]=d=>E.value=d),scene:t(A).dashboard,"page-designer-data":J.value},null,8,["visible","scene","page-designer-data"]),s(be,{"visible-drawer":k.value,"onUpdate:visibleDrawer":l[3]||(l[3]=d=>k.value=d),modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=d=>v.value=d)},null,8,["visible-drawer","modelValue"])])}}});const Ce=W(_e,[["__scopeId","data-v-8409f03e"]]);export{Ce as D};

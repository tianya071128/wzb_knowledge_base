import{d as g,v as $,o as c,b as y,ad as Z,w as A,k as G,I as P,mH as M,aS as W,B as F,C as D,Q as X,f as I,h as Y,i as K,a4 as x,av as q,bI as ee,bJ as te,bK as le,r as U,mI as oe,c as B,fV as ne,y as ae,F as h,g as E,bt as se,ao as re,m as C,t as S,U as ue,_ as j,gf as ie,cm as de,a2 as me,p as ce,cj as pe,bc as fe,ac as _e,bm as ve,z as ye,a5 as H,l as O,Z as Ie}from"./index-b80d5ef5.js";const be=g({__name:"VInput",props:{formValue:{default:""},item:{},row:{}},emits:["update:formValue","handleBlur"],setup(t,{emit:n}){const a=t,e=n,r=$(a,"formValue",e),s=()=>{e("handleBlur",{row:a.row,value:r.value})};return(d,u)=>{const p=X;return c(),y(p,P({onKeyup:u[0]||(u[0]=W(i=>e("update:formValue",F(r)??""),["enter"])),onBlur:s,modelValue:F(r),"onUpdate:modelValue":u[1]||(u[1]=i=>D(r)?r.value=i:null)},{...d.item,style:void 0},M(d.item.on||{})),Z({_:2},[d.item.append?{name:"append",fn:A(()=>[G("div",{innerHTML:d.item.appendContent},null,8,["innerHTML"])]),key:"0"}:void 0]),1040,["modelValue"])}}}),Ae=g({__name:"VDelIcon",setup(t){return(n,a)=>{const e=q;return c(),I("div",null,[Y(n.$slots,"default",{},()=>[K(e,{onClick:a[0]||(a[0]=r=>n.$emit("delete")),type:"danger",underline:!1,icon:F(x)},null,8,["icon"])])])}}}),z=Symbol("组件prop");var b=(t=>(t[t.REQUEST_PARAM=30]="REQUEST_PARAM",t[t.BLOCK_PARAM_BEFORE=40]="BLOCK_PARAM_BEFORE",t[t.API_REQUEST_PARAM=50]="API_REQUEST_PARAM",t[t.BLOCK_PARAM_AFTER=60]="BLOCK_PARAM_AFTER",t))(b||{});function Ve(){return{ids:{applicationId:"",apiType:"",apiId:""},version:"",nodeType:30,appScenarios:""}}function Pe(){const t=ee(z,void 0);if(t)return t;{const n=Ve();return te(z,le(n)),n}}const N=U();function Ce(t){return oe.getFlowNodes(t).then(n=>(N.value=n,Promise.resolve(n))).catch(n=>(console.error("参数类型加载失败"),Promise.reject(n)))}async function Se(t){const a=await ge(t);if(a){const e=a.pInfo.nodeName,r=a.cInfo.name;return Promise.resolve({pName:e??"节点已删除",cName:r??"参数已删除"})}else return Promise.reject({pName:"节点已删除",cName:"参数已删除"})}function Fe(t){var n;return(n=N.value)==null?void 0:n.filter(a=>t===b.BLOCK_PARAM_BEFORE?![b.BLOCK_PARAM_BEFORE,b.API_REQUEST_PARAM,b.BLOCK_PARAM_AFTER].includes(Number(a.nodeType)):t===b.API_REQUEST_PARAM?![b.API_REQUEST_PARAM,b.BLOCK_PARAM_AFTER].includes(Number(a.nodeType)):a)}async function ge(t){if(!N.value)return null;try{const a=t.trim().replace(/^\$+|\$+$/g,"").split("-"),e=a[0],r=a[1];let s=null,d=null;const u=N.value.find(p=>p.id===e);if(u){s=u;const i=s.controls.find(v=>v.controlId===r);return i?(d=i,Promise.resolve({pInfo:s,cInfo:d})):Promise.reject({pName:s.nodeName,cName:"参数已删除"})}else return Promise.reject({pName:"节点已删除",cName:"参数已删除"})}catch{return Promise.reject({pName:"节点已删除",cName:"参数已删除"})}}const Re=g({__name:"VParamInputBox",props:{formValue:{default:""},item:{}},emits:["update:formValue"],setup(t,{emit:n}){const r=$(t,"formValue",n),s=Pe(),d=B(()=>{const u=Fe(s.nodeType);return((u==null?void 0:u.map(i=>{var v;return{id:i.id,title:i.nodeName,customOptions:{options:((v=i.controls)==null?void 0:v.map(V=>({label:V.name,id:V.controlId})))??[]}}}))??[]).filter(i=>i.customOptions.options.length)});return(u,p)=>(c(),y(ne,P({modelValue:F(r),"onUpdate:modelValue":p[0]||(p[0]=i=>D(r)?r.value=i:null),group:d.value},{...u.item,style:void 0},M(u.item.on||{})),null,16,["modelValue","group"]))}}),Te=g({__name:"VSelect",props:{formValue:{default:""},item:{},row:{}},emits:["update:formValue","selectChange"],setup(t,{emit:n}){const a=t,e=n,r=$(a,"formValue",e);return ae(()=>r.value,s=>{e("selectChange",{...a.row,selectValue:s})}),(s,d)=>{const u=re;return c(),y(se,P({modelValue:F(r),"onUpdate:modelValue":d[0]||(d[0]=p=>D(r)?r.value=p:null),placeholder:"请选择"},{...s.item,style:void 0},M(s.item.on||{}),{style:{width:"100%"},load:s.item.load}),{default:A(({options:p})=>[(c(!0),I(h,null,E(p,(i,v)=>(c(),y(u,{key:v,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},16,["modelValue","load"])}}}),ke=g({__name:"VLink",props:{formValue:{default:""},item:{},row:{}},emits:["link"],setup(t,{emit:n}){const a=t,e=n;return(r,s)=>{const d=ue;return c(),I("div",null,[K(d,{type:"primary",link:"",onClick:s[0]||(s[0]=u=>e("link",a.row))},{default:A(()=>[C(S(r.item.linkText),1)]),_:1})])}}});const he=j(ke,[["__scopeId","data-v-6257b244"]]),we=g({__name:"formTableItem",props:{itemId:{},showTitle:{type:Boolean,default:!1}},emits:["delete"],setup(t,{expose:n,emit:a}){const e=ie(),r=t,s=a,d=de({allAs:{input:be,delIcon:Ae,paramInput:Re,select:Te,link:he}}),u=B(()=>e.list),p=f=>e.model[f],i=B(()=>e.model),v=(f,k)=>{f&&(e.model[f]=k)},V=()=>{s("delete",r.itemId)},R=U();return n({validateForm:()=>{if(R.value)return R.value.validate()}}),(f,k)=>{const Q=_e,l=ve;return c(),y(l,P({...f.$attrs,...f.$props},{onSubmit:k[0]||(k[0]=fe(()=>{},["prevent"])),ref_key:"formRef",ref:R,class:"flex-mode"}),{default:A(()=>[(c(!0),I(h,null,E(u.value,(o,m)=>(c(),y(Q,{key:m,label:o.label,prop:o.key,style:me(o.style),class:ce({"hide-label":!f.showTitle})},Z({default:A(()=>[(c(),y(pe(d.value.allAs[o.wType||o.type]),P({item:o,row:i.value,formValue:p(o.key),"onUpdate:formValue":_=>v(o.key,_)},M(o.on||{}),{...o,style:void 0},{onDelete:V}),null,16,["item","row","formValue","onUpdate:formValue"]))]),_:2},[o.wType==="delIcon"||o.type==="delIcon"?{name:"label",fn:A(()=>[C(S(f.showTitle?o.label:""),1)]),key:"0"}:void 0]),1032,["label","prop","style","class"]))),128))]),_:1},16)}}});const J=j(we,[["__scopeId","data-v-7eeef255"]]),Be=g({__name:"ParamSettingFormTable",props:{list:{},model:{},addText:{default:"添加参数"},addAble:{type:Boolean,default:!0},subFiled:{default:"children"},subAddText:{default:"添加参数"},idPrefix:{default:"controlId"},isEmpty:{type:Boolean,default:!0}},emits:["update:model"],setup(t,{expose:n,emit:a}){const e=t,s=$(e,"model",a),d=()=>`_${e.idPrefix}_${Ie()}`,u=()=>{const l=d();return{...i(),controlId:l}},p=()=>{s.value.push(u())},i=()=>e.list.length?e.list.reduce((l,o)=>(o!=null&&o.key&&(l[o.key]=""),l),{}):{},v=l=>{s.value=V(s.value,l)};function V(l,o){return l.filter(m=>m.controlId===o?!1:(m[e.subFiled]&&(m[e.subFiled]=V(m[e.subFiled],o)),!0))}const R=B(()=>(!e.model.length&&e.isEmpty&&p(),e.model));ye(()=>{s.value.forEach(l=>{l.controlId||(l.controlId=d())})});const T=U(),f=(l,o=!1)=>{var _;const m=s.value.find(L=>L.controlId===l);if(m){if((_=m[e.subFiled])!=null&&_.length&&!o)return;m[e.subFiled]?m[e.subFiled].push(u()):m[e.subFiled]=[u()]}};return n({validateForm:async()=>{var l;if((l=T.value)!=null&&l.length){const o=T.value.map(async m=>{await m.validateForm()});return Promise.all(o).then(()=>!0)}else return Promise.resolve(!0)},handleSubAdd:f,deleteSub:l=>{const o=s.value.find(m=>m.controlId===l);o&&(o[e.subFiled]=[])}}),(l,o)=>{const m=q;return c(),I("div",null,[(c(!0),I(h,null,E(R.value,(_,L)=>(c(),I(h,{key:_.controlId},[K(J,P({ref_for:!0,ref_key:"formTableItemRef",ref:T},{...l.$attrs,...l.$props},{showTitle:L===0,model:_,list:l.list,itemId:_.controlId,onDelete:v,"label-position":"top"}),null,16,["showTitle","model","list","itemId"]),_[e.subFiled]&&_[e.subFiled].length?(c(),I("div",{key:0,class:"sub-wrap"},[(c(!0),I(h,null,E(_[e.subFiled],w=>(c(),y(J,P({key:w.controlId,ref_for:!0,ref_key:"formTableItemRef",ref:T},{...l.$attrs,...l.$props},{showTitle:!1,model:w,list:l.list,itemId:w.controlId,onDelete:v,"label-position":"top"}),null,16,["model","list","itemId"]))),128)),l.addAble?(c(),y(m,{key:0,type:"primary",class:"sub-add",underline:!1,onClick:w=>f(_.controlId,!0),icon:F(H)},{default:A(()=>[C(S(l.subAddText),1)]),_:2},1032,["onClick","icon"])):O("",!0)])):O("",!0)],64))),128)),l.addAble?(c(),y(m,{key:0,type:"primary",class:"params-card__add",underline:!1,onClick:p,icon:F(H)},{default:A(()=>[C(S(l.addText),1)]),_:1},8,["icon"])):O("",!0)])}}});const Ne=j(Be,[["__scopeId","data-v-7f271083"]]);export{Ne as F,b as N,Se as a,Fe as b,ge as g,Pe as i,Ce as l};

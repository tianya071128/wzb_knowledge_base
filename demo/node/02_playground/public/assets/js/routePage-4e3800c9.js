import{d as D,r as U,o as d,f as _,i as e,w as l,m as x,B as o,C as B,s6 as Y,U as q,bn as Z,v as F,c as E,tM as ee,b as $,bu as te,tO as R,bt as ae,F as w,g as I,k as C,fV as O,bv as le,aN as S,bp as K,iz as P,Q as se,ac as j,ao as ne,bm as W,gj as G,_ as z,q1 as oe,e as ue,p as M,t as N,av as H,ca as ie,gv as L,j as re,bs as de,eu as me,a4 as pe,bG as ce,l as _e,by as ge,c3 as fe,bi as ve}from"./index-b80d5ef5.js";import{a as ye,c as be,d as Ve,b as Ce}from"./messageTemplate-8658e6b4.js";import{a as ke}from"./LoadingData-195d0581.js";import{C as he}from"./CollageTable-791f0954.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";const Te=D({__name:"TemplateKeywords",setup(T){const g=U(!1),m=U([]),i=async()=>{const u=await Y({current:0,limit:999,dictCode:"msg_template_keyword",itemText:"",status:0});m.value=u.records.map(r=>({label:r.itemText,value:`$msg-${r.itemValue}$`}))};return(u,r)=>{const a=q,c=ke,s=Z;return d(),_("div",null,[e(a,{onClick:r[0]||(r[0]=n=>g.value=!0)},{default:l(()=>[x("查看关键字")]),_:1}),e(s,{title:"模板关键字",modelValue:o(g),"onUpdate:modelValue":r[1]||(r[1]=n=>B(g)?g.value=n:null),width:"800px"},{default:l(()=>[e(c,{load:i},{default:l(()=>[e(he,{title:"模板关键字",list:o(m),hideHeader:""},null,8,["list"])]),_:1})]),_:1},8,["modelValue"])])}}}),Ue=D({__name:"AddDialog",props:{modelValue:{type:Boolean},templateId:{}},emits:["update:modelValue","refresh"],setup(T,{emit:g}){const m=T,i=g,u=F(m,"modelValue",i),r={templateName:"",messageType:"",templateUsage:"",messageChannel:"",templateContent:""},a=U({...r}),c={templateName:[{required:!0,message:"请输入模板名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],messageType:[{required:!0,message:"请选择消息类型",trigger:"change"}],messageChannel:[{required:!0,message:"请选择适用渠道",trigger:"change"}],templateUsage:[{required:!0,message:"请选择适用场景",trigger:"change"}],templateContent:[{required:!0,message:"请输入模板内容",trigger:"blur"}]},s=E(()=>!!m.templateId),n=U(),v=async()=>{s.value?a.value=await ye(m.templateId??""):a.value={...r}},y=async()=>{var k;await((k=n.value)==null?void 0:k.validate()),await be(a.value),S.success(s.value?"修改成功":"新增成功"),i("refresh")},b=async()=>await K(P),h=E(()=>ee(G));return(k,t)=>{const f=se,V=j,Q=ne,J=W;return d(),$(le,{modelValue:o(u),"onUpdate:modelValue":t[6]||(t[6]=p=>B(u)?u.value=p:null),direction:"rtl","show-load":v,title:o(s)?"修改模板":"新增模板"},{footer:l(()=>[e(te,{editMode:o(s),onClose:t[5]||(t[5]=p=>u.value=!1),"on-submit":y},null,8,["editMode"])]),default:l(()=>[e(J,{"label-width":"80px",rules:c,model:a.value,ref_key:"formRef",ref:n},{default:l(()=>[e(V,{label:"模板名称",prop:"templateName"},{default:l(()=>[e(f,{modelValue:a.value.templateName,"onUpdate:modelValue":t[0]||(t[0]=p=>a.value.templateName=p),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),e(V,{label:"消息类型",prop:"messageType"},{default:l(()=>[e(R,{modelValue:a.value.messageType,"onUpdate:modelValue":t[1]||(t[1]=p=>a.value.messageType=p),load:b},null,8,["modelValue"])]),_:1}),e(V,{label:"适用渠道",prop:"messageChannel"},{default:l(()=>[e(R,{modelValue:a.value.messageChannel,"onUpdate:modelValue":t[2]||(t[2]=p=>a.value.messageChannel=p),load:o(h)},null,8,["modelValue","load"])]),_:1}),e(V,{label:"适用场景",prop:"templateUsage"},{default:l(()=>[e(ae,{modelValue:a.value.templateUsage,"onUpdate:modelValue":t[3]||(t[3]=p=>a.value.templateUsage=p),load:"msg_template_usage",placeholder:"请选择适用场景"},{default:l(({options:p})=>[(d(!0),_(w,null,I(p,(A,X)=>(d(),$(Q,{key:X,label:A.label,value:A.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"模板内容",prop:"templateContent"},{default:l(()=>[C("div",{class:"content-wrap"},[e(O,{modelValue:a.value.templateContent,"onUpdate:modelValue":t[4]||(t[4]=p=>a.value.templateContent=p),group:[{id:"msg",title:"模板关键字",dictOptions:{dictKey:"msg_template_keyword"}}]},null,8,["modelValue"]),e(Te)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});const we=z(Ue,[["__scopeId","data-v-a80a1c8d"]]),xe=D({__name:"ButtonRadio",props:{load:{type:[String,Symbol,Function,Array]},modelValue:{}},emits:["update:modelValue","loadFinish"],setup(T,{emit:g}){const m=T,i=g,{state:u,options:r,refresh:a}=oe(m,i),c=F(m,"modelValue",i);return(s,n)=>{const v=H,y=ie;return ue((d(),_("div",{class:"button-radio"},[o(u)==="fail"?(d(),_("div",{key:0,class:"loading-error"},[x(" 数据加载失败, "),e(v,{type:"danger",class:"error-link",underline:!1,onClick:o(a)},{default:l(()=>[x(" 重新加载 ")]),_:1},8,["onClick"])])):(d(),_(w,{key:1},[C("div",{class:M(["button-item",{active:!o(c)}]),onClick:n[0]||(n[0]=b=>c.value="")}," 全部 ",2),(d(!0),_(w,null,I(o(r),(b,h)=>(d(),_("div",{class:M(["button-item",{active:b.value===o(c)}]),key:h,onClick:k=>c.value=b.value},N(b.label),11,["onClick"]))),128))],64))])),[[y,o(u)==="loading"]])}}});const De=z(xe,[["__scopeId","data-v-009b88f9"]]),Ee=D({__name:"MessageList",props:{tableData:{}},emits:["edit","refresh"],setup(T,{emit:g}){const m=T,i=g,u=E(()=>{const s=[];return m.tableData.forEach(n=>{const v=s.find(y=>y.templateUsage===n.templateUsage);v?v.children.push(n):s.push({templateUsage:n.templateUsage,templateUsage_dictText:n.templateUsage_dictText??"",children:[n]})}),s}),r=async s=>{await Ve(s),S.success("删除成功"),i("refresh")},a={[L.mail]:"primary",[L.email]:"warning",[L.sms]:"success"},c=E(()=>s=>a[s]);return(s,n)=>{var h;const v=ge,y=H,b=fe;return d(),_("div",{class:"message_list"},[(d(!0),_(w,null,I(u.value,(k,t)=>(d(),_(w,{key:t},[C("div",{class:"message_list-class"},[C("span",null,N(k.templateUsage_dictText||"未命名场景"),1)]),C("ul",{class:"message_list-content"},[(d(!0),_(w,null,I(k.children,f=>(d(),_("li",{key:f.id},[C("div",{class:"title"},[e(re,{content:f.templateName},null,8,["content"])]),C("div",{class:"channel"},[e(v,{type:c.value(f.messageChannel)},{default:l(()=>[x(N(o(de)(f.messageChannel,o(G))),1)]),_:2},1032,["type"])]),C("div",{class:"content-wrap"},[C("span",{class:"content"},[e(O,{modelValue:f.templateContent,"onUpdate:modelValue":V=>f.templateContent=V,preview:"",group:[{id:"msg",title:"模板关键字",dictOptions:{dictKey:"msg_template_keyword"}}]},null,8,["modelValue","onUpdate:modelValue"])]),C("div",{class:"action-list"},[e(y,{underline:!1,type:"primary",icon:o(me),onClick:V=>i("edit",f.id??"")},null,8,["icon","onClick"]),e(ce,{title:"确定要删除该模板吗？删除后数据无法恢复",confirm:async()=>r(f.id??"")},{reference:l(()=>[e(y,{underline:!1,type:"danger",icon:o(pe)},null,8,["icon"])]),_:2},1032,["confirm"])])])]))),128))])],64))),128)),(h=u.value)!=null&&h.length?_e("",!0):(d(),$(b,{key:0}))])}}});const Ie=z(Ee,[["__scopeId","data-v-9348f4c8"]]),Ae=D({__name:"routePage",setup(T){const g={query:{list:[{label:"适用场景",prop:"templateUsage",type:"select",options:"msg_template_usage"},{label:"模板名称",type:"input",prop:"templateName"}]},request:{api:Ce},table:{tableCols:[]},operation:{hideTableOperation:!0},pagination:{hidePagination:!0}},m=U(),i=U(!1),u=U(""),r=()=>{u.value="",i.value=!0},a=n=>{u.value=n,i.value=!0},c=()=>{m.value.refresh()},s=async()=>await K(P);return(n,v)=>{const y=j,b=W,h=q,k=ve("az-page");return d(),_("div",{class:"layout_box"},[e(k,{ref_key:"azPageRef",ref:m,config:g},{searchTop:l(({searchParams:t,handleSearch:f})=>[e(b,{labelWidth:"86px",model:t},{default:l(()=>[e(y,{label:"消息类型"},{default:l(()=>[e(De,{modelValue:t.messageType,"onUpdate:modelValue":[V=>t.messageType=V,f],load:s},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model"])]),operation:l(()=>[e(h,{type:"primary",onClick:r},{default:l(()=>[x("新建模板")]),_:1})]),table:l(({tableData:t})=>[e(Ie,{tableData:t,onEdit:a,onRefresh:c},null,8,["tableData"])]),_:1},512),e(we,{modelValue:o(i),"onUpdate:modelValue":v[0]||(v[0]=t=>B(i)?i.value=t:null),templateId:o(u),onRefresh:c},null,8,["modelValue","templateId"])])}}});export{Ae as default};

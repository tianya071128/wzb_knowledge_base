import{d as I,gY as N,r as c,c as E,a as f,jC as m,Y as h,f$ as V,o as B,f as T,i as a,w as d,m as F,t as w,cR as M,cS as R,k as L,B as _,eR as U,F as $,aN as x,eh as P,U as Y,bn as j,_ as z}from"./index-b80d5ef5.js";import{E as A}from"./routePage-70460a50.js";import{B as W}from"./fieldDefaultComponent-58752d9c.js";import{S as q}from"./SetFieldDefault-5fc1ae2a.js";const G=I({__name:"FillFieldEditor",props:{field:{}},setup(S){const o=S,p=N(),n=c([]),r=c(!1),v=E(()=>o.field.type===f.linkData?o.field.options.sourceId:o.field.options.cascaderData.sourceId??""),k=()=>{r.value=!0,n.value=[...h(o.field.options.fillFields??[])]},g=c(),C=async()=>{var l;if(await((l=g.value)==null?void 0:l.validate()),n.value.some(e=>{var i;return e.fieldType===f.subform&&!((i=e.child)!=null&&i.length)}))return x.error("子表单控件类型需设置子控件填充！");o.field.options.fillFields=n.value,r.value=!1},D=E(()=>{var e,i;const l=p.form.fields;if(o.field.options.showNum===m.single){const s=p.matchField(o.field.fieldId);return(((e=s==null?void 0:s.parentField)==null?void 0:e.type)===f.subform?((i=s.parentField.fields)==null?void 0:i.map(t=>{const u=h(t);return u.options.label=V(t.fieldId,l,{includeSubFormLabel:!0})??"",u}))??[]:l).filter(t=>t.fieldId!==o.field.fieldId)}else return[...p.fields.values()].filter(s=>s.type===f.subform)});return(l,e)=>{const i=P,s=Y,b=j;return B(),T($,null,[a(A,M(R(l.$attrs)),{default:d(({error:t})=>{var u;return[a(W,{"is-error":!!t,"is-set":!!((u=l.field.options.fillFields)!=null&&u.length),disabled:!v.value,onClick:k},{default:d(()=>{var y;return[F(w((y=l.field.options.fillFields)!=null&&y.length?"已设置数据填充":"添加数据填充"),1)]}),_:2},1032,["is-error","is-set","disabled"])]}),_:1},16),a(b,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value=t),title:"数据填充设置",width:"600","destroy-on-close":"","close-on-click-modal":!1,"append-to-body":""},{footer:d(()=>[L("span",{class:"dialog-footer"},[a(s,{onClick:e[1]||(e[1]=t=>r.value=!1)},{default:d(()=>[F("取消")]),_:1}),a(s,{type:"primary",onClick:C},{default:d(()=>[F("确定")]),_:1})])]),default:d(()=>[a(i,{class:"mb-10",title:"选择数据后，将按以下规则将关联数据集控件的值填充到当前表单控件",type:"info",closable:!1}),a(q,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value=t),ref_key:"setFieldDefaultRef",ref:g,"left-fields":D.value,rightSourceId:v.value,isSubform:"","btn-text":"选择当前表单控件",leftFieldColumnName:"当前表单控件","right-field-column-name":"设置为联动数据集的控件",customTypeList:[{value:_(U).currentField,placeholder:"请选择联动数据集控件"}],isMainToSon:l.field.options.showNum===_(m).single,isMultiple:l.field.options.showNum===_(m).multiple},null,8,["modelValue","left-fields","rightSourceId","customTypeList","isMainToSon","isMultiple"])]),_:1},8,["modelValue"])],64)}}});const Q=z(G,[["__scopeId","data-v-bf8818b0"]]);export{Q as F};

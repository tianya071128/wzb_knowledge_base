import{d as B,jG as C,c as t,h5 as R,wB as D,a as z,wC as T,mb as W,en as q,wD as N,dW as b,h6 as H,o as _,b as M,ad as P,w as n,h as u,k as g,f as j,i as I,B as G,aR as L,l as J,p as K,H as O,P as Q,_ as U}from"./index-b80d5ef5.js";import{a as X}from"./useValidateError-9f6399dc.js";const Y=B({__name:"FormItemFieldWrapper",props:{field:{},rules:{},index:{},prop:{}},setup(y){const e=y,l=C(),w=t(()=>{var s,r;const i=(s=l.matchField(e.field.fieldId))==null?void 0:s.parentField;return((r=i==null?void 0:i.field)==null?void 0:r.type)==="subform"&&i.field.options.mode!==R.card}),A=t(()=>!!l.getFieldAuth(e.field.fieldId,"edit",e.index)),f=t(()=>{var s;const i=[];return l.getFieldAuth(e.field.fieldId,"required",e.index)&&i.push({required:!0,message:((s=e.field.options.requiredHint)==null?void 0:s.trim())||"此项为必填项",trigger:["blur","change"]}),"noRepeat"in e.field.options&&e.field.options.noRepeat&&i.push({validator(r,p,a){var F,v;const m="repeatRemind"in e.field.options?e.field.options.repeatRemind:D;if(p==null)return a();const d=l.matchField(e.field.fieldId),c=((F=d==null?void 0:d.parentField)==null?void 0:F.type)===z.subform?(v=d==null?void 0:d.parentField)==null?void 0:v.fieldId:"",o=l.packageData([e.field.fieldId,c]);if(c&&e.index!=null&&Array.isArray(o[0].childs)&&(o[0].childs=[o[0].childs[e.index]],l.getFieldVal(e.field.fieldId).some((k,S)=>S!==e.index&&k===p)))return a(new Error(m));T(W(o,l.entryId,l.getFieldVal(q.id.name),{noSubmitRemove:!0})).then(h=>{if(h!=null)return a(new Error(m));a()}).catch(()=>{a()})},trigger:[N.includes(e.field.type)&&A.value?"blur":"change"]}),[...i,...e.rules??[]]}),V=t(()=>!!l.getFieldAuth(e.field.fieldId,"linkData",e.index)),x=t(()=>e.prop??`${e.field.fieldId}.data${e.index==null?"":"."+e.index}.value`),E=t(()=>l&&[b.view,b.pureView].includes(l.mode)),$=H();return X(e.field,({fieldId:i})=>{i===e.field.fieldId&&setTimeout(()=>{var s,r;(r=(s=$.value)==null?void 0:s.scrollIntoView)==null||r.call(s,{behavior:"smooth",block:"center"})},100)},t(()=>({index:e.index}))),(i,s)=>{const r=Q;return _(),M(O,{ref:"AzFormItemRef",rules:f.value,label:i.field.options.showLabel?i.field.options.label:"",class:K({"form_item-subform":w.value,"is-view":E.value}),tip:i.field.options.tip,prop:x.value,key:`AzFormItem_${f.value.length}`,for:`${i.field.fieldId}${i.index}`},P({default:n(()=>[g("div",{class:"form_item-wrapper"},[u(i.$slots,"default",{},void 0,!0),V.value?(_(),j("div",{key:0,class:"field-loading-data"},[g("span",null,"数据加载中"),I(r,{class:"is-loading ml-5"},{default:n(()=>[I(G(L))]),_:1})])):J("",!0)])]),_:2},[i.$slots.labelAfter?{name:"labelAfter",fn:n(()=>[u(i.$slots,"labelAfter",{},void 0,!0)]),key:"0"}:void 0,i.$slots.labelSuffix?{name:"labelSuffix",fn:n(()=>[u(i.$slots,"labelSuffix",{},void 0,!0)]),key:"1"}:void 0]),1032,["rules","label","class","tip","prop","for"])}}});const ie=U(Y,[["__scopeId","data-v-4effdac5"]]);export{ie as F};

import{bI as he,bJ as Ve,bK as Ie,aV as xe,r as y,c as Z,bL as L,bM as Ce,i as t,bN as ce,b4 as we,bd as Te,bO as Ne,aN as S,d as $,v as K,o as x,b as F,ad as De,B as p,w as f,bu as ke,k as A,m as B,t as P,l as W,bt as Me,f as E,F as Q,g as ee,C as U,bv as te,bP as Fe,bQ as Be,bR as Re,bS as oe,bT as pe,bU as me,Q as q,ac as Ee,ao as J,ap as le,bm as Le,bV as Pe,_ as z,bW as Ue,I as Ae,a_ as Se,h as $e,N as ze,O as Oe,P as fe,bX as je,a6 as qe,bY as We,bZ as He,b_ as se,a as ie,y as ue,b$ as de,c0 as Ke,p as X,c1 as Qe,bz as Je,c2 as Ye,c3 as Ge,ba as Xe,bx as ve,c4 as Ze,a9 as _e,aa as be,Y as ge,c5 as el,ab as ll,c6 as al,c7 as tl,e as nl,c8 as ol,c9 as sl,U as ye,ca as il,bi as ul,a5 as dl}from"./index-b80d5ef5.js";import{_ as ne}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";/* empty css                        */import{_ as ae}from"./RenderTable.vue_vue_type_script_setup_true_lang-928d6d63.js";const re=Symbol("id");function rl(){return{appId:"",modelingId:"",modelingDetail:{systemCols:[],modelIndexs:[],cusomizeCols:[]},controlTypeInfo:{}}}function H(){const h=he(re,void 0);if(h)return h;{const d=rl();return Ve(re,Ie(d)),d}}let R=function(h){return h.add="add",h.edit="edit",h.view="view",h}({});const cl={[R.add]:{title:"创建模型"},[R.edit]:{title:"编辑模型"},[R.view]:{title:"查看模型"}},pl=()=>{var c;const h=xe(),d=H();d.appId=(c=h.query)==null?void 0:c.appId;const b=y(),T=y(),r=y(!1),o=y(!1),i=y(!1),N=y(R.add),n=()=>{var a;(a=T.value)==null||a.refresh()},V=(a,s="")=>{N.value=a,d.modelingId=s,r.value=!0},g=()=>{var a;we(Te,{query:{appId:(a=h.query)==null?void 0:a.appId}})};return{config:Z(()=>({query:{list:[{type:"input",label:"模型名称",prop:"name"},{type:"select",label:"类型",prop:"type",options:[{label:"主表",value:L.main},{label:"子表",value:L.son},{label:"关联子表",value:L.link}],isAll:!0}]},request:{api:s=>Ce({...s||{},appId:d.appId??""})},table:{tableCols:[{prop:"name",label:"模型名称",showOverflowTooltip:!0},{prop:"tableName",label:"实体表名称",showOverflowTooltip:!0},{prop:"isMainModel",label:"类型",slots:{default({row:s}){return t("span",null,[ce[s.isMainModel]])}}},{prop:"remarks",label:"说明",showOverflowTooltip:!0},{prop:"createName",label:"创建者",showOverflowTooltip:!0},{prop:"createTime",label:"创建时间",minWidth:110,showOverflowTooltip:!0},{fixed:"right",width:200,label:"操作",slots:{default({row:s}){const l=[{type:"primary",onClick:()=>{d.modelingId=s.id,i.value=!0},text:"配置"},{type:"primary",onClick:()=>{V(R.edit,s.id)},text:"编辑"},{type:"primary",onClick:()=>{d.modelingId=s.id,o.value=!0},text:"引用"},{type:"primary",onClick:()=>{V(R.view,s.id)},text:"查看"},{type:"danger",text:"删除",popconfirmProps:{title:"您确定要删除该模型吗?",confirm:async()=>{await Ne(s.id),S.success("删除成功"),n()}}}];return t(ne,{num:3,rowId:s.id,list:l},null)}}}]},operation:{fullEl:b}})),pendingRef:b,azPageRef:T,modelingAdd_visible:r,quoteView_visible:o,config_visible:i,dataModelingType:N,onOpen:V,refreshTable:n,backApp:g}},ml=pl,fl=$({__name:"ModelingAdd",props:{visible:{type:Boolean},type:{}},emits:["update:visible","success"],setup(h,{emit:d}){const b=h,T=d,r=K(b,"visible",T),o=H(),i=y(),N={appId:o.appId,isMainModel:L.main,mainId:"",name:"",tableName:"",remarks:""},n=y({...N}),V=()=>{n.value={...N}},g=y(""),I=y(""),c=async()=>{if(V(),!o.modelingId)return;const e=await Fe(o.modelingId);n.value=e,I.value=n.value.tableName,b.type===R.view&&(g.value=await w(n.value.mainId))},a=async()=>{var l;await((l=i.value)==null?void 0:l.validate())&&(b.type===R.add?await Be(n.value):await Re(n.value),T("success"))},u={name:[{required:!0,message:"请输入模型名称",trigger:"blur"}],tableName:[{required:!0,validator:(e,l,v)=>{l===""?v(new Error("请输入实体表名称")):/^[a-z0-9_]{6,20}$/.test(l)?Pe({tableName:l,appId:o.appId}).then(D=>{D||n.value.id&&l===I.value?v():v(new Error("该表名称已存在"))}):v(new Error("请输入6-20位字符，仅支持小写英文字母、数字、下划线"))},trigger:"blur"}],mainId:[{required:!0,message:"请选择主表",trigger:"change"}]},C=async()=>(await oe(o.appId,1)).map(l=>({label:l.name,value:l.id})),w=async e=>{const v=(await oe(o.appId)).find(_=>_.id===e);return v?v.name:"-"},m=e=>{e===L.main&&(n.value.mainId="")};return(e,l)=>{const v=pe,_=me,D=q,k=Ee,O=J,j=le,Y=Le;return x(),F(te,{modelValue:p(r),"onUpdate:modelValue":l[6]||(l[6]=M=>U(r)?r.value=M:null),title:p(cl)[e.type].title,"show-load":c},De({default:f(()=>[A("div",{class:"form-wrap"},[e.type===p(R).view?(x(),F(_,{key:0,column:1,border:""},{default:f(()=>[t(v,{label:"模型名称"},{default:f(()=>[B(P(n.value.name),1)]),_:1}),t(v,{label:"实体表名称"},{default:f(()=>[B(P(n.value.tableName),1)]),_:1}),t(v,{label:"类型"},{default:f(()=>[B(P(p(ce)[n.value.isMainModel]),1)]),_:1}),n.value.isMainModel===p(L).son?(x(),F(v,{key:0,label:"关联主表"},{default:f(()=>[B(P(g.value),1)]),_:1})):W("",!0),t(v,{label:"说明"},{default:f(()=>[B(P(n.value.remarks),1)]),_:1})]),_:1})):(x(),F(Y,{key:1,"label-suffix":":","label-width":"100px",rules:u,model:n.value,ref_key:"formRef",ref:i},{default:f(()=>[t(k,{label:"模型名称",prop:"name"},{default:f(()=>[t(D,{"show-word-limit":"",maxlength:20,placeholder:"请输入模型名称",modelValue:n.value.name,"onUpdate:modelValue":l[0]||(l[0]=M=>n.value.name=M)},null,8,["modelValue"])]),_:1}),t(k,{label:"实体表名称",prop:"tableName"},{default:f(()=>[t(D,{placeholder:"请输入实体表名称",modelValue:n.value.tableName,"onUpdate:modelValue":l[1]||(l[1]=M=>n.value.tableName=M)},null,8,["modelValue"])]),_:1}),t(k,{label:"类型"},{default:f(()=>[t(j,{placeholder:"请选择类型",style:{width:"100%"},disabled:e.type===p(R).edit,modelValue:n.value.isMainModel,"onUpdate:modelValue":l[2]||(l[2]=M=>n.value.isMainModel=M),onChange:m},{default:f(()=>[t(O,{label:"主表",value:p(L).main},null,8,["value"]),t(O,{label:"子表",value:p(L).son},null,8,["value"]),t(O,{label:"关联子表",value:p(L).link},null,8,["value"])]),_:1},8,["disabled","modelValue"])]),_:1}),n.value.isMainModel===p(L).son?(x(),F(k,{key:0,label:"关联主表",prop:"mainId"},{default:f(()=>[t(Me,{modelValue:n.value.mainId,"onUpdate:modelValue":l[3]||(l[3]=M=>n.value.mainId=M),style:{width:"100%"},disabled:e.type===p(R).edit,load:C},{default:f(({options:M})=>[(x(!0),E(Q,null,ee(M,G=>(x(),F(O,{key:G.value,label:G.label,value:G.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):W("",!0),t(k,{label:"说明"},{default:f(()=>[t(D,{autosize:{minRows:3,maxRows:6},type:"textarea",placeholder:"请输入说明","show-word-limit":"",maxlength:200,modelValue:n.value.remarks,"onUpdate:modelValue":l[4]||(l[4]=M=>n.value.remarks=M)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]))])]),_:2},[e.type!==p(R).view?{name:"footer",fn:f(()=>[t(ke,{editMode:!0,onClose:l[5]||(l[5]=M=>r.value=!1),"on-submit":a})]),key:"0"}:void 0]),1032,["modelValue","title"])}}});const vl=z(fl,[["__scopeId","data-v-82a95ea3"]]),_l=$({__name:"QuoteView",props:{visible:{type:Boolean}},emits:["update:visible"],setup(h,{emit:d}){const r=K(h,"visible",d),o=H(),i=y({formNames:[],modelName:"",appNames:[]}),N=async()=>{if(!o.modelingId)return;const n=await Ue(o.modelingId);n&&(i.value=n)};return(n,V)=>{const g=pe,I=me;return x(),F(te,{modelValue:p(r),"onUpdate:modelValue":V[0]||(V[0]=c=>U(r)?r.value=c:null),title:"查看引用","show-load":N},{default:f(()=>[A("div",{class:"form-wrap"},[t(I,{column:1,border:""},{default:f(()=>[t(g,{label:"数据模型",width:80},{default:f(()=>{var c;return[B(P(((c=i.value)==null?void 0:c.modelName)||"-"),1)]}),_:1}),t(g,{label:"应用",width:80},{default:f(()=>{var c,a;return[B(P(((a=(c=i.value)==null?void 0:c.appNames)==null?void 0:a.join(","))||"-"),1)]}),_:1}),t(g,{label:"表单",width:80},{default:f(()=>{var c,a;return[B(P(((a=(c=i.value)==null?void 0:c.formNames)==null?void 0:a.join(","))||"-"),1)]}),_:1})]),_:1})])]),_:1},8,["modelValue"])}}});const bl=z(_l,[["__scopeId","data-v-91533a7d"]]),gl=$({__name:"DrawerHeader",props:{active:{}},emits:["update:active","back"],setup(h,{emit:d}){const b=h,T=d,r=K(b,"active",T);return(o,i)=>{const N=ze,n=Oe,V=fe;return x(),E("div",{class:"drawer-header"},[t(n,Ae({modelValue:p(r),"onUpdate:modelValue":i[0]||(i[0]=g=>U(r)?r.value=g:null),class:"az_tabs-custom designer_page-tabs"},o.$attrs),{default:f(()=>[t(N,{label:"字段配置",name:"field"}),t(N,{label:"索引配置",name:"index"})]),_:1},16,["modelValue"]),A("div",{class:"left-wrap"},[t(V,{class:"icon-back",onClick:i[1]||(i[1]=g=>T("back"))},{default:f(()=>[t(p(Se))]),_:1}),A("span",null,"模型配置")]),A("div",{class:"right-wrap"},[$e(o.$slots,"default",{},void 0,!0)])])}}});const yl=z(gl,[["__scopeId","data-v-402e7166"]]),hl=$({__name:"WidgetSelector",props:{modelValue:{},onChange:{type:Function},isNull:{type:Boolean},isNew:{type:Boolean}},emits:["update:modelValue","change"],setup(h,{emit:d}){const b=h,T=d,r=K(b,"modelValue",T),o=y(),i=y(!1),N=()=>{i.value||(i.value=!0)},n=()=>{i.value=!1},V=()=>{w.value&&(i.value=!1)},{width:g}=je(o),I=y(),c=y(""),a=async m=>{r.value=m.type,T("change",m.type),n()},s=Z(()=>b.modelValue?c.value:"请选择控件"),u=Z(()=>{let m=[];b.isNew||(m=qe(b.modelValue,{mode:We.data_modeling}));const e=He().reduce((l,v)=>{const _=v.fields.filter(D=>m!=null&&m.length?m.includes(D.type)&&se(D.type,"isFormItem")&&D.type!==ie.subform:se(D.type,"isFormItem")&&D.type!==ie.subform);return _!=null&&_.length&&l.push({...v,fields:_}),l},[]);return I.value?e.reduce((l,v)=>{const _=v.fields.filter(D=>D.options.label.includes(I.value));return _!=null&&_.length&&l.push({...v,fields:_}),l},[]):e});ue(()=>r.value,m=>{m&&(I.value=de(m)||b.modelValue||"",c.value=I.value)},{immediate:!0}),ue(()=>i.value,m=>{m?I.value="":(I.value=b.modelValue?de(b.modelValue):b.modelValue,setTimeout(()=>{var e;(e=o.value)==null||e.blur()}))});const C=y(),{isOutside:w}=Ke(C);return(m,e)=>{const l=fe,v=q,_=Ge,D=Xe;return x(),F(D,{placement:"bottom",trigger:"contextmenu",width:p(g),visible:i.value,"popper-class":"widget-selector"},{reference:f(()=>[t(v,{placeholder:s.value,onClick:N,onBlur:V,ref_key:"inputRef",ref:o,modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=k=>I.value=k),class:X([{"valid-error":m.isNull},"refer-input"])},{suffix:f(()=>[t(l,{class:X(["arrow",{roll:i.value}])},{default:f(()=>[t(p(Qe))]),_:1},8,["class"])]),_:1},8,["placeholder","modelValue","class"])]),default:f(()=>[A("div",{class:"custom-content",ref_key:"panelRef",ref:C},[u.value.length?(x(!0),E(Q,{key:1},ee(u.value,(k,O)=>(x(),E(Q,{key:O},[A("div",{class:"title"},P(k.title),1),A("ul",null,[(x(!0),E(Q,null,ee(k.fields,(j,Y)=>(x(),E("li",{key:Y,class:X({selected:j.type===b.modelValue}),onClick:M=>a(j)},[t(Je,{"icon-class":p(Ye)(j.type),"class-name":"widget-panel-icon"},null,8,["icon-class"]),B(" "+P(j.options.label),1)],10,["onClick"]))),128))])],64))),128)):(x(),E("div",{key:0,class:"empty-box"},[t(_,{description:"暂无数据","image-size":50})]))],512)]),_:1},8,["width","visible"])}}});const Vl=z(hl,[["__scopeId","data-v-d50ff692"]]),Il=h=>{const d=H(),b=y(1),T=[{label:"字段标题",prop:"title",slots:{default:({row:e})=>t(q,{placeholder:"请输入字段标题",modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,class:!e.title&&!e.isNew?"valid-error":""},null)}},{label:"字段名称",prop:"name",slots:{default:({row:e})=>t(q,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,placeholder:"请输入字段名称",class:g.value[e._id??""]||!e.name&&!e.isNew||!a(e.name)&&!e.isNew||s(e.name)&&!e.isNew?"valid-error":"",onInput:()=>c()},null)}},{label:"控件类型",prop:"controlType",slots:{default:({row:e})=>t(Vl,{modelValue:e.controlType,"onUpdate:modelValue":l=>e.controlType=l,isNull:!e.controlType&&!e.isNew,isNew:e.isNew,onChange:l=>{e.type=d.controlTypeInfo[l].colType??"-",e.length=d.controlTypeInfo[l].defaultLength??"0"}},null)}},{label:"字段类型",prop:"type"},{label:"字段长度",prop:"length",slots:{default:({row:e})=>e.type==="string"||e.type==="decimal"?t(q,{modelValue:e.length,"onUpdate:modelValue":l=>e.length=l,class:!e.length&&!e.isNew?"valid-error":"",onInput:()=>{e.length=e.length.replace(/[^\d]/g,"")},onChange:()=>{+e.length>+d.controlTypeInfo[e.controlType].maxLength?e.length=d.controlTypeInfo[e.controlType].maxLength:+e.length<+d.controlTypeInfo[e.controlType].minLength&&(e.length=d.controlTypeInfo[e.controlType].minLength)}},null):(e.length=null,t("span",null,[B("-")]))}},{label:"操作",slots:{default:({row:e})=>{const v=[{type:"danger",text:"删除",popconfirmProps:{title:"您确定要删除该字段吗?",confirm:()=>{n(e)}}}];return t(ne,{num:3,rowId:e._id,list:v},null)}}}],r=[{label:"字段标题",prop:"title"},{label:"字段名称",prop:"name"}],o=y([]),i=y([]),N=()=>{var e;(e=V.value)==null||e.addRow({isNew:!0,modelId:d.modelingId})},n=e=>{var l;(l=V.value)==null||l.delRow(e._id),delete g.value[e._id],c()},V=y(),g=y({}),I=e=>{var _;const v=((_=o.value.map(D=>D.name).filter(D=>D&&D===e.name))==null?void 0:_.length)||0;g.value[e._id??""]=v>1},c=()=>{for(const e of o.value)I(e)};function a(e){return/^[a-z_][a-z0-9_]{0,39}$/.test(e)}function s(e){return d.modelingDetail.systemCols.map(v=>v.name).includes(e)}const u=async()=>{if(c(),Object.values(g.value).includes(!0))return S.error("有重复的字段名,请检查"),Promise.reject(!1);let e=!0,l=!0;const v=[];for(const _ of o.value)_.isNew=!1,(!_.name||!_.title||!_.controlType||(_.type==="decimal"||_.type==="string")&&!_.length)&&(e=!1),a(_.name)||(l=!1),s(_.name)&&v.push(_.name);return e?l?v.length?(setTimeout(()=>{b.value++}),S.error(`字段名 ${v.join(",")} 为系统字段，请修改`),Promise.reject(!1)):await Ze({modelCols:o.value,id:d.modelingId}):(setTimeout(()=>{b.value++}),S.error("字段名称以小写英文字母开头、支持小写英文字母、数字、下划线,且不超过40个字符"),Promise.reject(!1)):(S.error("请完善表格数据"),setTimeout(()=>{b.value++}),Promise.reject(!1))},C=y([]),w=()=>_e(o.value,C.value)?Promise.resolve(!0):new Promise((l,v)=>{be.confirm("您修改了表单但没有保存，是否需要保存表单并继续？",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(_,D,k){_==="confirm"?(D.confirmButtonLoading=!0,u().then(()=>{D.confirmButtonLoading=!1,l(!0),h(),k()}).catch(()=>{D.confirmButtonLoading=!1,v(),k()})):_==="cancel"?(l(!0),k()):_==="close"&&(v(),k())}})}),m=()=>{o.value=d.modelingDetail.cusomizeCols,i.value=d.modelingDetail.systemCols,setTimeout(()=>{C.value=ge(o.value)})};return ve(()=>{m()}),{tableCols:T,filedList:o,onAdd:N,renderTableRef:V,systemTableCols:r,systemFiledList:i,onSave:u,tableKey:b,onLeave:w,asyncData:m}},xl=Il,Cl=$({__name:"FieldConfig",emits:["refresh"],setup(h,{expose:d,emit:b}){const{tableCols:T,filedList:r,onAdd:o,onSave:i,onLeave:N,asyncData:n,renderTableRef:V,systemTableCols:g,systemFiledList:I,tableKey:c}=xl(()=>u()),a=y("custom"),s=b,u=()=>{s("refresh")};return d({onSave:i,onLeave:N,asyncData:n}),(C,w)=>{const m=el,e=ll;return x(),E("div",{class:"filed-container"},[t(e,{modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=l=>a.value=l)},{default:f(()=>[t(m,{label:"custom"},{default:f(()=>[B(" 自定义字段 ")]),_:1},8,["label"]),t(m,{label:"system"},{default:f(()=>[B("系统字段")]),_:1},8,["label"])]),_:1},8,["modelValue"]),a.value==="custom"?(x(),F(ae,{key:p(c),class:"mt-10","table-cols":p(T),modelValue:p(r),"onUpdate:modelValue":w[1]||(w[1]=l=>U(r)?r.value=l:null),onAdd:p(o),rowKey:"_id",idPrefix:"customField",ref_key:"renderTableRef",ref:V},null,8,["table-cols","modelValue","onAdd"])):(x(),F(ae,{key:"systemTable",class:"mt-10","table-cols":p(g),modelValue:p(I),"onUpdate:modelValue":w[2]||(w[2]=l=>U(I)?I.value=l:null),"hide-add":""},null,8,["table-cols","modelValue"]))])}}});const wl=z(Cl,[["__scopeId","data-v-f3bc2b53"]]);function Tl(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!tl(h)}const Nl=h=>{const d=H(),b=[{label:"索引名称",prop:"name",slots:{default:({row:a})=>t(q,{modelValue:a.name,"onUpdate:modelValue":s=>a.name=s,placeholder:"请输入索引名称",class:!a.name&&!a.isNew||!T(a.name)&&!a.isNew?"valid-error":""},null)}},{label:"索引类型",prop:"type",slots:{default:({row:a})=>t(le,{placeholder:"请选择索引类型",modelValue:a.type,"onUpdate:modelValue":s=>a.type=s,class:!a.type&&!a.isNew?"valid-error":""},{default:()=>[t(J,{label:"普通索引",value:"0"},null),t(J,{label:"唯一索引",value:"1"},null)]})}},{label:"索引字段",prop:"indexCol",slots:{default:({row:a})=>{let s;return t(le,{placeholder:"请选择索引字段",modelValue:a.indexCol,"onUpdate:modelValue":u=>a.indexCol=u,class:!a.indexCol&&!a.isNew?"valid-error":""},Tl(s=d.modelingDetail.cusomizeCols.map(u=>t(J,{label:u.title,value:u.name},null)))?s:{default:()=>[s]})}}},{label:"操作",slots:{default:({row:a})=>{const u=[{type:"danger",text:"删除",popconfirmProps:{title:"您确定要删除该字段吗?",confirm:()=>{N(a)}}}];return t(ne,{num:3,rowId:a._id,list:u},null)}}}];function T(a){return/^[a-z_][a-z0-9_]{0,19}$/.test(a)}const r=y(),o=y([]),i=()=>{var a;(a=r.value)==null||a.addRow({isNew:!0,modelId:d.modelingId})},N=a=>{var s;(s=r.value)==null||s.delRow(a._id)},n=y(1),V=async()=>{let a=!0,s=!0;for(const u of o.value)u.isNew=!1,(!u.name||!u.type||!u.indexCol)&&(a=!1),T(u.name)||(s=!1);return a?s?await al({modelIndexs:o.value,id:d.modelingId}):(setTimeout(()=>{n.value++}),S.error("索引名称以小写英文字母开头、支持小写英文字母、数字、下划线,且不超过20个字符"),Promise.reject(!1)):(S.error("请完善表格数据"),setTimeout(()=>{n.value++}),Promise.reject(!1))},g=y([]),I=()=>_e(o.value,g.value)?Promise.resolve(!0):new Promise((s,u)=>{be.confirm("您修改了表单但没有保存，是否需要保存表单并继续？",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(C,w,m){C==="confirm"?(w.confirmButtonLoading=!0,V().then(()=>{w.confirmButtonLoading=!1,s(!0),h(),m()}).catch(()=>{w.confirmButtonLoading=!1,u(),m()})):C==="cancel"?(s(!0),m()):C==="close"&&(u(),m())}})}),c=()=>{o.value=d.modelingDetail.modelIndexs,setTimeout(()=>{g.value=ge(o.value)})};return ve(()=>{c()}),{tableCols:b,indexList:o,onAdd:i,renderTableRef:r,onSave:V,onLeave:I,asyncData:c}},Dl=Nl,kl=$({__name:"IndexConfig",emits:["refresh"],setup(h,{expose:d,emit:b}){const{tableCols:T,indexList:r,onAdd:o,renderTableRef:i,onSave:N,onLeave:n,asyncData:V}=Dl(()=>I()),g=b,I=()=>{g("refresh")};return d({onSave:N,onLeave:n,asyncData:V}),(c,a)=>(x(),E("div",{class:"index-container"},[t(ae,{rowKey:"_id",idPrefix:"index",class:"mt-10","table-cols":p(T),modelValue:p(r),"onUpdate:modelValue":a[0]||(a[0]=s=>U(r)?r.value=s:null),onAdd:p(o),ref_key:"renderTableRef",ref:i},null,8,["table-cols","modelValue","onAdd"])]))}});const Ml=z(kl,[["__scopeId","data-v-2c8ba0e7"]]),Fl=$({__name:"ModelingConfig",props:{visible:{type:Boolean}},emits:["update:visible"],setup(h,{emit:d}){const r=K(h,"visible",d),o=H(),i=async()=>{const u=await ol(o.modelingId);await N(),o.modelingDetail=u},N=async()=>{const u=await sl();o.controlTypeInfo=u},n=y(),V=y(),g=y("field"),I=y(!1),c=y(!1),a=async()=>{var u,C,w,m;try{I.value=!0,g.value==="field"?await((u=n.value)==null?void 0:u.onSave()):await((C=V.value)==null?void 0:C.onSave()),S.success("保存成功"),c.value=!0,await i(),(w=n.value)==null||w.asyncData(),(m=V.value)==null||m.asyncData()}catch{}finally{I.value=!1,c.value=!1}},s=async(u,C)=>{var w,m;return C==="field"?await((w=n.value)==null?void 0:w.onLeave()):await((m=V.value)==null?void 0:m.onLeave())};return(u,C)=>{const w=ye,m=il;return x(),F(te,{size:"90%",modelValue:p(r),"onUpdate:modelValue":C[2]||(C[2]=e=>U(r)?r.value=e:null),"with-header":!1,direction:"btt","show-load":i},{default:f(()=>[t(yl,{active:g.value,"onUpdate:active":C[0]||(C[0]=e=>g.value=e),"before-leave":s,onBack:C[1]||(C[1]=e=>r.value=!1)},{default:f(()=>[t(w,{type:"primary",onClick:a,loading:I.value},{default:f(()=>[B(" 保存 ")]),_:1},8,["loading"])]),_:1},8,["active"]),nl((x(),E("div",{class:"config-wrap"},[g.value==="field"?(x(),F(wl,{key:0,ref_key:"fieldConfigRef",ref:n,onRefresh:i},null,512)):W("",!0),g.value==="index"?(x(),F(Ml,{key:1,ref_key:"indexConfigRef",ref:V,onRefresh:i},null,512)):W("",!0)])),[[m,c.value]])]),_:1},8,["modelValue"])}}});const Bl=z(Fl,[["__scopeId","data-v-3419cc52"]]),Rl=$({__name:"routePage",setup(h){const{config:d,pendingRef:b,azPageRef:T,modelingAdd_visible:r,quoteView_visible:o,config_visible:i,dataModelingType:N,refreshTable:n,onOpen:V,backApp:g}=ml();return(I,c)=>{const a=ye,s=ul("az-page");return x(),E("div",{class:"data-modeling"},[A("div",{class:"layout_box",ref_key:"pendingRef",ref:b},[t(s,{ref_key:"azPageRef",ref:T,config:p(d)},{operation:f(()=>[t(a,{type:"primary",icon:p(dl),onClick:c[0]||(c[0]=u=>p(V)(p(R).add))},{default:f(()=>[B(" 创建模型 ")]),_:1},8,["icon"])]),_:1},8,["config"]),t(vl,{visible:p(r),"onUpdate:visible":c[1]||(c[1]=u=>U(r)?r.value=u:null),type:p(N),onSuccess:p(n)},null,8,["visible","type","onSuccess"]),p(o)?(x(),F(bl,{key:0,visible:p(o),"onUpdate:visible":c[2]||(c[2]=u=>U(o)?o.value=u:null)},null,8,["visible"])):W("",!0),p(i)?(x(),F(Bl,{key:1,visible:p(i),"onUpdate:visible":c[3]||(c[3]=u=>U(i)?i.value=u:null)},null,8,["visible"])):W("",!0)],512)])}}});const Al=z(Rl,[["__scopeId","data-v-fe7cc9ac"]]);export{Al as default};

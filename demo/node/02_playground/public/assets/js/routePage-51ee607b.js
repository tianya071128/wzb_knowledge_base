import{bI as _e,eN as oo,eO as no,e9 as Oe,ea as qo,cm as je,cA as Go,du as Bo,eb as Ho,bK as Fe,c as F,bH as fe,aN as Pt,d as S,v as Y,r as $,o as f,f as P,e as L,S as he,i as _,B as a,C,eu as lt,aq as Yo,w as y,k as T,bz as lo,t as X,aT as ao,aU as Lo,_ as ee,aW as Wo,a_ as Jo,bc as Ko,m as k,P as ro,U as Ne,R as Qo,ay as $t,Z as so,F as R,g as te,di as Xo,bx as xe,a5 as Ce,a4 as Zo,b,a2 as en,h as Me,p as tn,j as on,l as j,n as at,a9 as nn,aa as ln,H as U,er as uo,eP as an,bt as rn,ao as rt,eC as io,ax as Ee,E as ge,ap as co,ac as re,eQ as po,eR as mo,I as sn,ei as jt,a8 as dn,eS as un,eT as Ft,a as se,aO as xt,bm as st,y as cn,ca as oe,ab as pn,bn as dt,eU as _o,a3 as mn,bw as _n,eh as ut,bC as fo,at as fn,Q as go,bJ as yo,cj as gn,bv as yn,ce as Te,aY as vn}from"./index-b80d5ef5.js";import{b as bn,f as hn,g as In}from"./eventFlow-dbdb0b7c.js";import{W as Sn,G as Be,aa as be,ab as Ct,X as On,r as Nn,Q as Dn,S as Vn,T as Tn}from"./index-8aa8c97d.js";import"./flowEnum-7431041b.js";import{E as Mn,a as wn,b as Pn}from"./el-dropdown-item-455a6589.js";import{_ as $n}from"./SelectForm.vue_vue_type_script_setup_true_lang-0170236d.js";import{F as vo}from"./FormulaWrapper-92a83208.js";import{S as bo}from"./SetFieldDefault-5fc1ae2a.js";import{I as jn}from"./InternalComponentSelectPlus-00c8c38f.js";import{C as Fn}from"./ComponentParamsSetWrapper-71afc840.js";import{P as xn}from"./PluginSelect-032e797b.js";import{_ as Cn}from"./ParamsSetWrapper.vue_vue_type_script_setup_true_lang-c3f6631f.js";import{F as En}from"./FieldCondition-1c72aa9d.js";import{F as kn}from"./FieldConditionView-ad1b057c.js";import"./el-collapse-transition-4ed993c7.js";import{E as Rn}from"./el-input-number-c15b1cc7.js";import{S as Un}from"./SortSetField-face42ca.js";import{M as zn}from"./MessageRemindConfig-98484405.js";import{C as An}from"./index-a513aa2a.js";import{F as ho}from"./ParamSettingFormTable-3b7d2b84.js";import{u as Et}from"./useExtractQuery-f96f705c.js";import{a as qn}from"./LoadingData-195d0581.js";import"./sortBy-f189de5d.js";import"./_baseSlice-cf92e063.js";import"./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js";import"./groupBy-e9191618.js";import"./_createAggregator-d66ed64c.js";import"./Formula.vue_vue_type_style_index_0_lang-ef444f24.js";import"./index-8e050109.js";import"./ButtonSelectField.vue_vue_type_script_setup_true_lang-aae15f71.js";import"./fieldDefaultComponent-58752d9c.js";import"./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js";import"./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js";import"./useFieldMaxWidth-d82f063e.js";import"./Base.vue_vue_type_script_setup_true_lang-4fbdbc85.js";import"./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js";import"./index-318b68f4.js";import"./DaterangeBase.vue_vue_type_script_setup_true_lang-bec97540.js";import"./InputBase.vue_vue_type_script_setup_true_lang-ffcf63f1.js";import"./Base-9b7f3306.js";/* empty css                          */import"./index-f0ed738f.js";import"./NumberBase.vue_vue_type_script_setup_true_lang-745b39c5.js";import"./AzInputNumber-d6212644.js";import"./Base-c9aa1df0.js";/* empty css                        */import"./SliderBase.vue_vue_type_script_setup_true_lang-5d73415b.js";import"./TextareaBase.vue_vue_type_script_setup_true_lang-7091b2cb.js";import"./TimeBase.vue_vue_type_script_setup_true_lang-ea537bf3.js";import"./TimerangeBase.vue_vue_type_script_setup_true_lang-0827c241.js";import"./UploadFileBase.vue_vue_type_script_setup_true_lang-0c253daa.js";import"./UploadImgBase.vue_vue_type_script_setup_true_lang-d23c1306.js";import"./CooperateEnterpriseBase.vue_vue_type_script_setup_true_lang-23720971.js";import"./useMultipleVal-904406c1.js";import"./CooperatePersonnelBase.vue_vue_type_script_setup_true_lang-adcd0db7.js";import"./Base.vue_vue_type_script_setup_true_lang-0e9a0e2c.js";import"./Base.vue_vue_type_script_setup_true_lang-aa25657d.js";import"./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js";import"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import"./CardShowFieldItem-fd24f218.js";import"./default-component-4c80201b.js";import"./ButtonState-cb54910b.js";import"./SelectFieldByMultEntry-84abd0c3.js";import"./SelectEntryAndOther-76a65b2d.js";import"./SelectCascaderEntry.vue_vue_type_script_setup_true_lang-673c5dca.js";import"./ParamsSet.vue_vue_type_script_setup_true_lang-37c252c5.js";import"./EditorDraggable-a06dbc71.js";import"./utils-a7200637.js";import"./messageTemplate-8658e6b4.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";const Io=Symbol("智绘流.设计器");function ye(){return _e(Io,void 0)}var O=(t=>(t.webhookTrigger="webhookTrigger",t.timeTrigger="timeTrigger",t.formEventTrigger="formEventTrigger",t.addData="addData",t.updateData="updateData",t.deleteData="deleteData",t.getSingleData="getSingleData",t.getMultipleData="getMultipleData",t.updateProcessParam="updateProcessParam",t.parallelGateway="parallelGateway",t.exclusiveGateway="exclusiveGateway",t.condition="condition",t.calculation="calculation",t.summary="summary",t.sendMessage="sendMessage",t.callPlugin="callPlugin",t.callComponent="callComponent",t.executeCode="executeCode",t.endNode="endNode",t))(O||{}),E=(t=>(t.trigger="trigger",t.dataOperation="dataOperation",t.gateway="gateway",t.compute="compute",t.message="message",t.plugin="plugin",t.end="end",t))(E||{}),So=(t=>(t.designer="designer",t.preview="preview",t))(So||{}),G=(t=>(t.entry="entry",t.component="component",t.plugin="plugin",t.summary="summary",t.calculation="calculation",t))(G||{}),A=(t=>(t.add="add",t.delete="delete",t))(A||{}),x=(t=>(t[t.single=0]="single",t[t.multiple=1]="multiple",t))(x||{}),w=(t=>(t[t.form=0]="form",t[t.node=1]="node",t))(w||{}),ie=(t=>(t[t.jump=0]="jump",t[t.stop=1]="stop",t[t.push=2]="push",t))(ie||{});const B={cellName:{required:!0,message:"请输入节点名称"}},ke={required:!0,message:"请选择表单",validator:(t,n,o,l)=>{l!=null&&l.method?l.method===w.form?n?o():o("请选择表单"):o():n?o():o("请选择表单")}},Re={required:!0,message:"请选择数据节点",validator:(t,n,o,l)=>{"method"in l?l.method===w.node?n?o():o("请选择数据节点"):o():n?o():o("请选择数据节点")}};var Z=(t=>(t[t.fixedNumber=0]="fixedNumber",t[t.nodeSource=1]="nodeSource",t))(Z||{});const kt={...B,entryId:{required:!0,message:"请选择表单"},addType:{required:!0,message:"请选择触发事件"},formula:{required:!0,message:"请设置函数",validator:(t,n,o,l)=>{if("addType"in l){const{addType:e,batchCreatRule:u}=l;e===x.multiple&&u===Z.fixedNumber?n?o():o("请设置函数"):o()}else n?o():o("请设置函数")}},fieldSet:{type:"array",required:!0,message:"请设置字段",validator:(t,n,o,l)=>{n.length>=1?o():o("请设置字段")}}},Gn=Object.freeze(Object.defineProperty({__proto__:null,default:kt,formRules:kt},Symbol.toStringTag,{value:"Module"})),Rt={...B,formula:{required:!0,message:"请设置函数计算"}},Bn=Object.freeze(Object.defineProperty({__proto__:null,default:Rt,formRules:Rt},Symbol.toStringTag,{value:"Module"})),Ut={...B,componentId:{required:!0,message:"请选择组件"},componentConfig:{type:"array",required:!0,message:"请设置请求参数",asyncValidator:async(t,n,o,l)=>{const e=l;if("componentId"in e){const u=oo(),{componentConfig:s,customParams:r,componentId:p}=e,d=await u.getComponentInfoAsync(p);((d==null?void 0:d.inputParams)??[]).map(c=>c.required).some(c=>c)&&(s.length>=1||r?o():o("请设置请求参数"))}o()}}},Hn=Object.freeze(Object.defineProperty({__proto__:null,default:Ut,formRules:Ut},Symbol.toStringTag,{value:"Module"})),zt={...B,pluginId:{required:!0,message:"请选择插件",validator:(t,n,o,l)=>{const e=n;e!=null&&e.pluginId?o():o("请选择插件")}},pluginParams:{type:"array",required:!0,message:"请设置请求参数",asyncValidator:async(t,n,o,l)=>{const e=l,{pluginId:u,pluginParams:s}=e,r=no(),p=(u==null?void 0:u.pluginId)??"",d=await r.getPluginInfoAsync(p);((d==null?void 0:d.inputControls)??[]).map(c=>c.requiredFlag).some(c=>c)?s.length>=1?o():o("请设置请求参数"):o()}}},Yn=Object.freeze(Object.defineProperty({__proto__:null,default:zt,formRules:zt},Symbol.toStringTag,{value:"Module"})),At={...B,condition:{type:"array",required:!0,message:"请设置数据过滤",validator:(t,n,o,l)=>{n.length>=1?o():o("请设置数据过滤")}}},Ln=Object.freeze(Object.defineProperty({__proto__:null,default:At,formRules:At},Symbol.toStringTag,{value:"Module"})),qt={...B,method:{required:!0,message:"请选择获取方式"},entryId:ke,relation:Re,condition:{type:"array",required:!0,message:"请设置筛选条件",validator:(t,n,o,l)=>{const e=l;"method"in e&&e.method===w.form?n.length>=1?o():o("请设置筛选条件"):o()}}},Wn=Object.freeze(Object.defineProperty({__proto__:null,default:qt,formRules:qt},Symbol.toStringTag,{value:"Module"})),Gt={...B},Jn=Object.freeze(Object.defineProperty({__proto__:null,default:Gt,formRules:Gt},Symbol.toStringTag,{value:"Module"})),Bt={...B},Kn=Object.freeze(Object.defineProperty({__proto__:null,default:Bt,formRules:Bt},Symbol.toStringTag,{value:"Module"})),Ht={...B,triggerEvent:{required:!0,message:"请选择触发事件"},entryId:{required:!0,message:"请选择表单"},condition:{type:"array",required:!0,message:"请设置数据过滤",validator:(t,n,o,l)=>{n.length>=1?o():o("请设置数据过滤")}}},Qn=Object.freeze(Object.defineProperty({__proto__:null,default:Ht,formRules:Ht},Symbol.toStringTag,{value:"Module"})),Yt={...B,method:{required:!0,message:"请选择获取方式"},noDataAction:{required:!0,message:"请选择"},entryId:ke,relation:Re,condition:{type:"array",required:!0,message:"请设置数据过滤",validator:(t,n,o,l)=>{n.length>=1?o():o("请设置数据过滤")}},sortRules:{type:"array",required:!0,message:"请设置排序规则",validator:(t,n,o,l)=>{n.length>=1?o():o("请设置排序规则")}}},Xn=Object.freeze(Object.defineProperty({__proto__:null,default:Yt,formRules:Yt},Symbol.toStringTag,{value:"Module"})),Lt={...B,method:{required:!0,message:"请选择获取方式"},entryId:ke,relation:Re,condition:{type:"array",required:!0,message:"请设置数据过滤",validator:(t,n,o,l)=>{n.length>=1?o():o("请设置数据过滤")}},sortRules:{type:"array",required:!0,message:"请设置排序规则",validator:(t,n,o,l)=>{n.length>=1?o():o("请设置排序规则")}}},Zn=Object.freeze(Object.defineProperty({__proto__:null,default:Lt,formRules:Lt},Symbol.toStringTag,{value:"Module"})),Wt={...B},el=Object.freeze(Object.defineProperty({__proto__:null,default:Wt,formRules:Wt},Symbol.toStringTag,{value:"Module"})),Jt={...B,msgConfig:{required:!0,message:"请设置发送消息",validator:(t,n,o,l)=>{const{msgConfig:e}=l;e?e.selectors.length<1?o("请设置提醒人"):e.msgBase.length<1?o("请设置提醒方式"):o():o("请设置发送消息节点")}}},tl=Object.freeze(Object.defineProperty({__proto__:null,default:Jt,formRules:Jt},Symbol.toStringTag,{value:"Module"})),Kt={...B,condition:{type:"array",required:!0,message:"请设置筛选条件",validator:(t,n,o,l)=>{const e=l;"method"in e?e.method===w.form?n.length>=1?o():o("请设置筛选条件"):o():n.length>=1?o():o("请设置筛选条件")}},summaryFieldId:{required:!0,message:"请选择汇总计算"},calcMethod:{required:!0,message:"请选择运算方式"}},ol=Object.freeze(Object.defineProperty({__proto__:null,default:Kt,formRules:Kt},Symbol.toStringTag,{value:"Module"})),Qt={...B,timedPlan:{required:!0,message:"请选择定时计划"},startTime:{required:!0,message:"请选择开始执行时间"},endTime:{required:!0,message:"请选择结束执行时间"}},nl=Object.freeze(Object.defineProperty({__proto__:null,default:Qt,formRules:Qt},Symbol.toStringTag,{value:"Module"})),Xt={...B,method:{required:!0,message:"请选择获取方式"},entryId:ke,relation:Re,condition:{type:"array",required:!0,message:"请设置数据过滤",validator:(t,n,o,l)=>{const e=l;"method"in e&&e.method===w.form?n.length>=1?o():o("请设置数据过滤"):o()}},updateRules:{type:"array",required:!0,message:"请设置更新规则",validator:(t,n,o,l)=>{n.length>=1?o():o("请设置更新规则")}}},ll=Object.freeze(Object.defineProperty({__proto__:null,default:Xt,formRules:Xt},Symbol.toStringTag,{value:"Module"})),Zt={...B},al=Object.freeze(Object.defineProperty({__proto__:null,default:Zt,formRules:Zt},Symbol.toStringTag,{value:"Module"})),Oo={},rl=Object.assign({"../../nodes/addData/rule.ts":Gn,"../../nodes/calculation/rule.ts":Bn,"../../nodes/callComponent/rule.ts":Hn,"../../nodes/callPlugin/rule.ts":Yn,"../../nodes/condition/rule.ts":Ln,"../../nodes/deleteData/rule.ts":Wn,"../../nodes/endNode/rule.ts":Jn,"../../nodes/exclusiveGateway/rule.ts":Kn,"../../nodes/formEventTrigger/rule.ts":Qn,"../../nodes/getMultipleData/rule.ts":Xn,"../../nodes/getSingleData/rule.ts":Zn,"../../nodes/parallelGateway/rule.ts":el,"../../nodes/sendMessage/rule.ts":tl,"../../nodes/summary/rule.ts":ol,"../../nodes/timeTrigger/rule.ts":nl,"../../nodes/updateData/rule.ts":ll,"../../nodes/webhookTrigger/rule.ts":al});Object.entries(rl).forEach(([t,n])=>{const o=t.split(Oe.sep),l=o[o.length-2];let e=n;e=e.default||e,Oo[l]=e});function No(t){const n=Oo[t]??null;return n||console.error(`你需要查找节点类型为${t}组件, 但是并没有找到, 请检查一下是否存在该类型, 或者组件路径存在问题`),n}const it="新增数据",Ye={shape:O.addData,data:{entryId:"",cellName:it,addType:x.single,fieldSet:[],batchCreatRule:Z.fixedNumber,formula:"",batchRuleRelation:null}},sl=Object.freeze(Object.defineProperty({__proto__:null,AddDataOptions:Ye,NODE_NAME:it,default:Ye},Symbol.toStringTag,{value:"Module"})),dl={nodeName:it,icon:"Setting",iconColor:"#ccc",sort:0,category:E.dataOperation,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}],getNodeOption(t){const n=t.getData(),o=t.id,{entryId:l}=n;if(l)return{sourceId:o,dataId:l,dataType:G.entry}},resetCurrentNodeData(t){const n=t.getData(),{entryId:o,addType:l,fieldSet:e,batchCreatRule:u,formula:s,batchRuleRelation:r}=Ye.data;t.replaceData({...n,entryId:o,addType:l,fieldSet:e,batchCreatRule:u,formula:s,batchRuleRelation:r})},getNodeDataMode(t){const n=t.getData();if(n.addType===x.single)return"Single";if(n.addType===x.multiple)return"Multiple"},getNodeDataModePro(t){const n=t.getData();if(n.addType===x.single)return x.single;if(n.addType===x.multiple)return x.multiple}},ul=Object.freeze(Object.defineProperty({__proto__:null,default:dl},Symbol.toStringTag,{value:"Module"}));var Ie=(t=>(t[t.direct=0]="direct",t[t.dynamic=1]="dynamic",t))(Ie||{}),le=(t=>(t[t.text=0]="text",t[t.number=1]="number",t[t.date=2]="date",t[t.dateTime=3]="dateTime",t))(le||{});const ct="运算",Le={shape:O.calculation,data:{cellName:ct,formula:"",calcMethod:Ie.direct,calcResultType:le.text}},il=Object.freeze(Object.defineProperty({__proto__:null,CalculationDataOptions:Le,NODE_NAME:ct,default:Le},Symbol.toStringTag,{value:"Module"})),cl={nodeName:ct,icon:"Setting",iconColor:"#ccc",sort:0,category:E.compute,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}],getNodeOption(t){if(t.getData().formula)return{sourceId:t.id,dataId:"",dataType:G.calculation}},resetCurrentNodeData(t){const n=t.getData(),{cellName:o,...l}=Le.data;t.replaceData({...n,...l})},getNodeDataModePro(t){return x.single}},pl=Object.freeze(Object.defineProperty({__proto__:null,default:cl},Symbol.toStringTag,{value:"Module"})),pt="调用组件",We={shape:O.callComponent,data:{cellName:pt,componentId:"",componentConfig:[],customParams:null}},ml=Object.freeze(Object.defineProperty({__proto__:null,CallComponentOptions:We,NODE_NAME:pt,default:We},Symbol.toStringTag,{value:"Module"})),_l={nodeName:pt,icon:"Setting",iconColor:"#ccc",sort:0,category:E.plugin,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}],getNodeOption(t){const n=t.getData(),o=t.id,{componentId:l}=n;if(l)return{sourceId:o,dataId:l,dataType:G.component}},resetCurrentNodeData(t){const n=t.getData(),{cellName:o,...l}=We.data;t.replaceData({...n,...l})},getNodeDataModePro(t){return x.single}},fl=Object.freeze(Object.defineProperty({__proto__:null,default:_l},Symbol.toStringTag,{value:"Module"})),mt="调用插件",Je={shape:O.callPlugin,data:{cellName:mt,pluginId:{},pluginParams:[]}},gl=Object.freeze(Object.defineProperty({__proto__:null,CallPluginDataOptions:Je,NODE_NAME:mt,default:Je},Symbol.toStringTag,{value:"Module"})),yl={nodeName:mt,icon:"Setting",iconColor:"#ccc",sort:0,category:E.plugin,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}],getNodeOption(t){const n=t.getData(),o=t.id,{pluginId:l}=n;if(l)return{sourceId:o,dataId:l.pluginId,dataType:G.plugin}},resetCurrentNodeData(t){const n=t.getData(),{cellName:o,...l}=Je.data;t.replaceData({...n,...l})},getNodeDataModePro(t){return x.single}},vl=Object.freeze(Object.defineProperty({__proto__:null,default:yl},Symbol.toStringTag,{value:"Module"})),_t="条件",bl={shape:O.condition,data:{cellName:_t,condition:[]}},hl=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:_t,default:bl},Symbol.toStringTag,{value:"Module"})),Il={nodeName:_t,icon:"Setting",iconColor:"#ccc",sort:0,category:E.gateway,hidden:!0,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}]},Sl=Object.freeze(Object.defineProperty({__proto__:null,default:Il},Symbol.toStringTag,{value:"Module"})),ft="删除数据",Ke={shape:O.deleteData,data:{cellName:ft,entryId:"",relation:null,method:w.form,condition:[]}},Ol=Object.freeze(Object.defineProperty({__proto__:null,DeleteDataOptions:Ke,NODE_NAME:ft,default:Ke},Symbol.toStringTag,{value:"Module"})),Nl={nodeName:ft,icon:"Setting",iconColor:"#ccc",sort:0,category:E.dataOperation,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}],resetCurrentNodeData(t){const n=t.getData(),{cellName:o,...l}=Ke.data;t.replaceData({...n,...l})}},Dl=Object.freeze(Object.defineProperty({__proto__:null,default:Nl},Symbol.toStringTag,{value:"Module"})),gt="结束",Vl={shape:O.endNode,data:{cellName:gt}},Tl=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:gt,default:Vl},Symbol.toStringTag,{value:"Module"})),Ml={nodeName:gt,icon:"Setting",iconColor:"#ccc",sort:0,category:E.end,hidden:!0,portsItems:[{id:"port_1",group:"left"}]},wl=Object.freeze(Object.defineProperty({__proto__:null,default:Ml},Symbol.toStringTag,{value:"Module"})),Pl={nodeName:"条件分支",icon:"Setting",iconColor:"#ccc",sort:0,category:E.gateway,width:30,height:30,actions:[{type:A.add},{type:A.delete}],portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}]},$l=Object.freeze(Object.defineProperty({__proto__:null,default:Pl},Symbol.toStringTag,{value:"Module"}));var ae=(t=>(t.created="created",t.edited="edited",t.delete="delete",t))(ae||{});const yt="表单事件触发",we={shape:O.formEventTrigger,data:{cellName:yt,triggerEvent:ae.created,condition:[],entryId:"",triggerFieldIds:[]}},jl=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:yt,default:we,formEventTriggerOptions:we},Symbol.toStringTag,{value:"Module"})),Fl={nodeName:yt,icon:"Setting",iconColor:"#ccc",sort:0,category:E.trigger,hidden:!0,portsItems:[{id:"port_2",group:"right"}],getNodeOption(t){const n=t.getData(),o=t.id,{entryId:l}=n;if(l)return{sourceId:o,dataId:l,dataType:G.entry}},resetCurrentNodeData(t){const n=t.getData(),{triggerEvent:o,condition:l,triggerFieldIds:e}=we.data,u={...n,triggerEvent:o,condition:l,triggerFieldIds:e};t.replaceData({...u})},getNodeDataModePro(t){return x.single}},xl=Object.freeze(Object.defineProperty({__proto__:null,default:Fl},Symbol.toStringTag,{value:"Module"})),vt="获取多条数据",Qe={shape:O.getMultipleData,data:{cellName:vt,entryId:"",relation:null,method:w.form,noDataAction:ie.jump,limit:100,condition:[],sortRules:[]}},Cl=Object.freeze(Object.defineProperty({__proto__:null,GetMultipleDataOptions:Qe,NODE_NAME:vt,default:Qe},Symbol.toStringTag,{value:"Module"})),El={nodeName:vt,icon:"Setting",iconColor:"#ccc",sort:0,category:E.dataOperation,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}],getNodeOption(t){const n=t.getData(),o=t.id,{entryId:l,relation:e}=n;if(n.method===w.form)return l?{sourceId:o,dataId:l,dataType:G.entry}:void 0;if(e)return e.dataId?{sourceId:o,dataId:e.dataId,dataType:e.dataType}:void 0},resetCurrentNodeData(t){const n=t.getData(),{cellName:o,...l}=Qe.data,e={...n,...l};t.replaceData({...e})},getNodeDataModePro(t){return x.multiple}},kl=Object.freeze(Object.defineProperty({__proto__:null,default:El},Symbol.toStringTag,{value:"Module"})),bt="获取单条数据",Xe={shape:O.getSingleData,data:{cellName:bt,entryId:"",relation:null,method:w.form,noDataAction:ie.jump,condition:[],sortRules:[]}},Rl=Object.freeze(Object.defineProperty({__proto__:null,GetSingleDataOptions:Xe,NODE_NAME:bt,default:Xe},Symbol.toStringTag,{value:"Module"})),Ul={nodeName:bt,icon:"Setting",iconColor:"#ccc",sort:0,category:E.dataOperation,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}],getNodeOption(t){const n=t.getData(),o=t.id,{entryId:l,relation:e}=n;if(n.method===w.form)return l?{sourceId:o,dataId:l,dataType:G.entry}:void 0;if(e)return e.dataId?{sourceId:o,dataId:e.dataId,dataType:e.dataType}:void 0},resetCurrentNodeData(t){const n=t.getData(),{cellName:o,...l}=Xe.data,e={...n,...l};t.replaceData({...e})},getNodeDataModePro(t){return x.single}},zl=Object.freeze(Object.defineProperty({__proto__:null,default:Ul},Symbol.toStringTag,{value:"Module"})),Al={nodeName:"并行分支",icon:"Setting",iconColor:"#ccc",sort:0,category:E.gateway,width:30,height:30,actions:[{type:A.delete}],portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}]},ql=Object.freeze(Object.defineProperty({__proto__:null,default:Al},Symbol.toStringTag,{value:"Module"})),ht="发送消息通知",Ze={shape:O.sendMessage,data:{cellName:ht,msgConfig:void 0}},Gl=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:ht,SendMessageOptions:Ze,default:Ze},Symbol.toStringTag,{value:"Module"})),Bl={nodeName:ht,icon:"Setting",iconColor:"#ccc",sort:0,category:E.message,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}],resetCurrentNodeData(t){const n=t.getData(),{cellName:o,...l}=Ze.data,e={...n,...l};t.replaceData({...e})}},Hl=Object.freeze(Object.defineProperty({__proto__:null,default:Bl},Symbol.toStringTag,{value:"Module"}));var H=(t=>(t.count="count",t.countDstinct="countDstinct",t.empty="empty",t.min="min",t.max="max",t.sum="sum",t.avg="avg",t))(H||{});const It="汇总",et={shape:O.summary,data:{cellName:It,method:w.form,entryId:"",relation:null,condition:[],calcMethod:Ie.direct,summaryFieldId:H.count,summaryMethod:H.count}},Yl=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:It,SummaryDataOptions:et,default:et},Symbol.toStringTag,{value:"Module"})),Ll={nodeName:It,icon:"Setting",iconColor:"#ccc",sort:0,category:E.compute,portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],actions:[{type:A.delete}],getNodeOption(t){const n=t.getData(),o=t.id,{entryId:l,relation:e}=n;if(n.method===w.form)return l?{sourceId:o,dataId:l,dataType:G.summary}:void 0;if(e)return e.dataId?{sourceId:o,dataId:e.dataId,dataType:e.dataType}:void 0},resetCurrentNodeData(t){const n=t.getData(),{cellName:o,...l}=et.data,e={...n,...l};t.replaceData({...e})},getNodeDataModePro(t){return x.single}},Wl=Object.freeze(Object.defineProperty({__proto__:null,default:Ll},Symbol.toStringTag,{value:"Module"})),St="定时触发",Jl={shape:O.timeTrigger,data:{cellName:St,timedPlan:"",startTime:"",endTime:""}},Kl=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:St,default:Jl},Symbol.toStringTag,{value:"Module"})),Ql={nodeName:St,icon:"Setting",iconColor:"#ccc",sort:0,category:E.trigger,hidden:!0,portsItems:[{id:"port_2",group:"right"}]},Xl=Object.freeze(Object.defineProperty({__proto__:null,default:Ql},Symbol.toStringTag,{value:"Module"})),Ot="更新数据",Do={shape:O.updateData,data:{cellName:Ot,entryId:"",relation:null,method:w.form,noDataAction:ie.jump,condition:[],updateRules:[]}},Zl=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:Ot,default:Do},Symbol.toStringTag,{value:"Module"})),ea={nodeName:Ot,icon:"Setting",iconColor:"#ccc",sort:0,category:E.dataOperation,actions:[{type:A.delete}],portsItems:[{id:"port_1",group:"left"},{id:"port_2",group:"right"}],resetCurrentNodeData(t){const n=t.getData(),{cellName:o,...l}=Do.data;t.replaceData({...n,...l})},getNodeDataModePro(t){return x.single}},ta=Object.freeze(Object.defineProperty({__proto__:null,default:ea},Symbol.toStringTag,{value:"Module"})),Nt="Webhook触发",oa={shape:O.webhookTrigger,data:{cellName:Nt,requestParams:[],returnParams:[],headerConfig:[],whitelist:""}},na=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:Nt,default:oa},Symbol.toStringTag,{value:"Module"})),la={nodeName:Nt,icon:"Setting",iconColor:"#ccc",sort:0,category:E.trigger,hidden:!0,portsItems:[{id:"port_2",group:"right"}]},aa=Object.freeze(Object.defineProperty({__proto__:null,default:la},Symbol.toStringTag,{value:"Module"})),Ue={},ra=Object.assign({"../../nodes/addData/helper.ts":ul,"../../nodes/calculation/helper.ts":pl,"../../nodes/callComponent/helper.ts":fl,"../../nodes/callPlugin/helper.ts":vl,"../../nodes/condition/helper.ts":Sl,"../../nodes/deleteData/helper.ts":Dl,"../../nodes/endNode/helper.ts":wl,"../../nodes/exclusiveGateway/helper.ts":$l,"../../nodes/formEventTrigger/helper.ts":xl,"../../nodes/getMultipleData/helper.ts":kl,"../../nodes/getSingleData/helper.ts":zl,"../../nodes/parallelGateway/helper.ts":ql,"../../nodes/sendMessage/helper.ts":Hl,"../../nodes/summary/helper.ts":Wl,"../../nodes/timeTrigger/helper.ts":Xl,"../../nodes/updateData/helper.ts":ta,"../../nodes/webhookTrigger/helper.ts":aa});Object.entries(ra).forEach(([t,n])=>{const o=t.split(Oe.sep);o.pop();const l=o.pop();let e=n;e=e.default||e,Ue[l]=e});const sa=()=>{const t=[{title:"数据操作",category:E.dataOperation,modules:[]},{title:"分支",category:E.gateway,modules:[]},{title:"计算",category:E.compute,modules:[]},{title:"通知",category:E.message,modules:[]},{title:"开发组件",category:E.plugin,modules:[]},{title:"结束",category:E.end,modules:[]}];return Object.entries(Ue).forEach(([n,o])=>{const l=t.find(e=>e.category===o.category);l&&!o.hidden&&l.modules.push([n,o])}),t.forEach(n=>n.modules.sort((o,l)=>o[1].sort-l[1].sort)),t.filter(n=>Object.keys(n.modules).length)};function da(t){return t?Ue[t]??null:null}function de(t,n){var l;return t?((l=Ue[t])==null?void 0:l[n])??null:null}const Vo=Symbol("on:add:eventFlow"),To=Symbol("on:remove:eventFlow"),Dt=qo("eventFlow.designer.errors",()=>{const t=je(new Map),n=Go(),o=(i,c)=>{t.value.set(i,c),d(Vo,i)},l=i=>t.value.has(i),e=i=>{l(i)&&(t.value.delete(i),d(To,i))},u=i=>{if(l(i))return t.value.get(i)},s=async({data:i,shape:c,nodeId:m})=>new Promise((v,h)=>{const I=No(c);I?new Ho(I).validate(i,V=>{v(V?{type:"error",id:m,message:V[0].message??"节点设置异常"}:{type:"success",id:m,message:"验证成功"})}):(console.error(`当前节点${c}没有验证器`),h(!1))}),r=async({graph:i})=>new Promise((m,g)=>{const h=i.getNodes().map(I=>new Promise((N,V)=>{if(i.getConnectedEdges(I,{incoming:!0}),da(I.shape)){const D=i.getConnectedEdges(I,{outgoing:!0});(I.shape===O.endNode?!0:D.length>=1)?s({data:I.data,nodeId:I.id,shape:I.shape}).then(z=>{N(z)}):N({type:"error",id:I.id,message:"当前节点处于孤立状态"})}else V(`检测异常,${I.shape}没有验证规则`)}));Promise.all(h).then(I=>{I.forEach(N=>{N.type==="success"?e(N.id):o(N.id,{id:N.id,message:N.message})}),I.some(N=>N.type==="error")?g(!1):m(!0)}).catch(I=>{console.error(I)})});function p(i,c){n.on(i,c)}function d(i,c){n.emit(i,c)}return Bo(()=>{var i,c;(c=(i=n==null?void 0:n.all)==null?void 0:i.clear)==null||c.call(i)}),{addError:o,checkError:l,removeError:e,getErrorById:u,checkNodeData:s,checkAllNodeData:r,listeners:n,on:p,emit:d}}),ua=()=>{const t=ye(),{checkAllNodeData:n}=Dt(),o=Fe({loading:!1,releaseDisable:F(()=>t.eventFlowDesigner.releaseStatus===2),release:async()=>{o.loading=!0;try{await n({graph:t.graphInstance});const e=(await t.getNodes()).cells,u={...t.eventFlowDesigner,elJsonArray:e},s=await bn(u);t.eventFlowDesigner=fe(s),Pt.success("发布成功")}finally{o.loading=!1}},save:async()=>{o.loading=!0;try{const e=(await t.getNodes()).cells,u={...t.eventFlowDesigner,elJsonArray:e},s=await hn(u);t.eventFlowDesigner=fe(s),Pt.success("保存成功")}finally{o.loading=!1}}});return o},ia=S({__name:"EditName",props:{modelValue:{}},emits:["update:modelValue"],setup(t,{emit:n}){const o=t,e=Y(o,"modelValue",n),u=$(!1),s=$(),r=$(),p=$(!1),d=()=>{r.value=o.modelValue,p.value=!0,ao(()=>{var c;(c=s.value)==null||c.focus()})},i=()=>{p.value=!1,e.value||(e.value=r.value??"")};return(c,m)=>{const g=Lo;return f(),P("div",{class:"edit_box"},[L(_(Yo,{modelValue:a(e),"onUpdate:modelValue":m[0]||(m[0]=v=>C(e)?e.value=v:null),isBlurCache:"",placeholder:"请输入名称",readonly:u.value,ref_key:"renameInputRef",ref:s,maxlength:"10",title:"重命名",onBlur:i,"prefix-icon":a(lt)},null,8,["modelValue","readonly","prefix-icon"]),[[he,p.value]]),_(g,{effect:"dark",content:"重命名",placement:"bottom","show-after":200},{default:y(()=>[L(T("div",{class:"rename-display",onClick:d},[_(lo,{class:"mr-7",iconClass:"Edit",style:{fontSize:"16px"}}),T("span",{class:"az-ellipsis"},X(a(e)),1)],512),[[he,!p.value]])]),_:1})])}}});const Mo=ee(ia,[["__scopeId","data-v-31ca1da9"]]),ca=S({__name:"Header",setup(t){const n=ua(),o=ye(),l=Wo(),e=()=>{l.go(-1)},u=async()=>{await n.save()},s=async()=>{await n.release()};return(r,p)=>{const d=ro,i=Ne;return f(),P("div",{class:"eventFlow_designer-header"},[T("div",{class:"eventFlow_designer-title"},[_(d,{onClick:Ko(e,["stop"]),class:"designer-back"},{default:y(()=>[_(a(Jo))]),_:1},8,["onClick"]),_(Mo,{modelValue:a(o).eventFlowDesigner.name,"onUpdate:modelValue":p[0]||(p[0]=c=>a(o).eventFlowDesigner.name=c)},null,8,["modelValue"])]),T("div",{class:"eventFlow_designer-operate"},[_(i,{type:"primary",plain:"",loading:a(n).loading,onClick:u},{default:y(()=>[k(" 保存 ")]),_:1},8,["loading"]),_(i,{onClick:s,type:"primary",disabled:a(n).releaseDisable,loading:a(n).loading},{default:y(()=>[k(" 发布 ")]),_:1},8,["disabled","loading"])])])}}});const pa=ee(ca,[["__scopeId","data-v-f3d173cb"]]);function ze(t){return`${t}_${so()}`}const W=Qo;function Vt(t){return(t??[]).map(o=>({id:o.sourceId,title:o.nodeName,fieldOptions:{fields:(o==null?void 0:o.fields)??[]}}))}const Ae=[$t.serverTextFn,$t.smartAssistant],ma=()=>{const t=ye();return Fe({dargInNode(o,l){var s;const e=t.graphInstance,u=e==null?void 0:e.createNode({...o,id:ze(o.shape),data:{...o.data}});(s=t.dnd)==null||s.start(u,l)}})},wo="条件分支",_a={shape:O.exclusiveGateway,data:{cellName:wo}},fa=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:wo,default:_a},Symbol.toStringTag,{value:"Module"})),Po="并行分支",ga={shape:O.parallelGateway,data:{cellName:Po}},ya=Object.freeze(Object.defineProperty({__proto__:null,NODE_NAME:Po,default:ga},Symbol.toStringTag,{value:"Module"})),$o={},va=Object.assign({"../../nodes/addData/data.ts":sl,"../../nodes/calculation/data.ts":il,"../../nodes/callComponent/data.ts":ml,"../../nodes/callPlugin/data.ts":gl,"../../nodes/condition/data.ts":hl,"../../nodes/deleteData/data.ts":Ol,"../../nodes/endNode/data.ts":Tl,"../../nodes/exclusiveGateway/data.ts":fa,"../../nodes/formEventTrigger/data.ts":jl,"../../nodes/getMultipleData/data.ts":Cl,"../../nodes/getSingleData/data.ts":Rl,"../../nodes/parallelGateway/data.ts":ya,"../../nodes/sendMessage/data.ts":Gl,"../../nodes/summary/data.ts":Yl,"../../nodes/timeTrigger/data.ts":Kl,"../../nodes/updateData/data.ts":Zl,"../../nodes/webhookTrigger/data.ts":na});Object.entries(va).forEach(([t,n])=>{const o=t.split(Oe.sep),l=o[o.length-2];let e=n;e=e.default||e,$o[l]=e});function Se(t){const n=$o[t]??null;return n||console.error(`你需要查找节点类型为${t}组件, 但是并没有找到, 请检查一下是否存在该类型, 或者组件路径存在问题`),n}const ba=S({__name:"DndPanel",setup(t){const n=sa(),o=ma(),l=(e,u)=>{const s=fe(Se(u));s&&o.dargInNode(s,e)};return(e,u)=>{const s=Xo;return f(),P("div",{class:"eventFlow_designer-left"},[T("div",{class:"left-title"},"动作组件"),_(s,{class:"dnd_panel",id:"event_flow_dndContainer"},{default:y(()=>[(f(!0),P(R,null,te(a(n),r=>(f(),P("div",{class:"dnd_panel_item",key:r.category},[T("div",{class:"dnd_panel_item_title"},X(r.title),1),T("ul",{class:"dnd_panel_item_ul"},[(f(!0),P(R,null,te(r.modules,p=>(f(),P("li",{class:"dnd_panel_item_node",onMousedown:d=>l(d,p[0]),key:p[0]},[T("span",null,[_(lo,{"icon-class":p[1].icon},null,8,["icon-class"])]),T("span",{class:"dnd_panel_item_node_name"},X(p[1].nodeName),1)],40,["onMousedown"]))),128))])]))),128))]),_:1})])}}});const ha=ee(ba,[["__scopeId","data-v-adf86433"]]),Ia=je(Sn()),Sa=Ia,Oa=({graph:t,sourceCell:n,targetCell:o,sourceMagnet:l,targetMagnet:e})=>{if(!((e==null?void 0:e.getAttribute("port-group"))==="left"&&(l==null?void 0:l.getAttribute("port-group"))==="right"))return!1;const s=eo(t,n),r=eo(t,o,{checkClosed:!1});if(s){if(!Na(t,o))return!0;const d=Pe(t,s),i=$e(d);if(i)return i.id===o.id;{if(t.isPredecessor(n,o))return!1;if(r)if(s.id===r.id){const g=tt(t,s);return ot(g,o)}else{const g=Pe(t,r),v=$e(g);return o.id===(v==null?void 0:v.id)}const m=tt(t,s);return ot(m,o)}}return(t.getIncomingEdges(o)??[]).length<1};function eo(t,n,o){const l=(o==null?void 0:o.checkClosed)??!0,e=[O.exclusiveGateway,O.parallelGateway];let u;return function s(r){var d;const p=t.getPredecessors(r,{distance:1});if(p.length>=1){const i=(d=p==null?void 0:p[0])==null?void 0:d.shape,c=tt(t,p[0]);e.includes(i)&&ot(c,n)&&(!l||!Da(t,p[0]))?u=p[0]:s(p[0])}}(n),u}function Pe(t,n){return t.getSuccessors(n,{breadthFirst:!0,distance:1}).map(l=>[l,...t.getSuccessors(l)??[]])}function tt(t,n){const o=Pe(t,n),l=$e(o),e=(l==null?void 0:l.id)??"";return Va(o,e)}function $e(t){const n=new Set;for(const o of t)for(const l of o){if(n.has(l.id))return l;n.add(l.id)}return null}function Na(t,n){return(t.getIncomingEdges(n)??[]).length>=1}function Da(t,n){const o=Pe(t,n),l=$e(o),e=(l==null?void 0:l.id)??"";return o.map(u=>u.some(s=>s.id===e)).every(u=>u)}function ot(t,n){return t.flat().map(l=>l.id).includes(n.id)}function Va(t,n){return t.map(o=>{const l=o.findIndex(e=>e.id===n);return l!==-1?o.slice(0,l+1):[...o]})}const Ta=t=>{Be.registerConnector("curveConnector",(l,e)=>{const u=Math.abs(e.x-l.x),s=new be;return s.appendSegment(be.createSegment("M",l.x-4,l.y)),s.appendSegment(be.createSegment("L",l.x+12,l.y)),s.appendSegment(be.createSegment("C",l.x<e.x?l.x+u/2:l.x-u/2,l.y,l.x<e.x?e.x-u/2:e.x+u/2,e.y,e.x-6,e.y)),s.appendSegment(be.createSegment("L",e.x+2,e.y)),s.serialize()},!0),Ct.config({zIndex:-1,markup:[{tagName:"path",selector:"wrap",attrs:{fill:"none",cursor:"pointer",stroke:"transparent",strokeLinecap:"round"}},{tagName:"path",selector:"line",attrs:{fill:"none",pointerEvents:"none"}}],connector:{name:"curveConnector"},attrs:{wrap:{connection:!0,strokeWidth:10,strokeLinejoin:"round"},line:{zIndex:-1,connection:!0,stroke:"#2778ff",strokeWidth:1,targetMarker:{name:"classic",size:6}}}}),Be.registerEdge("edge",Ct,!0);const n=new Be({container:t.container,virtual:!0,autoResize:!0,background:{color:"#f5f6f8"},mousewheel:On(),panning:{enabled:!0,eventTypes:["leftMouseDown","mouseWheel"]},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#fff",stroke:"#31d0c6",strokeWidth:4}}}},connecting:{snap:!0,allowMulti:"withPort",allowBlank:!1,allowLoop:!1,highlight:!0,connectionPoint:"rect",anchor:"center",router:{name:"manhattan"},validateConnection(l){const{sourceCell:e,targetCell:u,targetMagnet:s,sourceMagnet:r}=l,p=u==null?void 0:u.shape,d=e==null?void 0:e.shape;return e&&d!==O.parallelGateway&&(this.getOutgoingEdges(e)??[]).length>1||p===O.condition?!1:Oa({graph:n,sourceCell:e,targetCell:u,targetMagnet:s,sourceMagnet:r})},validateMagnet({magnet:l}){return l.getAttribute("port")==="port_2"},createEdge(){return n.createEdge({shape:"edge",attrs:{line:{strokeDasharray:"5 5"}},zIndex:-1})}}}),o=l=>{((l==null?void 0:l.getEdges())??[]).forEach(u=>{u.attr("line/strokeDasharray","5")})};return n.on("edge:connected",({edge:l})=>{const e=`edge_${so()}`;n.updateCellId(l,e),((n==null?void 0:n.getEdges())??[]).forEach(s=>s.setZIndex(-1))}),n==null||n.on("node:added",({node:l})=>{const e=[O.exclusiveGateway],u=l.shape;if(e.includes(u)){const{x:s,y:r}=l.position(),p=l.id;[1,2].forEach(d=>{const i=Se(O.condition),c=s+100,m=d===1?r-70:r+25;if(i){const g={...i,id:ze(i.shape),position:{x:c,y:m},data:{...i.data}};n.addNode({...g});const v=n.createEdge({source:{cell:p,port:"port_2"},target:{cell:g.id,port:"port_1"},shape:"edge",attrs:{line:{strokeDasharray:"5 5"}},zIndex:-1});n.addEdge(v)}})}}),n==null||n.on("node:mouseenter",({node:l,cell:e,e:u,view:s})=>{const r=n.getOutgoingEdges(l)??[],d=l.getProp().shape,i=[O.exclusiveGateway];[O.parallelGateway].includes(d)?(l.getPorts()||[]).forEach(g=>{g.id&&g.group==="right"&&l.setPortProp(g.id,"attrs/circle",{fill:"#fff",stroke:"#2778FF"})}):!i.includes(d)&&r.length<1&&(l.getPorts()||[]).forEach(g=>{g.id&&g.group==="right"&&l.setPortProp(g.id,"attrs/circle",{fill:"#fff",stroke:"#2778FF"})})}),n==null||n.on("node:mouseleave",({e:l,node:e,view:u})=>{(e.getPorts()||[]).forEach(r=>{r.id&&e.setPortProp(r.id,"attrs/circle",{fill:"transparent",stroke:"transparent",r:4})}),e.removeTools()}),n==null||n.on("edge:click",({edge:l})=>{o(n),l.attr("line/strokeDasharray","0")}),n==null||n.bindKey(["backspace","Delete"],()=>{const l=n.getSelectedCells();return l.length&&n.removeCells(l),!1}),n},Ma=()=>{const t=_e("getNode"),n=_e("getGraph"),o=[O.endNode],l=F(()=>{var I;const h=(I=d.value)==null?void 0:I.shape;return!o.includes(h)}),e=$(!1),u=$("该节点配置有误，请检查配置属性"),{on:s,getErrorById:r}=Dt();s(Vo,h=>{var I;if(h===((I=d.value)==null?void 0:I.id)){const N=r(h);N&&(u.value=N.message??"该节点配置有误，请检查配置属性",e.value=!0)}}),s(To,h=>{var I;h===((I=d.value)==null?void 0:I.id)&&(e.value=!1)});const p=je(),d=$(),i=$(),c=$(!1),m=async()=>{var h,I;(I=p.value)==null||I.removeNode(((h=d.value)==null?void 0:h.id)??"")},g=()=>{var h,I,N;(h=p.value)==null||h.on("node:click",({node:V})=>{var K;c.value=V.id===((K=d.value)==null?void 0:K.id)}),(I=p.value)==null||I.on("blank:click",()=>{c.value=!1}),(N=p.value)==null||N.on("edge:click",()=>{c.value=!1})},v=()=>{var h;(h=d.value)==null||h.on("change:data",I=>{i.value=I.current.cellName})};return xe(()=>{d.value=t(),i.value=d.value.data.cellName,p.value=n(),ao(()=>{var I;const h=(I=d.value)==null?void 0:I.shape;o.includes(h)||g(),v()})}),{currentSelected:c,currentNode:d,cellName:i,deleteNode:m,errorMessage:u,isNodeError:e,isHover:l}},wa=()=>{const t=_e("getNode"),n=_e("getGraph"),o=je(),l=$(),e=[{name:"新增",type:A.add,icon:Ce,handleClick:()=>{var s,r,p,d;if((s=l.value)!=null&&s.id&&((r=l.value)==null?void 0:r.shape)===O.exclusiveGateway){const c=l.value,{x:m,y:g}=c.position(),v=c.id,h=Se(O.condition),I=m+100,N=g;if(h){const V={...h,id:ze(h.shape),position:{x:I,y:N},data:{...h.data}};(p=o.value)==null||p.addNode({...V}),(d=o.value)==null||d.addEdge({source:{cell:v,port:"port_2"},target:{cell:V.id,port:"port_1"},router:{name:"manhattan",args:{padding:20}},attrs:{line:{strokeDasharray:"5",stroke:"#2778ff",strokeWidth:1}}})}}}},{name:"删除",type:A.delete,icon:Zo,handleClick:()=>{var s,r,p,d,i;(s=l.value)!=null&&s.id&&(((r=l.value)==null?void 0:r.shape)===O.exclusiveGateway&&(((p=o.value)==null?void 0:p.getSuccessors(l.value,{distance:1}))??[]).forEach(g=>{var v;(v=o.value)==null||v.removeNode(g.id)}),(i=o.value)==null||i.removeNode((d=l.value)==null?void 0:d.id))}}],u=F(()=>{var d;const s=(d=l.value)==null?void 0:d.shape,r=de(s,"actions")??[],p=r.map(i=>i.type);return e.filter(i=>p.includes(i.type)).map(i=>{const c=r.find(m=>m.type===i.type);return{...i,...c??{}}})});return xe(()=>{l.value=t(),o.value=n()}),{Actions:u}},Pa=S({__name:"ActionsWrapper",setup(t){const{Actions:n}=wa();return(o,l)=>{const e=Mn,u=wn,s=Pn;return f(),P("div",{class:"node_processing"},[T("div",{class:"node_action-wrap"},[a(n).length>=1?(f(),b(s,{key:0,style:{width:"100%",height:"100%"}},{dropdown:y(()=>[_(u,null,{default:y(()=>[(f(!0),P(R,null,te(a(n),r=>(f(),b(e,{style:en({color:r.type===a(A).delete?"red":"inherit"}),key:r.type,icon:r.icon,onClick:p=>{var d;return(d=r==null?void 0:r.handleClick)==null?void 0:d.call(r)}},{default:y(()=>[k(X(r.name),1)]),_:2},1032,["style","icon","onClick"]))),128))]),_:1})]),default:y(()=>[Me(o.$slots,"default",{},void 0,!0)]),_:3})):Me(o.$slots,"default",{key:1},void 0,!0)])])}}});const Tt=ee(Pa,[["__scopeId","data-v-9a874ea8"]]),$a=S({__name:"NodeWrapper",setup(t){const{currentNode:n,cellName:o,isHover:l,currentSelected:e,isNodeError:u,errorMessage:s}=Ma();return(r,p)=>(f(),b(Tt,null,{default:y(()=>[T("div",{class:tn(["node_wrapper",{"is-active":a(e),"is-error":a(u),"is-hover":a(l)}])},[T("div",{class:"node_wrapper-header"},[_(on,{content:a(o),style:{width:"100px"}},null,8,["content"])]),a(u)?(f(),P("div",{key:0,class:"error-tips"},X(a(s)),1)):j("",!0)],2)]),_:1}))}});const J=ee($a,[["__scopeId","data-v-98ef80ca"]]),ja=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),Fa=Object.freeze(Object.defineProperty({__proto__:null,default:ja},Symbol.toStringTag,{value:"Module"})),xa=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),Ca=Object.freeze(Object.defineProperty({__proto__:null,default:xa},Symbol.toStringTag,{value:"Module"})),Ea=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),ka=Object.freeze(Object.defineProperty({__proto__:null,default:Ea},Symbol.toStringTag,{value:"Module"})),Ra=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),Ua=Object.freeze(Object.defineProperty({__proto__:null,default:Ra},Symbol.toStringTag,{value:"Module"})),za=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),Aa=Object.freeze(Object.defineProperty({__proto__:null,default:za},Symbol.toStringTag,{value:"Module"})),qa=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),Ga=Object.freeze(Object.defineProperty({__proto__:null,default:qa},Symbol.toStringTag,{value:"Module"})),Ba=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),Ha=Object.freeze(Object.defineProperty({__proto__:null,default:Ba},Symbol.toStringTag,{value:"Module"})),Ya=S({__name:"node",setup(t){return(n,o)=>(f(),b(Tt,null,{default:y(()=>[T("div",{class:"node_exclusive"},[T("div",{class:"node_exclusive-content"},"X")])]),_:1}))}});const La=ee(Ya,[["__scopeId","data-v-06e82c44"]]),Wa=Object.freeze(Object.defineProperty({__proto__:null,default:La},Symbol.toStringTag,{value:"Module"})),Ja=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),Ka=Object.freeze(Object.defineProperty({__proto__:null,default:Ja},Symbol.toStringTag,{value:"Module"})),Qa=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),Xa=Object.freeze(Object.defineProperty({__proto__:null,default:Qa},Symbol.toStringTag,{value:"Module"})),Za=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),er=Object.freeze(Object.defineProperty({__proto__:null,default:Za},Symbol.toStringTag,{value:"Module"})),tr=S({__name:"node",setup(t){return(n,o)=>{const l=ro;return f(),b(Tt,null,{default:y(()=>[T("div",{class:"node_exclusive"},[T("div",{class:"node_exclusive-content",style:{color:"#000"}},[_(l,null,{default:y(()=>[_(a(Ce))]),_:1})])])]),_:1})}}});const or=ee(tr,[["__scopeId","data-v-061ee5b7"]]),nr=Object.freeze(Object.defineProperty({__proto__:null,default:or},Symbol.toStringTag,{value:"Module"})),lr=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),ar=Object.freeze(Object.defineProperty({__proto__:null,default:lr},Symbol.toStringTag,{value:"Module"})),rr=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),sr=Object.freeze(Object.defineProperty({__proto__:null,default:rr},Symbol.toStringTag,{value:"Module"})),dr=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),ur=Object.freeze(Object.defineProperty({__proto__:null,default:dr},Symbol.toStringTag,{value:"Module"})),ir=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),cr=Object.freeze(Object.defineProperty({__proto__:null,default:ir},Symbol.toStringTag,{value:"Module"})),pr=S({__name:"node",setup(t){return(n,o)=>(f(),b(J))}}),mr=Object.freeze(Object.defineProperty({__proto__:null,default:pr},Symbol.toStringTag,{value:"Module"})),nt={},_r=Object.assign({"../../nodes/addData/node.vue":Fa,"../../nodes/calculation/node.vue":Ca,"../../nodes/callComponent/node.vue":ka,"../../nodes/callPlugin/node.vue":Ua,"../../nodes/condition/node.vue":Aa,"../../nodes/deleteData/node.vue":Ga,"../../nodes/endNode/node.vue":Ha,"../../nodes/exclusiveGateway/node.vue":Wa,"../../nodes/formEventTrigger/node.vue":Ka,"../../nodes/getMultipleData/node.vue":Xa,"../../nodes/getSingleData/node.vue":er,"../../nodes/parallelGateway/node.vue":nr,"../../nodes/sendMessage/node.vue":ar,"../../nodes/summary/node.vue":sr,"../../nodes/timeTrigger/node.vue":ur,"../../nodes/updateData/node.vue":cr,"../../nodes/webhookTrigger/node.vue":mr});Object.entries(_r).forEach(([t,n])=>{const o=t.split(Oe.sep),l=o[o.length-2];let e=n;e=e.default||e,nt[l]=e});const fr={left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#C2C8D5",strokeWidth:1,fill:"#fff"}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#C2C8D5",strokeWidth:1,fill:"#fff"}}}};function gr(t){return t.reduce((n,o)=>{const l=fr[o];return l?{...n,[o]:l}:n},{})}function yr(){for(const t in nt){const n=t,o=de(n,"portsItems")??[],l=de(n,"width")??120,e=de(n,"height")??34,u=at(o.map(s=>s.group));Nn({shape:t,width:l,height:e,component:nt[t],ports:{items:[...o].map(s=>({...s,attrs:{circle:{fill:"transparent",stroke:"transparent",r:4}}})),groups:gr(u)}})}}function vr(t){const n=$();return t.use(new Dn({enabled:!0,global:!0})),t.use(new Vn({enabled:!0})),t.bindKey(["Backspace","Delete"],l=>{n.value&&n.value.remove()}),t==null||t.on("edge:click",({edge:l})=>{l.attr("line/strokeDasharray","0"),n.value=l}),{dnd:new Tn({target:t,scaled:!1,dndContainer:document.getElementById("event_flow_dndContainer"),getDragNode:l=>l.clone({keepId:!0}),getDropNode:l=>l.clone({keepId:!0})})}}function br(t){const n=Fe({eventFlowDesigner:t.eventFlowDesigner,appId:t.appId,mode:t.mode,graphInstance:void 0,dnd:void 0,initGraph:async o=>{const l=Ta(o);yr();const{dnd:e}=vr(l);return n.dnd=e,n.graphInstance=l,n.graphInstance},renderNodes:async o=>(n.graphInstance.fromJSON(o),(n.graphInstance.getEdges()??[]).forEach(e=>e.setZIndex(-1)),n.graphInstance),getNodes:async()=>n.graphInstance.toJSON(),normEventFlowData:async o=>Array.isArray(o)?o:[o],verifyDataBefore:async()=>{var e;const o=n.eventFlowDesigner.elJsonArray,l=(e=await n.getNodes())==null?void 0:e.cells;return nn(JSON.parse(JSON.stringify(o)),JSON.parse(JSON.stringify(l)))}});return n}const jo=Symbol("智绘流.节点数据更新"),ve=()=>_e(jo,void 0),Fo=S({__name:"SelectEntry",props:{appId:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:n}){const e=Y(t,"modelValue",n);return(u,s)=>(f(),b($n,{modelValue:a(e),"onUpdate:modelValue":s[0]||(s[0]=r=>C(e)?e.value=r:null),appId:u.appId},null,8,["modelValue","appId"]))}}),hr=()=>{const t=(o,l)=>{((l==null?void 0:l.getSuccessors(o,{deep:!0}))??[]).forEach(u=>{const s=u;n==null||n(s)})},n=o=>{const l=o.shape,e=de(l,"resetCurrentNodeData");e==null||e(o)};return{resetNodeByCell:n,resetOutputNodesByCell:t}},xo=S({__name:"FormEntry",props:{appId:{},modelValue:{}},emits:["update:modelValue","resetNode"],setup(t,{emit:n}){const o=t,l=n,e=ve(),u=ye(),{resetOutputNodesByCell:s}=hr(),r=F({get(){return o.modelValue},set(p){o.modelValue&&o.modelValue!==p?ln.confirm("更新触发表单后，所有后续的工作节点将被重置，您需要重新配置节点数据，请确认需要执行该操作。","是否更改触发表单？",{confirmButtonText:"确认更改",cancelButtonText:"取消",type:"warning"}).then(()=>{if(e.selectNode){const d=u.graphInstance,i=e.selectNode;s(i,d),l("resetNode")}l("update:modelValue",p)}):l("update:modelValue",p)}});return(p,d)=>(f(),b(U,{label:"选择表单",prop:"entryId"},{default:y(()=>[_(Fo,{modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=i=>r.value=i),appId:p.appId},null,8,["modelValue","appId"])]),_:1}))}}),Co=()=>{const t=ve(),n=uo(),o=no(),l=an(),e=oo(),u=ye(),s=async v=>n.getFieldsAsync({entryId:v}),r=async v=>{const h=typeof v=="string"?v:v.dataId;return s(h)},p=async v=>{const{type:h,dataId:I}=v;return h===G.component?await e.getComponentHtmlNameAsync(I):h===G.plugin?await o.getPluginHtmlNameAsync({id:I}):h===G.calculation?"":await l.getFormHtmlNameAsync(I)},d=async()=>{var V;const v=t==null?void 0:t.selectNode,h=(V=u.graphInstance)==null?void 0:V.getCellById((v==null?void 0:v.id)??""),I=u.graphInstance.getPredecessors(h),N=await Promise.all(I.map(async K=>{const D=K.getData(),M=K.shape,q=de(M,"getNodeOption"),z=q==null?void 0:q(K);if(!z)return;const ue=await p({dataId:z.dataId,type:z.dataType});return{...z,entryName:ue??"",nodeName:(D==null?void 0:D.cellName)??"",nodeType:M}}));return at(N)},i=(v,h)=>[...v.filter(N=>{var q;const V=(q=u.graphInstance)==null?void 0:q.getCellById(N),K=V.shape,D=de(K,"getNodeDataMode"),M=D==null?void 0:D(V);return M?M===h:!0})],c=v=>u.graphInstance.getCellById(v),m=(v,h)=>{var D;const I=(D=u.graphInstance)==null?void 0:D.getCellById(v),N=I.shape,V=de(N,"getNodeDataModePro");return(V==null?void 0:V(I))===h};return{getFields:s,getFieldsByKeyword:r,getPredecessorOptions:d,checkDataMode:i,getNodeInfoById:c,getNodeByDataMode:(v,h)=>v.filter(N=>m(N.sourceId,h)),checkNodeDataMode:m}},Eo=S({__name:"SelectNode",props:{canSelectTypes:{default:()=>[O.formEventTrigger,O.timeTrigger,O.webhookTrigger,O.getSingleData,O.getMultipleData,O.calculation,O.summary,O.addData,O.updateProcessParam]},relation:{}},emits:["update:relation"],setup(t,{emit:n}){const o=t,l=n,e=F({get(){var p;return o!=null&&o.relation&&((p=o.relation)!=null&&p.nodeId)?`${o.relation.nodeId},${o.relation.dataId}`:""},set(p){const d=s.value.find(i=>i.value===p);d&&l("update:relation",{nodeId:d.sourceId,dataId:d.dataId,dataType:d.dataType})}}),u=Co(),s=$([]),r=async()=>{const d=(await u.getPredecessorOptions()).filter(i=>o.canSelectTypes.includes(i.nodeType)).map(i=>({...i,label:i.entryName?`${i.nodeName}(${i.entryName})`:i.nodeName,value:`${i.sourceId},${i.dataId}`}));return s.value=d,d};return(p,d)=>{const i=rt;return f(),b(rn,{modelValue:e.value,"onUpdate:modelValue":d[0]||(d[0]=c=>e.value=c),load:r},{default:y(({options:c})=>[(f(!0),P(R,null,te(c,m=>(f(),b(i,{key:m.value,value:m.value,label:m.label},{default:y(()=>[T("span",{style:{float:"left"}},X(m.nodeName),1),m.entryName?(f(),P("span",{key:0,style:{color:"var(--el-text-color-secondary)","font-size":"12px"}}," ("+X(m.entryName)+") ",1)):j("",!0)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])}}}),Ir=S({__name:"AddData",props:{modelValue:{},entryId:{},batchCreatRule:{},relation:{},formula:{},formulaFields:{}},emits:["update:modelValue","update:batchCreatRule","update:relation","update:formula"],setup(t,{emit:n}){const o=t,l=n,e=F(()=>[...Vt((o==null?void 0:o.formulaFields)??[])]),u=F(()=>[{label:"固定数量",value:Z.fixedNumber},{label:"选择数据源",value:Z.nodeSource}]),{modelValue:s,batchCreatRule:r,relation:p,formula:d}=io(o,l),i=()=>{r.value=Z.fixedNumber,p.value=null,d.value=""},c=m=>{const g=m;g===Z.fixedNumber&&(p.value=null),g===Z.nodeSource&&(d.value="")};return(m,g)=>{const v=ge,h=rt,I=co,N=re;return f(),P(R,null,[_(N,{label:"触发事件",required:"",style:{"margin-bottom":"0px !important"}},{default:y(()=>[T("div",{style:{width:"100%"}},[T("div",null,[_(v,{modelValue:a(s),"onUpdate:modelValue":g[0]||(g[0]=V=>C(s)?s.value=V:null),label:a(x).single,value:a(x).single,onChange:i},{default:y(()=>[k(" 新增单条数据 ")]),_:1},8,["modelValue","label","value"]),_(v,{modelValue:a(s),"onUpdate:modelValue":g[1]||(g[1]=V=>C(s)?s.value=V:null),label:a(x).multiple,value:a(x).multiple},{default:y(()=>[k(" 新增多条数据 ")]),_:1},8,["modelValue","label","value"])]),a(s)===a(x).multiple?(f(),P("div",{key:0,class:"batchCreateRule"},[T("div",null,"批量创建规则"),_(I,{modelValue:a(r),"onUpdate:modelValue":g[2]||(g[2]=V=>C(r)?r.value=V:null),style:{width:"200px"},onChange:c},{default:y(()=>[(f(!0),P(R,null,te(u.value,V=>(f(),b(h,{key:V.value,label:V.label,value:V.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(r)===a(Z).fixedNumber?(f(),b(vo,{key:0,group:e.value,modelValue:a(d),"onUpdate:modelValue":g[3]||(g[3]=V=>C(d)?d.value=V:null),mode:a(Ee).server,scenes:a(Ae),style:{flex:"1"}},null,8,["group","modelValue","mode","scenes"])):j("",!0),a(r)===a(Z).nodeSource?(f(),b(Eo,{key:1,style:{flex:"1"},relation:a(p),"onUpdate:relation":g[4]||(g[4]=V=>C(p)?p.value=V:null),canSelectTypes:[a(O).getSingleData,a(O).getMultipleData]},null,8,["relation","canSelectTypes"])):j("",!0)])):j("",!0)])]),_:1}),a(s)===a(x).multiple?(f(),P(R,{key:0},[a(r)===a(Z).fixedNumber?(f(),b(N,{key:0,prop:"formula"})):j("",!0),a(r)===a(Z).nodeSource?(f(),b(N,{key:1,prop:"relation"})):j("",!0)],64)):j("",!0)],64)}}});const Sr=ee(Ir,[["__scopeId","data-v-86f0bdc3"]]),Or=S({__name:"NodeSetFields",props:{modelValue:{},leftFields:{},rightFields:{},formulaFields:{}},emits:["update:modelValue"],setup(t,{emit:n}){const o=t,e=W(o,"modelValue",n),u=F(()=>po.map(r=>(r.value===mo.currentField&&(r.label="节点字段值"),r))),s=F(()=>[...Vt((o==null?void 0:o.formulaFields)??[])]);return(r,p)=>(f(),b(bo,sn(r.$attrs,{modelValue:a(e),"onUpdate:modelValue":p[0]||(p[0]=d=>C(e)?e.value=d:null),"left-fields":r.leftFields,"right-fields":r.rightFields,customTypeList:u.value,formulaProp:{mode:a(Ee).server,scenes:a(Ae),group:s.value}}),null,16,["modelValue","left-fields","right-fields","customTypeList","formulaProp"]))}});function ko(t,n){return t.map(o=>{const l=fe(o);return"fields"in l&&(l.fields=ko(l.fields,n)),l.options.secondaryLabel=n!=null&&n.entryName?`${n.nodeName}-${n.entryName}`:n.nodeName,l.fieldId=`${n.sourceId}-${o.fieldId}`,l})}const ne=t=>{const n=ve(),{getPredecessorOptions:o,checkDataMode:l,getNodeInfoById:e,getNodeByDataMode:u,checkNodeDataMode:s}=Co(),r=$(x.single),p=F(()=>i.value.map(D=>(D==null?void 0:D.fields)??[]).flat()),d=$(!1),i=jt(async()=>{const D=n.nodeShape,M=r.value,q=D===O.addData&&r.value===x.multiple,z=await o(),ue=q?z:u(z,M);return await Promise.all(ue.map(async me=>{const qe=await N(me),Ve=dn(qe,{excludeFilter(bs,Ge,hs){return!(Ge!=null&&Ge.isFormItem)}}),Ao=ko(Ve,me);return{...me,fields:Ao}}))},[],d),c=uo(),m=async D=>c.getFieldsAsync({entryId:D}),g=async D=>{const M=await c.dataSystem.getComponentData(D);return((M==null?void 0:M.outputParams)??[]).map(z=>un(z)).filter(z=>!!z)},v=async D=>{const M=await c.dataSystem.getPluginData(D);return((M==null?void 0:M.outputControls)??[]).map(z=>{const ue=z.subControls.map(pe=>Ft(pe)).filter(pe=>!!pe);return{...Ft(z),fields:ue}}).filter(z=>!!z)},h=async D=>{const M=D.sourceId,ue=e(M).getData().calcResultType,me={[le.text]:se.input,[le.number]:se.number,[le.date]:se.date,[le.dateTime]:se.date}[ue],qe=`_${me}_202509081136`,Ve=xt(me,{fieldId:qe,options:{label:"运算结果"}});return Ve?[Ve]:[]},I=async()=>{const D=`_${se.number}_202509081136`,M=xt(se.number,{fieldId:D,options:{label:"汇总结果"}});return M?[M]:[]},N=async D=>{const{dataId:M,dataType:q}=D;return q===G.component?await g(M):q===G.plugin?await v(M):q===G.summary?I():q===G.calculation?h({sourceId:(D==null?void 0:D.sourceId)??""}):await m(M)},V=async D=>{const M=typeof D=="string"?D:D.dataId;return m(M)},K=jt(async()=>{let D;const M="relation"in t?t.relation:null;return"entryId"in t&&t.entryId&&(D=t.entryId),M!=null&&M.dataId&&(D=M.dataId),N({dataId:D??"",dataType:(M==null?void 0:M.dataType)??G.entry})},[]);return{getFieldsByKeywordPromise:V,getEntryFields:m,checkDataMode:l,currentFields:K,frontNodeFields:p,frontNodeOptions:i,loadingNodeOption:d,dataMode:r}},Nr=()=>{const{checkError:t}=Dt(),n=ve(),o=F(()=>{var u;return((u=n.selectNode)==null?void 0:u.id)??""}),l=$(),e=()=>{var u;(u=l.value)==null||u.validate()};return xe(()=>{t(o.value)&&e()}),{ruleFormRef:l,handleValidate:e}},Q=S({__name:"ElFormWrapper",props:{form:{}},setup(t){const{ruleFormRef:n,handleValidate:o}=Nr(),l=ve(),e=F(()=>No(l.nodeShape));return(u,s)=>{const r=st;return f(),b(r,{"label-position":"top",ref_key:"ruleFormRef",ref:n,model:u.form,"label-width":"auto",rules:e.value},{default:y(()=>[Me(u.$slots,"default")]),_:3},8,["model","rules"])}}}),Dr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),{currentFields:u,frontNodeFields:s,frontNodeOptions:r,loadingNodeOption:p,dataMode:d}=ne(e.value);return cn(()=>e.value.addType,()=>{d.value=e.value.addType}),(i,c)=>{const m=re,g=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(xo,{modelValue:a(e).entryId,"onUpdate:modelValue":c[0]||(c[0]=v=>a(e).entryId=v),appId:i.appId},null,8,["modelValue","appId"]),_(Sr,{"entry-id":a(e).entryId,batchCreatRule:a(e).batchCreatRule,"onUpdate:batchCreatRule":c[1]||(c[1]=v=>a(e).batchCreatRule=v),modelValue:a(e).addType,"onUpdate:modelValue":c[2]||(c[2]=v=>a(e).addType=v),relation:a(e).batchRuleRelation,"onUpdate:relation":c[3]||(c[3]=v=>a(e).batchRuleRelation=v),formula:a(e).formula,"onUpdate:formula":c[4]||(c[4]=v=>a(e).formula=v),"formula-fields":a(r)},null,8,["entry-id","batchCreatRule","modelValue","relation","formula","formula-fields"]),_(m,{label:"字段设置",prop:"fieldSet"},{default:y(()=>[_(Or,{isSubform:"",modelValue:a(e).fieldSet,"onUpdate:modelValue":c[5]||(c[5]=v=>a(e).fieldSet=v),"left-fields":a(u),rightFields:a(s),formulaFields:a(r)},null,8,["modelValue","left-fields","rightFields","formulaFields"])]),_:1})]),_:1},8,["form"])),[[g,a(p)]])}}}),Vr=Object.freeze(Object.defineProperty({__proto__:null,default:Dr},Symbol.toStringTag,{value:"Module"})),Tr=S({__name:"Formula",props:{modelValue:{},formulaFields:{}},emits:["update:modelValue"],setup(t,{emit:n}){const o=t,e=Y(o,"modelValue",n),u=F(()=>[...Vt((o==null?void 0:o.formulaFields)??[])]);return(s,r)=>(f(),b(vo,{modelValue:a(e),"onUpdate:modelValue":r[0]||(r[0]=p=>C(e)?e.value=p:null),group:u.value,mode:a(Ee).server,scenes:a(Ae)},null,8,["modelValue","group","mode","scenes"]))}}),Ro=S({__name:"CalcMethod",props:{modelValue:{}},emits:["update:modelValue"],setup(t,{emit:n}){const e=Y(t,"modelValue",n),u=[{label:"直接计算",tip:"在当前节点计算直接计算并保存，后续节点引用时不再重新计算",value:Ie.direct},{label:"动态计算",tip:"在被其他节点引用时，实时进行最新的计算",value:Ie.dynamic}];return(s,r)=>{const p=ge;return f(),b(U,{label:"运算方式",prop:"calcMethod",required:""},{default:y(()=>[T("div",null,[(f(),P(R,null,te(u,d=>T("div",{key:d.value},[_(p,{modelValue:a(e),"onUpdate:modelValue":r[0]||(r[0]=i=>C(e)?e.value=i:null),size:"small",label:d.value,value:d.value},{default:y(()=>[k(X(d.label),1)]),_:2},1032,["modelValue","label","value"]),T("div"),T("span",{class:"Gray_75 fs-12"},X(d.tip),1)])),64))])]),_:1})}}}),Mr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),{frontNodeOptions:u,loadingNodeOption:s}=ne(e.value),r=[{label:"文本",value:le.text},{label:"数值",value:le.number},{label:"日期",value:le.date},{label:"日期时间",value:le.dateTime}];return(p,d)=>{const i=ge,c=pn,m=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(U,{label:"计算",prop:"formula"},{default:y(()=>[_(Tr,{modelValue:a(e).formula,"onUpdate:modelValue":d[0]||(d[0]=g=>a(e).formula=g),formulaFields:a(u)},null,8,["modelValue","formulaFields"])]),_:1}),_(U,{label:"运算结果类型",prop:"calcResultType",required:""},{default:y(()=>[_(c,{modelValue:a(e).calcResultType,"onUpdate:modelValue":d[1]||(d[1]=g=>a(e).calcResultType=g)},{default:y(()=>[(f(),P(R,null,te(r,g=>_(i,{value:g.value,label:g.value,key:g.value},{default:y(()=>[k(X(g.label),1)]),_:2},1032,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),_(Ro,{modelValue:a(e).calcMethod,"onUpdate:modelValue":d[2]||(d[2]=g=>a(e).calcMethod=g)},null,8,["modelValue"])]),_:1},8,["form"])),[[m,a(s)]])}}}),wr=Object.freeze(Object.defineProperty({__proto__:null,default:Mr},Symbol.toStringTag,{value:"Module"})),Pr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),{frontNodeFields:u,loadingNodeOption:s}=ne(e.value),r=()=>{e.value.customParams=null,e.value.componentConfig=[]};return(p,d)=>{const i=re,c=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(U,{label:"选择组件",prop:"componentId"},{default:y(()=>[_(jn,{modelValue:a(e).componentId,"onUpdate:modelValue":d[0]||(d[0]=m=>a(e).componentId=m),onChange:r},null,8,["modelValue"])]),_:1}),_(U,{label:"设置",required:""},{default:y(()=>[_(Fn,{modelValue:a(e).componentConfig,"onUpdate:modelValue":d[1]||(d[1]=m=>a(e).componentConfig=m),"custom-params":a(e).customParams,"onUpdate:customParams":d[2]||(d[2]=m=>a(e).customParams=m),"component-id":a(e).componentId,appId:p.appId,currentEntryInfo:{fields:a(u)}},null,8,["modelValue","custom-params","component-id","appId","currentEntryInfo"])]),_:1}),_(i,{prop:"componentConfig"})]),_:1},8,["form"])),[[c,a(s)]])}}}),$r=Object.freeze(Object.defineProperty({__proto__:null,default:Pr},Symbol.toStringTag,{value:"Module"})),jr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),{frontNodeFields:u,loadingNodeOption:s}=ne(e.value);return(r,p)=>{const d=re,i=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(U,{label:"选择插件",prop:"pluginId"},{default:y(()=>[_(xn,{modelValue:a(e).pluginId,"onUpdate:modelValue":p[0]||(p[0]=c=>a(e).pluginId=c),style:{width:"60%"}},null,8,["modelValue"])]),_:1}),_(U,{label:"设置",required:""},{default:y(()=>[_(Cn,{style:{width:"60%"},modelValue:a(e).pluginParams,"onUpdate:modelValue":p[1]||(p[1]=c=>a(e).pluginParams=c),pluginId:a(e).pluginId.pluginId,fields:a(u)},null,8,["modelValue","pluginId","fields"])]),_:1}),_(d,{prop:"pluginParams"})]),_:1},8,["form"])),[[i,a(s)]])}}}),Fr=Object.freeze(Object.defineProperty({__proto__:null,default:jr},Symbol.toStringTag,{value:"Module"})),ce=S({__name:"DataFilter",props:{entryId:{},fields:{},modelValue:{},label:{default:"筛选条件"},rightFields:{}},emits:["update:modelValue"],setup(t,{emit:n}){const o=t,l=n,e=F(()=>!(((o==null?void 0:o.fields)??[]).length>=1||o!=null&&o.entryId)),u=$(),s=Y(o,"modelValue",l),r=$(!1),p=()=>{i.value=fe(s.value),r.value=!0},d=async()=>{var c;await((c=u.value)==null?void 0:c.validate()),s.value=fe(i.value),r.value=!1},i=$([]);return(c,m)=>{const g=Ne,v=dt;return f(),b(U,{label:c.label,prop:"condition"},{default:y(()=>[_(g,{icon:a(Ce),disabled:e.value,onClick:p},{default:y(()=>[k(" 设置筛选条件 ")]),_:1},8,["icon","disabled"]),a(s).length>=1?(f(),b(kn,{key:0,class:"mt-10",style:{width:"100%",color:"var(--el-color-primary)"},condition:a(s),compareFields:c.rightFields,fields:c.fields,entryId:c.entryId},null,8,["condition","compareFields","fields","entryId"])):j("",!0),_(v,{modelValue:r.value,"onUpdate:modelValue":m[2]||(m[2]=h=>r.value=h),title:"筛选条件",width:"850px"},{footer:y(()=>[T("span",{class:"dialog-footer"},[_(g,{onClick:m[1]||(m[1]=h=>r.value=!1)},{default:y(()=>[k("取消")]),_:1}),_(g,{type:"primary",onClick:d},{default:y(()=>[k("确定")]),_:1})])]),default:y(()=>[r.value?(f(),b(En,{key:0,condition:i.value,"onUpdate:condition":m[0]||(m[0]=h=>i.value=h),conditionForm:c.entryId,fields:c.fields,compareFields:c.rightFields,controlTypeFieldName:"节点字段",isDataType:"",ref_key:"fieldConditionRef",ref:u},null,8,["condition","conditionForm","fields","compareFields"])):j("",!0)]),_:1},8,["modelValue"])]),_:1},8,["label"])}}}),xr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),{frontNodeOptions:u,checkDataMode:s,loadingNodeOption:r}=ne(e.value),p=F(()=>{const d=[O.formEventTrigger,O.getSingleData,O.addData],i=u.value.filter(m=>d.includes(m.nodeType)),c=s(i.map(m=>m.sourceId),"Single");return i.filter(m=>c.includes(m.sourceId)).map(m=>m.fields??[]).flat()});return(d,i)=>{const c=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(ce,{modelValue:a(e).condition,"onUpdate:modelValue":i[0]||(i[0]=m=>a(e).condition=m),fields:p.value,label:"筛选条件"},null,8,["modelValue","fields"])]),_:1},8,["form"])),[[c,a(r)]])}}}),Cr=Object.freeze(Object.defineProperty({__proto__:null,default:xr},Symbol.toStringTag,{value:"Module"})),Er=S({__name:"GetMethod",props:{entryId:{},appId:{},radioMethod:{},relation:{},GetDataMethodOptions:{default:()=>[{label:"从表单中获取",value:w.form},{label:"从数据节点获取",value:w.node}]},label:{default:"获取方式"}},emits:["update:entryId","update:radioMethod","update:relation","change"],setup(t,{emit:n}){const o=t,l=n,e=F(()=>(o==null?void 0:o.GetDataMethodOptions)??[]),u=Y(o,"entryId",l),s=Y(o,"radioMethod",l),r=Y(o,"relation",l),p=()=>{s.value===w.form?r.value=null:u.value="",l("change")};return(d,i)=>{const c=ge,m=_o,g=re;return f(),P(R,null,[_(U,{style:{"margin-bottom":"0px !important"},label:d.label,required:""},{default:y(()=>[T("div",{class:"flex_wrap"},[(f(!0),P(R,null,te(e.value,v=>(f(),P("div",{key:v.value},[_(c,{modelValue:a(s),"onUpdate:modelValue":i[0]||(i[0]=h=>C(s)?s.value=h:null),label:v.value,value:v.value,onChange:p},{default:y(()=>[k(X(v.label),1)]),_:2},1032,["modelValue","label","value"]),v.value===a(w).form?(f(),b(m,{key:0},{default:y(()=>[L(T("div",{class:"pl_20"},[_(Fo,{modelValue:a(u),"onUpdate:modelValue":i[1]||(i[1]=h=>C(u)?u.value=h:null),appId:d.appId},null,8,["modelValue","appId"])],512),[[he,a(s)===a(w).form]])]),_:1})):j("",!0),v.value===a(w).node?(f(),b(m,{key:1},{default:y(()=>[L(T("div",{class:"pl_20"},[_(Eo,{relation:a(r),"onUpdate:relation":i[2]||(i[2]=h=>C(r)?r.value=h:null),appId:d.appId},null,8,["relation","appId"])],512),[[he,a(s)===a(w).node]])]),_:1})):j("",!0)]))),128))])]),_:1},8,["label"]),a(s)===a(w).form?(f(),b(g,{key:0,prop:"entryId"})):j("",!0),a(s)===a(w).node?(f(),b(g,{key:1,prop:"relation"})):j("",!0)],64)}}});const De=ee(Er,[["__scopeId","data-v-aa6e1c5c"]]),kr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),u=[{label:"删除表单数据",value:w.form},{label:"删除节点数据",value:w.node}],{currentFields:s,frontNodeFields:r,loadingNodeOption:p}=ne(e.value),d=()=>{e.value.method!==w.form&&(e.value.condition=[])};return(i,c)=>{const m=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(De,{"radio-method":a(e).method,"onUpdate:radioMethod":c[0]||(c[0]=g=>a(e).method=g),"entry-id":a(e).entryId,"onUpdate:entryId":c[1]||(c[1]=g=>a(e).entryId=g),relation:a(e).relation,"onUpdate:relation":c[2]||(c[2]=g=>a(e).relation=g),appId:i.appId,GetDataMethodOptions:u,onChange:d,label:"删除方式"},null,8,["radio-method","entry-id","relation","appId"]),a(e).method===a(w).form&&a(e).entryId?(f(),b(ce,{key:0,modelValue:a(e).condition,"onUpdate:modelValue":c[3]||(c[3]=g=>a(e).condition=g),fields:a(s),"right-fields":a(r),label:"筛选条件"},null,8,["modelValue","fields","right-fields"])):j("",!0)]),_:1},8,["form"])),[[m,a(p)]])}}}),Rr=Object.freeze(Object.defineProperty({__proto__:null,default:kr},Symbol.toStringTag,{value:"Module"})),Ur=S({__name:"TriggerEvent",props:{entryId:{},triggerEvent:{},triggerFieldIds:{}},emits:["update:triggerEvent","update:triggerFieldIds"],setup(t,{emit:n}){const o=t,l=n,e=Y(o,"triggerEvent",l),u=Y(o,"triggerFieldIds",l);return(s,r)=>{const p=ge,d=_o;return f(),b(U,{label:"触发事件",prop:"triggerEvent"},{default:y(()=>[T("div",{class:"trigger-event_wrap"},[_(p,{modelValue:a(e),"onUpdate:modelValue":r[0]||(r[0]=i=>C(e)?e.value=i:null),label:a(ae).created,value:a(ae).created},{default:y(()=>[k(" 创建成功 ")]),_:1},8,["modelValue","label","value"]),_(p,{modelValue:a(e),"onUpdate:modelValue":r[1]||(r[1]=i=>C(e)?e.value=i:null),label:a(ae).edited,value:a(ae).edited},{default:y(()=>[k(" 编辑成功 ")]),_:1},8,["modelValue","label","value"]),_(d,null,{default:y(()=>[L(T("div",{class:"pl_20"},[T("div",{class:"Gray_75 fs-12"}," 指定的字段有更新时启动流程；未指定时更新任一字段都启动流程 "),_(mn,{style:{width:"100%"},modelValue:a(u),"onUpdate:modelValue":r[2]||(r[2]=i=>C(u)?u.value=i:null),entryId:s.entryId,placeholder:"选择触发字段",checkStrictly:"",multiple:""},null,8,["modelValue","entryId"])],512),[[he,a(ae).edited===a(e)]])]),_:1}),_(p,{modelValue:a(e),"onUpdate:modelValue":r[3]||(r[3]=i=>C(e)?e.value=i:null),label:a(ae).delete,value:a(ae).delete},{default:y(()=>[k(" 删除成功 ")]),_:1},8,["modelValue","label","value"])])]),_:1})}}});const zr=ee(Ur,[["__scopeId","data-v-03a47164"]]),Ar=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),u=()=>{const{cellName:s,entryId:r,...p}=we.data;e.value={...e.value,...p}};return(s,r)=>(f(),b(Q,{form:a(e)},{default:y(()=>[_(xo,{modelValue:a(e).entryId,"onUpdate:modelValue":r[0]||(r[0]=p=>a(e).entryId=p),appId:s.appId,onResetNode:u},null,8,["modelValue","appId"]),a(e).entryId?(f(),P(R,{key:0},[_(zr,{"trigger-event":a(e).triggerEvent,"onUpdate:triggerEvent":r[1]||(r[1]=p=>a(e).triggerEvent=p),"trigger-field-ids":a(e).triggerFieldIds,"onUpdate:triggerFieldIds":r[2]||(r[2]=p=>a(e).triggerFieldIds=p),entryId:a(e).entryId},null,8,["trigger-event","trigger-field-ids","entryId"]),_(ce,{modelValue:a(e).condition,"onUpdate:modelValue":r[3]||(r[3]=p=>a(e).condition=p),entryId:a(e).entryId},null,8,["modelValue","entryId"])],64)):j("",!0)]),_:1},8,["form"]))}}),qr=Object.freeze(Object.defineProperty({__proto__:null,default:Ar},Symbol.toStringTag,{value:"Module"})),Uo=S({__name:"FormSortRules",props:{fields:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:n}){const e=Y(t,"modelValue",n);return(u,s)=>(f(),b(U,{label:"排序规则",prop:"sortRules"},{default:y(()=>[Me(u.$slots,"top",{},()=>[T("div",{class:"Gray_75"}," 当查找到多个数据时，将按照排序规则获得第一条数据；如果未设置规则，返回最近更新的一条数据。 ")]),_(Un,{fields:u.fields,modelValue:a(e),"onUpdate:modelValue":s[0]||(s[0]=r=>C(e)?e.value=r:null)},null,8,["fields","modelValue"])]),_:3}))}}),Mt=S({__name:"GetFailed",props:{modelValue:{},options:{}},emits:["update:modelValue"],setup(t,{emit:n}){const e=Y(t,"modelValue",n);return(u,s)=>{const r=ge,p=re;return f(),b(p,{label:"未获取数据时执行",prop:"noDataAction"},{default:y(()=>[(f(!0),P(R,null,te(u.options,d=>(f(),b(r,{key:d.value,modelValue:a(e),"onUpdate:modelValue":s[0]||(s[0]=i=>C(e)?e.value=i:null),label:d.value,value:d.value},{default:y(()=>[k(X(d.label),1)]),_:2},1032,["modelValue","label","value"]))),128))]),_:1})}}}),wt=[{label:"跳过本节点继续执行",value:ie.jump},{label:"中止流程",value:ie.stop}],Gr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),{currentFields:u,frontNodeFields:s,loadingNodeOption:r}=ne(e.value);return(p,d)=>{const i=Rn,c=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(De,{"radio-method":a(e).method,"onUpdate:radioMethod":d[0]||(d[0]=m=>a(e).method=m),"entry-id":a(e).entryId,"onUpdate:entryId":d[1]||(d[1]=m=>a(e).entryId=m),appId:p.appId,relation:a(e).relation,"onUpdate:relation":d[2]||(d[2]=m=>a(e).relation=m)},null,8,["radio-method","entry-id","appId","relation"]),a(e).entryId||a(e).relation?(f(),P(R,{key:0},[_(ce,{modelValue:a(e).condition,"onUpdate:modelValue":d[3]||(d[3]=m=>a(e).condition=m),fields:a(u),"right-fields":a(s),label:"筛选条件"},null,8,["modelValue","fields","right-fields"]),_(Uo,{modelValue:a(e).sortRules,"onUpdate:modelValue":d[5]||(d[5]=m=>a(e).sortRules=m),fields:a(u)},{top:y(()=>[T("div",{style:{"margin-bottom":"8px"}},[k(" 按排序规则，获取过滤后的前 "),_(i,{modelValue:a(e).limit,"onUpdate:modelValue":d[4]||(d[4]=m=>a(e).limit=m),min:1,max:100,"controls-position":"right"},null,8,["modelValue"]),k(" 条数据 ")])]),_:1},8,["modelValue","fields"]),_(Mt,{modelValue:a(e).noDataAction,"onUpdate:modelValue":d[6]||(d[6]=m=>a(e).noDataAction=m),options:a(wt)},null,8,["modelValue","options"])],64)):j("",!0)]),_:1},8,["form"])),[[c,a(r)]])}}}),Br=Object.freeze(Object.defineProperty({__proto__:null,default:Gr},Symbol.toStringTag,{value:"Module"})),Hr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),{currentFields:u,frontNodeFields:s,loadingNodeOption:r}=ne(e.value);return(p,d)=>{const i=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(De,{"radio-method":a(e).method,"onUpdate:radioMethod":d[0]||(d[0]=c=>a(e).method=c),"entry-id":a(e).entryId,"onUpdate:entryId":d[1]||(d[1]=c=>a(e).entryId=c),relation:a(e).relation,"onUpdate:relation":d[2]||(d[2]=c=>a(e).relation=c),appId:p.appId},null,8,["radio-method","entry-id","relation","appId"]),_(ce,{modelValue:a(e).condition,"onUpdate:modelValue":d[3]||(d[3]=c=>a(e).condition=c),fields:a(u),"right-fields":a(s),label:"筛选条件"},null,8,["modelValue","fields","right-fields"]),_(Uo,{modelValue:a(e).sortRules,"onUpdate:modelValue":d[4]||(d[4]=c=>a(e).sortRules=c),fields:a(u)},null,8,["modelValue","fields"]),_(Mt,{modelValue:a(e).noDataAction,"onUpdate:modelValue":d[5]||(d[5]=c=>a(e).noDataAction=c),options:a(wt)},null,8,["modelValue","options"])]),_:1},8,["form"])),[[i,a(r)]])}}}),Yr=Object.freeze(Object.defineProperty({__proto__:null,default:Hr},Symbol.toStringTag,{value:"Module"})),Lr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),{frontNodeFields:u,loadingNodeOption:s}=ne(e.value);return(r,p)=>{const d=re,i=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[a(s)?j("",!0):(f(),P(R,{key:0},[_(zn,{modelValue:a(e).msgConfig,"onUpdate:modelValue":p[0]||(p[0]=c=>a(e).msgConfig=c),fields:a(u),memberSelectRequired:"",fieldsGroupTitle:"节点字段"},null,8,["modelValue","fields"]),_(d,{prop:"msgConfig"})],64))]),_:1},8,["form"])),[[i,a(s)]])}}}),Wr=Object.freeze(Object.defineProperty({__proto__:null,default:Lr},Symbol.toStringTag,{value:"Module"})),He=[{label:"计数",value:H.count},{label:"去重计数",value:H.countDstinct},{label:"空值数",value:H.empty},{label:"最小值",value:H.min},{label:"最大值",value:H.max},{label:"求和",value:H.sum},{label:"平均值",value:H.avg}],Jr=S({__name:"SummaryCalc",props:{summaryMethod:{},summaryFieldId:{},leftFields:{}},emits:["update:summaryMethod","update:summaryFieldId"],setup(t,{emit:n}){const o=t,l=n,{summaryFieldId:e,summaryMethod:u}=io(o,l),s=[H.count,H.countDstinct],r=F(()=>{const i=o.leftFields.map(m=>({label:m.options.label,value:m.fieldId}));return[...He.filter(m=>s.includes(m.value)),...i]}),p=F(()=>{const i=o.leftFields.find(c=>c.fieldId===e.value);if(i){if([se.number,se.slider].includes(i.type))return He;{const m=[H.count,H.countDstinct,H.empty];return He.filter(g=>m.includes(g.value))}}return[]}),d=()=>{u.value=H.count};return(i,c)=>{const m=rt,g=co;return f(),b(U,{label:"汇总计算",prop:"summaryFieldId"},{default:y(()=>[T("div",{style:{width:"100%",display:"flex","justify-content":"left"}},[_(g,{modelValue:a(e),"onUpdate:modelValue":c[0]||(c[0]=v=>C(e)?e.value=v:null),style:{width:"200px"},onChange:d},{default:y(()=>[(f(!0),P(R,null,te(r.value,v=>(f(),b(m,{key:v.value,value:v.value,label:v.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),p.value.length>=1?(f(),b(g,{key:0,style:{"margin-left":"20px",width:"200px"},modelValue:a(u),"onUpdate:modelValue":c[1]||(c[1]=v=>C(u)?u.value=v:null)},{default:y(()=>[(f(!0),P(R,null,te(p.value,v=>(f(),b(m,{key:v.value,value:v.value,label:v.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):j("",!0)])]),_:1})}}}),Kr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),u=[{label:"按表单进行汇总",value:w.form},{label:"按节点数据进行汇总",value:w.node}],{currentFields:s,frontNodeFields:r,loadingNodeOption:p}=ne(e.value);return(d,i)=>{const c=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(De,{"radio-method":a(e).method,"onUpdate:radioMethod":i[0]||(i[0]=m=>a(e).method=m),"entry-id":a(e).entryId,"onUpdate:entryId":i[1]||(i[1]=m=>a(e).entryId=m),relation:a(e).relation,"onUpdate:relation":i[2]||(i[2]=m=>a(e).relation=m),appId:d.appId,GetDataMethodOptions:u,label:"汇总方式"},null,8,["radio-method","entry-id","relation","appId"]),a(e).entryId||a(e).relation?(f(),P(R,{key:0},[a(e).method===a(w).form?(f(),P(R,{key:0},[_(ce,{modelValue:a(e).condition,"onUpdate:modelValue":i[3]||(i[3]=m=>a(e).condition=m),fields:a(s),"right-fields":a(r),label:"筛选条件"},null,8,["modelValue","fields","right-fields"]),_(Jr,{"summary-field-id":a(e).summaryFieldId,"onUpdate:summaryFieldId":i[4]||(i[4]=m=>a(e).summaryFieldId=m),"summary-method":a(e).summaryMethod,"onUpdate:summaryMethod":i[5]||(i[5]=m=>a(e).summaryMethod=m),"left-fields":a(s)},null,8,["summary-field-id","summary-method","left-fields"])],64)):j("",!0),_(Ro,{modelValue:a(e).calcMethod,"onUpdate:modelValue":i[6]||(i[6]=m=>a(e).calcMethod=m)},null,8,["modelValue"])],64)):j("",!0)]),_:1},8,["form"])),[[c,a(p)]])}}}),Qr=Object.freeze(Object.defineProperty({__proto__:null,default:Kr},Symbol.toStringTag,{value:"Module"})),Xr=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n);return(u,s)=>{const r=_n;return f(),b(Q,{form:a(e)},{default:y(()=>[_(U,{label:"定时计划",prop:"timedPlan"},{default:y(()=>[_(An,{modelValue:a(e).timedPlan,"onUpdate:modelValue":s[0]||(s[0]=p=>a(e).timedPlan=p),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),_(U,{label:"开始执行时间",prop:"startTime"},{default:y(()=>[_(r,{modelValue:a(e).startTime,"onUpdate:modelValue":s[1]||(s[1]=p=>a(e).startTime=p),type:"datetime",placeholder:"请选择时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss","date-format":"MMM DD, YYYY","time-format":"HH:mm"},null,8,["modelValue"])]),_:1}),_(U,{label:"结束执行时间",prop:"endTime"},{default:y(()=>[_(r,{modelValue:a(e).endTime,"onUpdate:modelValue":s[2]||(s[2]=p=>a(e).endTime=p),type:"datetime",placeholder:"请选择时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss","date-format":"MMM DD, YYYY","time-format":"HH:mm"},null,8,["modelValue"])]),_:1})]),_:1},8,["form"])}}}),Zr=Object.freeze(Object.defineProperty({__proto__:null,default:Xr},Symbol.toStringTag,{value:"Module"})),es=S({__name:"FormUpdateRules",props:{leftFields:{},rightFields:{},formulaFields:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:n}){const o=t,l=n;ve();const e=Y(o,"modelValue",l),u=F(()=>po.map(r=>(r.value===mo.currentField&&(r.label="节点字段值"),r))),s=F(()=>[...((o==null?void 0:o.formulaFields)??[]).map(p=>({id:p.sourceId,title:p.nodeName,fieldOptions:{fields:(p==null?void 0:p.fields)??[]}}))]);return(r,p)=>(f(),b(U,{label:"更新规则",prop:"updateRules"},{default:y(()=>[_(bo,{modelValue:a(e),"onUpdate:modelValue":p[0]||(p[0]=d=>C(e)?e.value=d:null),leftFields:r.leftFields,rightFields:r.rightFields,customTypeList:u.value,formulaProp:{mode:a(Ee).server,scenes:a(Ae),group:s.value}},null,8,["modelValue","leftFields","rightFields","customTypeList","formulaProp"])]),_:1}))}}),ts=[...wt,{label:"新增一条数据",value:ie.push}],os=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),{currentFields:u,frontNodeFields:s,frontNodeOptions:r,loadingNodeOption:p}=ne(e.value),d=[{label:"更新表单数据",value:w.form},{label:"按节点更新表单数据",value:w.node}];return(i,c)=>{const m=oe;return L((f(),b(Q,{form:a(e)},{default:y(()=>[_(De,{"radio-method":a(e).method,"onUpdate:radioMethod":c[0]||(c[0]=g=>a(e).method=g),"entry-id":a(e).entryId,"onUpdate:entryId":c[1]||(c[1]=g=>a(e).entryId=g),relation:a(e).relation,"onUpdate:relation":c[2]||(c[2]=g=>a(e).relation=g),appId:i.appId,GetDataMethodOptions:d,label:"更新方式"},null,8,["radio-method","entry-id","relation","appId"]),a(e).entryId||a(e).relation?(f(),P(R,{key:0},[a(e).method===a(w).form?(f(),b(ce,{key:0,modelValue:a(e).condition,"onUpdate:modelValue":c[3]||(c[3]=g=>a(e).condition=g),fields:a(u),"right-fields":a(s),label:"筛选条件"},null,8,["modelValue","fields","right-fields"])):j("",!0),_(es,{modelValue:a(e).updateRules,"onUpdate:modelValue":c[4]||(c[4]=g=>a(e).updateRules=g),"left-fields":a(u),"right-fields":a(s),formulaFields:a(r)},null,8,["modelValue","left-fields","right-fields","formulaFields"]),_(Mt,{modelValue:a(e).noDataAction,"onUpdate:modelValue":c[5]||(c[5]=g=>a(e).noDataAction=g),options:a(ts)},null,8,["modelValue","options"])],64)):j("",!0)]),_:1},8,["form"])),[[m,a(p)]])}}}),ns=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"})),ls=S({__name:"RequestParam",props:{modelValue:{}},emits:["update:modelValue"],setup(t,{expose:n,emit:o}){const u=Y(t,"modelValue",o),s={marginRight:"5px",marginBottom:"5px",flex:1},r=[{type:"input",key:"name",label:"名称",placeholder:"请输入名称",style:s},{type:"input",key:"param",label:"参数",placeholder:"请输入参数",style:s},{type:"input",key:"type",label:"类型",placeholder:"请输入类型",style:s},{type:"input",key:"defaultValue",label:"默认值",placeholder:"请输入默认值",style:s},{type:"input",key:"require",label:"必填",placeholder:"请输入必填",style:s},{type:"input",key:"remark",label:"说明",placeholder:"请输入说明",style:s},{type:"input",key:"transformParam",label:"参数转换",placeholder:"请输入参数转换",style:s},{type:"delIcon",key:"",label:""}],p=$({name:[{required:!0,message:"请输入参数名称",trigger:"blur"}],param:[{required:!0,message:"请输入参数",trigger:"blur"}],type:[{required:!0,message:"请输入类型",trigger:"blur"}],remark:[{required:!0,message:"请输入说明",trigger:"blur"}],defaultValue:[{required:!0,message:"请输入默认值",trigger:"blur"}],require:[{required:!0,message:"请输入是否必填",trigger:"blur"}],transformParam:[{required:!0,message:"请输入参数转换",trigger:"blur"}]}),d=$();return n({handleValidate:async()=>{var c;return await((c=d.value)==null?void 0:c.validateForm())}}),(c,m)=>{const g=ut,v=fo,h=re,I=st;return f(),b(I,{style:{"margin-bottom":"18px"}},{default:y(()=>[_(h,{label:"请求参数"},{default:y(()=>[_(g,{title:"可根据您的需要，设置方便记忆的参数名称",closable:!1,type:"info",style:{"margin-bottom":"10px"}}),_(v,{shadow:"never"},{default:y(()=>[_(ho,{ref_key:"ParamSettingFormTableRef",ref:d,list:r,model:a(u),"onUpdate:model":m[0]||(m[0]=N=>C(u)?u.value=N:null),"label-suffix":"：",rules:p.value},null,8,["model","rules"])]),_:1})]),_:1})]),_:1})}}}),to=S({__name:"ReturnParam",props:{label:{},modelValue:{}},emits:["update:modelValue"],setup(t,{expose:n,emit:o}){const u=Y(t,"modelValue",o),s={marginRight:"20px",marginBottom:"5px",flex:1},r=[{type:"input",key:"name",label:"名称",placeholder:"请输入名称",style:s},{type:"input",key:"param",label:"参数",placeholder:"请输入参数",style:s},{type:"input",key:"type",label:"类型",placeholder:"请输入类型",style:s},{type:"delIcon",key:"",label:""}],p=$({name:[{required:!0,message:"请输入参数名称",trigger:"blur"}],param:[{required:!0,message:"请输入参数",trigger:"blur"}],type:[{required:!0,message:"请输入类型",trigger:"blur"}]}),d=$();return n({handleValidate:async()=>{var c;return await((c=d.value)==null?void 0:c.validateForm())}}),(c,m)=>{const g=fo,v=re,h=st;return f(),b(h,{class:"param-sub-form",style:{"margin-bottom":"18px"}},{default:y(()=>[_(v,{label:c.label},{default:y(()=>[_(g,{shadow:"never",style:{width:"100%"}},{default:y(()=>[_(ho,{ref_key:"ParamSettingFormTableRef",ref:d,list:r,model:a(u),"onUpdate:model":m[0]||(m[0]=I=>C(u)?u.value=I:null),"label-suffix":"：",rules:p.value},null,8,["model","rules"])]),_:1})]),_:1},8,["label"])]),_:1})}}}),as=S({__name:"ParamSetWrap",props:{requestParams:{},returnParams:{},headerConfig:{}},emits:["update:requestParams","update:returnParams","update:headerConfig"],setup(t,{emit:n}){const o=t,l=n,e=F(()=>{const I=o.requestParams.length>=1,N=o.returnParams.length>=1,V=o.headerConfig.length>=1;return I&&N&&V}),u=F(()=>e.value?lt:fn),s=F(()=>e.value?"修改参数":"设置参数"),r=$(!1),p=$([]),d=$([]),i=$([]),c=$(),m=$(),g=$(),v=()=>{p.value=o.requestParams,d.value=o.returnParams,i.value=o.headerConfig,r.value=!0},h=async()=>{var I,N,V;p.value,d.value,i.value,p.value.length>=1||d.value.length>=1||i.value.length>=1?(await((I=c.value)==null?void 0:I.handleValidate()),await((N=m.value)==null?void 0:N.handleValidate()),await((V=g.value)==null?void 0:V.handleValidate()),l("update:requestParams",p.value),l("update:returnParams",d.value),l("update:headerConfig",i.value),r.value=!1):(l("update:requestParams",[]),l("update:returnParams",[]),l("update:headerConfig",[]),r.value=!1)};return(I,N)=>{const V=Ne,K=dt;return f(),P("div",{style:{width:"100%"}},[_(V,{type:e.value?"primary":"",plain:e.value,style:{width:"100%"},icon:u.value,onClick:v},{default:y(()=>[k(X(s.value),1)]),_:1},8,["type","plain","icon"]),_(K,{modelValue:r.value,"onUpdate:modelValue":N[4]||(N[4]=D=>r.value=D),title:"参数配置",width:"1100px"},{footer:y(()=>[T("div",{class:"dialog-footer"},[_(V,{onClick:N[3]||(N[3]=D=>r.value=!1)},{default:y(()=>[k("取消")]),_:1}),_(V,{type:"primary",onClick:h},{default:y(()=>[k("确定")]),_:1})])]),default:y(()=>[_(ls,{ref_key:"RequestParamRef",ref:c,modelValue:p.value,"onUpdate:modelValue":N[0]||(N[0]=D=>p.value=D)},null,8,["modelValue"]),_(to,{ref_key:"ReturnParamRef",ref:m,label:"返回参数",modelValue:d.value,"onUpdate:modelValue":N[1]||(N[1]=D=>d.value=D)},null,8,["modelValue"]),_(to,{ref_key:"HeaderConfigParamRef",ref:g,label:"请求头配置",modelValue:i.value,"onUpdate:modelValue":N[2]||(N[2]=D=>i.value=D)},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),rs=S({__name:"WhitelistIP",props:{modelValue:{}},emits:["update:modelValue"],setup(t,{emit:n}){const e=Y(t,"modelValue",n),u=F(()=>e.value?lt:Ce),s=$(!1),r=()=>{s.value=!0},p=()=>{s.value=!1};return(d,i)=>{const c=Ne,m=ut,g=go,v=dt;return f(),P("div",{style:{width:"100%"}},[_(c,{type:a(e)?"primary":"",plain:!!a(e),style:{width:"100%"},icon:u.value,onClick:r},{default:y(()=>[k(" 白名单ip ")]),_:1},8,["type","plain","icon"]),_(v,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=h=>s.value=h),title:"参数配置",width:"1100px"},{footer:y(()=>[T("div",{class:"dialog-footer"},[_(c,{onClick:i[1]||(i[1]=h=>s.value=!1)},{default:y(()=>[k("取消")]),_:1}),_(c,{type:"primary",onClick:p},{default:y(()=>[k("确定")]),_:1})])]),default:y(()=>[_(m,{style:{"margin-bottom":"10px"},title:"每行对应一个ip，回车换行录入。",type:"info"}),_(g,{modelValue:a(e),"onUpdate:modelValue":i[0]||(i[0]=h=>C(e)?e.value=h:null),style:{width:"100%"},rows:5,type:"textarea",placeholder:"请输入IP"},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),ss=S({__name:"form",props:{form:{},appId:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n),u=$("");return(s,r)=>{const p=go,d=Ne,i=ut;return f(),b(Q,{form:a(e)},{default:y(()=>[_(U,{label:"Webhook请求地址",prop:"url"},{default:y(()=>[T("div",{style:{width:"100%",display:"flex","justify-content":"space-between"}},[_(p,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=c=>u.value=c),style:{flex:"1"},disabled:""},null,8,["modelValue"]),_(d,{style:{"margin-left":"20px"},type:"primary",plain:""},{default:y(()=>[k(" 复制 ")]),_:1})])]),_:1}),_(U,{label:"参数设置",prop:"requestParams"},{default:y(()=>[_(as,{"header-config":a(e).headerConfig,"onUpdate:headerConfig":r[1]||(r[1]=c=>a(e).headerConfig=c),"request-params":a(e).requestParams,"onUpdate:requestParams":r[2]||(r[2]=c=>a(e).requestParams=c),"return-params":a(e).returnParams,"onUpdate:returnParams":r[3]||(r[3]=c=>a(e).returnParams=c)},null,8,["header-config","request-params","return-params"])]),_:1}),_(U,{label:"添加白名单",prop:"whitelist"},{default:y(()=>[_(i,{title:"添加白名单后，仅白名单内的来源请求可触发事件流",closable:!1,type:"info",style:{"margin-bottom":"10px"}}),_(rs,{modelValue:a(e).whitelist,"onUpdate:modelValue":r[4]||(r[4]=c=>a(e).whitelist=c)},null,8,["modelValue"])]),_:1})]),_:1},8,["form"])}}}),ds=Object.freeze(Object.defineProperty({__proto__:null,default:ss},Symbol.toStringTag,{value:"Module"})),zo={},us=Object.assign({"../../nodes/addData/form.vue":Vr,"../../nodes/calculation/form.vue":wr,"../../nodes/callComponent/form.vue":$r,"../../nodes/callPlugin/form.vue":Fr,"../../nodes/condition/form.vue":Cr,"../../nodes/deleteData/form.vue":Rr,"../../nodes/formEventTrigger/form.vue":qr,"../../nodes/getMultipleData/form.vue":Br,"../../nodes/getSingleData/form.vue":Yr,"../../nodes/sendMessage/form.vue":Wr,"../../nodes/summary/form.vue":Qr,"../../nodes/timeTrigger/form.vue":Zr,"../../nodes/updateData/form.vue":ns,"../../nodes/webhookTrigger/form.vue":ds});Object.entries(us).forEach(([t,n])=>{const o=t.split(Oe.sep),l=o[o.length-2];let e=n;e=e.default||e,zo[l]=e});function is(t){const n=zo[t]??null;return n||console.error(`你需要查找节点类型为${t}组件, 但是并没有找到, 请检查一下是否存在该类型, 或者组件路径存在问题`),n}const cs=()=>{const t=ye(),n=Fe({selectNode:void 0,nodeData:null,nodeShape:null,visible:!1,appId:t.appId,setData:o=>{}});return t.graphInstance.on("node:click",({node:o})=>{const l=[O.endNode,O.exclusiveGateway,O.parallelGateway],e=o.shape;if(!l.includes(e)){const u=o.getData();n.nodeData=u,n.nodeShape=o.shape,n.selectNode=o,n.visible=!0}}),n},ps=S({__name:"NodeEditName",props:{form:{}},emits:["update:form"],setup(t,{emit:n}){const e=W(t,"form",n);return(u,s)=>(f(),b(Mo,{modelValue:a(e).cellName,"onUpdate:modelValue":s[0]||(s[0]=r=>a(e).cellName=r)},null,8,["modelValue"]))}}),ms=S({__name:"SettingWrapper",setup(t){const n=cs();yo(jo,n);const o=F({get(){return n.visible},set(s){n.visible=s}}),l=F(()=>n.nodeShape),e=F({get(){return n.nodeData},set(s){var r,p;(p=n.selectNode)==null||p.prop("data",{...(r=n.selectNode)==null?void 0:r.prop("data"),...s})}}),u=async()=>{};return(s,r)=>(f(),b(yn,{size:"800px",modelValue:o.value,"onUpdate:modelValue":r[2]||(r[2]=p=>o.value=p),"show-load":u},{header:y(()=>[e.value?(f(),b(ps,{key:0,form:e.value,"onUpdate:form":r[0]||(r[0]=p=>e.value=p)},null,8,["form"])):j("",!0)]),default:y(()=>[a(n).nodeData&&l.value?(f(),b(gn(a(is)(l.value)),{key:0,form:e.value,"onUpdate:form":r[1]||(r[1]=p=>e.value=p),appId:a(n).appId},null,40,["form","appId"])):j("",!0)]),_:1},8,["modelValue"]))}}),_s={[Te.form]:O.formEventTrigger,[Te.manual]:O.formEventTrigger,[Te.time]:O.timeTrigger,[Te.webhook]:O.webhookTrigger};function fs(t){const n=_s[t],o=Se(n),l=Se(O.endNode);return at([o,l]).map(u=>{const s=u.shape===O.endNode?600:100;return{...u,id:ze(u.shape),position:{x:s,y:100},data:{...u.data}}})}const gs=S({__name:"app",props:{appId:{},flowDesigner:{}},setup(t){vn();const n=t,o=br({mode:So.designer,appId:n.appId,eventFlowDesigner:n.flowDesigner});return yo(Io,o),xe(async()=>{if(await o.initGraph({container:document.getElementById("container")}),n.flowDesigner,n.flowDesigner.elJsonArray.length>=1)o.renderNodes(n.flowDesigner.elJsonArray);else{const l=fs(n.flowDesigner.triggerType);o.renderNodes(l)}}),(l,e)=>(f(),P("div",{class:"eventFlow_designer"},[_(pa),T("div",{class:"eventFlow_designer-main"},[_(ha),T("div",{class:"eventFlow_designer-container",id:"container"})]),a(o).graphInstance?(f(),b(ms,{key:0})):j("",!0),_(a(Sa))]))}});const ys=ee(gs,[["__scopeId","data-v-054f72fd"]]),vs=S({__name:"routePage",setup(t){const n=Et("appId"),o=Et("chainId"),l=$(),e=async()=>{const u=o.value??"",s=await In(u);l.value=s};return(u,s)=>(f(),b(qn,{load:e},{default:y(()=>[l.value?(f(),b(a(ys),{key:0,class:"ef_page",appId:a(n)??"",flowDesigner:l.value},null,8,["appId","flowDesigner"])):j("",!0)]),_:1}))}});const kd=ee(vs,[["__scopeId","data-v-7b0ef068"]]);export{kd as default};

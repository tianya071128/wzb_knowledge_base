import{d as P,r as g,v as H,bK as Q,uE as J,c as T,i as o,bz as W,o as w,b as I,w as n,bu as X,B as x,l as Y,f as R,F as Z,g as ee,m as F,t as ae,C as te,bv as le,uF as se,aN as N,uG as oe,uH as U,uI as M,uJ as L,dO as re,ac as ne,Q as de,E as ie,ab as ue,bm as pe,_ as ce,bi as me,iC as fe,e as _e,ae as be,cc as z,bs as ye,rW as ve,bh as ge,uK as we,uL as he,P as Ve,U as Ie,uM as xe}from"./index-b80d5ef5.js";import{E as Ce}from"./el-input-number-c15b1cc7.js";import{_ as Ee}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";const ke=P({__name:"PosAddAndEdit",props:{drawerModel:{type:Boolean},rowData:{},comState:{}},emits:["update:drawerModel","refresh"],setup(S,{emit:h}){const p=g(),b=h,i=S,y=[{label:"省份直辖市",value:1},{label:"地域",value:2},{label:"区县",value:3},{label:"其他区域",value:4}],c=H(i,"drawerModel",b),C=()=>{var s;c.value=!1,(s=p.value)==null||s.resetFields()},E=Q({code:[{required:!0,message:"请输入区域代码",trigger:"blur"}],type:[{required:!0,message:"请选择区域类型",trigger:"blur"}],name:[{required:!0,message:"请输入区域名称",trigger:"blur"}],sort:[{required:!0,message:"请输入排序号",trigger:"blur"},{pattern:J,message:"请输入纯数字",trigger:["blur","change"]}]}),v={code:"",name:"",remarks:"",sort:0,status:1,type:1,parentId:"",parentName:""},l=g({...v}),k=T(()=>{var s,t;return(t=(s=i.rowData)==null?void 0:s.parentIds)==null?void 0:t.split(",")}),e=T(()=>y.filter((s,t)=>{var d;const _=parseInt((d=i.rowData)==null?void 0:d.parentType);return _===4&&t===3?s:_?t>=_:s})),a=s=>i.comState===s,m=T(()=>({view:"查看区域",edit:"编辑区域",add:"新增区域",addChildren:"新增下级区域"})[i.comState]),u=async()=>{a("add")?l.value={...v}:l.value={...i.rowData}},f=async s=>{var t;await((t=p.value)==null?void 0:t.validate()),a("edit")?(await se(l.value),N.success("修改区域成功")):(await oe(l.value),N.success("新增区域成功")),s==="submitContinue"&&(l.value={...v}),b("refresh",l.value.parentId)},A={label:"name",children:"children"},V=async(s,t)=>{if(s.level===0)return t(await U({type:"1"}));if(s.level>=1){const _={parentId:s.data.id},d=await M(_);t(d)}},q=async s=>s?await L({name:s}):!0,B=o(W,{iconClass:"treeSelect"},null);return(s,t)=>{const _=re,d=ne,D=de,$=ie,K=ue,O=Ce,j=pe;return w(),I(le,{modelValue:x(c),"onUpdate:modelValue":t[7]||(t[7]=r=>te(c)?c.value=r:null),title:m.value,onClose:C,"show-load":u},{footer:n(()=>[o(X,{editMode:a("edit"),onClose:t[6]||(t[6]=r=>c.value=!1),"on-submit":f},null,8,["editMode"])]),default:n(()=>[o(j,{ref_key:"ruleFormRef",ref:p,rules:E,model:l.value,"label-width":"100px","label-position":"left"},{default:n(()=>[o(d,{label:"上级区域",prop:"parentName"},{default:n(()=>[x(c)?(w(),I(_,{key:0,"suffix-icon":x(B),disabled:a("addChildren"),clearable:"","default-expanded-keys":k.value,"filter-node-method":q,filterable:"",rowKey:"id","value-key":"id",lazy:"",accordion:"",load:V,props:A,class:"elTreeSelect",modelValue:l.value.parentId,"onUpdate:modelValue":t[0]||(t[0]=r=>l.value.parentId=r),"check-strictly":"",placeholder:"请选择上级区域","render-after-expand":!1},null,8,["suffix-icon","disabled","default-expanded-keys","modelValue"])):Y("",!0)]),_:1}),o(d,{label:"区域代码",prop:"code"},{default:n(()=>[o(D,{modelValue:l.value.code,"onUpdate:modelValue":t[1]||(t[1]=r=>l.value.code=r),placeholder:"请输入区域代码"},null,8,["modelValue"])]),_:1}),o(d,{label:"区域名称",prop:"name"},{default:n(()=>[o(D,{modelValue:l.value.name,"onUpdate:modelValue":t[2]||(t[2]=r=>l.value.name=r),placeholder:"请输入区域名称"},null,8,["modelValue"])]),_:1}),o(d,{label:"区域类型",prop:"type"},{default:n(()=>[o(K,{modelValue:l.value.type,"onUpdate:modelValue":t[3]||(t[3]=r=>l.value.type=r)},{default:n(()=>[(w(!0),R(Z,null,ee(e.value,(r,G)=>(w(),I($,{key:G,label:r.value},{default:n(()=>[F(ae(r.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,{label:"排序号",prop:"sort"},{default:n(()=>[o(O,{modelValue:l.value.sort,"onUpdate:modelValue":t[4]||(t[4]=r=>l.value.sort=r),min:0,style:{"min-width":"180px"},placeholder:"请输入排序号"},null,8,["modelValue"])]),_:1}),o(d,{label:"备注"},{default:n(()=>[o(D,{type:"textarea",modelValue:l.value.remarks,"onUpdate:modelValue":t[5]||(t[5]=r=>l.value.remarks=r),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","title"])}}});const Ae=ce(ke,[["__scopeId","data-v-9b071bff"]]),De={name:"Region"},Se=P({...De,setup(S){const h=new Map,p=g(),b=g(!1),i=g("add"),y=g({}),c=async(e,a,m)=>{const u={parentId:e.id},f=await M(u);h.set(e.id,{row:e,treeNode:a,resolve:m}),m(f)},C=async e=>{const a=p.value.tableRef.store.states.treeData.value[e];if(h.get(e)&&a.expanded){const u=await M({parentId:e});u.length<=0&&(delete p.value.tableRef.store.states.lazyTreeNodeMap.value[e],a.expanded=!1,a.loaded=!1),h.get(e).resolve(u)}},E={query:{list:[{type:"input",label:"区域代码",prop:"code"},{type:"input",label:"区域名称",prop:"name"},{type:"select",label:"状态",prop:"status",options:"status",isAll:!0,initValue:z}]},request:{api:async e=>e.code||e.name?await L(e):(e.type="1",await U(e))},table:{tableProps:{treeProps:{children:"children",hasChildren:"hasChildren"},rowKey:"id",lazy:!0,load:c},tableCols:[{prop:"name",label:"区域名称"},{prop:"type",label:"区域类型",slots:{default({row:e}){return o("span",null,[ye(e.type,"region_type")])}}},{prop:"remarks",label:"备注信息",showOverflowTooltip:!0},{prop:"sort",label:"排序号"},{prop:"status",width:120,label:"状态",slots:{default({row:e}){return o(ge,{disabled:!ve("system:region:enable"),modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,updateFetch:()=>k(e.id,e.status)},null)}}},{fixed:"right",width:180,label:"操作",slots:{default({row:e}){const f=[{type:"primary",premission:"system:region:edit",onClick:()=>{l("edit",e)},text:"编辑"},{type:"primary",premission:"system:region:addxj",onClick:()=>{l("addChildren",e)},text:"新增下级区域"},{type:"danger",text:"删除",premission:"system:region:delete",popconfirmProps:{title:"您确定要删除该区域吗?",confirm:async()=>{await xe(e.id),N.success("删除成功"),await v(e.parentId)}}}];return o(Ee,{num:2,rowId:e.id,list:f},null)}}}]},pagination:{hidePagination:!0}},v=async e=>{var a;e==="0"||!e?await((a=p.value)==null?void 0:a.refresh()):await C(e)},l=(e,a)=>{e==="add"?y.value={code:"",name:"",remarks:"",sort:0,status:1,type:1,parentId:"",parentName:""}:e==="addChildren"?y.value={code:"",name:"",remarks:"",sort:0,status:1,type:a.type===4?a.type:a.type+1,parentId:a.id,parentIds:a.parentIds,parentName:a.name,parentType:a.type}:(a.parentId==="0"&&(a.parentId=""),y.value=Object.assign({},a)),i.value=e,b.value=!0},k=async(e,a)=>a==z?await we(e):await he(e);return(e,a)=>{const m=Ve,u=Ie,f=me("az-page"),A=fe("premission");return w(),R("div",null,[o(f,{class:"layout_box",ref_key:"azPageRef",ref:p,config:E,maxHeight:"var(--az-layout-main-height) - 40px"},{operation:n(()=>[_e((w(),I(u,{onClick:a[0]||(a[0]=V=>l("add")),type:"primary"},{default:n(()=>[o(m,{size:16,style:{"margin-right":"8px"}},{default:n(()=>[o(x(be))]),_:1}),F(" 新增区域 ")]),_:1})),[[A,"system:region:add"]])]),_:1},512),o(Ae,{"drawer-model":b.value,"onUpdate:drawerModel":a[1]||(a[1]=V=>b.value=V),"row-data":y.value,onRefresh:v,"com-state":i.value},null,8,["drawer-model","row-data","com-state"])])}}});export{Se as default};

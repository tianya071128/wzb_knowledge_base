import{d as M,r as o,c as D,bi as K,o as f,f as R,i as t,w as p,B as a,a5 as ue,m as E,C as A,F as j,cf as W,by as H,U as L,v as X,c$ as Q,b as I,k as U,l as S,t as J,d0 as re,g as ee,bp as ae,d1 as ie,d2 as de,d3 as ce,E as me,ab as fe,ac as te,cI as _e,bm as le,q as se,bn as ne,_ as be,bo as Z,d4 as ye,bq as ge,aN as G,Q as ve,br as ke,cu as Ve,d5 as he,d6 as xe,d7 as Ae,as as Ce,b4 as Be,bd as Ee,N as Ie}from"./index-b80d5ef5.js";import{T as we}from"./Tabs-69fb071c.js";import{A as Te,_ as pe,a as Ue,b as Se,c as Re}from"./AppExport-ba4fbe43.js";import{q as $e,b as ze,i as qe,f as Ne,h as De}from"./appManage-8a2e3832.js";import{b as Me,c as Fe}from"./homePage-3523f56f.js";import{a as z}from"./index-c8016e23.js";import{a as q}from"./index-c4a56c4a.js";/* empty css                          */import"./useQueryTab-05fa7456.js";import"./useExtractQuery-f96f705c.js";import"./SelectIcon-71b7daf2.js";import"./AppIconNew-704f70f4.js";import"./useTransformColor-38b5da33.js";import"./enum-baae9292.js";import"./el-space-0d01b33a.js";const Pe=M({__name:"MyCreate",setup($){const h=o(),x=D(()=>({query:{list:[{type:"input",label:"应用名称",prop:"name"},{type:"select",label:"状态",prop:"status",options:W,extraOptions:[{label:"全部",value:""}]}]},request:{api:$e},table:{tableCols:[{label:"应用名称",prop:"name"},{label:"应用描述",prop:"description"},{label:"状态",prop:"status",slots:{default({row:l}){return t(H,{type:l.status==0?"primary":"info"},{default:()=>[l.status==0?"启用":"停用"]})}}}]}})),y=o(!1),u=o(!1),s=o(!1),_=o("add"),r=o(""),k=()=>{y.value=!0},w=g=>{switch(g){case"1":s.value=!0,_.value="add",r.value="";break;case"3":u.value=!0;break}y.value=!1};function T(){var g;(g=h.value)==null||g.refresh()}return(g,l)=>{const b=L,C=K("az-page");return f(),R(j,null,[t(C,{config:a(x),ref_key:"azPageRef",ref:h},{operation:p(()=>[t(b,{type:"primary",icon:a(ue),onClick:k},{default:p(()=>[E(" 创建应用 ")]),_:1},8,["icon"])]),_:1},8,["config"]),t(Te,{"drawer-model":a(y),"onUpdate:drawerModel":l[0]||(l[0]=d=>A(y)?y.value=d:null),onHandleClick:w},null,8,["drawer-model"]),t(pe,{"drawer-model":a(s),"onUpdate:drawerModel":l[1]||(l[1]=d=>A(s)?s.value=d:null),comState:a(_),"app-id":a(r),isCooperateApp:!1,onRefresh:T},null,8,["drawer-model","comState","app-id"]),t(Ue,{visible:a(u),"onUpdate:visible":l[2]||(l[2]=d=>A(u)?u.value=d:null),onSuccess:T},null,8,["visible"])],64)}}}),Ye=M({__name:"AppUpgrade",props:{modelValue:{type:Boolean},appId:{}},emits:["update:modelValue","refresh"],setup($,{emit:h}){const x=$,u=X(x,"modelValue",h),s=o(0),_=o(),r=o(!1),k=async()=>{var n,e,c,i;if((n=_.value)!=null&&n.response){if(s.value==0)try{r.value=!0,b.value=await ze({fileId:(e=_.value)==null?void 0:e.response}),s.value++}finally{r.value=!1}else if(s.value==1){await((c=g.value)==null?void 0:c.validate());try{r.value=!0,await qe({appId:x.appId,fileId:(i=_.value)==null?void 0:i.response,entryIds:l.value.entryIds,isBackups:l.value.isBackups}),u.value=!1}finally{r.value=!1}}}},w=D(()=>{switch(s.value){case 0:return"下一步";case 1:return"开始升级";default:return"下一步"}}),T=D(()=>{var n;return s.value===0?!((n=_.value)!=null&&n.response):!1}),g=o(),l=o({range:Q.all,entryIds:[],isBackups:!0}),b=o([]),C={label:"name"},d=()=>{l.value.entryIds=[]},B=(n,e)=>{e?n.type!="app"&&l.value.entryIds.push(n.id):l.value.entryIds=l.value.entryIds.filter(c=>c!==n.id)};return(n,e)=>{const c=de,i=ce,m=me,F=fe,N=te,P=_e,Y=le,O=se,v=L,oe=ne;return f(),I(oe,{title:"应用导入升级","append-to-body":"",width:"800px",modelValue:a(u),"onUpdate:modelValue":e[4]||(e[4]=V=>A(u)?u.value=V:null)},{footer:p(()=>[U("div",{class:"dialog_footer"},[U("div",{class:"flex1"},[a(s)===1?(f(),I(O,{key:0,modelValue:a(l).isBackups,"onUpdate:modelValue":e[2]||(e[2]=V=>a(l).isBackups=V)},{default:p(()=>[E(" 升级前备份当前版本应用，数据 ")]),_:1},8,["modelValue"])):S("",!0)]),a(s)<2?(f(),R("span",{key:0},[t(v,{onClick:e[3]||(e[3]=V=>u.value=!1)},{default:p(()=>[E("取消")]),_:1}),t(v,{type:"primary",onClick:k,disabled:a(T),loading:a(r)},{default:p(()=>[E(J(a(w)),1)]),_:1},8,["disabled","loading"])])):S("",!0)])]),default:p(()=>[t(i,{active:a(s),simple:"","process-status":"finish",class:"steps"},{default:p(()=>[t(c,{title:"1、上传本地文件"}),t(c,{title:"2、升级范围"}),t(c,{title:"3、开始升级"})]),_:1},8,["active"]),a(s)===0?(f(),R("div",{key:0},[U("p",null,"1、导入本地应用文件"),U("p",null,"2、应用要求文件如下："),U("ul",null,[U("li",{class:"list_item"},"应用包文件格式为zip")]),U("div",{class:"upload_wrapper"},[t(re,{type:"file",accept:["zip"],showSizeTip:!1,isShowTip:!1,size:99999999999,reupload:"",modelValue:a(_),"onUpdate:modelValue":e[0]||(e[0]=V=>A(_)?_.value=V:null)},null,8,["modelValue"])])])):S("",!0),a(s)==1?(f(),R("div",{key:1},[t(Y,{"label-width":"100px","label-suffix":"：",model:a(l),ref_key:"rangeFormRef",ref:g},{default:p(()=>[t(N,{label:"升级范围"},{default:p(()=>[t(F,{modelValue:a(l).range,"onUpdate:modelValue":e[1]||(e[1]=V=>a(l).range=V),onChange:d},{default:p(()=>[(f(!0),R(j,null,ee(a(ae)(a(ie)),V=>(f(),I(m,{key:V.value,label:V.value},{default:p(()=>[E(J(V.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(l).range===a(Q).range?(f(),I(N,{key:0,label:"选择范围",prop:"entryIds",rules:[{required:!0,message:"请选择升级范围",trigger:"change"}]},{default:p(()=>[t(P,{data:a(b),props:C,"default-expand-all":"","show-checkbox":"",class:"entry-tree",onCheckChange:B},null,8,["data"])]),_:1})):S("",!0)]),_:1},8,["model"])])):S("",!0)]),_:1},8,["modelValue"])}}});const Oe=be(Ye,[["__scopeId","data-v-130bba09"]]),Ge=M({__name:"Backups",props:{modelValue:{type:Boolean},appId:{},appName:{}},emits:["update:modelValue"],setup($,{emit:h}){const x=$,u=X(x,"modelValue",h),s=o(!1),_={appId:x.appId,fileName:g(),backupsType:Z.app},r=o({..._}),k=D({get(){return r.value.backupsType?r.value.backupsType.split(","):[]},set(l){r.value.backupsType=l==null?void 0:l.join(",")}}),w=o(),T=async()=>{var l;await((l=w.value)==null?void 0:l.validate());try{s.value=!0,await Ne(r.value),G.success("备份成功"),u.value=!1}finally{s.value=!1}};function g(){return`${x.appName}_${ye(new Date).format("YYYYMMDD")}_${new Date().valueOf()}`}return(l,b)=>{const C=ve,d=te,B=se,n=ke,e=le,c=L,i=ne;return f(),I(i,{title:"备份","append-to-body":"",width:"600px",modelValue:a(u),"onUpdate:modelValue":b[3]||(b[3]=m=>A(u)?u.value=m:null)},{footer:p(()=>[t(c,{onClick:b[2]||(b[2]=m=>u.value=!1)},{default:p(()=>[E("取消")]),_:1}),t(c,{type:"primary",loading:a(s),onClick:T},{default:p(()=>[E(" 开始备份 ")]),_:1},8,["loading"])]),default:p(()=>[t(e,{model:a(r),"label-width":"120px",ref_key:"backupsFormRef",ref:w},{default:p(()=>[t(d,{label:"备份文件名称",prop:"fileName",rules:[{required:!0,message:"备份文件名称不能为空",trigger:"blur"}]},{default:p(()=>[t(C,{placeholder:"请输入备份文件名称",modelValue:a(r).fileName,"onUpdate:modelValue":b[0]||(b[0]=m=>a(r).fileName=m)},null,8,["modelValue"])]),_:1}),t(d,{label:"备份项",prop:"backupsType",rules:[{required:!0,message:"备份项不能为空",trigger:"change"}]},{default:p(()=>[t(n,{modelValue:a(k),"onUpdate:modelValue":b[1]||(b[1]=m=>A(k)?k.value=m:null)},{default:p(()=>[(f(!0),R(j,null,ee(a(ae)(a(ge)),m=>(f(),I(B,{key:m.value,label:m.value,disabled:m.value==a(Z).data},{default:p(()=>[E(J(m.label),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),je=M({__name:"MyManage",setup($){const h=o(),x=D(()=>({query:{list:[{type:"input",label:"应用名称",prop:"name"},{type:"select",label:"状态",prop:"status",options:W,extraOptions:[{label:"全部",value:""}]}]},request:{api:De},table:{tableCols:[{label:"应用名称",prop:"name"},{label:"应用描述",prop:"description"},{label:"状态",prop:"status",slots:{default({row:e}){return e.upgradeStatus==1?t(H,{type:"warning"},{default:()=>[E("升级中")]}):t(H,{type:e.status==0?"primary":"info"},{default:()=>[e.status==0?"启用":"停用"]})}}},{fixed:"right",width:200,label:"操作",slots:{default({row:e}){const c={id:"manager",text:"管理",type:"primary",premission:"workbench:app:setting",onClick:()=>{Be(Ee,{query:{appId:e.id,manager:"1"}})}},i={id:"edit",text:"编辑",type:"primary",premission:"workbench:app:setting",onClick:()=>{y.value=!0,u.value="edit",s.value=e.id}},m={id:"auth",text:"授权",type:"primary",premission:"workbench:app:setting",onClick:()=>{b(e)}},F={id:"view",text:"查看",type:"primary",premission:"workbench:app:setting",onClick:()=>{T(e)}},N={id:"status",type:e.status?"primary":"danger",text:e.status?"启用":"停用",premission:"workbench:app:setting",onClick:async()=>{if(e.upgradeStatus==1){G.error("应用升级中,无法启用");return}await Ae({status:e.status==1?0:1,id:e.id}),G.success(e.status==1?"已启用":"已停用"),B()}},P={id:"export",text:"导出",type:"primary",premission:"workbench:app:setting",onClick:()=>{w(e)}},Y={id:"del",type:"danger",text:"删除",premission:"workbench:app:setting",popconfirmProps:{width:300,title:"应用删除后，应用下的表单及业务数据将同步删除，且不可恢复。确认要删除？",confirm:()=>{g(e)}}},O={id:"backups",type:"primary",text:"备份",premission:"workbench:app:setting",onClick:()=>{s.value=e.id,_.value=e.name,d.value=!0}};let v=[];return e.btnAuthVos?(z(e.btnAuthVos,q.manage)&&v.push(c),z(e.btnAuthVos,q.edit)&&v.push(i),z(e.btnAuthVos,q.appAuth)&&v.push(m),v.push(F),z(e.btnAuthVos,q.status)&&v.push(N),z(e.btnAuthVos,q.export)&&v.push(P),z(e.btnAuthVos,q.delete)&&v.push(Y),v.push(O)):v=[c,i,m,F,N,P,Y,O],t(Ce,{key:e.id,num:3,list:v},null)}}}]}})),y=o(!1),u=o("add"),s=o(""),_=o(""),r=o(!1),k=o(!1),w=n=>{k.value=!0,s.value=n.id},T=async n=>{y.value=!0,u.value="view",s.value=n.id,r.value=n.applicationType===Me.cooperation},g=async n=>{await Fe(n.id),G.success("删除成功"),B()},l=o(),b=async n=>{var e;(e=l.value)==null||e.handleSetAppAuth(n.id)},C=o(!1),d=o(!1);function B(){var n;(n=h.value)==null||n.refresh()}return Ve(xe,n=>{n.isUpgrade&&he(B,300)()}),(n,e)=>{const c=K("az-page");return f(),R(j,null,[t(c,{config:a(x),ref_key:"azPageRef",ref:h},null,8,["config"]),t(pe,{"drawer-model":a(y),"onUpdate:drawerModel":e[0]||(e[0]=i=>A(y)?y.value=i:null),comState:a(u),"app-id":a(s),isCooperateApp:a(r),onRefresh:e[1]||(e[1]=i=>B())},null,8,["drawer-model","comState","app-id","isCooperateApp"]),t(Se,{ref_key:"setAppAuthRef",ref:l},null,512),t(Re,{visible:a(k),"onUpdate:visible":e[2]||(e[2]=i=>A(k)?k.value=i:null),"app-id":a(s)},null,8,["visible","app-id"]),a(C)?(f(),I(Oe,{key:0,modelValue:a(C),"onUpdate:modelValue":e[3]||(e[3]=i=>A(C)?C.value=i:null),"app-id":a(s),onRefresh:B},null,8,["modelValue","app-id"])):S("",!0),a(d)?(f(),I(Ge,{key:1,modelValue:a(d),"onUpdate:modelValue":e[4]||(e[4]=i=>A(d)?d.value=i:null),"app-id":a(s),"app-name":a(_)},null,8,["modelValue","app-id","app-name"])):S("",!0)],64)}}}),oa=M({__name:"routePage",setup($){const h=["1","2"];return(x,y)=>{const u=Ie;return f(),I(we,{tabs:h,"query-key":"appManage"},{default:p(()=>[t(u,{label:"我管理的",name:"1",lazy:""},{default:p(()=>[t(je)]),_:1}),t(u,{label:"我创建的",name:"2",lazy:""},{default:p(()=>[t(Pe)]),_:1})]),_:1})}}});export{oa as default};

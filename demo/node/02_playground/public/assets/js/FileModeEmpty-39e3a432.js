import{d as I,r as C,c as u,y as L,o as p,f as v,h as M,i as y,I as b,d0 as B,F as w,jG as T,n as U,a as m,m_ as z,mY as $,dW as V,wT as A,w as g,b2 as N,b as R,B as h,mD as S,m as W,l as k,h7 as D,mZ as G,yG as j,U as P,_ as Y}from"./index-b80d5ef5.js";import{e as Z}from"./index-c89dfa90.js";const q=I({__name:"CustomUpload",emits:["fileUpload"],setup(E,{emit:a}){const e=a,t=C(),c=C(),r=u(()=>{var o,d;return(d=(o=c.value)==null?void 0:o.fileList)==null?void 0:d.some(_=>_.status&&_.status!=="success")});L([t,r],()=>{r.value||setTimeout(()=>{t.value&&e("fileUpload",t.value),t.value=void 0},100)});const F=()=>{var i;r.value||(i=c.value)==null||i.uploadFile()};return(i,o)=>(p(),v(w,null,[M(i.$slots,"default",{loading:r.value,startUpload:F}),y(B,b({modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=d=>t.value=d)},i.$attrs,{type:"file",ref_key:"azUploadWrapperRef",ref:c,isCustom:""}),null,16,["modelValue"])],64))}}),H=I({__name:"FileModeEmpty",setup(E){const a=T(),e=u(()=>{var l;return a.matchField(((l=a.fileMode)==null?void 0:l.fieldId)??"")}),t=u(()=>U(a.getFieldVal(e.value.fieldId,void 0,{isFormat:!0}))),c=u(()=>{var s;return((s=e.value)==null?void 0:s.field.type)===m.templateFile?Z(e.value.field):z(e.value.field.options)}),r=u(()=>{var l;return((l=e.value)==null?void 0:l.field.type)===m.templateFile?1:$(e.value.field.options)-t.value.length}),F=l=>{a.setFieldVal(e.value.fieldId,[...t.value,...U(l)])},i=u(()=>{var l,s,n;return((l=e.value)==null?void 0:l.field.type)===m.templateFile?a.getFieldAuth((s=e.value)==null?void 0:s.field.fieldId,"add_template"):a.getFieldAuth((n=e.value)==null?void 0:n.field.fieldId,"edit")}),o=u(()=>{var l,s,n;if(![V.view,V.pureView].includes(a.mode)&&((l=e.value)==null?void 0:l.field.type)===m.uploadFile)return(n=(s=e.value)==null?void 0:s.field.fields.find(f=>!!(f.type===m.fileEdit&&f.options.mode===A.create&&a.getFieldShow(f.fieldId))))==null?void 0:n.options.btnConfig}),d=C(!1),_=async()=>{d.value=!0;try{const l=await j();a.setFieldVal(e.value.fieldId,[...t.value,l])}finally{d.value=!1}};return(l,s)=>{const n=P;return e.value?(p(),v("div",{key:0,class:"file_mode-empty"},[y(q,{limit:r.value,size:h(G)(e.value.field.options),accept:c.value,type:"file",onFileUpload:F},{default:g(({loading:f,startUpload:x})=>[y(N,{description:i.value?"":"暂无文件"},{default:g(()=>[i.value||o.value?(p(),v(w,{key:0},[i.value?(p(),R(n,{key:0,text:"",type:"primary",loading:f,onClick:x,icon:h(S)},{default:g(()=>[W(" 上传文件 ")]),_:2},1032,["loading","onClick","icon"])):k("",!0),o.value?(p(),v("div",{key:1,style:{"margin-top":"10px"}},[y(D,{preview:"",loading:d.value,modelValue:o.value,onClick:_},null,8,["loading","modelValue"])])):k("",!0)],64)):(p(),v("span",{key:1,class:"empty-tip"},"暂无文件"))]),_:2},1032,["description"])]),_:1},8,["limit","size","accept"])])):k("",!0)}}});const O=Y(H,[["__scopeId","data-v-cf861e46"]]);export{O as default};

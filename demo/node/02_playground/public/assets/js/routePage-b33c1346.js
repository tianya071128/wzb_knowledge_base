import{d as X,r as P,o as t,f as s,t as d,B as _,bp as re,F as f,g as O,fu as R,i as D,b as S,k as l,ew as oe,ex as de,aV as ue,fE as pe,bJ as ie,x as me,c as L,dj as ce,bH as fe,a as V,bx as ye,l as T,w as I,fH as ve,fI as ge,bA as ke,bB as Ie,a8 as De,eo as U,en as _e,fJ as we,fK as be,fL as Se,fM as he,m as Fe,p as Oe,dC as Te,dD as Ne,_ as Le}from"./index-b80d5ef5.js";import{p as le,v as Ve,a as Pe,n as Ce}from"./index-617ab4b4.js";import{g as Ee}from"./groupBy-e9191618.js";import"./_createAggregator-d66ed64c.js";const z=X({__name:"ParseDictValue",props:{dictKey:{},showAll:{type:Boolean,default:!0},selectValue:{}},setup(G){const y=G,e=P("-");return(async()=>{var g;const v=await re(y.dictKey);if(y.showAll)e.value=v.map(u=>u.label).join(",");else{const u=(g=y.selectValue)==null?void 0:g.split(",");e.value=(u==null?void 0:u.map(h=>{var F;return((F=v.find(C=>C.value===h))==null?void 0:F.label)??""}).join(","))??""}})(),(v,g)=>(t(),s("div",null,d(_(e)),1))}}),W=X({__name:"ParseValue",props:{item:{},itemData:{},temSetting:{}},setup(G){const y=(e,N)=>{var g;return(g=JSON.parse(N).map(u=>{var h;return(h=e.find(F=>F.value===u))==null?void 0:h.label}))==null?void 0:g.join(",")};return(e,N)=>{var v,g,u,h,F,C,m,w,j,E,q,J,K,Y,$,M,B,H;return e.item.type==="uploadFile"&&((v=e.itemData)!=null&&v[e.item.fieldId])?(t(),s("div",{key:0},[(t(!0),s(f,null,O(JSON.parse((g=e.itemData)==null?void 0:g[e.item.fieldId]),(b,a)=>(t(),s("p",{key:a},d(b.name),1))),128))])):e.item.type==="uploadImg"?(t(),s("div",{key:1},[(t(!0),s(f,null,O(JSON.parse((u=e.itemData)==null?void 0:u[e.item.fieldId]),(b,a)=>(t(),s("img",{style:{width:"90px"},key:a,src:b.url,alt:"uploadImg"},null,8,["src"]))),128))])):e.item.type==="radio"?(t(),s("div",{key:2},[((F=(h=e.temSetting)==null?void 0:h.settings)==null?void 0:F.printSetting.single_or_multiple_fields)===_(le)?(t(),s("div",{key:0},[e.item.options.dataOptions.type===_(R).dict?(t(),s("span",{key:0},[D(z,{"dict-key":e.item.options.dataOptions.dict.dictKey},null,8,["dict-key"])])):(t(),s("span",{key:1},d(e.item.options.dataOptions.custom.options.map(b=>b.label).join(",")),1))])):(t(),s("span",{key:1},[e.item.options.dataOptions.type===_(R).dict?(t(),S(z,{key:0,"dict-key":e.item.options.dataOptions.dict.dictKey,"show-all":!1,"select-value":(C=e.itemData)==null?void 0:C[e.item.fieldId]},null,8,["dict-key","select-value"])):(t(),s("span",{key:1},d((m=e.item.options.dataOptions.custom.options.find(b=>{var a;return b.value===((a=e.itemData)==null?void 0:a[e.item.fieldId])}))==null?void 0:m.label),1))]))])):e.item.type==="multiple"?(t(),s("div",{key:3},[((j=(w=e.temSetting)==null?void 0:w.settings)==null?void 0:j.printSetting.single_or_multiple_fields)===_(le)?(t(),s("div",{key:0},[e.item.options.dataOptions.type===_(R).dict?(t(),s("span",{key:0},[D(z,{"dict-key":e.item.options.dataOptions.dict.dictKey},null,8,["dict-key"])])):(t(),s("span",{key:1},d(e.item.options.dataOptions.custom.options.map(b=>b.label).join(",")),1))])):(t(),s("span",{key:1},[e.item.options.dataOptions.type===_(R).dict?(t(),S(z,{key:0,"dict-key":e.item.options.dataOptions.dict.dictKey,"show-all":!1,"select-value":JSON.parse((E=e.itemData)==null?void 0:E[e.item.fieldId]).join(",")},null,8,["dict-key","select-value"])):(t(),s("span",{key:1},d(y(e.item.options.dataOptions.custom.options,(q=e.itemData)==null?void 0:q[e.item.fieldId])),1))]))])):e.item.type==="switch"?(t(),s("div",{key:4},[l("span",null,d(((J=e.itemData)==null?void 0:J[e.item.fieldId])==="1"?"开":"关"),1)])):e.item.type==="richText"?(t(),s("div",{key:5,innerHTML:(K=e.itemData)==null?void 0:K[e.item.fieldId],style:{"word-break":"break-word"}},null,8,["innerHTML"])):e.item.type==="slider"?(t(),s("div",{key:6},[(($=(Y=e.temSetting)==null?void 0:Y.settings)==null?void 0:$.printSetting.slider_fields)===_(Ve)?(t(),s("div",{key:0},d((M=e.itemData)==null?void 0:M[e.item.fieldId]),1)):(t(),s("span",{key:1},d((B=e.itemData)==null?void 0:B[e.item.fieldId])+" 最小值："+d(e.item.options.min)+" 最大值： "+d(e.item.options.max),1))])):e.item.type==="text"?(t(),s("div",{key:7},[l("span",{innerHTML:e.item.options.content||"-"},null,8,["innerHTML"])])):(t(),S(de,{key:8,mode:_(oe).list,content:(H=e.itemData)==null?void 0:H[e.item.fieldId],field:e.item},null,8,["mode","content","field"]))}}}),Ke=X({__name:"routePage",setup(G){const y=ue(),{post:e}=pe("system_print_page_channel"),N=P(),v=P(),g=P(),u=P();ie("formData",u),ie("formFields",v);const h=me(),F=async()=>{var i,n;e("loading");const a=await h.getFields(y.query.entryId??"");N.value=De(a,{excludeFilter(r,p){return!(p!=null&&p.isFormItem)&&![V.text,V.divider].includes(r.type)||r.source===U.system&&r.fieldId===_e.id.name||r.type===V.plugin}}),v.value=(i=N.value)==null?void 0:i.filter(r=>r.source!==U.system),g.value=(n=N.value)==null?void 0:n.filter(r=>r.source===U.system)},C=async()=>{u.value=await we({dataId:y.query.dataId??"",entryId:y.query.entryId??""})},m=P(),w=P(),j=async()=>{if(m.value=await be(y.query.temId),K.value){const a=await Se(y.query.dataId);a.length>0&&(w.value=await he({processInstanceId:a==null?void 0:a[0]}))}},E=L(()=>function(a){var i,n;return(n=(i=m.value)==null?void 0:i.settings)==null?void 0:n.formFieldsCheckedKeys.includes(a)}),q=L(()=>function(a){var i,n;return(n=(i=m.value)==null?void 0:i.settings)==null?void 0:n.systemFieldsCheckedKeys.includes(a)}),J=L(()=>a=>{var n,r;const i=a.map(p=>p.fieldId);return(r=(n=m.value)==null?void 0:n.settings)==null?void 0:r.formFieldsCheckedKeys.filter(p=>i.includes(p)).length}),K=L(()=>{var a,i;return y.query.dataId&&((i=(a=m.value)==null?void 0:a.settings)==null?void 0:i.otherFieldsCheckedKeys.includes(Pe))}),Y=L(()=>{var i,n;return(i=w.value)!=null&&i.logs?Ee((n=w.value)==null?void 0:n.logs,r=>r.currentNode):{}}),$=L(()=>{var a,i;return(a=w.value)!=null&&a.runningNodes?(i=w.value)==null?void 0:i.runningNodes[0].tasks.map(n=>({id:n.assignee,type:ce.member})):[]}),M=a=>{var i,n;return((n=(i=m.value)==null?void 0:i.settings)==null?void 0:n.printSetting.null_fields)===Ce&&!a},B=L(()=>{const a=fe(v.value);function i(r){return r.filter(p=>{var A;return p.type===V.divider&&(p.fields=i(p.fields??[]),p.fields.length)?!!p.fields.length:p.type!==V.subform&&E.value(p.fieldId)&&!M((A=u.value)==null?void 0:A[p.fieldId])})}const n=i(a??[]);return H(n)});function H(a){let i=0;for(let n=0;n<a.length;n++)a[n].type===V.divider&&(a[n].fields=H(a[n].fields)),i+=a[n].options.span,i>24&&(a[n-1].options.span+=24-(i-a[n].options.span),i=a[n].options.span),i===24&&(i=0),n===a.length-1&&i>0&&(a[n].options.span+=24-i);return a}const b=async()=>{try{await F(),await C(),await j(),setTimeout(()=>{e("success")},1e3)}catch{e("error")}};return ye(()=>{b()}),(a,i)=>{var Z,x,ee,te,ae,se,ne;const n=ke,r=Ie,p=Te,A=Ne;return t(),s("div",{class:"pre_print"},[(x=(Z=m.value)==null?void 0:Z.settings)!=null&&x.printSetting.viewName?(t(),s("h1",{key:0},d((te=(ee=m.value)==null?void 0:ee.settings)==null?void 0:te.printSetting.formName),1)):T("",!0),D(r,{gutter:12,class:"system-wrap"},{default:I(()=>[(t(!0),s(f,null,O(g.value,o=>{var k;return t(),s(f,{key:o.fieldId},[q.value(o.fieldId)&&!M((k=u.value)==null?void 0:k[o.fieldId])?(t(),S(n,{key:0,span:12},{default:I(()=>{var c;return[l("div",{class:"align-center"},[Fe(d(o.options.label)+": ",1),D(de,{mode:_(oe).list,content:(c=u.value)==null?void 0:c[o.fieldId],field:o},null,8,["mode","content","field"])])]}),_:2},1024)):T("",!0)],64)}),128))]),_:1}),B.value.length?(t(),S(r,{key:1,class:"fields-wrapper"},{default:I(()=>[(t(!0),s(f,null,O(B.value,o=>(t(),s(f,{key:o.fieldId},[o.type===_(V).divider?(t(),s(f,{key:0},[D(n,{class:"field-item",span:24},{default:I(()=>[l("div",{class:"field-value split-line-wrapper"},[l("div",{class:"split-line"},d(o.options.label),1)])]),_:2},1024),(t(!0),s(f,null,O(o.fields,k=>(t(),S(n,{key:k.fieldId,span:k.options.span,class:"field-item"},{default:I(()=>[l("div",{class:"field-label"},d(k.options.label),1),l("div",{class:"field-value"},[D(W,{item:k,itemData:u.value,temSetting:m.value},null,8,["item","itemData","temSetting"])])]),_:2},1032,["span"]))),128))],64)):(t(),S(n,{key:1,span:o.options.span,class:"field-item"},{default:I(()=>[l("div",{class:"field-label"},d(o.options.label),1),l("div",{class:"field-value"},[D(W,{item:o,itemData:u.value,temSetting:m.value},null,8,["item","itemData","temSetting"])])]),_:2},1032,["span"]))],64))),128))]),_:1})):T("",!0),D(r,{gutter:12},{default:I(()=>[(t(!0),s(f,null,O(v.value,o=>(t(),s(f,{key:o.fieldId},[o.type==="subform"&&J.value(o.fields)?(t(),S(n,{key:0,span:o.options.span},{default:I(()=>{var k;return[l("div",null,[l("div",{class:"sub-title"},d(o.options.label)+":",1),D(A,{data:(k=u.value)==null?void 0:k[o.fieldId]},{default:I(()=>[(t(!0),s(f,null,O(o.fields,c=>(t(),s(f,{key:c.fieldId},[E.value(c.fieldId)?(t(),S(p,{key:0,prop:c.fieldId,label:c.options.label},{default:I(({row:Q})=>[D(W,{item:c,itemData:Q,temSetting:m.value},null,8,["item","itemData","temSetting"])]),_:2},1032,["prop","label"])):T("",!0)],64))),128))]),_:2},1032,["data"])])]}),_:2},1032,["span"])):T("",!0)],64))),128))]),_:1}),K.value&&((ae=w.value)!=null&&ae.logs)?(t(),S(r,{key:2,gutter:24},{default:I(()=>[D(n,{span:24},{default:I(()=>[l("div",null,[l("div",{class:"sub-title"},"流程日志"),l("ul",{class:"log_wrapper"},[(t(!0),s(f,null,O(Y.value,(o,k)=>(t(),s("li",{key:k},[(t(!0),s(f,null,O(o,(c,Q)=>(t(),s("div",{key:c.id,class:"log_item"},[l("b",{class:Oe({hide:Q!==0})},d(c.currentNodeName),3),l("span",null,d(c.operatorName),1),l("span",null,d(c.operationTime),1),l("span",null,d(c.actionText),1),l("span",{class:"gray",innerHTML:c.opinion},null,8,["innerHTML"])]))),128))]))),128)),w.value.runningNodes.length?(t(),s("li",{key:0},[l("div",{class:"log_item"},[l("b",null,d(w.value.runningNodes[0].name),1),l("span",null,[l("div",{style:{display:"flex","flex-wrap":"wrap"}},[l("span",null,"待"),D(ve,{approvers:$.value},null,8,["approvers"]),l("span",null,"审批")])])])])):T("",!0)])])]),_:1})]),_:1})):T("",!0),(ne=(se=m.value)==null?void 0:se.settings)!=null&&ne.printSetting.isPrintTime?(t(),s("span",{key:3,class:"print-time"}," 打印时间："+d(_(ge)(new Date,"YYYY-MM-DD HH:mm:ss")),1)):T("",!0)])}}});const qe=Le(Ke,[["__scopeId","data-v-586ac7d1"]]);export{qe as default};

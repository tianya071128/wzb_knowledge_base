import{d as J,gc as N,v as Y,r as p,c as G,y as F,d5 as H,o as d,f as _,i as c,B as I,J as K,w as y,k as v,e as $,F as O,g as U,p as D,t as E,S as R,l as z,b as j,bz as X,L as Z,gb as ee,Q as M,P as ae,c3 as se,_ as le,R as te,x as ne,$ as oe,mt as ie,h as re,m as B,I as ue,fx as de,a2 as ce,Y as x,U as pe,bn as me}from"./index-b80d5ef5.js";import{B as ve}from"./ButtonState-cb54910b.js";import{_ as fe}from"./ParamsSet.vue_vue_type_script_setup_true_lang-37c252c5.js";const ge=J({__name:"SelectPluginPane",props:{modelValue:{},scenario:{default:N.All}},emits:["update:modelValue"],setup(k,{expose:b,emit:L}){const m=k,r=Y(m,"modelValue",L),P=p(),u=p([]),f=p(""),n=p(),g=p(""),S=G(()=>{var e;return((e=n.value)==null?void 0:e.reduce((a,t)=>[...a,...t.apiList],[]))??[]}),C=async()=>{const e=await ee({search:g.value,appScenarios:m.scenario===N.All?void 0:m.scenario});n.value=(e??[]).filter(a=>{var t;return!!((t=a.apiList)!=null&&t.length)})},h=e=>{f.value=e.id,u.value=e.apiList},s=e=>{r.value=e.id??""};F(()=>g.value,H(()=>{var e,a;(a=(e=P.value)==null?void 0:e.reload)==null||a.call(e)},300));const l=()=>{if(n.value){let e=n.value.find(a=>a.apiList.some(t=>t.id===r.value));e||(e=n.value[0]),e?h(e):u.value=[]}};return F(()=>n.value,()=>{l()}),b({getPluginInfoById(e){if(e)return S.value.find(a=>a.id===e)}}),(e,a)=>{const t=M,o=ae,T=se;return d(),_("div",{class:"plugin_pane"},[c(t,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=V=>g.value=V),class:"az_input-radius mb-10","prefix-icon":I(K),clearable:"",placeholder:"可搜索 插件名称、API名称、描述、服务商、业务类型"},null,8,["modelValue","prefix-icon"]),c(Z,{class:"plugin_pane-loading",load:C,ref_key:"pluginLoadingDataRef",ref:P},{default:y(()=>{var V,q,A;return[v("div",{class:"plugin_pane-cascader"},[$(v("div",{class:"cascader-left"},[(d(!0),_(O,null,U(n.value,(i,w)=>(d(),_("div",{class:D(["cascader-left-item",{selected:f.value===i.id}]),key:w,title:i.name,onClick:W=>h(i)},[v("span",{class:"az-ellipsis"},E(i.name),1)],10,["title","onClick"]))),128))],512),[[R,(V=n.value)==null?void 0:V.length]]),$(v("div",{class:"az-flex-width"},[(d(!0),_(O,null,U(u.value,(i,w)=>(d(),_("div",{class:D(["api-item",{selected:I(r)===i.id}]),key:w,onClick:W=>s(i)},[v("div",{class:"api-content az-flex-width"},[v("div",{class:"name az-ellipsis"},E(i.name),1),i.remark?(d(),_("div",{key:0,class:"remark az-ellipsis"},E(i.remark),1)):z("",!0)]),I(r)===i.id?(d(),j(o,{key:0,class:"choose-icon"},{default:y(()=>[c(X,{"icon-class":"Select"})]),_:1})):z("",!0)],10,["onClick"]))),128))],512),[[R,(q=n.value)==null?void 0:q.length]]),(A=n.value)!=null&&A.length?z("",!0):(d(),j(T,{key:0,class:"w100",description:g.value?"搜索无插件":"暂无插件","image-size":60},null,8,["description"]))])]}),_:1},512)])}}});const Pe=le(ge,[["__scopeId","data-v-9468f479"]]),Se=J({inheritAttrs:!1,__name:"ParamsSetWrapper",props:{modelValue:{},disabled:{type:Boolean},pluginId:{},entryId:{},fields:{},sourceId:{},group:{},scenario:{}},emits:["update:modelValue"],setup(k,{expose:b,emit:L}){const m=k,r=te(m,"modelValue",L),P=p(),u=p(!1),f=p([]),n=()=>{m.disabled||!m.pluginId||(f.value=x(r.value??[]),u.value=!0)},g=async()=>{var s;await((s=P.value)==null?void 0:s.validate()),r.value=x(f.value.map(l=>{const e={...l};return l.child&&(l.child=l.child.filter(a=>a.value)),e}).filter(l=>l.value)),u.value=!1},S=p(!1),C=ne(),{addRule:h}=oe();return h({validator(s,l,e){const a={dataSystem:C,requestParams:r.value,...m},t=ie(a),o=t===!1?"插件配置异常":t===!0?"":t;S.value=!!o,o?e(new Error(o)):e()},trigger:"change"}),b({handleSet:n}),(s,l)=>{const e=M,a=pe,t=me;return d(),_("div",{class:D(s.$attrs.class),style:ce(s.$attrs.style)},[v("div",{onClick:n},[re(s.$slots,"default",{},()=>{var o;return[c(ve,{isSet:!!((o=I(r))!=null&&o.length),isError:S.value,disabled:!s.pluginId||s.disabled},{default:y(()=>[B(" 设置请求参数 ")]),_:1},8,["isSet","isError","disabled"])]})]),$(c(e,{"model-value":JSON.stringify(I(r)??"")},null,8,["model-value"]),[[R,!1]]),c(t,{modelValue:u.value,"onUpdate:modelValue":l[2]||(l[2]=o=>u.value=o),title:"请求参数设置",width:"600","destroy-on-close":"","close-on-click-modal":!1,"append-to-body":""},{footer:y(()=>[v("span",{class:"dialog-footer"},[c(a,{onClick:l[1]||(l[1]=o=>u.value=!1)},{default:y(()=>[B("取消")]),_:1}),c(a,{type:"primary",onClick:g},{default:y(()=>[B("确定")]),_:1})])]),default:y(()=>[c(fe,ue({ref_key:"requeseParamsSetRef",ref:P,modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=o=>f.value=o),pluginId:s.pluginId,entryId:s.entryId,fields:s.fields,sourceId:s.sourceId,group:s.group,scenario:s.scenario},I(de)(s.$attrs,["class","style"])),null,16,["modelValue","pluginId","entryId","fields","sourceId","group","scenario"])]),_:1},8,["modelValue"])],6)}}});export{Pe as S,Se as _};

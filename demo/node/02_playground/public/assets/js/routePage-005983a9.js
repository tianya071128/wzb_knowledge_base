import{a as ny}from"./LoadingData-195d0581.js";import{N as Ct,a as zt,b as to,F as Go,S as Mp,G as zl,c as Xn,C as ka,d as ft,e as an,D as ur}from"./flowEnum-7431041b.js";import{m as Dp,a as fn,r as ry,N as fr,b as Fn,c as Nr,g as Or,J as $l,D as sr,_ as oy,G as Be,B as tr,d as lr,M as _u,V as ea,e as ay,C as iy,o as Xl,f as Pt,w as sy,h as ly,R as Ar,i as uy,j as oo,k as xl,l as Va,n as tn,p as dy,q as Ba,s as Pi,t as cy,u as bu,v as Hl,x as yu,y as Pp,E as $n,z as fy,A as Qc,F as py,P as ki,H as hy,I as Rl,K as Zc,L as Mo,U as Jc,O as my,S as vy,Q as _y,T as by,W as yy,X as gy,Y as Ey,Z as Ty,$ as ef,a0 as Iy,a1 as $t,a2 as jo,a3 as Ft,a4 as Sy,a5 as xr,a6 as Ua,a7 as Wl,a8 as wy,a9 as Ay}from"./index-8aa8c97d.js";import{e5 as xy,e6 as tf,e7 as Ry,e8 as Cy,Z as Xi,e9 as ds,ea as Ny,cm as Hi,cA as Oy,du as kp,eb as Vp,bI as Wi,r as we,c as Ee,bx as Ln,aT as Fr,d as Ce,o as D,f as Ie,k as Te,h as Rr,B as x,b as ee,a2 as Wo,bz as yn,l as Xe,i as E,j as fo,t as mn,p as Yo,_ as Tt,Y as Fy,ec as nf,bH as Et,ed as Bp,d5 as Up,ee as Ly,bK as Mn,w as F,g as It,F as dt,di as ta,bc as io,U as Lt,aU as na,ef as My,eg as Dy,a5 as gu,ba as Eu,a4 as Lr,Q as Cn,ac as Xt,eh as Py,ei as Gp,ej as ky,ek as Yl,R as Vy,el as By,C as wt,N as Uy,O as Gy,bm as ra,em as jy,en as zy,eo as rf,a as Ge,ep as $y,eq as Na,er as Xy,es as Hy,et as Wy,aO as of,n as In,bJ as Tu,c2 as Iu,eu as so,aS as qa,ev as af,dQ as oa,dC as dr,ao as Wn,ap as pr,dD as Mr,m as St,ew as Yy,ex as Ky,ey as qy,L as cs,I as Su,c3 as Qy,v as Dr,ae as wu,z as Au,e0 as Zy,bA as Pr,bB as kr,dA as Jy,ez as jp,dF as Vi,eA as xu,E as Ru,ab as fs,bu as ps,ay as eg,ax as tg,bn as aa,a3 as Yi,cH as zp,eB as ng,aN as Ko,eC as rg,c5 as og,q as Cu,aa as $p,y as ao,bt as Ki,H as ag,eD as ig,eE as sg,eF as lg,eG as Xp,bM as ug,eH as sf,eI as dg,P as Nu,eJ as cg,eK as Hp,b$ as Ou,b2 as fg,a6 as pg,eL as hg,eM as mg,cj as vg,a_ as _g,e as lf,S as uf,aR as bg,aq as yg,b4 as df,b5 as gg,b6 as Eg}from"./index-b80d5ef5.js";import{s as Tg}from"./sortBy-f189de5d.js";import{E as Wp}from"./el-space-0d01b33a.js";import"./isTypedArray-10beecc7.js";import{_ as Re}from"./defineProperty-d37e2d2c.js";import{R as Ig}from"./Resize-eb80395d.js";import Sg from"./topMove-d6ba851b.js";import{b as wg}from"./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js";import{l as Ag}from"./last-862de5a8.js";import{_ as hr}from"./ButtonSelectField.vue_vue_type_script_setup_true_lang-aae15f71.js";import{m as xg,s as Rg,n as Cg,o as Ng,p as Og,q as Fg,r as Lg,t as cf,v as Mg,w as Dg,x as Pg}from"./dataFactory-e27a5721.js";import{C as kg}from"./ConditionWrapper-43da1676.js";import{F as Vg}from"./FieldConditionView-ad1b057c.js";import{F as Bg}from"./FormulaWrapper-92a83208.js";import{E as Ug}from"./el-input-number-c15b1cc7.js";import{E as Gg,a as jg,b as zg}from"./el-dropdown-item-455a6589.js";/* empty css                        */import{s as $g}from"./dataConnection-4b645f76.js";import{u as Oa}from"./useExtractQuery-f96f705c.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";import"./_baseSlice-cf92e063.js";import"./groupBy-e9191618.js";import"./_createAggregator-d66ed64c.js";import"./typeof-7fd5df1e.js";import"./FieldCondition-1c72aa9d.js";import"./SelectEntryAndOther-76a65b2d.js";import"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import"./useFieldMaxWidth-d82f063e.js";import"./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js";import"./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js";import"./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js";import"./index-318b68f4.js";import"./AzInputNumber-d6212644.js";import"./useMultipleVal-904406c1.js";import"./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js";import"./CardShowFieldItem-fd24f218.js";import"./ButtonState-cb54910b.js";import"./Formula.vue_vue_type_style_index_0_lang-ef444f24.js";import"./index-8e050109.js";var Xg=xy(function(e){var t=Ag(e);return tf(t)&&(t=void 0),wg(Cy(e,1,tf,!0),Ry(t))});const Hg=Xg,Wg={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};function Kl(e,t,n){if(t){if(typeof t=="string"){if(t=Wg[t]||t,arguments.length<3)return e[t];e[t]=n;return}for(const r in t)Kl(e,r,t[r])}}const za=e=>`_${e}_${Xi()}`,ql=e=>e.isSystem?e.name:za(e.fieldType);function Yg(e,t){const n=[];let r=e.indexOf(t);for(;r>-1;)n.push(r),r=e.indexOf(t,r+1);if(n.length<2)return[e];const o=n[1];return[e.substring(0,o),e.substring(o+1)]}const mr={cellsName:{required:!0,message:"请输入节点名称"}},ff={...mr,classifyColumn:{type:"array",required:!0,validator:(e,t,n)=>{const r=t;r&&r.length<1?n(new Error("至少要有一组分类字段")):n()},message:"至少要有一组分类字段"},summaryColumn:{type:"array",required:!0,validator:(e,t,n)=>{const r=t;r&&r.length<1?n(new Error("至少要有一组汇总字段")):n()},message:"至少要有一组汇总字段"}},Kg=Object.freeze(Object.defineProperty({__proto__:null,default:ff,formRules:ff},Symbol.toStringTag,{value:"Module"})),pf={...mr,attrColumnName:{type:"object",required:!0,validator:(e,t,n)=>{const r=t;r&&!r.comment?n(new Error("请填写属性字段名称")):n()}},getValueName:{type:"object",required:!0,validator:(e,t,n)=>{const r=t;r&&!r.comment?n(new Error("请填写取值字段名称")):n()}},waitToRow:{type:"array",required:!0,validator:(e,t,n)=>{const r=t;r.length>=1?r.filter(a=>!(a!=null&&a.rowValue)).length>=1?n(new Error("请填写新建行值")):n():n(new Error("请添加待列转行的字段"))}}},qg=Object.freeze(Object.defineProperty({__proto__:null,default:pf,formRules:pf},Symbol.toStringTag,{value:"Module"})),hf={...mr,filterJson:{type:"array",required:!0,validator:(e,t,n,r)=>{r.filterJson.length>=1?n():n(new Error("请设置节点"))}}},Qg=Object.freeze(Object.defineProperty({__proto__:null,default:hf,formRules:hf},Symbol.toStringTag,{value:"Module"})),mf={...mr,mergeFields:{type:"array",required:!0,validator:(e,t,n,r)=>{const o=r;if(o.input.length>=1){const a=t;if(a.length>=1){const i=a.reduce((s,l)=>{const u=Object.keys(l.mergeFieldId);return[...new Set([...s,...u])]},[]);o.input.length===i.length?n():n(new Error("每张表请至少添加一个字段"))}else n(new Error("至少要有一组分类字段"))}else n(new Error("请设置节点"))}}},Zg=Object.freeze(Object.defineProperty({__proto__:null,default:mf,formRules:mf},Symbol.toStringTag,{value:"Module"})),vf={...mr,fieldSetting:{type:"array",required:!0,validator:(e,t,n)=>{const r=t;r&&r.length<1?n(new Error("请至少添加一个字段")):n()},message:"请至少添加一个字段"}},Jg=Object.freeze(Object.defineProperty({__proto__:null,default:vf,formRules:vf},Symbol.toStringTag,{value:"Module"})),_f={...mr,joinCondition:{type:"array",required:!0,validator:(e,t,n)=>{const r=t;r?r.length<1?n(new Error("至少要有一组连接字段")):!r[0].left||!r[0].right?n(new Error("请选择字段")):n():n()},message:"至少要有一组连接字段"}},e0=Object.freeze(Object.defineProperty({__proto__:null,default:_f,formRules:_f},Symbol.toStringTag,{value:"Module"})),bf={...mr,classFields:{type:"array",required:!0,validator:(e,t,n)=>{const r=t;r&&r.length<1?n(new Error("至少要有一组分类字段")):n()},message:"至少要有一组分类字段"},waitField:{type:"string",required:!0,message:"请选择待行转列的字段"},toColumnFields:{type:"array",required:!0,validator:(e,t,n)=>{const r=t;r&&r.length<1?n(new Error("至少选择一个转换成列的字段值")):n()},message:"至少选择一个转换成列的字段值"},getValueField:{type:"object",required:!0,validator:(e,t,n)=>{const r=t;r?r.summary?n():n(new Error("请选择汇总方式")):n(new Error("请选择取值字段"))}}},t0=Object.freeze(Object.defineProperty({__proto__:null,default:bf,formRules:bf},Symbol.toStringTag,{value:"Module"})),yf={...mr,fieldsOptions:{type:"array",required:!0,message:"请选择数据源并设置字段",validator:(e,t,n,r)=>{t.length>=1?n():n("请选择数据源并设置字段")}}},n0=Object.freeze(Object.defineProperty({__proto__:null,default:yf,formRules:yf},Symbol.toStringTag,{value:"Module"})),gf={...mr,mappingConfig:{type:"array",required:!0,message:"请设置字段映射规则",validator:(e,t,n,r)=>{t.length>=1?n():n("请设置字段映射规则")}}},r0=Object.freeze(Object.defineProperty({__proto__:null,default:gf,formRules:gf},Symbol.toStringTag,{value:"Module"})),Yp={},o0=Object.assign({"../../nodes/dataProcessing/classSummary/rule.ts":Kg,"../../nodes/dataProcessing/columnToRow/rule.ts":qg,"../../nodes/dataProcessing/dataFilter/rule.ts":Qg,"../../nodes/dataProcessing/dataMerge/rule.ts":Zg,"../../nodes/dataProcessing/fieldSetting/rule.ts":Jg,"../../nodes/dataProcessing/multiTableJoin/rule.ts":e0,"../../nodes/dataProcessing/rowToColumn/rule.ts":t0,"../../nodes/outInput/dataInput/rule.ts":n0,"../../nodes/outInput/dataOutput/rule.ts":r0});Object.entries(o0).forEach(([e,t])=>{const n=e.split(ds.sep),r=n.pop(),o=n.pop();let a=t;a=a.default||a,(r==null?void 0:r.toLocaleLowerCase())==="rule.ts".toLocaleLowerCase()&&(Yp[o]=a)});function Fu(e){return e?Yp[e]??null:null}const Kp=Symbol("on:add"),qp=Symbol("on:remove"),hs=Ny("flow.designer.errors",()=>{const e=Hi(new Map),t=Oy(),n=(d,c)=>{e.value.set(d,c),u(Kp,d)},r=d=>e.value.has(d),o=d=>{r(d)&&(e.value.delete(d),u(qp,d))},a=d=>{if(r(d))return e.value.get(d)},i=({data:d,shape:c,id:f})=>new Promise((m,v)=>{const b=Fu(c);b?new Vp(b).validate(d,L=>{m(L?{type:"error",id:f,message:L[0].message??"节点设置异常"}:{type:"success",id:f,message:"验证成功"})}):(console.error(`当前节点${c}没有验证器`),v(!1))}),s=({graph:d})=>new Promise((f,h)=>{const v=d.getNodes().map(b=>new Promise((w,L)=>{var he;const z=d.getConnectedEdges(b,{incoming:!0}),K=Dp(b.shape);if(K){const Fe=(he=K.verifyLinkNode)==null?void 0:he.call(K,z.length),Oe=d.getConnectedEdges(b,{outgoing:!0}),at=b.shape===Ct.dataOutput?!0:Oe.length>=1;Fe&&at?i({data:b.data,id:b.id,shape:b.shape}).then(ze=>{w(ze)}):w({type:"error",id:b.id,message:"当前节点处于孤立状态"})}else L(`检测异常,${b.shape}没有验证规则`)}));Promise.all(v).then(b=>{b.forEach(w=>{w.type==="success"?o(w.id):n(w.id,{id:w.id,message:w.message})}),b.some(w=>w.type==="error")?h(!1):f(!0)}).catch(b=>{console.error(b)})});function l(d,c){t.on(d,c)}function u(d,c){t.emit(d,c)}return kp(()=>{var d,c;(c=(d=t==null?void 0:t.all)==null?void 0:d.clear)==null||c.call(d)}),{errorMap:e,addError:n,removeError:o,checkError:r,getErrorById:a,checkNodeData:i,checkAllNode:s,listeners:t,on:l,emit:u}}),a0=()=>{const e=Wi("getNode"),t=Wi("getGraph"),n=Hi(),r=we(),o=we(!1),a=we(""),i=we(!1),s=we("该节点配置有误，请检查配置属性"),l=Hi(),u=Ee(()=>{var v;return fn(((v=r.value)==null?void 0:v.shape)??Ct.dataInput,"icon")}),d=Ee(()=>{var b;const v=fn(((b=r.value)==null?void 0:b.shape)??Ct.dataInput,"iconColor");return v?{color:v}:{}}),c=()=>{var v,b,w;(v=n.value)==null||v.on("node:click",({node:L})=>{var z;o.value=L.id===((z=r.value)==null?void 0:z.id)}),(b=n.value)==null||b.on("blank:click",()=>{o.value=!1}),(w=n.value)==null||w.on("edge:click",()=>{o.value=!1})},f=()=>{var v;(v=r.value)==null||v.on("change:data",b=>{a.value=b.current.cellsName})},{on:h,getErrorById:m}=hs();return h(Kp,v=>{var b;if(v===((b=r.value)==null?void 0:b.id)){const w=m(v);w&&(s.value=w.message??"该节点配置有误，请检查配置属性",i.value=!0)}}),h(qp,v=>{var b;v===((b=r.value)==null?void 0:b.id)&&(i.value=!1)}),Ln(()=>{r.value=e(),a.value=r.value.data.cellsName,n.value=t(),Fr(()=>{c(),f()})}),{currentNode:r,cellsName:a,defaultIcon:u,defaultStyle:d,currentSelected:o,nodeValidator:l,isNodeError:i,errorMessage:s}},i0=Ce({__name:"NodeWrapper",setup(e){const{cellsName:t,defaultIcon:n,defaultStyle:r,currentSelected:o,isNodeError:a,errorMessage:i}=a0();return(s,l)=>(D(),Ie("div",{class:Yo(["node-wrap event-flow",{"is-active":x(o),"is-error":x(a)}])},[Te("div",{class:"node-title"},[Te("span",{style:{"font-size":"16px"}},[Rr(s.$slots,"icon",{},()=>[x(n)?(D(),ee(yn,{key:0,iconClass:x(n),style:Wo(x(r))},null,8,["iconClass","style"])):Xe("",!0)],!0)]),E(fo,{content:x(t),class:"ml-10"},null,8,["content"])]),x(a)?(D(),Ie("div",{key:0,class:"error-tips"},mn(x(i)),1)):Xe("",!0)],2))}});const vr=Tt(i0,[["__scopeId","data-v-573a1562"]]),s0=Ce({__name:"Node",setup(e){return(t,n)=>(D(),ee(vr))}}),l0=Object.freeze(Object.defineProperty({__proto__:null,default:s0},Symbol.toStringTag,{value:"Module"})),u0=Ce({__name:"Node",setup(e){return(t,n)=>(D(),ee(vr))}}),d0=Object.freeze(Object.defineProperty({__proto__:null,default:u0},Symbol.toStringTag,{value:"Module"})),c0=Ce({__name:"Node",setup(e){return(t,n)=>(D(),ee(vr))}}),f0=Object.freeze(Object.defineProperty({__proto__:null,default:c0},Symbol.toStringTag,{value:"Module"})),p0=Ce({__name:"Node",setup(e){return(t,n)=>(D(),ee(vr))}}),h0=Object.freeze(Object.defineProperty({__proto__:null,default:p0},Symbol.toStringTag,{value:"Module"})),m0=Ce({__name:"Node",setup(e){return(t,n)=>(D(),ee(vr))}}),v0=Object.freeze(Object.defineProperty({__proto__:null,default:m0},Symbol.toStringTag,{value:"Module"})),_0=Ce({__name:"Node",setup(e){return(t,n)=>(D(),ee(vr))}}),b0=Object.freeze(Object.defineProperty({__proto__:null,default:_0},Symbol.toStringTag,{value:"Module"})),y0=Ce({__name:"Node",setup(e){return(t,n)=>(D(),ee(vr))}}),g0=Object.freeze(Object.defineProperty({__proto__:null,default:y0},Symbol.toStringTag,{value:"Module"})),E0=Ce({__name:"Node",setup(e){return(t,n)=>(D(),ee(vr))}}),T0=Object.freeze(Object.defineProperty({__proto__:null,default:E0},Symbol.toStringTag,{value:"Module"})),I0=Ce({__name:"Node",setup(e){return(t,n)=>(D(),ee(vr))}}),S0=Object.freeze(Object.defineProperty({__proto__:null,default:I0},Symbol.toStringTag,{value:"Module"})),Ql={},w0=Object.assign({"../../nodes/dataProcessing/classSummary/Node.vue":l0,"../../nodes/dataProcessing/columnToRow/Node.vue":d0,"../../nodes/dataProcessing/dataFilter/Node.vue":f0,"../../nodes/dataProcessing/dataMerge/Node.vue":h0,"../../nodes/dataProcessing/fieldSetting/Node.vue":v0,"../../nodes/dataProcessing/multiTableJoin/Node.vue":b0,"../../nodes/dataProcessing/rowToColumn/Node.vue":g0,"../../nodes/outInput/dataInput/Node.vue":T0,"../../nodes/outInput/dataOutput/Node.vue":S0});Object.entries(w0).forEach(([e,t])=>{const n=e.split(ds.sep),r=n[n.length-2];let o=t;o=o.default||o,Ql[r]=o});const A0={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"transparent",strokeWidth:1,fill:"transparent"}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"transparent",strokeWidth:1,fill:"transparent"}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"transparent",strokeWidth:1,fill:"transparent"}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"transparent",strokeWidth:1,fill:"transparent"}}}}};function x0(){for(const e in Ql)ry({shape:e,width:fr,height:Fn,component:Ql[e],ports:A0,data:{}})}const R0={shape:Ct.classSummary,width:fr,height:Fn,zIndex:Nr,ports:{items:[{id:"port_2",group:"right"},{id:"port_4",group:"left"}]},data:{...Or({cellsName:"分类汇总"}),appId:"",entryId:"",classifyColumn:[],summaryColumn:[],timeout:100}},C0=Object.freeze(Object.defineProperty({__proto__:null,default:R0},Symbol.toStringTag,{value:"Module"})),N0={shape:Ct.dataFilter,width:fr,height:Fn,zIndex:Nr,ports:{items:[{id:"port_2",group:"right"},{id:"port_4",group:"left"}]},data:{...Or({cellsName:"数据过滤"}),filterJson:[]}},O0=Object.freeze(Object.defineProperty({__proto__:null,default:N0},Symbol.toStringTag,{value:"Module"})),F0={shape:Ct.dataMerge,width:fr,height:Fn,zIndex:Nr,ports:{items:[{id:"port_2",group:"right"},{id:"port_4",group:"left"}]},data:{...Or({cellsName:"数据合并"}),appId:"",entryId:"",input:[],mergeFields:[],mergeType:"append"}},L0=Object.freeze(Object.defineProperty({__proto__:null,default:F0},Symbol.toStringTag,{value:"Module"})),M0={shape:Ct.fieldSetting,width:fr,height:Fn,zIndex:Nr,ports:{items:[{id:"port_2",group:"right"},{id:"port_4",group:"left"}]},data:{...Or({cellsName:"字段设置"}),appId:"",entryId:"",desc:"",fieldSetting:[]}},D0=Object.freeze(Object.defineProperty({__proto__:null,default:M0},Symbol.toStringTag,{value:"Module"})),P0={shape:Ct.multiTableJoin,width:fr,height:Fn,zIndex:Nr,ports:{items:[{id:"port_2",group:"right"},{id:"port_4",group:"left"}]},data:{...Or({cellsName:"多表连接"}),joinCondition:[],joinSetting:"1",leftTable:"",rightTable:"",joinWay:$l.left,columnSetting:[]}},k0=Object.freeze(Object.defineProperty({__proto__:null,default:P0},Symbol.toStringTag,{value:"Module"})),V0={shape:Ct.rowToColumn,width:fr,height:Fn,zIndex:Nr,ports:{items:[{id:"port_2",group:"right"},{id:"port_4",group:"left"}]},data:{...Or({cellsName:"行转列"}),classFields:[],waitField:"",toColumnFields:[],getValueField:null}},B0=Object.freeze(Object.defineProperty({__proto__:null,default:V0},Symbol.toStringTag,{value:"Module"})),U0={shape:Ct.dataInput,width:fr,height:Fn,zIndex:Nr,ports:{items:[{id:"port_2",group:"right"}]},data:{...Or({cellsName:"输入"}),dataSources:zt.form,configParams:"",fieldsOptions:[],buId:"",buTableName:"",buTable:"",appId:"",entryId:""}},G0=Object.freeze(Object.defineProperty({__proto__:null,default:U0},Symbol.toStringTag,{value:"Module"})),j0={shape:Ct.dataOutput,width:fr,height:Fn,zIndex:Nr,ports:{items:[{id:"port_4",group:"left"}]},data:{...Or({cellsName:"输出"}),appId:"",entryId:"",configParams:"",dataProcessingRule:sr.cover,dataSources:zt.form,buId:"",buTableName:"",buTable:"",mappingConfig:[],outputFieldList:[],inputFieldList:[]}},z0=Object.freeze(Object.defineProperty({__proto__:null,default:j0},Symbol.toStringTag,{value:"Module"})),Lu={},$0=Object.assign({"../../nodes/dataProcessing/classSummary/data.ts":C0,"../../nodes/dataProcessing/columnToRow/data.ts":oy,"../../nodes/dataProcessing/dataFilter/data.ts":O0,"../../nodes/dataProcessing/dataMerge/data.ts":L0,"../../nodes/dataProcessing/fieldSetting/data.ts":D0,"../../nodes/dataProcessing/multiTableJoin/data.ts":k0,"../../nodes/dataProcessing/rowToColumn/data.ts":B0,"../../nodes/outInput/dataInput/data.ts":G0,"../../nodes/outInput/dataOutput/data.ts":z0});Object.entries($0).forEach(([e,t])=>{const n=e.split(ds.sep),r=n.pop(),o=n.pop();let a=t;a=a.default||a,(r==null?void 0:r.toLocaleLowerCase())==="data.ts".toLocaleLowerCase()&&(Lu[o]=a)});function Zl(e){const t=Lu[e]??null;return t||console.error(`你需要查找节点类型为${e}的节点对象, 但是并没有找到, 请检查一下是否存在该类型, 或者路径存在问题`),t?Fy(t):null}const X0=e=>{var r,o;const t=[{id:to.dataOperation,title:"数据操作",nodes:[]},{id:to.branch,title:"分支",nodes:[]},{id:to.calculate,title:"计算",nodes:[]},{id:to.notice,title:"通知",nodes:[]},{id:to.devlopmentComponents,title:"开发组件",nodes:[]},{id:to.outInput,title:"数据源",nodes:[]},{id:to.dataProcessing,title:"数据处理",nodes:[]}],n=Object.keys(Lu);n.sort((a,i)=>{const s=fn(a,"sort"),l=fn(i,"sort");return(s??0)-(l??0)});for(const a of n){const i=fn(a,"category"),s=fn(a,"scene"),l=fn(a,"hidden"),u=Zl(a);u&&l!==!0&&((o=(r=t.find(d=>d.id===i&&e===s))==null?void 0:r.nodes)==null||o.push(u))}return t.filter(a=>a.nodes.length)};Be.prototype.isHistoryEnabled=function(){const e=this.getPlugin("history");return e?e.isEnabled():!1};Be.prototype.enableHistory=function(){const e=this.getPlugin("history");return e&&e.enable(),this};Be.prototype.disableHistory=function(){const e=this.getPlugin("history");return e&&e.disable(),this};Be.prototype.toggleHistory=function(e){const t=this.getPlugin("history");return t&&t.toggleEnabled(e),this};Be.prototype.undo=function(e){const t=this.getPlugin("history");return t&&t.undo(e),this};Be.prototype.redo=function(e){const t=this.getPlugin("history");return t&&t.redo(e),this};Be.prototype.undoAndCancel=function(e){const t=this.getPlugin("history");return t&&t.cancel(e),this};Be.prototype.canUndo=function(){const e=this.getPlugin("history");return e?e.canUndo():!1};Be.prototype.canRedo=function(){const e=this.getPlugin("history");return e?e.canRedo():!1};Be.prototype.cleanHistory=function(e){const t=this.getPlugin("history");return t&&t.clean(e),this};Be.prototype.getHistoryStackSize=function(){return this.getPlugin("history").getSize()};Be.prototype.getUndoStackSize=function(){return this.getPlugin("history").getUndoSize()};Be.prototype.getRedoStackSize=function(){return this.getPlugin("history").getRedoSize()};Be.prototype.getUndoRemainSize=function(){return this.getPlugin("history").getUndoRemainSize()};var Qp=globalThis&&globalThis.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};class qo extends tr{constructor(t={}){super(),this.name="history",this.batchCommands=null,this.batchLevel=0,this.lastBatchIndex=-1,this.freezed=!1,this.stackSize=0,this.handlers=[];const{stackSize:n=0}=t;this.stackSize=n,this.options=jt.getOptions(t),this.validator=new qo.Validator({history:this,cancelInvalid:this.options.cancelInvalid})}init(t){this.graph=t,this.model=this.graph.model,this.clean(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}undo(t={}){if(!this.disabled){const n=this.undoStack.pop();n&&(this.revertCommand(n,t),this.redoStack.push(n),this.notify("undo",n,t))}return this}redo(t={}){if(!this.disabled){const n=this.redoStack.pop();n&&(this.applyCommand(n,t),this.undoStackPush(n),this.notify("redo",n,t))}return this}cancel(t={}){if(!this.disabled){const n=this.undoStack.pop();n&&(this.revertCommand(n,t),this.redoStack=[],this.notify("cancel",n,t))}return this}getSize(){return this.stackSize}getUndoRemainSize(){const t=this.undoStack.length;return this.stackSize-t}getUndoSize(){return this.undoStack.length}getRedoSize(){return this.redoStack.length}canUndo(){return!this.disabled&&this.undoStack.length>0}canRedo(){return!this.disabled&&this.redoStack.length>0}clean(t={}){return this.undoStack=[],this.redoStack=[],this.notify("clean",null,t),this}get disabled(){return this.options.enabled!==!0}validate(t,...n){return this.validator.validate(t,...n),this}startListening(){this.model.on("batch:start",this.initBatchCommand,this),this.model.on("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&this.options.eventNames.forEach((t,n)=>{this.handlers[n]=this.addCommand.bind(this,t),this.model.on(t,this.handlers[n])}),this.validator.on("invalid",t=>this.trigger("invalid",t))}stopListening(){this.model.off("batch:start",this.initBatchCommand,this),this.model.off("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&(this.options.eventNames.forEach((t,n)=>{this.model.off(t,this.handlers[n])}),this.handlers.length=0),this.validator.off("invalid")}createCommand(t){return{batch:t?t.batch:!1,data:{}}}revertCommand(t,n){this.freezed=!0;const r=Array.isArray(t)?jt.sortBatchCommands(t):[t];for(let o=r.length-1;o>=0;o-=1){const a=r[o],i=Object.assign(Object.assign({},n),nf(a.options,this.options.revertOptionsList||[]));this.executeCommand(a,!0,i)}this.freezed=!1}applyCommand(t,n){this.freezed=!0;const r=Array.isArray(t)?jt.sortBatchCommands(t):[t];for(let o=0;o<r.length;o+=1){const a=r[o],i=Object.assign(Object.assign({},n),nf(a.options,this.options.applyOptionsList||[]));this.executeCommand(a,!1,i)}this.freezed=!1}executeCommand(t,n,r){const o=this.model,a=o.getCell(t.data.id),i=t.event;if(jt.isAddEvent(i)&&n||jt.isRemoveEvent(i)&&!n)a&&a.remove(r);else if(jt.isAddEvent(i)&&!n||jt.isRemoveEvent(i)&&n){const s=t.data;s.node?o.addNode(s.props,r):s.edge&&o.addEdge(s.props,r)}else if(jt.isChangeEvent(i)){const s=t.data,l=s.key;if(l&&a){const u=n?s.prev[l]:s.next[l];s.key==="attrs"&&this.ensureUndefinedAttrs(u,n?s.next[l]:s.prev[l])&&(r.dirty=!0),a.prop(l,u,r)}}else{const s=this.options.executeCommand;s&&lr(s,this,t,n,r)}}addCommand(t,n){if(this.freezed||this.disabled)return;const r=n,o=r.options||{};if(o.dryrun||jt.isAddEvent(t)&&this.options.ignoreAdd||jt.isRemoveEvent(t)&&this.options.ignoreRemove||jt.isChangeEvent(t)&&this.options.ignoreChange)return;const a=this.options.beforeAddCommand;if(a!=null&&lr(a,this,t,n)===!1)return;t==="cell:change:*"&&(t=`cell:change:${r.key}`);const i=r.cell,s=_u.isModel(i);let l;if(this.batchCommands){l=this.batchCommands[Math.max(this.lastBatchIndex,0)];const d=s&&!l.modelChange||l.data.id!==i.id,c=l.event!==t;if(this.lastBatchIndex>=0&&(d||c)){const f=this.batchCommands.findIndex(h=>(s&&h.modelChange||h.data.id===i.id)&&h.event===t);f<0||jt.isAddEvent(t)||jt.isRemoveEvent(t)?l=this.createCommand({batch:!0}):(l=this.batchCommands[f],this.batchCommands.splice(f,1)),this.batchCommands.push(l),this.lastBatchIndex=this.batchCommands.length-1}}else l=this.createCommand({batch:!1});if(jt.isAddEvent(t)||jt.isRemoveEvent(t)){const d=l.data;return l.event=t,l.options=o,d.id=i.id,d.props=Et(i.toJSON()),i.isEdge()?d.edge=!0:i.isNode()&&(d.node=!0),this.push(l,o)}if(jt.isChangeEvent(t)){const d=n.key,c=l.data;return(!l.batch||!l.event)&&(l.event=t,l.options=o,c.key=d,c.prev==null&&(c.prev={}),c.prev[d]=Et(i.previous(d)),s?l.modelChange=!0:c.id=i.id),c.next==null&&(c.next={}),c.next[d]=Et(i.prop(d)),this.push(l,o)}const u=this.options.afterAddCommand;u&&lr(u,this,t,n,l),this.push(l,o)}initBatchCommand(t){this.freezed||(this.batchCommands?this.batchLevel+=1:(this.batchCommands=[this.createCommand({batch:!0})],this.batchLevel=0,this.lastBatchIndex=-1))}storeBatchCommand(t){if(!this.freezed)if(this.batchCommands&&this.batchLevel<=0){const n=this.filterBatchCommand(this.batchCommands);n.length>0&&(this.redoStack=[],this.undoStackPush(n),this.consolidateCommands(),this.notify("add",n,t)),this.batchCommands=null,this.lastBatchIndex=-1,this.batchLevel=0}else this.batchCommands&&this.batchLevel>0&&(this.batchLevel-=1)}filterBatchCommand(t){let n=t.slice();const r=[];for(;n.length>0;){const o=n.shift(),a=o.event,i=o.data.id;if(a!=null&&(i!=null||o.modelChange)){if(jt.isAddEvent(a)){const s=n.findIndex(l=>jt.isRemoveEvent(l.event)&&l.data.id===i);if(s>=0){n=n.filter((l,u)=>s<u||l.data.id!==i);continue}}else if(jt.isRemoveEvent(a)){const s=n.findIndex(l=>jt.isAddEvent(l.event)&&l.data.id===i);if(s>=0){n.splice(s,1);continue}}else if(jt.isChangeEvent(a)){const s=o.data;if(Bp(s.prev,s.next))continue}r.push(o)}}return r}notify(t,n,r){const o=n==null?null:Array.isArray(n)?n:[n];this.emit(t,{cmds:o,options:r}),this.graph.trigger(`history:${t}`,{cmds:o,options:r}),this.emit("change",{cmds:o,options:r}),this.graph.trigger("history:change",{cmds:o,options:r})}push(t,n){this.redoStack=[],t.batch?(this.lastBatchIndex=Math.max(this.lastBatchIndex,0),this.emit("batch",{cmd:t,options:n})):(this.undoStackPush(t),this.consolidateCommands(),this.notify("add",t,n))}consolidateCommands(){var t;const n=this.undoStack[this.undoStack.length-1],r=this.undoStack[this.undoStack.length-2];if(!Array.isArray(n))return;const o=new Set(n.map(i=>i.event));if(o.size!==2||!o.has("cell:change:parent")||!o.has("cell:change:children")||!n.every(i=>{var s;return i.batch&&((s=i.options)===null||s===void 0?void 0:s.ui)})||!Array.isArray(r)||r.length!==1)return;const a=r[0];a.event!=="cell:change:position"||!(!((t=a.options)===null||t===void 0)&&t.ui)||(r.push(...n),this.undoStack.pop())}undoStackPush(t){if(this.stackSize===0){this.undoStack.push(t);return}this.undoStack.length>=this.stackSize&&this.undoStack.shift(),this.undoStack.push(t)}ensureUndefinedAttrs(t,n){let r=!1;return t!==null&&n!==null&&typeof t=="object"&&typeof n=="object"&&Object.keys(n).forEach(o=>{t[o]===void 0&&n[o]!==void 0?(t[o]=void 0,r=!0):typeof t[o]=="object"&&typeof n[o]=="object"&&(r=this.ensureUndefinedAttrs(t[o],n[o]))}),r}dispose(){this.validator.dispose(),this.clean(),this.stopListening(),this.off()}}Qp([tr.dispose()],qo.prototype,"dispose",null);(function(e){class t extends tr{constructor(r){super(),this.map={},this.command=r.history,this.cancelInvalid=r.cancelInvalid!==!1,this.command.on("add",this.onCommandAdded,this)}onCommandAdded({cmds:r}){return Array.isArray(r)?r.every(o=>this.isValidCommand(o)):this.isValidCommand(r)}isValidCommand(r){if(r.options&&r.options.validation===!1)return!0;const o=r.event&&this.map[r.event]||[];let a=null;return o.forEach(i=>{let s=0;const l=u=>{const d=i[s];s+=1;try{if(d)d(u,r,l);else{a=u;return}}catch(c){l(c)}};l(a)}),a?(this.cancelInvalid&&this.command.cancel(),this.emit("invalid",{err:a}),!1):!0}validate(r,...o){const a=Array.isArray(r)?r:r.split(/\s+/);return o.forEach(i=>{if(typeof i!="function")throw new Error(`${a.join(" ")} requires callback functions.`)}),a.forEach(i=>{this.map[i]==null&&(this.map[i]=[]),this.map[i].push(o)}),this}dispose(){this.command.off("add",this.onCommandAdded,this)}}Qp([tr.dispose()],t.prototype,"dispose",null),e.Validator=t})(qo||(qo={}));var jt;(function(e){function t(i){return i==="cell:added"}e.isAddEvent=t;function n(i){return i==="cell:removed"}e.isRemoveEvent=n;function r(i){return i!=null&&i.startsWith("cell:change:")}e.isChangeEvent=r;function o(i){const s=["cell:added","cell:removed","cell:change:*"],l=["batch:start","batch:stop"],u=i.eventNames?i.eventNames.filter(d=>!(e.isChangeEvent(d)||s.includes(d)||l.includes(d))):s;return Object.assign(Object.assign({enabled:!0},i),{eventNames:u,applyOptionsList:i.applyOptionsList||["propertyPath"],revertOptionsList:i.revertOptionsList||["propertyPath"]})}e.getOptions=o;function a(i){const s=[];for(let l=0,u=i.length;l<u;l+=1){const d=i[l];let c=null;if(e.isAddEvent(d.event)){const f=d.data.id;for(let h=0;h<l;h+=1)if(i[h].data.id===f){c=h;break}}c!==null?s.splice(c,0,d):s.push(d)}return s}e.sortBatchCommands=a})(jt||(jt={}));var H0=globalThis&&globalThis.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};class Zp extends ea{get graph(){return this.options.graph}get boxClassName(){return this.prefixClassName(xn.classNames.box)}get $boxes(){return ay(this.container,this.boxClassName)}get handleOptions(){return this.options}constructor(t){super(),this.options=t,this.options.model&&(this.options.collection=this.options.model.collection),this.options.collection?this.collection=this.options.collection:(this.collection=new iy([],{comparator:xn.depthComparator}),this.options.collection=this.collection),this.boxCount=0,this.createContainer(),this.startListening()}startListening(){const t=this.graph,n=this.collection;this.delegateEvents({[`mousedown .${this.boxClassName}`]:"onSelectionBoxMouseDown",[`touchstart .${this.boxClassName}`]:"onSelectionBoxMouseDown"},!0),t.on("scale",this.onGraphTransformed,this),t.on("translate",this.onGraphTransformed,this),t.model.on("updated",this.onModelUpdated,this),n.on("added",this.onCellAdded,this),n.on("removed",this.onCellRemoved,this),n.on("reseted",this.onReseted,this),n.on("updated",this.onCollectionUpdated,this),n.on("node:change:position",this.onNodePositionChanged,this),n.on("cell:changed",this.onCellChanged,this)}stopListening(){const t=this.graph,n=this.collection;this.undelegateEvents(),t.off("scale",this.onGraphTransformed,this),t.off("translate",this.onGraphTransformed,this),t.model.off("updated",this.onModelUpdated,this),n.off("added",this.onCellAdded,this),n.off("removed",this.onCellRemoved,this),n.off("reseted",this.onReseted,this),n.off("updated",this.onCollectionUpdated,this),n.off("node:change:position",this.onNodePositionChanged,this),n.off("cell:changed",this.onCellChanged,this)}onRemove(){this.stopListening()}onGraphTransformed(){this.updateSelectionBoxes()}onCellChanged(){this.updateSelectionBoxes()}onNodePositionChanged({node:t,options:n}){const{showNodeSelectionBox:r,pointerEvents:o}=this.options,{ui:a,selection:i,translateBy:s,snapped:l}=n,u=(r!==!0||o&&this.getPointerEventsValue(o)==="none")&&!this.translating&&!i,d=a&&s&&t.id===s;if(u&&(d||l)){this.translating=!0;const c=t.position(),f=t.previous("position"),h=c.x-f.x,m=c.y-f.y;(h!==0||m!==0)&&this.translateSelectedNodes(h,m,t,n),this.translating=!1}}onModelUpdated({removed:t}){t&&t.length&&this.unselect(t)}isEmpty(){return this.length<=0}isSelected(t){return this.collection.has(t)}get length(){return this.collection.length}get cells(){return this.collection.toArray()}select(t,n={}){n.dryrun=!0;const r=this.filter(Array.isArray(t)?t:[t]);return this.collection.add(r,n),this}unselect(t,n={}){return n.dryrun=!0,this.collection.remove(Array.isArray(t)?t:[t],n),this}reset(t,n={}){if(t){if(n.batch){const u=this.filter(Array.isArray(t)?t:[t]);return this.collection.reset(u,Object.assign(Object.assign({},n),{ui:!0})),this}const r=this.cells,o=this.filter(Array.isArray(t)?t:[t]),a={},i={};r.forEach(u=>a[u.id]=u),o.forEach(u=>i[u.id]=u);const s=[],l=[];return o.forEach(u=>{a[u.id]||s.push(u)}),r.forEach(u=>{i[u.id]||l.push(u)}),l.length&&this.unselect(l,Object.assign(Object.assign({},n),{ui:!0})),s.length&&this.select(s,Object.assign(Object.assign({},n),{ui:!0})),l.length===0&&s.length===0&&this.updateContainer(),this}return this.clean(n)}clean(t={}){return this.length&&(t.batch===!1?this.unselect(this.cells,t):this.collection.reset([],Object.assign(Object.assign({},t),{ui:!0}))),this}setFilter(t){this.options.filter=t}setContent(t){this.options.content=t}startSelecting(t){t=this.normalizeEvent(t),this.clean();let n,r;const o=this.graph.container;if(t.offsetX!=null&&t.offsetY!=null&&o.contains(t.target))n=t.offsetX,r=t.offsetY;else{const a=Xl(o),i=o.scrollLeft,s=o.scrollTop;n=t.clientX-a.left+window.pageXOffset+i,r=t.clientY-a.top+window.pageYOffset+s}Pt(this.container,{top:r,left:n,width:1,height:1}),this.setEventData(t,{action:"selecting",clientX:t.clientX,clientY:t.clientY,offsetX:n,offsetY:r,scrollerX:0,scrollerY:0,moving:!1}),this.delegateDocumentEvents(xn.documentEvents,t.data)}filter(t){const n=this.options.filter;return t.filter(r=>Array.isArray(n)?n.some(o=>typeof o=="string"?r.shape===o:r.id===o.id):typeof n=="function"?lr(n,this.graph,r):!0)}stopSelecting(t){const n=this.graph,r=this.getEventData(t);switch(r.action){case"selecting":{let a=sy(this.container),i=ly(this.container);const s=Xl(this.container),l=n.pageToLocal(s.left,s.top),u=n.transform.getScale();a/=u.sx,i/=u.sy;const d=new Ar(l.x,l.y,a,i),c=this.getCellViewsInArea(d).map(f=>f.cell);this.reset(c,{batch:!0}),this.hideRubberband();break}case"translating":{const a=n.snapToGrid(t.clientX,t.clientY);if(!this.options.following){const i=r;this.updateSelectedNodesPosition({dx:i.clientX-i.originX,dy:i.clientY-i.originY})}this.graph.model.stopBatch("move-selection"),this.notifyBoxEvent("box:mouseup",t,a.x,a.y);break}default:{this.clean();break}}}onMouseUp(t){this.getEventData(t).action&&(this.stopSelecting(t),this.undelegateDocumentEvents())}onSelectionBoxMouseDown(t){this.options.following||t.stopPropagation();const n=this.normalizeEvent(t);this.options.movable&&this.startTranslating(n);const r=this.getCellViewFromElem(n.target);this.setEventData(n,{activeView:r});const o=this.graph.snapToGrid(n.clientX,n.clientY);this.notifyBoxEvent("box:mousedown",n,o.x,o.y),this.delegateDocumentEvents(xn.documentEvents,n.data)}startTranslating(t){this.graph.model.startBatch("move-selection");const n=this.graph.snapToGrid(t.clientX,t.clientY);this.setEventData(t,{action:"translating",clientX:n.x,clientY:n.y,originX:n.x,originY:n.y})}getRestrictArea(){const t=this.graph.options.translating.restrict,n=typeof t=="function"?lr(t,this.graph,null):t;return typeof n=="number"?this.graph.transform.getGraphArea().inflate(n):n===!0?this.graph.transform.getGraphArea():n||null}getSelectionOffset(t,n){let r=t.x-n.clientX,o=t.y-n.clientY;const a=this.getRestrictArea();if(a){const i=this.collection.toArray(),s=uy.getCellsBBox(i,{deep:!0})||Ar.create(),l=a.x-s.x,u=a.y-s.y,d=a.x+a.width-(s.x+s.width),c=a.y+a.height-(s.y+s.height);if(r<l&&(r=l),o<u&&(o=u),d<r&&(r=d),c<o&&(o=c),!this.options.following){const f=t.x-n.originX,h=t.y-n.originY;r=f<=l||f>=d?0:r,o=h<=u||h>=c?0:o}}return{dx:r,dy:o}}updateElementPosition(t,n,r){const o=Pt(t,"left"),a=Pt(t,"top"),i=o?parseFloat(o):0,s=a?parseFloat(a):0;Pt(t,"left",i+n),Pt(t,"top",s+r)}updateSelectedNodesPosition(t){const{dx:n,dy:r}=t;if(n||r)if(this.translateSelectedNodes(n,r),this.boxesUpdated)this.collection.length>1&&this.updateSelectionBoxes();else{const o=this.graph.transform.getScale();for(let a=0,i=this.$boxes,s=i.length;a<s;a+=1)this.updateElementPosition(i[a],n*o.sx,r*o.sy);this.updateElementPosition(this.selectionContainer,n*o.sx,r*o.sy)}}autoScrollGraph(t,n){const r=this.graph.getPlugin("scroller");return r?r.autoScroll(t,n):{scrollerX:0,scrollerY:0}}adjustSelection(t){const n=this.normalizeEvent(t),r=this.getEventData(n);switch(r.action){case"selecting":{const a=r;a.moving!==!0&&(oo(this.container,this.graph.container),this.showRubberband(),a.moving=!0);const{scrollerX:i,scrollerY:s}=this.autoScrollGraph(n.clientX,n.clientY);a.scrollerX+=i,a.scrollerY+=s;const l=n.clientX-a.clientX+a.scrollerX,u=n.clientY-a.clientY+a.scrollerY,d=parseInt(Pt(this.container,"left")||"0",10),c=parseInt(Pt(this.container,"top")||"0",10);Pt(this.container,{left:l<0?a.offsetX+l:d,top:u<0?a.offsetY+u:c,width:Math.abs(l),height:Math.abs(u)});break}case"translating":{const a=this.graph.snapToGrid(n.clientX,n.clientY),i=r,s=this.getSelectionOffset(a,i);this.options.following?this.updateSelectedNodesPosition(s):this.updateContainerPosition(s),s.dx&&(i.clientX=a.x),s.dy&&(i.clientY=a.y),this.notifyBoxEvent("box:mousemove",t,a.x,a.y);break}}this.boxesUpdated=!1}translateSelectedNodes(t,n,r,o){const a={},i=[];if(r&&(a[r.id]=!0),this.collection.toArray().forEach(s=>{s.getDescendants({deep:!0}).forEach(l=>{a[l.id]=!0})}),o&&o.translateBy){const s=this.graph.getCellById(o.translateBy);s&&(a[s.id]=!0,s.getDescendants({deep:!0}).forEach(l=>{a[l.id]=!0}),i.push(s))}this.collection.toArray().forEach(s=>{if(!a[s.id]){const l=Object.assign(Object.assign({},o),{selection:this.cid,exclude:i});s.translate(t,n,l),this.graph.model.getConnectedEdges(s).forEach(u=>{a[u.id]||(u.translate(t,n,l),a[u.id]=!0)})}})}getCellViewsInArea(t){const n=this.graph,r={strict:this.options.strict};let o=[];return this.options.rubberNode&&(o=o.concat(n.model.getNodesInArea(t,r).map(a=>n.renderer.findViewByCell(a)).filter(a=>a!=null))),this.options.rubberEdge&&(o=o.concat(n.model.getEdgesInArea(t,r).map(a=>n.renderer.findViewByCell(a)).filter(a=>a!=null))),o}notifyBoxEvent(t,n,r,o){const i=this.getEventData(n).activeView;this.trigger(t,{e:n,view:i,x:r,y:o,cell:i.cell})}getSelectedClassName(t){return this.prefixClassName(`${t.isNode()?"node":"edge"}-selected`)}addCellSelectedClassName(t){const n=this.graph.renderer.findViewByCell(t);n&&n.addClass(this.getSelectedClassName(t))}removeCellUnSelectedClassName(t){const n=this.graph.renderer.findViewByCell(t);n&&n.removeClass(this.getSelectedClassName(t))}destroySelectionBox(t){this.removeCellUnSelectedClassName(t),this.canShowSelectionBox(t)&&(xl(this.container.querySelector(`[data-cell-id="${t.id}"]`)),this.$boxes.length===0&&this.hide(),this.boxCount=Math.max(0,this.boxCount-1))}destroyAllSelectionBoxes(t){t.forEach(n=>this.removeCellUnSelectedClassName(n)),this.hide(),xl(this.$boxes),this.boxCount=0}hide(){Va(this.container,this.prefixClassName(xn.classNames.rubberband)),Va(this.container,this.prefixClassName(xn.classNames.selected))}showRubberband(){tn(this.container,this.prefixClassName(xn.classNames.rubberband))}hideRubberband(){Va(this.container,this.prefixClassName(xn.classNames.rubberband))}showSelected(){dy(this.container,"style"),tn(this.container,this.prefixClassName(xn.classNames.selected))}createContainer(){this.container=document.createElement("div"),tn(this.container,this.prefixClassName(xn.classNames.root)),this.options.className&&tn(this.container,this.options.className),this.selectionContainer=document.createElement("div"),tn(this.selectionContainer,this.prefixClassName(xn.classNames.inner)),this.selectionContent=document.createElement("div"),tn(this.selectionContent,this.prefixClassName(xn.classNames.content)),Ba(this.selectionContainer,this.selectionContent),Pi(this.selectionContainer,"data-selection-length",this.collection.length),cy(this.container,this.selectionContainer)}updateContainerPosition(t){(t.dx||t.dy)&&this.updateElementPosition(this.selectionContainer,t.dx,t.dy)}updateContainer(){const t={x:1/0,y:1/0},n={x:0,y:0};this.collection.toArray().filter(a=>this.canShowSelectionBox(a)).forEach(a=>{const i=this.graph.renderer.findViewByCell(a);if(i){const s=i.getBBox({useCellGeometry:!0});t.x=Math.min(t.x,s.x),t.y=Math.min(t.y,s.y),n.x=Math.max(n.x,s.x+s.width),n.y=Math.max(n.y,s.y+s.height)}}),Pt(this.selectionContainer,{position:"absolute",pointerEvents:"none",left:t.x,top:t.y,width:n.x-t.x,height:n.y-t.y}),Pi(this.selectionContainer,"data-selection-length",this.collection.length);const o=this.options.content;if(o)if(typeof o=="function"){const a=lr(o,this.graph,this,this.selectionContent);a&&(this.selectionContent.innerHTML=a)}else this.selectionContent.innerHTML=o;this.collection.length>0&&!this.container.parentNode?oo(this.container,this.graph.container):this.collection.length<=0&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}canShowSelectionBox(t){return t.isNode()&&this.options.showNodeSelectionBox===!0||t.isEdge()&&this.options.showEdgeSelectionBox===!0}getPointerEventsValue(t){return typeof t=="string"?t:t(this.cells)}createSelectionBox(t){if(this.addCellSelectedClassName(t),this.canShowSelectionBox(t)){const n=this.graph.renderer.findViewByCell(t);if(n){const r=n.getBBox({useCellGeometry:!0}),o=this.boxClassName,a=document.createElement("div"),i=this.options.pointerEvents;tn(a,o),tn(a,`${o}-${t.isNode()?"node":"edge"}`),Pi(a,"data-cell-id",t.id),Pt(a,{position:"absolute",left:r.x,top:r.y,width:r.width,height:r.height,pointerEvents:i?this.getPointerEventsValue(i):"auto"}),oo(a,this.container),this.showSelected(),this.boxCount+=1}}}updateSelectionBoxes(){this.collection.length>0&&(this.boxesUpdated=!0,this.confirmUpdate())}confirmUpdate(){if(this.boxCount){this.hide();for(let t=0,n=this.$boxes,r=n.length;t<r;t+=1){const o=n[t],a=Pi(o,"data-cell-id");xl(o),this.boxCount-=1;const i=this.collection.get(a);i&&this.createSelectionBox(i)}this.updateContainer()}return 0}getCellViewFromElem(t){const n=t.getAttribute("data-cell-id");if(n){const r=this.collection.get(n);if(r)return this.graph.renderer.findViewByCell(r)}return null}onCellRemoved({cell:t}){this.destroySelectionBox(t),this.updateContainer()}onReseted({previous:t,current:n}){this.destroyAllSelectionBoxes(t),n.forEach(r=>{this.listenCellRemoveEvent(r),this.createSelectionBox(r)}),this.updateContainer()}onCellAdded({cell:t}){this.listenCellRemoveEvent(t),this.createSelectionBox(t),this.updateContainer()}listenCellRemoveEvent(t){t.off("removed",this.onCellRemoved,this),t.on("removed",this.onCellRemoved,this)}onCollectionUpdated({added:t,removed:n,options:r}){t.forEach(a=>{this.trigger("cell:selected",{cell:a,options:r}),a.isNode()?this.trigger("node:selected",{cell:a,options:r,node:a}):a.isEdge()&&this.trigger("edge:selected",{cell:a,options:r,edge:a})}),n.forEach(a=>{this.trigger("cell:unselected",{cell:a,options:r}),a.isNode()?this.trigger("node:unselected",{cell:a,options:r,node:a}):a.isEdge()&&this.trigger("edge:unselected",{cell:a,options:r,edge:a})});const o={added:t,removed:n,options:r,selected:this.cells.filter(a=>!!this.graph.getCellById(a.id))};this.trigger("selection:changed",o)}dispose(){this.clean(),this.remove(),this.off()}}H0([ea.dispose()],Zp.prototype,"dispose",null);var xn;(function(e){const t="widget-selection";e.classNames={root:t,inner:`${t}-inner`,box:`${t}-box`,content:`${t}-content`,rubberband:`${t}-rubberband`,selected:`${t}-selected`},e.documentEvents={mousemove:"adjustSelection",touchmove:"adjustSelection",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"};function n(r){return r.getAncestors().length}e.depthComparator=n})(xn||(xn={}));const W0=`.x6-widget-selection {
  position: absolute;
  top: 0;
  left: 0;
  display: none;
  width: 0;
  height: 0;
  touch-action: none;
}
.x6-widget-selection-rubberband {
  display: block;
  overflow: visible;
  opacity: 0.3;
}
.x6-widget-selection-selected {
  display: block;
}
.x6-widget-selection-box {
  cursor: move;
}
.x6-widget-selection-inner[data-selection-length='0'],
.x6-widget-selection-inner[data-selection-length='1'] {
  display: none;
}
.x6-widget-selection-content {
  position: absolute;
  top: 100%;
  right: -20px;
  left: -20px;
  margin-top: 30px;
  padding: 6px;
  line-height: 14px;
  text-align: center;
  border-radius: 6px;
}
.x6-widget-selection-content:empty {
  display: none;
}
.x6-widget-selection-rubberband {
  background-color: #3498db;
  border: 2px solid #2980b9;
}
.x6-widget-selection-box {
  box-sizing: content-box !important;
  margin-top: -4px;
  margin-left: -4px;
  padding-right: 4px;
  padding-bottom: 4px;
  border: 2px dashed #feb663;
  box-shadow: 2px 2px 5px #d3d3d3;
}
.x6-widget-selection-inner {
  box-sizing: content-box !important;
  margin-top: -8px;
  margin-left: -8px;
  padding-right: 12px;
  padding-bottom: 12px;
  border: 2px solid #feb663;
  box-shadow: 2px 2px 5px #d3d3d3;
}
.x6-widget-selection-content {
  color: #fff;
  font-size: 10px;
  background-color: #6a6b8a;
}
`;Be.prototype.isSelectionEnabled=function(){const e=this.getPlugin("selection");return e?e.isEnabled():!1};Be.prototype.enableSelection=function(){const e=this.getPlugin("selection");return e&&e.enable(),this};Be.prototype.disableSelection=function(){const e=this.getPlugin("selection");return e&&e.disable(),this};Be.prototype.toggleSelection=function(e){const t=this.getPlugin("selection");return t&&t.toggleEnabled(e),this};Be.prototype.isMultipleSelection=function(){const e=this.getPlugin("selection");return e?e.isMultipleSelection():!1};Be.prototype.enableMultipleSelection=function(){const e=this.getPlugin("selection");return e&&e.enableMultipleSelection(),this};Be.prototype.disableMultipleSelection=function(){const e=this.getPlugin("selection");return e&&e.disableMultipleSelection(),this};Be.prototype.toggleMultipleSelection=function(e){const t=this.getPlugin("selection");return t&&t.toggleMultipleSelection(e),this};Be.prototype.isSelectionMovable=function(){const e=this.getPlugin("selection");return e?e.isSelectionMovable():!1};Be.prototype.enableSelectionMovable=function(){const e=this.getPlugin("selection");return e&&e.enableSelectionMovable(),this};Be.prototype.disableSelectionMovable=function(){const e=this.getPlugin("selection");return e&&e.disableSelectionMovable(),this};Be.prototype.toggleSelectionMovable=function(e){const t=this.getPlugin("selection");return t&&t.toggleSelectionMovable(e),this};Be.prototype.isRubberbandEnabled=function(){const e=this.getPlugin("selection");return e?e.isRubberbandEnabled():!1};Be.prototype.enableRubberband=function(){const e=this.getPlugin("selection");return e&&e.enableRubberband(),this};Be.prototype.disableRubberband=function(){const e=this.getPlugin("selection");return e&&e.disableRubberband(),this};Be.prototype.toggleRubberband=function(e){const t=this.getPlugin("selection");return t&&t.toggleRubberband(e),this};Be.prototype.isStrictRubberband=function(){const e=this.getPlugin("selection");return e?e.isStrictRubberband():!1};Be.prototype.enableStrictRubberband=function(){const e=this.getPlugin("selection");return e&&e.enableStrictRubberband(),this};Be.prototype.disableStrictRubberband=function(){const e=this.getPlugin("selection");return e&&e.disableStrictRubberband(),this};Be.prototype.toggleStrictRubberband=function(e){const t=this.getPlugin("selection");return t&&t.toggleStrictRubberband(e),this};Be.prototype.setRubberbandModifiers=function(e){const t=this.getPlugin("selection");return t&&t.setRubberbandModifiers(e),this};Be.prototype.setSelectionFilter=function(e){const t=this.getPlugin("selection");return t&&t.setSelectionFilter(e),this};Be.prototype.setSelectionDisplayContent=function(e){const t=this.getPlugin("selection");return t&&t.setSelectionDisplayContent(e),this};Be.prototype.isSelectionEmpty=function(){const e=this.getPlugin("selection");return e?e.isEmpty():!0};Be.prototype.cleanSelection=function(e){const t=this.getPlugin("selection");return t&&t.clean(e),this};Be.prototype.resetSelection=function(e,t){const n=this.getPlugin("selection");return n&&n.reset(e,t),this};Be.prototype.getSelectedCells=function(){const e=this.getPlugin("selection");return e?e.getSelectedCells():[]};Be.prototype.getSelectedCellCount=function(){const e=this.getPlugin("selection");return e?e.getSelectedCellCount():0};Be.prototype.isSelected=function(e){const t=this.getPlugin("selection");return t?t.isSelected(e):!1};Be.prototype.select=function(e,t){const n=this.getPlugin("selection");return n&&n.select(e,t),this};Be.prototype.unselect=function(e,t){const n=this.getPlugin("selection");return n&&n.unselect(e,t),this};var Y0=globalThis&&globalThis.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};class Qo extends tr{get rubberbandDisabled(){return this.options.enabled!==!0||this.options.rubberband!==!0}get disabled(){return this.options.enabled!==!0}get length(){return this.selectionImpl.length}get cells(){return this.selectionImpl.cells}constructor(t={}){super(),this.name="selection",this.movedMap=new WeakMap,this.unselectMap=new WeakMap,this.options=Object.assign(Object.assign({enabled:!0},Qo.defaultOptions),t),bu(this.name,W0)}init(t){this.graph=t,this.selectionImpl=new Zp(Object.assign(Object.assign({},this.options),{graph:t})),this.setup(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isMultipleSelection(){return this.isMultiple()}enableMultipleSelection(){return this.enableMultiple(),this}disableMultipleSelection(){return this.disableMultiple(),this}toggleMultipleSelection(t){return t!=null?t!==this.isMultipleSelection()&&(t?this.enableMultipleSelection():this.disableMultipleSelection()):this.isMultipleSelection()?this.disableMultipleSelection():this.enableMultipleSelection(),this}isSelectionMovable(){return this.options.movable!==!1}enableSelectionMovable(){return this.selectionImpl.options.movable=!0,this}disableSelectionMovable(){return this.selectionImpl.options.movable=!1,this}toggleSelectionMovable(t){return t!=null?t!==this.isSelectionMovable()&&(t?this.enableSelectionMovable():this.disableSelectionMovable()):this.isSelectionMovable()?this.disableSelectionMovable():this.enableSelectionMovable(),this}isRubberbandEnabled(){return!this.rubberbandDisabled}enableRubberband(){return this.rubberbandDisabled&&(this.options.rubberband=!0),this}disableRubberband(){return this.rubberbandDisabled||(this.options.rubberband=!1),this}toggleRubberband(t){return t!=null?t!==this.isRubberbandEnabled()&&(t?this.enableRubberband():this.disableRubberband()):this.isRubberbandEnabled()?this.disableRubberband():this.enableRubberband(),this}isStrictRubberband(){return this.selectionImpl.options.strict===!0}enableStrictRubberband(){return this.selectionImpl.options.strict=!0,this}disableStrictRubberband(){return this.selectionImpl.options.strict=!1,this}toggleStrictRubberband(t){return t!=null?t!==this.isStrictRubberband()&&(t?this.enableStrictRubberband():this.disableStrictRubberband()):this.isStrictRubberband()?this.disableStrictRubberband():this.enableStrictRubberband(),this}setRubberbandModifiers(t){this.setModifiers(t)}setSelectionFilter(t){return this.setFilter(t),this}setSelectionDisplayContent(t){return this.setContent(t),this}isEmpty(){return this.length<=0}clean(t={}){return this.selectionImpl.clean(t),this}reset(t,n={}){return this.selectionImpl.reset(t?this.getCells(t):[],n),this}getSelectedCells(){return this.cells}getSelectedCellCount(){return this.length}isSelected(t){return this.selectionImpl.isSelected(t)}select(t,n={}){const r=this.getCells(t);return r.length&&(this.isMultiple()?this.selectionImpl.select(r,n):this.reset(r.slice(0,1),n)),this}unselect(t,n={}){return this.selectionImpl.unselect(this.getCells(t),n),this}setup(){this.selectionImpl.on("*",(t,n)=>{this.trigger(t,n),this.graph.trigger(t,n)})}startListening(){this.graph.on("blank:mousedown",this.onBlankMouseDown,this),this.graph.on("blank:click",this.onBlankClick,this),this.graph.on("cell:mousemove",this.onCellMouseMove,this),this.graph.on("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.on("box:mousedown",this.onBoxMouseDown,this)}stopListening(){this.graph.off("blank:mousedown",this.onBlankMouseDown,this),this.graph.off("blank:click",this.onBlankClick,this),this.graph.off("cell:mousemove",this.onCellMouseMove,this),this.graph.off("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.off("box:mousedown",this.onBoxMouseDown,this)}onBlankMouseDown({e:t}){if(!this.allowBlankMouseDown(t))return;const n=this.graph.panning.allowPanning(t,!0),r=this.graph.getPlugin("scroller"),o=r&&r.allowPanning(t,!0);(this.allowRubberband(t,!0)||this.allowRubberband(t)&&!o&&!n)&&this.startRubberband(t)}allowBlankMouseDown(t){const n=this.options.eventTypes;return(n==null?void 0:n.includes("leftMouseDown"))&&t.button===0||(n==null?void 0:n.includes("mouseWheelDown"))&&t.button===1}onBlankClick(){this.clean()}allowRubberband(t,n){return!this.rubberbandDisabled&&Hl.isMatch(t,this.options.modifiers,n)}allowMultipleSelection(t){return this.isMultiple()&&Hl.isMatch(t,this.options.multipleSelectionModifiers)}onCellMouseMove({cell:t}){this.movedMap.set(t,!0)}onCellMouseUp({e:t,cell:n}){const r=this.options;let o=this.disabled;!o&&this.movedMap.has(n)&&(o=r.selectCellOnMoved===!1,o||(o=r.selectNodeOnMoved===!1&&n.isNode()),o||(o=r.selectEdgeOnMoved===!1&&n.isEdge())),o||(this.allowMultipleSelection(t)?this.unselectMap.has(n)?this.unselectMap.delete(n):this.isSelected(n)?this.unselect(n):this.select(n):this.reset(n)),this.movedMap.delete(n)}onBoxMouseDown({e:t,cell:n}){this.disabled||this.allowMultipleSelection(t)&&(this.unselect(n),this.unselectMap.set(n,!0))}getCells(t){return(Array.isArray(t)?t:[t]).map(n=>typeof n=="string"?this.graph.getCellById(n):n).filter(n=>n!=null)}startRubberband(t){return this.rubberbandDisabled||this.selectionImpl.startSelecting(t),this}isMultiple(){return this.options.multiple!==!1}enableMultiple(){return this.options.multiple=!0,this}disableMultiple(){return this.options.multiple=!1,this}setModifiers(t){return this.options.modifiers=t,this}setContent(t){return this.selectionImpl.setContent(t),this}setFilter(t){return this.selectionImpl.setFilter(t),this}dispose(){this.stopListening(),this.off(),this.selectionImpl.dispose(),yu(this.name)}}Y0([tr.dispose()],Qo.prototype,"dispose",null);(function(e){e.defaultOptions={rubberband:!1,rubberNode:!0,rubberEdge:!1,pointerEvents:"auto",multiple:!0,multipleSelectionModifiers:["ctrl","meta"],movable:!0,strict:!1,selectCellOnMoved:!1,selectNodeOnMoved:!1,selectEdgeOnMoved:!1,following:!0,content:null,eventTypes:["leftMouseDown","mouseWheelDown"]}})(Qo||(Qo={}));class K0{constructor(){this.cells=[]}copy(t,n,r={}){this.options=Object.assign({},r);const a=(_u.isModel(n)?n:n.model).cloneSubGraph(t,r);this.cells=Tg(Object.keys(a).map(i=>a[i]),i=>i.isEdge()?2:1),this.serialize(r)}cut(t,n,r={}){this.copy(t,n,r),(Be.isGraph(n)?n.model:n).batchUpdate("cut",()=>{t.forEach(a=>a.remove())})}paste(t,n={}){const r=Object.assign(Object.assign({},this.options),n),{offset:o,edgeProps:a,nodeProps:i}=r;let s=20,l=20;o&&(s=typeof o=="number"?o:o.dx,l=typeof o=="number"?o:o.dy),this.deserialize(r);const u=this.cells;u.forEach(c=>{c.model=null,c.removeProp("zIndex"),(s||l)&&c.translate(s,l),i&&c.isNode()&&c.prop(i),a&&c.isEdge()&&c.prop(a)});const d=Be.isGraph(t)?t.model:t;return d.batchUpdate("paste",()=>{d.addCells(this.cells)}),this.copy(u,t,n),u}serialize(t){t.useLocalStorage!==!1&&Ga.save(this.cells)}deserialize(t){if(t.useLocalStorage){const n=Ga.fetch();n&&(this.cells=n)}}isEmpty(t={}){return t.useLocalStorage&&this.deserialize(t),this.cells.length<=0}clean(){this.options={},this.cells=[],Ga.clean()}}var Ga;(function(e){const t=`${Pp.prefixCls}.clipboard.cells`;function n(a){if(window.localStorage){const i=a.map(s=>s.toJSON());localStorage.setItem(t,JSON.stringify(i))}}e.save=n;function r(){if(window.localStorage){const a=localStorage.getItem(t),i=a?JSON.parse(a):[];if(i)return _u.fromJSON(i)}}e.fetch=r;function o(){window.localStorage&&localStorage.removeItem(t)}e.clean=o})(Ga||(Ga={}));Be.prototype.isClipboardEnabled=function(){const e=this.getPlugin("clipboard");return e?e.isEnabled():!1};Be.prototype.enableClipboard=function(){const e=this.getPlugin("clipboard");return e&&e.enable(),this};Be.prototype.disableClipboard=function(){const e=this.getPlugin("clipboard");return e&&e.disable(),this};Be.prototype.toggleClipboard=function(e){const t=this.getPlugin("clipboard");return t&&t.toggleEnabled(e),this};Be.prototype.isClipboardEmpty=function(e){const t=this.getPlugin("clipboard");return t?t.isEmpty(e):!0};Be.prototype.getCellsInClipboard=function(){const e=this.getPlugin("clipboard");return e?e.getCellsInClipboard():[]};Be.prototype.cleanClipboard=function(){const e=this.getPlugin("clipboard");return e&&e.clean(),this};Be.prototype.copy=function(e,t){const n=this.getPlugin("clipboard");return n&&n.copy(e,t),this};Be.prototype.cut=function(e,t){const n=this.getPlugin("clipboard");return n&&n.cut(e,t),this};Be.prototype.paste=function(e,t){const n=this.getPlugin("clipboard");return n?n.paste(e,t):[]};var q0=globalThis&&globalThis.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},Q0=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n};class Jp extends tr{get disabled(){return this.options.enabled!==!0}get cells(){return this.clipboardImpl.cells}constructor(t={}){super(),this.name="clipboard",this.options=Object.assign({enabled:!0},t)}init(t){this.graph=t,this.clipboardImpl=new K0,this.clipboardImpl.deserialize(this.options)}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isEmpty(t={}){return this.clipboardImpl.isEmpty(t)}getCellsInClipboard(){return this.cells}clean(t){return(!this.disabled||t)&&(this.clipboardImpl.clean(),this.notify("clipboard:changed",{cells:[]})),this}copy(t,n={}){return this.disabled||(this.clipboardImpl.copy(t,this.graph,Object.assign(Object.assign({},this.commonOptions),n)),this.notify("clipboard:changed",{cells:t})),this}cut(t,n={}){return this.disabled||(this.clipboardImpl.cut(t,this.graph,Object.assign(Object.assign({},this.commonOptions),n)),this.notify("clipboard:changed",{cells:t})),this}paste(t={},n=this.graph){return this.disabled?[]:this.clipboardImpl.paste(n,Object.assign(Object.assign({},this.commonOptions),t))}get commonOptions(){const t=this.options;return Q0(t,["enabled"])}notify(t,n){this.trigger(t,n),this.graph.trigger(t,n)}dispose(){this.clean(!0),this.off()}}q0([tr.dispose()],Jp.prototype,"dispose",null);const Z0=`.x6-widget-minimap {
  position: relative;
  display: table-cell;
  box-sizing: border-box;
  overflow: hidden;
  text-align: center;
  vertical-align: middle;
  background-color: #fff;
  user-select: none;
}
.x6-widget-minimap .x6-graph {
  display: inline-block;
  box-shadow: 0 0 4px 0 #eee;
  cursor: pointer;
}
.x6-widget-minimap .x6-graph > svg {
  pointer-events: none;
  shape-rendering: optimizespeed;
}
.x6-widget-minimap .x6-graph .x6-node * {
  /* stylelint-disable-next-line */
  vector-effect: initial;
}
.x6-widget-minimap-viewport {
  position: absolute;
  box-sizing: content-box !important;
  margin: -2px 0 0 -2px;
  border: 2px solid #31d0c6;
  cursor: move;
}
.x6-widget-minimap-viewport-zoom {
  position: absolute;
  right: 0;
  bottom: 0;
  box-sizing: border-box;
  width: 12px;
  height: 12px;
  margin: 0 -6px -6px 0;
  background-color: #fff;
  border: 2px solid #31d0c6;
  border-radius: 50%;
  cursor: nwse-resize;
}
`;var J0=globalThis&&globalThis.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};class eh extends ea{get scroller(){return this.graph.getPlugin("scroller")}get graphContainer(){return this.scroller?this.scroller.container:this.graph.container}constructor(t){super(),this.name="minimap",this.options=Object.assign(Object.assign({},qi.defaultOptions),t),bu(this.name,Z0)}init(t){this.graph=t,this.updateViewport=Up(this.updateViewport.bind(this),0),this.container=document.createElement("div"),tn(this.container,this.prefixClassName(ja.root));const n=document.createElement("div");this.container.appendChild(n),this.viewport=document.createElement("div"),tn(this.viewport,this.prefixClassName(ja.viewport)),this.options.scalable&&(this.zoomHandle=document.createElement("div"),tn(this.zoomHandle,this.prefixClassName(ja.zoom)),oo(this.zoomHandle,this.viewport)),Ba(this.container,this.viewport),Pt(this.container,{width:this.options.width,height:this.options.height,padding:this.options.padding}),this.options.container&&this.options.container.appendChild(this.container),this.sourceGraph=this.graph;const r=Object.assign(Object.assign({},this.options.graphOptions),{container:n,model:this.sourceGraph.model,interacting:!1,grid:!1,background:!1,embedding:!1});this.targetGraph=this.options.createGraph?this.options.createGraph(r):new Be(r),this.updatePaper(this.sourceGraph.options.width,this.sourceGraph.options.height),this.startListening()}startListening(){this.scroller?$n.on(this.graphContainer,`scroll${this.getEventNamespace()}`,this.updateViewport):(this.sourceGraph.on("translate",this.onTransform,this),this.sourceGraph.on("scale",this.onTransform,this),this.sourceGraph.on("model:updated",this.onModelUpdated,this)),this.sourceGraph.on("resize",this.updatePaper,this),this.delegateEvents({mousedown:"startAction",touchstart:"startAction",[`mousedown .${this.prefixClassName("graph")}`]:"scrollTo",[`touchstart .${this.prefixClassName("graph")}`]:"scrollTo"})}stopListening(){this.scroller?$n.off(this.graphContainer,this.getEventNamespace()):(this.sourceGraph.off("translate",this.onTransform,this),this.sourceGraph.off("scale",this.onTransform,this),this.sourceGraph.off("model:updated",this.onModelUpdated,this)),this.sourceGraph.off("resize",this.updatePaper,this),this.undelegateEvents()}onRemove(){this.stopListening(),this.targetGraph.dispose(!1)}onTransform(t){(t.ui||this.targetGraphTransforming||!this.scroller)&&this.updateViewport()}onModelUpdated(){this.targetGraph.zoomToFit()}updatePaper(t,n){let r,o;typeof t=="object"?(r=t.width,o=t.height):(r=t,o=n);const a=this.sourceGraph.options,i=this.sourceGraph.transform.getScale(),s=this.options.width-2*this.options.padding,l=this.options.height-2*this.options.padding;r/=i.sx,o/=i.sy,this.ratio=Math.min(s/r,l/o);const u=this.ratio,d=a.x*u/i.sx,c=a.y*u/i.sy;return r*=u,o*=u,this.targetGraph.resize(r,o),this.targetGraph.translate(d,c),this.scroller?this.targetGraph.scale(u,u):this.targetGraph.zoomToFit(),this.updateViewport(),this}updateViewport(){const t=this.sourceGraph.transform.getScale(),n=this.targetGraph.transform.getScale();let r=null;this.scroller?r=this.scroller.clientToLocalPoint(0,0):r=this.graph.graphToLocal(0,0);const o=fy(this.targetGraph.container),a=this.targetGraph.translate();a.ty=a.ty||0,this.geometry={top:o.top+r.y*n.sy+a.ty,left:o.left+r.x*n.sx+a.tx,width:this.graphContainer.clientWidth*n.sx/t.sx,height:this.graphContainer.clientHeight*n.sy/t.sy},Pt(this.viewport,this.geometry)}startAction(t){const n=this.normalizeEvent(t),r=n.target===this.zoomHandle?"zooming":"panning",{tx:o,ty:a}=this.sourceGraph.translate(),i={action:r,clientX:n.clientX,clientY:n.clientY,scrollLeft:this.graphContainer.scrollLeft,scrollTop:this.graphContainer.scrollTop,zoom:this.sourceGraph.zoom(),scale:this.sourceGraph.transform.getScale(),geometry:this.geometry,translateX:o,translateY:a};this.targetGraphTransforming=!0,this.delegateDocumentEvents(qi.documentEvents,i)}doAction(t){const n=this.normalizeEvent(t),r=n.clientX,o=n.clientY,a=n.data;switch(a.action){case"panning":{const i=this.sourceGraph.transform.getScale(),s=(r-a.clientX)*i.sx,l=(o-a.clientY)*i.sy;this.scroller?(this.graphContainer.scrollLeft=a.scrollLeft+s/this.ratio,this.graphContainer.scrollTop=a.scrollTop+l/this.ratio):this.sourceGraph.translate(a.translateX-s/this.ratio,a.translateY-l/this.ratio);break}case"zooming":{const i=a.scale,s=a.geometry,l=1+(a.clientX-r)/s.width/i.sx;a.frameId&&cancelAnimationFrame(a.frameId),a.frameId=requestAnimationFrame(()=>{this.sourceGraph.zoom(l*a.zoom,{absolute:!0,minScale:this.options.minScale,maxScale:this.options.maxScale})});break}}}stopAction(){this.undelegateDocumentEvents(),this.targetGraphTransforming=!1}scrollTo(t){const n=this.normalizeEvent(t);let r,o;const a=this.targetGraph.translate();if(a.ty=a.ty||0,n.offsetX==null){const l=Xl(this.targetGraph.container);r=n.pageX-l.left,o=n.pageY-l.top}else r=n.offsetX,o=n.offsetY;const i=(r-a.tx)/this.ratio,s=(o-a.ty)/this.ratio;this.sourceGraph.centerPoint(i,s)}dispose(){this.remove(),yu(this.name)}}J0([ea.dispose()],eh.prototype,"dispose",null);var ja;(function(e){e.root="widget-minimap",e.viewport=`${e.root}-viewport`,e.zoom=`${e.viewport}-zoom`})(ja||(ja={}));var qi;(function(e){e.defaultOptions={width:300,height:200,padding:10,scalable:!0,minScale:.01,maxScale:16,graphOptions:{},createGraph:t=>new Be(t)},e.documentEvents={mousemove:"doAction",touchmove:"doAction",mouseup:"stopAction",touchend:"stopAction"}})(qi||(qi={}));var eE=globalThis&&globalThis.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},tE=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n};class on extends ea{get graph(){return this.options.graph}get model(){return this.graph.model}constructor(t){super(),this.padding={left:0,top:0,right:0,bottom:0},this.options=on.getOptions(t),this.onUpdate=Up(this.onUpdate,200);const n=this.graph.transform.getScale();this.sx=n.sx,this.sy=n.sy;const r=this.options.width||this.graph.options.width,o=this.options.height||this.graph.options.height;this.container=document.createElement("div"),tn(this.container,this.prefixClassName(on.containerClass)),Pt(this.container,{width:r,height:o}),this.options.pageVisible&&tn(this.container,this.prefixClassName(on.pagedClass)),this.options.className&&tn(this.container,this.options.className);const a=this.graph.container;a.parentNode&&Qc(a,this.container),this.content=document.createElement("div"),tn(this.content,this.prefixClassName(on.contentClass)),Pt(this.content,{width:this.graph.options.width,height:this.graph.options.height}),this.background=document.createElement("div"),tn(this.background,this.prefixClassName(on.backgroundClass)),Ba(this.content,this.background),this.options.pageVisible||Ba(this.content,this.graph.view.grid),Ba(this.content,a),oo(this.content,this.container),this.startListening(),this.options.pageVisible||this.graph.grid.update(),this.backgroundManager=new on.Background(this),this.options.autoResize||this.update()}startListening(){const t=this.graph,n=this.model;t.on("scale",this.onScale,this),t.on("resize",this.onResize,this),t.on("before:print",this.storeScrollPosition,this),t.on("before:export",this.storeScrollPosition,this),t.on("after:print",this.restoreScrollPosition,this),t.on("after:export",this.restoreScrollPosition,this),n.on("reseted",this.onUpdate,this),n.on("cell:added",this.onUpdate,this),n.on("cell:removed",this.onUpdate,this),n.on("cell:changed",this.onUpdate,this),this.delegateBackgroundEvents()}stopListening(){const t=this.graph,n=this.model;t.off("scale",this.onScale,this),t.off("resize",this.onResize,this),t.off("beforeprint",this.storeScrollPosition,this),t.off("beforeexport",this.storeScrollPosition,this),t.off("afterprint",this.restoreScrollPosition,this),t.off("afterexport",this.restoreScrollPosition,this),n.off("reseted",this.onUpdate,this),n.off("cell:added",this.onUpdate,this),n.off("cell:removed",this.onUpdate,this),n.off("cell:changed",this.onUpdate,this),this.undelegateBackgroundEvents()}enableAutoResize(){this.options.autoResize=!0}disableAutoResize(){this.options.autoResize=!1}onUpdate(){this.options.autoResize&&this.update()}delegateBackgroundEvents(t){const n=t||py.events;this.delegatedHandlers=Object.keys(n).reduce((r,o)=>{const a=n[o];if(o.indexOf(" ")===-1)if(typeof a=="function")r[o]=a;else{let i=this.graph.view[a];typeof i=="function"&&(i=i.bind(this.graph.view),r[o]=i)}return r},{}),this.onBackgroundEvent=this.onBackgroundEvent.bind(this),Object.keys(this.delegatedHandlers).forEach(r=>{this.delegateEvent(r,{guarded:!1},this.onBackgroundEvent)})}undelegateBackgroundEvents(){Object.keys(this.delegatedHandlers).forEach(t=>{this.undelegateEvent(t,this.onBackgroundEvent)})}onBackgroundEvent(t){let n=!1;const r=t.target;if(this.options.pageVisible)this.options.background?n=this.background===r:n=this.content===r;else{const o=this.graph.view;n=o.background===r||o.grid===r}if(n){const o=this.delegatedHandlers[t.type];typeof o=="function"&&o.apply(this.graph,arguments)}}onResize(){this.cachedCenterPoint&&(this.centerPoint(this.cachedCenterPoint.x,this.cachedCenterPoint.y),this.updatePageBreak())}onScale({sx:t,sy:n,ox:r,oy:o}){this.updateScale(t,n),(r||o)&&(this.centerPoint(r,o),this.updatePageBreak()),typeof this.options.autoResizeOptions=="function"&&this.update()}storeScrollPosition(){this.cachedScrollLeft=this.container.scrollLeft,this.cachedScrollTop=this.container.scrollTop}restoreScrollPosition(){this.container.scrollLeft=this.cachedScrollLeft,this.container.scrollTop=this.cachedScrollTop,this.cachedScrollLeft=null,this.cachedScrollTop=null}storeClientSize(){this.cachedClientSize={width:this.container.clientWidth,height:this.container.clientHeight}}restoreClientSize(){this.cachedClientSize=null}beforeManipulation(){(ki.IS_IE||ki.IS_EDGE)&&Pt(this.container,{visibility:"hidden"})}afterManipulation(){(ki.IS_IE||ki.IS_EDGE)&&Pt(this.container,{visibility:"visible"})}updatePageSize(t,n){t!=null&&(this.options.pageWidth=t),n!=null&&(this.options.pageHeight=n),this.updatePageBreak()}updatePageBreak(){if(this.pageBreak&&this.pageBreak.parentNode&&this.pageBreak.parentNode.removeChild(this.pageBreak),this.pageBreak=null,this.options.pageVisible&&this.options.pageBreak){const t=this.graph.options.width,n=this.graph.options.height,r=this.options.pageWidth*this.sx,o=this.options.pageHeight*this.sy;if(r===0||o===0)return;if(t>r||n>o){let a=!1;const i=document.createElement("div");for(let s=1,l=Math.floor(t/r);s<l;s+=1){const u=document.createElement("div");tn(u,this.prefixClassName("graph-pagebreak-vertical")),Pt(u,{left:s*r}),oo(u,i),a=!0}for(let s=1,l=Math.floor(n/o);s<l;s+=1){const u=document.createElement("div");tn(u,this.prefixClassName("graph-pagebreak-horizontal")),Pt(u,{top:s*o}),oo(u,i),a=!0}a&&(tn(i,this.prefixClassName("graph-pagebreak")),hy(this.graph.view.grid,i),this.pageBreak=i)}}}update(){const t=this.getClientSize();this.cachedCenterPoint=this.clientToLocalPoint(t.width/2,t.height/2);let n=this.options.autoResizeOptions;typeof n=="function"&&(n=lr(n,this,this));const r=Object.assign({gridWidth:this.options.pageWidth,gridHeight:this.options.pageHeight,allowNewOrigin:"negative"},n);this.graph.fitToContent(this.getFitToContentOptions(r))}getFitToContentOptions(t){const n=this.sx,r=this.sy;return t.gridWidth&&(t.gridWidth*=n),t.gridHeight&&(t.gridHeight*=r),t.minWidth&&(t.minWidth*=n),t.minHeight&&(t.minHeight*=r),typeof t.padding=="object"?t.padding={left:(t.padding.left||0)*n,right:(t.padding.right||0)*n,top:(t.padding.top||0)*r,bottom:(t.padding.bottom||0)*r}:typeof t.padding=="number"&&(t.padding*=n),this.options.autoResize||(t.contentArea=Ar.create()),t}updateScale(t,n){const r=this.graph.options,o=t/this.sx,a=n/this.sy;this.sx=t,this.sy=n,this.graph.translate(r.x*o,r.y*a),this.graph.transform.resize(r.width*o,r.height*a)}scrollbarPosition(t,n){if(t==null&&n==null)return{left:this.container.scrollLeft,top:this.container.scrollTop};const r={};return typeof t=="number"&&(r.scrollLeft=t),typeof n=="number"&&(r.scrollTop=n),Kl(this.container,r),this}scrollToPoint(t,n){const r=this.getClientSize(),o=this.graph.matrix(),a={};return typeof t=="number"&&(a.scrollLeft=t-r.width/2+o.e+(this.padding.left||0)),typeof n=="number"&&(a.scrollTop=n-r.height/2+o.f+(this.padding.top||0)),Kl(this.container,a),this}scrollToContent(){const t=this.sx,n=this.sy,r=this.graph.getContentArea().getCenter();return this.scrollToPoint(r.x*t,r.y*n)}scrollToCell(t){const n=this.sx,r=this.sy,o=t.getBBox().getCenter();return this.scrollToPoint(o.x*n,o.y*r)}center(t){return this.centerPoint(t)}centerPoint(t,n,r){const o=this.graph.matrix(),a=o.a,i=o.d,s=-o.e,l=-o.f,u=s+this.graph.options.width,d=l+this.graph.options.height;let c;if(this.storeClientSize(),typeof t=="number"||typeof n=="number"){c=r;const he=this.getVisibleArea().getCenter();typeof t=="number"?t*=a:t=he.x,typeof n=="number"?n*=i:n=he.y}else c=t,t=(s+u)/2,n=(l+d)/2;if(c&&c.padding)return this.positionPoint({x:t,y:n},"50%","50%",c);const f=this.getPadding(),h=this.getClientSize(),m=h.width/2,v=h.height/2,b=m-f.left-t+s,w=m-f.right+t-u,L=v-f.top-n+l,z=v-f.bottom+n-d;this.addPadding(Math.max(b,0),Math.max(w,0),Math.max(L,0),Math.max(z,0));const K=this.scrollToPoint(t,n);return this.restoreClientSize(),K}centerContent(t){return this.positionContent("center",t)}centerCell(t,n){return this.positionCell(t,"center",n)}positionContent(t,n){const r=this.graph.getContentArea(n);return this.positionRect(r,t,n)}positionCell(t,n,r){const o=t.getBBox();return this.positionRect(o,n,r)}positionRect(t,n,r){const o=Ar.create(t);switch(n){case"center":return this.positionPoint(o.getCenter(),"50%","50%",r);case"top":return this.positionPoint(o.getTopCenter(),"50%",0,r);case"top-right":return this.positionPoint(o.getTopRight(),"100%",0,r);case"right":return this.positionPoint(o.getRightMiddle(),"100%","50%",r);case"bottom-right":return this.positionPoint(o.getBottomRight(),"100%","100%",r);case"bottom":return this.positionPoint(o.getBottomCenter(),"50%","100%",r);case"bottom-left":return this.positionPoint(o.getBottomLeft(),0,"100%",r);case"left":return this.positionPoint(o.getLeftMiddle(),0,"50%",r);case"top-left":return this.positionPoint(o.getTopLeft(),0,0,r);default:return this}}positionPoint(t,n,r,o={}){const{padding:a}=o,i=tE(o,["padding"]),s=Rl(a),l=Ar.fromSize(this.getClientSize()),u=l.clone().moveAndExpand({x:s.left,y:s.top,width:-s.right-s.left,height:-s.top-s.bottom});n=Zc(n,Math.max(0,u.width)),n<0&&(n=u.width+n),r=Zc(r,Math.max(0,u.height)),r<0&&(r=u.height+r);const d=u.getTopLeft().translate(n,r),c=l.getCenter().diff(d),f=this.zoom(),h=c.scale(1/f,1/f),m=Mo.create(t).translate(h);return this.centerPoint(m.x,m.y,i)}zoom(t,n){if(t==null)return this.sx;n=n||{};let r,o;const a=this.getClientSize(),i=this.clientToLocalPoint(a.width/2,a.height/2);let s=t,l=t;if(n.absolute||(s+=this.sx,l+=this.sy),n.scaleGrid&&(s=Math.round(s/n.scaleGrid)*n.scaleGrid,l=Math.round(l/n.scaleGrid)*n.scaleGrid),n.maxScale&&(s=Math.min(n.maxScale,s),l=Math.min(n.maxScale,l)),n.minScale&&(s=Math.max(n.minScale,s),l=Math.max(n.minScale,l)),s=this.graph.transform.clampScale(s),l=this.graph.transform.clampScale(l),n.center){const u=s/this.sx,d=l/this.sy;r=n.center.x-(n.center.x-i.x)/u,o=n.center.y-(n.center.y-i.y)/d}else r=i.x,o=i.y;return this.beforeManipulation(),this.graph.transform.scale(s,l),this.centerPoint(r,o),this.afterManipulation(),this}zoomToRect(t,n={}){const r=Ar.create(t),o=this.graph;if(n.contentArea=r,n.viewportArea==null){const i=this.container.getBoundingClientRect();n.viewportArea={x:o.options.x,y:o.options.y,width:i.width,height:i.height}}this.beforeManipulation(),o.transform.scaleContentToFitImpl(n,!1);const a=r.getCenter();return this.centerPoint(a.x,a.y),this.afterManipulation(),this}zoomToFit(t={}){return this.zoomToRect(this.graph.getContentArea(t),t)}transitionToPoint(t,n,r){typeof t=="object"?(r=n,n=t.y,t=t.x):n=n,r==null&&(r={});let o,a;const i=this.sx,s=Math.max(r.scale||i,1e-6),l=this.getClientSize(),u=new Mo(t,n),d=this.clientToLocalPoint(l.width/2,l.height/2);if(i===s){const f=d.diff(u).scale(i,i).round();o=`translate(${f.x}px,${f.y}px)`}else{const f=s/(i-s)*u.distance(d),h=d.clone().move(u,f),m=this.localToBackgroundPoint(h).round();o=`scale(${s/i})`,a=`${m.x}px ${m.y}px`}const c=r.onTransitionEnd;return tn(this.container,on.transitionClassName),$n.off(this.content,on.transitionEventName),$n.on(this.content,on.transitionEventName,f=>{this.syncTransition(s,{x:t,y:n}),typeof c=="function"&&lr(c,this,f.originalEvent)}),Pt(this.content,{transform:o,transformOrigin:a,transition:"transform",transitionDuration:r.duration||"1s",transitionDelay:r.delay,transitionTimingFunction:r.timing}),this}syncTransition(t,n){return this.beforeManipulation(),this.graph.scale(t),this.removeTransition(),this.centerPoint(n.x,n.y),this.afterManipulation(),this}removeTransition(){return Va(this.container,on.transitionClassName),$n.off(this.content,on.transitionEventName),Pt(this.content,{transform:"",transformOrigin:"",transition:"",transitionDuration:"",transitionDelay:"",transitionTimingFunction:""}),this}transitionToRect(t,n={}){const r=Ar.create(t),o=n.maxScale||1/0,a=n.minScale||Number.MIN_VALUE,i=n.scaleGrid||null,s=n.visibility||1,l=n.center?Mo.create(n.center):r.getCenter(),u=this.getClientSize(),d=u.width*s,c=u.height*s;let f=new Ar(l.x-d/2,l.y-c/2,d,c).getMaxUniformScaleToFit(r,l);return f=Math.min(f,o),i&&(f=Math.floor(f/i)*i),f=Math.max(a,f),this.transitionToPoint(l,Object.assign({scale:f},n))}startPanning(t){const n=this.normalizeEvent(t);this.clientX=n.clientX,this.clientY=n.clientY,this.trigger("pan:start",{e:n}),$n.on(document.body,{"mousemove.panning touchmove.panning":this.pan.bind(this),"mouseup.panning touchend.panning":this.stopPanning.bind(this),"mouseleave.panning":this.stopPanning.bind(this)}),$n.on(window,"mouseup.panning",this.stopPanning.bind(this))}pan(t){const n=this.normalizeEvent(t),r=n.clientX-this.clientX,o=n.clientY-this.clientY;this.container.scrollTop-=o,this.container.scrollLeft-=r,this.clientX=n.clientX,this.clientY=n.clientY,this.trigger("panning",{e:n})}stopPanning(t){$n.off(document.body,".panning"),$n.off(window,".panning"),this.trigger("pan:stop",{e:t})}clientToLocalPoint(t,n){let r=typeof t=="object"?t.x:t,o=typeof t=="object"?t.y:n;const a=this.graph.matrix();return r+=this.container.scrollLeft-this.padding.left-a.e,o+=this.container.scrollTop-this.padding.top-a.f,new Mo(r/a.a,o/a.d)}localToBackgroundPoint(t,n){const r=typeof t=="object"?Mo.create(t):new Mo(t,n),o=this.graph.matrix(),a=this.padding;return Jc.transformPoint(r,o).translate(a.left,a.top)}resize(t,n){let r=t??this.container.offsetWidth,o=n??this.container.offsetHeight;typeof r=="number"&&(r=Math.round(r)),typeof o=="number"&&(o=Math.round(o)),this.options.width=r,this.options.height=o,Pt(this.container,{width:r,height:o}),this.update()}getClientSize(){return this.cachedClientSize?this.cachedClientSize:{width:this.container.clientWidth,height:this.container.clientHeight}}autoScroll(t,n){const o=this.container,a=o.getBoundingClientRect();let i=0,s=0;return t<=a.left+10&&(i=-10),n<=a.top+10&&(s=-10),t>=a.right-10&&(i=10),n>=a.bottom-10&&(s=10),i!==0&&(o.scrollLeft+=i),s!==0&&(o.scrollTop+=s),{scrollerX:i,scrollerY:s}}addPadding(t,n,r,o){let a=this.getPadding();this.padding={left:Math.round(a.left+(t||0)),top:Math.round(a.top+(r||0)),bottom:Math.round(a.bottom+(o||0)),right:Math.round(a.right+(n||0))},a=this.padding,Pt(this.content,{width:a.left+this.graph.options.width+a.right,height:a.top+this.graph.options.height+a.bottom});const i=this.graph.container;return i.style.left=`${this.padding.left}px`,i.style.top=`${this.padding.top}px`,this}getPadding(){const t=this.options.padding;return typeof t=="function"?Rl(lr(t,this,this)):Rl(t)}getVisibleArea(){const t=this.graph.matrix(),n=this.getClientSize(),r={x:this.container.scrollLeft||0,y:this.container.scrollTop||0,width:n.width,height:n.height},o=Jc.transformRectangle(r,t.inverse());return o.x-=(this.padding.left||0)/this.sx,o.y-=(this.padding.top||0)/this.sy,o}isCellVisible(t,n={}){const r=t.getBBox(),o=this.getVisibleArea();return n.strict?o.containsRect(r):o.isIntersectWithRect(r)}isPointVisible(t){return this.getVisibleArea().containsPoint(t)}lock(){return Pt(this.container,{overflow:"hidden"}),this}unlock(){return Pt(this.container,{overflow:"scroll"}),this}onRemove(){this.stopListening()}dispose(){Qc(this.container,this.graph.container),this.remove()}}eE([ea.dispose()],on.prototype,"dispose",null);(function(e){class t extends my{get elem(){return this.scroller.background}constructor(r){super(r.graph),this.scroller=r,r.options.background&&this.draw(r.options.background)}init(){this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this)}updateBackgroundOptions(r){this.scroller.options.background=r}}e.Background=t})(on||(on={}));(function(e){e.containerClass="graph-scroller",e.panningClass=`${e.containerClass}-panning`,e.pannableClass=`${e.containerClass}-pannable`,e.pagedClass=`${e.containerClass}-paged`,e.contentClass=`${e.containerClass}-content`,e.backgroundClass=`${e.containerClass}-background`,e.transitionClassName="transition-in-progress",e.transitionEventName="transitionend.graph-scroller-transition",e.defaultOptions={padding(){const n=this.getClientSize(),r=Math.max(this.options.minVisibleWidth||0,1)||1,o=Math.max(this.options.minVisibleHeight||0,1)||1,a=Math.max(n.width-r,0),i=Math.max(n.height-o,0);return{left:a,top:i,right:a,bottom:i}},minVisibleWidth:50,minVisibleHeight:50,pageVisible:!1,pageBreak:!1,autoResize:!0};function t(n){const r=Ly({},e.defaultOptions,n);r.pageWidth==null&&(r.pageWidth=n.graph.options.width),r.pageHeight==null&&(r.pageHeight=n.graph.options.height);const o=n.graph.options;return o.background&&r.enabled&&r.background==null&&(r.background=o.background,n.graph.background.clear()),r}e.getOptions=t})(on||(on={}));const nE=`.x6-graph-scroller {
  position: relative;
  box-sizing: border-box;
  overflow: scroll;
  outline: none;
}
.x6-graph-scroller-content {
  position: relative;
}
.x6-graph-scroller-background {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-graph-scroller .x6-graph {
  position: absolute;
  display: inline-block;
  margin: 0;
  box-shadow: none;
}
.x6-graph-scroller .x6-graph > svg {
  display: block;
}
.x6-graph-scroller.x6-graph-scroller-paged .x6-graph {
  box-shadow: 0 0 4px 0 #eee;
}
.x6-graph-scroller.x6-graph-scroller-pannable[data-panning='false'] {
  cursor: grab;
}
.x6-graph-scroller.x6-graph-scroller-pannable[data-panning='true'] {
  cursor: grabbing;
  user-select: none;
}
.x6-graph-pagebreak {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-graph-pagebreak-vertical {
  position: absolute;
  top: 0;
  bottom: 0;
  box-sizing: border-box;
  width: 1px;
  border-left: 1px dashed #bdbdbd;
}
.x6-graph-pagebreak-horizontal {
  position: absolute;
  right: 0;
  left: 0;
  box-sizing: border-box;
  height: 1px;
  border-top: 1px dashed #bdbdbd;
}
`;Be.prototype.lockScroller=function(){const e=this.getPlugin("scroller");return e&&e.lockScroller(),this};Be.prototype.unlockScroller=function(){const e=this.getPlugin("scroller");return e&&e.unlockScroller(),this};Be.prototype.updateScroller=function(){const e=this.getPlugin("scroller");return e&&e.updateScroller(),this};Be.prototype.getScrollbarPosition=function(){const e=this.getPlugin("scroller");return e?e.getScrollbarPosition():{left:0,top:0}};Be.prototype.setScrollbarPosition=function(e,t){const n=this.getPlugin("scroller");return n&&n.setScrollbarPosition(e,t),this};var rE=globalThis&&globalThis.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};class th extends tr{get pannable(){return this.options?typeof this.options.pannable=="object"?this.options.pannable.enabled:!!this.options.pannable:!1}get container(){return this.scrollerImpl.container}constructor(t={}){super(),this.name="scroller",this.options=t,bu(this.name,nE)}init(t){this.graph=t;const n=on.getOptions(Object.assign(Object.assign({enabled:!0},this.options),{graph:t}));this.options=n,this.scrollerImpl=new on(n),this.setup(),this.startListening(),this.updateClassName(),this.scrollerImpl.center()}resize(t,n){this.scrollerImpl.resize(t,n)}resizePage(t,n){this.scrollerImpl.updatePageSize(t,n)}zoom(t,n){return typeof t>"u"?this.scrollerImpl.zoom():(this.scrollerImpl.zoom(t,n),this)}zoomTo(t,n={}){return this.scrollerImpl.zoom(t,Object.assign(Object.assign({},n),{absolute:!0})),this}zoomToRect(t,n={}){return this.scrollerImpl.zoomToRect(t,n),this}zoomToFit(t={}){return this.scrollerImpl.zoomToFit(t),this}center(t){return this.centerPoint(t)}centerPoint(t,n,r){return this.scrollerImpl.centerPoint(t,n,r),this}centerContent(t){return this.scrollerImpl.centerContent(t),this}centerCell(t,n){return this.scrollerImpl.centerCell(t,n),this}positionPoint(t,n,r,o={}){return this.scrollerImpl.positionPoint(t,n,r,o),this}positionRect(t,n,r){return this.scrollerImpl.positionRect(t,n,r),this}positionCell(t,n,r){return this.scrollerImpl.positionCell(t,n,r),this}positionContent(t,n){return this.scrollerImpl.positionContent(t,n),this}drawBackground(t,n){return(this.graph.options.background==null||!n)&&this.scrollerImpl.backgroundManager.draw(t),this}clearBackground(t){return(this.graph.options.background==null||!t)&&this.scrollerImpl.backgroundManager.clear(),this}isPannable(){return this.pannable}enablePanning(){this.pannable||(this.options.pannable=!0,this.updateClassName())}disablePanning(){this.pannable&&(this.options.pannable=!1,this.updateClassName())}togglePanning(t){return t==null?this.isPannable()?this.disablePanning():this.enablePanning():t!==this.isPannable()&&(t?this.enablePanning():this.disablePanning()),this}lockScroller(){return this.scrollerImpl.lock(),this}unlockScroller(){return this.scrollerImpl.unlock(),this}updateScroller(){return this.scrollerImpl.update(),this}getScrollbarPosition(){return this.scrollerImpl.scrollbarPosition()}setScrollbarPosition(t,n){return this.scrollerImpl.scrollbarPosition(t,n),this}scrollToPoint(t,n){return this.scrollerImpl.scrollToPoint(t,n),this}scrollToContent(){return this.scrollerImpl.scrollToContent(),this}scrollToCell(t){return this.scrollerImpl.scrollToCell(t),this}transitionToPoint(t,n,r){return this.scrollerImpl.transitionToPoint(t,n,r),this}transitionToRect(t,n={}){return this.scrollerImpl.transitionToRect(t,n),this}enableAutoResize(){this.scrollerImpl.enableAutoResize()}disableAutoResize(){this.scrollerImpl.disableAutoResize()}autoScroll(t,n){return this.scrollerImpl.autoScroll(t,n)}clientToLocalPoint(t,n){return this.scrollerImpl.clientToLocalPoint(t,n)}setup(){this.scrollerImpl.on("*",(t,n)=>{this.trigger(t,n)})}startListening(){let t=[];const n=this.options.pannable;typeof n=="object"?t=n.eventTypes||[]:t=["leftMouseDown"],t.includes("leftMouseDown")&&(this.graph.on("blank:mousedown",this.preparePanning,this),this.graph.on("node:unhandled:mousedown",this.preparePanning,this),this.graph.on("edge:unhandled:mousedown",this.preparePanning,this)),t.includes("rightMouseDown")&&(this.onRightMouseDown=this.onRightMouseDown.bind(this),$n.on(this.scrollerImpl.container,"mousedown",this.onRightMouseDown))}stopListening(){let t=[];const n=this.options.pannable;typeof n=="object"?t=n.eventTypes||[]:t=["leftMouseDown"],t.includes("leftMouseDown")&&(this.graph.off("blank:mousedown",this.preparePanning,this),this.graph.off("node:unhandled:mousedown",this.preparePanning,this),this.graph.off("edge:unhandled:mousedown",this.preparePanning,this)),t.includes("rightMouseDown")&&$n.off(this.scrollerImpl.container,"mousedown",this.onRightMouseDown)}onRightMouseDown(t){t.button===2&&this.allowPanning(t,!0)&&(this.updateClassName(!0),this.scrollerImpl.startPanning(t),this.scrollerImpl.once("pan:stop",()=>this.updateClassName(!1)))}preparePanning({e:t}){const n=this.allowPanning(t,!0),r=this.graph.getPlugin("selection"),o=r&&r.allowRubberband(t,!0);(n||this.allowPanning(t)&&!o)&&(this.updateClassName(!0),this.scrollerImpl.startPanning(t),this.scrollerImpl.once("pan:stop",()=>this.updateClassName(!1)))}allowPanning(t,n){return this.pannable&&Hl.isMatch(t,this.options.modifiers,n)}updateClassName(t){const n=this.scrollerImpl.container,r=Pp.prefix("graph-scroller-pannable");this.pannable?(tn(n,r),n.dataset.panning=(!!t).toString()):Va(n,r)}dispose(){this.scrollerImpl.dispose(),this.stopListening(),this.off(),yu(this.name)}}rE([tr.dispose()],th.prototype,"dispose",null);function oE(e){const t=we();return e.use(new qo({enabled:!0,beforeAddCommand(n,r){const o=r;return!(n==="cell:change:*"&&["attrs","ports"].includes(o.key)||["data","tools"].includes(o.key))}})),e.use(new vy({enabled:!0})),e.use(new _y({enabled:!0,global:!0})),e.use(new Qo({enabled:!0,multiple:!0,rubberband:!0,movable:!0,showNodeSelectionBox:!0,showEdgeSelectionBox:!0,pointerEvents:"none"})),e.use(new th({enabled:!0,autoResize:!0,padding:{top:50,right:50,bottom:50,left:50}})),e.use(new Jp({enabled:!0})),e.use(new eh({container:document.getElementById("minimap"),width:200,height:100})),t.value=new by({target:e,scaled:!1,dndContainer:document.getElementById("dndContainer"),getDragNode:n=>n.clone({keepId:!0}),getDropNode:n=>n.clone({keepId:!0})}),e.bindKey(["backspace","Delete"],()=>{const n=e.getSelectedCells();return n.length&&e.removeCells(n),!1}),e.bindKey(["meta+z","ctrl+z"],()=>(e.canUndo()&&e.undo(),!1)),e.bindKey(["meta+y","ctrl+y"],()=>(e.canRedo()&&e.redo(),!1)),e.on("edge:connected",({edge:n,currentCell:r})=>{const o=`edge_${Xi()}`;e.updateCellId(n,o)}),{dnd:t}}function aE(e){return Mn({scene:e.scene,mode:e.mode,viewMode:e.viewMode,dataDealMode:e.dataDealMode,dataId:e.dataId,appId:e.appId,entryId:e.entryId,graphInstance:void 0,TeleportContainer:Hi(yy()),dnd:void 0,selectNode:void 0,renderGraph(n){const r=new Be({container:n.container,virtual:!0,interacting:e.mode!==Go.view,mousewheel:gy(),background:{color:"#fff"},connecting:Ey(),highlighting:Ty(),autoResize:!0});this.graphInstance=r,x0(),e.mode===Go.designer?e.scene===Mp.dataFactory&&((n.cells??[]).length<=0?this.renderData():ef(r,{cells:n.cells??[]})):e.mode===Go.view&&ef(r,{cells:n.cells??[]});const{dnd:o}=oE(r);this.dnd=o.value,Iy(this)},renderData(){var a;(a=this.graphInstance)==null||a.resetCells([]);const n=Zl(Ct.dataInput),r=Zl(Ct.dataOutput);[n,r].forEach((i,s)=>{var u,d;const l=(u=this.graphInstance)==null?void 0:u.createNode({...i,position:{x:100+s*650,y:100},id:`${i==null?void 0:i.shape}_${Xi()}`,height:this.viewMode===zl.detail?Fn*2:Fn,data:{...i==null?void 0:i.data,appId:this.appId??(i==null?void 0:i.data.appId)??""}});(d=this.graphInstance)==null||d.addNode(l)})},dargInNode(n,r){var i,s;if(![Go.designer].includes(e.mode))return;const a=(i=this.graphInstance)==null?void 0:i.createNode({...n,id:`${n.shape}_${Xi()}`,height:e.viewMode===zl.detail?Fn*2:Fn,data:{...n.data,appId:e.appId??n.data.appId??""}});(s=this.dnd)==null||s.start(a,r)},getGraphData(){var n;return(n=this.graphInstance)==null?void 0:n.toJSON()},clearGraphData(){var n;(n=this.graphInstance)==null||n.resetCells([])}})}const iE=Ce({__name:"DndPanel",props:{scene:{}},emits:["dargInNode"],setup(e,{emit:t}){var c,f;const n=e,r=t,o=X0(n.scene),a=h=>fn(h.shape,"icon"),i=h=>fn(h.shape,"name"),s=(h,m)=>{if(m.shape===Ct.dataOutput){if(u.value)return;r("dargInNode",m,h)}else r("dargInNode",m,h)},l=$t();Ln(()=>{d()});const u=we(!1);(c=l.graphInstance)==null||c.on("node:added",({cell:h,options:m})=>{d()}),(f=l.graphInstance)==null||f.on("node:removed",({cell:h,options:m})=>{d()});const d=()=>{var v;const m=(((v=l.graphInstance)==null?void 0:v.getNodes())??[]).some(b=>b.shape===Ct.dataOutput);u.value=m};return(h,m)=>{const v=ta;return D(),ee(v,{class:"dnd_panel"},{default:F(()=>[(D(!0),Ie(dt,null,It(x(o),b=>(D(),Ie("div",{class:"dnd_panel_item",key:b.id},[Te("div",{class:"dnd_panel_item_title"},mn(b.title),1),Te("ul",{class:"dnd_panel_item_ul"},[(D(!0),Ie(dt,null,It(b.nodes,w=>(D(),Ie("li",{class:Yo(["dnd_panel_item_node",{"is-disabled":w.shape===x(Ct).dataOutput&&u.value}]),key:w.shape,onMousedown:L=>s(L,w)},[Te("span",null,[E(yn,{"icon-class":a(w)},null,8,["icon-class"])]),Te("span",{class:"dnd_panel_item_node_name"},mn(i(w)),1)],42,["onMousedown"]))),128))])]))),128))]),_:1})}}});const sE=Tt(iE,[["__scopeId","data-v-ba51df60"]]),lE=Ce({__name:"ReUndoBtn",setup(e){var i;const t=$t(),n=we(!1),r=we(!1);(i=t.graphInstance)==null||i.on("history:change",()=>{var u,d;const s=(u=t.graphInstance)==null?void 0:u.canRedo(),l=(d=t.graphInstance)==null?void 0:d.canUndo();r.value=!!s,n.value=!!l});const o=E(yn,{style:"transform: rotateY(180deg)",iconClass:"allowRevoke"},null),a=E(yn,{iconClass:"allowRevoke"},null);return(s,l)=>{const u=Lt,d=na;return D(),Ie(dt,null,[E(d,{effect:"dark",placement:"bottom-start",content:"撤销 (Ctrl + Z)"},{default:F(()=>[E(u,{class:"btn",icon:x(a),text:"",size:"default",title:"撤销",disabled:!n.value,onClick:l[0]||(l[0]=io(c=>{var f;return(f=x(t).graphInstance)==null?void 0:f.undo()},["stop"]))},null,8,["icon","disabled"])]),_:1}),E(d,{effect:"dark",placement:"bottom-start",content:"重做 (Ctrl + Y)"},{default:F(()=>[E(u,{class:"btn",icon:x(o),text:"",size:"default",disabled:!r.value,onClick:l[1]||(l[1]=io(c=>{var f;return(f=x(t).graphInstance)==null?void 0:f.redo()},["stop"]))},null,8,["icon","disabled"])]),_:1})],64)}}});const uE=Tt(lE,[["__scopeId","data-v-46fa89f1"]]);class dE{constructor(){this.nodes=[],this.edges=[],this.combos=[],this.comboEdges=[],this.hiddenNodes=[],this.hiddenEdges=[],this.hiddenCombos=[],this.vedges=[],this.positions=[],this.destroyed=!1,this.onLayoutEnd=()=>{}}layout(t){return this.init(t),this.execute(!0)}init(t){this.nodes=t.nodes||[],this.edges=t.edges||[],this.combos=t.combos||[],this.comboEdges=t.comboEdges||[],this.hiddenNodes=t.hiddenNodes||[],this.hiddenEdges=t.hiddenEdges||[],this.hiddenCombos=t.hiddenCombos||[],this.vedges=t.vedges||[]}execute(t){}executeWithWorker(){}getDefaultCfg(){return{}}updateCfg(t){t&&Object.assign(this,t)}getType(){return"base"}destroy(){this.nodes=null,this.edges=null,this.combos=null,this.positions=null,this.destroyed=!0}}const cE=e=>typeof e=="string",Ef=Array.isArray,Qi=e=>typeof e=="number",nh=e=>e!==null&&typeof e=="object",Zi=e=>{if(e===null)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const t=[];return e.forEach(n=>{t.push(n)}),t.map(n=>Zi(n))}if(typeof e=="object"&&Object.keys(e).length){const t=Object.assign({},e);return Object.keys(t).forEach(n=>{t[n]=Zi(t[n])}),t}return e},Do=(e,t)=>{const n=e[t];return nh(n)?n.cell:n},Tf=(e,t,n)=>{let r;return n?r=n:Qi(e)?r=()=>e:r=()=>t,r},fE=(e,t)=>{if(e!=="next"&&e!=="prev")return t},If=e=>{e.prev.next=e.next,e.next.prev=e.prev,delete e.next,delete e.prev};let pE=class{constructor(){const t={};t.prev=t,t.next=t.prev,this.shortcut=t}dequeue(){const t=this.shortcut,n=t.prev;if(n&&n!==t)return If(n),n}enqueue(t){const n=this.shortcut;t.prev&&t.next&&If(t),t.next=n.next,n.next.prev=t,n.next=t,t.prev=n}toString(){const t=[],n=this.shortcut;let r=n.prev;for(;r!==n;)t.push(JSON.stringify(r,fE)),r=r==null?void 0:r.prev;return`[${t.join(", ")}]`}};var zo;(function(e){e.DEFAULT_EDGE_NAME="\0",e.GRAPH_NODE="\0",e.EDGE_KEY_DELIM=""})(zo||(zo={}));function Sf(e,t){var n=e.get(t)||0;e.set(t,n+1)}function wf(e,t){var n=e.get(t);n!==void 0&&(n=n-1,n>0?e.set(t,n):e.delete(t))}function rh(e,t,n,r){var o=String(t),a=String(n);if(!e&&o>a){var i=o;o=a,a=i}return o+zo.EDGE_KEY_DELIM+a+zo.EDGE_KEY_DELIM+(r===void 0?zo.DEFAULT_EDGE_NAME:r)}function Af(e,t,n,r){var o=String(t),a=String(n),i={v:t,w:n};if(!e&&o>a){var s=i.v;i.v=i.w,i.w=s}return r!==void 0&&(i.name=r),i}function Cl(e,t){return rh(e,t.v,t.w,t.name)}function xf(e){return typeof e=="function"}var hE=function(t){return t.nodes().map(function(n){var r=t.node(n),o=t.parent(n),a={id:n,value:r,parent:o};return a.value===void 0&&delete a.value,a.parent===void 0&&delete a.parent,a})},mE=function(t){return t.edges().map(function(n){var r=t.edge(n),o={v:n.v,w:n.w,value:r,name:n.name};return o.name===void 0&&delete o.name,o.value===void 0&&delete o.value,o})},vE=function(t){var n={options:{directed:t.isDirected(),multigraph:t.isMultigraph(),compound:t.isCompound()},nodes:hE(t),edges:mE(t),value:t.graph()};return n.value===void 0&&delete n.value,n},_E=function(t){var n=new ia(t.options);return t.value!==void 0&&n.setGraph(t.value),t.nodes.forEach(function(r){n.setNode(r.id,r.value),r.parent&&n.setParent(r.id,r.parent)}),t.edges.forEach(function(r){n.setEdge(r.v,r.w,r.value,r.name)}),n};function Rf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Cf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Rf(Object(n),!0).forEach(function(r){bE(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rf(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function bE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yE(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Nf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gE(e,t,n){return t&&Nf(e.prototype,t),n&&Nf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var EE={compound:!1,multigraph:!1,directed:!0},ia=function(){function e(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};yE(this,e),this.directed=!0,this.multigraph=!1,this.compound=!1,this.GRAPH_NODE=zo.GRAPH_NODE,this.label=void 0,this.nodeCountNum=0,this.edgeCountNum=0,this.defaultNodeLabelFn=function(){},this.defaultEdgeLabelFn=function(){},this.parentMap=void 0,this.childrenMap=void 0,this.nodesLabelMap=new Map,this.inEdgesMap=new Map,this.outEdgesMap=new Map,this.predecessorsMap=new Map,this.successorsMap=new Map,this.edgesMap=new Map,this.edgesLabelsMap=new Map,this.isDirected=function(){return t.directed},this.isMultigraph=function(){return t.multigraph},this.isCompound=function(){return t.compound},this.setGraph=function(o){return t.label=o,t},this.graph=function(){return t.label},this.setDefaultNodeLabel=function(o){return xf(o)?t.defaultNodeLabelFn=o:t.defaultNodeLabelFn=function(){return o},t},this.nodeCount=function(){return t.nodeCountNum},this.node=function(o){return t.nodesLabelMap.get(o)},this.nodes=function(){return Array.from(t.nodesLabelMap.keys())},this.sources=function(){return t.nodes().filter(function(o){var a;return!(!((a=t.inEdgesMap.get(o))===null||a===void 0)&&a.size)})},this.sinks=function(){return t.nodes().filter(function(o){var a;return!(!((a=t.outEdgesMap.get(o))===null||a===void 0)&&a.size)})},this.setNodes=function(o,a){return o.map(function(i){return t.setNode(i,a)}),t},this.hasNode=function(o){return t.nodesLabelMap.has(o)},this.checkCompound=function(){if(!t.isCompound())throw new Error("Cannot construct parent-children relations in a non-compound graph")},this.parent=function(o){if(t.isCompound()){var a,i=(a=t.parentMap)===null||a===void 0?void 0:a.get(o);if(i!==t.GRAPH_NODE)return i}},this.removeFromParentsChildList=function(o){var a=t.parentMap.get(o);t.childrenMap.get(a).delete(o)},this.setParent=function(o,a){var i,s;t.checkCompound();for(var l=a===void 0?t.GRAPH_NODE:a,u=t.parent(l);u;){if(o===u)throw new Error("Setting "+a+" as parent of "+o+" would create a cycle");u=t.parent(u)}a&&t.setNode(a),t.setNode(o),t.removeFromParentsChildList(o),(i=t.parentMap)===null||i===void 0||i.set(o,l);var d=t.childrenMap.get(l);return d.set(o,!0),(s=t.childrenMap)===null||s===void 0||s.set(l,d),t},this.children=function(o){var a=o===void 0?t.GRAPH_NODE:o;if(t.isCompound()){var i,s=(i=t.childrenMap)===null||i===void 0?void 0:i.get(a);return s?Array.from(s.keys()):void 0}if(a===t.GRAPH_NODE)return t.nodes();if(o&&t.hasNode(o))return[]},this.predecessors=function(o){var a=t.predecessorsMap.get(o);return a?Array.from(a.keys()):void 0},this.successors=function(o){var a=t.successorsMap.get(o);return a?Array.from(a.keys()):void 0},this.neighbors=function(o){var a;if(t.hasNode(o))return Array.from(new Set((a=t.predecessors(o))===null||a===void 0?void 0:a.concat(t.successors(o))))},this.isLeaf=function(o){var a;if(t.isDirected()){var i;return!(!((i=t.successors(o))===null||i===void 0)&&i.length)}return!(!((a=t.neighbors(o))===null||a===void 0)&&a.length)},this.filterNodes=function(o){var a=t.directed,i=t.multigraph,s=t.compound,l=new e({directed:a,multigraph:i,compound:s});if(l.setGraph(t.graph()),t.nodes().forEach(function(d){o(d)&&l.setNode(d,t.node(d))}),t.edges().forEach(function(d){l.hasNode(d.v)&&l.hasNode(d.w)&&l.setEdgeObj(d,t.edge(d))}),s){var u=function(c){for(var f=t.parent(c);f!==void 0&&!l.hasNode(f);)f=t.parent(f);return f};l.nodes().forEach(function(d){l.setParent(d,u(d))})}return l},this.setDefaultEdgeLabel=function(o){return xf(o)?t.defaultEdgeLabelFn=o:t.defaultEdgeLabelFn=function(){return o},t},this.edgeCount=function(){return t.edgeCountNum},this.setEdgeObj=function(o,a){return t.setEdge(o.v,o.w,a,o.name)},this.setPath=function(o,a){return o.reduce(function(i,s){return t.setEdge(i,s,a),s}),t},this.edgeFromArgs=function(o,a,i){return t.edge({v:o,w:a,name:i})},this.edge=function(o){return t.edgesLabelsMap.get(Cl(t.isDirected(),o))},this.hasEdge=function(o,a,i){return t.edgesLabelsMap.has(Cl(t.isDirected(),{v:o,w:a,name:i}))},this.removeEdgeObj=function(o){var a=o.v,i=o.w,s=o.name;return t.removeEdge(a,i,s)},this.edges=function(){return Array.from(t.edgesMap.values())},this.inEdges=function(o,a){var i=t.inEdgesMap.get(o);if(i)return Array.from(i.values()).filter(function(s){return!a||s.v===a})},this.outEdges=function(o,a){var i=t.outEdgesMap.get(o);if(i)return Array.from(i.values()).filter(function(s){return!a||s.w===a})},this.nodeEdges=function(o,a){var i;if(t.hasNode(o))return(i=t.inEdges(o,a))===null||i===void 0?void 0:i.concat(t.outEdges(o,a))},this.toJSON=function(){return vE(t)},this.nodeInDegree=function(o){var a=t.inEdgesMap.get(o);return a?a.size:0},this.nodeOutDegree=function(o){var a=t.outEdgesMap.get(o);return a?a.size:0},this.nodeDegree=function(o){return t.nodeInDegree(o)+t.nodeOutDegree(o)},this.source=function(o){return o.v},this.target=function(o){return o.w};var r=Cf(Cf({},EE),n);this.compound=r.compound,this.directed=r.directed,this.multigraph=r.multigraph,this.compound&&(this.parentMap=new Map,this.childrenMap=new Map)}return gE(e,[{key:"setNode",value:function(n,r){var o=this.nodesLabelMap,a=this.defaultNodeLabelFn,i=this.isCompound,s=this.parentMap,l=this.childrenMap,u=this.inEdgesMap,d=this.outEdgesMap,c=this.predecessorsMap,f=this.successorsMap;if(o.has(n))return r!==void 0&&o.set(n,r),this;if(o.set(n,r||a(n)),i()){var h;s==null||s.set(n,this.GRAPH_NODE),l==null||l.set(n,new Map),l!=null&&l.has(this.GRAPH_NODE)||l==null||l.set(this.GRAPH_NODE,new Map),l==null||(h=l.get(this.GRAPH_NODE))===null||h===void 0||h.set(n,!0)}return[u,d,c,f].forEach(function(m){return m.set(n,new Map)}),this.nodeCountNum+=1,this}},{key:"removeNode",value:function(n){var r=this;if(this.hasNode(n)){var o=function(b){r.removeEdge(b.v,b.w,b.name)},a=this.inEdgesMap,i=this.outEdgesMap,s=this.predecessorsMap,l=this.successorsMap,u=this.nodesLabelMap;if(this.isCompound()){var d,c,f;this.removeFromParentsChildList(n),(d=this.parentMap)===null||d===void 0||d.delete(n),(c=this.children(n))===null||c===void 0||c.forEach(function(v){return r.setParent(v)}),(f=this.childrenMap)===null||f===void 0||f.delete(n)}var h=a.get(n),m=i.get(n);Array.from(h.values()).forEach(function(v){return o(v)}),Array.from(m.values()).forEach(function(v){return o(v)}),u.delete(n),a.delete(n),i.delete(n),s.delete(n),l.delete(n),this.nodeCountNum-=1}return this}},{key:"setEdge",value:function(n,r,o,a){var i,s,l=Af(this.isDirected(),n,r,a),u=Cl(this.isDirected(),l),d=l.v,c=l.w;if(this.edgesLabelsMap.has(u))return this.edgesLabelsMap.set(u,o),this;if(a!==void 0&&!this.isMultigraph())throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(d),this.setNode(c),this.edgesLabelsMap.set(u,o||this.defaultEdgeLabelFn(d,c,a)),Object.freeze(l),this.edgesMap.set(u,l);var f=this.predecessorsMap.get(c),h=this.successorsMap.get(d);return Sf(f,d),Sf(h,c),(i=this.inEdgesMap.get(c))===null||i===void 0||i.set(u,l),(s=this.outEdgesMap.get(d))===null||s===void 0||s.set(u,l),this.edgeCountNum+=1,this}},{key:"removeEdge",value:function(n,r,o){var a=rh(this.isDirected(),n,r,o),i=this.edgesMap.get(a);if(i){var s=Af(this.isDirected(),n,r,o),l=s.v,u=s.w;this.edgesLabelsMap.delete(a),this.edgesMap.delete(a);var d=this.predecessorsMap.get(u),c=this.successorsMap.get(l);wf(d,l),wf(c,u),this.inEdgesMap.get(u).delete(a),this.outEdgesMap.get(l).delete(a),this.edgeCountNum-=1}return this}}]),e}();ia.fromJSON=_E;function Of(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function TE(e,t,n){return t&&Of(e.prototype,t),n&&Of(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function IE(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var oh=TE(function e(){var t=this;IE(this,e),this.arr=[],this.keyIndice=new Map,this.size=function(){return t.arr.length},this.keys=function(){return t.arr.map(function(n){return n.key})},this.has=function(n){return t.keyIndice.has(n)},this.priority=function(n){var r=t.keyIndice.get(n);if(r!==void 0)return t.arr[r].priority},this.swap=function(n,r){var o=t.arr,a=t.keyIndice,i=[o[n],o[r]],s=i[0],l=i[1];o[n]=l,o[r]=s,a.set(s.key,r),a.set(l.key,n)},this.innerDecrease=function(n){for(var r=t.arr,o=r[n].priority,a,i=n;i!==0;){var s;if(a=i>>1,((s=r[a])===null||s===void 0?void 0:s.priority)<o)break;t.swap(i,a),i=a}},this.heapify=function(n){var r=t.arr,o=n<<1,a=o+1,i=n;o<r.length&&(i=r[o].priority<r[i].priority?o:i,a<r.length&&(i=r[a].priority<r[i].priority?a:i),i!==n&&(t.swap(n,i),t.heapify(i)))},this.min=function(){if(t.size()===0)throw new Error("Queue underflow");return t.arr[0].key},this.add=function(n,r){var o=t.keyIndice,a=t.arr;if(!o.has(n)){var i=a.length;return o.set(n,i),a.push({key:n,priority:r}),t.innerDecrease(i),!0}return!1},this.removeMin=function(){t.swap(0,t.arr.length-1);var n=t.arr.pop();return t.keyIndice.delete(n.key),t.heapify(0),n.key},this.decrease=function(n,r){if(!t.has(n))throw new Error("There's no key named ".concat(n));var o=t.keyIndice.get(n);if(r>t.arr[o].priority)throw new Error("New priority is greater than current priority.Key: ".concat(n," Old: + ").concat(t.arr[o].priority," New: ").concat(r));t.arr[o].priority=r,t.innerDecrease(o)}}),SE=function(t,n){var r=new ia,o=new Map,a=new oh,i;function s(d){var c=d.v===i?d.w:d.v,f=a.priority(c);if(f!==void 0){var h=n(d);h<f&&(o.set(c,i),a.decrease(c,h))}}if(t.nodeCount()===0)return r;t.nodes().forEach(function(d){a.add(d,Number.POSITIVE_INFINITY),r.setNode(d)}),a.decrease(t.nodes()[0],0);for(var l=!1;a.size()>0;){var u;if(i=a.removeMin(),o.has(i))r.setEdge(i,o.get(i));else{if(l)throw new Error("Input graph is not connected: "+t.graph());l=!0}(u=t.nodeEdges(i))===null||u===void 0||u.forEach(s)}return r},wE=function(t){var n=new Set,r=[],o=t.nodes();return o.forEach(function(a){for(var i=[],s=[a];s.length>0;){var l=s.pop();if(!n.has(l)){var u,d;n.add(l),i.push(l),(u=t.successors(l))===null||u===void 0||u.forEach(function(c){return s.push(c)}),(d=t.predecessors(l))===null||d===void 0||d.forEach(function(c){return s.push(c)})}}i.length&&r.push(i)}),r},AE=function e(t,n,r,o,a,i){o.includes(n)||(o.push(n),r||i.push(n),a(n).forEach(function(s){return e(t,s,r,o,a,i)}),r&&i.push(n))},Mu=function(t,n,r){var o=Array.isArray(n)?n:[n],a=function(u){return t.isDirected()?t.successors(u):t.neighbors(u)},i=[],s=[];return o.forEach(function(l){if(t.hasNode(l))AE(t,l,r==="post",s,a,i);else throw new Error("Graph does not have node: "+l)}),i};function xE(e,t){return OE(e)||NE(e,t)||CE(e,t)||RE()}function RE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CE(e,t){if(e){if(typeof e=="string")return Ff(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ff(e,t)}}function Ff(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function NE(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r=[],o=!0,a=!1,i,s;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(r.push(i.value),!(t&&r.length===t));o=!0);}catch(l){a=!0,s=l}finally{try{!o&&n.return!=null&&n.return()}finally{if(a)throw s}}return r}}function OE(e){if(Array.isArray(e))return e}var FE=function(){return 1},ah=function(t,n,r,o){return LE(t,n,r||FE,o||function(a){return t.outEdges(a)})},LE=function(t,n,r,o){var a=new Map,i=new oh,s,l,u=function(f){var h=f.v!==s?f.v:f.w,m=a.get(h),v=r(f),b=l.distance+v;if(v<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+f+" Weight: "+v);b<m.distance&&(m.distance=b,m.predecessor=s,i.decrease(h,b))};for(t.nodes().forEach(function(c){var f=c===n?0:Number.POSITIVE_INFINITY;a.set(c,{distance:f}),i.add(c,f)});i.size()>0&&(s=i.removeMin(),l=a.get(s),!(l&&l.distance===Number.POSITIVE_INFINITY));)o(s).forEach(u);var d={};return Array.from(a.entries()).forEach(function(c){var f=xE(c,2),h=f[0],m=f[1];return d[String(h)]=m,d}),d},ME=function(t,n,r){var o={};return t.nodes().forEach(function(a){return o[String(a)]=ah(t,a,n,r),o}),o},ih=function(t){var n=0,r=[],o=new Map,a=[];function i(s){var l,u={onStack:!0,lowlink:n,index:n};if(o.set(s,u),n+=1,r.push(s),(l=t.successors(s))===null||l===void 0||l.forEach(function(h){var m;if(o.has(h)){if(!((m=o.get(h))===null||m===void 0)&&m.onStack){var b=o.get(h);u.lowlink=Math.min(u.lowlink,b.index)}}else{i(h);var v=o.get(h);u.lowlink=Math.min(u.lowlink,v.lowlink)}}),u.lowlink===u.index){var d=[],c;do{c=r.pop();var f=o.get(c);f.onStack=!1,d.push(c)}while(s!==c);a.push(d)}}return t.nodes().forEach(function(s){o.has(s)||i(s)}),a},DE=function(t){return ih(t).filter(function(n){return n.length>1||n.length===1&&t.hasEdge(n[0],n[0])})};function Jl(e){"@babel/helpers - typeof";return Jl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jl(e)}function Lf(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function PE(e,t,n){return t&&Lf(e.prototype,t),n&&Lf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function kE(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function VE(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$a(e,t)}function BE(e){var t=sh();return function(){var r=Xa(e),o;if(t){var a=Xa(this).constructor;o=Reflect.construct(r,arguments,a)}else o=r.apply(this,arguments);return UE(this,o)}}function UE(e,t){if(t&&(Jl(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GE(e)}function GE(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function eu(e){var t=typeof Map=="function"?new Map:void 0;return eu=function(r){if(r===null||!jE(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(r))return t.get(r);t.set(r,o)}function o(){return ji(r,arguments,Xa(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),$a(o,r)},eu(e)}function ji(e,t,n){return sh()?ji=Reflect.construct:ji=function(o,a,i){var s=[null];s.push.apply(s,a);var l=Function.bind.apply(o,s),u=new l;return i&&$a(u,i.prototype),u},ji.apply(null,arguments)}function sh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function jE(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function $a(e,t){return $a=Object.setPrototypeOf||function(r,o){return r.__proto__=o,r},$a(e,t)}function Xa(e){return Xa=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},Xa(e)}var tu=function(e){VE(n,e);var t=BE(n);function n(){return kE(this,n),t.apply(this,arguments)}return PE(n)}(eu(Error));function lh(e){var t=new Set,n=new Set,r=[];function o(a){if(n.has(a))throw new tu;if(!t.has(a)){var i;n.add(a),t.add(a),(i=e.predecessors(a))===null||i===void 0||i.forEach(o),n.delete(a),r.push(a)}}if(e.sinks().forEach(o),t.size!==e.nodeCount())throw new tu;return r}var zE=function(t){try{lh(t)}catch(n){if(n instanceof tu)return!1;throw n}return!0},$E=function(t,n){return Mu(t,n,"post")},XE=function(t,n){return Mu(t,n,"pre")},HE=function(){return 1};function WE(e,t,n){return YE(e,t||HE,n||function(r){return e.outEdges(r)})}function YE(e,t,n){var r={},o=e.nodes();return o.forEach(function(a){var i=String(a);r[i]={},r[i][i]={distance:0},o.forEach(function(s){a!==s&&(r[i][String(s)]={distance:Number.POSITIVE_INFINITY})}),n(a).forEach(function(s){var l=s.v===a?s.w:s.v,u=t(s);r[i][String(l)]={distance:u,predecessor:a}})}),o.forEach(function(a){var i=String(a),s=r[i];o.forEach(function(l){var u=String(l),d=r[u];o.forEach(function(c){var f=String(c),h=d[i],m=s[f],v=d[f],b=h.distance+m.distance;b<v.distance&&(v.distance=b,v.predecessor=m.predecessor)})})}),r}const KE=Object.freeze(Object.defineProperty({__proto__:null,components:wE,dfs:Mu,dijkstra:ah,dijkstraAll:ME,findCycles:DE,floydWarshall:WE,isAcyclic:zE,postorder:$E,preorder:XE,prim:SE,tarjan:ih,topsort:lh},Symbol.toStringTag,{value:"Module"}));class qE extends pE{}class QE extends ia{}const ZE=()=>1,JE=(e,t)=>{var n;if(e.nodeCount()<=1)return[];const r=tT(e,t||ZE);return(n=eT(r.graph,r.buckets,r.zeroIdx).map(a=>e.outEdges(a.v,a.w)))===null||n===void 0?void 0:n.flat()},eT=(e,t,n)=>{let r=[];const o=t[t.length-1],a=t[0];let i;for(;e.nodeCount();){for(;i=a.dequeue();)Nl(e,t,n,i);for(;i=o.dequeue();)Nl(e,t,n,i);if(e.nodeCount()){for(let s=t.length-2;s>0;--s)if(i=t[s].dequeue(),i){r=r.concat(Nl(e,t,n,i,!0));break}}}return r},Nl=(e,t,n,r,o)=>{var a,i;const s=[];return(a=e.inEdges(r.v))===null||a===void 0||a.forEach(l=>{const u=e.edge(l),d=e.node(l.v);o&&s.push({v:l.v,w:l.w,in:0,out:0}),d.out===void 0&&(d.out=0),d.out-=u,nu(t,n,d)}),(i=e.outEdges(r.v))===null||i===void 0||i.forEach(l=>{const u=e.edge(l),d=l.w,c=e.node(d);c.in===void 0&&(c.in=0),c.in-=u,nu(t,n,c)}),e.removeNode(r.v),o?s:void 0},tT=(e,t)=>{const n=new QE;let r=0,o=0;e.nodes().forEach(l=>{n.setNode(l,{v:l,in:0,out:0})}),e.edges().forEach(l=>{const u=n.edge(l)||0,d=(t==null?void 0:t(l))||1,c=u+d;n.setEdge(l.v,l.w,c),o=Math.max(o,n.node(l.v).out+=d),r=Math.max(r,n.node(l.w).in+=d)});const a=[],i=o+r+3;for(let l=0;l<i;l++)a.push(new qE);const s=r+1;return n.nodes().forEach(l=>{nu(a,s,n.node(l))}),{buckets:a,zeroIdx:s,graph:n}},nu=(e,t,n)=>{n.out?n.in?e[n.out-n.in+t].enqueue(n):e[e.length-1].enqueue(n):e[0].enqueue(n)},nT=e=>{const t=r=>o=>{var a;return((a=r.edge(o))===null||a===void 0?void 0:a.weight)||1},n=e.graph().acyclicer==="greedy"?JE(e,t(e)):rT(e);n==null||n.forEach(r=>{const o=e.edge(r);e.removeEdgeObj(r),o.forwardName=r.name,o.reversed=!0,e.setEdge(r.w,r.v,o,`rev-${Math.random()}`)})},rT=e=>{const t=[],n={},r={},o=a=>{var i;r[a]||(r[a]=!0,n[a]=!0,(i=e.outEdges(a))===null||i===void 0||i.forEach(s=>{n[s.w]?t.push(s):o(s.w)}),delete n[a])};return e.nodes().forEach(o),t},oT=e=>{e.edges().forEach(t=>{const n=e.edge(t);if(n.reversed){e.removeEdgeObj(t);const r=n.forwardName;delete n.reversed,delete n.forwardName,e.setEdge(t.w,t.v,n,r)}})},Mf={run:nT,undo:oT};class cr extends ia{}const aT=(e,t)=>Number(e)-Number(t),sa=(e,t,n,r)=>{let o;do o=`${r}${Math.random()}`;while(e.hasNode(o));return n.dummy=t,e.setNode(o,n),o},iT=e=>{const t=new cr().setGraph(e.graph());return e.nodes().forEach(n=>{t.setNode(n,e.node(n))}),e.edges().forEach(n=>{const r=t.edgeFromArgs(n.v,n.w)||{weight:0,minlen:1},o=e.edge(n);t.setEdge(n.v,n.w,{weight:r.weight+o.weight,minlen:Math.max(r.minlen,o.minlen)})}),t},uh=e=>{const t=new cr({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(n=>{var r;!((r=e.children(n))===null||r===void 0)&&r.length||t.setNode(n,e.node(n))}),e.edges().forEach(n=>{t.setEdgeObj(n,e.edge(n))}),t},sT=(e,t)=>e==null?void 0:e.reduce((n,r,o)=>(n[r]=t[o],n),{}),Df=(e,t)=>{const n=Number(e.x),r=Number(e.y),o=Number(t.x)-n,a=Number(t.y)-r;let i=Number(e.width)/2,s=Number(e.height)/2;if(!o&&!a)return{x:0,y:0};let l,u;return Math.abs(a)*i>Math.abs(o)*s?(a<0&&(s=-s),l=s*o/a,u=s):(o<0&&(i=-i),l=i,u=i*a/o),{x:n+l,y:r+u}},Ha=e=>{const t=[],n=dh(e)+1;for(let r=0;r<n;r++)t.push([]);e.nodes().forEach(r=>{const o=e.node(r);if(!o)return;const a=o.rank;a!==void 0&&t[a]&&t[a].push(r)});for(let r=0;r<n;r++)t[r]=t[r].sort((o,a)=>{var i,s;return aT((i=e.node(o))===null||i===void 0?void 0:i.order,(s=e.node(a))===null||s===void 0?void 0:s.order)});return t},lT=e=>{const t=e.nodes().filter(r=>{var o;return((o=e.node(r))===null||o===void 0?void 0:o.rank)!==void 0}).map(r=>e.node(r).rank),n=Math.min(...t);e.nodes().forEach(r=>{const o=e.node(r);o.hasOwnProperty("rank")&&n!==1/0&&(o.rank-=n)})},uT=e=>{const t=e.nodes(),n=t.filter(s=>{var l;return((l=e.node(s))===null||l===void 0?void 0:l.rank)!==void 0}).map(s=>e.node(s).rank),r=Math.min(...n),o=[];t.forEach(s=>{var l;const u=(((l=e.node(s))===null||l===void 0?void 0:l.rank)||0)-r;o[u]||(o[u]=[]),o[u].push(s)});let a=0;const i=e.graph().nodeRankFactor||0;for(let s=0;s<o.length;s++){const l=o[s];l===void 0?s%i!==0&&(a-=1):a&&(l==null||l.forEach(u=>{const d=e.node(u);d&&(d.rank=d.rank||0,d.rank+=a)}))}},Pf=(e,t,n,r)=>{const o={width:0,height:0};return Qi(n)&&Qi(r)&&(o.rank=n,o.order=r),sa(e,"border",o,t)},dh=e=>{let t;return e.nodes().forEach(n=>{var r;const o=(r=e.node(n))===null||r===void 0?void 0:r.rank;o!==void 0&&(t===void 0||o>t)&&(t=o)}),t||(t=0),t},dT=(e,t)=>{const n={lhs:[],rhs:[]};return e==null||e.forEach(r=>{t(r)?n.lhs.push(r):n.rhs.push(r)}),n},ch=(e,t)=>{const n=Date.now();try{return t()}finally{`${e}`,Date.now()-n}},fh=(e,t)=>t(),Du=(e,t)=>e.reduce((n,r)=>{const o=t(n),a=t(r);return o>a?r:n}),cT=e=>{e.graph().dummyChains=[],e.edges().forEach(t=>fT(e,t))},fT=(e,t)=>{let n=t.v,r=e.node(n).rank;const o=t.w,a=e.node(o).rank,i=t.name,s=e.edge(t),l=s.labelRank;if(a===r+1)return;e.removeEdgeObj(t);const u=e.graph();let d,c,f;for(f=0,++r;r<a;++f,++r)s.points=[],c={edgeLabel:s,width:0,height:0,edgeObj:t,rank:r},d=sa(e,"edge",c,"_d"),r===l&&(c.width=s.width,c.height=s.height,c.dummy="edge-label",c.labelpos=s.labelpos),e.setEdge(n,d,{weight:s.weight},i),f===0&&(u.dummyChains||(u.dummyChains=[]),u.dummyChains.push(d)),n=d;e.setEdge(n,o,{weight:s.weight},i)},pT=e=>{var t;(t=e.graph().dummyChains)===null||t===void 0||t.forEach(n=>{let r=e.node(n);const o=r.edgeLabel;let a;r.edgeObj&&e.setEdgeObj(r.edgeObj,o);let i=n;for(;r.dummy;)a=e.successors(i)[0],e.removeNode(i),o.points.push({x:r.x,y:r.y}),r.dummy==="edge-label"&&(o.x=r.x,o.y=r.y,o.width=r.width,o.height=r.height),i=a,r=e.node(i)})},kf={run:cT,undo:pT},ph=e=>{var t;const n={},r=o=>{var a;const i=e.node(o);if(!i)return 0;if(n[o])return i.rank;n[o]=!0;let s;return(a=e.outEdges(o))===null||a===void 0||a.forEach(l=>{const u=r(l.w),d=e.edge(l).minlen,c=u-d;c&&(s===void 0||c<s)&&(s=c)}),s||(s=0),i.rank=s,s};(t=e.sources())===null||t===void 0||t.forEach(o=>r(o))},hT=e=>{var t;const n={};let r;const o=s=>{var l;const u=e.node(s);if(!u)return 0;if(n[s])return u.rank;n[s]=!0;let d;return(l=e.outEdges(s))===null||l===void 0||l.forEach(c=>{const f=o(c.w),h=e.edge(c).minlen,m=f-h;m&&(d===void 0||m<d)&&(d=m)}),d||(d=0),(r===void 0||d<r)&&(r=d),u.rank=d,d};(t=e.sources())===null||t===void 0||t.forEach(s=>{e.node(s)&&o(s)}),r===void 0&&(r=0);const a={},i=(s,l)=>{var u;const d=e.node(s),c=isNaN(d.layer)?l:d.layer;(d.rank===void 0||d.rank<c)&&(d.rank=c),!a[s]&&(a[s]=!0,(u=e.outEdges(s))===null||u===void 0||u.map(f=>{i(f.w,c+e.edge(f).minlen)}))};e.nodes().forEach(s=>{const l=e.node(s);l&&(isNaN(l.layer)?l.rank-=r:i(s,l.layer))})},Cr=(e,t)=>e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen,mT=e=>{const t=new cr({directed:!1}),n=e.nodes()[0],r=e.nodeCount();t.setNode(n,{});let o,a;for(;vT(t,e)<r;)o=hh(t,e),a=t.hasNode(o.v)?Cr(e,o):-Cr(e,o),mh(t,e,a);return t},vT=(e,t)=>{const n=r=>{t.nodeEdges(r).forEach(o=>{const a=o.v,i=r===a?o.w:a;!e.hasNode(i)&&!Cr(t,o)&&(e.setNode(i,{}),e.setEdge(r,i,{}),n(i))})};return e.nodes().forEach(n),e.nodeCount()},_T=e=>{const t=new cr({directed:!1}),n=e.nodes()[0],r=e.nodes().filter(i=>!!e.node(i)).length;t.setNode(n,{});let o,a;for(;bT(t,e)<r;)o=hh(t,e),a=t.hasNode(o.v)?Cr(e,o):-Cr(e,o),mh(t,e,a);return t},bT=(e,t)=>{const n=r=>{var o;(o=t.nodeEdges(r))===null||o===void 0||o.forEach(a=>{const i=a.v,s=r===i?a.w:i;!e.hasNode(s)&&(t.node(s).layer!==void 0||!Cr(t,a))&&(e.setNode(s,{}),e.setEdge(r,s,{}),n(s))})};return e.nodes().forEach(n),e.nodeCount()},hh=(e,t)=>Du(t.edges(),n=>e.hasNode(n.v)!==e.hasNode(n.w)?Cr(t,n):1/0),mh=(e,t,n)=>{e.nodes().forEach(r=>{t.node(r).rank||(t.node(r).rank=0),t.node(r).rank+=n})},{preorder:yT,postorder:gT}=KE,ET=e=>{const t=iT(e);ph(t);const n=mT(t);_h(n),vh(n,t);let r,o;for(;r=ST(n);)o=wT(n,t,r),AT(n,t,r,o)},vh=(e,t)=>{let n=gT(e,e.nodes());n=n==null?void 0:n.slice(0,(n==null?void 0:n.length)-1),n==null||n.forEach(r=>{TT(e,t,r)})},TT=(e,t,n)=>{const o=e.node(n).parent;e.edgeFromArgs(n,o).cutvalue=IT(e,t,n)},IT=(e,t,n)=>{var r;const a=e.node(n).parent;let i=!0,s=t.edgeFromArgs(n,a),l=0;return s||(i=!1,s=t.edgeFromArgs(a,n)),l=s.weight,(r=t.nodeEdges(n))===null||r===void 0||r.forEach(u=>{const d=u.v===n,c=d?u.w:u.v;if(c!==a){const f=d===i,h=t.edge(u).weight;if(l+=f?h:-h,RT(e,n,c)){const m=e.edgeFromArgs(n,c).cutvalue;l+=f?-m:m}}}),l},_h=(e,t=e.nodes()[0])=>{bh(e,{},1,t)},bh=(e,t,n,r,o)=>{var a;const i=n;let s=n;const l=e.node(r);return t[r]=!0,(a=e.neighbors(r))===null||a===void 0||a.forEach(u=>{t[u]||(s=bh(e,t,s,u,r))}),l.low=i,l.lim=s++,o?l.parent=o:delete l.parent,s},ST=e=>e.edges().find(t=>e.edge(t).cutvalue<0),wT=(e,t,n)=>{let r=n.v,o=n.w;t.hasEdge(r,o)||(r=n.w,o=n.v);const a=e.node(r),i=e.node(o);let s=a,l=!1;a.lim>i.lim&&(s=i,l=!0);const u=t.edges().filter(d=>l===Vf(e,e.node(d.v),s)&&l!==Vf(e,e.node(d.w),s));return Du(u,d=>Cr(t,d))},AT=(e,t,n,r)=>{const o=n.v,a=n.w;e.removeEdge(o,a),e.setEdge(r.v,r.w,{}),_h(e),vh(e,t),xT(e,t)},xT=(e,t)=>{const n=e.nodes().find(o=>{var a;return!(!((a=t.node(o))===null||a===void 0)&&a.parent)});let r=yT(e,n);r=r==null?void 0:r.slice(1),r==null||r.forEach(o=>{const a=e.node(o).parent;let i=t.edgeFromArgs(o,a),s=!1;i||(i=t.edgeFromArgs(a,o),s=!0),t.node(o).rank=t.node(a).rank+(s?i.minlen:-i.minlen)})},RT=(e,t,n)=>e.hasEdge(t,n),Vf=(e,t,n)=>n.low<=t.lim&&t.lim<=n.lim,CT=e=>{switch(e.graph().ranker){case"network-simplex":OT(e);break;case"tight-tree":Bf(e);break;case"longest-path":NT(e);break;default:Bf(e)}},NT=ph,Bf=e=>{hT(e),_T(e)},OT=e=>{ET(e)},FT=e=>{var t;const n={};let r=0;const o=a=>{var i;const s=r;(i=e.children(a))===null||i===void 0||i.forEach(o),n[a]={low:s,lim:r++}};return(t=e.children())===null||t===void 0||t.forEach(o),n},LT=(e,t,n,r)=>{const o=[],a=[],i=Math.min(t[n].low,t[r].low),s=Math.max(t[n].lim,t[r].lim);let l,u;l=n;do l=e.parent(l),o.push(l);while(l&&(t[l].low>i||s>t[l].lim));for(u=l,l=r;l&&l!==u;)a.push(l),l=e.parent(l);return{lca:u,path:o.concat(a.reverse())}},MT=e=>{var t;const n=FT(e);(t=e.graph().dummyChains)===null||t===void 0||t.forEach(r=>{var o,a;let i=r,s=e.node(i);const l=s.edgeObj;if(!l)return;const u=LT(e,n,l.v,l.w),d=u.path,c=u.lca;let f=0,h=d[f],m=!0;for(;i!==l.w;){if(s=e.node(i),m){for(;h!==c&&((o=e.node(h))===null||o===void 0?void 0:o.maxRank)<s.rank;)f++,h=d[f];h===c&&(m=!1)}if(!m){for(;f<d.length-1&&((a=e.node(d[f+1]))===null||a===void 0?void 0:a.minRank)<=s.rank;)f++;h=d[f]}e.setParent(i,h),i=e.successors(i)[0]}})},DT=e=>{var t;const n=sa(e,"root",{},"_root"),r=PT(e);let o=Math.max(...Object.values(r));Math.abs(o)===1/0&&(o=1);const a=o-1,i=2*a+1;e.graph().nestingRoot=n,e.edges().forEach(l=>{e.edge(l).minlen*=i});const s=kT(e)+1;(t=e.children())===null||t===void 0||t.forEach(l=>{yh(e,n,i,s,a,r,l)}),e.graph().nodeRankFactor=i},yh=(e,t,n,r,o,a,i)=>{const s=e.children(i);if(!(s!=null&&s.length)){i!==t&&e.setEdge(t,i,{weight:0,minlen:n});return}const l=Pf(e,"_bt"),u=Pf(e,"_bb"),d=e.node(i);e.setParent(l,i),d.borderTop=l,e.setParent(u,i),d.borderBottom=u,s==null||s.forEach(c=>{yh(e,t,n,r,o,a,c);const f=e.node(c),h=f.borderTop?f.borderTop:c,m=f.borderBottom?f.borderBottom:c,v=f.borderTop?r:2*r,b=h!==m?1:o-a[i]+1;e.setEdge(l,h,{minlen:b,weight:v,nestingEdge:!0}),e.setEdge(m,u,{minlen:b,weight:v,nestingEdge:!0})}),e.parent(i)||e.setEdge(t,l,{weight:0,minlen:o+a[i]})},PT=e=>{var t;const n={},r=(o,a)=>{const i=e.children(o);i==null||i.forEach(s=>r(s,a+1)),n[o]=a};return(t=e.children())===null||t===void 0||t.forEach(o=>r(o,1)),n},kT=e=>{let t=0;return e.edges().forEach(n=>{t+=e.edge(n).weight}),t},VT=e=>{const t=e.graph();t.nestingRoot&&e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(n=>{e.edge(n).nestingEdge&&e.removeEdgeObj(n)})},Uf={run:DT,cleanup:VT},BT=e=>{var t;const n=r=>{const o=e.children(r),a=e.node(r);if(o!=null&&o.length&&o.forEach(i=>n(i)),a.hasOwnProperty("minRank")){a.borderLeft=[],a.borderRight=[];for(let i=a.minRank,s=a.maxRank+1;i<s;i+=1)Gf(e,"borderLeft","_bl",r,a,i),Gf(e,"borderRight","_br",r,a,i)}};(t=e.children())===null||t===void 0||t.forEach(r=>n(r))},Gf=(e,t,n,r,o,a)=>{const i={rank:a,borderType:t,width:0,height:0},s=o[t][a-1],l=sa(e,"border",i,n);o[t][a]=l,e.setParent(l,r),s&&e.setEdge(s,l,{weight:1})},UT=e=>{var t;const n=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(n==="lr"||n==="rl")&&gh(e)},GT=e=>{var t;const n=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(n==="bt"||n==="rl")&&jT(e),(n==="lr"||n==="rl")&&(zT(e),gh(e))},gh=e=>{e.nodes().forEach(t=>{jf(e.node(t))}),e.edges().forEach(t=>{jf(e.edge(t))})},jf=e=>{const t=e.width;e.width=e.height,e.height=t},jT=e=>{e.nodes().forEach(t=>{Ol(e.node(t))}),e.edges().forEach(t=>{var n;const r=e.edge(t);(n=r.points)===null||n===void 0||n.forEach(o=>Ol(o)),r.hasOwnProperty("y")&&Ol(r)})},Ol=e=>{e!=null&&e.y&&(e.y=-e.y)},zT=e=>{e.nodes().forEach(t=>{Fl(e.node(t))}),e.edges().forEach(t=>{var n;const r=e.edge(t);(n=r.points)===null||n===void 0||n.forEach(o=>Fl(o)),r.hasOwnProperty("x")&&Fl(r)})},Fl=e=>{const t=e.x;e.x=e.y,e.y=t},zf={adjust:UT,undo:GT};var $T={}.toString,XT=function(e,t){return $T.call(e)==="[object "+t+"]"};const HT=XT,Eh=function(e){return Array.isArray?Array.isArray(e):HT(e,"Array")},ru=function(e){if(Eh(e))return e.reduce(function(t,n){return Math.max(t,n)},e[0])},$f=function(e){if(Eh(e))return e.reduce(function(t,n){return Math.min(t,n)},e[0])},Xf=e=>{const t={},n=e.nodes().filter(d=>{var c;return!(!((c=e.children(d))===null||c===void 0)&&c.length)}),r=n.map(d=>e.node(d).rank),o=ru(r),a=[];for(let d=0;d<o+1;d++)a.push([]);const i=d=>{var c;if(t.hasOwnProperty(d))return;t[d]=!0;const f=e.node(d);isNaN(f.rank)||a[f.rank].push(d),(c=e.successors(d))===null||c===void 0||c.forEach(h=>i(h))},s=n.sort((d,c)=>e.node(d).rank-e.node(c).rank),u=s.filter(d=>e.node(d).fixorder!==void 0).sort((d,c)=>e.node(d).fixorder-e.node(c).fixorder);return u==null||u.forEach(d=>{isNaN(e.node(d).rank)||a[e.node(d).rank].push(d),t[d]=!0}),s==null||s.forEach(i),a},WT=(e,t,n)=>{const r=sT(n,n.map((d,c)=>c)),a=t.map(d=>{var c;const f=(c=e.outEdges(d))===null||c===void 0?void 0:c.map(h=>({pos:r[h.w]||0,weight:e.edge(h).weight}));return f==null?void 0:f.sort((h,m)=>h.pos-m.pos)}).flat().filter(d=>d!==void 0);let i=1;for(;i<n.length;)i<<=1;const s=2*i-1;i-=1;const l=Array(s).fill(0,0,s);let u=0;return a==null||a.forEach(d=>{if(d){let c=d.pos+i;l[c]+=d.weight;let f=0;for(;c>0;)c%2&&(f+=l[c+1]),c=c-1>>1,l[c]+=d.weight;u+=d.weight*f}}),u},Hf=(e,t)=>{let n=0;for(let r=1;r<(t==null?void 0:t.length);r+=1)n+=WT(e,t[r-1],t[r]);return n},YT=(e,t,n)=>{const r=KT(e),o=new cr({compound:!0}).setGraph({root:r}).setDefaultNodeLabel(a=>e.node(a));return e.nodes().forEach(a=>{var i;const s=e.node(a),l=e.parent(a);(s.rank===t||s.minRank<=t&&t<=s.maxRank)&&(o.setNode(a),o.setParent(a,l||r),(i=e[n](a))===null||i===void 0||i.forEach(u=>{const d=u.v===a?u.w:u.v,c=o.edgeFromArgs(d,a),f=c!==void 0?c.weight:0;o.setEdge(d,a,{weight:e.edge(u).weight+f})}),s.hasOwnProperty("minRank")&&o.setNode(a,{borderLeft:s.borderLeft[t],borderRight:s.borderRight[t]}))}),o},KT=e=>{let t;for(;e.hasNode(t=`_root${Math.random()}`););return t},qT=(e,t,n)=>{const r={};let o;n==null||n.forEach(a=>{let i=e.parent(a),s,l;for(;i;){if(s=e.parent(i),s?(l=r[s],r[s]=i):(l=o,o=i),l&&l!==i){t.setEdge(l,i);return}i=s}})},QT=(e,t)=>t.map(n=>{const r=e.inEdges(n);if(!(r!=null&&r.length))return{v:n};{const o={sum:0,weight:0};return r==null||r.forEach(a=>{const i=e.edge(a),s=e.node(a.v);o.sum+=i.weight*s.order,o.weight+=i.weight}),{v:n,barycenter:o.sum/o.weight,weight:o.weight}}}),ZT=(e,t)=>{var n,r,o;const a={};e==null||e.forEach((s,l)=>{a[s.v]={i:l,indegree:0,in:[],out:[],vs:[s.v]};const u=a[s.v];s.barycenter!==void 0&&(u.barycenter=s.barycenter,u.weight=s.weight)}),(n=t.edges())===null||n===void 0||n.forEach(s=>{const l=a[s.v],u=a[s.w];l!==void 0&&u!==void 0&&(u.indegree++,l.out.push(a[s.w]))});const i=(o=(r=Object.values(a)).filter)===null||o===void 0?void 0:o.call(r,s=>!s.indegree);return JT(i)},JT=e=>{var t,n;const r=[],o=l=>u=>{u.merged||(u.barycenter===void 0||l.barycenter===void 0||u.barycenter>=l.barycenter)&&eI(l,u)},a=l=>u=>{u.in.push(l),--u.indegree===0&&e.push(u)};for(;e!=null&&e.length;){const l=e.pop();r.push(l),(t=l.in.reverse())===null||t===void 0||t.forEach(u=>o(l)(u)),(n=l.out)===null||n===void 0||n.forEach(u=>a(l)(u))}const i=r.filter(l=>!l.merged),s=["vs","i","barycenter","weight"];return i.map(l=>{const u={};return s==null||s.forEach(d=>{l[d]!==void 0&&(u[d]=l[d])}),u})},eI=(e,t)=>{var n;let r=0,o=0;e.weight&&(r+=e.barycenter*e.weight,o+=e.weight),t.weight&&(r+=t.barycenter*t.weight,o+=t.weight),e.vs=(n=t.vs)===null||n===void 0?void 0:n.concat(e.vs),e.barycenter=r/o,e.weight=o,e.i=Math.min(t.i,e.i),t.merged=!0},tI=(e,t,n,r)=>{const o=dT(e,f=>{const h=f.hasOwnProperty("fixorder")&&!isNaN(f.fixorder);return r?!h&&f.hasOwnProperty("barycenter"):h||f.hasOwnProperty("barycenter")}),a=o.lhs,i=o.rhs.sort((f,h)=>-f.i- -h.i),s=[];let l=0,u=0,d=0;a==null||a.sort(nI(!!t,!!n)),d=Wf(s,i,d),a==null||a.forEach(f=>{var h;d+=(h=f.vs)===null||h===void 0?void 0:h.length,s.push(f.vs),l+=f.barycenter*f.weight,u+=f.weight,d=Wf(s,i,d)});const c={vs:s.flat()};return u&&(c.barycenter=l/u,c.weight=u),c},Wf=(e,t,n)=>{let r=n,o;for(;t.length&&(o=t[t.length-1]).i<=r;)t.pop(),e==null||e.push(o.vs),r++;return r},nI=(e,t)=>(n,r)=>{if(n.fixorder!==void 0&&r.fixorder!==void 0)return n.fixorder-r.fixorder;if(n.barycenter<r.barycenter)return-1;if(n.barycenter>r.barycenter)return 1;if(t&&n.order!==void 0&&r.order!==void 0){if(n.order<r.order)return-1;if(n.order>r.order)return 1}return e?r.i-n.i:n.i-r.i},Th=(e,t,n,r,o,a)=>{var i,s,l,u;let d=e.children(t);const c=e.node(t),f=c?c.borderLeft:void 0,h=c?c.borderRight:void 0,m={};f&&(d=d==null?void 0:d.filter(L=>L!==f&&L!==h));const v=QT(e,d||[]);v==null||v.forEach(L=>{var z;if(!((z=e.children(L.v))===null||z===void 0)&&z.length){const K=Th(e,L.v,n,r,a);m[L.v]=K,K.hasOwnProperty("barycenter")&&oI(L,K)}});const b=ZT(v,n);rI(b,m),(i=b.filter(L=>L.vs.length>0))===null||i===void 0||i.forEach(L=>{const z=e.node(L.vs[0]);z&&(L.fixorder=z.fixorder,L.order=z.order)});const w=tI(b,r,o,a);if(f&&(w.vs=[f,w.vs,h].flat(),!((s=e.predecessors(f))===null||s===void 0)&&s.length)){const L=e.node(((l=e.predecessors(f))===null||l===void 0?void 0:l[0])||""),z=e.node(((u=e.predecessors(h))===null||u===void 0?void 0:u[0])||"");w.hasOwnProperty("barycenter")||(w.barycenter=0,w.weight=0),w.barycenter=(w.barycenter*w.weight+L.order+z.order)/(w.weight+2),w.weight+=2}return w},rI=(e,t)=>{e==null||e.forEach(n=>{var r;const o=(r=n.vs)===null||r===void 0?void 0:r.map(a=>t[a]?t[a].vs:a);n.vs=o.flat()})},oI=(e,t)=>{e.barycenter!==void 0?(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight):(e.barycenter=t.barycenter,e.weight=t.weight)},aI=(e,t)=>{const n=dh(e),r=[],o=[];for(let d=1;d<n+1;d++)r.push(d);for(let d=n-1;d>-1;d--)o.push(d);const a=Yf(e,r,"inEdges"),i=Yf(e,o,"outEdges");let s=Xf(e);Ll(e,s);let l=Number.POSITIVE_INFINITY,u;for(let d=0,c=0;c<4;++d,++c){Kf(d%2?a:i,d%4>=2,!1,t),s=Ha(e);const f=Hf(e,s);f<l&&(c=0,u=Zi(s),l=f)}s=Xf(e),Ll(e,s);for(let d=0,c=0;c<4;++d,++c){Kf(d%2?a:i,d%4>=2,!0,t),s=Ha(e);const f=Hf(e,s);f<l&&(c=0,u=Zi(s),l=f)}Ll(e,u)},Yf=(e,t,n)=>t.map(r=>YT(e,r,n)),Kf=(e,t,n,r)=>{const o=new cr;e==null||e.forEach(a=>{var i;const s=a.graph().root,l=Th(a,s,o,t,n,r);for(let u=0;u<((i=l.vs)===null||i===void 0?void 0:i.length);u++){const d=a.node(l.vs[u]);d&&(d.order=u)}qT(a,o,l.vs)})},Ll=(e,t)=>{t==null||t.forEach(n=>{n==null||n.forEach((r,o)=>{e.node(r).order=o})})};class iI extends ia{}const sI=(e,t)=>{const n={},r=(o,a)=>{let i=0,s=0;const l=o.length,u=a==null?void 0:a[(a==null?void 0:a.length)-1];return a==null||a.forEach((d,c)=>{var f;const h=uI(e,d),m=h?e.node(h).order:l;(h||d===u)&&((f=a.slice(s,c+1))===null||f===void 0||f.forEach(v=>{var b;(b=e.predecessors(v))===null||b===void 0||b.forEach(w=>{var L;const z=e.node(w),K=z.order;(K<i||m<K)&&!(z.dummy&&(!((L=e.node(v))===null||L===void 0)&&L.dummy))&&Ih(n,w,v)})}),s=c+1,i=m)}),a};return t!=null&&t.length&&t.reduce(r),n},lI=(e,t)=>{const n={};function r(s,l,u,d,c){var f,h;let m;for(let v=l;v<u;v++)m=s[v],!((f=e.node(m))===null||f===void 0)&&f.dummy&&((h=e.predecessors(m))===null||h===void 0||h.forEach(b=>{const w=e.node(b);w.dummy&&(w.order<d||w.order>c)&&Ih(n,b,m)}))}function o(s){return JSON.stringify(s.slice(1))}function a(s,l){const u=o(s);l.get(u)||(r(...s),l.set(u,!0))}const i=(s,l)=>{let u=-1,d,c=0;const f=new Map;return l==null||l.forEach((h,m)=>{var v;if(((v=e.node(h))===null||v===void 0?void 0:v.dummy)==="border"){const b=e.predecessors(h)||[];b.length&&(d=e.node(b[0]).order,a([l,c,m,u,d],f),c=m,u=d)}a([l,c,l.length,d,s.length],f)}),l};return t!=null&&t.length&&t.reduce(i),n},uI=(e,t)=>{var n,r;if(!((n=e.node(t))===null||n===void 0)&&n.dummy)return(r=e.predecessors(t))===null||r===void 0?void 0:r.find(o=>e.node(o).dummy)},Ih=(e,t,n)=>{let r=t,o=n;if(r>o){const i=r;r=o,o=i}let a=e[r];a||(e[r]=a={}),a[o]=!0},dI=(e,t,n)=>{let r=t,o=n;if(r>o){const a=t;r=o,o=a}return!!e[r]},cI=(e,t,n,r)=>{const o={},a={},i={};return t==null||t.forEach(s=>{s==null||s.forEach((l,u)=>{o[l]=l,a[l]=l,i[l]=u})}),t==null||t.forEach(s=>{let l=-1;s==null||s.forEach(u=>{let d=r(u);if(d.length){d=d.sort((f,h)=>i[f]-i[h]);const c=(d.length-1)/2;for(let f=Math.floor(c),h=Math.ceil(c);f<=h;++f){const m=d[f];a[u]===u&&l<i[m]&&!dI(n,u,m)&&(a[m]=u,a[u]=o[u]=o[m],l=i[m])}}})}),{root:o,align:a}},fI=(e,t,n,r,o)=>{var a;const i={},s=pI(e,t,n,o),l=o?"borderLeft":"borderRight",u=(f,h)=>{let m=s.nodes(),v=m.pop();const b={};for(;v;)b[v]?f(v):(b[v]=!0,m.push(v),m=m.concat(h(v))),v=m.pop()},d=f=>{i[f]=(s.inEdges(f)||[]).reduce((h,m)=>Math.max(h,(i[m.v]||0)+s.edge(m)),0)},c=f=>{const h=(s.outEdges(f)||[]).reduce((v,b)=>Math.min(v,(i[b.w]||0)-s.edge(b)),Number.POSITIVE_INFINITY),m=e.node(f);h!==Number.POSITIVE_INFINITY&&m.borderType!==l&&(i[f]=Math.max(i[f],h))};return u(d,s.predecessors.bind(s)),u(c,s.successors.bind(s)),(a=Object.values(r))===null||a===void 0||a.forEach(f=>{i[f]=i[n[f]]}),i},pI=(e,t,n,r)=>{const o=new iI,a=e.graph(),i=_I(a.nodesep,a.edgesep,r);return t==null||t.forEach(s=>{let l;s==null||s.forEach(u=>{const d=n[u];if(o.setNode(d),l){const c=n[l],f=o.edgeFromArgs(c,d);o.setEdge(c,d,Math.max(i(e,u,l),f||0))}l=u})}),o},hI=(e,t)=>Du(Object.values(t),n=>{var r;let o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;return(r=Object.keys(n))===null||r===void 0||r.forEach(i=>{const s=n[i],l=bI(e,i)/2;o=Math.max(s+l,o),a=Math.min(s-l,a)}),o-a});function mI(e,t){const n=Object.values(t),r=$f(n),o=ru(n);["u","d"].forEach(a=>{["l","r"].forEach(i=>{const s=a+i,l=e[s];let u;if(l===t)return;const d=Object.values(l);u=i==="l"?r-$f(d):o-ru(d),u&&(e[s]={},Object.keys(l).forEach(c=>{e[s][c]=l[c]+u}))})})}const vI=(e,t)=>{const n={};return Object.keys(e.ul).forEach(r=>{if(t)n[r]=e[t.toLowerCase()][r];else{const o=Object.values(e).map(a=>a[r]);n[r]=(o[0]+o[1])/2}}),n},_I=(e,t,n)=>(r,o,a)=>{const i=r.node(o),s=r.node(a);let l=0,u;if(l+=i.width/2,i.hasOwnProperty("labelpos"))switch((i.labelpos||"").toLowerCase()){case"l":u=-i.width/2;break;case"r":u=i.width/2;break}if(u&&(l+=n?u:-u),u=0,l+=(i.dummy?t:e)/2,l+=(s.dummy?t:e)/2,l+=s.width/2,s.labelpos)switch((s.labelpos||"").toLowerCase()){case"l":u=s.width/2;break;case"r":u=-s.width/2;break}return u&&(l+=n?u:-u),u=0,l},bI=(e,t)=>e.node(t).width||0,yI=e=>{const t=Ha(e),n=e.graph().ranksep;let r=0;t==null||t.forEach(o=>{const a=o.map(s=>e.node(s).height),i=Math.max(...a,0);o==null||o.forEach(s=>{e.node(s).y=r+i/2}),r+=i+n})},gI=e=>{const t=Ha(e),n=Object.assign(sI(e,t),lI(e,t)),r={};let o=[];["u","d"].forEach(i=>{o=i==="u"?t:Object.values(t).reverse(),["l","r"].forEach(s=>{s==="r"&&(o=o.map(c=>Object.values(c).reverse()));const l=(i==="u"?e.predecessors:e.successors).bind(e),u=cI(e,o,n,l),d=fI(e,o,u.root,u.align,s==="r");s==="r"&&Object.keys(d).forEach(c=>d[c]=-d[c]),r[i+s]=d})});const a=hI(e,r);return a&&mI(r,a),vI(r,e.graph().align)},EI=e=>{var t;const n=uh(e);yI(n);const r=gI(n);(t=Object.keys(r))===null||t===void 0||t.forEach(o=>{n.node(o).x=r[o]})},TI=(e,t)=>{const r=e.nodes().filter(i=>{var s;return!(!((s=e.children(i))===null||s===void 0)&&s.length)}).map(i=>e.node(i).rank),o=Math.max(...r),a=[];for(let i=0;i<o+1;i++)a[i]=[];t==null||t.forEach(i=>{const s=e.node(i);!s||s!=null&&s.dummy||isNaN(s.rank)||(s.fixorder=a[s.rank].length,a[s.rank].push(i))})},II=(e,t)=>{const n=t&&t.debugTiming?ch:fh;n("layout",()=>{t&&!t.keepNodeOrder&&t.prevGraph&&n("  inheritOrder",()=>{wI(e,t.prevGraph)});const r=n("  buildLayoutGraph",()=>LI(e));t&&t.edgeLabelSpace===!1||n("  makeSpaceForEdgeLabels",()=>{MI(r)});try{n("  runLayout",()=>{SI(r,n,t)})}catch(o){if(o.message==="Not possible to find intersection inside of the rectangle"){console.error(`The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:
`,o);return}throw o}n("  updateInputGraph",()=>{AI(e,r)})})},SI=(e,t,n)=>{t("    removeSelfEdges",()=>{zI(e)}),t("    acyclic",()=>{Mf.run(e)}),t("    nestingGraph.run",()=>{Uf.run(e)}),t("    rank",()=>{CT(uh(e))}),t("    injectEdgeLabelProxies",()=>{DI(e)}),t("    removeEmptyRanks",()=>{uT(e)}),t("    nestingGraph.cleanup",()=>{Uf.cleanup(e)}),t("    normalizeRanks",()=>{lT(e)}),t("    assignRankMinMax",()=>{PI(e)}),t("    removeEdgeLabelProxies",()=>{kI(e)}),t("    normalize.run",()=>{kf.run(e)}),t("    parentDummyChains",()=>{MT(e)}),t("    addBorderSegments",()=>{BT(e)}),n&&n.keepNodeOrder&&t("    initDataOrder",()=>{TI(e,n.nodeOrder)}),t("    order",()=>{aI(e,n==null?void 0:n.keepNodeOrder)}),t("    insertSelfEdges",()=>{$I(e)}),t("    adjustCoordinateSystem",()=>{zf.adjust(e)}),t("    position",()=>{EI(e)}),t("    positionSelfEdges",()=>{XI(e)}),t("    removeBorderNodes",()=>{jI(e)}),t("    normalize.undo",()=>{kf.undo(e)}),t("    fixupEdgeLabelCoords",()=>{UI(e)}),t("    undoCoordinateSystem",()=>{zf.undo(e)}),t("    translateGraph",()=>{VI(e)}),t("    assignNodeIntersects",()=>{BI(e)}),t("    reversePoints",()=>{GI(e)}),t("    acyclic.undo",()=>{Mf.undo(e)})},wI=(e,t)=>{e.nodes().forEach(n=>{const r=e.node(n),o=t.node(n);o!==void 0?(r.fixorder=o._order,delete o._order):delete r.fixorder})},AI=(e,t)=>{e.nodes().forEach(n=>{var r;const o=e.node(n);if(o){const a=t.node(n);o.x=a.x,o.y=a.y,o._order=a.order,o._rank=a.rank,!((r=t.children(n))===null||r===void 0)&&r.length&&(o.width=a.width,o.height=a.height)}}),e.edges().forEach(n=>{const r=e.edge(n),o=t.edge(n);r.points=o?o.points:[],o&&o.hasOwnProperty("x")&&(r.x=o.x,r.y=o.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height},xI=["nodesep","edgesep","ranksep","marginx","marginy"],RI={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Ml=["acyclicer","ranker","rankdir","align"],CI=["width","height","layer","fixorder"],NI={width:0,height:0},OI=["minlen","weight","width","height","labeloffset"],FI={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},Dl=["labelpos"],LI=e=>{const t=new cr({multigraph:!0,compound:!0}),n=kl(e.graph()),r={};return Ml==null||Ml.forEach(o=>{n[o]!==void 0&&(r[o]=n[o])}),t.setGraph(Object.assign({},RI,Pl(n,xI),r)),e.nodes().forEach(o=>{const a=kl(e.node(o)),i=Object.assign(Object.assign({},NI),a),s=Pl(i,CI);t.setNode(o,s),t.setParent(o,e.parent(o))}),e.edges().forEach(o=>{const a=kl(e.edge(o)),i={};Dl==null||Dl.forEach(s=>{a[s]!==void 0&&(i[s]=a[s])}),t.setEdgeObj(o,Object.assign({},FI,Pl(a,OI),i))}),t},MI=e=>{const t=e.graph();t.ranksep||(t.ranksep=0),t.ranksep/=2,e.nodes().forEach(n=>{const r=e.node(n);isNaN(r.layer)||r.layer||(r.layer=0)}),e.edges().forEach(n=>{var r;const o=e.edge(n);o.minlen*=2,((r=o.labelpos)===null||r===void 0?void 0:r.toLowerCase())!=="c"&&(t.rankdir==="TB"||t.rankdir==="BT"?o.width+=o.labeloffset:o.height+=o.labeloffset)})},DI=e=>{e.edges().forEach(t=>{const n=e.edge(t);if(n.width&&n.height){const r=e.node(t.v),o=e.node(t.w),a={e:t,rank:(o.rank-r.rank)/2+r.rank};sa(e,"edge-proxy",a,"_ep")}})},PI=e=>{let t=0;e.nodes().forEach(n=>{var r,o;const a=e.node(n);a.borderTop&&(a.minRank=(r=e.node(a.borderTop))===null||r===void 0?void 0:r.rank,a.maxRank=(o=e.node(a.borderBottom))===null||o===void 0?void 0:o.rank,t=Math.max(t,a.maxRank||-1/0))}),e.graph().maxRank=t},kI=e=>{e.nodes().forEach(t=>{const n=e.node(t);n.dummy==="edge-proxy"&&(e.edge(n.e).labelRank=n.rank,e.removeNode(t))})},VI=e=>{let t,n=0,r,o=0;const a=e.graph(),i=a.marginx||0,s=a.marginy||0,l=u=>{if(!u)return;const d=u.x,c=u.y,f=u.width,h=u.height;!isNaN(d)&&!isNaN(f)&&(t===void 0&&(t=d-f/2),t=Math.min(t,d-f/2),n=Math.max(n,d+f/2)),!isNaN(c)&&!isNaN(h)&&(r===void 0&&(r=c-h/2),r=Math.min(r,c-h/2),o=Math.max(o,c+h/2))};e.nodes().forEach(u=>{l(e.node(u))}),e.edges().forEach(u=>{const d=e.edge(u);d!=null&&d.hasOwnProperty("x")&&l(d)}),t-=i,r-=s,e.nodes().forEach(u=>{const d=e.node(u);d&&(d.x-=t,d.y-=r)}),e.edges().forEach(u=>{var d;const c=e.edge(u);(d=c.points)===null||d===void 0||d.forEach(f=>{f.x-=t,f.y-=r}),c.hasOwnProperty("x")&&(c.x-=t),c.hasOwnProperty("y")&&(c.y-=r)}),a.width=n-t+i,a.height=o-r+s},BI=e=>{e.edges().forEach(t=>{const n=e.edge(t),r=e.node(t.v),o=e.node(t.w);let a,i;n.points?(a=n.points[0],i=n.points[n.points.length-1]):(n.points=[],a=o,i=r),n.points.unshift(Df(r,a)),n.points.push(Df(o,i))})},UI=e=>{e.edges().forEach(t=>{const n=e.edge(t);if(n!=null&&n.hasOwnProperty("x"))switch((n.labelpos==="l"||n.labelpos==="r")&&(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset;break}})},GI=e=>{e.edges().forEach(t=>{var n;const r=e.edge(t);r.reversed&&((n=r.points)===null||n===void 0||n.reverse())})},jI=e=>{e.nodes().forEach(t=>{var n,r,o;if(!((n=e.children(t))===null||n===void 0)&&n.length){const a=e.node(t),i=e.node(a.borderTop),s=e.node(a.borderBottom),l=e.node(a.borderLeft[((r=a.borderLeft)===null||r===void 0?void 0:r.length)-1]),u=e.node(a.borderRight[((o=a.borderRight)===null||o===void 0?void 0:o.length)-1]);a.width=Math.abs((u==null?void 0:u.x)-(l==null?void 0:l.x))||10,a.height=Math.abs((s==null?void 0:s.y)-(i==null?void 0:i.y))||10,a.x=((l==null?void 0:l.x)||0)+a.width/2,a.y=((i==null?void 0:i.y)||0)+a.height/2}}),e.nodes().forEach(t=>{var n;((n=e.node(t))===null||n===void 0?void 0:n.dummy)==="border"&&e.removeNode(t)})},zI=e=>{e.edges().forEach(t=>{if(t.v===t.w){const n=e.node(t.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdgeObj(t)}})},$I=e=>{const t=Ha(e);t==null||t.forEach(n=>{let r=0;n==null||n.forEach((o,a)=>{var i;const s=e.node(o);s.order=a+r,(i=s.selfEdges)===null||i===void 0||i.forEach(l=>{sa(e,"selfedge",{width:l.label.width,height:l.label.height,rank:s.rank,order:a+ ++r,e:l.e,label:l.label},"_se")}),delete s.selfEdges})})},XI=e=>{e.nodes().forEach(t=>{const n=e.node(t);if(n.dummy==="selfedge"){const r=e.node(n.e.v),o=r.x+r.width/2,a=r.y,i=n.x-o,s=r.height/2;e.setEdgeObj(n.e,n.label),e.removeNode(t),n.label.points=[{x:o+2*i/3,y:a-s},{x:o+5*i/6,y:a-s},{y:a,x:o+i},{x:o+5*i/6,y:a+s},{x:o+2*i/3,y:a+s}],n.label.x=n.x,n.label.y=n.y}})},Pl=(e,t)=>{const n={};return t==null||t.forEach(r=>{e[r]!==void 0&&(n[r]=+e[r])}),n},kl=(e={})=>{const t={};return Object.keys(e).forEach(n=>{t[n.toLowerCase()]=e[n]}),t},HI={layout:II,util:{time:ch,notime:fh}};class WI extends dE{constructor(t){super(),this.rankdir="TB",this.nodesep=50,this.ranksep=50,this.controlPoints=!1,this.sortByCombo=!1,this.edgeLabelSpace=!0,this.radial=!1,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.layoutNode=n=>{const r=this,{nodes:o}=r,a=o.find(i=>i.id===n);return a?a.layout!==!1:!0},this.updateCfg(t)}getDefaultCfg(){return{rankdir:"TB",align:void 0,nodeSize:void 0,nodesepFunc:void 0,ranksepFunc:void 0,nodesep:50,ranksep:50,controlPoints:!1,radial:!1,focusNode:null}}execute(){var t,n,r,o;const a=this,{nodes:i,nodeSize:s,rankdir:l,combos:u,begin:d,radial:c,comboEdges:f=[],vedges:h=[]}=a;if(!i)return;const m=a.edges||[],v=new cr({multigraph:!0,compound:!0});a.nodeMap={};const b={};i.forEach(ae=>{a.nodeMap[ae.id]=ae,ae.comboId&&(b[ae.comboId]=b[ae.comboId]||[],b[ae.comboId].push(ae.id))});let w=[];const L={};!((t=a.nodeOrder)===null||t===void 0)&&t.length?(a.nodeOrder.forEach(ae=>{L[ae]=!0,w.push(a.nodeMap[ae])}),i.forEach(ae=>{L[ae.id]||w.push(ae)})):w=i;let z;s?Ef(s)?z=()=>s:z=()=>[s,s]:z=ae=>ae.size?Ef(ae.size)?ae.size:nh(ae.size)?[ae.size.width||40,ae.size.height||40]:[ae.size,ae.size]:[40,40];const K=Tf(a.ranksep,50,a.ranksepFunc),he=Tf(a.nodesep,50,a.nodesepFunc);let Fe=he,Oe=K;(l==="LR"||l==="RL")&&(Fe=K,Oe=he),v.setDefaultEdgeLabel(()=>({})),v.setGraph(a);const at={};this.sortByCombo&&u&&u.forEach(ae=>{if(at[ae.id]=ae,ae.collapsed){const st=z(ae),yt=Oe(ae),bt=Fe(ae),kt=st[0]+2*bt,Je=st[1]+2*yt;v.setNode(ae.id,{width:kt,height:Je})}ae.parentId&&(at[ae.parentId]||v.setNode(ae.parentId,{}),v.setParent(ae.id,ae.parentId))}),w.filter(ae=>ae.layout!==!1).forEach(ae=>{const st=z(ae),yt=Oe(ae),bt=Fe(ae),kt=st[0]+2*bt,Je=st[1]+2*yt,et=ae.layer;Qi(et)?v.setNode(ae.id,{width:kt,height:Je,layer:et}):v.setNode(ae.id,{width:kt,height:Je}),this.sortByCombo&&ae.comboId&&(at[ae.comboId]||(at[ae.comboId]={id:ae.comboId},v.setNode(ae.comboId,{})),v.setParent(ae.id,ae.comboId))}),m.forEach(ae=>{const st=Do(ae,"source"),yt=Do(ae,"target");this.layoutNode(st)&&this.layoutNode(yt)&&v.setEdge(st,yt,{weight:ae.weight||1})}),(n=f==null?void 0:f.concat(h||[]))===null||n===void 0||n.forEach(ae=>{var st,yt;const{source:bt,target:kt}=ae,Je=!((st=at[bt])===null||st===void 0)&&st.collapsed?[bt]:b[bt]||[bt],et=!((yt=at[kt])===null||yt===void 0)&&yt.collapsed?[kt]:b[kt]||[kt];Je.forEach(ut=>{et.forEach(tt=>{v.setEdge(ut,tt,{weight:ae.weight||1})})})});let ke;!((r=a.preset)===null||r===void 0)&&r.nodes&&(ke=new cr({multigraph:!0,compound:!0}),a.preset.nodes.forEach(ae=>{ke==null||ke.setNode(ae.id,ae)})),HI.layout(v,{prevGraph:ke,edgeLabelSpace:a.edgeLabelSpace,keepNodeOrder:!!a.nodeOrder,nodeOrder:a.nodeOrder});const ze=[0,0];if(d){let ae=1/0,st=1/0;v.nodes().forEach(yt=>{const bt=v.node(yt);ae>bt.x&&(ae=bt.x),st>bt.y&&(st=bt.y)}),v.edges().forEach(yt=>{var bt;(bt=v.edge(yt).points)===null||bt===void 0||bt.forEach(Je=>{ae>Je.x&&(ae=Je.x),st>Je.y&&(st=Je.y)})}),ze[0]=d[0]-ae,ze[1]=d[1]-st}const He=l==="LR"||l==="RL";if(c){const{focusNode:ae,ranksep:st,getRadialPos:yt}=this,bt=cE(ae)?ae:ae==null?void 0:ae.id,kt=bt?(o=v.node(bt))===null||o===void 0?void 0:o._rank:0,Je=[],et=He?"y":"x",ut=He?"height":"width";let tt=1/0,Ht=-1/0;v.nodes().forEach(ct=>{const ht=v.node(ct);if(!a.nodeMap[ct])return;const pn=he(a.nodeMap[ct]);if(kt===0)Je[ht._rank]||(Je[ht._rank]={nodes:[],totalWidth:0,maxSize:-1/0}),Je[ht._rank].nodes.push(ct),Je[ht._rank].totalWidth+=pn*2+ht[ut],Je[ht._rank].maxSize<Math.max(ht.width,ht.height)&&(Je[ht._rank].maxSize=Math.max(ht.width,ht.height));else{const At=ht._rank-kt;if(At===0)Je[At]||(Je[At]={nodes:[],totalWidth:0,maxSize:-1/0}),Je[At].nodes.push(ct),Je[At].totalWidth+=pn*2+ht[ut],Je[At].maxSize<Math.max(ht.width,ht.height)&&(Je[At].maxSize=Math.max(ht.width,ht.height));else{const Mt=Math.abs(At);Je[Mt]||(Je[Mt]={left:[],right:[],totalWidth:0,maxSize:-1/0}),Je[Mt].totalWidth+=pn*2+ht[ut],Je[Mt].maxSize<Math.max(ht.width,ht.height)&&(Je[Mt].maxSize=Math.max(ht.width,ht.height)),At<0?Je[Mt].left.push(ct):Je[Mt].right.push(ct)}}const gn=ht[et]-ht[ut]/2-pn,ln=ht[et]+ht[ut]/2+pn;gn<tt&&(tt=gn),ln>Ht&&(Ht=ln)});let Vt=st||50;const _n={},Un=(Ht-tt)/.9,ri=[(tt+Ht-Un)*.5,(tt+Ht+Un)*.5],da=(ct,ht,pn=-1/0,gn=[0,1])=>{let ln=pn;return ct.forEach(At=>{const Mt=v.node(At);_n[At]=ht;const{x:Sn,y:bn}=yt(Mt[et],ri,Un,ht,gn);if(!a.nodeMap[At])return;a.nodeMap[At].x=Sn+ze[0],a.nodeMap[At].y=bn+ze[1],a.nodeMap[At]._order=Mt._order;const Rt=K(a.nodeMap[At]);ln<Rt&&(ln=Rt)}),ln};let ca=!0;const Cs=0;Je.forEach(ct=>{var ht,pn,gn,ln,At,Mt,Sn;if(!(!((ht=ct==null?void 0:ct.nodes)===null||ht===void 0)&&ht.length)&&!(!((pn=ct==null?void 0:ct.left)===null||pn===void 0)&&pn.length)&&!(!((gn=ct==null?void 0:ct.right)===null||gn===void 0)&&gn.length))return;if(ca&&ct.nodes.length===1){const Rt=ct.nodes[0];if(!a.nodeMap[Rt])return;a.nodeMap[Rt].x=ze[0],a.nodeMap[Rt].y=ze[1],_n[ct.nodes[0]]=0,Vt=K(a.nodeMap[Rt]),ca=!1;return}Vt=Math.max(Vt,ct.totalWidth/(2*Math.PI));let bn=-1/0;if(kt===0||!((ln=ct.nodes)===null||ln===void 0)&&ln.length)bn=da(ct.nodes,Vt,bn,[0,1]);else{const Rt=((At=ct.left)===null||At===void 0?void 0:At.length)/(((Mt=ct.left)===null||Mt===void 0?void 0:Mt.length)+((Sn=ct.right)===null||Sn===void 0?void 0:Sn.length));bn=da(ct.left,Vt,bn,[0,Rt]),bn=da(ct.right,Vt,bn,[Rt+.05,1])}Vt+=bn,ca=!1,Cs-ct.maxSize}),v.edges().forEach(ct=>{var ht,pn,gn;const ln=v.edge(ct),At=m.findIndex(Mt=>{const Sn=Do(Mt,"source"),bn=Do(Mt,"target");return Sn===ct.v&&bn===ct.w});if(!(At<=-1)&&a.edgeLabelSpace&&a.controlPoints&&m[At].type!=="loop"){const Mt=et==="x"?"y":"x",Sn=(ht=ln==null?void 0:ln.points)===null||ht===void 0?void 0:ht.slice(1,ln.points.length-1),bn=[],Rt=(pn=v.node(ct.v))===null||pn===void 0?void 0:pn[Mt],oi=Rt-((gn=v.node(ct.w))===null||gn===void 0?void 0:gn[Mt]),jr=_n[ct.v],Ns=jr-_n[ct.w];Sn==null||Sn.forEach(ai=>{const T=(ai[Mt]-Rt)/oi*Ns+jr,ii=yt(ai[et],ri,Un,T);bn.push({x:ii.x+ze[0],y:ii.y+ze[1]})}),m[At].controlPoints=bn}})}else{const ae=new Set,yt=l==="BT"||l==="RL"?(et,ut)=>ut-et:(et,ut)=>et-ut;v.nodes().forEach(et=>{const ut=v.node(et);if(!ut)return;let tt=this.nodeMap[et];tt||(tt=u==null?void 0:u.find(Ht=>Ht.id===et)),tt&&(tt.x=ut.x+ze[0],tt.y=ut.y+ze[1],tt._order=ut._order,ae.add(He?tt.x:tt.y))});const bt=Array.from(ae).sort(yt),kt=He?(et,ut)=>et.x!==ut.x:(et,ut)=>et.y!==ut.y,Je=He?(et,ut,tt)=>{const Ht=Math.max(ut.y,tt.y),Vt=Math.min(ut.y,tt.y);return et.filter(_n=>_n.y<=Ht&&_n.y>=Vt)}:(et,ut,tt)=>{const Ht=Math.max(ut.x,tt.x),Vt=Math.min(ut.x,tt.x);return et.filter(_n=>_n.x<=Ht&&_n.x>=Vt)};v.edges().forEach(et=>{var ut;const tt=v.edge(et),Ht=m.findIndex(Vt=>{const _n=Do(Vt,"source"),Un=Do(Vt,"target");return _n===et.v&&Un===et.w});if(!(Ht<=-1)&&a.edgeLabelSpace&&a.controlPoints&&m[Ht].type!=="loop"){(ut=tt==null?void 0:tt.points)===null||ut===void 0||ut.forEach(Un=>{Un.x+=ze[0],Un.y+=ze[1]});const Vt=a.nodeMap[et.v],_n=a.nodeMap[et.w];m[Ht].controlPoints=YI(tt==null?void 0:tt.points,Vt,_n,bt,He,kt,Je)}})}return a.onLayoutEnd&&a.onLayoutEnd(),{nodes:i,edges:m}}getRadialPos(t,n,r,o,a=[0,1]){let i=(t-n[0])/r;i=i*(a[1]-a[0])+a[0];const s=i*2*Math.PI;return{x:Math.cos(s)*o,y:Math.sin(s)*o}}getType(){return"dagre"}}const YI=(e,t,n,r,o,a,i)=>{let s=(e==null?void 0:e.slice(1,e.length-1))||[];if(t&&n){let{x:l,y:u}=t,{x:d,y:c}=n;if(o&&(l=t.y,u=t.x,d=n.y,c=n.x),c!==u&&l!==d){const f=r.indexOf(u),h=r[f+1];if(h){const b=s[0],w=o?{x:(u+h)/2,y:(b==null?void 0:b.y)||d}:{x:(b==null?void 0:b.x)||d,y:(u+h)/2};(!b||a(b,w))&&s.unshift(w)}const m=r.indexOf(c),v=Math.abs(m-f);if(v===1)s=i(s,t,n),s.length||s.push(o?{x:(u+c)/2,y:l}:{x:l,y:(u+c)/2});else if(v>1){const b=r[m-1];if(b){const w=s[s.length-1],L=o?{x:(c+b)/2,y:(w==null?void 0:w.y)||d}:{x:(w==null?void 0:w.x)||l,y:(c+b)/2};(!w||a(w,L))&&s.push(L)}}}}return s};var qf,Qf,Zf,Jf;(function(e){e[e.META=0]="META",e[e.NODE=1]="NODE",e[e.BRIDGE=2]="BRIDGE"})(qf||(qf={})),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE",e[e.UNSPECIFIED=2]="UNSPECIFIED"}(Qf||(Qf={})),function(e){e[e.META=0]="META",e[e.CORE=1]="CORE",e[e.BRIDGE=2]="BRIDGE"}(Zf||(Zf={})),function(e){e[e.META=0]="META",e[e.OP=1]="OP",e[e.SERIES=2]="SERIES"}(Jf||(Jf={}));var Bi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pu(e,t){return e(t={exports:{}},t.exports),t.exports}var KI=function(){this.__data__=[],this.size=0},la=function(e,t){return e===t||e!=e&&t!=t},ms=function(e,t){for(var n=e.length;n--;)if(la(e[n][0],t))return n;return-1},qI=Array.prototype.splice,QI=function(e){var t=this.__data__,n=ms(t,e);return!(n<0)&&(n==t.length-1?t.pop():qI.call(t,n,1),--this.size,!0)},ZI=function(e){var t=this.__data__,n=ms(t,e);return n<0?void 0:t[n][1]},JI=function(e){return ms(this.__data__,e)>-1},eS=function(e,t){var n=this.__data__,r=ms(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Po(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Po.prototype.clear=KI,Po.prototype.delete=QI,Po.prototype.get=ZI,Po.prototype.has=JI,Po.prototype.set=eS;var vs=Po,tS=function(){this.__data__=new vs,this.size=0},nS=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},rS=function(e){return this.__data__.get(e)},oS=function(e){return this.__data__.has(e)},Sh=typeof Bi=="object"&&Bi&&Bi.Object===Object&&Bi,aS=typeof self=="object"&&self&&self.Object===Object&&self,Yn=Sh||aS||Function("return this")(),Bn=Yn.Symbol,wh=Object.prototype,iS=wh.hasOwnProperty,sS=wh.toString,Fa=Bn?Bn.toStringTag:void 0,lS=function(e){var t=iS.call(e,Fa),n=e[Fa];try{e[Fa]=void 0;var r=!0}catch{}var o=sS.call(e);return r&&(t?e[Fa]=n:delete e[Fa]),o},uS=Object.prototype.toString,dS=function(e){return uS.call(e)},ep=Bn?Bn.toStringTag:void 0,Vr=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":ep&&ep in Object(e)?lS(e):dS(e)},Rn=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},tp,Qa=function(e){if(!Rn(e))return!1;var t=Vr(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Vl=Yn["__core-js_shared__"],np=(tp=/[^.]+$/.exec(Vl&&Vl.keys&&Vl.keys.IE_PROTO||""))?"Symbol(src)_1."+tp:"",cS=function(e){return!!np&&np in e},fS=Function.prototype.toString,po=function(e){if(e!=null){try{return fS.call(e)}catch{}try{return e+""}catch{}}return""},pS=/^\[object .+?Constructor\]$/,hS=Function.prototype,mS=Object.prototype,vS=hS.toString,_S=mS.hasOwnProperty,bS=RegExp("^"+vS.call(_S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yS=function(e){return!(!Rn(e)||cS(e))&&(Qa(e)?bS:pS).test(po(e))},gS=function(e,t){return e==null?void 0:e[t]},ho=function(e,t){var n=gS(e,t);return yS(n)?n:void 0},Wa=ho(Yn,"Map"),Ya=ho(Object,"create"),ES=function(){this.__data__=Ya?Ya(null):{},this.size=0},TS=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},IS=Object.prototype.hasOwnProperty,SS=function(e){var t=this.__data__;if(Ya){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return IS.call(t,e)?t[e]:void 0},wS=Object.prototype.hasOwnProperty,AS=function(e){var t=this.__data__;return Ya?t[e]!==void 0:wS.call(t,e)},xS=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ya&&t===void 0?"__lodash_hash_undefined__":t,this};function ko(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ko.prototype.clear=ES,ko.prototype.delete=TS,ko.prototype.get=SS,ko.prototype.has=AS,ko.prototype.set=xS;var rp=ko,RS=function(){this.size=0,this.__data__={hash:new rp,map:new(Wa||vs),string:new rp}},CS=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},_s=function(e,t){var n=e.__data__;return CS(t)?n[typeof t=="string"?"string":"hash"]:n.map},NS=function(e){var t=_s(this,e).delete(e);return this.size-=t?1:0,t},OS=function(e){return _s(this,e).get(e)},FS=function(e){return _s(this,e).has(e)},LS=function(e,t){var n=_s(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Vo(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Vo.prototype.clear=RS,Vo.prototype.delete=NS,Vo.prototype.get=OS,Vo.prototype.has=FS,Vo.prototype.set=LS;var bs=Vo,MS=function(e,t){var n=this.__data__;if(n instanceof vs){var r=n.__data__;if(!Wa||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new bs(r)}return n.set(e,t),this.size=n.size,this};function Bo(e){var t=this.__data__=new vs(e);this.size=t.size}Bo.prototype.clear=tS,Bo.prototype.delete=nS,Bo.prototype.get=rS,Bo.prototype.has=oS,Bo.prototype.set=MS;var $o=Bo,ku=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e},Ji=function(){try{var e=ho(Object,"defineProperty");return e({},"",{}),e}catch{}}(),ys=function(e,t,n){t=="__proto__"&&Ji?Ji(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},DS=Object.prototype.hasOwnProperty,gs=function(e,t,n){var r=e[t];DS.call(e,t)&&la(r,n)&&(n!==void 0||t in e)||ys(e,t,n)},Za=function(e,t,n,r){var o=!n;n||(n={});for(var a=-1,i=t.length;++a<i;){var s=t[a],l=r?r(n[s],e[s],s,n,e):void 0;l===void 0&&(l=e[s]),o?ys(n,s,l):gs(n,s,l)}return n},PS=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},Hn=function(e){return e!=null&&typeof e=="object"},op=function(e){return Hn(e)&&Vr(e)=="[object Arguments]"},Ah=Object.prototype,kS=Ah.hasOwnProperty,VS=Ah.propertyIsEnumerable,Zo=op(function(){return arguments}())?op:function(e){return Hn(e)&&kS.call(e,"callee")&&!VS.call(e,"callee")},Qt=Array.isArray,BS=function(){return!1},lo=Pu(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,o=r&&r.exports===n?Yn.Buffer:void 0,a=(o?o.isBuffer:void 0)||BS;e.exports=a}),US=/^(?:0|[1-9]\d*)$/,Es=function(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&US.test(e))&&e>-1&&e%1==0&&e<t},Vu=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991},Ot={};Ot["[object Float32Array]"]=Ot["[object Float64Array]"]=Ot["[object Int8Array]"]=Ot["[object Int16Array]"]=Ot["[object Int32Array]"]=Ot["[object Uint8Array]"]=Ot["[object Uint8ClampedArray]"]=Ot["[object Uint16Array]"]=Ot["[object Uint32Array]"]=!0,Ot["[object Arguments]"]=Ot["[object Array]"]=Ot["[object ArrayBuffer]"]=Ot["[object Boolean]"]=Ot["[object DataView]"]=Ot["[object Date]"]=Ot["[object Error]"]=Ot["[object Function]"]=Ot["[object Map]"]=Ot["[object Number]"]=Ot["[object Object]"]=Ot["[object RegExp]"]=Ot["[object Set]"]=Ot["[object String]"]=Ot["[object WeakMap]"]=!1;var GS=function(e){return Hn(e)&&Vu(e.length)&&!!Ot[Vr(e)]},Ts=function(e){return function(t){return e(t)}},Jo=Pu(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,o=r&&r.exports===n&&Sh.process,a=function(){try{var i=r&&r.require&&r.require("util").types;return i||o&&o.binding&&o.binding("util")}catch{}}();e.exports=a}),ap=Jo&&Jo.isTypedArray,Ja=ap?Ts(ap):GS,jS=Object.prototype.hasOwnProperty,xh=function(e,t){var n=Qt(e),r=!n&&Zo(e),o=!n&&!r&&lo(e),a=!n&&!r&&!o&&Ja(e),i=n||r||o||a,s=i?PS(e.length,String):[],l=s.length;for(var u in e)!t&&!jS.call(e,u)||i&&(u=="length"||o&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Es(u,l))||s.push(u);return s},zS=Object.prototype,Is=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||zS)},Rh=function(e,t){return function(n){return e(t(n))}},$S=Rh(Object.keys,Object),XS=Object.prototype.hasOwnProperty,Bu=function(e){if(!Is(e))return $S(e);var t=[];for(var n in Object(e))XS.call(e,n)&&n!="constructor"&&t.push(n);return t},_r=function(e){return e!=null&&Vu(e.length)&&!Qa(e)},Br=function(e){return _r(e)?xh(e):Bu(e)},HS=function(e,t){return e&&Za(t,Br(t),e)},WS=function(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t},YS=Object.prototype.hasOwnProperty,KS=function(e){if(!Rn(e))return WS(e);var t=Is(e),n=[];for(var r in e)(r!="constructor"||!t&&YS.call(e,r))&&n.push(r);return n},mo=function(e){return _r(e)?xh(e,!0):KS(e)},qS=function(e,t){return e&&Za(t,mo(t),e)},Ch=Pu(function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,o=r&&r.exports===n?Yn.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(i,s){if(s)return i.slice();var l=i.length,u=a?a(l):new i.constructor(l);return i.copy(u),u}}),Nh=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},Oh=function(e,t){for(var n=-1,r=e==null?0:e.length,o=0,a=[];++n<r;){var i=e[n];t(i,n,e)&&(a[o++]=i)}return a},Fh=function(){return[]},QS=Object.prototype.propertyIsEnumerable,ip=Object.getOwnPropertySymbols,Uu=ip?function(e){return e==null?[]:(e=Object(e),Oh(ip(e),function(t){return QS.call(e,t)}))}:Fh,ZS=function(e,t){return Za(e,Uu(e),t)},Gu=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e},Ss=Rh(Object.getPrototypeOf,Object),Lh=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Gu(t,Uu(e)),e=Ss(e);return t}:Fh,JS=function(e,t){return Za(e,Lh(e),t)},Mh=function(e,t,n){var r=t(e);return Qt(e)?r:Gu(r,n(e))},ou=function(e){return Mh(e,Br,Uu)},e1=function(e){return Mh(e,mo,Lh)},au=ho(Yn,"DataView"),iu=ho(Yn,"Promise"),Xo=ho(Yn,"Set"),su=ho(Yn,"WeakMap"),t1=po(au),n1=po(Wa),r1=po(iu),o1=po(Xo),a1=po(su),ro=Vr;(au&&ro(new au(new ArrayBuffer(1)))!="[object DataView]"||Wa&&ro(new Wa)!="[object Map]"||iu&&ro(iu.resolve())!="[object Promise]"||Xo&&ro(new Xo)!="[object Set]"||su&&ro(new su)!="[object WeakMap]")&&(ro=function(e){var t=Vr(e),n=t=="[object Object]"?e.constructor:void 0,r=n?po(n):"";if(r)switch(r){case t1:return"[object DataView]";case n1:return"[object Map]";case r1:return"[object Promise]";case o1:return"[object Set]";case a1:return"[object WeakMap]"}return t});var uo=ro,i1=Object.prototype.hasOwnProperty,s1=function(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&i1.call(e,"index")&&(n.index=e.index,n.input=e.input),n},es=Yn.Uint8Array,ju=function(e){var t=new e.constructor(e.byteLength);return new es(t).set(new es(e)),t},l1=function(e,t){var n=t?ju(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},u1=/\w*$/,d1=function(e){var t=new e.constructor(e.source,u1.exec(e));return t.lastIndex=e.lastIndex,t},sp=Bn?Bn.prototype:void 0,lp=sp?sp.valueOf:void 0,c1=function(e){return lp?Object(lp.call(e)):{}},Dh=function(e,t){var n=t?ju(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)},f1=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return ju(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return l1(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Dh(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return d1(e);case"[object Set]":return new r;case"[object Symbol]":return c1(e)}},up=Object.create,Ph=function(){function e(){}return function(t){if(!Rn(t))return{};if(up)return up(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),kh=function(e){return typeof e.constructor!="function"||Is(e)?{}:Ph(Ss(e))},p1=function(e){return Hn(e)&&uo(e)=="[object Map]"},dp=Jo&&Jo.isMap,h1=dp?Ts(dp):p1,m1=function(e){return Hn(e)&&uo(e)=="[object Set]"},cp=Jo&&Jo.isSet,v1=cp?Ts(cp):m1,Nt={};Nt["[object Arguments]"]=Nt["[object Array]"]=Nt["[object ArrayBuffer]"]=Nt["[object DataView]"]=Nt["[object Boolean]"]=Nt["[object Date]"]=Nt["[object Float32Array]"]=Nt["[object Float64Array]"]=Nt["[object Int8Array]"]=Nt["[object Int16Array]"]=Nt["[object Int32Array]"]=Nt["[object Map]"]=Nt["[object Number]"]=Nt["[object Object]"]=Nt["[object RegExp]"]=Nt["[object Set]"]=Nt["[object String]"]=Nt["[object Symbol]"]=Nt["[object Uint8Array]"]=Nt["[object Uint8ClampedArray]"]=Nt["[object Uint16Array]"]=Nt["[object Uint32Array]"]=!0,Nt["[object Error]"]=Nt["[object Function]"]=Nt["[object WeakMap]"]=!1;var Vh=function e(t,n,r,o,a,i){var s,l=1&n,u=2&n,d=4&n;if(r&&(s=a?r(t,o,a,i):r(t)),s!==void 0)return s;if(!Rn(t))return t;var c=Qt(t);if(c){if(s=s1(t),!l)return Nh(t,s)}else{var f=uo(t),h=f=="[object Function]"||f=="[object GeneratorFunction]";if(lo(t))return Ch(t,l);if(f=="[object Object]"||f=="[object Arguments]"||h&&!a){if(s=u||h?{}:kh(t),!l)return u?JS(t,qS(s,t)):ZS(t,HS(s,t))}else{if(!Nt[f])return a?t:{};s=f1(t,f,l)}}i||(i=new $o);var m=i.get(t);if(m)return m;i.set(t,s),v1(t)?t.forEach(function(b){s.add(e(b,n,r,b,t,i))}):h1(t)&&t.forEach(function(b,w){s.set(w,e(b,n,r,w,t,i))});var v=c?void 0:(d?u?e1:ou:u?mo:Br)(t);return ku(v||t,function(b,w){v&&(b=t[w=b]),gs(s,w,e(b,n,r,w,t,i))}),s},_1=function(e){return Vh(e,4)},zu=function(e){return function(){return e}},$u=function(e){return function(t,n,r){for(var o=-1,a=Object(t),i=r(t),s=i.length;s--;){var l=i[e?s:++o];if(n(a[l],l,a)===!1)break}return t}}(),Xu=function(e,t){return e&&$u(e,t,Br)},ws=function(e,t){return function(n,r){if(n==null)return n;if(!_r(n))return e(n,r);for(var o=n.length,a=t?o:-1,i=Object(n);(t?a--:++a<o)&&r(i[a],a,i)!==!1;);return n}}(Xu),vo=function(e){return e},Bh=function(e){return typeof e=="function"?e:vo},Uh=function(e,t){return(Qt(e)?ku:ws)(e,Bh(t))},Gh=Uh,b1=function(e,t){var n=[];return ws(e,function(r,o,a){t(r,o,a)&&n.push(r)}),n},y1=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},g1=function(e){return this.__data__.has(e)};function zi(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new bs;++t<n;)this.add(e[t])}zi.prototype.add=zi.prototype.push=y1,zi.prototype.has=g1;var jh=zi,E1=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},zh=function(e,t){return e.has(t)},$h=function(e,t,n,r,o,a){var i=1&n,s=e.length,l=t.length;if(s!=l&&!(i&&l>s))return!1;var u=a.get(e),d=a.get(t);if(u&&d)return u==t&&d==e;var c=-1,f=!0,h=2&n?new jh:void 0;for(a.set(e,t),a.set(t,e);++c<s;){var m=e[c],v=t[c];if(r)var b=i?r(v,m,c,t,e,a):r(m,v,c,e,t,a);if(b!==void 0){if(b)continue;f=!1;break}if(h){if(!E1(t,function(w,L){if(!zh(h,L)&&(m===w||o(m,w,n,r,a)))return h.push(L)})){f=!1;break}}else if(m!==v&&!o(m,v,n,r,a)){f=!1;break}}return a.delete(e),a.delete(t),f},T1=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r,o){n[++t]=[o,r]}),n},Hu=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n},fp=Bn?Bn.prototype:void 0,Bl=fp?fp.valueOf:void 0,I1=function(e,t,n,r,o,a,i){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new es(e),new es(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return la(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=T1;case"[object Set]":var l=1&r;if(s||(s=Hu),e.size!=t.size&&!l)return!1;var u=i.get(e);if(u)return u==t;r|=2,i.set(e,t);var d=$h(s(e),s(t),r,o,a,i);return i.delete(e),d;case"[object Symbol]":if(Bl)return Bl.call(e)==Bl.call(t)}return!1},S1=Object.prototype.hasOwnProperty,w1=function(e,t,n,r,o,a){var i=1&n,s=ou(e),l=s.length;if(l!=ou(t).length&&!i)return!1;for(var u=l;u--;){var d=s[u];if(!(i?d in t:S1.call(t,d)))return!1}var c=a.get(e),f=a.get(t);if(c&&f)return c==t&&f==e;var h=!0;a.set(e,t),a.set(t,e);for(var m=i;++u<l;){var v=e[d=s[u]],b=t[d];if(r)var w=i?r(b,v,d,t,e,a):r(v,b,d,e,t,a);if(!(w===void 0?v===b||o(v,b,n,r,a):w)){h=!1;break}m||(m=d=="constructor")}if(h&&!m){var L=e.constructor,z=t.constructor;L==z||!("constructor"in e)||!("constructor"in t)||typeof L=="function"&&L instanceof L&&typeof z=="function"&&z instanceof z||(h=!1)}return a.delete(e),a.delete(t),h},pp=Object.prototype.hasOwnProperty,A1=function(e,t,n,r,o,a){var i=Qt(e),s=Qt(t),l=i?"[object Array]":uo(e),u=s?"[object Array]":uo(t),d=(l=l=="[object Arguments]"?"[object Object]":l)=="[object Object]",c=(u=u=="[object Arguments]"?"[object Object]":u)=="[object Object]",f=l==u;if(f&&lo(e)){if(!lo(t))return!1;i=!0,d=!1}if(f&&!d)return a||(a=new $o),i||Ja(e)?$h(e,t,n,r,o,a):I1(e,t,l,n,r,o,a);if(!(1&n)){var h=d&&pp.call(e,"__wrapped__"),m=c&&pp.call(t,"__wrapped__");if(h||m){var v=h?e.value():e,b=m?t.value():t;return a||(a=new $o),o(v,b,n,r,a)}}return!!f&&(a||(a=new $o),w1(e,t,n,r,o,a))},Xh=function e(t,n,r,o,a){return t===n||(t==null||n==null||!Hn(t)&&!Hn(n)?t!=t&&n!=n:A1(t,n,r,o,e,a))},x1=function(e,t,n,r){var o=n.length,a=o,i=!r;if(e==null)return!a;for(e=Object(e);o--;){var s=n[o];if(i&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++o<a;){var l=(s=n[o])[0],u=e[l],d=s[1];if(i&&s[2]){if(u===void 0&&!(l in e))return!1}else{var c=new $o;if(r)var f=r(u,d,l,e,t,c);if(!(f===void 0?Xh(d,u,3,r,c):f))return!1}}return!0},Hh=function(e){return e==e&&!Rn(e)},R1=function(e){for(var t=Br(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,Hh(o)]}return t},Wh=function(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}},C1=function(e){var t=R1(e);return t.length==1&&t[0][2]?Wh(t[0][0],t[0][1]):function(n){return n===e||x1(n,e,t)}},co=function(e){return typeof e=="symbol"||Hn(e)&&Vr(e)=="[object Symbol]"},N1=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,O1=/^\w*$/,Wu=function(e,t){if(Qt(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!co(e))||O1.test(e)||!N1.test(e)||t!=null&&e in Object(t)};function Yu(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var i=e.apply(this,r);return n.cache=a.set(o,i)||a,i};return n.cache=new(Yu.Cache||bs),n}Yu.Cache=bs;var F1=Yu,L1=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,M1=/\\(\\)?/g,D1=function(e){var t=F1(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(L1,function(n,r,o,a){t.push(o?a.replace(M1,"$1"):r||n)}),t}),Ho=function(e,t){for(var n=-1,r=e==null?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o},hp=Bn?Bn.prototype:void 0,mp=hp?hp.toString:void 0,P1=function e(t){if(typeof t=="string")return t;if(Qt(t))return Ho(t,e)+"";if(co(t))return mp?mp.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n},Yh=function(e){return e==null?"":P1(e)},As=function(e,t){return Qt(e)?e:Wu(e,t)?[e]:D1(Yh(e))},ei=function(e){if(typeof e=="string"||co(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},xs=function(e,t){for(var n=0,r=(t=As(t,e)).length;e!=null&&n<r;)e=e[ei(t[n++])];return n&&n==r?e:void 0},k1=function(e,t,n){var r=e==null?void 0:xs(e,t);return r===void 0?n:r},V1=function(e,t){return e!=null&&t in Object(e)},Kh=function(e,t,n){for(var r=-1,o=(t=As(t,e)).length,a=!1;++r<o;){var i=ei(t[r]);if(!(a=e!=null&&n(e,i)))break;e=e[i]}return a||++r!=o?a:!!(o=e==null?0:e.length)&&Vu(o)&&Es(i,o)&&(Qt(e)||Zo(e))},qh=function(e,t){return e!=null&&Kh(e,t,V1)},B1=function(e,t){return Wu(e)&&Hh(t)?Wh(ei(e),t):function(n){var r=k1(n,e);return r===void 0&&r===t?qh(n,e):Xh(t,r,3)}},Qh=function(e){return function(t){return t==null?void 0:t[e]}},U1=function(e){return function(t){return xs(t,e)}},G1=function(e){return Wu(e)?Qh(ei(e)):U1(e)},br=function(e){return typeof e=="function"?e:e==null?vo:typeof e=="object"?Qt(e)?B1(e[0],e[1]):C1(e):G1(e)},Zh=function(e,t){return(Qt(e)?Oh:b1)(e,br(t))},j1=Object.prototype.hasOwnProperty,z1=function(e,t){return e!=null&&j1.call(e,t)},Jh=function(e,t){return e!=null&&Kh(e,t,z1)},$1=Object.prototype.hasOwnProperty,X1=function(e){if(e==null)return!0;if(_r(e)&&(Qt(e)||typeof e=="string"||typeof e.splice=="function"||lo(e)||Ja(e)||Zo(e)))return!e.length;var t=uo(e);if(t=="[object Map]"||t=="[object Set]")return!e.size;if(Is(e))return!Bu(e).length;for(var n in e)if($1.call(e,n))return!1;return!0},em=function(e){return e===void 0},tm=function(e,t){var n=-1,r=_r(e)?Array(e.length):[];return ws(e,function(o,a,i){r[++n]=t(o,a,i)}),r},nm=function(e,t){return(Qt(e)?Ho:tm)(e,br(t))},H1=function(e,t,n,r){var o=-1,a=e==null?0:e.length;for(r&&a&&(n=e[++o]);++o<a;)n=t(n,e[o],o,e);return n},W1=function(e,t,n,r,o){return o(e,function(a,i,s){n=r?(r=!1,a):t(n,a,i,s)}),n},rm=function(e,t,n){var r=Qt(e)?H1:W1,o=arguments.length<3;return r(e,br(t),n,o,ws)},Y1=function(e){return typeof e=="string"||!Qt(e)&&Hn(e)&&Vr(e)=="[object String]"},K1=Qh("length"),q1=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),Q1=function(e){return q1.test(e)},Z1="[\\ud800-\\udfff]",lu="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",uu="\\ud83c[\\udffb-\\udfff]",om="[^\\ud800-\\udfff]",am="(?:\\ud83c[\\udde6-\\uddff]){2}",im="[\\ud800-\\udbff][\\udc00-\\udfff]",vp="(?:"+lu+"|"+uu+")?",J1="[\\ufe0e\\ufe0f]?"+vp+("(?:\\u200d(?:"+[om,am,im].join("|")+")[\\ufe0e\\ufe0f]?"+vp+")*"),ew="(?:"+[om+lu+"?",lu,am,im,Z1].join("|")+")",_p=RegExp(uu+"(?="+uu+")|"+ew+J1,"g"),tw=function(e){for(var t=_p.lastIndex=0;_p.test(e);)++t;return t},nw=function(e){return Q1(e)?tw(e):K1(e)},rw=function(e){if(e==null)return 0;if(_r(e))return Y1(e)?nw(e):e.length;var t=uo(e);return t=="[object Map]"||t=="[object Set]"?e.size:Bu(e).length},ow=function(e,t,n){var r=Qt(e),o=r||lo(e)||Ja(e);if(t=br(t),n==null){var a=e&&e.constructor;n=o?r?new a:[]:Rn(e)&&Qa(a)?Ph(Ss(e)):{}}return(o?ku:Xu)(e,function(i,s,l){return t(n,i,s,l)}),n},bp=Bn?Bn.isConcatSpreadable:void 0,aw=function(e){return Qt(e)||Zo(e)||!!(bp&&e&&e[bp])},Ku=function e(t,n,r,o,a){var i=-1,s=t.length;for(r||(r=aw),a||(a=[]);++i<s;){var l=t[i];n>0&&r(l)?n>1?e(l,n-1,r,o,a):Gu(a,l):o||(a[a.length]=l)}return a},iw=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},yp=Math.max,sm=function(e,t,n){return t=yp(t===void 0?e.length-1:t,0),function(){for(var r=arguments,o=-1,a=yp(r.length-t,0),i=Array(a);++o<a;)i[o]=r[t+o];o=-1;for(var s=Array(t+1);++o<t;)s[o]=r[o];return s[t]=n(i),iw(e,this,s)}},sw=Ji?function(e,t){return Ji(e,"toString",{configurable:!0,enumerable:!1,value:zu(t),writable:!0})}:vo,lw=Date.now,lm=function(e){var t=0,n=0;return function(){var r=lw(),o=16-(r-n);if(n=r,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(sw),Rs=function(e,t){return lm(sm(e,t,vo),e+"")},um=function(e,t,n,r){for(var o=e.length,a=n+(r?1:-1);r?a--:++a<o;)if(t(e[a],a,e))return a;return-1},uw=function(e){return e!=e},dw=function(e,t,n){for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1},cw=function(e,t,n){return t==t?dw(e,t,n):um(e,uw,n)},fw=function(e,t){return!!(e!=null&&e.length)&&cw(e,t,0)>-1},pw=function(e,t,n){for(var r=-1,o=e==null?0:e.length;++r<o;)if(n(t,e[r]))return!0;return!1},hw=function(){},mw=Xo&&1/Hu(new Xo([,-0]))[1]==1/0?function(e){return new Xo(e)}:hw,vw=function(e,t,n){var r=-1,o=fw,a=e.length,i=!0,s=[],l=s;if(n)i=!1,o=pw;else if(a>=200){var u=t?null:mw(e);if(u)return Hu(u);i=!1,o=zh,l=new jh}else l=t?[]:s;e:for(;++r<a;){var d=e[r],c=t?t(d):d;if(d=n||d!==0?d:0,i&&c==c){for(var f=l.length;f--;)if(l[f]===c)continue e;t&&l.push(c),s.push(d)}else o(l,c,n)||(l!==s&&l.push(c),s.push(d))}return s},dm=function(e){return Hn(e)&&_r(e)},_w=Rs(function(e){return vw(Ku(e,1,dm,!0))}),bw=function(e,t){return Ho(t,function(n){return e[n]})},ts,cm=function(e){return e==null?[]:bw(e,Br(e))};try{ts={clone:_1,constant:zu,each:Gh,filter:Zh,has:Jh,isArray:Qt,isEmpty:X1,isFunction:Qa,isUndefined:em,keys:Br,map:nm,reduce:rm,size:rw,transform:ow,union:_w,values:cm}}catch{}ts||(ts=window._);var De=ts,qu=_t;function _t(e){this._isDirected=!De.has(e,"directed")||e.directed,this._isMultigraph=!!De.has(e,"multigraph")&&e.multigraph,this._isCompound=!!De.has(e,"compound")&&e.compound,this._label=void 0,this._defaultNodeLabelFn=De.constant(void 0),this._defaultEdgeLabelFn=De.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children["\0"]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function gp(e,t){e[t]?e[t]++:e[t]=1}function Ep(e,t){--e[t]||delete e[t]}function Pa(e,t,n,r){var o=""+t,a=""+n;if(!e&&o>a){var i=o;o=a,a=i}return o+""+a+""+(De.isUndefined(r)?"\0":r)}function yw(e,t,n,r){var o=""+t,a=""+n;if(!e&&o>a){var i=o;o=a,a=i}var s={v:o,w:a};return r&&(s.name=r),s}function Ul(e,t){return Pa(e,t.v,t.w,t.name)}_t.prototype._nodeCount=0,_t.prototype._edgeCount=0,_t.prototype.isDirected=function(){return this._isDirected},_t.prototype.isMultigraph=function(){return this._isMultigraph},_t.prototype.isCompound=function(){return this._isCompound},_t.prototype.setGraph=function(e){return this._label=e,this},_t.prototype.graph=function(){return this._label},_t.prototype.setDefaultNodeLabel=function(e){return De.isFunction(e)||(e=De.constant(e)),this._defaultNodeLabelFn=e,this},_t.prototype.nodeCount=function(){return this._nodeCount},_t.prototype.nodes=function(){return De.keys(this._nodes)},_t.prototype.sources=function(){var e=this;return De.filter(this.nodes(),function(t){return De.isEmpty(e._in[t])})},_t.prototype.sinks=function(){var e=this;return De.filter(this.nodes(),function(t){return De.isEmpty(e._out[t])})},_t.prototype.setNodes=function(e,t){var n=arguments,r=this;return De.each(e,function(o){n.length>1?r.setNode(o,t):r.setNode(o)}),this},_t.prototype.setNode=function(e,t){return De.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]="\0",this._children[e]={},this._children["\0"][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)},_t.prototype.node=function(e){return this._nodes[e]},_t.prototype.hasNode=function(e){return De.has(this._nodes,e)},_t.prototype.removeNode=function(e){var t=this;if(De.has(this._nodes,e)){var n=function(r){t.removeEdge(t._edgeObjs[r])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],De.each(this.children(e),function(r){t.setParent(r)}),delete this._children[e]),De.each(De.keys(this._in[e]),n),delete this._in[e],delete this._preds[e],De.each(De.keys(this._out[e]),n),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this},_t.prototype.setParent=function(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(De.isUndefined(t))t="\0";else{for(var n=t+="";!De.isUndefined(n);n=this.parent(n))if(n===e)throw new Error("Setting "+t+" as parent of "+e+" would create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this},_t.prototype._removeFromParentsChildList=function(e){delete this._children[this._parent[e]][e]},_t.prototype.parent=function(e){if(this._isCompound){var t=this._parent[e];if(t!=="\0")return t}},_t.prototype.children=function(e){if(De.isUndefined(e)&&(e="\0"),this._isCompound){var t=this._children[e];if(t)return De.keys(t)}else{if(e==="\0")return this.nodes();if(this.hasNode(e))return[]}},_t.prototype.predecessors=function(e){var t=this._preds[e];if(t)return De.keys(t)},_t.prototype.successors=function(e){var t=this._sucs[e];if(t)return De.keys(t)},_t.prototype.neighbors=function(e){var t=this.predecessors(e);if(t)return De.union(t,this.successors(e))},_t.prototype.isLeaf=function(e){return(this.isDirected()?this.successors(e):this.neighbors(e)).length===0},_t.prototype.filterNodes=function(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var n=this;De.each(this._nodes,function(a,i){e(i)&&t.setNode(i,a)}),De.each(this._edgeObjs,function(a){t.hasNode(a.v)&&t.hasNode(a.w)&&t.setEdge(a,n.edge(a))});var r={};function o(a){var i=n.parent(a);return i===void 0||t.hasNode(i)?(r[a]=i,i):i in r?r[i]:o(i)}return this._isCompound&&De.each(t.nodes(),function(a){t.setParent(a,o(a))}),t},_t.prototype.setDefaultEdgeLabel=function(e){return De.isFunction(e)||(e=De.constant(e)),this._defaultEdgeLabelFn=e,this},_t.prototype.edgeCount=function(){return this._edgeCount},_t.prototype.edges=function(){return De.values(this._edgeObjs)},_t.prototype.setPath=function(e,t){var n=this,r=arguments;return De.reduce(e,function(o,a){return r.length>1?n.setEdge(o,a,t):n.setEdge(o,a),a}),this},_t.prototype.setEdge=function(){var e,t,n,r,o=!1,a=arguments[0];typeof a=="object"&&a!==null&&"v"in a?(e=a.v,t=a.w,n=a.name,arguments.length===2&&(r=arguments[1],o=!0)):(e=a,t=arguments[1],n=arguments[3],arguments.length>2&&(r=arguments[2],o=!0)),e=""+e,t=""+t,De.isUndefined(n)||(n=""+n);var i=Pa(this._isDirected,e,t,n);if(De.has(this._edgeLabels,i))return o&&(this._edgeLabels[i]=r),this;if(!De.isUndefined(n)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[i]=o?r:this._defaultEdgeLabelFn(e,t,n);var s=yw(this._isDirected,e,t,n);return e=s.v,t=s.w,Object.freeze(s),this._edgeObjs[i]=s,gp(this._preds[t],e),gp(this._sucs[e],t),this._in[t][i]=s,this._out[e][i]=s,this._edgeCount++,this},_t.prototype.edge=function(e,t,n){var r=arguments.length===1?Ul(this._isDirected,arguments[0]):Pa(this._isDirected,e,t,n);return this._edgeLabels[r]},_t.prototype.hasEdge=function(e,t,n){var r=arguments.length===1?Ul(this._isDirected,arguments[0]):Pa(this._isDirected,e,t,n);return De.has(this._edgeLabels,r)},_t.prototype.removeEdge=function(e,t,n){var r=arguments.length===1?Ul(this._isDirected,arguments[0]):Pa(this._isDirected,e,t,n),o=this._edgeObjs[r];return o&&(e=o.v,t=o.w,delete this._edgeLabels[r],delete this._edgeObjs[r],Ep(this._preds[t],e),Ep(this._sucs[e],t),delete this._in[t][r],delete this._out[e][r],this._edgeCount--),this},_t.prototype.inEdges=function(e,t){var n=this._in[e];if(n){var r=De.values(n);return t?De.filter(r,function(o){return o.v===t}):r}},_t.prototype.outEdges=function(e,t){var n=this._out[e];if(n){var r=De.values(n);return t?De.filter(r,function(o){return o.w===t}):r}},_t.prototype.nodeEdges=function(e,t){var n=this.inEdges(e,t);if(n)return n.concat(this.outEdges(e,t))};var Tp={Graph:qu,version:"2.1.8"},gw={write:function(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:Ew(e),edges:Tw(e)};return De.isUndefined(e.graph())||(t.value=De.clone(e.graph())),t},read:function(e){var t=new qu(e.options).setGraph(e.value);return De.each(e.nodes,function(n){t.setNode(n.v,n.value),n.parent&&t.setParent(n.v,n.parent)}),De.each(e.edges,function(n){t.setEdge({v:n.v,w:n.w,name:n.name},n.value)}),t}};function Ew(e){return De.map(e.nodes(),function(t){var n=e.node(t),r=e.parent(t),o={v:t};return De.isUndefined(n)||(o.value=n),De.isUndefined(r)||(o.parent=r),o})}function Tw(e){return De.map(e.edges(),function(t){var n=e.edge(t),r={v:t.v,w:t.w};return De.isUndefined(t.name)||(r.name=t.name),De.isUndefined(n)||(r.value=n),r})}var Iw=function(e){var t,n={},r=[];function o(a){De.has(n,a)||(n[a]=!0,t.push(a),De.each(e.successors(a),o),De.each(e.predecessors(a),o))}return De.each(e.nodes(),function(a){t=[],o(a),t.length&&r.push(t)}),r},fm=Vn;function Vn(){this._arr=[],this._keyIndices={}}Vn.prototype.size=function(){return this._arr.length},Vn.prototype.keys=function(){return this._arr.map(function(e){return e.key})},Vn.prototype.has=function(e){return De.has(this._keyIndices,e)},Vn.prototype.priority=function(e){var t=this._keyIndices[e];if(t!==void 0)return this._arr[t].priority},Vn.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},Vn.prototype.add=function(e,t){var n=this._keyIndices;if(e=String(e),!De.has(n,e)){var r=this._arr,o=r.length;return n[e]=o,r.push({key:e,priority:t}),this._decrease(o),!0}return!1},Vn.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key},Vn.prototype.decrease=function(e,t){var n=this._keyIndices[e];if(t>this._arr[n].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[n].priority+" New: "+t);this._arr[n].priority=t,this._decrease(n)},Vn.prototype._heapify=function(e){var t=this._arr,n=2*e,r=n+1,o=e;n<t.length&&(o=t[n].priority<t[o].priority?n:o,r<t.length&&(o=t[r].priority<t[o].priority?r:o),o!==e&&(this._swap(e,o),this._heapify(o)))},Vn.prototype._decrease=function(e){for(var t,n=this._arr,r=n[e].priority;e!==0&&!(n[t=e>>1].priority<r);)this._swap(e,t),e=t},Vn.prototype._swap=function(e,t){var n=this._arr,r=this._keyIndices,o=n[e],a=n[t];n[e]=a,n[t]=o,r[a.key]=e,r[o.key]=t};var pm=function(e,t,n,r){return function(o,a,i,s){var l,u,d={},c=new fm,f=function(h){var m=h.v!==l?h.v:h.w,v=d[m],b=i(h),w=u.distance+b;if(b<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+h+" Weight: "+b);w<v.distance&&(v.distance=w,v.predecessor=l,c.decrease(m,w))};for(o.nodes().forEach(function(h){var m=h===a?0:Number.POSITIVE_INFINITY;d[h]={distance:m},c.add(h,m)});c.size()>0&&(l=c.removeMin(),(u=d[l]).distance!==Number.POSITIVE_INFINITY);)s(l).forEach(f);return d}(e,String(t),n||Sw,r||function(o){return e.outEdges(o)})},Sw=De.constant(1),ww=function(e,t,n){return De.transform(e.nodes(),function(r,o){r[o]=pm(e,o,t,n)},{})},hm=function(e){var t=0,n=[],r={},o=[];function a(i){var s=r[i]={onStack:!0,lowlink:t,index:t++};if(n.push(i),e.successors(i).forEach(function(d){De.has(r,d)?r[d].onStack&&(s.lowlink=Math.min(s.lowlink,r[d].index)):(a(d),s.lowlink=Math.min(s.lowlink,r[d].lowlink))}),s.lowlink===s.index){var l,u=[];do l=n.pop(),r[l].onStack=!1,u.push(l);while(i!==l);o.push(u)}}return e.nodes().forEach(function(i){De.has(r,i)||a(i)}),o},Aw=function(e){return De.filter(hm(e),function(t){return t.length>1||t.length===1&&e.hasEdge(t[0],t[0])})},xw=function(e,t,n){return function(r,o,a){var i={},s=r.nodes();return s.forEach(function(l){i[l]={},i[l][l]={distance:0},s.forEach(function(u){l!==u&&(i[l][u]={distance:Number.POSITIVE_INFINITY})}),a(l).forEach(function(u){var d=u.v===l?u.w:u.v,c=o(u);i[l][d]={distance:c,predecessor:l}})}),s.forEach(function(l){var u=i[l];s.forEach(function(d){var c=i[d];s.forEach(function(f){var h=c[l],m=u[f],v=c[f],b=h.distance+m.distance;b<v.distance&&(v.distance=b,v.predecessor=m.predecessor)})})}),i}(e,t||Rw,n||function(r){return e.outEdges(r)})},Rw=De.constant(1),Gl=mm;function mm(e){var t={},n={},r=[];if(De.each(e.sinks(),function o(a){if(De.has(n,a))throw new ns;De.has(t,a)||(n[a]=!0,t[a]=!0,De.each(e.predecessors(a),o),delete n[a],r.push(a))}),De.size(t)!==e.nodeCount())throw new ns;return r}function ns(){}mm.CycleException=ns,ns.prototype=new Error;var Ip=function(e,t,n){De.isArray(t)||(t=[t]);var r=(e.isDirected()?e.successors:e.neighbors).bind(e),o=[],a={};return De.each(t,function(i){if(!e.hasNode(i))throw new Error("Graph does not have node: "+i);vm(e,i,n==="post",a,r,o)}),o};function vm(e,t,n,r,o,a){De.has(r,t)||(r[t]=!0,n||a.push(t),De.each(o(t),function(i){vm(e,i,n,r,o,a)}),n&&a.push(t))}var rs,Cw={Graph:Tp.Graph,json:gw,alg:{components:Iw,dijkstra:pm,dijkstraAll:ww,findCycles:Aw,floydWarshall:xw,isAcyclic:function(e){try{Gl(e)}catch(t){if(t instanceof Gl.CycleException)return!1;throw t}return!0},postorder:function(e,t){return Ip(e,t,"post")},preorder:function(e,t){return Ip(e,t,"pre")},prim:function(e,t){var n,r=new qu,o={},a=new fm;function i(l){var u=l.v===n?l.w:l.v,d=a.priority(u);if(d!==void 0){var c=t(l);c<d&&(o[u]=n,a.decrease(u,c))}}if(e.nodeCount()===0)return r;De.each(e.nodes(),function(l){a.add(l,Number.POSITIVE_INFINITY),r.setNode(l)}),a.decrease(e.nodes()[0],0);for(var s=!1;a.size()>0;){if(n=a.removeMin(),De.has(o,n))r.setEdge(n,o[n]);else{if(s)throw new Error("Input graph is not connected: "+e);s=!0}e.nodeEdges(n).forEach(i)}return r},tarjan:hm,topsort:Gl},version:Tp.version};try{rs=Cw}catch{}rs||(rs=window.graphlib);var nr=rs,Nw=function(e){return Vh(e,5)},Ka=function(e,t,n){if(!Rn(n))return!1;var r=typeof t;return!!(r=="number"?_r(n)&&Es(t,n.length):r=="string"&&t in n)&&la(n[t],e)},_m=Object.prototype,Ow=_m.hasOwnProperty,Fw=Rs(function(e,t){e=Object(e);var n=-1,r=t.length,o=r>2?t[2]:void 0;for(o&&Ka(t[0],t[1],o)&&(r=1);++n<r;)for(var a=t[n],i=mo(a),s=-1,l=i.length;++s<l;){var u=i[s],d=e[u];(d===void 0||la(d,_m[u])&&!Ow.call(e,u))&&(e[u]=a[u])}return e}),Lw=function(e){return function(t,n,r){var o=Object(t);if(!_r(t)){var a=br(n);t=Br(t),n=function(s){return a(o[s],s,o)}}var i=e(t,n,r);return i>-1?o[a?t[i]:i]:void 0}},Mw=/^\s+|\s+$/g,Dw=/^[-+]0x[0-9a-f]+$/i,Pw=/^0b[01]+$/i,kw=/^0o[0-7]+$/i,Vw=parseInt,Bw=function(e){if(typeof e=="number")return e;if(co(e))return NaN;if(Rn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Rn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(Mw,"");var n=Pw.test(e);return n||kw.test(e)?Vw(e.slice(2),n?2:8):Dw.test(e)?NaN:+e},$i=function(e){return e?(e=Bw(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:e===0?e:0},Uw=function(e){var t=$i(e),n=t%1;return t==t?n?t-n:t:0},Gw=Math.max,jw=Lw(function(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var o=n==null?0:Uw(n);return o<0&&(o=Gw(r+o,0)),um(e,br(t),o)}),bm=function(e){return e!=null&&e.length?Ku(e,1):[]},zw=function(e,t){return e==null?e:$u(e,Bh(t),mo)},$w=function(e){var t=e==null?0:e.length;return t?e[t-1]:void 0},Xw=function(e,t){var n={};return t=br(t),Xu(e,function(r,o,a){ys(n,o,t(r,o,a))}),n},Qu=function(e,t,n){for(var r=-1,o=e.length;++r<o;){var a=e[r],i=t(a);if(i!=null&&(s===void 0?i==i&&!co(i):n(i,s)))var s=i,l=a}return l},Hw=function(e,t){return e>t},Ww=function(e){return e&&e.length?Qu(e,vo,Hw):void 0},du=function(e,t,n){(n!==void 0&&!la(e[t],n)||n===void 0&&!(t in e))&&ys(e,t,n)},Yw=Function.prototype,Kw=Object.prototype,ym=Yw.toString,qw=Kw.hasOwnProperty,Qw=ym.call(Object),Zw=function(e){if(!Hn(e)||Vr(e)!="[object Object]")return!1;var t=Ss(e);if(t===null)return!0;var n=qw.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&ym.call(n)==Qw},cu=function(e,t){if((t!=="constructor"||typeof e[t]!="function")&&t!="__proto__")return e[t]},Jw=function(e){return Za(e,mo(e))},eA=function(e,t,n,r,o,a,i){var s=cu(e,n),l=cu(t,n),u=i.get(l);if(u)du(e,n,u);else{var d=a?a(s,l,n+"",e,t,i):void 0,c=d===void 0;if(c){var f=Qt(l),h=!f&&lo(l),m=!f&&!h&&Ja(l);d=l,f||h||m?Qt(s)?d=s:dm(s)?d=Nh(s):h?(c=!1,d=Ch(l,!0)):m?(c=!1,d=Dh(l,!0)):d=[]:Zw(l)||Zo(l)?(d=s,Zo(s)?d=Jw(s):Rn(s)&&!Qa(s)||(d=kh(l))):c=!1}c&&(i.set(l,d),o(d,l,r,a,i),i.delete(l)),du(e,n,d)}},tA=function e(t,n,r,o,a){t!==n&&$u(n,function(i,s){if(a||(a=new $o),Rn(i))eA(t,n,s,r,e,o,a);else{var l=o?o(cu(t,s),i,s+"",t,n,a):void 0;l===void 0&&(l=i),du(t,s,l)}},mo)},nA=function(e){return Rs(function(t,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,i=o>2?n[2]:void 0;for(a=e.length>3&&typeof a=="function"?(o--,a):void 0,i&&Ka(n[0],n[1],i)&&(a=o<3?void 0:a,o=1),t=Object(t);++r<o;){var s=n[r];s&&e(t,s,r,a)}return t})}(function(e,t,n){tA(e,t,n)}),gm=function(e,t){return e<t},rA=function(e){return e&&e.length?Qu(e,vo,gm):void 0},oA=function(e,t){return e&&e.length?Qu(e,br(t),gm):void 0},aA=function(){return Yn.Date.now()},iA=function(e,t,n,r){if(!Rn(e))return e;for(var o=-1,a=(t=As(t,e)).length,i=a-1,s=e;s!=null&&++o<a;){var l=ei(t[o]),u=n;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(o!=i){var d=s[l];(u=r?r(d,l,s):void 0)===void 0&&(u=Rn(d)?d:Es(t[o+1])?[]:{})}gs(s,l,u),s=s[l]}return e},sA=function(e,t,n){for(var r=-1,o=t.length,a={};++r<o;){var i=t[r],s=xs(e,i);n(s,i)&&iA(a,As(i,e),s)}return a},lA=function(e,t){return sA(e,t,function(n,r){return qh(e,r)})},uA=function(e){return lm(sm(e,void 0,bm),e+"")}(function(e,t){return e==null?{}:lA(e,t)}),dA=Math.ceil,cA=Math.max,fA=function(e,t,n,r){for(var o=-1,a=cA(dA((t-e)/(n||1)),0),i=Array(a);a--;)i[r?a:++o]=e,e+=n;return i},pA=function(e){return function(t,n,r){return r&&typeof r!="number"&&Ka(t,n,r)&&(n=r=void 0),t=$i(t),n===void 0?(n=t,t=0):n=$i(n),r=r===void 0?t<n?1:-1:$i(r),fA(t,n,r,e)}}(),hA=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e},mA=function(e,t){if(e!==t){var n=e!==void 0,r=e===null,o=e==e,a=co(e),i=t!==void 0,s=t===null,l=t==t,u=co(t);if(!s&&!u&&!a&&e>t||a&&i&&l&&!s&&!u||r&&i&&l||!n&&l||!o)return 1;if(!r&&!a&&!u&&e<t||u&&n&&o&&!r&&!a||s&&n&&o||!i&&o||!l)return-1}return 0},vA=function(e,t,n){for(var r=-1,o=e.criteria,a=t.criteria,i=o.length,s=n.length;++r<i;){var l=mA(o[r],a[r]);if(l)return r>=s?l:l*(n[r]=="desc"?-1:1)}return e.index-t.index},_A=function(e,t,n){t=t.length?Ho(t,function(a){return Qt(a)?function(i){return xs(i,a.length===1?a[0]:a)}:a}):[vo];var r=-1;t=Ho(t,Ts(br));var o=tm(e,function(a,i,s){return{criteria:Ho(t,function(l){return l(a)}),index:++r,value:a}});return hA(o,function(a,i){return vA(a,i,n)})},bA=Rs(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Ka(e,t[0],t[1])?t=[]:n>2&&Ka(t[0],t[1],t[2])&&(t=[t[0]]),_A(e,Ku(t,1),[])}),yA=0,gA=function(e){var t=++yA;return Yh(e)+t},EA=function(e,t,n){for(var r=-1,o=e.length,a=t.length,i={};++r<o;){var s=r<a?t[r]:void 0;n(i,e[r],s)}return i},os,TA=function(e,t){return EA(e||[],t||[],gs)};try{os={cloneDeep:Nw,constant:zu,defaults:Fw,each:Gh,filter:Zh,find:jw,flatten:bm,forEach:Uh,forIn:zw,has:Jh,isUndefined:em,last:$w,map:nm,mapValues:Xw,max:Ww,merge:nA,min:rA,minBy:oA,now:aA,pick:uA,range:pA,reduce:rm,sortBy:bA,uniqueId:gA,values:cm,zipObject:TA}}catch{}os||(os=window._);var IA=os;nr.Graph;IA.constant(1);nr.Graph;nr.Graph;nr.alg.preorder;nr.alg.postorder;nr.Graph;nr.Graph;nr.Graph;nr.Graph;nr.Graph;var fu={},SA={get exports(){return fu},set exports(e){fu=e}},as={},wA={get exports(){return as},set exports(e){as=e}};(function(e){function t(n,r){this.v=n,this.k=r}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(wA);var is={},AA={get exports(){return is},set exports(e){is=e}},ss={},xA={get exports(){return ss},set exports(e){ss=e}};(function(e){function t(n,r,o,a){var i=Object.defineProperty;try{i({},"",{})}catch{i=0}e.exports=t=function(l,u,d,c){if(u)i?i(l,u,{value:d,enumerable:!c,configurable:!c,writable:!c}):l[u]=d;else{var f=function(m,v){t(l,m,function(b){return this._invoke(m,v,b)})};f("next",0),f("throw",1),f("return",2)}},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r,o,a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(xA);(function(e){var t=ss;function n(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var r,o,a=typeof Symbol=="function"?Symbol:{},i=a.iterator||"@@iterator",s=a.toStringTag||"@@toStringTag";function l(b,w,L,z){var K=w&&w.prototype instanceof d?w:d,he=Object.create(K.prototype);return t(he,"_invoke",function(Fe,Oe,at){var ke,ze,He,ae=0,st=at||[],yt=!1,bt={p:0,n:0,v:r,a:kt,f:kt.bind(r,4),d:function(et,ut){return ke=et,ze=0,He=r,bt.n=ut,u}};function kt(Je,et){for(ze=Je,He=et,o=0;!yt&&ae&&!ut&&o<st.length;o++){var ut,tt=st[o],Ht=bt.p,Vt=tt[2];Je>3?(ut=Vt===et)&&(He=tt[(ze=tt[4])?5:(ze=3,3)],tt[4]=tt[5]=r):tt[0]<=Ht&&((ut=Je<2&&Ht<tt[1])?(ze=0,bt.v=et,bt.n=tt[1]):Ht<Vt&&(ut=Je<3||tt[0]>et||et>Vt)&&(tt[4]=Je,tt[5]=et,bt.n=Vt,ze=0))}if(ut||Je>1)return u;throw yt=!0,et}return function(Je,et,ut){if(ae>1)throw TypeError("Generator is already running");for(yt&&et===1&&kt(et,ut),ze=et,He=ut;(o=ze<2?r:He)||!yt;){ke||(ze?ze<3?(ze>1&&(bt.n=-1),kt(ze,He)):bt.n=He:bt.v=He);try{if(ae=2,ke){if(ze||(Je="next"),o=ke[Je]){if(!(o=o.call(ke,He)))throw TypeError("iterator result is not an object");if(!o.done)return o;He=o.value,ze<2&&(ze=0)}else ze===1&&(o=ke.return)&&o.call(ke),ze<2&&(He=TypeError("The iterator does not provide a '"+Je+"' method"),ze=1);ke=r}else if((o=(yt=bt.n<0)?He:Fe.call(Oe,bt))!==u)break}catch(tt){ke=r,ze=1,He=tt}finally{ae=1}}return{value:o,done:yt}}}(b,L,z),!0),he}var u={};function d(){}function c(){}function f(){}o=Object.getPrototypeOf;var h=[][i]?o(o([][i]())):(t(o={},i,function(){return this}),o),m=f.prototype=d.prototype=Object.create(h);function v(b){return Object.setPrototypeOf?Object.setPrototypeOf(b,f):(b.__proto__=f,t(b,s,"GeneratorFunction")),b.prototype=Object.create(m),b}return c.prototype=f,t(m,"constructor",f),t(f,"constructor",c),c.displayName="GeneratorFunction",t(f,s,"GeneratorFunction"),t(m),t(m,s,"Generator"),t(m,i,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(e.exports=n=function(){return{w:l,m:v}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(AA);var pu={},RA={get exports(){return pu},set exports(e){pu=e}},ls={},CA={get exports(){return ls},set exports(e){ls=e}},us={},NA={get exports(){return us},set exports(e){us=e}};(function(e){var t=as,n=ss;function r(o,a){function i(l,u,d,c){try{var f=o[l](u),h=f.value;return h instanceof t?a.resolve(h.v).then(function(m){i("next",m,d,c)},function(m){i("throw",m,d,c)}):a.resolve(h).then(function(m){f.value=m,d(f)},function(m){return i("throw",m,d,c)})}catch(m){c(m)}}var s;this.next||(n(r.prototype),n(r.prototype,typeof Symbol=="function"&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),n(this,"_invoke",function(l,u,d){function c(){return new a(function(f,h){i(l,d,f,h)})}return s=s?s.then(c,c):c()},!0)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(NA);(function(e){var t=is,n=us;function r(o,a,i,s,l){return new n(t().w(o,a,i,s),l||Promise)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(CA);(function(e){var t=ls;function n(r,o,a,i,s){var l=t(r,o,a,i,s);return l.next().then(function(u){return u.done?u.value:l.next()})}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(RA);var hu={},OA={get exports(){return hu},set exports(e){hu=e}};(function(e){function t(n){var r=Object(n),o=[];for(var a in r)o.unshift(a);return function i(){for(;o.length;)if((a=o.pop())in r)return i.value=a,i.done=!1,i;return i.done=!0,i}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(OA);var mu={},FA={get exports(){return mu},set exports(e){mu=e}},vu={},LA={get exports(){return vu},set exports(e){vu=e}};(function(e){function t(n){"@babel/helpers - typeof";return e.exports=t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(LA);(function(e){var t=vu.default;function n(r){if(r!=null){var o=r[typeof Symbol=="function"&&Symbol.iterator||"@@iterator"],a=0;if(o)return o.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length))return{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}}}throw new TypeError(t(r)+" is not iterable")}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports})(FA);(function(e){var t=as,n=is,r=pu,o=ls,a=us,i=hu,s=mu;function l(){var u=n(),d=u.m(l),c=(Object.getPrototypeOf?Object.getPrototypeOf(d):d.__proto__).constructor;function f(v){var b=typeof v=="function"&&v.constructor;return!!b&&(b===c||(b.displayName||b.name)==="GeneratorFunction")}var h={throw:1,return:2,break:3,continue:3};function m(v){var b,w;return function(L){b||(b={stop:function(){return w(L.a,2)},catch:function(){return L.v},abrupt:function(K,he){return w(L.a,h[K],he)},delegateYield:function(K,he,Fe){return b.resultName=he,w(L.d,s(K),Fe)},finish:function(K){return w(L.f,K)}},w=function(K,he,Fe){L.p=b.prev,L.n=b.next;try{return K(he,Fe)}finally{b.next=L.n}}),b.resultName&&(b[b.resultName]=L.v,b.resultName=void 0),b.sent=L.v,b.next=L.n;try{return v.call(this,b)}finally{L.p=b.prev,L.n=b.next}}}return(e.exports=l=function(){return{wrap:function(w,L,z,K){return u.w(m(w),L,z,K&&K.reverse())},isGeneratorFunction:f,mark:u.m,awrap:function(w,L){return new t(w,L)},AsyncIterator:a,async:function(w,L,z,K,he){return(f(L)?o:r)(m(w),L,z,K,he)},keys:i,values:s}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=l,e.exports.__esModule=!0,e.exports.default=e.exports})(SA);var jl=fu();try{regeneratorRuntime=jl}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=jl:Function("r","regeneratorRuntime = r")(jl)}var Ae;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(Ae||(Ae={}));var Sp;(function(e){e.Void="Void",e.Boolean="Boolean",e.Float="Float",e.Uint32="Uint32",e.Int32="Int32",e.Vector="Vector",e.Vector2Float="vec2<f32>",e.Vector3Float="vec3<f32>",e.Vector4Float="vec4<f32>",e.Vector2Boolean="vec2<bool>",e.Vector3Boolean="vec3<bool>",e.Vector4Boolean="vec4<bool>",e.Vector2Uint="vec2<u32>",e.Vector3Uint="vec3<u32>",e.Vector4Uint="vec4<u32>",e.Vector2Int="vec2<i32>",e.Vector3Int="vec3<i32>",e.Vector4Int="vec4<i32>",e.Matrix="Matrix",e.Matrix3x3Float="mat3x3<f32>",e.Matrix4x4Float="mat4x4<i32>",e.Struct="Struct",e.FloatArray="Float[]",e.Vector4FloatArray="vec4<f32>[]"})(Sp||(Sp={}));var wp;(function(e){e.Program="Program",e.Identifier="Identifier",e.VariableDeclaration="VariableDeclaration",e.BlockStatement="BlockStatement",e.ReturnStatement="ReturnStatement",e.FunctionDeclaration="FunctionDeclaration",e.VariableDeclarator="VariableDeclarator",e.AssignmentExpression="AssignmentExpression",e.LogicalExpression="LogicalExpression",e.BinaryExpression="BinaryExpression",e.ArrayExpression="ArrayExpression",e.UnaryExpression="UnaryExpression",e.UpdateExpression="UpdateExpression",e.FunctionExpression="FunctionExpression",e.MemberExpression="MemberExpression",e.ConditionalExpression="ConditionalExpression",e.ExpressionStatement="ExpressionStatement",e.CallExpression="CallExpression",e.NumThreadStatement="NumThreadStatement",e.StorageStatement="StorageStatement",e.DoWhileStatement="DoWhileStatement",e.WhileStatement="WhileStatement",e.ForStatement="ForStatement",e.BreakStatement="BreakStatement",e.ContinueStatement="ContinueStatement",e.IfStatement="IfStatement",e.ImportedFunctionStatement="ImportedFunctionStatement"})(wp||(wp={}));var Ap;(function(e){e.Input="Input",e.Output="Output",e.Uniform="Uniform",e.Workgroup="Workgroup",e.UniformConstant="UniformConstant",e.Image="Image",e.StorageBuffer="StorageBuffer",e.Private="Private",e.Function="Function"})(Ap||(Ap={}));var xp;(function(e){e.GLSL100="GLSL100",e.GLSL450="GLSL450",e.WGSL="WGSL"})(xp||(xp={}));var Rp={},MA={get exports(){return Rp},set exports(e){Rp=e}};(function(e,t){(function(n,r){e.exports=r()})(My,function(){var n=function(p){return p instanceof Uint8Array||p instanceof Uint16Array||p instanceof Uint32Array||p instanceof Int8Array||p instanceof Int16Array||p instanceof Int32Array||p instanceof Float32Array||p instanceof Float64Array||p instanceof Uint8ClampedArray},r=function(p,y){for(var R=Object.keys(y),X=0;X<R.length;++X)p[R[X]]=y[R[X]];return p},o=`
`;function a(p){return typeof atob<"u"?atob(p):"base64:"+p}function i(p){var y=new Error("(regl) "+p);throw console.error(y),y}function s(p,y){p||i(y)}function l(p){return p?": "+p:""}function u(p,y,R){p in y||i("unknown parameter ("+p+")"+l(R)+". possible values: "+Object.keys(y).join())}function d(p,y){n(p)||i("invalid parameter type"+l(y)+". must be a typed array")}function c(p,y){switch(y){case"number":return typeof p=="number";case"object":return typeof p=="object";case"string":return typeof p=="string";case"boolean":return typeof p=="boolean";case"function":return typeof p=="function";case"undefined":return typeof p>"u";case"symbol":return typeof p=="symbol"}}function f(p,y,R){c(p,y)||i("invalid parameter type"+l(R)+". expected "+y+", got "+typeof p)}function h(p,y){p>=0&&(p|0)===p||i("invalid parameter type, ("+p+")"+l(y)+". must be a nonnegative integer")}function m(p,y,R){y.indexOf(p)<0&&i("invalid value"+l(R)+". must be one of: "+y)}var v=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function b(p){Object.keys(p).forEach(function(y){v.indexOf(y)<0&&i('invalid regl constructor argument "'+y+'". must be one of '+v)})}function w(p,y){for(p=p+"";p.length<y;)p=" "+p;return p}function L(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function z(p,y){this.number=p,this.line=y,this.errors=[]}function K(p,y,R){this.file=p,this.line=y,this.message=R}function he(){var p=new Error,y=(p.stack||p).toString(),R=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(y);if(R)return R[1];var X=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(y);return X?X[1]:"unknown"}function Fe(){var p=new Error,y=(p.stack||p).toString(),R=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(y);if(R)return R[1];var X=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(y);return X?X[1]:"unknown"}function Oe(p,y){var R=p.split(`
`),X=1,Z=0,$={unknown:new L,0:new L};$.unknown.name=$[0].name=y||he(),$.unknown.lines.push(new z(0,""));for(var W=0;W<R.length;++W){var ie=R[W],le=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ie);if(le)switch(le[1]){case"line":var fe=/(\d+)(\s+\d+)?/.exec(le[2]);fe&&(X=fe[1]|0,fe[2]&&(Z=fe[2]|0,Z in $||($[Z]=new L)));break;case"define":var ue=/SHADER_NAME(_B64)?\s+(.*)$/.exec(le[2]);ue&&($[Z].name=ue[1]?a(ue[2]):ue[2]);break}$[Z].lines.push(new z(X++,ie))}return Object.keys($).forEach(function(me){var ye=$[me];ye.lines.forEach(function(se){ye.index[se.number]=se})}),$}function at(p){var y=[];return p.split(`
`).forEach(function(R){if(!(R.length<5)){var X=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(R);X?y.push(new K(X[1]|0,X[2]|0,X[3].trim())):R.length>0&&y.push(new K("unknown",0,R))}}),y}function ke(p,y){y.forEach(function(R){var X=p[R.file];if(X){var Z=X.index[R.line];if(Z){Z.errors.push(R),X.hasErrors=!0;return}}p.unknown.hasErrors=!0,p.unknown.lines[0].errors.push(R)})}function ze(p,y,R,X,Z){if(!p.getShaderParameter(y,p.COMPILE_STATUS)){var $=p.getShaderInfoLog(y),W=X===p.FRAGMENT_SHADER?"fragment":"vertex";Je(R,"string",W+" shader source must be a string",Z);var ie=Oe(R,Z),le=at($);ke(ie,le),Object.keys(ie).forEach(function(fe){var ue=ie[fe];if(!ue.hasErrors)return;var me=[""],ye=[""];function se(ve,B){me.push(ve),ye.push(B||"")}se("file number "+fe+": "+ue.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),ue.lines.forEach(function(ve){if(ve.errors.length>0){se(w(ve.number,4)+"|  ","background-color:yellow; font-weight:bold"),se(ve.line+o,"color:red; background-color:yellow; font-weight:bold");var B=0;ve.errors.forEach(function(Y){var ce=Y.message,Se=/^\s*'(.*)'\s*:\s*(.*)$/.exec(ce);if(Se){var ne=Se[1];switch(ce=Se[2],ne){case"assign":ne="=";break}B=Math.max(ve.line.indexOf(ne,B),0)}else B=0;se(w("| ",6)),se(w("^^^",B+3)+o,"font-weight:bold"),se(w("| ",6)),se(ce+o,"font-weight:bold")}),se(w("| ",6)+o)}else se(w(ve.number,4)+"|  "),se(ve.line+o,"color:red")}),typeof document<"u"&&!window.chrome?(ye[0]=me.join("%c"),console.log.apply(console,ye)):me.join("")}),s.raise("Error compiling "+W+" shader, "+ie[0].name)}}function He(p,y,R,X,Z){if(!p.getProgramParameter(y,p.LINK_STATUS)){var $=p.getProgramInfoLog(y),W=Oe(R,Z),ie=Oe(X,Z),le='Error linking program with vertex shader, "'+ie[0].name+'", and fragment shader "'+W[0].name+'"';typeof document<"u"?""+le+o+$:le+o+$,s.raise(le)}}function ae(p){p._commandRef=he()}function st(p,y,R,X){ae(p);function Z(le){return le?X.id(le):0}p._fragId=Z(p.static.frag),p._vertId=Z(p.static.vert);function $(le,fe){Object.keys(fe).forEach(function(ue){le[X.id(ue)]=!0})}var W=p._uniformSet={};$(W,y.static),$(W,y.dynamic);var ie=p._attributeSet={};$(ie,R.static),$(ie,R.dynamic),p._hasCount="count"in p.static||"count"in p.dynamic||"elements"in p.static||"elements"in p.dynamic}function yt(p,y){var R=Fe();i(p+" in command "+(y||he())+(R==="unknown"?"":" called from "+R))}function bt(p,y,R){p||yt(y,R||he())}function kt(p,y,R,X){p in y||yt("unknown parameter ("+p+")"+l(R)+". possible values: "+Object.keys(y).join(),X||he())}function Je(p,y,R,X){c(p,y)||yt("invalid parameter type"+l(R)+". expected "+y+", got "+typeof p,X||he())}function et(p){p()}function ut(p,y,R){p.texture?m(p.texture._texture.internalformat,y,"unsupported texture format for attachment"):m(p.renderbuffer._renderbuffer.format,R,"unsupported renderbuffer format for attachment")}var tt=33071,Ht=9728,Vt=9984,_n=9985,Un=9986,ri=9987,da=5120,ca=5121,Cs=5122,ct=5123,ht=5124,pn=5125,gn=5126,ln=32819,At=32820,Mt=33635,Sn=34042,bn=36193,Rt={};Rt[da]=Rt[ca]=1,Rt[Cs]=Rt[ct]=Rt[bn]=Rt[Mt]=Rt[ln]=Rt[At]=2,Rt[ht]=Rt[pn]=Rt[gn]=Rt[Sn]=4;function oi(p,y){return p===At||p===ln||p===Mt?2:p===Sn?4:Rt[p]*y}function jr(p){return!(p&p-1)&&!!p}function Ns(p,y,R){var X,Z=y.width,$=y.height,W=y.channels;s(Z>0&&Z<=R.maxTextureSize&&$>0&&$<=R.maxTextureSize,"invalid texture shape"),(p.wrapS!==tt||p.wrapT!==tt)&&s(jr(Z)&&jr($),"incompatible wrap mode for texture, both width and height must be power of 2"),y.mipmask===1?Z!==1&&$!==1&&s(p.minFilter!==Vt&&p.minFilter!==Un&&p.minFilter!==_n&&p.minFilter!==ri,"min filter requires mipmap"):(s(jr(Z)&&jr($),"texture must be a square power of 2 to support mipmapping"),s(y.mipmask===(Z<<1)-1,"missing or incomplete mipmap data")),y.type===gn&&(R.extensions.indexOf("oes_texture_float_linear")<0&&s(p.minFilter===Ht&&p.magFilter===Ht,"filter not supported, must enable oes_texture_float_linear"),s(!p.genMipmaps,"mipmap generation not supported with float textures"));var ie=y.images;for(X=0;X<16;++X)if(ie[X]){var le=Z>>X,fe=$>>X;s(y.mipmask&1<<X,"missing mipmap data");var ue=ie[X];if(s(ue.width===le&&ue.height===fe,"invalid shape for mip images"),s(ue.format===y.format&&ue.internalformat===y.internalformat&&ue.type===y.type,"incompatible type for mip image"),!ue.compressed)if(ue.data){var me=Math.ceil(oi(ue.type,W)*le/ue.unpackAlignment)*ue.unpackAlignment;s(ue.data.byteLength===me*fe,"invalid data for image, buffer size is inconsistent with image format")}else ue.element||ue.copy}else p.genMipmaps||s((y.mipmask&1<<X)===0,"extra mipmap data");y.compressed&&s(!p.genMipmaps,"mipmap generation for compressed images not supported")}function ai(p,y,R,X){var Z=p.width,$=p.height,W=p.channels;s(Z>0&&Z<=X.maxTextureSize&&$>0&&$<=X.maxTextureSize,"invalid texture shape"),s(Z===$,"cube map must be square"),s(y.wrapS===tt&&y.wrapT===tt,"wrap mode not supported by cube map");for(var ie=0;ie<R.length;++ie){var le=R[ie];s(le.width===Z&&le.height===$,"inconsistent cube map face shape"),y.genMipmaps&&(s(!le.compressed,"can not generate mipmap for compressed textures"),s(le.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var fe=le.images,ue=0;ue<16;++ue){var me=fe[ue];if(me){var ye=Z>>ue,se=$>>ue;s(le.mipmask&1<<ue,"missing mipmap data"),s(me.width===ye&&me.height===se,"invalid shape for mip images"),s(me.format===p.format&&me.internalformat===p.internalformat&&me.type===p.type,"incompatible type for mip image"),me.compressed||(me.data?s(me.data.byteLength===ye*se*Math.max(oi(me.type,W),me.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):me.element||me.copy)}}}}var T=r(s,{optional:et,raise:i,commandRaise:yt,command:bt,parameter:u,commandParameter:kt,constructor:b,type:f,commandType:Je,isTypedArray:d,nni:h,oneOf:m,shaderError:ze,linkError:He,callSite:Fe,saveCommandRef:ae,saveDrawInfo:st,framebufferFormat:ut,guessCommand:he,texture2D:Ns,textureCube:ai}),ii=0,jm=0,zm=5,$m=6;function zr(p,y){this.id=ii++,this.type=p,this.data=y}function Ju(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function fa(p){if(p.length===0)return[];var y=p.charAt(0),R=p.charAt(p.length-1);if(p.length>1&&y===R&&(y==='"'||y==="'"))return['"'+Ju(p.substr(1,p.length-2))+'"'];var X=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(p);if(X)return fa(p.substr(0,X.index)).concat(fa(X[1])).concat(fa(p.substr(X.index+X[0].length)));var Z=p.split(".");if(Z.length===1)return['"'+Ju(p)+'"'];for(var $=[],W=0;W<Z.length;++W)$=$.concat(fa(Z[W]));return $}function ed(p){return"["+fa(p).join("][")+"]"}function Xm(p,y){return new zr(p,ed(y+""))}function Hm(p){return typeof p=="function"&&!p._reglType||p instanceof zr}function td(p,y){if(typeof p=="function")return new zr(jm,p);if(typeof p=="number"||typeof p=="boolean")return new zr(zm,p);if(Array.isArray(p))return new zr($m,p.map((R,X)=>td(R,y+"["+X+"]")));if(p instanceof zr)return p;T(!1,"invalid option type in uniform "+y)}var Nn={DynamicVariable:zr,define:Xm,isDynamic:Hm,unbox:td,accessor:ed},Os={next:typeof requestAnimationFrame=="function"?function(p){return requestAnimationFrame(p)}:function(p){return setTimeout(p,16)},cancel:typeof cancelAnimationFrame=="function"?function(p){return cancelAnimationFrame(p)}:clearTimeout},nd=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Wm(){var p={"":0},y=[""];return{id:function(R){var X=p[R];return X||(X=p[R]=y.length,y.push(R),X)},str:function(R){return y[R]}}}function Ym(p,y,R){var X=document.createElement("canvas");r(X.style,{border:0,margin:0,padding:0,top:0,left:0}),p.appendChild(X),p===document.body&&(X.style.position="absolute",r(p.style,{margin:0,padding:0}));function Z(){var ie=window.innerWidth,le=window.innerHeight;if(p!==document.body){var fe=p.getBoundingClientRect();ie=fe.right-fe.left,le=fe.bottom-fe.top}X.width=R*ie,X.height=R*le,r(X.style,{width:ie+"px",height:le+"px"})}var $;p!==document.body&&typeof ResizeObserver=="function"?($=new ResizeObserver(function(){setTimeout(Z)}),$.observe(p)):window.addEventListener("resize",Z,!1);function W(){$?$.disconnect():window.removeEventListener("resize",Z),p.removeChild(X)}return Z(),{canvas:X,onDestroy:W}}function Km(p,y){function R(X){try{return p.getContext(X,y)}catch{return null}}return R("webgl")||R("experimental-webgl")||R("webgl-experimental")}function qm(p){return typeof p.nodeName=="string"&&typeof p.appendChild=="function"&&typeof p.getBoundingClientRect=="function"}function Qm(p){return typeof p.drawArrays=="function"||typeof p.drawElements=="function"}function rd(p){return typeof p=="string"?p.split():(T(Array.isArray(p),"invalid extension array"),p)}function od(p){return typeof p=="string"?(T(typeof document<"u","not supported outside of DOM"),document.querySelector(p)):p}function Zm(p){var y=p||{},R,X,Z,$,W={},ie=[],le=[],fe=typeof window>"u"?1:window.devicePixelRatio,ue=!1,me=function(ve){ve&&T.raise(ve)},ye=function(){};if(typeof y=="string"?(T(typeof document<"u","selector queries only supported in DOM enviroments"),R=document.querySelector(y),T(R,"invalid query string for element")):typeof y=="object"?qm(y)?R=y:Qm(y)?($=y,Z=$.canvas):(T.constructor(y),"gl"in y?$=y.gl:"canvas"in y?Z=od(y.canvas):"container"in y&&(X=od(y.container)),"attributes"in y&&(W=y.attributes,T.type(W,"object","invalid context attributes")),"extensions"in y&&(ie=rd(y.extensions)),"optionalExtensions"in y&&(le=rd(y.optionalExtensions)),"onDone"in y&&(T.type(y.onDone,"function","invalid or missing onDone callback"),me=y.onDone),"profile"in y&&(ue=!!y.profile),"pixelRatio"in y&&(fe=+y.pixelRatio,T(fe>0,"invalid pixel ratio"))):T.raise("invalid arguments to regl"),R&&(R.nodeName.toLowerCase()==="canvas"?Z=R:X=R),!$){if(!Z){T(typeof document<"u","must manually specify webgl context outside of DOM environments");var se=Ym(X||document.body,me,fe);if(!se)return null;Z=se.canvas,ye=se.onDestroy}W.premultipliedAlpha===void 0&&(W.premultipliedAlpha=!0),$=Km(Z,W)}return $?{gl:$,canvas:Z,container:X,extensions:ie,optionalExtensions:le,pixelRatio:fe,profile:ue,onDone:me,onDestroy:ye}:(ye(),me("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Jm(p,y){var R={};function X(W){T.type(W,"string","extension name must be string");var ie=W.toLowerCase(),le;try{le=R[ie]=p.getExtension(ie)}catch{}return!!le}for(var Z=0;Z<y.extensions.length;++Z){var $=y.extensions[Z];if(!X($))return y.onDestroy(),y.onDone('"'+$+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return y.optionalExtensions.forEach(X),{extensions:R,restore:function(){Object.keys(R).forEach(function(W){if(R[W]&&!X(W))throw new Error("(regl): error restoring extension "+W)})}}}function wn(p,y){for(var R=Array(p),X=0;X<p;++X)R[X]=y(X);return R}var ev=5120,tv=5121,nv=5122,rv=5123,ov=5124,av=5125,iv=5126;function sv(p){for(var y=16;y<=1<<28;y*=16)if(p<=y)return y;return 0}function ad(p){var y,R;return y=(p>65535)<<4,p>>>=y,R=(p>255)<<3,p>>>=R,y|=R,R=(p>15)<<2,p>>>=R,y|=R,R=(p>3)<<1,p>>>=R,y|=R,y|p>>1}function id(){var p=wn(8,function(){return[]});function y($){var W=sv($),ie=p[ad(W)>>2];return ie.length>0?ie.pop():new ArrayBuffer(W)}function R($){p[ad($.byteLength)>>2].push($)}function X($,W){var ie=null;switch($){case ev:ie=new Int8Array(y(W),0,W);break;case tv:ie=new Uint8Array(y(W),0,W);break;case nv:ie=new Int16Array(y(2*W),0,W);break;case rv:ie=new Uint16Array(y(2*W),0,W);break;case ov:ie=new Int32Array(y(4*W),0,W);break;case av:ie=new Uint32Array(y(4*W),0,W);break;case iv:ie=new Float32Array(y(4*W),0,W);break;default:return null}return ie.length!==W?ie.subarray(0,W):ie}function Z($){R($.buffer)}return{alloc:y,free:R,allocType:X,freeType:Z}}var Wt=id();Wt.zero=id();var lv=3408,uv=3410,dv=3411,cv=3412,fv=3413,pv=3414,hv=3415,mv=33901,vv=33902,_v=3379,bv=3386,yv=34921,gv=36347,Ev=36348,Tv=35661,Iv=35660,Sv=34930,wv=36349,Av=34076,xv=34024,Rv=7936,Cv=7937,Nv=7938,Ov=35724,Fv=34047,Lv=36063,Mv=34852,si=3553,sd=34067,Dv=34069,Pv=33984,pa=6408,Fs=5126,ld=5121,Ls=36160,kv=36053,Vv=36064,Bv=16384,Uv=function(p,y){var R=1;y.ext_texture_filter_anisotropic&&(R=p.getParameter(Fv));var X=1,Z=1;y.webgl_draw_buffers&&(X=p.getParameter(Mv),Z=p.getParameter(Lv));var $=!!y.oes_texture_float;if($){var W=p.createTexture();p.bindTexture(si,W),p.texImage2D(si,0,pa,1,1,0,pa,Fs,null);var ie=p.createFramebuffer();if(p.bindFramebuffer(Ls,ie),p.framebufferTexture2D(Ls,Vv,si,W,0),p.bindTexture(si,null),p.checkFramebufferStatus(Ls)!==kv)$=!1;else{p.viewport(0,0,1,1),p.clearColor(1,0,0,1),p.clear(Bv);var le=Wt.allocType(Fs,4);p.readPixels(0,0,1,1,pa,Fs,le),p.getError()?$=!1:(p.deleteFramebuffer(ie),p.deleteTexture(W),$=le[0]===1),Wt.freeType(le)}}var fe=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),ue=!0;if(!fe){var me=p.createTexture(),ye=Wt.allocType(ld,36);p.activeTexture(Pv),p.bindTexture(sd,me),p.texImage2D(Dv,0,pa,3,3,0,pa,ld,ye),Wt.freeType(ye),p.bindTexture(sd,null),p.deleteTexture(me),ue=!p.getError()}return{colorBits:[p.getParameter(uv),p.getParameter(dv),p.getParameter(cv),p.getParameter(fv)],depthBits:p.getParameter(pv),stencilBits:p.getParameter(hv),subpixelBits:p.getParameter(lv),extensions:Object.keys(y).filter(function(se){return!!y[se]}),maxAnisotropic:R,maxDrawbuffers:X,maxColorAttachments:Z,pointSizeDims:p.getParameter(mv),lineWidthDims:p.getParameter(vv),maxViewportDims:p.getParameter(bv),maxCombinedTextureUnits:p.getParameter(Tv),maxCubeMapSize:p.getParameter(Av),maxRenderbufferSize:p.getParameter(xv),maxTextureUnits:p.getParameter(Sv),maxTextureSize:p.getParameter(_v),maxAttributes:p.getParameter(yv),maxVertexUniforms:p.getParameter(gv),maxVertexTextureUnits:p.getParameter(Iv),maxVaryingVectors:p.getParameter(Ev),maxFragmentUniforms:p.getParameter(wv),glsl:p.getParameter(Ov),renderer:p.getParameter(Cv),vendor:p.getParameter(Rv),version:p.getParameter(Nv),readFloat:$,npotTextureCube:ue}};function Gn(p){return!!p&&typeof p=="object"&&Array.isArray(p.shape)&&Array.isArray(p.stride)&&typeof p.offset=="number"&&p.shape.length===p.stride.length&&(Array.isArray(p.data)||n(p.data))}var On=function(p){return Object.keys(p).map(function(y){return p[y]})},li={shape:$v,flatten:zv};function Gv(p,y,R){for(var X=0;X<y;++X)R[X]=p[X]}function jv(p,y,R,X){for(var Z=0,$=0;$<y;++$)for(var W=p[$],ie=0;ie<R;++ie)X[Z++]=W[ie]}function ud(p,y,R,X,Z,$){for(var W=$,ie=0;ie<y;++ie)for(var le=p[ie],fe=0;fe<R;++fe)for(var ue=le[fe],me=0;me<X;++me)Z[W++]=ue[me]}function dd(p,y,R,X,Z){for(var $=1,W=R+1;W<y.length;++W)$*=y[W];var ie=y[R];if(y.length-R===4){var le=y[R+1],fe=y[R+2],ue=y[R+3];for(W=0;W<ie;++W)ud(p[W],le,fe,ue,X,Z),Z+=$}else for(W=0;W<ie;++W)dd(p[W],y,R+1,X,Z),Z+=$}function zv(p,y,R,X){var Z=1;if(y.length)for(var $=0;$<y.length;++$)Z*=y[$];else Z=0;var W=X||Wt.allocType(R,Z);switch(y.length){case 0:break;case 1:Gv(p,y[0],W);break;case 2:jv(p,y[0],y[1],W);break;case 3:ud(p,y[0],y[1],y[2],W,0);break;default:dd(p,y,0,W,0)}return W}function $v(p){for(var y=[],R=p;R.length;R=R[0])y.push(R.length);return y}var Ms={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Xv=5120,Hv=5122,Wv=5124,Yv=5121,Kv=5123,qv=5125,Qv=5126,Zv=5126,$r={int8:Xv,int16:Hv,int32:Wv,uint8:Yv,uint16:Kv,uint32:qv,float:Qv,float32:Zv},Jv=35048,e_=35040,ui={dynamic:Jv,stream:e_,static:35044},Ds=li.flatten,cd=li.shape,fd=35044,t_=35040,Ps=5121,ks=5126,gr=[];gr[5120]=1,gr[5122]=2,gr[5124]=4,gr[5121]=1,gr[5123]=2,gr[5125]=4,gr[5126]=4;function di(p){return Ms[Object.prototype.toString.call(p)]|0}function pd(p,y){for(var R=0;R<y.length;++R)p[R]=y[R]}function hd(p,y,R,X,Z,$,W){for(var ie=0,le=0;le<R;++le)for(var fe=0;fe<X;++fe)p[ie++]=y[Z*le+$*fe+W]}function n_(p,y,R,X){var Z=0,$={};function W(B){this.id=Z++,this.buffer=p.createBuffer(),this.type=B,this.usage=fd,this.byteLength=0,this.dimension=1,this.dtype=Ps,this.persistentData=null,R.profile&&(this.stats={size:0})}W.prototype.bind=function(){p.bindBuffer(this.type,this.buffer)},W.prototype.destroy=function(){ye(this)};var ie=[];function le(B,Y){var ce=ie.pop();return ce||(ce=new W(B)),ce.bind(),me(ce,Y,t_,0,1,!1),ce}function fe(B){ie.push(B)}function ue(B,Y,ce){B.byteLength=Y.byteLength,p.bufferData(B.type,Y,ce)}function me(B,Y,ce,Se,ne,xe){var oe;if(B.usage=ce,Array.isArray(Y)){if(B.dtype=Se||ks,Y.length>0){var _e;if(Array.isArray(Y[0])){oe=cd(Y);for(var re=1,be=1;be<oe.length;++be)re*=oe[be];B.dimension=re,_e=Ds(Y,oe,B.dtype),ue(B,_e,ce),xe?B.persistentData=_e:Wt.freeType(_e)}else if(typeof Y[0]=="number"){B.dimension=ne;var Ve=Wt.allocType(B.dtype,Y.length);pd(Ve,Y),ue(B,Ve,ce),xe?B.persistentData=Ve:Wt.freeType(Ve)}else n(Y[0])?(B.dimension=Y[0].length,B.dtype=Se||di(Y[0])||ks,_e=Ds(Y,[Y.length,Y[0].length],B.dtype),ue(B,_e,ce),xe?B.persistentData=_e:Wt.freeType(_e)):T.raise("invalid buffer data")}}else if(n(Y))B.dtype=Se||di(Y),B.dimension=ne,ue(B,Y,ce),xe&&(B.persistentData=new Uint8Array(new Uint8Array(Y.buffer)));else if(Gn(Y)){oe=Y.shape;var We=Y.stride,ge=Y.offset,pe=0,te=0,$e=0,qe=0;oe.length===1?(pe=oe[0],te=1,$e=We[0],qe=0):oe.length===2?(pe=oe[0],te=oe[1],$e=We[0],qe=We[1]):T.raise("invalid shape"),B.dtype=Se||di(Y.data)||ks,B.dimension=te;var Le=Wt.allocType(B.dtype,pe*te);hd(Le,Y.data,pe,te,$e,qe,ge),ue(B,Le,ce),xe?B.persistentData=Le:Wt.freeType(Le)}else Y instanceof ArrayBuffer?(B.dtype=Ps,B.dimension=ne,ue(B,Y,ce),xe&&(B.persistentData=new Uint8Array(new Uint8Array(Y)))):T.raise("invalid buffer data")}function ye(B){y.bufferCount--,X(B);var Y=B.buffer;T(Y,"buffer must not be deleted already"),p.deleteBuffer(Y),B.buffer=null,delete $[B.id]}function se(B,Y,ce,Se){y.bufferCount++;var ne=new W(Y);$[ne.id]=ne;function xe(re){var be=fd,Ve=null,We=0,ge=0,pe=1;return Array.isArray(re)||n(re)||Gn(re)||re instanceof ArrayBuffer?Ve=re:typeof re=="number"?We=re|0:re&&(T.type(re,"object","buffer arguments must be an object, a number or an array"),"data"in re&&(T(Ve===null||Array.isArray(Ve)||n(Ve)||Gn(Ve),"invalid data for buffer"),Ve=re.data),"usage"in re&&(T.parameter(re.usage,ui,"invalid buffer usage"),be=ui[re.usage]),"type"in re&&(T.parameter(re.type,$r,"invalid buffer type"),ge=$r[re.type]),"dimension"in re&&(T.type(re.dimension,"number","invalid dimension"),pe=re.dimension|0),"length"in re&&(T.nni(We,"buffer length must be a nonnegative integer"),We=re.length|0)),ne.bind(),Ve?me(ne,Ve,be,ge,pe,Se):(We&&p.bufferData(ne.type,We,be),ne.dtype=ge||Ps,ne.usage=be,ne.dimension=pe,ne.byteLength=We),R.profile&&(ne.stats.size=ne.byteLength*gr[ne.dtype]),xe}function oe(re,be){T(be+re.byteLength<=ne.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+re.byteLength+" starting from offset "+be+" to a buffer of size "+ne.byteLength),p.bufferSubData(ne.type,be,re)}function _e(re,be){var Ve=(be||0)|0,We;if(ne.bind(),n(re)||re instanceof ArrayBuffer)oe(re,Ve);else if(Array.isArray(re)){if(re.length>0)if(typeof re[0]=="number"){var ge=Wt.allocType(ne.dtype,re.length);pd(ge,re),oe(ge,Ve),Wt.freeType(ge)}else if(Array.isArray(re[0])||n(re[0])){We=cd(re);var pe=Ds(re,We,ne.dtype);oe(pe,Ve),Wt.freeType(pe)}else T.raise("invalid buffer data")}else if(Gn(re)){We=re.shape;var te=re.stride,$e=0,qe=0,Le=0,rt=0;We.length===1?($e=We[0],qe=1,Le=te[0],rt=0):We.length===2?($e=We[0],qe=We[1],Le=te[0],rt=te[1]):T.raise("invalid shape");var Ye=Array.isArray(re.data)?ne.dtype:di(re.data),nt=Wt.allocType(Ye,$e*qe);hd(nt,re.data,$e,qe,Le,rt,re.offset),oe(nt,Ve),Wt.freeType(nt)}else T.raise("invalid data for buffer subdata");return xe}return ce||xe(B),xe._reglType="buffer",xe._buffer=ne,xe.subdata=_e,R.profile&&(xe.stats=ne.stats),xe.destroy=function(){ye(ne)},xe}function ve(){On($).forEach(function(B){B.buffer=p.createBuffer(),p.bindBuffer(B.type,B.buffer),p.bufferData(B.type,B.persistentData||B.byteLength,B.usage)})}return R.profile&&(y.getTotalBufferSize=function(){var B=0;return Object.keys($).forEach(function(Y){B+=$[Y].stats.size}),B}),{create:se,createStream:le,destroyStream:fe,clear:function(){On($).forEach(ye),ie.forEach(ye)},getBuffer:function(B){return B&&B._buffer instanceof W?B._buffer:null},restore:ve,_initBuffer:me}}var r_=0,o_=0,a_=1,i_=1,s_=4,l_=4,bo={points:r_,point:o_,lines:a_,line:i_,triangles:s_,triangle:l_,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},u_=0,d_=1,ha=4,c_=5120,yo=5121,md=5122,go=5123,vd=5124,Xr=5125,Vs=34963,f_=35040,p_=35044;function h_(p,y,R,X){var Z={},$=0,W={uint8:yo,uint16:go};y.oes_element_index_uint&&(W.uint32=Xr);function ie(ve){this.id=$++,Z[this.id]=this,this.buffer=ve,this.primType=ha,this.vertCount=0,this.type=0}ie.prototype.bind=function(){this.buffer.bind()};var le=[];function fe(ve){var B=le.pop();return B||(B=new ie(R.create(null,Vs,!0,!1)._buffer)),me(B,ve,f_,-1,-1,0,0),B}function ue(ve){le.push(ve)}function me(ve,B,Y,ce,Se,ne,xe){ve.buffer.bind();var oe;if(B){var _e=xe;!xe&&(!n(B)||Gn(B)&&!n(B.data))&&(_e=y.oes_element_index_uint?Xr:go),R._initBuffer(ve.buffer,B,Y,_e,3)}else p.bufferData(Vs,ne,Y),ve.buffer.dtype=oe||yo,ve.buffer.usage=Y,ve.buffer.dimension=3,ve.buffer.byteLength=ne;if(oe=xe,!xe){switch(ve.buffer.dtype){case yo:case c_:oe=yo;break;case go:case md:oe=go;break;case Xr:case vd:oe=Xr;break;default:T.raise("unsupported type for element array")}ve.buffer.dtype=oe}ve.type=oe,T(oe!==Xr||!!y.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var re=Se;re<0&&(re=ve.buffer.byteLength,oe===go?re>>=1:oe===Xr&&(re>>=2)),ve.vertCount=re;var be=ce;if(ce<0){be=ha;var Ve=ve.buffer.dimension;Ve===1&&(be=u_),Ve===2&&(be=d_),Ve===3&&(be=ha)}ve.primType=be}function ye(ve){X.elementsCount--,T(ve.buffer!==null,"must not double destroy elements"),delete Z[ve.id],ve.buffer.destroy(),ve.buffer=null}function se(ve,B){var Y=R.create(null,Vs,!0),ce=new ie(Y._buffer);X.elementsCount++;function Se(ne){if(!ne)Y(),ce.primType=ha,ce.vertCount=0,ce.type=yo;else if(typeof ne=="number")Y(ne),ce.primType=ha,ce.vertCount=ne|0,ce.type=yo;else{var xe=null,oe=p_,_e=-1,re=-1,be=0,Ve=0;Array.isArray(ne)||n(ne)||Gn(ne)?xe=ne:(T.type(ne,"object","invalid arguments for elements"),"data"in ne&&(xe=ne.data,T(Array.isArray(xe)||n(xe)||Gn(xe),"invalid data for element buffer")),"usage"in ne&&(T.parameter(ne.usage,ui,"invalid element buffer usage"),oe=ui[ne.usage]),"primitive"in ne&&(T.parameter(ne.primitive,bo,"invalid element buffer primitive"),_e=bo[ne.primitive]),"count"in ne&&(T(typeof ne.count=="number"&&ne.count>=0,"invalid vertex count for elements"),re=ne.count|0),"type"in ne&&(T.parameter(ne.type,W,"invalid buffer type"),Ve=W[ne.type]),"length"in ne?be=ne.length|0:(be=re,Ve===go||Ve===md?be*=2:(Ve===Xr||Ve===vd)&&(be*=4))),me(ce,xe,oe,_e,re,be,Ve)}return Se}return Se(ve),Se._reglType="elements",Se._elements=ce,Se.subdata=function(ne,xe){return Y.subdata(ne,xe),Se},Se.destroy=function(){ye(ce)},Se}return{create:se,createStream:fe,destroyStream:ue,getElements:function(ve){return typeof ve=="function"&&ve._elements instanceof ie?ve._elements:null},clear:function(){On(Z).forEach(ye)}}}var _d=new Float32Array(1),m_=new Uint32Array(_d.buffer),v_=5123;function bd(p){for(var y=Wt.allocType(v_,p.length),R=0;R<p.length;++R)if(isNaN(p[R]))y[R]=65535;else if(p[R]===1/0)y[R]=31744;else if(p[R]===-1/0)y[R]=64512;else{_d[0]=p[R];var X=m_[0],Z=X>>>31<<15,$=(X<<1>>>24)-127,W=X>>13&1024-1;if($<-24)y[R]=Z;else if($<-14){var ie=-14-$;y[R]=Z+(W+1024>>ie)}else $>15?y[R]=Z+31744:y[R]=Z+($+15<<10)+W}return y}function Bt(p){return Array.isArray(p)||n(p)}var yd=function(p){return!(p&p-1)&&!!p},__=34467,Kn=3553,Bs=34067,ci=34069,Hr=6408,Us=6406,fi=6407,ma=6409,pi=6410,gd=32854,Gs=32855,Ed=36194,b_=32819,y_=32820,g_=33635,E_=34042,js=6402,hi=34041,zs=35904,$s=35906,Eo=36193,Xs=33776,Hs=33777,Ws=33778,Ys=33779,Td=35986,Id=35987,Sd=34798,wd=35840,Ad=35841,xd=35842,Rd=35843,Cd=36196,To=5121,Ks=5123,qs=5125,va=5126,T_=10242,I_=10243,S_=10497,Qs=33071,w_=33648,A_=10240,x_=10241,Zs=9728,R_=9729,Js=9984,Nd=9985,Od=9986,el=9987,C_=33170,mi=4352,N_=4353,O_=4354,F_=34046,L_=3317,M_=37440,D_=37441,P_=37443,Fd=37444,_a=33984,k_=[Js,Od,Nd,el],vi=[0,ma,pi,fi,Hr],Dn={};Dn[ma]=Dn[Us]=Dn[js]=1,Dn[hi]=Dn[pi]=2,Dn[fi]=Dn[zs]=3,Dn[Hr]=Dn[$s]=4;function Io(p){return"[object "+p+"]"}var Ld=Io("HTMLCanvasElement"),Md=Io("OffscreenCanvas"),Dd=Io("CanvasRenderingContext2D"),Pd=Io("ImageBitmap"),kd=Io("HTMLImageElement"),Vd=Io("HTMLVideoElement"),V_=Object.keys(Ms).concat([Ld,Md,Dd,Pd,kd,Vd]),So=[];So[To]=1,So[va]=4,So[Eo]=2,So[Ks]=2,So[qs]=4;var un=[];un[gd]=2,un[Gs]=2,un[Ed]=2,un[hi]=4,un[Xs]=.5,un[Hs]=.5,un[Ws]=1,un[Ys]=1,un[Td]=.5,un[Id]=1,un[Sd]=1,un[wd]=.5,un[Ad]=.25,un[xd]=.5,un[Rd]=.25,un[Cd]=.5;function Bd(p){return Array.isArray(p)&&(p.length===0||typeof p[0]=="number")}function Ud(p){if(!Array.isArray(p))return!1;var y=p.length;return!(y===0||!Bt(p[0]))}function Wr(p){return Object.prototype.toString.call(p)}function Gd(p){return Wr(p)===Ld}function jd(p){return Wr(p)===Md}function B_(p){return Wr(p)===Dd}function U_(p){return Wr(p)===Pd}function G_(p){return Wr(p)===kd}function j_(p){return Wr(p)===Vd}function tl(p){if(!p)return!1;var y=Wr(p);return V_.indexOf(y)>=0?!0:Bd(p)||Ud(p)||Gn(p)}function zd(p){return Ms[Object.prototype.toString.call(p)]|0}function z_(p,y){var R=y.length;switch(p.type){case To:case Ks:case qs:case va:var X=Wt.allocType(p.type,R);X.set(y),p.data=X;break;case Eo:p.data=bd(y);break;default:T.raise("unsupported texture type, must specify a typed array")}}function $d(p,y){return Wt.allocType(p.type===Eo?va:p.type,y)}function Xd(p,y){p.type===Eo?(p.data=bd(y),Wt.freeType(y)):p.data=y}function $_(p,y,R,X,Z,$){for(var W=p.width,ie=p.height,le=p.channels,fe=W*ie*le,ue=$d(p,fe),me=0,ye=0;ye<ie;++ye)for(var se=0;se<W;++se)for(var ve=0;ve<le;++ve)ue[me++]=y[R*se+X*ye+Z*ve+$];Xd(p,ue)}function _i(p,y,R,X,Z,$){var W;if(typeof un[p]<"u"?W=un[p]:W=Dn[p]*So[y],$&&(W*=6),Z){for(var ie=0,le=R;le>=1;)ie+=W*le*le,le/=2;return ie}else return W*R*X}function X_(p,y,R,X,Z,$,W){var ie={"don't care":mi,"dont care":mi,nice:O_,fast:N_},le={repeat:S_,clamp:Qs,mirror:w_},fe={nearest:Zs,linear:R_},ue=r({mipmap:el,"nearest mipmap nearest":Js,"linear mipmap nearest":Nd,"nearest mipmap linear":Od,"linear mipmap linear":el},fe),me={none:0,browser:Fd},ye={uint8:To,rgba4:b_,rgb565:g_,"rgb5 a1":y_},se={alpha:Us,luminance:ma,"luminance alpha":pi,rgb:fi,rgba:Hr,rgba4:gd,"rgb5 a1":Gs,rgb565:Ed},ve={};y.ext_srgb&&(se.srgb=zs,se.srgba=$s),y.oes_texture_float&&(ye.float32=ye.float=va),y.oes_texture_half_float&&(ye.float16=ye["half float"]=Eo),y.webgl_depth_texture&&(r(se,{depth:js,"depth stencil":hi}),r(ye,{uint16:Ks,uint32:qs,"depth stencil":E_})),y.webgl_compressed_texture_s3tc&&r(ve,{"rgb s3tc dxt1":Xs,"rgba s3tc dxt1":Hs,"rgba s3tc dxt3":Ws,"rgba s3tc dxt5":Ys}),y.webgl_compressed_texture_atc&&r(ve,{"rgb atc":Td,"rgba atc explicit alpha":Id,"rgba atc interpolated alpha":Sd}),y.webgl_compressed_texture_pvrtc&&r(ve,{"rgb pvrtc 4bppv1":wd,"rgb pvrtc 2bppv1":Ad,"rgba pvrtc 4bppv1":xd,"rgba pvrtc 2bppv1":Rd}),y.webgl_compressed_texture_etc1&&(ve["rgb etc1"]=Cd);var B=Array.prototype.slice.call(p.getParameter(__));Object.keys(ve).forEach(function(A){var H=ve[A];B.indexOf(H)>=0&&(se[A]=H)});var Y=Object.keys(se);R.textureFormats=Y;var ce=[];Object.keys(se).forEach(function(A){var H=se[A];ce[H]=A});var Se=[];Object.keys(ye).forEach(function(A){var H=ye[A];Se[H]=A});var ne=[];Object.keys(fe).forEach(function(A){var H=fe[A];ne[H]=A});var xe=[];Object.keys(ue).forEach(function(A){var H=ue[A];xe[H]=A});var oe=[];Object.keys(le).forEach(function(A){var H=le[A];oe[H]=A});var _e=Y.reduce(function(A,H){var j=se[H];return j===ma||j===Us||j===ma||j===pi||j===js||j===hi||y.ext_srgb&&(j===zs||j===$s)?A[j]=j:j===Gs||H.indexOf("rgba")>=0?A[j]=Hr:A[j]=fi,A},{});function re(){this.internalformat=Hr,this.format=Hr,this.type=To,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Fd,this.width=0,this.height=0,this.channels=0}function be(A,H){A.internalformat=H.internalformat,A.format=H.format,A.type=H.type,A.compressed=H.compressed,A.premultiplyAlpha=H.premultiplyAlpha,A.flipY=H.flipY,A.unpackAlignment=H.unpackAlignment,A.colorSpace=H.colorSpace,A.width=H.width,A.height=H.height,A.channels=H.channels}function Ve(A,H){if(!(typeof H!="object"||!H)){if("premultiplyAlpha"in H&&(T.type(H.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),A.premultiplyAlpha=H.premultiplyAlpha),"flipY"in H&&(T.type(H.flipY,"boolean","invalid texture flip"),A.flipY=H.flipY),"alignment"in H&&(T.oneOf(H.alignment,[1,2,4,8],"invalid texture unpack alignment"),A.unpackAlignment=H.alignment),"colorSpace"in H&&(T.parameter(H.colorSpace,me,"invalid colorSpace"),A.colorSpace=me[H.colorSpace]),"type"in H){var j=H.type;T(y.oes_texture_float||!(j==="float"||j==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),T(y.oes_texture_half_float||!(j==="half float"||j==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),T(y.webgl_depth_texture||!(j==="uint16"||j==="uint32"||j==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),T.parameter(j,ye,"invalid texture type"),A.type=ye[j]}var Ne=A.width,ot=A.height,I=A.channels,_=!1;"shape"in H?(T(Array.isArray(H.shape)&&H.shape.length>=2,"shape must be an array"),Ne=H.shape[0],ot=H.shape[1],H.shape.length===3&&(I=H.shape[2],T(I>0&&I<=4,"invalid number of channels"),_=!0),T(Ne>=0&&Ne<=R.maxTextureSize,"invalid width"),T(ot>=0&&ot<=R.maxTextureSize,"invalid height")):("radius"in H&&(Ne=ot=H.radius,T(Ne>=0&&Ne<=R.maxTextureSize,"invalid radius")),"width"in H&&(Ne=H.width,T(Ne>=0&&Ne<=R.maxTextureSize,"invalid width")),"height"in H&&(ot=H.height,T(ot>=0&&ot<=R.maxTextureSize,"invalid height")),"channels"in H&&(I=H.channels,T(I>0&&I<=4,"invalid number of channels"),_=!0)),A.width=Ne|0,A.height=ot|0,A.channels=I|0;var N=!1;if("format"in H){var V=H.format;T(y.webgl_depth_texture||!(V==="depth"||V==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),T.parameter(V,se,"invalid texture format");var U=A.internalformat=se[V];A.format=_e[U],V in ye&&("type"in H||(A.type=ye[V])),V in ve&&(A.compressed=!0),N=!0}!_&&N?A.channels=Dn[A.format]:_&&!N?A.channels!==vi[A.format]&&(A.format=A.internalformat=vi[A.channels]):N&&_&&T(A.channels===Dn[A.format],"number of channels inconsistent with specified format")}}function We(A){p.pixelStorei(M_,A.flipY),p.pixelStorei(D_,A.premultiplyAlpha),p.pixelStorei(P_,A.colorSpace),p.pixelStorei(L_,A.unpackAlignment)}function ge(){re.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function pe(A,H){var j=null;if(tl(H)?j=H:H&&(T.type(H,"object","invalid pixel data type"),Ve(A,H),"x"in H&&(A.xOffset=H.x|0),"y"in H&&(A.yOffset=H.y|0),tl(H.data)&&(j=H.data)),T(!A.compressed||j instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),H.copy){T(!j,"can not specify copy and data field for the same texture");var Ne=Z.viewportWidth,ot=Z.viewportHeight;A.width=A.width||Ne-A.xOffset,A.height=A.height||ot-A.yOffset,A.needsCopy=!0,T(A.xOffset>=0&&A.xOffset<Ne&&A.yOffset>=0&&A.yOffset<ot&&A.width>0&&A.width<=Ne&&A.height>0&&A.height<=ot,"copy texture read out of bounds")}else if(!j)A.width=A.width||1,A.height=A.height||1,A.channels=A.channels||4;else if(n(j))A.channels=A.channels||4,A.data=j,!("type"in H)&&A.type===To&&(A.type=zd(j));else if(Bd(j))A.channels=A.channels||4,z_(A,j),A.alignment=1,A.needsFree=!0;else if(Gn(j)){var I=j.data;!Array.isArray(I)&&A.type===To&&(A.type=zd(I));var _=j.shape,N=j.stride,V,U,M,O,P,S;_.length===3?(M=_[2],S=N[2]):(T(_.length===2,"invalid ndarray pixel data, must be 2 or 3D"),M=1,S=1),V=_[0],U=_[1],O=N[0],P=N[1],A.alignment=1,A.width=V,A.height=U,A.channels=M,A.format=A.internalformat=vi[M],A.needsFree=!0,$_(A,I,O,P,S,j.offset)}else if(Gd(j)||jd(j)||B_(j))Gd(j)||jd(j)?A.element=j:A.element=j.canvas,A.width=A.element.width,A.height=A.element.height,A.channels=4;else if(U_(j))A.element=j,A.width=j.width,A.height=j.height,A.channels=4;else if(G_(j))A.element=j,A.width=j.naturalWidth,A.height=j.naturalHeight,A.channels=4;else if(j_(j))A.element=j,A.width=j.videoWidth,A.height=j.videoHeight,A.channels=4;else if(Ud(j)){var C=A.width||j[0].length,g=A.height||j.length,k=A.channels;Bt(j[0][0])?k=k||j[0][0].length:k=k||1;for(var G=li.shape(j),Q=1,J=0;J<G.length;++J)Q*=G[J];var q=$d(A,Q);li.flatten(j,G,"",q),Xd(A,q),A.alignment=1,A.width=C,A.height=g,A.channels=k,A.format=A.internalformat=vi[k],A.needsFree=!0}A.type===va?T(R.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):A.type===Eo&&T(R.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function te(A,H,j){var Ne=A.element,ot=A.data,I=A.internalformat,_=A.format,N=A.type,V=A.width,U=A.height;We(A),Ne?p.texImage2D(H,j,_,_,N,Ne):A.compressed?p.compressedTexImage2D(H,j,I,V,U,0,ot):A.needsCopy?(X(),p.copyTexImage2D(H,j,_,A.xOffset,A.yOffset,V,U,0)):p.texImage2D(H,j,_,V,U,0,_,N,ot||null)}function $e(A,H,j,Ne,ot){var I=A.element,_=A.data,N=A.internalformat,V=A.format,U=A.type,M=A.width,O=A.height;We(A),I?p.texSubImage2D(H,ot,j,Ne,V,U,I):A.compressed?p.compressedTexSubImage2D(H,ot,j,Ne,N,M,O,_):A.needsCopy?(X(),p.copyTexSubImage2D(H,ot,j,Ne,A.xOffset,A.yOffset,M,O)):p.texSubImage2D(H,ot,j,Ne,M,O,V,U,_)}var qe=[];function Le(){return qe.pop()||new ge}function rt(A){A.needsFree&&Wt.freeType(A.data),ge.call(A),qe.push(A)}function Ye(){re.call(this),this.genMipmaps=!1,this.mipmapHint=mi,this.mipmask=0,this.images=Array(16)}function nt(A,H,j){var Ne=A.images[0]=Le();A.mipmask=1,Ne.width=A.width=H,Ne.height=A.height=j,Ne.channels=A.channels=4}function mt(A,H){var j=null;if(tl(H))j=A.images[0]=Le(),be(j,A),pe(j,H),A.mipmask=1;else if(Ve(A,H),Array.isArray(H.mipmap))for(var Ne=H.mipmap,ot=0;ot<Ne.length;++ot)j=A.images[ot]=Le(),be(j,A),j.width>>=ot,j.height>>=ot,pe(j,Ne[ot]),A.mipmask|=1<<ot;else j=A.images[0]=Le(),be(j,A),pe(j,H),A.mipmask=1;be(A,A.images[0]),A.compressed&&(A.internalformat===Xs||A.internalformat===Hs||A.internalformat===Ws||A.internalformat===Ys)&&T(A.width%4===0&&A.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Kt(A,H){for(var j=A.images,Ne=0;Ne<j.length;++Ne){if(!j[Ne])return;te(j[Ne],H,Ne)}}var nn=[];function lt(){var A=nn.pop()||new Ye;re.call(A),A.mipmask=0;for(var H=0;H<16;++H)A.images[H]=null;return A}function Zt(A){for(var H=A.images,j=0;j<H.length;++j)H[j]&&rt(H[j]),H[j]=null;nn.push(A)}function xt(){this.minFilter=Zs,this.magFilter=Zs,this.wrapS=Qs,this.wrapT=Qs,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=mi}function qt(A,H){if("min"in H){var j=H.min;T.parameter(j,ue),A.minFilter=ue[j],k_.indexOf(A.minFilter)>=0&&!("faces"in H)&&(A.genMipmaps=!0)}if("mag"in H){var Ne=H.mag;T.parameter(Ne,fe),A.magFilter=fe[Ne]}var ot=A.wrapS,I=A.wrapT;if("wrap"in H){var _=H.wrap;typeof _=="string"?(T.parameter(_,le),ot=I=le[_]):Array.isArray(_)&&(T.parameter(_[0],le),T.parameter(_[1],le),ot=le[_[0]],I=le[_[1]])}else{if("wrapS"in H){var N=H.wrapS;T.parameter(N,le),ot=le[N]}if("wrapT"in H){var V=H.wrapT;T.parameter(V,le),I=le[V]}}if(A.wrapS=ot,A.wrapT=I,"anisotropic"in H){var U=H.anisotropic;T(typeof U=="number"&&U>=1&&U<=R.maxAnisotropic,"aniso samples must be between 1 and "),A.anisotropic=H.anisotropic}if("mipmap"in H){var M=!1;switch(typeof H.mipmap){case"string":T.parameter(H.mipmap,ie,"invalid mipmap hint"),A.mipmapHint=ie[H.mipmap],A.genMipmaps=!0,M=!0;break;case"boolean":M=A.genMipmaps=H.mipmap;break;case"object":T(Array.isArray(H.mipmap),"invalid mipmap type"),A.genMipmaps=!1,M=!0;break;default:T.raise("invalid mipmap type")}M&&!("min"in H)&&(A.minFilter=Js)}}function Jt(A,H){p.texParameteri(H,x_,A.minFilter),p.texParameteri(H,A_,A.magFilter),p.texParameteri(H,T_,A.wrapS),p.texParameteri(H,I_,A.wrapT),y.ext_texture_filter_anisotropic&&p.texParameteri(H,F_,A.anisotropic),A.genMipmaps&&(p.hint(C_,A.mipmapHint),p.generateMipmap(H))}var en=0,rn={},dn=R.maxTextureUnits,Ut=Array(dn).map(function(){return null});function Qe(A){re.call(this),this.mipmask=0,this.internalformat=Hr,this.id=en++,this.refCount=1,this.target=A,this.texture=p.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new xt,W.profile&&(this.stats={size:0})}function cn(A){p.activeTexture(_a),p.bindTexture(A.target,A.texture)}function gt(){var A=Ut[0];A?p.bindTexture(A.target,A.texture):p.bindTexture(Kn,null)}function Ue(A){var H=A.texture;T(H,"must not double destroy texture");var j=A.unit,Ne=A.target;j>=0&&(p.activeTexture(_a+j),p.bindTexture(Ne,null),Ut[j]=null),p.deleteTexture(H),A.texture=null,A.params=null,A.pixels=null,A.refCount=0,delete rn[A.id],$.textureCount--}r(Qe.prototype,{bind:function(){var A=this;A.bindCount+=1;var H=A.unit;if(H<0){for(var j=0;j<dn;++j){var Ne=Ut[j];if(Ne){if(Ne.bindCount>0)continue;Ne.unit=-1}Ut[j]=A,H=j;break}H>=dn&&T.raise("insufficient number of texture units"),W.profile&&$.maxTextureUnits<H+1&&($.maxTextureUnits=H+1),A.unit=H,p.activeTexture(_a+H),p.bindTexture(A.target,A.texture)}return H},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ue(this)}});function it(A,H){var j=new Qe(Kn);rn[j.id]=j,$.textureCount++;function Ne(_,N){var V=j.texInfo;xt.call(V);var U=lt();return typeof _=="number"?typeof N=="number"?nt(U,_|0,N|0):nt(U,_|0,_|0):_?(T.type(_,"object","invalid arguments to regl.texture"),qt(V,_),mt(U,_)):nt(U,1,1),V.genMipmaps&&(U.mipmask=(U.width<<1)-1),j.mipmask=U.mipmask,be(j,U),T.texture2D(V,U,R),j.internalformat=U.internalformat,Ne.width=U.width,Ne.height=U.height,cn(j),Kt(U,Kn),Jt(V,Kn),gt(),Zt(U),W.profile&&(j.stats.size=_i(j.internalformat,j.type,U.width,U.height,V.genMipmaps,!1)),Ne.format=ce[j.internalformat],Ne.type=Se[j.type],Ne.mag=ne[V.magFilter],Ne.min=xe[V.minFilter],Ne.wrapS=oe[V.wrapS],Ne.wrapT=oe[V.wrapT],Ne}function ot(_,N,V,U){T(!!_,"must specify image data");var M=N|0,O=V|0,P=U|0,S=Le();return be(S,j),S.width=0,S.height=0,pe(S,_),S.width=S.width||(j.width>>P)-M,S.height=S.height||(j.height>>P)-O,T(j.type===S.type&&j.format===S.format&&j.internalformat===S.internalformat,"incompatible format for texture.subimage"),T(M>=0&&O>=0&&M+S.width<=j.width&&O+S.height<=j.height,"texture.subimage write out of bounds"),T(j.mipmask&1<<P,"missing mipmap data"),T(S.data||S.element||S.needsCopy,"missing image data"),cn(j),$e(S,Kn,M,O,P),gt(),rt(S),Ne}function I(_,N){var V=_|0,U=N|0||V;if(V===j.width&&U===j.height)return Ne;Ne.width=j.width=V,Ne.height=j.height=U,cn(j);for(var M=0;j.mipmask>>M;++M){var O=V>>M,P=U>>M;if(!O||!P)break;p.texImage2D(Kn,M,j.format,O,P,0,j.format,j.type,null)}return gt(),W.profile&&(j.stats.size=_i(j.internalformat,j.type,V,U,!1,!1)),Ne}return Ne(A,H),Ne.subimage=ot,Ne.resize=I,Ne._reglType="texture2d",Ne._texture=j,W.profile&&(Ne.stats=j.stats),Ne.destroy=function(){j.decRef()},Ne}function pt(A,H,j,Ne,ot,I){var _=new Qe(Bs);rn[_.id]=_,$.cubeCount++;var N=new Array(6);function V(O,P,S,C,g,k){var G,Q=_.texInfo;for(xt.call(Q),G=0;G<6;++G)N[G]=lt();if(typeof O=="number"||!O){var J=O|0||1;for(G=0;G<6;++G)nt(N[G],J,J)}else if(typeof O=="object")if(P)mt(N[0],O),mt(N[1],P),mt(N[2],S),mt(N[3],C),mt(N[4],g),mt(N[5],k);else if(qt(Q,O),Ve(_,O),"faces"in O){var q=O.faces;for(T(Array.isArray(q)&&q.length===6,"cube faces must be a length 6 array"),G=0;G<6;++G)T(typeof q[G]=="object"&&!!q[G],"invalid input for cube map face"),be(N[G],_),mt(N[G],q[G])}else for(G=0;G<6;++G)mt(N[G],O);else T.raise("invalid arguments to cube map");for(be(_,N[0]),R.npotTextureCube||T(yd(_.width)&&yd(_.height),"your browser does not support non power or two texture dimensions"),Q.genMipmaps?_.mipmask=(N[0].width<<1)-1:_.mipmask=N[0].mipmask,T.textureCube(_,Q,N,R),_.internalformat=N[0].internalformat,V.width=N[0].width,V.height=N[0].height,cn(_),G=0;G<6;++G)Kt(N[G],ci+G);for(Jt(Q,Bs),gt(),W.profile&&(_.stats.size=_i(_.internalformat,_.type,V.width,V.height,Q.genMipmaps,!0)),V.format=ce[_.internalformat],V.type=Se[_.type],V.mag=ne[Q.magFilter],V.min=xe[Q.minFilter],V.wrapS=oe[Q.wrapS],V.wrapT=oe[Q.wrapT],G=0;G<6;++G)Zt(N[G]);return V}function U(O,P,S,C,g){T(!!P,"must specify image data"),T(typeof O=="number"&&O===(O|0)&&O>=0&&O<6,"invalid face");var k=S|0,G=C|0,Q=g|0,J=Le();return be(J,_),J.width=0,J.height=0,pe(J,P),J.width=J.width||(_.width>>Q)-k,J.height=J.height||(_.height>>Q)-G,T(_.type===J.type&&_.format===J.format&&_.internalformat===J.internalformat,"incompatible format for texture.subimage"),T(k>=0&&G>=0&&k+J.width<=_.width&&G+J.height<=_.height,"texture.subimage write out of bounds"),T(_.mipmask&1<<Q,"missing mipmap data"),T(J.data||J.element||J.needsCopy,"missing image data"),cn(_),$e(J,ci+O,k,G,Q),gt(),rt(J),V}function M(O){var P=O|0;if(P!==_.width){V.width=_.width=P,V.height=_.height=P,cn(_);for(var S=0;S<6;++S)for(var C=0;_.mipmask>>C;++C)p.texImage2D(ci+S,C,_.format,P>>C,P>>C,0,_.format,_.type,null);return gt(),W.profile&&(_.stats.size=_i(_.internalformat,_.type,V.width,V.height,!1,!0)),V}}return V(A,H,j,Ne,ot,I),V.subimage=U,V.resize=M,V._reglType="textureCube",V._texture=_,W.profile&&(V.stats=_.stats),V.destroy=function(){_.decRef()},V}function Gt(){for(var A=0;A<dn;++A)p.activeTexture(_a+A),p.bindTexture(Kn,null),Ut[A]=null;On(rn).forEach(Ue),$.cubeCount=0,$.textureCount=0}W.profile&&($.getTotalTextureSize=function(){var A=0;return Object.keys(rn).forEach(function(H){A+=rn[H].stats.size}),A});function Qn(){for(var A=0;A<dn;++A){var H=Ut[A];H&&(H.bindCount=0,H.unit=-1,Ut[A]=null)}On(rn).forEach(function(j){j.texture=p.createTexture(),p.bindTexture(j.target,j.texture);for(var Ne=0;Ne<32;++Ne)if(j.mipmask&1<<Ne)if(j.target===Kn)p.texImage2D(Kn,Ne,j.internalformat,j.width>>Ne,j.height>>Ne,0,j.internalformat,j.type,null);else for(var ot=0;ot<6;++ot)p.texImage2D(ci+ot,Ne,j.internalformat,j.width>>Ne,j.height>>Ne,0,j.internalformat,j.type,null);Jt(j.texInfo,j.target)})}function eo(){for(var A=0;A<dn;++A){var H=Ut[A];H&&(H.bindCount=0,H.unit=-1,Ut[A]=null),p.activeTexture(_a+A),p.bindTexture(Kn,null),p.bindTexture(Bs,null)}}return{create2D:it,createCube:pt,clear:Gt,getTexture:function(A){return null},restore:Qn,refresh:eo}}var Er=36161,bi=32854,Hd=32855,Wd=36194,Yd=33189,Kd=36168,qd=34041,Qd=35907,Zd=34836,Jd=34842,ec=34843,jn=[];jn[bi]=2,jn[Hd]=2,jn[Wd]=2,jn[Yd]=2,jn[Kd]=1,jn[qd]=4,jn[Qd]=4,jn[Zd]=16,jn[Jd]=8,jn[ec]=6;function tc(p,y,R){return jn[p]*y*R}var H_=function(p,y,R,X,Z){var $={rgba4:bi,rgb565:Wd,"rgb5 a1":Hd,depth:Yd,stencil:Kd,"depth stencil":qd};y.ext_srgb&&($.srgba=Qd),y.ext_color_buffer_half_float&&($.rgba16f=Jd,$.rgb16f=ec),y.webgl_color_buffer_float&&($.rgba32f=Zd);var W=[];Object.keys($).forEach(function(se){var ve=$[se];W[ve]=se});var ie=0,le={};function fe(se){this.id=ie++,this.refCount=1,this.renderbuffer=se,this.format=bi,this.width=0,this.height=0,Z.profile&&(this.stats={size:0})}fe.prototype.decRef=function(){--this.refCount<=0&&ue(this)};function ue(se){var ve=se.renderbuffer;T(ve,"must not double destroy renderbuffer"),p.bindRenderbuffer(Er,null),p.deleteRenderbuffer(ve),se.renderbuffer=null,se.refCount=0,delete le[se.id],X.renderbufferCount--}function me(se,ve){var B=new fe(p.createRenderbuffer());le[B.id]=B,X.renderbufferCount++;function Y(Se,ne){var xe=0,oe=0,_e=bi;if(typeof Se=="object"&&Se){var re=Se;if("shape"in re){var be=re.shape;T(Array.isArray(be)&&be.length>=2,"invalid renderbuffer shape"),xe=be[0]|0,oe=be[1]|0}else"radius"in re&&(xe=oe=re.radius|0),"width"in re&&(xe=re.width|0),"height"in re&&(oe=re.height|0);"format"in re&&(T.parameter(re.format,$,"invalid renderbuffer format"),_e=$[re.format])}else typeof Se=="number"?(xe=Se|0,typeof ne=="number"?oe=ne|0:oe=xe):Se?T.raise("invalid arguments to renderbuffer constructor"):xe=oe=1;if(T(xe>0&&oe>0&&xe<=R.maxRenderbufferSize&&oe<=R.maxRenderbufferSize,"invalid renderbuffer size"),!(xe===B.width&&oe===B.height&&_e===B.format))return Y.width=B.width=xe,Y.height=B.height=oe,B.format=_e,p.bindRenderbuffer(Er,B.renderbuffer),p.renderbufferStorage(Er,_e,xe,oe),T(p.getError()===0,"invalid render buffer format"),Z.profile&&(B.stats.size=tc(B.format,B.width,B.height)),Y.format=W[B.format],Y}function ce(Se,ne){var xe=Se|0,oe=ne|0||xe;return xe===B.width&&oe===B.height||(T(xe>0&&oe>0&&xe<=R.maxRenderbufferSize&&oe<=R.maxRenderbufferSize,"invalid renderbuffer size"),Y.width=B.width=xe,Y.height=B.height=oe,p.bindRenderbuffer(Er,B.renderbuffer),p.renderbufferStorage(Er,B.format,xe,oe),T(p.getError()===0,"invalid render buffer format"),Z.profile&&(B.stats.size=tc(B.format,B.width,B.height))),Y}return Y(se,ve),Y.resize=ce,Y._reglType="renderbuffer",Y._renderbuffer=B,Z.profile&&(Y.stats=B.stats),Y.destroy=function(){B.decRef()},Y}Z.profile&&(X.getTotalRenderbufferSize=function(){var se=0;return Object.keys(le).forEach(function(ve){se+=le[ve].stats.size}),se});function ye(){On(le).forEach(function(se){se.renderbuffer=p.createRenderbuffer(),p.bindRenderbuffer(Er,se.renderbuffer),p.renderbufferStorage(Er,se.format,se.width,se.height)}),p.bindRenderbuffer(Er,null)}return{create:me,clear:function(){On(le).forEach(ue)},restore:ye}},rr=36160,nl=36161,Yr=3553,yi=34069,nc=36064,rc=36096,oc=36128,ac=33306,ic=36053,W_=36054,Y_=36055,K_=36057,q_=36061,Q_=36193,Z_=5121,J_=5126,sc=6407,lc=6408,eb=6402,tb=[sc,lc],rl=[];rl[lc]=4,rl[sc]=3;var gi=[];gi[Z_]=1,gi[J_]=4,gi[Q_]=2;var nb=32854,rb=32855,ob=36194,ab=33189,ib=36168,uc=34041,sb=35907,lb=34836,ub=34842,db=34843,cb=[nb,rb,ob,sb,ub,db,lb],wo={};wo[ic]="complete",wo[W_]="incomplete attachment",wo[K_]="incomplete dimensions",wo[Y_]="incomplete, missing attachment",wo[q_]="unsupported";function fb(p,y,R,X,Z,$){var W={cur:null,next:null,dirty:!1,setFBO:null},ie=["rgba"],le=["rgba4","rgb565","rgb5 a1"];y.ext_srgb&&le.push("srgba"),y.ext_color_buffer_half_float&&le.push("rgba16f","rgb16f"),y.webgl_color_buffer_float&&le.push("rgba32f");var fe=["uint8"];y.oes_texture_half_float&&fe.push("half float","float16"),y.oes_texture_float&&fe.push("float","float32");function ue(ge,pe,te){this.target=ge,this.texture=pe,this.renderbuffer=te;var $e=0,qe=0;pe?($e=pe.width,qe=pe.height):te&&($e=te.width,qe=te.height),this.width=$e,this.height=qe}function me(ge){ge&&(ge.texture&&ge.texture._texture.decRef(),ge.renderbuffer&&ge.renderbuffer._renderbuffer.decRef())}function ye(ge,pe,te){if(ge)if(ge.texture){var $e=ge.texture._texture,qe=Math.max(1,$e.width),Le=Math.max(1,$e.height);T(qe===pe&&Le===te,"inconsistent width/height for supplied texture"),$e.refCount+=1}else{var rt=ge.renderbuffer._renderbuffer;T(rt.width===pe&&rt.height===te,"inconsistent width/height for renderbuffer"),rt.refCount+=1}}function se(ge,pe){pe&&(pe.texture?p.framebufferTexture2D(rr,ge,pe.target,pe.texture._texture.texture,0):p.framebufferRenderbuffer(rr,ge,nl,pe.renderbuffer._renderbuffer.renderbuffer))}function ve(ge){var pe=Yr,te=null,$e=null,qe=ge;typeof ge=="object"&&(qe=ge.data,"target"in ge&&(pe=ge.target|0)),T.type(qe,"function","invalid attachment data");var Le=qe._reglType;return Le==="texture2d"?(te=qe,T(pe===Yr)):Le==="textureCube"?(te=qe,T(pe>=yi&&pe<yi+6,"invalid cube map target")):Le==="renderbuffer"?($e=qe,pe=nl):T.raise("invalid regl object for attachment"),new ue(pe,te,$e)}function B(ge,pe,te,$e,qe){if(te){var Le=X.create2D({width:ge,height:pe,format:$e,type:qe});return Le._texture.refCount=0,new ue(Yr,Le,null)}else{var rt=Z.create({width:ge,height:pe,format:$e});return rt._renderbuffer.refCount=0,new ue(nl,null,rt)}}function Y(ge){return ge&&(ge.texture||ge.renderbuffer)}function ce(ge,pe,te){ge&&(ge.texture?ge.texture.resize(pe,te):ge.renderbuffer&&ge.renderbuffer.resize(pe,te),ge.width=pe,ge.height=te)}var Se=0,ne={};function xe(){this.id=Se++,ne[this.id]=this,this.framebuffer=p.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function oe(ge){ge.colorAttachments.forEach(me),me(ge.depthAttachment),me(ge.stencilAttachment),me(ge.depthStencilAttachment)}function _e(ge){var pe=ge.framebuffer;T(pe,"must not double destroy framebuffer"),p.deleteFramebuffer(pe),ge.framebuffer=null,$.framebufferCount--,delete ne[ge.id]}function re(ge){var pe;p.bindFramebuffer(rr,ge.framebuffer);var te=ge.colorAttachments;for(pe=0;pe<te.length;++pe)se(nc+pe,te[pe]);for(pe=te.length;pe<R.maxColorAttachments;++pe)p.framebufferTexture2D(rr,nc+pe,Yr,null,0);p.framebufferTexture2D(rr,ac,Yr,null,0),p.framebufferTexture2D(rr,rc,Yr,null,0),p.framebufferTexture2D(rr,oc,Yr,null,0),se(rc,ge.depthAttachment),se(oc,ge.stencilAttachment),se(ac,ge.depthStencilAttachment);var $e=p.checkFramebufferStatus(rr);!p.isContextLost()&&$e!==ic&&T.raise("framebuffer configuration not supported, status = "+wo[$e]),p.bindFramebuffer(rr,W.next?W.next.framebuffer:null),W.cur=W.next,p.getError()}function be(ge,pe){var te=new xe;$.framebufferCount++;function $e(Le,rt){var Ye;T(W.next!==te,"can not update framebuffer which is currently in use");var nt=0,mt=0,Kt=!0,nn=!0,lt=null,Zt=!0,xt="rgba",qt="uint8",Jt=1,en=null,rn=null,dn=null,Ut=!1;if(typeof Le=="number")nt=Le|0,mt=rt|0||nt;else if(!Le)nt=mt=1;else{T.type(Le,"object","invalid arguments for framebuffer");var Qe=Le;if("shape"in Qe){var cn=Qe.shape;T(Array.isArray(cn)&&cn.length>=2,"invalid shape for framebuffer"),nt=cn[0],mt=cn[1]}else"radius"in Qe&&(nt=mt=Qe.radius),"width"in Qe&&(nt=Qe.width),"height"in Qe&&(mt=Qe.height);("color"in Qe||"colors"in Qe)&&(lt=Qe.color||Qe.colors,Array.isArray(lt)&&T(lt.length===1||y.webgl_draw_buffers,"multiple render targets not supported")),lt||("colorCount"in Qe&&(Jt=Qe.colorCount|0,T(Jt>0,"invalid color buffer count")),"colorTexture"in Qe&&(Zt=!!Qe.colorTexture,xt="rgba4"),"colorType"in Qe&&(qt=Qe.colorType,Zt?(T(y.oes_texture_float||!(qt==="float"||qt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),T(y.oes_texture_half_float||!(qt==="half float"||qt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):qt==="half float"||qt==="float16"?(T(y.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),xt="rgba16f"):(qt==="float"||qt==="float32")&&(T(y.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),xt="rgba32f"),T.oneOf(qt,fe,"invalid color type")),"colorFormat"in Qe&&(xt=Qe.colorFormat,ie.indexOf(xt)>=0?Zt=!0:le.indexOf(xt)>=0?Zt=!1:Zt?T.oneOf(Qe.colorFormat,ie,"invalid color format for texture"):T.oneOf(Qe.colorFormat,le,"invalid color format for renderbuffer"))),("depthTexture"in Qe||"depthStencilTexture"in Qe)&&(Ut=!!(Qe.depthTexture||Qe.depthStencilTexture),T(!Ut||y.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Qe&&(typeof Qe.depth=="boolean"?Kt=Qe.depth:(en=Qe.depth,nn=!1)),"stencil"in Qe&&(typeof Qe.stencil=="boolean"?nn=Qe.stencil:(rn=Qe.stencil,Kt=!1)),"depthStencil"in Qe&&(typeof Qe.depthStencil=="boolean"?Kt=nn=Qe.depthStencil:(dn=Qe.depthStencil,Kt=!1,nn=!1))}var gt=null,Ue=null,it=null,pt=null;if(Array.isArray(lt))gt=lt.map(ve);else if(lt)gt=[ve(lt)];else for(gt=new Array(Jt),Ye=0;Ye<Jt;++Ye)gt[Ye]=B(nt,mt,Zt,xt,qt);T(y.webgl_draw_buffers||gt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),T(gt.length<=R.maxColorAttachments,"too many color attachments, not supported"),nt=nt||gt[0].width,mt=mt||gt[0].height,en?Ue=ve(en):Kt&&!nn&&(Ue=B(nt,mt,Ut,"depth","uint32")),rn?it=ve(rn):nn&&!Kt&&(it=B(nt,mt,!1,"stencil","uint8")),dn?pt=ve(dn):!en&&!rn&&nn&&Kt&&(pt=B(nt,mt,Ut,"depth stencil","depth stencil")),T(!!en+!!rn+!!dn<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Gt=null;for(Ye=0;Ye<gt.length;++Ye)if(ye(gt[Ye],nt,mt),T(!gt[Ye]||gt[Ye].texture&&tb.indexOf(gt[Ye].texture._texture.format)>=0||gt[Ye].renderbuffer&&cb.indexOf(gt[Ye].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ye+" is invalid"),gt[Ye]&&gt[Ye].texture){var Qn=rl[gt[Ye].texture._texture.format]*gi[gt[Ye].texture._texture.type];Gt===null?Gt=Qn:T(Gt===Qn,"all color attachments much have the same number of bits per pixel.")}return ye(Ue,nt,mt),T(!Ue||Ue.texture&&Ue.texture._texture.format===eb||Ue.renderbuffer&&Ue.renderbuffer._renderbuffer.format===ab,"invalid depth attachment for framebuffer object"),ye(it,nt,mt),T(!it||it.renderbuffer&&it.renderbuffer._renderbuffer.format===ib,"invalid stencil attachment for framebuffer object"),ye(pt,nt,mt),T(!pt||pt.texture&&pt.texture._texture.format===uc||pt.renderbuffer&&pt.renderbuffer._renderbuffer.format===uc,"invalid depth-stencil attachment for framebuffer object"),oe(te),te.width=nt,te.height=mt,te.colorAttachments=gt,te.depthAttachment=Ue,te.stencilAttachment=it,te.depthStencilAttachment=pt,$e.color=gt.map(Y),$e.depth=Y(Ue),$e.stencil=Y(it),$e.depthStencil=Y(pt),$e.width=te.width,$e.height=te.height,re(te),$e}function qe(Le,rt){T(W.next!==te,"can not resize a framebuffer which is currently in use");var Ye=Math.max(Le|0,1),nt=Math.max(rt|0||Ye,1);if(Ye===te.width&&nt===te.height)return $e;for(var mt=te.colorAttachments,Kt=0;Kt<mt.length;++Kt)ce(mt[Kt],Ye,nt);return ce(te.depthAttachment,Ye,nt),ce(te.stencilAttachment,Ye,nt),ce(te.depthStencilAttachment,Ye,nt),te.width=$e.width=Ye,te.height=$e.height=nt,re(te),$e}return $e(ge,pe),r($e,{resize:qe,_reglType:"framebuffer",_framebuffer:te,destroy:function(){_e(te),oe(te)},use:function(Le){W.setFBO({framebuffer:$e},Le)}})}function Ve(ge){var pe=Array(6);function te(qe){var Le;T(pe.indexOf(W.next)<0,"can not update framebuffer which is currently in use");var rt={color:null},Ye=0,nt=null,mt="rgba",Kt="uint8",nn=1;if(typeof qe=="number")Ye=qe|0;else if(!qe)Ye=1;else{T.type(qe,"object","invalid arguments for framebuffer");var lt=qe;if("shape"in lt){var Zt=lt.shape;T(Array.isArray(Zt)&&Zt.length>=2,"invalid shape for framebuffer"),T(Zt[0]===Zt[1],"cube framebuffer must be square"),Ye=Zt[0]}else"radius"in lt&&(Ye=lt.radius|0),"width"in lt?(Ye=lt.width|0,"height"in lt&&T(lt.height===Ye,"must be square")):"height"in lt&&(Ye=lt.height|0);("color"in lt||"colors"in lt)&&(nt=lt.color||lt.colors,Array.isArray(nt)&&T(nt.length===1||y.webgl_draw_buffers,"multiple render targets not supported")),nt||("colorCount"in lt&&(nn=lt.colorCount|0,T(nn>0,"invalid color buffer count")),"colorType"in lt&&(T.oneOf(lt.colorType,fe,"invalid color type"),Kt=lt.colorType),"colorFormat"in lt&&(mt=lt.colorFormat,T.oneOf(lt.colorFormat,ie,"invalid color format for texture"))),"depth"in lt&&(rt.depth=lt.depth),"stencil"in lt&&(rt.stencil=lt.stencil),"depthStencil"in lt&&(rt.depthStencil=lt.depthStencil)}var xt;if(nt)if(Array.isArray(nt))for(xt=[],Le=0;Le<nt.length;++Le)xt[Le]=nt[Le];else xt=[nt];else{xt=Array(nn);var qt={radius:Ye,format:mt,type:Kt};for(Le=0;Le<nn;++Le)xt[Le]=X.createCube(qt)}for(rt.color=Array(xt.length),Le=0;Le<xt.length;++Le){var Jt=xt[Le];T(typeof Jt=="function"&&Jt._reglType==="textureCube","invalid cube map"),Ye=Ye||Jt.width,T(Jt.width===Ye&&Jt.height===Ye,"invalid cube map shape"),rt.color[Le]={target:yi,data:xt[Le]}}for(Le=0;Le<6;++Le){for(var en=0;en<xt.length;++en)rt.color[en].target=yi+Le;Le>0&&(rt.depth=pe[0].depth,rt.stencil=pe[0].stencil,rt.depthStencil=pe[0].depthStencil),pe[Le]?pe[Le](rt):pe[Le]=be(rt)}return r(te,{width:Ye,height:Ye,color:xt})}function $e(qe){var Le,rt=qe|0;if(T(rt>0&&rt<=R.maxCubeMapSize,"invalid radius for cube fbo"),rt===te.width)return te;var Ye=te.color;for(Le=0;Le<Ye.length;++Le)Ye[Le].resize(rt);for(Le=0;Le<6;++Le)pe[Le].resize(rt);return te.width=te.height=rt,te}return te(ge),r(te,{faces:pe,resize:$e,_reglType:"framebufferCube",destroy:function(){pe.forEach(function(qe){qe.destroy()})}})}function We(){W.cur=null,W.next=null,W.dirty=!0,On(ne).forEach(function(ge){ge.framebuffer=p.createFramebuffer(),re(ge)})}return r(W,{getFramebuffer:function(ge){if(typeof ge=="function"&&ge._reglType==="framebuffer"){var pe=ge._framebuffer;if(pe instanceof xe)return pe}return null},create:be,createCube:Ve,clear:function(){On(ne).forEach(_e)},restore:We})}var pb=5126,dc=34962;function ol(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=pb,this.offset=0,this.stride=0,this.divisor=0}function hb(p,y,R,X,Z){for(var $=R.maxAttributes,W=new Array($),ie=0;ie<$;++ie)W[ie]=new ol;var le=0,fe={},ue={Record:ol,scope:{},state:W,currentVAO:null,targetVAO:null,restore:ye()?ne:function(){},createVAO:xe,getVAO:ve,destroyBuffer:me,setVAO:ye()?B:Y,clear:ye()?ce:function(){}};function me(oe){for(var _e=0;_e<W.length;++_e){var re=W[_e];re.buffer===oe&&(p.disableVertexAttribArray(_e),re.buffer=null)}}function ye(){return y.oes_vertex_array_object}function se(){return y.angle_instanced_arrays}function ve(oe){return typeof oe=="function"&&oe._vao?oe._vao:null}function B(oe){if(oe!==ue.currentVAO){var _e=ye();oe?_e.bindVertexArrayOES(oe.vao):_e.bindVertexArrayOES(null),ue.currentVAO=oe}}function Y(oe){if(oe!==ue.currentVAO){if(oe)oe.bindAttrs();else for(var _e=se(),re=0;re<W.length;++re){var be=W[re];be.buffer?(p.enableVertexAttribArray(re),p.vertexAttribPointer(re,be.size,be.type,be.normalized,be.stride,be.offfset),_e&&be.divisor&&_e.vertexAttribDivisorANGLE(re,be.divisor)):(p.disableVertexAttribArray(re),p.vertexAttrib4f(re,be.x,be.y,be.z,be.w))}ue.currentVAO=oe}}function ce(){On(fe).forEach(function(oe){oe.destroy()})}function Se(){this.id=++le,this.attributes=[];var oe=ye();oe?this.vao=oe.createVertexArrayOES():this.vao=null,fe[this.id]=this,this.buffers=[]}Se.prototype.bindAttrs=function(){for(var oe=se(),_e=this.attributes,re=0;re<_e.length;++re){var be=_e[re];be.buffer?(p.enableVertexAttribArray(re),p.bindBuffer(dc,be.buffer.buffer),p.vertexAttribPointer(re,be.size,be.type,be.normalized,be.stride,be.offset),oe&&be.divisor&&oe.vertexAttribDivisorANGLE(re,be.divisor)):(p.disableVertexAttribArray(re),p.vertexAttrib4f(re,be.x,be.y,be.z,be.w))}for(var Ve=_e.length;Ve<$;++Ve)p.disableVertexAttribArray(Ve)},Se.prototype.refresh=function(){var oe=ye();oe&&(oe.bindVertexArrayOES(this.vao),this.bindAttrs(),ue.currentVAO=this)},Se.prototype.destroy=function(){if(this.vao){var oe=ye();this===ue.currentVAO&&(ue.currentVAO=null,oe.bindVertexArrayOES(null)),oe.deleteVertexArrayOES(this.vao),this.vao=null}fe[this.id]&&(delete fe[this.id],X.vaoCount-=1)};function ne(){var oe=ye();oe&&On(fe).forEach(function(_e){_e.refresh()})}function xe(oe){var _e=new Se;X.vaoCount+=1;function re(be){T(Array.isArray(be),"arguments to vertex array constructor must be an array"),T(be.length<$,"too many attributes"),T(be.length>0,"must specify at least one attribute");var Ve={},We=_e.attributes;We.length=be.length;for(var ge=0;ge<be.length;++ge){var pe=be[ge],te=We[ge]=new ol,$e=pe.data||pe;if(Array.isArray($e)||n($e)||Gn($e)){var qe;_e.buffers[ge]&&(qe=_e.buffers[ge],n($e)&&qe._buffer.byteLength>=$e.byteLength?qe.subdata($e):(qe.destroy(),_e.buffers[ge]=null)),_e.buffers[ge]||(qe=_e.buffers[ge]=Z.create(pe,dc,!1,!0)),te.buffer=Z.getBuffer(qe),te.size=te.buffer.dimension|0,te.normalized=!1,te.type=te.buffer.dtype,te.offset=0,te.stride=0,te.divisor=0,te.state=1,Ve[ge]=1}else Z.getBuffer(pe)?(te.buffer=Z.getBuffer(pe),te.size=te.buffer.dimension|0,te.normalized=!1,te.type=te.buffer.dtype,te.offset=0,te.stride=0,te.divisor=0,te.state=1):Z.getBuffer(pe.buffer)?(te.buffer=Z.getBuffer(pe.buffer),te.size=(+pe.size||te.buffer.dimension)|0,te.normalized=!!pe.normalized||!1,"type"in pe?(T.parameter(pe.type,$r,"invalid buffer type"),te.type=$r[pe.type]):te.type=te.buffer.dtype,te.offset=(pe.offset||0)|0,te.stride=(pe.stride||0)|0,te.divisor=(pe.divisor||0)|0,te.state=1,T(te.size>=1&&te.size<=4,"size must be between 1 and 4"),T(te.offset>=0,"invalid offset"),T(te.stride>=0&&te.stride<=255,"stride must be between 0 and 255"),T(te.divisor>=0,"divisor must be positive"),T(!te.divisor||!!y.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in pe?(T(ge>0,"first attribute must not be a constant"),te.x=+pe.x||0,te.y=+pe.y||0,te.z=+pe.z||0,te.w=+pe.w||0,te.state=2):T(!1,"invalid attribute spec for location "+ge)}for(var Le=0;Le<_e.buffers.length;++Le)!Ve[Le]&&_e.buffers[Le]&&(_e.buffers[Le].destroy(),_e.buffers[Le]=null);return _e.refresh(),re}return re.destroy=function(){for(var be=0;be<_e.buffers.length;++be)_e.buffers[be]&&_e.buffers[be].destroy();_e.buffers.length=0,_e.destroy()},re._vao=_e,re._reglType="vao",re(oe)}return ue}var cc=35632,mb=35633,vb=35718,_b=35721;function bb(p,y,R,X){var Z={},$={};function W(B,Y,ce,Se){this.name=B,this.id=Y,this.location=ce,this.info=Se}function ie(B,Y){for(var ce=0;ce<B.length;++ce)if(B[ce].id===Y.id){B[ce].location=Y.location;return}B.push(Y)}function le(B,Y,ce){var Se=B===cc?Z:$,ne=Se[Y];if(!ne){var xe=y.str(Y);ne=p.createShader(B),p.shaderSource(ne,xe),p.compileShader(ne),T.shaderError(p,ne,xe,B,ce),Se[Y]=ne}return ne}var fe={},ue=[],me=0;function ye(B,Y){this.id=me++,this.fragId=B,this.vertId=Y,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,X.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function se(B,Y,ce){var Se,ne,xe=le(cc,B.fragId),oe=le(mb,B.vertId),_e=B.program=p.createProgram();if(p.attachShader(_e,xe),p.attachShader(_e,oe),ce)for(Se=0;Se<ce.length;++Se){var re=ce[Se];p.bindAttribLocation(_e,re[0],re[1])}p.linkProgram(_e),T.linkError(p,_e,y.str(B.fragId),y.str(B.vertId),Y);var be=p.getProgramParameter(_e,vb);X.profile&&(B.stats.uniformsCount=be);var Ve=B.uniforms;for(Se=0;Se<be;++Se)if(ne=p.getActiveUniform(_e,Se),ne)if(ne.size>1)for(var We=0;We<ne.size;++We){var ge=ne.name.replace("[0]","["+We+"]");ie(Ve,new W(ge,y.id(ge),p.getUniformLocation(_e,ge),ne))}else ie(Ve,new W(ne.name,y.id(ne.name),p.getUniformLocation(_e,ne.name),ne));var pe=p.getProgramParameter(_e,_b);X.profile&&(B.stats.attributesCount=pe);var te=B.attributes;for(Se=0;Se<pe;++Se)ne=p.getActiveAttrib(_e,Se),ne&&ie(te,new W(ne.name,y.id(ne.name),p.getAttribLocation(_e,ne.name),ne))}X.profile&&(R.getMaxUniformsCount=function(){var B=0;return ue.forEach(function(Y){Y.stats.uniformsCount>B&&(B=Y.stats.uniformsCount)}),B},R.getMaxAttributesCount=function(){var B=0;return ue.forEach(function(Y){Y.stats.attributesCount>B&&(B=Y.stats.attributesCount)}),B});function ve(){Z={},$={};for(var B=0;B<ue.length;++B)se(ue[B],null,ue[B].attributes.map(function(Y){return[Y.location,Y.name]}))}return{clear:function(){var B=p.deleteShader.bind(p);On(Z).forEach(B),Z={},On($).forEach(B),$={},ue.forEach(function(Y){p.deleteProgram(Y.program)}),ue.length=0,fe={},R.shaderCount=0},program:function(B,Y,ce,Se){T.command(B>=0,"missing vertex shader",ce),T.command(Y>=0,"missing fragment shader",ce);var ne=fe[Y];ne||(ne=fe[Y]={});var xe=ne[B];if(xe&&(xe.refCount++,!Se))return xe;var oe=new ye(Y,B);return R.shaderCount++,se(oe,ce,Se),xe||(ne[B]=oe),ue.push(oe),r(oe,{destroy:function(){if(oe.refCount--,oe.refCount<=0){p.deleteProgram(oe.program);var _e=ue.indexOf(oe);ue.splice(_e,1),R.shaderCount--}ne[oe.vertId].refCount<=0&&(p.deleteShader($[oe.vertId]),delete $[oe.vertId],delete fe[oe.fragId][oe.vertId]),Object.keys(fe[oe.fragId]).length||(p.deleteShader(Z[oe.fragId]),delete Z[oe.fragId],delete fe[oe.fragId])}})},restore:ve,shader:le,frag:-1,vert:-1}}var yb=6408,ba=5121,gb=3333,Ei=5126;function Eb(p,y,R,X,Z,$,W){function ie(ue){var me;y.next===null?(T(Z.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),me=ba):(T(y.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),me=y.next.colorAttachments[0].texture._texture.type,$.oes_texture_float?(T(me===ba||me===Ei,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),me===Ei&&T(W.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):T(me===ba,"Reading from a framebuffer is only allowed for the type 'uint8'"));var ye=0,se=0,ve=X.framebufferWidth,B=X.framebufferHeight,Y=null;n(ue)?Y=ue:ue&&(T.type(ue,"object","invalid arguments to regl.read()"),ye=ue.x|0,se=ue.y|0,T(ye>=0&&ye<X.framebufferWidth,"invalid x offset for regl.read"),T(se>=0&&se<X.framebufferHeight,"invalid y offset for regl.read"),ve=(ue.width||X.framebufferWidth-ye)|0,B=(ue.height||X.framebufferHeight-se)|0,Y=ue.data||null),Y&&(me===ba?T(Y instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):me===Ei&&T(Y instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),T(ve>0&&ve+ye<=X.framebufferWidth,"invalid width for read pixels"),T(B>0&&B+se<=X.framebufferHeight,"invalid height for read pixels"),R();var ce=ve*B*4;return Y||(me===ba?Y=new Uint8Array(ce):me===Ei&&(Y=Y||new Float32Array(ce))),T.isTypedArray(Y,"data buffer for regl.read() must be a typedarray"),T(Y.byteLength>=ce,"data buffer for regl.read() too small"),p.pixelStorei(gb,4),p.readPixels(ye,se,ve,B,yb,me,Y),Y}function le(ue){var me;return y.setFBO({framebuffer:ue.framebuffer},function(){me=ie(ue)}),me}function fe(ue){return!ue||!("framebuffer"in ue)?ie(ue):le(ue)}return fe}function Ao(p){return Array.prototype.slice.call(p)}function xo(p){return Ao(p).join("")}function Tb(){var p=0,y=[],R=[];function X(me){for(var ye=0;ye<R.length;++ye)if(R[ye]===me)return y[ye];var se="g"+p++;return y.push(se),R.push(me),se}function Z(){var me=[];function ye(){me.push.apply(me,Ao(arguments))}var se=[];function ve(){var B="v"+p++;return se.push(B),arguments.length>0&&(me.push(B,"="),me.push.apply(me,Ao(arguments)),me.push(";")),B}return r(ye,{def:ve,toString:function(){return xo([se.length>0?"var "+se.join(",")+";":"",xo(me)])}})}function $(){var me=Z(),ye=Z(),se=me.toString,ve=ye.toString;function B(Y,ce){ye(Y,ce,"=",me.def(Y,ce),";")}return r(function(){me.apply(me,Ao(arguments))},{def:me.def,entry:me,exit:ye,save:B,set:function(Y,ce,Se){B(Y,ce),me(Y,ce,"=",Se,";")},toString:function(){return se()+ve()}})}function W(){var me=xo(arguments),ye=$(),se=$(),ve=ye.toString,B=se.toString;return r(ye,{then:function(){return ye.apply(ye,Ao(arguments)),this},else:function(){return se.apply(se,Ao(arguments)),this},toString:function(){var Y=B();return Y&&(Y="else{"+Y+"}"),xo(["if(",me,"){",ve(),"}",Y])}})}var ie=Z(),le={};function fe(me,ye){var se=[];function ve(){var ne="a"+se.length;return se.push(ne),ne}ye=ye||0;for(var B=0;B<ye;++B)ve();var Y=$(),ce=Y.toString,Se=le[me]=r(Y,{arg:ve,toString:function(){return xo(["function(",se.join(),"){",ce(),"}"])}});return Se}function ue(){var me=['"use strict";',ie,"return {"];Object.keys(le).forEach(function(ve){me.push('"',ve,'":',le[ve].toString(),",")}),me.push("}");var ye=xo(me).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),se=Function.apply(null,y.concat(ye));return se.apply(null,R)}return{global:ie,link:X,block:Z,proc:fe,scope:$,cond:W,compile:ue}}var Ro="xyzw".split(""),fc=5121,Co=1,al=2,il=0,sl=1,ll=2,ul=3,Ti=4,pc=5,hc=6,mc="dither",vc="blend.enable",_c="blend.color",dl="blend.equation",cl="blend.func",bc="depth.enable",yc="depth.func",gc="depth.range",Ec="depth.mask",fl="colorMask",Tc="cull.enable",Ic="cull.face",pl="frontFace",hl="lineWidth",Sc="polygonOffset.enable",ml="polygonOffset.offset",wc="sample.alpha",Ac="sample.enable",vl="sample.coverage",xc="stencil.enable",Rc="stencil.mask",_l="stencil.func",bl="stencil.opFront",ya="stencil.opBack",Cc="scissor.enable",Ii="scissor.box",or="viewport",ga="profile",Kr="framebuffer",Ea="vert",Ta="frag",qr="elements",Qr="primitive",Zr="count",Si="offset",wi="instances",Ia="vao",yl="Width",gl="Height",No=Kr+yl,Oo=Kr+gl,Ib=or+yl,Sb=or+gl,Nc="drawingBuffer",Oc=Nc+yl,Fc=Nc+gl,wb=[cl,dl,_l,bl,ya,vl,or,Ii,ml],Fo=34962,Ab=34963,xb=35632,Rb=35633,Lc=3553,Cb=34067,Nb=2884,Ob=3042,Fb=3024,Lb=2960,Mb=2929,Db=3089,Pb=32823,kb=32926,Vb=32928,El=5126,Ai=35664,xi=35665,Ri=35666,Tl=5124,Ci=35667,Ni=35668,Oi=35669,Il=35670,Fi=35671,Li=35672,Mi=35673,Sa=35674,wa=35675,Aa=35676,xa=35678,Ra=35680,Mc=4,Ca=1028,Jr=1029,Dc=2304,Sl=2305,Bb=32775,Ub=32776,Gb=519,Tr=7680,Pc=0,kc=1,Vc=32774,jb=513,Bc=36160,zb=36064,qn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Uc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Lo={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ir={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Gc={frag:xb,vert:Rb},wl={cw:Dc,ccw:Sl};function Di(p){return Array.isArray(p)||n(p)||Gn(p)}function jc(p){return p.sort(function(y,R){return y===or?-1:R===or?1:y<R?-1:1})}function En(p,y,R,X){this.thisDep=p,this.contextDep=y,this.propDep=R,this.append=X}function Sr(p){return p&&!(p.thisDep||p.contextDep||p.propDep)}function Yt(p){return new En(!1,!1,!1,p)}function An(p,y){var R=p.type;if(R===il){var X=p.data.length;return new En(!0,X>=1,X>=2,y)}else if(R===Ti){var Z=p.data;return new En(Z.thisDep,Z.contextDep,Z.propDep,y)}else{if(R===pc)return new En(!1,!1,!1,y);if(R===hc){for(var $=!1,W=!1,ie=!1,le=0;le<p.data.length;++le){var fe=p.data[le];if(fe.type===sl)ie=!0;else if(fe.type===ll)W=!0;else if(fe.type===ul)$=!0;else if(fe.type===il){$=!0;var ue=fe.data;ue>=1&&(W=!0),ue>=2&&(ie=!0)}else fe.type===Ti&&($=$||fe.data.thisDep,W=W||fe.data.contextDep,ie=ie||fe.data.propDep)}return new En($,W,ie,y)}else return new En(R===ul,R===ll,R===sl,y)}}var zc=new En(!1,!1,!1,function(){});function $b(p,y,R,X,Z,$,W,ie,le,fe,ue,me,ye,se,ve){var B=fe.Record,Y={add:32774,subtract:32778,"reverse subtract":32779};R.ext_blend_minmax&&(Y.min=Bb,Y.max=Ub);var ce=R.angle_instanced_arrays,Se=R.webgl_draw_buffers,ne={dirty:!0,profile:ve.profile},xe={},oe=[],_e={},re={};function be(I){return I.replace(".","_")}function Ve(I,_,N){var V=be(I);oe.push(I),xe[V]=ne[V]=!!N,_e[V]=_}function We(I,_,N){var V=be(I);oe.push(I),Array.isArray(N)?(ne[V]=N.slice(),xe[V]=N.slice()):ne[V]=xe[V]=N,re[V]=_}Ve(mc,Fb),Ve(vc,Ob),We(_c,"blendColor",[0,0,0,0]),We(dl,"blendEquationSeparate",[Vc,Vc]),We(cl,"blendFuncSeparate",[kc,Pc,kc,Pc]),Ve(bc,Mb,!0),We(yc,"depthFunc",jb),We(gc,"depthRange",[0,1]),We(Ec,"depthMask",!0),We(fl,fl,[!0,!0,!0,!0]),Ve(Tc,Nb),We(Ic,"cullFace",Jr),We(pl,pl,Sl),We(hl,hl,1),Ve(Sc,Pb),We(ml,"polygonOffset",[0,0]),Ve(wc,kb),Ve(Ac,Vb),We(vl,"sampleCoverage",[1,!1]),Ve(xc,Lb),We(Rc,"stencilMask",-1),We(_l,"stencilFunc",[Gb,0,-1]),We(bl,"stencilOpSeparate",[Ca,Tr,Tr,Tr]),We(ya,"stencilOpSeparate",[Jr,Tr,Tr,Tr]),Ve(Cc,Db),We(Ii,"scissor",[0,0,p.drawingBufferWidth,p.drawingBufferHeight]),We(or,or,[0,0,p.drawingBufferWidth,p.drawingBufferHeight]);var ge={gl:p,context:ye,strings:y,next:xe,current:ne,draw:me,elements:$,buffer:Z,shader:ue,attributes:fe.state,vao:fe,uniforms:le,framebuffer:ie,extensions:R,timer:se,isBufferArgs:Di},pe={primTypes:bo,compareFuncs:Lo,blendFuncs:qn,blendEquations:Y,stencilOps:Ir,glTypes:$r,orientationType:wl};T.optional(function(){ge.isArrayLike=Bt}),Se&&(pe.backBuffer=[Jr],pe.drawBuffer=wn(X.maxDrawbuffers,function(I){return I===0?[0]:wn(I,function(_){return zb+_})}));var te=0;function $e(){var I=Tb(),_=I.link,N=I.global;I.id=te++,I.batchId="0";var V=_(ge),U=I.shared={props:"a0"};Object.keys(ge).forEach(function(C){U[C]=N.def(V,".",C)}),T.optional(function(){I.CHECK=_(T),I.commandStr=T.guessCommand(),I.command=_(I.commandStr),I.assert=function(C,g,k){C("if(!(",g,"))",this.CHECK,".commandRaise(",_(k),",",this.command,");")},pe.invalidBlendCombinations=Uc});var M=I.next={},O=I.current={};Object.keys(re).forEach(function(C){Array.isArray(ne[C])&&(M[C]=N.def(U.next,".",C),O[C]=N.def(U.current,".",C))});var P=I.constants={};Object.keys(pe).forEach(function(C){P[C]=N.def(JSON.stringify(pe[C]))}),I.invoke=function(C,g){switch(g.type){case il:var k=["this",U.context,U.props,I.batchId];return C.def(_(g.data),".call(",k.slice(0,Math.max(g.data.length+1,4)),")");case sl:return C.def(U.props,g.data);case ll:return C.def(U.context,g.data);case ul:return C.def("this",g.data);case Ti:return g.data.append(I,C),g.data.ref;case pc:return g.data.toString();case hc:return g.data.map(function(G){return I.invoke(C,G)})}},I.attribCache={};var S={};return I.scopeAttrib=function(C){var g=y.id(C);if(g in S)return S[g];var k=fe.scope[g];k||(k=fe.scope[g]=new B);var G=S[g]=_(k);return G},I}function qe(I){var _=I.static,N=I.dynamic,V;if(ga in _){var U=!!_[ga];V=Yt(function(O,P){return U}),V.enable=U}else if(ga in N){var M=N[ga];V=An(M,function(O,P){return O.invoke(P,M)})}return V}function Le(I,_){var N=I.static,V=I.dynamic;if(Kr in N){var U=N[Kr];return U?(U=ie.getFramebuffer(U),T.command(U,"invalid framebuffer object"),Yt(function(O,P){var S=O.link(U),C=O.shared;P.set(C.framebuffer,".next",S);var g=C.context;return P.set(g,"."+No,S+".width"),P.set(g,"."+Oo,S+".height"),S})):Yt(function(O,P){var S=O.shared;P.set(S.framebuffer,".next","null");var C=S.context;return P.set(C,"."+No,C+"."+Oc),P.set(C,"."+Oo,C+"."+Fc),"null"})}else if(Kr in V){var M=V[Kr];return An(M,function(O,P){var S=O.invoke(P,M),C=O.shared,g=C.framebuffer,k=P.def(g,".getFramebuffer(",S,")");T.optional(function(){O.assert(P,"!"+S+"||"+k,"invalid framebuffer object")}),P.set(g,".next",k);var G=C.context;return P.set(G,"."+No,k+"?"+k+".width:"+G+"."+Oc),P.set(G,"."+Oo,k+"?"+k+".height:"+G+"."+Fc),k})}else return null}function rt(I,_,N){var V=I.static,U=I.dynamic;function M(S){if(S in V){var C=V[S];T.commandType(C,"object","invalid "+S,N.commandStr);var g=!0,k=C.x|0,G=C.y|0,Q,J;return"width"in C?(Q=C.width|0,T.command(Q>=0,"invalid "+S,N.commandStr)):g=!1,"height"in C?(J=C.height|0,T.command(J>=0,"invalid "+S,N.commandStr)):g=!1,new En(!g&&_&&_.thisDep,!g&&_&&_.contextDep,!g&&_&&_.propDep,function(Pe,Ze){var Me=Pe.shared.context,je=Q;"width"in C||(je=Ze.def(Me,".",No,"-",k));var Ke=J;return"height"in C||(Ke=Ze.def(Me,".",Oo,"-",G)),[k,G,je,Ke]})}else if(S in U){var q=U[S],de=An(q,function(Pe,Ze){var Me=Pe.invoke(Ze,q);T.optional(function(){Pe.assert(Ze,Me+"&&typeof "+Me+'==="object"',"invalid "+S)});var je=Pe.shared.context,Ke=Ze.def(Me,".x|0"),vt=Ze.def(Me,".y|0"),Dt=Ze.def('"width" in ',Me,"?",Me,".width|0:","(",je,".",No,"-",Ke,")"),Tn=Ze.def('"height" in ',Me,"?",Me,".height|0:","(",je,".",Oo,"-",vt,")");return T.optional(function(){Pe.assert(Ze,Dt+">=0&&"+Tn+">=0","invalid "+S)}),[Ke,vt,Dt,Tn]});return _&&(de.thisDep=de.thisDep||_.thisDep,de.contextDep=de.contextDep||_.contextDep,de.propDep=de.propDep||_.propDep),de}else return _?new En(_.thisDep,_.contextDep,_.propDep,function(Pe,Ze){var Me=Pe.shared.context;return[0,0,Ze.def(Me,".",No),Ze.def(Me,".",Oo)]}):null}var O=M(or);if(O){var P=O;O=new En(O.thisDep,O.contextDep,O.propDep,function(S,C){var g=P.append(S,C),k=S.shared.context;return C.set(k,"."+Ib,g[2]),C.set(k,"."+Sb,g[3]),g})}return{viewport:O,scissor_box:M(Ii)}}function Ye(I,_){var N=I.static,V=typeof N[Ta]=="string"&&typeof N[Ea]=="string";if(V){if(Object.keys(_.dynamic).length>0)return null;var U=_.static,M=Object.keys(U);if(M.length>0&&typeof U[M[0]]=="number"){for(var O=[],P=0;P<M.length;++P)T(typeof U[M[P]]=="number","must specify all vertex attribute locations when using vaos"),O.push([U[M[P]]|0,M[P]]);return O}}return null}function nt(I,_,N){var V=I.static,U=I.dynamic;function M(g){if(g in V){var k=y.id(V[g]);T.optional(function(){ue.shader(Gc[g],k,T.guessCommand())});var G=Yt(function(){return k});return G.id=k,G}else if(g in U){var Q=U[g];return An(Q,function(J,q){var de=J.invoke(q,Q),Pe=q.def(J.shared.strings,".id(",de,")");return T.optional(function(){q(J.shared.shader,".shader(",Gc[g],",",Pe,",",J.command,");")}),Pe})}return null}var O=M(Ta),P=M(Ea),S=null,C;return Sr(O)&&Sr(P)?(S=ue.program(P.id,O.id,null,N),C=Yt(function(g,k){return g.link(S)})):C=new En(O&&O.thisDep||P&&P.thisDep,O&&O.contextDep||P&&P.contextDep,O&&O.propDep||P&&P.propDep,function(g,k){var G=g.shared.shader,Q;O?Q=O.append(g,k):Q=k.def(G,".",Ta);var J;P?J=P.append(g,k):J=k.def(G,".",Ea);var q=G+".program("+J+","+Q;return T.optional(function(){q+=","+g.command}),k.def(q+")")}),{frag:O,vert:P,progVar:C,program:S}}function mt(I,_){var N=I.static,V=I.dynamic;function U(){if(qr in N){var g=N[qr];Di(g)?g=$.getElements($.create(g,!0)):g&&(g=$.getElements(g),T.command(g,"invalid elements",_.commandStr));var k=Yt(function(Q,J){if(g){var q=Q.link(g);return Q.ELEMENTS=q,q}return Q.ELEMENTS=null,null});return k.value=g,k}else if(qr in V){var G=V[qr];return An(G,function(Q,J){var q=Q.shared,de=q.isBufferArgs,Pe=q.elements,Ze=Q.invoke(J,G),Me=J.def("null"),je=J.def(de,"(",Ze,")"),Ke=Q.cond(je).then(Me,"=",Pe,".createStream(",Ze,");").else(Me,"=",Pe,".getElements(",Ze,");");return T.optional(function(){Q.assert(Ke.else,"!"+Ze+"||"+Me,"invalid elements")}),J.entry(Ke),J.exit(Q.cond(je).then(Pe,".destroyStream(",Me,");")),Q.ELEMENTS=Me,Me})}return null}var M=U();function O(){if(Qr in N){var g=N[Qr];return T.commandParameter(g,bo,"invalid primitve",_.commandStr),Yt(function(G,Q){return bo[g]})}else if(Qr in V){var k=V[Qr];return An(k,function(G,Q){var J=G.constants.primTypes,q=G.invoke(Q,k);return T.optional(function(){G.assert(Q,q+" in "+J,"invalid primitive, must be one of "+Object.keys(bo))}),Q.def(J,"[",q,"]")})}else if(M)return Sr(M)?M.value?Yt(function(G,Q){return Q.def(G.ELEMENTS,".primType")}):Yt(function(){return Mc}):new En(M.thisDep,M.contextDep,M.propDep,function(G,Q){var J=G.ELEMENTS;return Q.def(J,"?",J,".primType:",Mc)});return null}function P(g,k){if(g in N){var G=N[g]|0;return T.command(!k||G>=0,"invalid "+g,_.commandStr),Yt(function(J,q){return k&&(J.OFFSET=G),G})}else if(g in V){var Q=V[g];return An(Q,function(J,q){var de=J.invoke(q,Q);return k&&(J.OFFSET=de,T.optional(function(){J.assert(q,de+">=0","invalid "+g)})),de})}else if(k&&M)return Yt(function(J,q){return J.OFFSET="0",0});return null}var S=P(Si,!0);function C(){if(Zr in N){var g=N[Zr]|0;return T.command(typeof g=="number"&&g>=0,"invalid vertex count",_.commandStr),Yt(function(){return g})}else if(Zr in V){var k=V[Zr];return An(k,function(J,q){var de=J.invoke(q,k);return T.optional(function(){J.assert(q,"typeof "+de+'==="number"&&'+de+">=0&&"+de+"===("+de+"|0)","invalid vertex count")}),de})}else if(M)if(Sr(M)){if(M)return S?new En(S.thisDep,S.contextDep,S.propDep,function(J,q){var de=q.def(J.ELEMENTS,".vertCount-",J.OFFSET);return T.optional(function(){J.assert(q,de+">=0","invalid vertex offset/element buffer too small")}),de}):Yt(function(J,q){return q.def(J.ELEMENTS,".vertCount")});var G=Yt(function(){return-1});return T.optional(function(){G.MISSING=!0}),G}else{var Q=new En(M.thisDep||S.thisDep,M.contextDep||S.contextDep,M.propDep||S.propDep,function(J,q){var de=J.ELEMENTS;return J.OFFSET?q.def(de,"?",de,".vertCount-",J.OFFSET,":-1"):q.def(de,"?",de,".vertCount:-1")});return T.optional(function(){Q.DYNAMIC=!0}),Q}return null}return{elements:M,primitive:O(),count:C(),instances:P(wi,!1),offset:S}}function Kt(I,_){var N=I.static,V=I.dynamic,U={};return oe.forEach(function(M){var O=be(M);function P(S,C){if(M in N){var g=S(N[M]);U[O]=Yt(function(){return g})}else if(M in V){var k=V[M];U[O]=An(k,function(G,Q){return C(G,Q,G.invoke(Q,k))})}}switch(M){case Tc:case vc:case mc:case xc:case bc:case Cc:case Sc:case wc:case Ac:case Ec:return P(function(S){return T.commandType(S,"boolean",M,_.commandStr),S},function(S,C,g){return T.optional(function(){S.assert(C,"typeof "+g+'==="boolean"',"invalid flag "+M,S.commandStr)}),g});case yc:return P(function(S){return T.commandParameter(S,Lo,"invalid "+M,_.commandStr),Lo[S]},function(S,C,g){var k=S.constants.compareFuncs;return T.optional(function(){S.assert(C,g+" in "+k,"invalid "+M+", must be one of "+Object.keys(Lo))}),C.def(k,"[",g,"]")});case gc:return P(function(S){return T.command(Bt(S)&&S.length===2&&typeof S[0]=="number"&&typeof S[1]=="number"&&S[0]<=S[1],"depth range is 2d array",_.commandStr),S},function(S,C,g){T.optional(function(){S.assert(C,S.shared.isArrayLike+"("+g+")&&"+g+".length===2&&typeof "+g+'[0]==="number"&&typeof '+g+'[1]==="number"&&'+g+"[0]<="+g+"[1]","depth range must be a 2d array")});var k=C.def("+",g,"[0]"),G=C.def("+",g,"[1]");return[k,G]});case cl:return P(function(S){T.commandType(S,"object","blend.func",_.commandStr);var C="srcRGB"in S?S.srcRGB:S.src,g="srcAlpha"in S?S.srcAlpha:S.src,k="dstRGB"in S?S.dstRGB:S.dst,G="dstAlpha"in S?S.dstAlpha:S.dst;return T.commandParameter(C,qn,O+".srcRGB",_.commandStr),T.commandParameter(g,qn,O+".srcAlpha",_.commandStr),T.commandParameter(k,qn,O+".dstRGB",_.commandStr),T.commandParameter(G,qn,O+".dstAlpha",_.commandStr),T.command(Uc.indexOf(C+", "+k)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+C+", "+k+")",_.commandStr),[qn[C],qn[k],qn[g],qn[G]]},function(S,C,g){var k=S.constants.blendFuncs;T.optional(function(){S.assert(C,g+"&&typeof "+g+'==="object"',"invalid blend func, must be an object")});function G(Me,je){var Ke=C.def('"',Me,je,'" in ',g,"?",g,".",Me,je,":",g,".",Me);return T.optional(function(){S.assert(C,Ke+" in "+k,"invalid "+M+"."+Me+je+", must be one of "+Object.keys(qn))}),Ke}var Q=G("src","RGB"),J=G("dst","RGB");T.optional(function(){var Me=S.constants.invalidBlendCombinations;S.assert(C,Me+".indexOf("+Q+'+", "+'+J+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var q=C.def(k,"[",Q,"]"),de=C.def(k,"[",G("src","Alpha"),"]"),Pe=C.def(k,"[",J,"]"),Ze=C.def(k,"[",G("dst","Alpha"),"]");return[q,Pe,de,Ze]});case dl:return P(function(S){if(typeof S=="string")return T.commandParameter(S,Y,"invalid "+M,_.commandStr),[Y[S],Y[S]];if(typeof S=="object")return T.commandParameter(S.rgb,Y,M+".rgb",_.commandStr),T.commandParameter(S.alpha,Y,M+".alpha",_.commandStr),[Y[S.rgb],Y[S.alpha]];T.commandRaise("invalid blend.equation",_.commandStr)},function(S,C,g){var k=S.constants.blendEquations,G=C.def(),Q=C.def(),J=S.cond("typeof ",g,'==="string"');return T.optional(function(){function q(de,Pe,Ze){S.assert(de,Ze+" in "+k,"invalid "+Pe+", must be one of "+Object.keys(Y))}q(J.then,M,g),S.assert(J.else,g+"&&typeof "+g+'==="object"',"invalid "+M),q(J.else,M+".rgb",g+".rgb"),q(J.else,M+".alpha",g+".alpha")}),J.then(G,"=",Q,"=",k,"[",g,"];"),J.else(G,"=",k,"[",g,".rgb];",Q,"=",k,"[",g,".alpha];"),C(J),[G,Q]});case _c:return P(function(S){return T.command(Bt(S)&&S.length===4,"blend.color must be a 4d array",_.commandStr),wn(4,function(C){return+S[C]})},function(S,C,g){return T.optional(function(){S.assert(C,S.shared.isArrayLike+"("+g+")&&"+g+".length===4","blend.color must be a 4d array")}),wn(4,function(k){return C.def("+",g,"[",k,"]")})});case Rc:return P(function(S){return T.commandType(S,"number",O,_.commandStr),S|0},function(S,C,g){return T.optional(function(){S.assert(C,"typeof "+g+'==="number"',"invalid stencil.mask")}),C.def(g,"|0")});case _l:return P(function(S){T.commandType(S,"object",O,_.commandStr);var C=S.cmp||"keep",g=S.ref||0,k="mask"in S?S.mask:-1;return T.commandParameter(C,Lo,M+".cmp",_.commandStr),T.commandType(g,"number",M+".ref",_.commandStr),T.commandType(k,"number",M+".mask",_.commandStr),[Lo[C],g,k]},function(S,C,g){var k=S.constants.compareFuncs;T.optional(function(){function q(){S.assert(C,Array.prototype.join.call(arguments,""),"invalid stencil.func")}q(g+"&&typeof ",g,'==="object"'),q('!("cmp" in ',g,")||(",g,".cmp in ",k,")")});var G=C.def('"cmp" in ',g,"?",k,"[",g,".cmp]",":",Tr),Q=C.def(g,".ref|0"),J=C.def('"mask" in ',g,"?",g,".mask|0:-1");return[G,Q,J]});case bl:case ya:return P(function(S){T.commandType(S,"object",O,_.commandStr);var C=S.fail||"keep",g=S.zfail||"keep",k=S.zpass||"keep";return T.commandParameter(C,Ir,M+".fail",_.commandStr),T.commandParameter(g,Ir,M+".zfail",_.commandStr),T.commandParameter(k,Ir,M+".zpass",_.commandStr),[M===ya?Jr:Ca,Ir[C],Ir[g],Ir[k]]},function(S,C,g){var k=S.constants.stencilOps;T.optional(function(){S.assert(C,g+"&&typeof "+g+'==="object"',"invalid "+M)});function G(Q){return T.optional(function(){S.assert(C,'!("'+Q+'" in '+g+")||("+g+"."+Q+" in "+k+")","invalid "+M+"."+Q+", must be one of "+Object.keys(Ir))}),C.def('"',Q,'" in ',g,"?",k,"[",g,".",Q,"]:",Tr)}return[M===ya?Jr:Ca,G("fail"),G("zfail"),G("zpass")]});case ml:return P(function(S){T.commandType(S,"object",O,_.commandStr);var C=S.factor|0,g=S.units|0;return T.commandType(C,"number",O+".factor",_.commandStr),T.commandType(g,"number",O+".units",_.commandStr),[C,g]},function(S,C,g){T.optional(function(){S.assert(C,g+"&&typeof "+g+'==="object"',"invalid "+M)});var k=C.def(g,".factor|0"),G=C.def(g,".units|0");return[k,G]});case Ic:return P(function(S){var C=0;return S==="front"?C=Ca:S==="back"&&(C=Jr),T.command(!!C,O,_.commandStr),C},function(S,C,g){return T.optional(function(){S.assert(C,g+'==="front"||'+g+'==="back"',"invalid cull.face")}),C.def(g,'==="front"?',Ca,":",Jr)});case hl:return P(function(S){return T.command(typeof S=="number"&&S>=X.lineWidthDims[0]&&S<=X.lineWidthDims[1],"invalid line width, must be a positive number between "+X.lineWidthDims[0]+" and "+X.lineWidthDims[1],_.commandStr),S},function(S,C,g){return T.optional(function(){S.assert(C,"typeof "+g+'==="number"&&'+g+">="+X.lineWidthDims[0]+"&&"+g+"<="+X.lineWidthDims[1],"invalid line width")}),g});case pl:return P(function(S){return T.commandParameter(S,wl,O,_.commandStr),wl[S]},function(S,C,g){return T.optional(function(){S.assert(C,g+'==="cw"||'+g+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),C.def(g+'==="cw"?'+Dc+":"+Sl)});case fl:return P(function(S){return T.command(Bt(S)&&S.length===4,"color.mask must be length 4 array",_.commandStr),S.map(function(C){return!!C})},function(S,C,g){return T.optional(function(){S.assert(C,S.shared.isArrayLike+"("+g+")&&"+g+".length===4","invalid color.mask")}),wn(4,function(k){return"!!"+g+"["+k+"]"})});case vl:return P(function(S){T.command(typeof S=="object"&&S,O,_.commandStr);var C="value"in S?S.value:1,g=!!S.invert;return T.command(typeof C=="number"&&C>=0&&C<=1,"sample.coverage.value must be a number between 0 and 1",_.commandStr),[C,g]},function(S,C,g){T.optional(function(){S.assert(C,g+"&&typeof "+g+'==="object"',"invalid sample.coverage")});var k=C.def('"value" in ',g,"?+",g,".value:1"),G=C.def("!!",g,".invert");return[k,G]})}}),U}function nn(I,_){var N=I.static,V=I.dynamic,U={};return Object.keys(N).forEach(function(M){var O=N[M],P;if(typeof O=="number"||typeof O=="boolean")P=Yt(function(){return O});else if(typeof O=="function"){var S=O._reglType;S==="texture2d"||S==="textureCube"?P=Yt(function(C){return C.link(O)}):S==="framebuffer"||S==="framebufferCube"?(T.command(O.color.length>0,'missing color attachment for framebuffer sent to uniform "'+M+'"',_.commandStr),P=Yt(function(C){return C.link(O.color[0])})):T.commandRaise('invalid data for uniform "'+M+'"',_.commandStr)}else Bt(O)?P=Yt(function(C){var g=C.global.def("[",wn(O.length,function(k){return T.command(typeof O[k]=="number"||typeof O[k]=="boolean","invalid uniform "+M,C.commandStr),O[k]}),"]");return g}):T.commandRaise('invalid or missing data for uniform "'+M+'"',_.commandStr);P.value=O,U[M]=P}),Object.keys(V).forEach(function(M){var O=V[M];U[M]=An(O,function(P,S){return P.invoke(S,O)})}),U}function lt(I,_){var N=I.static,V=I.dynamic,U={};return Object.keys(N).forEach(function(M){var O=N[M],P=y.id(M),S=new B;if(Di(O))S.state=Co,S.buffer=Z.getBuffer(Z.create(O,Fo,!1,!0)),S.type=0;else{var C=Z.getBuffer(O);if(C)S.state=Co,S.buffer=C,S.type=0;else if(T.command(typeof O=="object"&&O,"invalid data for attribute "+M,_.commandStr),"constant"in O){var g=O.constant;S.buffer="null",S.state=al,typeof g=="number"?S.x=g:(T.command(Bt(g)&&g.length>0&&g.length<=4,"invalid constant for attribute "+M,_.commandStr),Ro.forEach(function(Pe,Ze){Ze<g.length&&(S[Pe]=g[Ze])}))}else{Di(O.buffer)?C=Z.getBuffer(Z.create(O.buffer,Fo,!1,!0)):C=Z.getBuffer(O.buffer),T.command(!!C,'missing buffer for attribute "'+M+'"',_.commandStr);var k=O.offset|0;T.command(k>=0,'invalid offset for attribute "'+M+'"',_.commandStr);var G=O.stride|0;T.command(G>=0&&G<256,'invalid stride for attribute "'+M+'", must be integer betweeen [0, 255]',_.commandStr);var Q=O.size|0;T.command(!("size"in O)||Q>0&&Q<=4,'invalid size for attribute "'+M+'", must be 1,2,3,4',_.commandStr);var J=!!O.normalized,q=0;"type"in O&&(T.commandParameter(O.type,$r,"invalid type for attribute "+M,_.commandStr),q=$r[O.type]);var de=O.divisor|0;"divisor"in O&&(T.command(de===0||ce,'cannot specify divisor for attribute "'+M+'", instancing not supported',_.commandStr),T.command(de>=0,'invalid divisor for attribute "'+M+'"',_.commandStr)),T.optional(function(){var Pe=_.commandStr,Ze=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(O).forEach(function(Me){T.command(Ze.indexOf(Me)>=0,'unknown parameter "'+Me+'" for attribute pointer "'+M+'" (valid parameters are '+Ze+")",Pe)})}),S.buffer=C,S.state=Co,S.size=Q,S.normalized=J,S.type=q||C.dtype,S.offset=k,S.stride=G,S.divisor=de}}U[M]=Yt(function(Pe,Ze){var Me=Pe.attribCache;if(P in Me)return Me[P];var je={isStream:!1};return Object.keys(S).forEach(function(Ke){je[Ke]=S[Ke]}),S.buffer&&(je.buffer=Pe.link(S.buffer),je.type=je.type||je.buffer+".dtype"),Me[P]=je,je})}),Object.keys(V).forEach(function(M){var O=V[M];function P(S,C){var g=S.invoke(C,O),k=S.shared,G=S.constants,Q=k.isBufferArgs,J=k.buffer;T.optional(function(){S.assert(C,g+"&&(typeof "+g+'==="object"||typeof '+g+'==="function")&&('+Q+"("+g+")||"+J+".getBuffer("+g+")||"+J+".getBuffer("+g+".buffer)||"+Q+"("+g+'.buffer)||("constant" in '+g+"&&(typeof "+g+'.constant==="number"||'+k.isArrayLike+"("+g+".constant))))",'invalid dynamic attribute "'+M+'"')});var q={isStream:C.def(!1)},de=new B;de.state=Co,Object.keys(de).forEach(function(je){q[je]=C.def(""+de[je])});var Pe=q.buffer,Ze=q.type;C("if(",Q,"(",g,")){",q.isStream,"=true;",Pe,"=",J,".createStream(",Fo,",",g,");",Ze,"=",Pe,".dtype;","}else{",Pe,"=",J,".getBuffer(",g,");","if(",Pe,"){",Ze,"=",Pe,".dtype;",'}else if("constant" in ',g,"){",q.state,"=",al,";","if(typeof "+g+'.constant === "number"){',q[Ro[0]],"=",g,".constant;",Ro.slice(1).map(function(je){return q[je]}).join("="),"=0;","}else{",Ro.map(function(je,Ke){return q[je]+"="+g+".constant.length>"+Ke+"?"+g+".constant["+Ke+"]:0;"}).join(""),"}}else{","if(",Q,"(",g,".buffer)){",Pe,"=",J,".createStream(",Fo,",",g,".buffer);","}else{",Pe,"=",J,".getBuffer(",g,".buffer);","}",Ze,'="type" in ',g,"?",G.glTypes,"[",g,".type]:",Pe,".dtype;",q.normalized,"=!!",g,".normalized;");function Me(je){C(q[je],"=",g,".",je,"|0;")}return Me("size"),Me("offset"),Me("stride"),Me("divisor"),C("}}"),C.exit("if(",q.isStream,"){",J,".destroyStream(",Pe,");","}"),q}U[M]=An(O,P)}),U}function Zt(I,_){var N=I.static,V=I.dynamic;if(Ia in N){var U=N[Ia];return U!==null&&fe.getVAO(U)===null&&(U=fe.createVAO(U)),Yt(function(O){return O.link(fe.getVAO(U))})}else if(Ia in V){var M=V[Ia];return An(M,function(O,P){var S=O.invoke(P,M);return P.def(O.shared.vao+".getVAO("+S+")")})}return null}function xt(I){var _=I.static,N=I.dynamic,V={};return Object.keys(_).forEach(function(U){var M=_[U];V[U]=Yt(function(O,P){return typeof M=="number"||typeof M=="boolean"?""+M:O.link(M)})}),Object.keys(N).forEach(function(U){var M=N[U];V[U]=An(M,function(O,P){return O.invoke(P,M)})}),V}function qt(I,_,N,V,U){var M=I.static,O=I.dynamic;T.optional(function(){var Me=[Kr,Ea,Ta,qr,Qr,Si,Zr,wi,ga,Ia].concat(oe);function je(Ke){Object.keys(Ke).forEach(function(vt){T.command(Me.indexOf(vt)>=0,'unknown parameter "'+vt+'"',U.commandStr)})}je(M),je(O)});var P=Ye(I,_),S=Le(I),C=rt(I,S,U),g=mt(I,U),k=Kt(I,U),G=nt(I,U,P);function Q(Me){var je=C[Me];je&&(k[Me]=je)}Q(or),Q(be(Ii));var J=Object.keys(k).length>0,q={framebuffer:S,draw:g,shader:G,state:k,dirty:J,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(q.profile=qe(I),q.uniforms=nn(N,U),q.drawVAO=q.scopeVAO=Zt(I),!q.drawVAO&&G.program&&!P&&R.angle_instanced_arrays){var de=!0,Pe=G.program.attributes.map(function(Me){var je=_.static[Me];return de=de&&!!je,je});if(de&&Pe.length>0){var Ze=fe.getVAO(fe.createVAO(Pe));q.drawVAO=new En(null,null,null,function(Me,je){return Me.link(Ze)}),q.useVAO=!0}}return P?q.useVAO=!0:q.attributes=lt(_,U),q.context=xt(V),q}function Jt(I,_,N){var V=I.shared,U=V.context,M=I.scope();Object.keys(N).forEach(function(O){_.save(U,"."+O);var P=N[O],S=P.append(I,_);Array.isArray(S)?M(U,".",O,"=[",S.join(),"];"):M(U,".",O,"=",S,";")}),_(M)}function en(I,_,N,V){var U=I.shared,M=U.gl,O=U.framebuffer,P;Se&&(P=_.def(U.extensions,".webgl_draw_buffers"));var S=I.constants,C=S.drawBuffer,g=S.backBuffer,k;N?k=N.append(I,_):k=_.def(O,".next"),V||_("if(",k,"!==",O,".cur){"),_("if(",k,"){",M,".bindFramebuffer(",Bc,",",k,".framebuffer);"),Se&&_(P,".drawBuffersWEBGL(",C,"[",k,".colorAttachments.length]);"),_("}else{",M,".bindFramebuffer(",Bc,",null);"),Se&&_(P,".drawBuffersWEBGL(",g,");"),_("}",O,".cur=",k,";"),V||_("}")}function rn(I,_,N){var V=I.shared,U=V.gl,M=I.current,O=I.next,P=V.current,S=V.next,C=I.cond(P,".dirty");oe.forEach(function(g){var k=be(g);if(!(k in N.state)){var G,Q;if(k in O){G=O[k],Q=M[k];var J=wn(ne[k].length,function(de){return C.def(G,"[",de,"]")});C(I.cond(J.map(function(de,Pe){return de+"!=="+Q+"["+Pe+"]"}).join("||")).then(U,".",re[k],"(",J,");",J.map(function(de,Pe){return Q+"["+Pe+"]="+de}).join(";"),";"))}else{G=C.def(S,".",k);var q=I.cond(G,"!==",P,".",k);C(q),k in _e?q(I.cond(G).then(U,".enable(",_e[k],");").else(U,".disable(",_e[k],");"),P,".",k,"=",G,";"):q(U,".",re[k],"(",G,");",P,".",k,"=",G,";")}}}),Object.keys(N.state).length===0&&C(P,".dirty=false;"),_(C)}function dn(I,_,N,V){var U=I.shared,M=I.current,O=U.current,P=U.gl;jc(Object.keys(N)).forEach(function(S){var C=N[S];if(!(V&&!V(C))){var g=C.append(I,_);if(_e[S]){var k=_e[S];Sr(C)?g?_(P,".enable(",k,");"):_(P,".disable(",k,");"):_(I.cond(g).then(P,".enable(",k,");").else(P,".disable(",k,");")),_(O,".",S,"=",g,";")}else if(Bt(g)){var G=M[S];_(P,".",re[S],"(",g,");",g.map(function(Q,J){return G+"["+J+"]="+Q}).join(";"),";")}else _(P,".",re[S],"(",g,");",O,".",S,"=",g,";")}})}function Ut(I,_){ce&&(I.instancing=_.def(I.shared.extensions,".angle_instanced_arrays"))}function Qe(I,_,N,V,U){var M=I.shared,O=I.stats,P=M.current,S=M.timer,C=N.profile;function g(){return typeof performance>"u"?"Date.now()":"performance.now()"}var k,G;function Q(Me){k=_.def(),Me(k,"=",g(),";"),typeof U=="string"?Me(O,".count+=",U,";"):Me(O,".count++;"),se&&(V?(G=_.def(),Me(G,"=",S,".getNumPendingQueries();")):Me(S,".beginQuery(",O,");"))}function J(Me){Me(O,".cpuTime+=",g(),"-",k,";"),se&&(V?Me(S,".pushScopeStats(",G,",",S,".getNumPendingQueries(),",O,");"):Me(S,".endQuery();"))}function q(Me){var je=_.def(P,".profile");_(P,".profile=",Me,";"),_.exit(P,".profile=",je,";")}var de;if(C){if(Sr(C)){C.enable?(Q(_),J(_.exit),q("true")):q("false");return}de=C.append(I,_),q(de)}else de=_.def(P,".profile");var Pe=I.block();Q(Pe),_("if(",de,"){",Pe,"}");var Ze=I.block();J(Ze),_.exit("if(",de,"){",Ze,"}")}function cn(I,_,N,V,U){var M=I.shared;function O(S){switch(S){case Ai:case Ci:case Fi:return 2;case xi:case Ni:case Li:return 3;case Ri:case Oi:case Mi:return 4;default:return 1}}function P(S,C,g){var k=M.gl,G=_.def(S,".location"),Q=_.def(M.attributes,"[",G,"]"),J=g.state,q=g.buffer,de=[g.x,g.y,g.z,g.w],Pe=["buffer","normalized","offset","stride"];function Ze(){_("if(!",Q,".buffer){",k,".enableVertexAttribArray(",G,");}");var je=g.type,Ke;if(g.size?Ke=_.def(g.size,"||",C):Ke=C,_("if(",Q,".type!==",je,"||",Q,".size!==",Ke,"||",Pe.map(function(Dt){return Q+"."+Dt+"!=="+g[Dt]}).join("||"),"){",k,".bindBuffer(",Fo,",",q,".buffer);",k,".vertexAttribPointer(",[G,Ke,je,g.normalized,g.stride,g.offset],");",Q,".type=",je,";",Q,".size=",Ke,";",Pe.map(function(Dt){return Q+"."+Dt+"="+g[Dt]+";"}).join(""),"}"),ce){var vt=g.divisor;_("if(",Q,".divisor!==",vt,"){",I.instancing,".vertexAttribDivisorANGLE(",[G,vt],");",Q,".divisor=",vt,";}")}}function Me(){_("if(",Q,".buffer){",k,".disableVertexAttribArray(",G,");",Q,".buffer=null;","}if(",Ro.map(function(je,Ke){return Q+"."+je+"!=="+de[Ke]}).join("||"),"){",k,".vertexAttrib4f(",G,",",de,");",Ro.map(function(je,Ke){return Q+"."+je+"="+de[Ke]+";"}).join(""),"}")}J===Co?Ze():J===al?Me():(_("if(",J,"===",Co,"){"),Ze(),_("}else{"),Me(),_("}"))}V.forEach(function(S){var C=S.name,g=N.attributes[C],k;if(g){if(!U(g))return;k=g.append(I,_)}else{if(!U(zc))return;var G=I.scopeAttrib(C);T.optional(function(){I.assert(_,G+".state","missing attribute "+C)}),k={},Object.keys(new B).forEach(function(Q){k[Q]=_.def(G,".",Q)})}P(I.link(S),O(S.info.type),k)})}function gt(I,_,N,V,U){for(var M=I.shared,O=M.gl,P,S=0;S<V.length;++S){var C=V[S],g=C.name,k=C.info.type,G=N.uniforms[g],Q=I.link(C),J=Q+".location",q;if(G){if(!U(G))continue;if(Sr(G)){var de=G.value;if(T.command(de!==null&&typeof de<"u",'missing uniform "'+g+'"',I.commandStr),k===xa||k===Ra){T.command(typeof de=="function"&&(k===xa&&(de._reglType==="texture2d"||de._reglType==="framebuffer")||k===Ra&&(de._reglType==="textureCube"||de._reglType==="framebufferCube")),"invalid texture for uniform "+g,I.commandStr);var Pe=I.link(de._texture||de.color[0]._texture);_(O,".uniform1i(",J,",",Pe+".bind());"),_.exit(Pe,".unbind();")}else if(k===Sa||k===wa||k===Aa){T.optional(function(){T.command(Bt(de),"invalid matrix for uniform "+g,I.commandStr),T.command(k===Sa&&de.length===4||k===wa&&de.length===9||k===Aa&&de.length===16,"invalid length for matrix uniform "+g,I.commandStr)});var Ze=I.global.def("new Float32Array(["+Array.prototype.slice.call(de)+"])"),Me=2;k===wa?Me=3:k===Aa&&(Me=4),_(O,".uniformMatrix",Me,"fv(",J,",false,",Ze,");")}else{switch(k){case El:T.commandType(de,"number","uniform "+g,I.commandStr),P="1f";break;case Ai:T.command(Bt(de)&&de.length===2,"uniform "+g,I.commandStr),P="2f";break;case xi:T.command(Bt(de)&&de.length===3,"uniform "+g,I.commandStr),P="3f";break;case Ri:T.command(Bt(de)&&de.length===4,"uniform "+g,I.commandStr),P="4f";break;case Il:T.commandType(de,"boolean","uniform "+g,I.commandStr),P="1i";break;case Tl:T.commandType(de,"number","uniform "+g,I.commandStr),P="1i";break;case Fi:T.command(Bt(de)&&de.length===2,"uniform "+g,I.commandStr),P="2i";break;case Ci:T.command(Bt(de)&&de.length===2,"uniform "+g,I.commandStr),P="2i";break;case Li:T.command(Bt(de)&&de.length===3,"uniform "+g,I.commandStr),P="3i";break;case Ni:T.command(Bt(de)&&de.length===3,"uniform "+g,I.commandStr),P="3i";break;case Mi:T.command(Bt(de)&&de.length===4,"uniform "+g,I.commandStr),P="4i";break;case Oi:T.command(Bt(de)&&de.length===4,"uniform "+g,I.commandStr),P="4i";break}_(O,".uniform",P,"(",J,",",Bt(de)?Array.prototype.slice.call(de):de,");")}continue}else q=G.append(I,_)}else{if(!U(zc))continue;q=_.def(M.uniforms,"[",y.id(g),"]")}k===xa?(T(!Array.isArray(q),"must specify a scalar prop for textures"),_("if(",q,"&&",q,'._reglType==="framebuffer"){',q,"=",q,".color[0];","}")):k===Ra&&(T(!Array.isArray(q),"must specify a scalar prop for cube maps"),_("if(",q,"&&",q,'._reglType==="framebufferCube"){',q,"=",q,".color[0];","}")),T.optional(function(){function Tn(zn,qc){I.assert(_,zn,'bad data or missing for uniform "'+g+'".  '+qc)}function Al(zn){T(!Array.isArray(q),"must not specify an array type for uniform"),Tn("typeof "+q+'==="'+zn+'"',"invalid type, expected "+zn)}function Pn(zn,qc){Array.isArray(q)?T(q.length===zn,"must have length "+zn):Tn(M.isArrayLike+"("+q+")&&"+q+".length==="+zn,"invalid vector, should have length "+zn,I.commandStr)}function Kc(zn){T(!Array.isArray(q),"must not specify a value type"),Tn("typeof "+q+'==="function"&&'+q+'._reglType==="texture'+(zn===Lc?"2d":"Cube")+'"',"invalid texture type",I.commandStr)}switch(k){case Tl:Al("number");break;case Ci:Pn(2);break;case Ni:Pn(3);break;case Oi:Pn(4);break;case El:Al("number");break;case Ai:Pn(2);break;case xi:Pn(3);break;case Ri:Pn(4);break;case Il:Al("boolean");break;case Fi:Pn(2);break;case Li:Pn(3);break;case Mi:Pn(4);break;case Sa:Pn(4);break;case wa:Pn(9);break;case Aa:Pn(16);break;case xa:Kc(Lc);break;case Ra:Kc(Cb);break}});var je=1;switch(k){case xa:case Ra:var Ke=_.def(q,"._texture");_(O,".uniform1i(",J,",",Ke,".bind());"),_.exit(Ke,".unbind();");continue;case Tl:case Il:P="1i";break;case Ci:case Fi:P="2i",je=2;break;case Ni:case Li:P="3i",je=3;break;case Oi:case Mi:P="4i",je=4;break;case El:P="1f";break;case Ai:P="2f",je=2;break;case xi:P="3f",je=3;break;case Ri:P="4f",je=4;break;case Sa:P="Matrix2fv";break;case wa:P="Matrix3fv";break;case Aa:P="Matrix4fv";break}if(_(O,".uniform",P,"(",J,","),P.charAt(0)==="M"){var vt=Math.pow(k-Sa+2,2),Dt=I.global.def("new Float32Array(",vt,")");Array.isArray(q)?_("false,(",wn(vt,function(Tn){return Dt+"["+Tn+"]="+q[Tn]}),",",Dt,")"):_("false,(Array.isArray(",q,")||",q," instanceof Float32Array)?",q,":(",wn(vt,function(Tn){return Dt+"["+Tn+"]="+q+"["+Tn+"]"}),",",Dt,")")}else je>1?_(wn(je,function(Tn){return Array.isArray(q)?q[Tn]:q+"["+Tn+"]"})):(T(!Array.isArray(q),"uniform value must not be an array"),_(q));_(");")}}function Ue(I,_,N,V){var U=I.shared,M=U.gl,O=U.draw,P=V.draw;function S(){var Ke=P.elements,vt,Dt=_;return Ke?((Ke.contextDep&&V.contextDynamic||Ke.propDep)&&(Dt=N),vt=Ke.append(I,Dt)):vt=Dt.def(O,".",qr),vt&&Dt("if("+vt+")"+M+".bindBuffer("+Ab+","+vt+".buffer.buffer);"),vt}function C(){var Ke=P.count,vt,Dt=_;return Ke?((Ke.contextDep&&V.contextDynamic||Ke.propDep)&&(Dt=N),vt=Ke.append(I,Dt),T.optional(function(){Ke.MISSING&&I.assert(_,"false","missing vertex count"),Ke.DYNAMIC&&I.assert(Dt,vt+">=0","missing vertex count")})):(vt=Dt.def(O,".",Zr),T.optional(function(){I.assert(Dt,vt+">=0","missing vertex count")})),vt}var g=S();function k(Ke){var vt=P[Ke];return vt?vt.contextDep&&V.contextDynamic||vt.propDep?vt.append(I,N):vt.append(I,_):_.def(O,".",Ke)}var G=k(Qr),Q=k(Si),J=C();if(typeof J=="number"){if(J===0)return}else N("if(",J,"){"),N.exit("}");var q,de;ce&&(q=k(wi),de=I.instancing);var Pe=g+".type",Ze=P.elements&&Sr(P.elements);function Me(){function Ke(){N(de,".drawElementsInstancedANGLE(",[G,J,Pe,Q+"<<(("+Pe+"-"+fc+")>>1)",q],");")}function vt(){N(de,".drawArraysInstancedANGLE(",[G,Q,J,q],");")}g?Ze?Ke():(N("if(",g,"){"),Ke(),N("}else{"),vt(),N("}")):vt()}function je(){function Ke(){N(M+".drawElements("+[G,J,Pe,Q+"<<(("+Pe+"-"+fc+")>>1)"]+");")}function vt(){N(M+".drawArrays("+[G,Q,J]+");")}g?Ze?Ke():(N("if(",g,"){"),Ke(),N("}else{"),vt(),N("}")):vt()}ce&&(typeof q!="number"||q>=0)?typeof q=="string"?(N("if(",q,">0){"),Me(),N("}else if(",q,"<0){"),je(),N("}")):Me():je()}function it(I,_,N,V,U){var M=$e(),O=M.proc("body",U);return T.optional(function(){M.commandStr=_.commandStr,M.command=M.link(_.commandStr)}),ce&&(M.instancing=O.def(M.shared.extensions,".angle_instanced_arrays")),I(M,O,N,V),M.compile().body}function pt(I,_,N,V){Ut(I,_),N.useVAO?N.drawVAO?_(I.shared.vao,".setVAO(",N.drawVAO.append(I,_),");"):_(I.shared.vao,".setVAO(",I.shared.vao,".targetVAO);"):(_(I.shared.vao,".setVAO(null);"),cn(I,_,N,V.attributes,function(){return!0})),gt(I,_,N,V.uniforms,function(){return!0}),Ue(I,_,_,N)}function Gt(I,_){var N=I.proc("draw",1);Ut(I,N),Jt(I,N,_.context),en(I,N,_.framebuffer),rn(I,N,_),dn(I,N,_.state),Qe(I,N,_,!1,!0);var V=_.shader.progVar.append(I,N);if(N(I.shared.gl,".useProgram(",V,".program);"),_.shader.program)pt(I,N,_,_.shader.program);else{N(I.shared.vao,".setVAO(null);");var U=I.global.def("{}"),M=N.def(V,".id"),O=N.def(U,"[",M,"]");N(I.cond(O).then(O,".call(this,a0);").else(O,"=",U,"[",M,"]=",I.link(function(P){return it(pt,I,_,P,1)}),"(",V,");",O,".call(this,a0);"))}Object.keys(_.state).length>0&&N(I.shared.current,".dirty=true;")}function Qn(I,_,N,V){I.batchId="a1",Ut(I,_);function U(){return!0}cn(I,_,N,V.attributes,U),gt(I,_,N,V.uniforms,U),Ue(I,_,_,N)}function eo(I,_,N,V){Ut(I,_);var U=N.contextDep,M=_.def(),O="a0",P="a1",S=_.def();I.shared.props=S,I.batchId=M;var C=I.scope(),g=I.scope();_(C.entry,"for(",M,"=0;",M,"<",P,";++",M,"){",S,"=",O,"[",M,"];",g,"}",C.exit);function k(Pe){return Pe.contextDep&&U||Pe.propDep}function G(Pe){return!k(Pe)}if(N.needsContext&&Jt(I,g,N.context),N.needsFramebuffer&&en(I,g,N.framebuffer),dn(I,g,N.state,k),N.profile&&k(N.profile)&&Qe(I,g,N,!1,!0),V)N.useVAO?N.drawVAO?k(N.drawVAO)?g(I.shared.vao,".setVAO(",N.drawVAO.append(I,g),");"):C(I.shared.vao,".setVAO(",N.drawVAO.append(I,C),");"):C(I.shared.vao,".setVAO(",I.shared.vao,".targetVAO);"):(C(I.shared.vao,".setVAO(null);"),cn(I,C,N,V.attributes,G),cn(I,g,N,V.attributes,k)),gt(I,C,N,V.uniforms,G),gt(I,g,N,V.uniforms,k),Ue(I,C,g,N);else{var Q=I.global.def("{}"),J=N.shader.progVar.append(I,g),q=g.def(J,".id"),de=g.def(Q,"[",q,"]");g(I.shared.gl,".useProgram(",J,".program);","if(!",de,"){",de,"=",Q,"[",q,"]=",I.link(function(Pe){return it(Qn,I,N,Pe,2)}),"(",J,");}",de,".call(this,a0[",M,"],",M,");")}}function A(I,_){var N=I.proc("batch",2);I.batchId="0",Ut(I,N);var V=!1,U=!0;Object.keys(_.context).forEach(function(Q){V=V||_.context[Q].propDep}),V||(Jt(I,N,_.context),U=!1);var M=_.framebuffer,O=!1;M?(M.propDep?V=O=!0:M.contextDep&&V&&(O=!0),O||en(I,N,M)):en(I,N,null),_.state.viewport&&_.state.viewport.propDep&&(V=!0);function P(Q){return Q.contextDep&&V||Q.propDep}rn(I,N,_),dn(I,N,_.state,function(Q){return!P(Q)}),(!_.profile||!P(_.profile))&&Qe(I,N,_,!1,"a1"),_.contextDep=V,_.needsContext=U,_.needsFramebuffer=O;var S=_.shader.progVar;if(S.contextDep&&V||S.propDep)eo(I,N,_,null);else{var C=S.append(I,N);if(N(I.shared.gl,".useProgram(",C,".program);"),_.shader.program)eo(I,N,_,_.shader.program);else{N(I.shared.vao,".setVAO(null);");var g=I.global.def("{}"),k=N.def(C,".id"),G=N.def(g,"[",k,"]");N(I.cond(G).then(G,".call(this,a0,a1);").else(G,"=",g,"[",k,"]=",I.link(function(Q){return it(eo,I,_,Q,2)}),"(",C,");",G,".call(this,a0,a1);"))}}Object.keys(_.state).length>0&&N(I.shared.current,".dirty=true;")}function H(I,_){var N=I.proc("scope",3);I.batchId="a2";var V=I.shared,U=V.current;Jt(I,N,_.context),_.framebuffer&&_.framebuffer.append(I,N),jc(Object.keys(_.state)).forEach(function(O){var P=_.state[O],S=P.append(I,N);Bt(S)?S.forEach(function(C,g){N.set(I.next[O],"["+g+"]",C)}):N.set(V.next,"."+O,S)}),Qe(I,N,_,!0,!0),[qr,Si,Zr,wi,Qr].forEach(function(O){var P=_.draw[O];P&&N.set(V.draw,"."+O,""+P.append(I,N))}),Object.keys(_.uniforms).forEach(function(O){var P=_.uniforms[O].append(I,N);Array.isArray(P)&&(P="["+P.join()+"]"),N.set(V.uniforms,"["+y.id(O)+"]",P)}),Object.keys(_.attributes).forEach(function(O){var P=_.attributes[O].append(I,N),S=I.scopeAttrib(O);Object.keys(new B).forEach(function(C){N.set(S,"."+C,P[C])})}),_.scopeVAO&&N.set(V.vao,".targetVAO",_.scopeVAO.append(I,N));function M(O){var P=_.shader[O];P&&N.set(V.shader,"."+O,P.append(I,N))}M(Ea),M(Ta),Object.keys(_.state).length>0&&(N(U,".dirty=true;"),N.exit(U,".dirty=true;")),N("a1(",I.shared.context,",a0,",I.batchId,");")}function j(I){if(!(typeof I!="object"||Bt(I))){for(var _=Object.keys(I),N=0;N<_.length;++N)if(Nn.isDynamic(I[_[N]]))return!0;return!1}}function Ne(I,_,N){var V=_.static[N];if(!V||!j(V))return;var U=I.global,M=Object.keys(V),O=!1,P=!1,S=!1,C=I.global.def("{}");M.forEach(function(k){var G=V[k];if(Nn.isDynamic(G)){typeof G=="function"&&(G=V[k]=Nn.unbox(G));var Q=An(G,null);O=O||Q.thisDep,S=S||Q.propDep,P=P||Q.contextDep}else{switch(U(C,".",k,"="),typeof G){case"number":U(G);break;case"string":U('"',G,'"');break;case"object":Array.isArray(G)&&U("[",G.join(),"]");break;default:U(I.link(G));break}U(";")}});function g(k,G){M.forEach(function(Q){var J=V[Q];if(Nn.isDynamic(J)){var q=k.invoke(G,J);G(C,".",Q,"=",q,";")}})}_.dynamic[N]=new Nn.DynamicVariable(Ti,{thisDep:O,contextDep:P,propDep:S,ref:C,append:g}),delete _.static[N]}function ot(I,_,N,V,U){var M=$e();M.stats=M.link(U),Object.keys(_.static).forEach(function(P){Ne(M,_,P)}),wb.forEach(function(P){Ne(M,I,P)});var O=qt(I,_,N,V,M);return Gt(M,O),H(M,O),A(M,O),r(M.compile(),{destroy:function(){O.shader.program.destroy()}})}return{next:xe,current:ne,procs:function(){var I=$e(),_=I.proc("poll"),N=I.proc("refresh"),V=I.block();_(V),N(V);var U=I.shared,M=U.gl,O=U.next,P=U.current;V(P,".dirty=false;"),en(I,_),en(I,N,null,!0);var S;ce&&(S=I.link(ce)),R.oes_vertex_array_object&&N(I.link(R.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var C=0;C<X.maxAttributes;++C){var g=N.def(U.attributes,"[",C,"]"),k=I.cond(g,".buffer");k.then(M,".enableVertexAttribArray(",C,");",M,".bindBuffer(",Fo,",",g,".buffer.buffer);",M,".vertexAttribPointer(",C,",",g,".size,",g,".type,",g,".normalized,",g,".stride,",g,".offset);").else(M,".disableVertexAttribArray(",C,");",M,".vertexAttrib4f(",C,",",g,".x,",g,".y,",g,".z,",g,".w);",g,".buffer=null;"),N(k),ce&&N(S,".vertexAttribDivisorANGLE(",C,",",g,".divisor);")}return N(I.shared.vao,".currentVAO=null;",I.shared.vao,".setVAO(",I.shared.vao,".targetVAO);"),Object.keys(_e).forEach(function(G){var Q=_e[G],J=V.def(O,".",G),q=I.block();q("if(",J,"){",M,".enable(",Q,")}else{",M,".disable(",Q,")}",P,".",G,"=",J,";"),N(q),_("if(",J,"!==",P,".",G,"){",q,"}")}),Object.keys(re).forEach(function(G){var Q=re[G],J=ne[G],q,de,Pe=I.block();if(Pe(M,".",Q,"("),Bt(J)){var Ze=J.length;q=I.global.def(O,".",G),de=I.global.def(P,".",G),Pe(wn(Ze,function(Me){return q+"["+Me+"]"}),");",wn(Ze,function(Me){return de+"["+Me+"]="+q+"["+Me+"];"}).join("")),_("if(",wn(Ze,function(Me){return q+"["+Me+"]!=="+de+"["+Me+"]"}).join("||"),"){",Pe,"}")}else q=V.def(O,".",G),de=V.def(P,".",G),Pe(q,");",P,".",G,"=",q,";"),_("if(",q,"!==",de,"){",Pe,"}");N(Pe)}),I.compile()}(),compile:ot}}function Xb(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hb=34918,Wb=34919,$c=35007,Yb=function(p,y){if(!y.ext_disjoint_timer_query)return null;var R=[];function X(){return R.pop()||y.ext_disjoint_timer_query.createQueryEXT()}function Z(ce){R.push(ce)}var $=[];function W(ce){var Se=X();y.ext_disjoint_timer_query.beginQueryEXT($c,Se),$.push(Se),se($.length-1,$.length,ce)}function ie(){y.ext_disjoint_timer_query.endQueryEXT($c)}function le(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var fe=[];function ue(){return fe.pop()||new le}function me(ce){fe.push(ce)}var ye=[];function se(ce,Se,ne){var xe=ue();xe.startQueryIndex=ce,xe.endQueryIndex=Se,xe.sum=0,xe.stats=ne,ye.push(xe)}var ve=[],B=[];function Y(){var ce,Se,ne=$.length;if(ne!==0){B.length=Math.max(B.length,ne+1),ve.length=Math.max(ve.length,ne+1),ve[0]=0,B[0]=0;var xe=0;for(ce=0,Se=0;Se<$.length;++Se){var oe=$[Se];y.ext_disjoint_timer_query.getQueryObjectEXT(oe,Wb)?(xe+=y.ext_disjoint_timer_query.getQueryObjectEXT(oe,Hb),Z(oe)):$[ce++]=oe,ve[Se+1]=xe,B[Se+1]=ce}for($.length=ce,ce=0,Se=0;Se<ye.length;++Se){var _e=ye[Se],re=_e.startQueryIndex,be=_e.endQueryIndex;_e.sum+=ve[be]-ve[re];var Ve=B[re],We=B[be];We===Ve?(_e.stats.gpuTime+=_e.sum/1e6,me(_e)):(_e.startQueryIndex=Ve,_e.endQueryIndex=We,ye[ce++]=_e)}ye.length=ce}}return{beginQuery:W,endQuery:ie,pushScopeStats:se,update:Y,getNumPendingQueries:function(){return $.length},clear:function(){R.push.apply(R,$);for(var ce=0;ce<R.length;ce++)y.ext_disjoint_timer_query.deleteQueryEXT(R[ce]);$.length=0,R.length=0},restore:function(){$.length=0,R.length=0}}},Kb=16384,qb=256,Qb=1024,Zb=34962,Xc="webglcontextlost",Hc="webglcontextrestored",Wc=1,Jb=2,ey=3;function Yc(p,y){for(var R=0;R<p.length;++R)if(p[R]===y)return R;return-1}function ty(p){var y=Zm(p);if(!y)return null;var R=y.gl,X=R.getContextAttributes(),Z=R.isContextLost(),$=Jm(R,y);if(!$)return null;var W=Wm(),ie=Xb(),le=$.extensions,fe=Yb(R,le),ue=nd(),me=R.drawingBufferWidth,ye=R.drawingBufferHeight,se={tick:0,time:0,viewportWidth:me,viewportHeight:ye,framebufferWidth:me,framebufferHeight:ye,drawingBufferWidth:me,drawingBufferHeight:ye,pixelRatio:y.pixelRatio},ve={},B={elements:null,primitive:4,count:-1,offset:0,instances:-1},Y=Uv(R,le),ce=n_(R,ie,y,ne),Se=hb(R,le,Y,ie,ce);function ne(Ue){return Se.destroyBuffer(Ue)}var xe=h_(R,le,ce,ie),oe=bb(R,W,ie,y),_e=X_(R,le,Y,function(){Ve.procs.poll()},se,ie,y),re=H_(R,le,Y,ie,y),be=fb(R,le,Y,_e,re,ie),Ve=$b(R,W,le,Y,ce,xe,_e,be,ve,Se,oe,B,se,fe,y),We=Eb(R,be,Ve.procs.poll,se,X,le,Y),ge=Ve.next,pe=R.canvas,te=[],$e=[],qe=[],Le=[y.onDestroy],rt=null;function Ye(){if(te.length===0){fe&&fe.update(),rt=null;return}rt=Os.next(Ye),dn();for(var Ue=te.length-1;Ue>=0;--Ue){var it=te[Ue];it&&it(se,null,0)}R.flush(),fe&&fe.update()}function nt(){!rt&&te.length>0&&(rt=Os.next(Ye))}function mt(){rt&&(Os.cancel(Ye),rt=null)}function Kt(Ue){Ue.preventDefault(),Z=!0,mt(),$e.forEach(function(it){it()})}function nn(Ue){R.getError(),Z=!1,$.restore(),oe.restore(),ce.restore(),_e.restore(),re.restore(),be.restore(),Se.restore(),fe&&fe.restore(),Ve.procs.refresh(),nt(),qe.forEach(function(it){it()})}pe&&(pe.addEventListener(Xc,Kt,!1),pe.addEventListener(Hc,nn,!1));function lt(){te.length=0,mt(),pe&&(pe.removeEventListener(Xc,Kt),pe.removeEventListener(Hc,nn)),oe.clear(),be.clear(),re.clear(),_e.clear(),xe.clear(),ce.clear(),Se.clear(),fe&&fe.clear(),Le.forEach(function(Ue){Ue()})}function Zt(Ue){T(!!Ue,"invalid args to regl({...})"),T.type(Ue,"object","invalid args to regl({...})");function it(U){var M=r({},U);delete M.uniforms,delete M.attributes,delete M.context,delete M.vao,"stencil"in M&&M.stencil.op&&(M.stencil.opBack=M.stencil.opFront=M.stencil.op,delete M.stencil.op);function O(P){if(P in M){var S=M[P];delete M[P],Object.keys(S).forEach(function(C){M[P+"."+C]=S[C]})}}return O("blend"),O("depth"),O("cull"),O("stencil"),O("polygonOffset"),O("scissor"),O("sample"),"vao"in U&&(M.vao=U.vao),M}function pt(U,M){var O={},P={};return Object.keys(U).forEach(function(S){var C=U[S];if(Nn.isDynamic(C)){P[S]=Nn.unbox(C,S);return}else if(M&&Array.isArray(C)){for(var g=0;g<C.length;++g)if(Nn.isDynamic(C[g])){P[S]=Nn.unbox(C,S);return}}O[S]=C}),{dynamic:P,static:O}}var Gt=pt(Ue.context||{},!0),Qn=pt(Ue.uniforms||{},!0),eo=pt(Ue.attributes||{},!1),A=pt(it(Ue),!1),H={gpuTime:0,cpuTime:0,count:0},j=Ve.compile(A,eo,Qn,Gt,H),Ne=j.draw,ot=j.batch,I=j.scope,_=[];function N(U){for(;_.length<U;)_.push(null);return _}function V(U,M){var O;if(Z&&T.raise("context lost"),typeof U=="function")return I.call(this,null,U,0);if(typeof M=="function")if(typeof U=="number")for(O=0;O<U;++O)I.call(this,null,M,O);else if(Array.isArray(U))for(O=0;O<U.length;++O)I.call(this,U[O],M,O);else return I.call(this,U,M,0);else if(typeof U=="number"){if(U>0)return ot.call(this,N(U|0),U|0)}else if(Array.isArray(U)){if(U.length)return ot.call(this,U,U.length)}else return Ne.call(this,U)}return r(V,{stats:H,destroy:function(){j.destroy()}})}var xt=be.setFBO=Zt({framebuffer:Nn.define.call(null,Wc,"framebuffer")});function qt(Ue,it){var pt=0;Ve.procs.poll();var Gt=it.color;Gt&&(R.clearColor(+Gt[0]||0,+Gt[1]||0,+Gt[2]||0,+Gt[3]||0),pt|=Kb),"depth"in it&&(R.clearDepth(+it.depth),pt|=qb),"stencil"in it&&(R.clearStencil(it.stencil|0),pt|=Qb),T(!!pt,"called regl.clear with no buffer specified"),R.clear(pt)}function Jt(Ue){if(T(typeof Ue=="object"&&Ue,"regl.clear() takes an object as input"),"framebuffer"in Ue)if(Ue.framebuffer&&Ue.framebuffer_reglType==="framebufferCube")for(var it=0;it<6;++it)xt(r({framebuffer:Ue.framebuffer.faces[it]},Ue),qt);else xt(Ue,qt);else qt(null,Ue)}function en(Ue){T.type(Ue,"function","regl.frame() callback must be a function"),te.push(Ue);function it(){var pt=Yc(te,Ue);T(pt>=0,"cannot cancel a frame twice");function Gt(){var Qn=Yc(te,Gt);te[Qn]=te[te.length-1],te.length-=1,te.length<=0&&mt()}te[pt]=Gt}return nt(),{cancel:it}}function rn(){var Ue=ge.viewport,it=ge.scissor_box;Ue[0]=Ue[1]=it[0]=it[1]=0,se.viewportWidth=se.framebufferWidth=se.drawingBufferWidth=Ue[2]=it[2]=R.drawingBufferWidth,se.viewportHeight=se.framebufferHeight=se.drawingBufferHeight=Ue[3]=it[3]=R.drawingBufferHeight}function dn(){se.tick+=1,se.time=Qe(),rn(),Ve.procs.poll()}function Ut(){_e.refresh(),rn(),Ve.procs.refresh(),fe&&fe.update()}function Qe(){return(nd()-ue)/1e3}Ut();function cn(Ue,it){T.type(it,"function","listener callback must be a function");var pt;switch(Ue){case"frame":return en(it);case"lost":pt=$e;break;case"restore":pt=qe;break;case"destroy":pt=Le;break;default:T.raise("invalid event, must be one of frame,lost,restore,destroy")}return pt.push(it),{cancel:function(){for(var Gt=0;Gt<pt.length;++Gt)if(pt[Gt]===it){pt[Gt]=pt[pt.length-1],pt.pop();return}}}}var gt=r(Zt,{clear:Jt,prop:Nn.define.bind(null,Wc),context:Nn.define.bind(null,Jb),this:Nn.define.bind(null,ey),draw:Zt({}),buffer:function(Ue){return ce.create(Ue,Zb,!1,!1)},elements:function(Ue){return xe.create(Ue,!1)},texture:_e.create2D,cube:_e.createCube,renderbuffer:re.create,framebuffer:be.create,framebufferCube:be.createCube,vao:Se.createVAO,attributes:X,frame:en,on:cn,limits:Y,hasExtension:function(Ue){return Y.extensions.indexOf(Ue.toLowerCase())>=0},read:We,destroy:lt,_gl:R,_refresh:Ut,poll:function(){dn(),fe&&fe.update()},now:Qe,stats:ie});return y.onDone(null,gt),gt}return ty})})(MA);var ar,La,ir,kn,Ma,wr,Da,Ui,Zn,no,hn,Jn,er,Gi;ar={},Re(ar,Ae.POINTS,"points"),Re(ar,Ae.LINES,"lines"),Re(ar,Ae.LINE_LOOP,"line loop"),Re(ar,Ae.LINE_STRIP,"line strip"),Re(ar,Ae.TRIANGLES,"triangles"),Re(ar,Ae.TRIANGLE_FAN,"triangle fan"),Re(ar,Ae.TRIANGLE_STRIP,"triangle strip");La={},Re(La,Ae.STATIC_DRAW,"static"),Re(La,Ae.DYNAMIC_DRAW,"dynamic"),Re(La,Ae.STREAM_DRAW,"stream");ir={},Re(ir,Ae.BYTE,"int8"),Re(ir,Ae.UNSIGNED_INT,"int16"),Re(ir,Ae.INT,"int32"),Re(ir,Ae.UNSIGNED_BYTE,"uint8"),Re(ir,Ae.UNSIGNED_SHORT,"uint16"),Re(ir,Ae.UNSIGNED_INT,"uint32"),Re(ir,Ae.FLOAT,"float");kn={},Re(kn,Ae.ALPHA,"alpha"),Re(kn,Ae.LUMINANCE,"luminance"),Re(kn,Ae.LUMINANCE_ALPHA,"luminance alpha"),Re(kn,Ae.RGB,"rgb"),Re(kn,Ae.RGBA,"rgba"),Re(kn,Ae.RGBA4,"rgba4"),Re(kn,Ae.RGB5_A1,"rgb5 a1"),Re(kn,Ae.RGB565,"rgb565"),Re(kn,Ae.DEPTH_COMPONENT,"depth"),Re(kn,Ae.DEPTH_STENCIL,"depth stencil");Ma={},Re(Ma,Ae.DONT_CARE,"dont care"),Re(Ma,Ae.NICEST,"nice"),Re(Ma,Ae.FASTEST,"fast");wr={},Re(wr,Ae.NEAREST,"nearest"),Re(wr,Ae.LINEAR,"linear"),Re(wr,Ae.LINEAR_MIPMAP_LINEAR,"mipmap"),Re(wr,Ae.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),Re(wr,Ae.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),Re(wr,Ae.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest");Da={},Re(Da,Ae.REPEAT,"repeat"),Re(Da,Ae.CLAMP_TO_EDGE,"clamp"),Re(Da,Ae.MIRRORED_REPEAT,"mirror");Ui={},Re(Ui,Ae.NONE,"none"),Re(Ui,Ae.BROWSER_DEFAULT_WEBGL,"browser");Zn={},Re(Zn,Ae.NEVER,"never"),Re(Zn,Ae.ALWAYS,"always"),Re(Zn,Ae.LESS,"less"),Re(Zn,Ae.LEQUAL,"lequal"),Re(Zn,Ae.GREATER,"greater"),Re(Zn,Ae.GEQUAL,"gequal"),Re(Zn,Ae.EQUAL,"equal"),Re(Zn,Ae.NOTEQUAL,"notequal");no={},Re(no,Ae.FUNC_ADD,"add"),Re(no,Ae.MIN_EXT,"min"),Re(no,Ae.MAX_EXT,"max"),Re(no,Ae.FUNC_SUBTRACT,"subtract"),Re(no,Ae.FUNC_REVERSE_SUBTRACT,"reverse subtract");hn={},Re(hn,Ae.ZERO,"zero"),Re(hn,Ae.ONE,"one"),Re(hn,Ae.SRC_COLOR,"src color"),Re(hn,Ae.ONE_MINUS_SRC_COLOR,"one minus src color"),Re(hn,Ae.SRC_ALPHA,"src alpha"),Re(hn,Ae.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),Re(hn,Ae.DST_COLOR,"dst color"),Re(hn,Ae.ONE_MINUS_DST_COLOR,"one minus dst color"),Re(hn,Ae.DST_ALPHA,"dst alpha"),Re(hn,Ae.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),Re(hn,Ae.CONSTANT_COLOR,"constant color"),Re(hn,Ae.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),Re(hn,Ae.CONSTANT_ALPHA,"constant alpha"),Re(hn,Ae.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),Re(hn,Ae.SRC_ALPHA_SATURATE,"src alpha saturate");Jn={},Re(Jn,Ae.NEVER,"never"),Re(Jn,Ae.ALWAYS,"always"),Re(Jn,Ae.LESS,"less"),Re(Jn,Ae.LEQUAL,"lequal"),Re(Jn,Ae.GREATER,"greater"),Re(Jn,Ae.GEQUAL,"gequal"),Re(Jn,Ae.EQUAL,"equal"),Re(Jn,Ae.NOTEQUAL,"notequal");er={},Re(er,Ae.ZERO,"zero"),Re(er,Ae.KEEP,"keep"),Re(er,Ae.REPLACE,"replace"),Re(er,Ae.INVERT,"invert"),Re(er,Ae.INCR,"increment"),Re(er,Ae.DECR,"decrement"),Re(er,Ae.INCR_WRAP,"increment wrap"),Re(er,Ae.DECR_WRAP,"decrement wrap");Gi={},Re(Gi,Ae.FRONT,"front"),Re(Gi,Ae.BACK,"back");var DA=Function.prototype,PA=DA.toString;PA.call(Object);globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;const kA=Ce({__name:"LayoutBtn",setup(e){const t=$t(),n=E(yn,{iconClass:"leftLayout"},null),r=E(yn,{iconClass:"rightLayout"},null),o=E(yn,{iconClass:"topLayout"},null),a=E(yn,{iconClass:"bottomLayout"},null),i=(s="DL")=>{var f,h,m;const l=new WI({type:"dagre",rankdir:"LR",align:s,ranksep:35,nodesep:15,begin:[150,100]}),u=(f=t.graphInstance)==null?void 0:f.toJSON().cells,d=u==null?void 0:u.reduce((v,b)=>(b.shape==="edge"?v.edges.push(b):v.nodes.push(b),v),{nodes:[],edges:[]}),c=l.layout(d);(h=t.graphInstance)==null||h.fromJSON(c,{silent:!1}),(m=t.graphInstance)==null||m.cleanSelection()};return(s,l)=>{const u=Lt,d=na;return D(),Ie(dt,null,[E(d,{effect:"dark",content:"左对齐",placement:"bottom-start"},{default:F(()=>[E(u,{icon:x(n),onClick:l[0]||(l[0]=c=>i("UL")),size:"small",text:""},null,8,["icon"])]),_:1}),E(d,{effect:"dark",content:"右对齐",placement:"bottom-start"},{default:F(()=>[E(u,{icon:x(r),onClick:l[1]||(l[1]=c=>i("UR")),size:"small",text:""},null,8,["icon"])]),_:1}),E(d,{effect:"dark",content:"顶对齐",placement:"bottom-start"},{default:F(()=>[E(u,{size:"small",icon:x(o),onClick:l[2]||(l[2]=c=>i("DL")),text:""},null,8,["icon"])]),_:1}),E(d,{effect:"dark",content:"底对齐",placement:"bottom-start"},{default:F(()=>[E(u,{icon:x(a),onClick:l[3]||(l[3]=c=>i("DR")),size:"small",text:""},null,8,["icon"])]),_:1})],64)}}});const VA=Tt(kA,[["__scopeId","data-v-c7ecd476"]]),BA=Ce({__name:"ScaleBtn",setup(e){const t=$t();Ln(()=>{t.graphInstance.on("scale",({sx:f,sy:h,ox:m,oy:v})=>{s.value=Math.ceil(f*100)})});const n=c=>{var f;(f=t.graphInstance)==null||f.zoomTo(c/100)},r=c=>{var f;(f=t.graphInstance)==null||f.zoomTo(c/100)},o=c=>{var f;(f=t.graphInstance)==null||f.zoomTo(c/100)},a=[{label:"50%",value:50},{label:"75%",value:75},{label:"100%",value:100},{label:"125%",value:125},{label:"150%",value:150},{label:"200%",value:200}],i=we(),s=we(100),l=c=>{var f;s.value=c,o(s.value),(f=i.value)==null||f.hide()},u=()=>{var c;s.value>50&&s.value<=200&&(s.value-=25,n(s.value),(c=i.value)==null||c.hide())},d=()=>{var c;s.value>=50&&s.value<200&&(s.value+=25,r(s.value),(c=i.value)==null||c.hide())};return(c,f)=>{const h=Lt,m=Eu;return D(),Ie("div",{class:"scale-btn"},[E(h,{icon:x(Dy),onClick:u,text:""},null,8,["icon"]),E(m,{placement:"bottom-start",title:"",width:65,trigger:"click","popper-class":"scale-popover",ref_key:"ElPopoverRef",ref:i},{reference:F(()=>[Te("div",{class:"scale"},mn(s.value+"%"),1)]),default:F(()=>[(D(),Ie(dt,null,It(a,v=>Te("div",{class:"scale-item",key:v.value,onClick:b=>l(v.value)},mn(v.label),9,["onClick"])),64))]),_:1},512),E(h,{icon:x(gu),onClick:d,text:""},null,8,["icon"])])}}});const UA=Tt(BA,[["__scopeId","data-v-ee038f14"]]),GA=Ce({__name:"DeleteBtn",setup(e){const t=$t(),n=()=>{t.graphInstance.getSelectedCells().forEach(a=>{var i;(i=t.graphInstance)==null||i.removeNode(a.id)})};return(r,o)=>{const a=Lt,i=na;return D(),ee(i,{effect:"dark",content:"删除节点",placement:"bottom-start"},{default:F(()=>[E(a,{size:"small",icon:x(Lr),onClick:n,text:""},null,8,["icon"])]),_:1})}}}),jA=Ce({__name:"ToolBarPanel",setup(e){const t=$t();return(n,r)=>{const o=Wp;return D(),Ie("div",{class:"tool-bar_flex"},[x(t).graphInstance?(D(),Ie("div",{key:0,class:"tool-bar_flex--left"},[E(o,{size:10,spacer:"|"},{default:F(()=>[E(uE),E(VA),E(UA),E(GA)]),_:1})])):Xe("",!0),Te("div",{class:"tool-bar_flex--right"})])}}});const zA=Tt(jA,[["__scopeId","data-v-954cf131"]]),$A=e=>{const{active:t,tabTags:n}=e,r=we(t??n[0]),o=$t(),a=Ee(()=>{var c;return fn((c=o.selectNode)==null?void 0:c.shape,"icon")}),i=Ee(()=>{var c;return fn((c=o.selectNode)==null?void 0:c.shape,"name")}),{emit:s,checkNodeData:l}=hs();return{rules:Ee(()=>{var c;return Fu((c=o.selectNode)==null?void 0:c.shape)??{}}),nodeIcon:a,nodeName:i,activeName:r,handleValid:()=>{var m,v;const c=((m=o.selectNode)==null?void 0:m.shape)??"",f=((v=o.selectNode)==null?void 0:v.id)??"",h=e.nodeData;return l({data:h,shape:c,id:f})}}},XA=Ce({__name:"NodeInfo",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=Ee({get(){return n.modelValue},set(a){r("update:modelValue",a)}});return(a,i)=>{const s=Cn,l=Xt;return D(),Ie("section",null,[E(l,{label:"节点名称","label-width":"100px",prop:"cellsName"},{default:F(()=>[E(s,{modelValue:o.value.cellsName,"onUpdate:modelValue":i[0]||(i[0]=u=>o.value.cellsName=u),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),E(l,{label:"说明","label-width":"100px"},{default:F(()=>[E(s,{type:"textarea",rows:3,maxlength:100,"show-word-limit":"",modelValue:o.value.desc,"onUpdate:modelValue":i[1]||(i[1]=u=>o.value.desc=u),placeholder:"请输入节点说明",clearable:""},null,8,["modelValue"])]),_:1})])}}}),HA=Ce({__name:"ErrorTips",props:{type:{},tips:{}},setup(e){const t=e,n=[[0,0,1,0,0],[0,0,0,0,0],[0,0,2,0,0]],r=[[0,1,0,1,0],[0,0,0,0,0],[0,0,2,0,0]],o=[[1,0,1,2,1],[0,0,0,0,0],[0,0,2,0,0]],a={1:{block:n,tips:"缺少前置节点，请将一个节点连接至本节点",linePosition:{[1]:["1_2"],[2]:[""],[3]:[""],[4]:[""],[5]:[""],[6]:[""]}},2:{block:r,tips:"缺少前置节点，请将两个节点连接至本节点",linePosition:{[1]:[""],[2]:["1_3"],[3]:["1_1"],[4]:["1_2"],[5]:[""],[6]:[""]}},3:{block:o,tips:"缺少前置节点，请至少将两个节点连接至本节点；最多可连接10个",linePosition:{[1]:[""],[2]:["1_4"],[3]:["1_0"],[4]:[""],[5]:["1_3","1_1"],[6]:["1_2"]}}},i=Ee(()=>a[f.value].block),s=Ee(()=>t.tips||a[f.value].tips),l=Ee(()=>a[f.value].linePosition),u=Ee(()=>fn(t.type,"icon")),d=Ee(()=>fn(t.type,"name")),c=Ee(()=>fn(t.type,"iconColor")),f=Ee(()=>[Ct.fieldSetting,Ct.dataFilter,Ct.classSummary,Ct.rowToColumn,Ct.columnToRow,Ct.dataOutput].includes(t.type)?1:[Ct.multiTableJoin].includes(t.type)?2:([Ct.dataMerge].includes(t.type),3)),h=(m,v)=>({line:l.value[1].includes(m+"_"+v),lLine:l.value[2].includes(m+"_"+v),rlLine:l.value[3].includes(m+"_"+v),tLine:l.value[4].includes(m+"_"+v),iLine:l.value[5].includes(m+"_"+v),xLine:l.value[6].includes(m+"_"+v)});return(m,v)=>{const b=Py;return D(),Ie("section",{class:Yo(["error-tips",{"is-line--error":!m.tips}])},[Te("section",{class:"block-content"},[(D(!0),Ie(dt,null,It(i.value,(w,L)=>(D(),Ie("div",{class:"column",key:L},[(D(!0),Ie(dt,null,It(w,(z,K)=>(D(),Ie("div",{key:K,class:Yo(["block row",[h(L,K),{ellipsis:`${L}_${K}`=="0_3"&&f.value===3},{"is-node--error":z===1&&m.tips}]]),style:Wo({visibility:z===0?"hidden":"visible"})},[z===1?(D(),Ie("div",{key:0,class:"error_skeleton"},[Te("div",{class:"error_skeleton--title"}),Te("div",{class:"error_skeleton--content"})])):Xe("",!0),z===2?(D(),Ie("div",{key:1},[`${L}_${K}`=="0_3"?(D(),Ie("span",{key:0},"......")):(D(),Ie(dt,{key:1},[E(yn,{"icon-class":u.value,style:Wo({color:c.value})},null,8,["icon-class","style"]),Te("span",{class:"ml-10"},mn(d.value),1)],64))])):Xe("",!0)],6))),128))]))),128))]),E(b,{title:s.value,type:"error",class:"w50",center:"","show-icon":"",closable:!1},null,8,["title"])],2)}}});const WA=Tt(HA,[["__scopeId","data-v-dc3bf6f1"]]),YA=e=>{const t=Fu(e);if(t)return new Vp(t)},KA=(e,t)=>new Promise((n,r)=>{const o=YA(e);o==null||o.validate(t,a=>{a?(a[0],r(!1)):n(!0)})}),qA=Ce({__name:"VerifyWrapper",setup(e){const t=$t(),n=Ee(()=>{var h;return(h=t.selectNode)==null?void 0:h.shape}),r=Ee(()=>t.selectNode),o=we(void 0);function a(h){var v;const m=[];return(v=t.graphInstance)==null||v.searchCell(h,(b,w)=>{var z;((z=t.graphInstance)==null?void 0:z.isRootNode(b))&&m.push(b)},{incoming:!0}),m}function i(h){var v;return(((v=t.graphInstance)==null?void 0:v.getNeighbors(h,{outgoing:!0}))??[])[0]}function s(h){const m=t.graphInstance,v=[];return function b(w){(m==null?void 0:m.getNeighbors(w,{incoming:!0})).forEach(z=>{const K=fn(z.shape,"getCurrentNodeFields"),he=K==null?void 0:K(z);Array.isArray(he)&&he.length>=1?v.push(he):b(z)})}(h),v}function l(h){const m=t.graphInstance;return(m==null?void 0:m.getNeighbors(h,{incoming:!0})).length>1}function u(h,m){const{shape:v}=h,b=fn(v,"verifyNodeData"),w=s(h).map(z=>z.map(K=>K.fieldId));if(b==null?void 0:b({currentCell:h,parentIds:w})){const z=i(h);return z.id!==m.id?z:!0}else return!1}function d(h,m){const v=u(h,m);return Yl(v)||l(v)?v:d(v,m)}const c=(h,m)=>{const v=[];for(let b=0;b<m.length;b++){const w=m[b];let L=null;if(l(w)?L=u(w,h):L=d(w,h),Yl(L)){if(!L)return L}else v.push(L)}return v.length<=0?!0:c(h,Hg(v,"id"))},f=Gp(async()=>{var m,v,b;const h=(m=t.graphInstance)==null?void 0:m.getNeighbors(r.value,{incoming:!0,deep:!0});if(o.value=void 0,h){const w=Dp(r.value.shape);if(!w)return!1;if((v=w==null?void 0:w.verifyLinkNode)==null?void 0:v.call(w,h.length)){const z=ky(w==null?void 0:w.mfVerify)?(b=w==null?void 0:w.mfVerify)==null?void 0:b.call(w,{dataDealMode:t.dataDealMode,cells:h}):{state:!0,msg:"1"};if(z.state){const K=a(r.value);if(K.some(he=>he.shape!==Ct.dataInput))return o.value="必须以输入节点为起始节点",!1;{const he=c(r.value,K);return he?await new Promise((at,ke)=>{Promise.all(h.map(He=>KA(He.shape,He.data))).then(()=>{o.value=void 0,at(!0)}).catch(()=>{o.value="请先完成依赖节点的配置1",at(!1)})}):(o.value="请先完成依赖节点的配置",!1)}}else return o.value=z.msg,!1}else return!1}return!1},!1);return(h,m)=>x(f)?Rr(h.$slots,"default",{key:1}):(D(),Ie("div",{key:0},[n.value?(D(),ee(WA,{key:0,type:n.value,tips:o.value},null,8,["type","tips"])):Xe("",!0)]))}}),sn=(e,t,n)=>Vy(e,t,n),QA=Ce({__name:"SettingWrapper",props:{modelValue:{},tabTags:{default:()=>["info","set","preview"]},defaultActive:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,o=sn(n,"modelValue",t),a={info:"节点信息",set:"节点配置",preview:"数据预览"},i=Ee(()=>n.tabTags.map(h=>({label:a[h],name:h}))),{nodeIcon:s,nodeName:l,activeName:u,rules:d,handleValid:c}=$A(Mn({tabTags:n.tabTags,active:n.defaultActive,nodeData:By(n,"modelValue")})),f=we();return(h,m)=>{const v=Uy,b=Gy,w=ra;return D(),ee(Ig,{direction:"top",cursor:`url(${x(Sg)}) 0 12, ew-resize`,options:{id:"node_setting__wrapper",init:400,max:600,min:340}},{default:F(()=>[E(w,{ref_key:"elFormRef",ref:f,model:x(o),rules:x(d),"label-suffix":"：",style:{width:"100%",height:"100%"}},{default:F(()=>[Te("main",{class:"setting__wrapper"},[Te("div",{class:"setting__wrapper__header"},[Te("section",{class:"setting__wrapper__title"},[Te("span",null,[E(yn,{"icon-class":x(s)},null,8,["icon-class"])]),Te("span",{class:"ml-10"},mn(x(l)),1)]),Te("section",{class:"setting__wrapper__header__tab"},[E(b,{modelValue:x(u),"onUpdate:modelValue":m[1]||(m[1]=L=>wt(u)?u.value=L:null)},{default:F(()=>[(D(!0),Ie(dt,null,It(i.value,L=>(D(),ee(v,{key:L.name,label:L.label,name:L.name,class:Yo(L.name==="set"?"setting_tab_set":""),lazy:""},{default:F(()=>[L.name==="info"?Rr(h.$slots,"info",{key:0},()=>[E(XA,{modelValue:x(o),"onUpdate:modelValue":m[0]||(m[0]=z=>wt(o)?o.value=z:null),style:{width:"380px"}},null,8,["modelValue"])],!0):Xe("",!0),L.name==="set"?(D(),ee(qA,{key:1},{default:F(()=>[Rr(h.$slots,"set",{},void 0,!0)]),_:3})):Xe("",!0),L.name==="preview"?Rr(h.$slots,"preview",{key:2,isPreview:x(u)==="preview"},void 0,!0):Xe("",!0)]),_:2},1032,["label","name","class"]))),128))]),_:3},8,["modelValue"])])])])]),_:3},8,["model","rules"])]),_:3},8,["cursor"])}}});const yr=Tt(QA,[["__scopeId","data-v-b9a317f4"]]),ZA=Ce({__name:"settingContainer",props:{width:{default:"300px"}},setup(e){const t=e,n=Ee(()=>({"--aside-width":t.width})),r=!!jy().main;return(o,a)=>(D(),Ie("div",{class:"layout-container",style:Wo(n.value)},[Te("div",{class:"aside"},[Rr(o.$slots,"aside",{},void 0,!0)]),r?(D(),Ie("div",{key:0,class:"interval"})):Xe("",!0),Te("div",{class:"main"},[Rr(o.$slots,"main",{},void 0,!0)])],4))}});const ua=Tt(ZA,[["__scopeId","data-v-470a25fa"]]),Ur=()=>{const e=$t();return{getNodeFields:()=>{if(!e.selectNode||!e.graphInstance)return;const n=e.graphInstance,r=e.selectNode,o=[];return n.getPredecessors(r,{distance:1}).forEach(i=>{const l=i.getData().cellsName,u=i.shape,d=i.id,c=fn(i.shape,"getCurrentNodeFields"),f=c==null?void 0:c(i);Array.isArray(f)&&f.length>=1?o.push({pNodeName:l,fields:f,pId:d,pType:u}):function h(m){n.getPredecessors(m,{distance:1}).forEach(b=>{const w=fn(b.shape,"getCurrentNodeFields"),L=w==null?void 0:w(b);Array.isArray(L)&&L.length>=1?o.push({pNodeName:l,fields:L,pId:d,pType:u}):h(b)})}(i)}),Et(o)}}},Uo={...zy,create_name:{label:"创建人",name:"create_name",source:rf.system,type:Ge.input},update_name:{label:"修改人",name:"update_name",source:rf.system,type:Ge.input}},JA=(e,t)=>{if(e.options.alias=t.alias,"category"in t&&e.type===Ge.date)switch(e.options.format=$y.zh,t.category){case Xn.year:e.options.type=Na.year;break;case Xn.day:e.options.type=Na.date;break;case Xn.month:e.options.type=Na.month;break;case Xn.week:e.options.type=Na.week;break;case Xn.quarter:e.options.type=Na.quarter;break}return e},ex=()=>{const e=Xy(),t=new Map,n=(s,l)=>s&&JA(s,l),r=s=>{if(t.has(s.fieldId)){const u=t.get(s.fieldId);return n(u,s)}else{const u=o(s);return n(u,s)}},o=s=>{if(s.entryId){const l=Yg(s.fieldId,"_")[0],u=s.entryId,d=e.getFields({entryId:u});return Array.isArray(d)?((Hy(d)??[]).forEach(c=>{const f={...c,fieldId:`${l}_${c.fieldId}`};t.set(f.fieldId,f)}),t.get(s.fieldId)):d}else{const l=[ka.accumulate,ka.calc,ka.sort];let u=null;if(Yl(s.isSystem)&&s.isSystem){const d=Uo[s.name];u=Wy([d])[0],u&&(u.options.label=s.comment,u.fieldId=s.fieldId)}else{const d=s.fieldType;if(l.includes(d)){const c=Ge.compute;u=of(c,{fieldId:s.fieldId,options:{label:(s==null?void 0:s.alias)??s.comment}})}else u=of(d,{fieldId:s.fieldId,options:{label:(s==null?void 0:s.alias)??s.comment}})}if(u)return t.set(s.fieldId,u),t.get(s.fieldId)}};return{batchGetInfosByFields:s=>{const l=s.map(u=>r(u));return In(l)},batchSetInfosByFields:s=>{s.forEach(l=>{o(l)})},getMapInfoByFieldInfo:r}},tx=ex,Cp=Symbol("fieldsDataSystemKey");function vn(){const e=Wi(Cp,void 0);if(e)return e;{const t=tx();return Tu(Cp,t),t}}const nx=Ce({__name:"EditName",props:{info:{}},emits:["update:info"],setup(e,{emit:t}){const n=e,r=t,o=we(!0),a=we(""),i=we(),s=Ee(()=>{const f=[ft.accumulate,ft.sort].includes(n.info.fieldType)?ft.compute:n.info.fieldType;return Iu(f)}),l=Ee(()=>n.info.alias?n.info.alias:n.info.comment),u=()=>{o.value=!1,a.value=l.value,Fr(()=>{var c;(c=i.value)==null||c.focus()})},d=()=>{const c=n.info;c.alias=a.value,r("update:info",c),o.value=!0};return(c,f)=>{const h=Lt,m=Cn;return D(),Ie("div",{class:"header-title"},[Te("span",{class:"header-icon"},[E(yn,{"icon-class":s.value},null,8,["icon-class"])]),o.value?(D(),Ie("div",{key:0,class:"header-edit"},[E(fo,{class:"header-name",content:l.value},null,8,["content"]),E(h,{class:"ml-5",type:"primary",link:"",icon:x(so),onClick:u},null,8,["icon"])])):(D(),ee(m,{key:1,ref_key:"ElInputRef",ref:i,class:"header-name",modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=v=>a.value=v),onBlur:d,onKeyup:qa(d,["enter"]),placeholder:"请输入字段名称"},null,8,["modelValue","onKeyup"]))])}}});const Em=Tt(nx,[["__scopeId","data-v-126ca367"]]),rx=({classKey:e,triggerKey:t,onEnd:n})=>({rowDrag:()=>{const a=document.querySelector(`${e} .el-table__body-wrapper tbody`);a&&af.create(a,{animation:150,handle:t,onEnd({newIndex:i,oldIndex:s}){jo(s)&&jo(i)&&n({newIndex:i,oldIndex:s})}})},columnDrag:()=>{const a=document.querySelector(`${e} .el-table__header-wrapper thead tr`);a&&af.create(a,{animation:150,handle:t,onEnd({newIndex:i,oldIndex:s}){jo(s)&&jo(i)&&n({newIndex:i,oldIndex:s})}})}}),ti=e=>{const{rowDrag:t}=rx(e);Ln(()=>{t()})},ox=[Ge.input,Ge.radio,Ge.multiple,Ge.autoNumber,Ge.compute,Ge.member,Ge.department,Ge.address,Ge.date,Ge.time,Ge.memberSingle,Ge.departmentSingle],Tm=[Uo.flow_status.name,Uo.create_user.name,Uo.update_time.name,Uo.create_time.name,Uo.create_name.name],ax=e=>{const{fieldType:t,isSystem:n,name:r}=e;return n?Tm.includes(r):ox.includes(t)},ix=[Ge.input,Ge.radio,Ge.autoNumber,Ge.compute,Ge.member,Ge.department,Ge.address,Ge.date,Ge.time,Ge.number],sx=e=>{const{fieldType:t,isSystem:n,name:r}=e;return n?Tm.includes(r):ix.includes(t)},Im=Ce({__name:"AddClass",props:{pFields:{},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=vn(),a=Ee(()=>{const c=n.pFields.filter(f=>ax(f))??[];return o.batchGetInfosByFields(c)}),i=Mn([{label:"年",value:Xn.year},{label:"年-周",value:Xn.week},{label:"年-季",value:Xn.quarter},{label:"年-月",value:Xn.month},{label:"年-月-日",value:Xn.day}]),s=c=>{const f=n.modelValue.filter(h=>h.name!==c);r("update:modelValue",f)},l=c=>{const f=[Ge.date,Ge.daterange,Ge.time,Ge.timerange],h=a.value.find(m=>m.fieldId===c);return h?f.includes(h.type):!1},u=c=>{const f=[Ge.date,Ge.daterange,Ge.time,Ge.timerange],h=n.pFields.find(m=>m.fieldId===c.fieldId);if(h)if(f.includes(h.fieldType)){const m=Xn.year;r("update:modelValue",[...n.modelValue,{...h,category:m}])}else r("update:modelValue",[...n.modelValue,{...h}])};ti({classKey:".GroupTable_dragTable",triggerKey:".drag",onEnd:({newIndex:c,oldIndex:f})=>{const h=n.modelValue,m=h.splice(f,1)[0];h.splice(c,0,m),r("update:modelValue",[...h])}});const d=c=>{const f=n.modelValue.map(h=>h.fieldId);return c.filter(h=>!f.includes(h.fieldId))};return(c,f)=>{const h=Xt,m=dr,v=Wn,b=pr,w=Lt,L=Mr;return D(),Ie("div",null,[E(h,{label:"设置分类字段",required:""},{default:F(()=>[Te("div",{style:{width:"100%",display:"flex","justify-content":"right"}},[E(hr,{style:{width:"120px"},ref:"buttonSelectFieldRef",placeholder:"添加分类字段",fields:a.value,isSelect:!1,buttonProps:{type:"primary"},onClickField:u,filter:d},null,8,["fields"])])]),_:1}),E(L,{class:"GroupTable_dragTable",data:c.modelValue,style:{width:"100%"},"row-key":"fieldId","max-height":"400px"},{default:F(()=>[E(m,{label:"字段名称"},{default:F(({row:z})=>[(D(),ee(Em,{key:z.fieldId,info:z},null,8,["info"]))]),_:1}),E(m,{prop:"category",label:"分类方式",width:"180"},{default:F(z=>[l(z.row.fieldId)?(D(),ee(b,{key:0,modelValue:z.row[z.column.property],"onUpdate:modelValue":K=>z.row[z.column.property]=K,placeholder:"请选择分类方式"},{default:F(()=>[(D(!0),Ie(dt,null,It(i,K=>(D(),ee(v,{key:K.value,label:K.label,value:K.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):Xe("",!0)]),_:1}),E(m,{label:"",width:"80"},{default:F(({row:z})=>[E(w,{link:"",icon:x(oa),class:"drag"},null,8,["icon"]),E(w,{type:"danger",link:"",icon:x(Lr),onClick:K=>s(z.name)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])}}}),lx=e=>{switch(e){case Ft.date:case Ft.dateTime:return ft.date;case Ft.time:return ft.time;case Ft.json:case Ft.text:case Ft.string:return ft.input;case Ft.int:case Ft.long:case Ft.double:case Ft.decimal:return ft.number;default:return ft.text}},Sm=[{label:"计数",value:an.count},{label:"去重计数",value:an.count_distinct}],wm=[{label:"求和",value:an.sum},{label:"平均值",value:an.avg},{label:"最大值",value:an.max},{label:"最小值",value:an.min},{label:"计数",value:an.count},{label:"去重计数",value:an.count_distinct},{label:"方差",value:an.var_pop},{label:"标准差",value:an.stddev_pop}],ux=[{label:"计数",value:an.count},{label:"去重计数",value:an.count_distinct},{label:"最新",value:an.max},{label:"最早",value:an.min}],dx=Ce({__name:"AddSummary",props:{modelValue:{},pFields:{},dataDealMode:{},timeoutVal:{}},emits:["update:modelValue","update:timeoutVal"],setup(e,{emit:t}){const n=e,r=t,o=vn(),a=m=>{const v=m.name;return n.pFields.find(w=>w.fieldId===v)},i=Ee({get(){return n.timeoutVal},set(m){jo(m)&&r("update:timeoutVal",m)}}),s=Ee(()=>{const m=n.pFields.filter(v=>sx(v))??[];return o.batchGetInfosByFields(m)}),l=m=>{const v=n.pFields.find(b=>b.fieldId===m.fieldId);if(v){const w={...v,summary:"count",fieldType:ft.number,fieldId:za(v.fieldType),name:v.fieldId,type:Ft.int,isSystem:null};w==null||delete w.entryId,w==null||delete w.modelId,w==null||delete w.connectionId,r("update:modelValue",[...n.modelValue,w])}},u=m=>{const v=n.modelValue.filter(b=>b.fieldId!==m);r("update:modelValue",v)};ti({classKey:".SummaryTable_dragTable",triggerKey:".drag",onEnd:({newIndex:m,oldIndex:v})=>{const b=n.modelValue,w=b.splice(v,1)[0];b.splice(m,0,w),r("update:modelValue",[...b])}});const d=m=>m?[Ge.date,Ge.time].includes(m):!1,c=m=>m?[Ge.input,Ge.radio,Ge.autoNumber,Ge.compute,Ge.member,Ge.memberSingle,Ge.department,Ge.departmentSingle,Ge.address].includes(m):!1,f=m=>m?[Ge.number].includes(m):!1,h=(m,v)=>{var b,w;switch(m){case an.count:case an.count_distinct:v.type=Ft.int,v.fieldType=ft.number;break;case an.var_pop:case an.stddev_pop:case an.avg:v.type=Ft.double,v.fieldType=ft.number;break;default:v.type=((b=a(v))==null?void 0:b.type)??v.type,v.fieldType=((w=a(v))==null?void 0:w.fieldType)??v.fieldType}};return(m,v)=>{const b=Xt,w=dr,L=Wn,z=pr,K=Lt,he=Mr,Fe=Cn;return D(),Ie("div",{style:{width:"100%",height:"100%"}},[E(b,{label:"设置汇总字段",required:""},{default:F(()=>[Te("div",{style:{width:"100%",display:"flex","justify-content":"right"}},[E(hr,{style:{width:"120px"},ref:"buttonSelectFieldRef",placeholder:"添加汇总字段",fields:s.value,isSelect:!1,buttonProps:{type:"primary"},onClickField:l},null,8,["fields"])])]),_:1}),E(he,{class:"SummaryTable_dragTable",data:m.modelValue,style:{width:"100%"},"row-key":"fieldId","max-height":"400px"},{default:F(()=>[E(w,{prop:"name",label:"字段名称"},{default:F(({row:Oe})=>[(D(),ee(Em,{key:Oe.fieldId,info:Oe},null,8,["info"]))]),_:1}),E(w,{prop:"summary",label:"汇总方式",width:"180"},{default:F(Oe=>{var at,ke,ze;return[c((at=a(Oe.row))==null?void 0:at.fieldType)?(D(),ee(z,{key:0,modelValue:Oe.row[Oe.column.property],"onUpdate:modelValue":He=>Oe.row[Oe.column.property]=He,onChange:He=>h(He,Oe.row),placeholder:"请选择汇总方式"},{default:F(()=>[(D(!0),Ie(dt,null,It(x(Sm),He=>(D(),ee(L,{key:He.value,label:He.label,value:He.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):Xe("",!0),f((ke=a(Oe.row))==null?void 0:ke.fieldType)?(D(),ee(z,{key:1,modelValue:Oe.row[Oe.column.property],"onUpdate:modelValue":He=>Oe.row[Oe.column.property]=He,onChange:He=>h(He,Oe.row),placeholder:"请选择汇总方式"},{default:F(()=>[(D(!0),Ie(dt,null,It(x(wm),He=>(D(),ee(L,{key:He.value,label:He.label,value:He.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):Xe("",!0),d((ze=a(Oe.row))==null?void 0:ze.fieldType)?(D(),ee(z,{key:2,modelValue:Oe.row[Oe.column.property],"onUpdate:modelValue":He=>Oe.row[Oe.column.property]=He,onChange:He=>h(He,Oe.row),placeholder:"请选择汇总方式"},{default:F(()=>[(D(!0),Ie(dt,null,It(x(ux),He=>(D(),ee(L,{key:He.value,label:He.label,value:He.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):Xe("",!0)]}),_:1}),E(w,{label:"",width:"80"},{default:F(({row:Oe})=>[E(K,{link:"",icon:x(oa),class:"drag"},null,8,["icon"]),E(K,{type:"danger",link:"",icon:x(Lr),onClick:at=>u(Oe.fieldId)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"]),m.dataDealMode===x(ur).flow?(D(),ee(b,{key:0,label:"其他设置",style:{"margin-top":"18px"}},{default:F(()=>[Te("div",null,[Te("span",{class:"mr-15"},"聚合状态超时时间"),E(Fe,{type:"number",style:{width:"160px"},modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=Oe=>i.value=Oe),modelModifiers:{number:!0},min:0,placeholder:"请输入秒数"},{append:F(()=>[St("秒")]),_:1},8,["modelValue"])])]),_:1})):Xe("",!0)])}}}),cx=Ce({__name:"PreviewFieldView",props:{field:{},value:{}},setup(e){const t=e,n=Ee(()=>t.value);return(r,o)=>r.field?(D(),ee(Ky,{key:0,content:n.value,field:r.field,emptyText:"-",mode:x(Yy).list,bubble:""},null,8,["content","field","mode"])):(D(),Ie("span",{key:1},"-"))}}),Am=Ce({__name:"PreviewTable",props:{fields:{},tableData:{},cols:{}},setup(e){const t=e,n=r=>t.fields.find(o=>o.fieldId===r);return(r,o)=>{const a=dr,i=Mr;return D(),ee(i,{data:r.tableData,style:{width:"100%",height:"100%"},border:""},{default:F(()=>[(D(!0),Ie(dt,null,It(r.cols,(s,l)=>(D(),ee(a,{key:s.fieldId,prop:s.fieldId,label:s.alias,width:l<r.cols.length-1?"150":"auto"},{default:F(({row:u})=>[n(s.fieldId)?(D(),ee(cx,{key:0,value:u[s.fieldId],field:n(s.fieldId)},null,8,["value","field"])):(D(),Ie("span",{key:1},mn(u[s.fieldId]),1))]),_:2},1032,["prop","label","width"]))),128))]),_:1},8,["data"])}}}),xm=e=>{const t=$t(),n=we(),r=Ee(()=>{var u;return(((u=n.value)==null?void 0:u.columns)??[]).map(d=>({fieldId:d.fieldId,alias:d.alias}))});function o(l,u){const d={};return Object.keys(l).forEach(c=>{const f=u(c);d[f]=l[c]}),d}const a=Ee(()=>{var u,d;const l=(u=n.value)==null?void 0:u.columns;return(((d=n.value)==null?void 0:d.rows)??[]).map(c=>o(c,f=>{const h=l==null?void 0:l.find(m=>m.name===f);return h?h.fieldId:f}))});return{load:async()=>{var c,f;const l=[],u=(c=t.graphInstance)==null?void 0:c.getCellById(e.id);if(l.push(u),u){const h=(f=t.graphInstance)==null?void 0:f.getPredecessors(u,{deep:!0});h&&h.forEach(m=>{var b;l.push(m);const v=(b=t.graphInstance)==null?void 0:b.getConnectedEdges(m);v==null||v.forEach(w=>{l.every(L=>L.id!==w.id)&&l.push(w)})})}const d=await xg({appId:t.appId,cells:In(l),limit:10,dataStreamId:t.dataId,cellsId:e.id});n.value=d},loadRealTime:async()=>{var c,f;const l=[],u=(c=t.graphInstance)==null?void 0:c.getCellById(e.id);if(l.push(u),u){const h=(f=t.graphInstance)==null?void 0:f.getPredecessors(u,{deep:!0});h&&h.forEach(m=>{var b;l.push(m);const v=(b=t.graphInstance)==null?void 0:b.getConnectedEdges(m);v==null||v.forEach(w=>{l.every(L=>L.id!==w.id)&&l.push(w)})})}const d=await Rg({appId:t.appId,cells:In(l),limit:10,dataStreamId:t.dataId,cellsId:e.id});if(await qy(2e3),d){const h=await Cg({jobId:d});n.value=h}},tableData:n,headers:r,tableList:a}},fx=Ce({__name:"PreviewTableData",props:{id:{},curFields:{}},setup(e,{expose:t}){const n=e,{load:r,headers:o,tableList:a}=xm(n),i=we(),s=vn(),l=Ee(()=>s.batchGetInfosByFields(n.curFields));return t({reload:()=>{var u;(u=i.value)==null||u.reload()}}),(u,d)=>(D(),ee(cs,{load:x(r),ref_key:"LoadDataRef",ref:i,style:{width:"100%",height:"100%"}},{default:F(()=>[E(Am,{cols:x(o),fields:l.value,tableData:x(a)},null,8,["cols","fields","tableData"])]),_:1},8,["load"]))}}),px=Ce({__name:"PreviewRealTimeTable",props:{id:{},curFields:{}},setup(e,{expose:t}){const n=e,{loadRealTime:r,headers:o,tableList:a}=xm(n),i=we(),s=vn(),l=Ee(()=>s.batchGetInfosByFields(n.curFields));return t({reload:()=>{var u;(u=i.value)==null||u.reload()}}),(u,d)=>(D(),ee(cs,{load:x(r),ref_key:"LoadDataRef",ref:i,style:{width:"100%",height:"100%"}},{default:F(()=>[E(Am,{cols:x(o),fields:l.value,tableData:x(a)},null,8,["cols","fields","tableData"])]),_:1},8,["load"]))}}),Gr=Ce({__name:"PreviewDataWrap",setup(e,{expose:t}){const n=$t(),r=Ee(()=>n.dataDealMode===ur.batch?fx:px),o=we(),{checkNodeData:a}=hs(),i=()=>{var c,f,h;const l=((c=n.selectNode)==null?void 0:c.shape)??"",u=((f=n.selectNode)==null?void 0:f.id)??"",d=(h=n.selectNode)==null?void 0:h.getData();return a({data:d,shape:l,id:u})},s=Gp(async()=>(await i()).type==="success",!1);return t({reload:()=>{var l;(l=o.value)==null||l.reload()}}),(l,u)=>{const d=Qy;return x(s)?(D(),ee(x(r),Su({key:0,ref_key:"previewRef",ref:o},l.$attrs),null,16)):(D(),ee(d,{key:1,description:"预览数据前，请先完成节点配置"}))}}}),hx=Ce({__name:"Setting",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=$t(),a=sn(n,"modelValue",r),{getNodeFields:i}=Ur(),s=Ee(()=>{var d,c;return((c=(d=i())==null?void 0:d[0])==null?void 0:c.fields)??[]}),l=Ee(()=>[...a.value.classifyColumn,...a.value.summaryColumn]),u=Ee(()=>o.dataDealMode);return Ln(()=>{const d=n.modelValue.classifyColumn,c=n.modelValue.summaryColumn,f=s.value.map(h=>h.fieldId);d.length>=1&&(a.value.classifyColumn=d.filter(h=>f.includes(h.fieldId))),c.length>=1&&(a.value.summaryColumn=c.filter(h=>f.includes(h.name)))}),(d,c)=>{const f=Xt;return D(),ee(yr,{modelValue:x(a),"onUpdate:modelValue":c[3]||(c[3]=h=>wt(a)?a.value=h:null),"default-active":"set"},{set:F(()=>[E(ua,{width:"50%"},{aside:F(()=>[E(Im,{modelValue:x(a).classifyColumn,"onUpdate:modelValue":c[0]||(c[0]=h=>x(a).classifyColumn=h),"p-fields":s.value},null,8,["modelValue","p-fields"]),E(f,{label:"",style:{"margin-top":"18px"},prop:"classifyColumn"})]),main:F(()=>[E(dx,{modelValue:x(a).summaryColumn,"onUpdate:modelValue":c[1]||(c[1]=h=>x(a).summaryColumn=h),"p-fields":s.value,"timeout-val":x(a).timeout,"onUpdate:timeoutVal":c[2]||(c[2]=h=>x(a).timeout=h),dataDealMode:u.value},null,8,["modelValue","p-fields","timeout-val","dataDealMode"]),E(f,{style:{"margin-top":"18px"},label:"",prop:"summaryColumn"})]),_:1})]),preview:F(({isPreview:h})=>[x(o).selectNode&&h?(D(),ee(Gr,{key:0,ref:"PreviewTableDataRef","cur-fields":l.value,id:x(o).selectNode.id},null,8,["cur-fields","id"])):Xe("",!0)]),_:1},8,["modelValue"])}}}),mx=Object.freeze(Object.defineProperty({__proto__:null,default:hx},Symbol.toStringTag,{value:"Module"})),Np=Ce({__name:"AttrField",props:{field:{},label:{}},emits:["update:field","change"],setup(e,{emit:t}){const n=e,r=t,o=Dr(n,"field",r),a=Ee({get(){return o.value.comment},set(l){o.value.comment=l}}),i=Ee({get(){return o.value.type},set(l){o.value.type=l,l===Ft.string?o.value.fieldType=ft.input:o.value.fieldType=ft.number;const u=o.value.fieldId.split("_");u[1]=o.value.fieldType;const d=u.join("_");o.value.fieldId=d,o.value.name=o.value.fieldId,r("change")}}),s=[Ft.string,Ft.int,Ft.long,Ft.double,Ft.decimal];return(l,u)=>{const d=Wn,c=pr,f=Cn,h=Xt;return D(),ee(h,Su({"label-width":"135px",label:l.label},l.$attrs),{default:F(()=>[E(f,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=m=>a.value=m),style:{width:"320px"},placeholder:"请输入属性字段名称"},{append:F(()=>[E(c,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=m=>i.value=m),placeholder:"请选择类型",style:{width:"115px"}},{default:F(()=>[(D(),Ie(dt,null,It(s,m=>E(d,{key:m,label:m,value:m},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1},16,["label"])}}}),vx=Ce({__name:"WaitToRow",props:{waitToRow:{},pFields:{},getValueNameType:{}},emits:["update:waitToRow"],setup(e,{emit:t}){const n=e,r=t,o=vn(),a=Ee(()=>{const l=(n.pFields??[]).filter(u=>u.type===n.getValueNameType);return o.batchGetInfosByFields(l)}),i=Ee({get(){return n.waitToRow.map(l=>l.fieldId)},set(l){if(Array.isArray(l)){const u=l.map(d=>{const c=n.waitToRow.find(f=>f.fieldId===d);if(c)return c;{const f=n.pFields.find(h=>h.fieldId===d);return f?{...f,rowValue:""}:void 0}});r("update:waitToRow",In(u))}else{const u=n.pFields.find(d=>d.fieldId===l);u&&r("update:waitToRow",[{...u,rowValue:""}])}}}),s=l=>{const u=n.waitToRow.filter(d=>d.fieldId!==l);r("update:waitToRow",u)};return(l,u)=>{const d=dr,c=Cn,f=Lt,h=Mr,m=Xt;return D(),ee(m,{"label-width":"135px",label:"待列转行的字段",prop:"waitToRow"},{default:F(()=>[Te("div",null,[E(hr,{style:{width:"140px","margin-bottom":"18px"},modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=v=>i.value=v),fields:a.value,ref:"selectFieldRef",placeholder:"选择转换字段",buttonProps:{type:"primary",icon:x(wu)},multiple:""},null,8,["modelValue","fields","buttonProps"]),E(h,{ref:"tableRef",data:l.waitToRow,style:{width:"500px"},"row-key":"fieldId"},{default:F(()=>[E(d,{label:"转换字段"},{default:F(({row:v})=>[St(mn((v==null?void 0:v.alias)??v.comment),1)]),_:1}),E(d,{label:"新建行值"},{default:F(({row:v})=>[E(c,{modelValue:v.rowValue,"onUpdate:modelValue":b=>v.rowValue=b},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),E(d,{width:"150"},{default:F(({row:v})=>[E(f,{link:"",icon:x(Lr),onClick:io(b=>s(v.fieldId),["stop"])},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})}}}),_x=Ce({__name:"Setting",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=$t(),{getNodeFields:a}=Ur(),i=Ee(()=>{var d,c;return((c=(d=a())==null?void 0:d[0])==null?void 0:c.fields)??[]}),s=sn(n,"modelValue",r);Au(()=>{s.value.otherField=i.value.filter(d=>!s.value.waitToRow.map(f=>f.fieldId).includes(d.fieldId))});const l=Ee(()=>[...s.value.waitToRow,...s.value.otherField]),u=()=>{s.value.waitToRow=[]};return Ln(()=>{const d=n.modelValue.waitToRow;if(d.length>=1){const c=i.value.map(f=>f.fieldId);s.value.waitToRow=d.filter(f=>c.includes(f.fieldId))}}),(d,c)=>(D(),ee(yr,{modelValue:x(s),"onUpdate:modelValue":c[3]||(c[3]=f=>wt(s)?s.value=f:null),"default-active":"set"},{set:F(()=>[E(Np,{label:"属性字段名称",field:x(s).attrColumnName,"onUpdate:field":c[0]||(c[0]=f=>x(s).attrColumnName=f),prop:"attrColumnName",onChange:u},null,8,["field"]),E(Np,{label:"取值字段名称",field:x(s).getValueName,"onUpdate:field":c[1]||(c[1]=f=>x(s).getValueName=f),prop:"getValueName"},null,8,["field"]),E(vx,{"wait-to-row":x(s).waitToRow,"onUpdate:waitToRow":c[2]||(c[2]=f=>x(s).waitToRow=f),"p-fields":i.value,getValueNameType:x(s).attrColumnName.type},null,8,["wait-to-row","p-fields","getValueNameType"])]),preview:F(({isPreview:f})=>[x(o).selectNode&&f?(D(),ee(Gr,{key:0,ref:"PreviewTableDataRef","cur-fields":l.value,id:x(o).selectNode.id},null,8,["cur-fields","id"])):Xe("",!0)]),_:1},8,["modelValue"]))}}),bx=Object.freeze(Object.defineProperty({__proto__:null,default:_x},Symbol.toStringTag,{value:"Module"})),_o=()=>{const e=$t(),t=Ee(()=>e.dataDealMode===ur.flow),n=Ee(()=>e.dataDealMode===ur.batch);return{isFlowMode:t,isBatchMode:n}},yx=Ce({__name:"Setting",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=$t(),{getNodeFields:a}=Ur(),{isFlowMode:i}=_o(),s=Ee(()=>{var f;return((f=a())==null?void 0:f[0].fields)??[]}),l=vn(),u=Ee(()=>{const f=s.value??[];return l.batchGetInfosByFields(f)}),d=sn(n,"modelValue",r),c=(f,h)=>{var m;return i.value&&((m=h==null?void 0:h.field)==null?void 0:m.type)===Ge.date?f.filter(v=>v.value!==Zy.dateDynamic):f};return(f,h)=>{const m=ta,v=Pr,b=kr;return D(),ee(yr,{modelValue:x(d),"onUpdate:modelValue":h[1]||(h[1]=w=>wt(d)?d.value=w:null),defaultActive:"set"},{set:F(()=>[E(b,null,{default:F(()=>[E(v,{span:6},{default:F(()=>[E(m,null,{default:F(()=>[Te("div",{class:"az-tip mt-15 mb-15"}," 设置筛选条件后，只有满足条件的数据才会进入本节点 "),E(kg,{class:"mb-15",condition:x(d).filterJson,"onUpdate:condition":h[0]||(h[0]=w=>x(d).filterJson=w),btnText:"设置筛选条件",msg:"筛选条件异常",fields:u.value,operateFilter:c,validate:""},null,8,["condition","fields"]),E(Vg,{class:"w100",condition:x(d).filterJson,"app-id":x(d).appId,fields:u.value,isConditionForm:""},null,8,["condition","app-id","fields"])]),_:1})]),_:1})]),_:1})]),preview:F(({isPreview:w})=>[x(o).selectNode&&w?(D(),ee(Gr,{key:0,id:x(o).selectNode.id,"cur-fields":s.value,ref:"PreviewTableDataRef"},null,8,["id","cur-fields"])):Xe("",!0)]),_:1},8,["modelValue"])}}}),gx=Object.freeze(Object.defineProperty({__proto__:null,default:yx},Symbol.toStringTag,{value:"Module"})),Ex=Ce({__name:"FieldLabel",props:{fieldInfo:{}},setup(e){const t=e,n=Ee(()=>t.fieldInfo.fieldId),r=vn(),o=Ee(()=>{const a=r.getMapInfoByFieldInfo(t.fieldInfo);return In([a])});return(a,i)=>(D(),ee(Jy,{"field-id":n.value,fields:o.value},null,8,["field-id","fields"]))}});const Rm=Tt(Ex,[["__scopeId","data-v-643ffe67"]]),Zu=we(),Tx=e=>{Zu.value=e},Op=()=>Zu.value,Ix=()=>{Zu.value=void 0},Sx=Ce({__name:"DragArea",props:{fieldInfo:{},isDel:{type:Boolean}},emits:["del"],setup(e,{emit:t}){const n=e,r=t,o=()=>{Tx(n.fieldInfo)},a=()=>{Ix()};return(i,s)=>{const l=Lt;return D(),Ie("div",{class:"field-name-box",draggable:"true",onDragstart:o,onDragend:a},[E(Rm,{style:{width:"90px"},"field-info":i.fieldInfo},null,8,["field-info"]),i.isDel?(D(),Ie("span",{key:0,class:"field-close",onClick:s[0]||(s[0]=io(u=>r("del"),["stop"]))},[E(l,{type:"danger",link:"",icon:x(jp)},null,8,["icon"])])):Xe("",!0)],32)}}});const wx=Tt(Sx,[["__scopeId","data-v-3d71ca91"]]),Ax=Ce({__name:"DropArea",props:{validations:{type:Function},filter:{type:Function},fields:{}},emits:["dropCallback","updateValue"],setup(e,{emit:t}){const n=e,r=t,o=we();Vi(o,"drop",function(l){const u=Op(),d=n.validations;u&&d&&d(u)&&r("dropCallback",u),o.value.classList.remove("dragging"),o.value.classList.remove("error")}),Vi(o,"dragover",l=>{l.preventDefault()}),Vi(o,"dragenter",l=>{const u=Op(),d=n.validations;u?d&&d(u)!==!0?(o.value.classList.add("error"),l.preventDefault()):o.value.classList.add("dragging"):o.value.classList.add("error")}),Vi(o,"dragleave",()=>{o.value.classList.remove("dragging"),o.value.classList.remove("error")});const a=we(),i=we(!1),s=()=>{i.value||(i.value=!0)};return(l,u)=>(D(),Ie("div",{ref_key:"dropRef",ref:o,class:"field-add",onMousemove:s},[i.value?(D(),ee(hr,{key:0,modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=d=>r("updateValue",d)),fields:l.fields,class:"field-btn",filter:l.filter,buttonProps:{type:"primary",link:!0,size:"large"}},null,8,["modelValue","fields","filter"])):Xe("",!0)],544))}});const xx=Tt(Ax,[["__scopeId","data-v-232e2695"]]),Rx=Ce({__name:"DragRow",props:{mergeFields:{},pFields:{},pId:{}},emits:["update:mergeFields"],setup(e,{emit:t}){const n=e,r=t,o=Ee({get(){return n.mergeFields.map(m=>{const v=Object.keys(m.mergeFieldId).find(b=>b===n.pId);return v?{...n.pFields.filter(w=>w.fieldId===m.mergeFieldId[v])[0],fieldParentId:m.fieldId}:{fieldId:"",fieldType:m.fieldType,fieldParentId:m.fieldId}})},set(h){const m=n.mergeFields.map((v,b)=>{const w=h[b];return w&&(v.mergeFieldId[n.pId]=w.fieldId),v});r("update:mergeFields",[...m])}}),a=Ee(()=>(o.value.filter(m=>m.fieldId)??[]).length>1),i=vn(),s=Ee(()=>i.batchGetInfosByFields(n.pFields)),l=(h,m)=>{const v=In(n.mergeFields.map(b=>b.mergeFieldId[n.pId]));return m.filter(b=>b.type===h&&!v.includes(b.fieldId))},u=(h,m)=>{n.mergeFields.forEach(v=>{v.fieldId===h.fieldParentId&&(v.mergeFieldId[n.pId]=m)})},d=h=>{n.mergeFields.forEach(m=>{m.fieldId===h.fieldParentId&&delete m.mergeFieldId[n.pId]})},c=(h,m)=>{d(h),setTimeout(()=>{u(m,h.fieldId)},0)},f=(h,m)=>h.fieldType===m.fieldType;return(h,m)=>(D(),Ie("div",{class:"drag-row"},[(D(!0),Ie(dt,null,It(o.value,v=>(D(),Ie("div",{key:v.fieldId},[Te("div",{class:"drag-cell"},[v.fieldId?(D(),ee(wx,{key:0,"is-del":a.value,"field-info":v,onDel:b=>d(v)},null,8,["is-del","field-info","onDel"])):(D(),ee(xx,{key:1,validations:b=>f(b,v),fields:s.value,onUpdateValue:b=>u(v,b),filter:b=>l(v.fieldType,b),onDropCallback:b=>c(b,v)},null,8,["validations","fields","onUpdateValue","filter","onDropCallback"]))])]))),128))]))}});const Cx=Tt(Rx,[["__scopeId","data-v-080032aa"]]),Nx=Ce({__name:"DragAddField",props:{fields:{},rowName:{},pId:{},mergeFields:{}},setup(e){const t=e,n=Ee({get(){return t.mergeFields.reduce((l,u)=>{const d=u.mergeFieldId[t.pId];return d&&l.push(d),l},[])},set(s){t.mergeFields.forEach(u=>{s.includes(u.mergeFieldId[t.pId])||delete u.mergeFieldId[t.pId]});const l=t.mergeFields.reduce((u,d)=>{const c=d.mergeFieldId[t.pId];return c&&u.push(c),u},[]);s.forEach(u=>{if(!l.includes(u)){const d=t.fields.find(c=>c.fieldId===u);if(d){const{entryId:c,modelId:f,connectionId:h,...m}=d,v={...m,fieldId:za(d.fieldType),name:ql(d),mergeFieldId:{[t.pId]:d.fieldId}};t.mergeFields.push(v)}}})}}),r=Ee(()=>n.value.length>1?[]:[...n.value]),o=vn(),a=Ee(()=>{const s=t.fields??[];return o.batchGetInfosByFields(s)}),i=we(!1);return Ln(()=>{setTimeout(()=>{i.value=!0},300)}),kp(()=>{i.value=!1}),(s,l)=>(D(),Ie("div",{class:"left-box"},[E(fo,{style:{flex:"1"},content:s.rowName},null,8,["content"]),i.value?(D(),ee(hr,{key:0,modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=u=>n.value=u),fields:a.value,style:{"flex-shrink":"0",width:"20px"},ref:"selectFieldRef",placeholder:"",displayFields:r.value,buttonProps:{type:"primary",link:!0,icon:x(wu)},multiple:""},null,8,["modelValue","fields","displayFields","buttonProps"])):Xe("",!0)]))}});const Ox=Tt(Nx,[["__scopeId","data-v-2c8f929f"]]),Fx=Ce({__name:"DragEditName",props:{info:{},width:{default:"91px"},isIcon:{type:Boolean,default:!0}},emits:["update:info"],setup(e,{emit:t}){const n=e,r=t,o=we(!0),a=Ee(()=>n.info.alias?n.info.alias:n.info.comment),i=Ee(()=>{const f=[ft.accumulate,ft.sort,ft.compute].includes(n.info.fieldType)?ft.compute:n.info.fieldType;return Iu(f)}),s=we(""),l=()=>{const c=n.info;c.alias=s.value,r("update:info",c),o.value=!0},u=we(),d=()=>{o.value=!1,s.value=a.value,Fr(()=>{var c;(c=u.value)==null||c.focus()})};return(c,f)=>{const h=Lt,m=Cn,v=Eu;return D(),Ie("div",{class:"edit-box"},[Te("span",{class:"icon mr-5"},[E(yn,{"icon-class":i.value},null,8,["icon-class"])]),E(fo,{style:{flex:"1",width:"70px"},class:"header-name",content:a.value},null,8,["content"]),E(v,{teleported:"",onShow:d,placement:"bottom",width:200,trigger:"click"},{reference:F(()=>[E(h,{class:"edit",icon:x(so),link:"",onClick:f[0]||(f[0]=io(()=>{},["stop","prevent"]))},null,8,["icon"])]),default:F(()=>[E(m,{ref_key:"ElInputRef",ref:u,class:"header-name",modelValue:s.value,"onUpdate:modelValue":f[1]||(f[1]=b=>s.value=b),onBlur:l,onKeyup:qa(l,["enter"]),placeholder:"请输入字段名称"},null,8,["modelValue","onKeyup"])]),_:1})])}}});const Lx=Tt(Fx,[["__scopeId","data-v-b3a1d499"]]),Mx=Ce({__name:"DragTable",props:{pFields:{},mergeFields:{}},emits:["update:mergeFields"],setup(e,{emit:t}){const o=sn(e,"mergeFields",t);return Au(()=>{o.value=o.value.filter(a=>Object.keys(a.mergeFieldId).length!==0)}),(a,i)=>(D(),Ie("div",{class:"layoutWrapper"},[Te("div",{class:"layoutWrapper-aside"},[Te("div",{class:"aside"},[Te("div",{class:"cell"},"合并字段"),Te("div",{class:"aside-field"},[(D(!0),Ie(dt,null,It(a.pFields,s=>(D(),ee(Ox,{class:"cell",key:s.pId,"row-name":s.pNodeName,fields:s.fields,"p-id":s.pId,"merge-fields":x(o),"onUpdate:mergeFields":i[0]||(i[0]=l=>wt(o)?o.value=l:null)},null,8,["row-name","fields","p-id","merge-fields"]))),128))])])]),Te("div",{class:"layoutWrapper-main"},[E(x(xu),Su({tag:"div",list:x(o),animation:"300","item-key":"fieldId",class:"header",handle:".drag"},a.$attrs),{item:F(({element:s})=>[Te("div",{class:"drag header-cell"},[E(Lx,{info:s},null,8,["info"])])]),_:1},16,["list"]),Te("div",{class:"body"},[(D(!0),Ie(dt,null,It(a.pFields,s=>(D(),Ie("div",{class:"body-row",key:s.pId},[E(Cx,{"merge-fields":x(o),"onUpdate:mergeFields":i[1]||(i[1]=l=>wt(o)?o.value=l:null),"p-fields":s.fields,"p-id":s.pId},null,8,["merge-fields","p-fields","p-id"])]))),128))])])]))}});const Dx=Tt(Mx,[["__scopeId","data-v-d8ff452b"]]),Px=Ce({__name:"Setting",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=$t(),a=sn(n,"modelValue",r),{getNodeFields:i}=Ur(),s=Ee(()=>i()??[]);return Ln(()=>{const l=Et(n.modelValue.mergeFields);if(l.length>=1){const u=s.value.map(f=>f.fields.map(h=>h.fieldId)).flat(),d=s.value.map(f=>f.pId).flat(),c=l.reduce((f,h)=>{const m=Et(h.mergeFieldId);Object.keys(m).forEach(b=>{(!d.includes(b)||!u.includes(m[b]))&&delete m[b]});const v={...h,mergeFieldId:m};return[...f,v]},[]).filter(f=>!Sy(f.mergeFieldId));a.value.mergeFields=Et(c)}else{const u=[];s.value.forEach(d=>{const c=u.map(f=>Object.values(f.mergeFieldId)).flat();d.fields.forEach(f=>{if(!c.includes(f.fieldId)){const h=u.findIndex(L=>{const z=L.alias??L.comment,K=L.fieldType,he=f.alias??f.comment,Fe=f.fieldType;return z===he&&K===Fe}),{entryId:m,connectionId:v,modelId:b,...w}=f;if(h===-1)u.push({...w,fieldId:za(f.fieldType),name:ql(f),mergeFieldId:{[d.pId]:f.fieldId}});else{const L=u[h];Object.keys(L.mergeFieldId).includes(d.pId)?u.push({...w,fieldId:za(f.fieldType),name:ql(f),mergeFieldId:{[d.pId]:f.fieldId}}):L.mergeFieldId={...L.mergeFieldId,[d.pId]:f.fieldId}}}})}),a.value.mergeFields=Et(u)}a.value.input=s.value.map(u=>u.pId)}),(l,u)=>{const d=Ru,c=fs;return D(),ee(yr,{modelValue:x(a),"onUpdate:modelValue":u[2]||(u[2]=f=>wt(a)?a.value=f:null),"default-active":"set"},{set:F(()=>[Te("div",{class:"dataMerge-box"},[Te("div",{class:"setM"},[Te("span",null,"设置合并方式"),E(c,{modelValue:x(a).mergeType,"onUpdate:modelValue":u[0]||(u[0]=f=>x(a).mergeType=f),style:{"margin-left":"15px"}},{default:F(()=>[E(d,{label:"append",border:""},{default:F(()=>[St("追加合并")]),_:1})]),_:1},8,["modelValue"])]),E(Dx,{mergeFields:x(a).mergeFields,"onUpdate:mergeFields":u[1]||(u[1]=f=>x(a).mergeFields=f),style:{flex:"1"},pFields:s.value},null,8,["mergeFields","pFields"])])]),preview:F(({isPreview:f})=>[x(o).selectNode&&f?(D(),ee(Gr,{key:0,ref:"PreviewTableDataRef","cur-fields":x(a).mergeFields,id:x(o).selectNode.id},null,8,["cur-fields","id"])):Xe("",!0)]),_:1},8,["modelValue"])}}});const kx=Tt(Px,[["__scopeId","data-v-74dd198f"]]),Vx=Object.freeze(Object.defineProperty({__proto__:null,default:kx},Symbol.toStringTag,{value:"Module"})),Bx=Ce({__name:"FieldAlias",props:{info:{},width:{default:"75px"},isIcon:{type:Boolean,default:!1}},emits:["update:info"],setup(e,{expose:t,emit:n}){const r=e,o=n,a=Ee(()=>r.info.alias?r.info.alias:r.info.comment),i=we(!0),s=we(""),l=we(),u=()=>{i.value=!1,s.value=a.value,Fr(()=>{var f;(f=l.value)==null||f.focus()})},d=Ee(()=>{const h=[ft.accumulate,ft.sort,ft].includes(r.info.fieldType)?ft.compute:r.info.fieldType;return Iu(h)}),c=()=>{const f=r.info;f.alias=s.value,o("update:info",f),i.value=!0};return t({openEdit:u}),(f,h)=>{const m=Cn;return D(),Ie("div",{class:"header-title"},[Te("span",{class:"header-icon"},[f.isIcon&&i.value?(D(),ee(yn,{key:0,"icon-class":d.value},null,8,["icon-class"])):Xe("",!0)]),i.value?(D(),ee(fo,{key:0,style:Wo({width:f.width}),class:"header-name",content:a.value},null,8,["style","content"])):(D(),ee(m,{key:1,ref_key:"ElInputRef",ref:l,class:"header-name",modelValue:s.value,"onUpdate:modelValue":h[0]||(h[0]=v=>s.value=v),onBlur:c,onKeyup:qa(c,["enter"]),placeholder:"请输入字段名称"},null,8,["modelValue","onKeyup"]))])}}});const Cm=Tt(Bx,[["__scopeId","data-v-9f5c2283"]]),Nm=Ce({__name:"Compute",props:{visible:{type:Boolean},fieldInfo:{},formFields:{}},emits:["update:visible","add","edit"],setup(e,{emit:t}){const n=e,r=t,o=Dr(n,"visible",r),a=we(),i=Ee(()=>n.fieldInfo?"修改计算字段":"添加计算字段"),s=v=>(n.fieldInfo?"edit":"add")===v,l=we(xr({fieldType:ft.compute})),u=Mn({comment:[{required:!0,message:"请输入字段名称",trigger:"blur"},{min:2,max:15,message:"字段名称长度在2-15个字符",trigger:"blur"}],type:[{required:!0,message:"请选择字段类型",trigger:"blur"}],mode:[{required:!0,message:"请添加计算公式",trigger:"blur"}]}),d=Ee({get(){return l.value.mode},set(v){l.value.mode=v}}),c=[{label:"文本",value:Ft.string},{label:"数字",value:Ft.int},{label:"日期",value:Ft.dateTime}],f=()=>{s("add")?l.value=xr({fieldType:ft.compute}):l.value=Et(n.fieldInfo??xr({fieldType:ft.compute}))},h=async()=>{var v;await((v=a.value)==null?void 0:v.validate()),s("add")?r("add",l.value):r("edit",l.value)},m=async()=>{o.value=!1};return(v,b)=>{const w=Cn,L=Xt,z=Pr,K=Wn,he=pr,Fe=kr,Oe=ra,at=aa;return D(),ee(at,{modelValue:x(o),"onUpdate:modelValue":b[3]||(b[3]=ke=>wt(o)?o.value=ke:null),onOpened:f,title:i.value,width:"800"},{footer:F(()=>[E(ps,{"on-submit":h,editMode:"",onClose:m})]),default:F(()=>[E(Oe,{ref_key:"ruleFormRef",ref:a,model:l.value,rules:u,"label-width":"auto","status-icon":""},{default:F(()=>[E(Fe,{style:{"margin-bottom":"18px"}},{default:F(()=>[E(z,{span:11},{default:F(()=>[E(L,{label:"字段名称",prop:"comment"},{default:F(()=>[E(w,{modelValue:l.value.comment,"onUpdate:modelValue":b[0]||(b[0]=ke=>l.value.comment=ke)},null,8,["modelValue"])]),_:1})]),_:1}),E(z,{span:2}),E(z,{span:11},{default:F(()=>[E(L,{label:"字段类型",prop:"type"},{default:F(()=>[E(he,{modelValue:l.value.type,"onUpdate:modelValue":b[1]||(b[1]=ke=>l.value.type=ke),placeholder:"请选择字段类型",style:{width:"100%"}},{default:F(()=>[(D(),Ie(dt,null,It(c,ke=>E(K,{key:ke.value,label:ke.label,value:ke.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),E(L,{label:"计算公式",prop:"mode"},{default:F(()=>[E(Bg,{scenes:[x(eg).serverTextFn],group:[{id:"key2024",fieldOptions:{fields:v.formFields}}],modelValue:d.value,"onUpdate:modelValue":b[2]||(b[2]=ke=>d.value=ke),mode:x(tg).server},null,8,["scenes","group","modelValue","mode"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Om=Ce({__name:"GroupTable",props:{formFields:{},modelValue:{},label:{default:"分组字段"},maxH:{default:"200px"}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=(d,c,f,h)=>{const m=n.formFields.find(v=>v.fieldId===f);return(m==null?void 0:m.options.label)??f},a=[Ge.date,Ge.daterange,Ge.time,Ge.timerange],i=Ee({get(){return n.modelValue.map(d=>d.name)},set(d){const c=n.formFields,f=d.map(h=>{const m=n.modelValue.find(b=>b.name===h);if(m)return m;const v=c.find(b=>b.fieldId===h);return a.includes(v==null?void 0:v.type)?{name:(v==null?void 0:v.fieldId)??"",category:"YEAR"}:{name:(v==null?void 0:v.fieldId)??""}});r("update:modelValue",f)}}),s=Mn([{label:"年",value:"YEAR"},{label:"年-周",value:"YEAR_WEEK"},{label:"年-季",value:"YEAR_QUARTER"},{label:"年-月",value:"YEAR_MONTH"},{label:"年-月-日",value:"YEAR_DAY"}]),l=d=>{const c=n.modelValue.filter(f=>f.name!==d);r("update:modelValue",c)},u=d=>{const c=n.formFields.find(f=>f.fieldId===d);return c?a.includes(c.type):!1};return ti({classKey:".GroupTable_dragTable",triggerKey:".drag",onEnd:({newIndex:d,oldIndex:c})=>{const f=n.modelValue,h=f.splice(c,1)[0];f.splice(d,0,h),r("update:modelValue",[...f])}}),(d,c)=>{const f=Xt,h=dr,m=Wn,v=pr,b=Lt,w=Mr;return D(),Ie("div",null,[E(f,{label:d.label,required:""},{default:F(()=>[Te("div",{style:{width:"100%",display:"flex","justify-content":"right"}},[E(hr,{style:{width:"120px"},modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=L=>i.value=L),ref:"buttonSelectFieldRef",placeholder:"添加分类字段",fields:d.formFields,multiple:"",buttonProps:{type:"primary"}},null,8,["modelValue","fields"])])]),_:1},8,["label"]),E(w,{class:"GroupTable_dragTable",data:d.modelValue,style:{width:"100%"},"row-key":"name","max-height":d.maxH},{default:F(()=>[E(h,{prop:"name",formatter:o,label:"字段名称"}),E(h,{prop:"category",label:"分类方式",width:"250"},{default:F(L=>[u(L.row.name)?(D(),ee(v,{key:0,size:"small",modelValue:L.row[L.column.property],"onUpdate:modelValue":z=>L.row[L.column.property]=z,placeholder:"请选择分类方式"},{default:F(()=>[(D(!0),Ie(dt,null,It(s,z=>(D(),ee(m,{key:z.value,label:z.label,value:z.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):Xe("",!0)]),_:1}),E(h,{label:"",width:"80"},{default:F(({row:L})=>[E(b,{link:"",icon:x(oa),class:"drag"},null,8,["icon"]),E(b,{type:"danger",link:"",icon:x(Lr),onClick:z=>l(L.name)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data","max-height"])])}}}),Fm=Ce({__name:"CalcTable",props:{formFields:{},modelValue:{},sortLabel:{},sortLabelAdd:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=(u,d,c,f)=>{const h=n.formFields.find(m=>m.fieldId===c);return(h==null?void 0:h.options.label)??c},a=Ee({get(){return n.modelValue.map(u=>u.name)},set(u){const d=n.formFields,c=u.map(f=>{const h=n.modelValue.find(v=>v.name===f);if(h)return h;const m=d.find(v=>v.fieldId===f);return{name:(m==null?void 0:m.fieldId)??"",sort:"asc"}});r("update:modelValue",c)}}),i=Mn([{label:"升序",value:"asc"},{label:"降序",value:"desc"}]),s=u=>{const d=n.modelValue.filter(c=>c.name!==u);r("update:modelValue",d)},l=u=>{const d=[Ge.number,Ge.date,Ge.daterange,Ge.time,Ge.timerange,Ge.compute];return u.filter(c=>d.includes(c.type))};return ti({classKey:".SortTable_dragTable",triggerKey:".drag",onEnd:({newIndex:u,oldIndex:d})=>{const c=n.modelValue,f=c.splice(d,1)[0];c.splice(u,0,f),r("update:modelValue",[...c])}}),(u,d)=>{const c=Xt,f=dr,h=Wn,m=pr,v=Lt,b=Mr;return D(),Ie("div",null,[E(c,{label:u.sortLabel,required:""},{default:F(()=>[Te("div",{style:{width:"100%",display:"flex","justify-content":"right"}},[E(hr,{style:{width:"120px"},modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=w=>a.value=w),ref:"buttonSelectFieldRef",placeholder:u.sortLabelAdd,filter:l,fields:u.formFields,multiple:"",buttonProps:{type:"primary"}},null,8,["modelValue","placeholder","fields"])])]),_:1},8,["label"]),E(b,{class:"SortTable_dragTable",data:u.modelValue,style:{width:"100%"},"max-height":"200px","row-key":"name"},{default:F(()=>[E(f,{prop:"name",formatter:o,label:"字段名称"}),E(f,{prop:"sort",label:"排序方式",width:"250"},{default:F(w=>[E(m,{size:"small",modelValue:w.row[w.column.property],"onUpdate:modelValue":L=>w.row[w.column.property]=L,placeholder:"Select"},{default:F(()=>[(D(!0),Ie(dt,null,It(i,L=>(D(),ee(h,{key:L.value,label:L.label,value:L.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),E(f,{label:"",width:"80"},{default:F(({row:w})=>[E(v,{link:"",icon:x(oa),class:"drag"},null,8,["icon"]),E(v,{type:"danger",link:"",icon:x(Lr),onClick:L=>s(w.name)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])}}}),Lm=Ce({__name:"Sort",props:{visible:{type:Boolean},fieldInfo:{},formFields:{}},emits:["update:visible","add","edit"],setup(e,{emit:t}){const n=e,r=t,o=Dr(n,"visible",r),{isFlowMode:a}=_o(),i=we(),s=Ee(()=>n.fieldInfo?"修改排名字段":"添加排名字段"),l=w=>(n.fieldInfo?"edit":"add")===w,u=()=>a.value?xr({fieldType:ft.sort,mode:Et(d),topN:1e3}):xr({fieldType:ft.sort,mode:Et(d)}),d={rankField:[],groupField:[]},c=we(u()),f=Mn({comment:[{required:!0,message:"请输入字段名称",trigger:"blur"},{min:2,max:15,message:"字段名称长度在2-15个字符",trigger:"blur"}],type:[{required:!0,message:"请选择字段类型",trigger:"blur"}],mode:[{required:!0,message:"请添加计算公式",trigger:"blur"}]}),h=Ee({get(){return c.value.mode},set(w){c.value.mode=w}}),m=()=>{l("add")?c.value=u():c.value=Et(n.fieldInfo??u())},v=async()=>{var w;await((w=i.value)==null?void 0:w.validate()),l("add")?r("add",c.value):r("edit",c.value)},b=async()=>{o.value=!1};return(w,L)=>{const z=Cn,K=Xt,he=Ug,Fe=ra,Oe=aa;return D(),ee(Oe,{modelValue:x(o),"onUpdate:modelValue":L[4]||(L[4]=at=>wt(o)?o.value=at:null),onOpened:m,title:s.value,width:"600","append-to-body":""},{footer:F(()=>[E(ps,{"on-submit":v,editMode:"",onClose:b})]),default:F(()=>[E(Fe,{style:{height:"500px"},ref_key:"ruleFormRef",ref:i,"label-suffix":":",model:c.value,rules:f},{default:F(()=>[E(K,{label:"字段名称",prop:"comment"},{default:F(()=>[E(z,{modelValue:c.value.comment,"onUpdate:modelValue":L[0]||(L[0]=at=>c.value.comment=at),placeholder:"请输入字段名称"},null,8,["modelValue"])]),_:1}),x(jo)(c.value.topN)?(D(),ee(K,{key:0,label:"排名数",required:""},{default:F(()=>[E(he,{style:{width:"100%"},modelValue:c.value.topN,"onUpdate:modelValue":L[1]||(L[1]=at=>c.value.topN=at),min:1,"controls-position":"right",placeholder:"请输入排名数"},null,8,["modelValue"])]),_:1})):Xe("",!0),E(Fm,{"form-fields":w.formFields,modelValue:h.value.rankField,"onUpdate:modelValue":L[2]||(L[2]=at=>h.value.rankField=at),style:{"margin-bottom":"18px"},"sort-label":"排名规则","sort-label-add":"添加排名规则"},null,8,["form-fields","modelValue"]),E(Om,{"form-fields":w.formFields,modelValue:h.value.groupField,"onUpdate:modelValue":L[3]||(L[3]=at=>h.value.groupField=at)},null,8,["form-fields","modelValue"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Mm=Ce({__name:"Accumulate",props:{visible:{type:Boolean},fieldInfo:{},formFields:{}},emits:["update:visible","add","edit"],setup(e,{emit:t}){const n=e,r=t,o=Dr(n,"visible",r),a=we(),i=Ee(()=>n.fieldInfo?"修改累加汇总字段":"添加累加汇总字段"),s=b=>(n.fieldInfo?"edit":"add")===b,l={accrualType:[],groupField:[],accrualFieldId:""},u=we(xr({fieldType:ft.accumulate,mode:Et(l)})),d=Mn({comment:[{required:!0,message:"请输入字段名称",trigger:"blur"},{min:2,max:15,message:"字段名称长度在2-15个字符",trigger:"blur"}],type:[{required:!0,message:"请选择字段类型",trigger:"blur"}],mode:[{required:!0,message:"请添加计算公式",trigger:"blur"}],"mode.accrualFieldId":[{required:!0,message:"请选择字段类型",trigger:"blur"}]}),c=Ee({get(){return u.value.mode},set(b){u.value.mode=b}}),f=()=>{s("add")?u.value=xr({fieldType:ft.accumulate,mode:Et(l)}):u.value=Et(n.fieldInfo??xr({fieldType:ft.accumulate,mode:Et(l)}))},h=async()=>{var b;await((b=a.value)==null?void 0:b.validate()),s("add")?r("add",u.value):r("edit",u.value)},m=async()=>{o.value=!1},v=b=>{const w=[Ge.number,Ge.compute];return b.filter(L=>w.includes(L.type))};return(b,w)=>{const L=Cn,z=Xt,K=ra,he=aa;return D(),ee(he,{modelValue:x(o),"onUpdate:modelValue":w[4]||(w[4]=Fe=>wt(o)?o.value=Fe:null),onOpened:f,title:i.value,width:"600","append-to-body":""},{footer:F(()=>[E(ps,{"on-submit":h,editMode:"",onClose:m})]),default:F(()=>[E(K,{ref_key:"ruleFormRef",ref:a,"label-suffix":":",model:u.value,rules:d},{default:F(()=>[E(z,{label:"字段名称",prop:"comment"},{default:F(()=>[E(L,{modelValue:u.value.comment,"onUpdate:modelValue":w[0]||(w[0]=Fe=>u.value.comment=Fe),placeholder:"请输入字段名称"},null,8,["modelValue"])]),_:1}),E(z,{label:"累加字段",prop:"mode.accrualFieldId"},{default:F(()=>[E(Yi,{modelValue:c.value.accrualFieldId,"onUpdate:modelValue":w[1]||(w[1]=Fe=>c.value.accrualFieldId=Fe),fields:b.formFields,filter:v},null,8,["modelValue","fields"])]),_:1}),E(Fm,{"form-fields":b.formFields,modelValue:c.value.accrualType,"onUpdate:modelValue":w[2]||(w[2]=Fe=>c.value.accrualType=Fe),style:{"margin-bottom":"18px"},"sort-label":"累加顺序","sort-label-add":"添加累加顺序"},null,8,["form-fields","modelValue"]),E(Om,{"form-fields":b.formFields,modelValue:c.value.groupField,"onUpdate:modelValue":w[3]||(w[3]=Fe=>c.value.groupField=Fe)},null,8,["form-fields","modelValue"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ux=Ce({__name:"SetField",props:{fields:{}},emits:["update:fields"],setup(e,{emit:t}){const n=e,r=t,o=we();ti({classKey:".fieldSetting_dragTable",triggerKey:".drag",onEnd:({newIndex:L,oldIndex:z})=>{const K=n.fields,he=K.splice(z,1)[0];K.splice(L,0,he),r("update:fields",Et(K))}});const a=we({}),i=(L,z)=>{a.value[z]=L},s=L=>{var z;(z=a.value[L])==null||z.openEdit()},l=vn(),u=Ee(()=>{const L=(n.fields??[]).filter(z=>z.calcType===Ua.field);return l.batchGetInfosByFields(L)});Ee(()=>{const L=n.fields??[];return l.batchGetInfosByFields(L)});const d=we(),c=we(!1),f=we(!1),h=we(!1),m=L=>{switch(L){case ft.compute:c.value=!0;break;case ft.sort:f.value=!0;break;case ft.accumulate:h.value=!0;break}},v=L=>{d.value=L,m(L.calcType)},b=L=>{const z=n.fields,K=z.findIndex(he=>he.fieldId===L.fieldId);z.splice(K,1,L),r("update:fields",z)},w=L=>{const z=n.fields.filter(K=>K.fieldId!==L);r("update:fields",Et([...z]))};return(L,z)=>{const K=Lt,he=ng;return D(),Ie("section",null,[E(x(Mr),{class:"fieldSetting_dragTable",ref_key:"tableRef",ref:o,data:L.fields,style:{width:"100%"},"max-height":"440px",key:"tableKey22","row-key":"fieldId"},{default:F(()=>[E(x(dr),{label:"字段名称"},{default:F(({row:Fe})=>[(D(),ee(Cm,{width:"300px",key:Fe.fieldId,info:Fe,ref:Oe=>i(Oe,Fe.fieldId)},null,8,["info"]))]),_:1}),E(x(dr),{label:"操作",width:"150"},{default:F(({row:Fe})=>[E(K,{link:"",icon:x(oa),class:"drag"},null,8,["icon"]),Fe.calcType===x(Ua).field?(D(),ee(K,{key:0,link:"",icon:x(so),onClick:Oe=>s(Fe.fieldId)},null,8,["icon","onClick"])):(D(),ee(K,{key:1,link:"",icon:x(so),onClick:Oe=>v(Fe)},null,8,["icon","onClick"])),Fe.calcType===x(Ua).field?(D(),ee(K,{key:2,link:"",icon:x(zp),onClick:Oe=>w(Fe.fieldId)},null,8,["icon","onClick"])):(D(),ee(he,{key:3,title:"确定删除该字段吗?",onConfirm:Oe=>w(Fe.fieldId)},{reference:F(()=>[E(K,{link:"",icon:x(Lr)},null,8,["icon"])]),_:2},1032,["onConfirm"]))]),_:1})]),_:1},8,["data"]),E(Nm,{visible:c.value,"onUpdate:visible":z[0]||(z[0]=Fe=>c.value=Fe),"field-info":d.value,formFields:u.value,onEdit:b},null,8,["visible","field-info","formFields"]),E(Lm,{visible:f.value,"onUpdate:visible":z[1]||(z[1]=Fe=>f.value=Fe),"field-info":d.value,formFields:u.value,onEdit:b},null,8,["visible","field-info","formFields"]),E(Mm,{visible:h.value,"onUpdate:visible":z[2]||(z[2]=Fe=>h.value=Fe),"field-info":d.value,formFields:u.value,onEdit:b},null,8,["visible","field-info","formFields"])])}}}),Gx=Ce({__name:"AddField",props:{selectFields:{},fields:{}},emits:["update:selectFields"],setup(e,{emit:t}){const n=e,r=t,o=vn(),a=Ee(()=>o.batchGetInfosByFields(n.fields??[])),i=Ee({get(){return n.selectFields.map(s=>s.fieldId)},set(s){const l=In(s.map(u=>{const d=n.selectFields.find(f=>f.fieldId===u);if(d)return d;const c=n.fields.find(f=>f.fieldId===u);if(c)return{...c,calcType:Ua.field}}));r("update:selectFields",l)}});return(s,l)=>(D(),ee(hr,{style:{width:"120px"},modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=u=>i.value=u),ref:"buttonSelectFieldRef",placeholder:"添加字段",fields:a.value,multiple:""},null,8,["modelValue","fields"]))}}),jx=Ce({__name:"AddCalcField",props:{fields:{}},emits:["update:fields"],setup(e,{emit:t}){const n=e,r=t,o=vn(),{isBatchMode:a,isFlowMode:i}=_o(),s=Ee(()=>{const h=(n.fields??[]).filter(m=>m.calcType===ka.field);return o.batchGetInfosByFields(h)}),l=we(!1),u=we(!1),d=we(!1),c=h=>{switch(h){case ft.compute:l.value=!0;break;case ft.sort:i.value&&n.fields.some(v=>v.calcType===ka.sort)?Ko.warning("只能添加一个排名字段"):u.value=!0;break;case ft.accumulate:d.value=!0;break}},f=h=>{r("update:fields",[...n.fields,h])};return(h,m)=>{const v=Lt,b=Gg,w=jg,L=zg;return D(),Ie("div",{class:"ml-15"},[E(L,{onCommand:c},{dropdown:F(()=>[E(w,null,{default:F(()=>[E(b,{command:x(ft).compute},{default:F(()=>[St(" 公式计算字段 ")]),_:1},8,["command"]),E(b,{command:x(ft).sort},{default:F(()=>[St(" 排名字段 ")]),_:1},8,["command"]),x(a)?(D(),ee(b,{key:0,command:x(ft).accumulate},{default:F(()=>[St(" 累加汇总字段 ")]),_:1},8,["command"])):Xe("",!0)]),_:1})]),default:F(()=>[E(v,{onClick:m[0]||(m[0]=io(()=>{},["stop"])),icon:x(wu)},{default:F(()=>[St("添加计算字段")]),_:1},8,["icon"])]),_:1}),E(Nm,{visible:l.value,"onUpdate:visible":m[1]||(m[1]=z=>l.value=z),formFields:s.value,onAdd:f},null,8,["visible","formFields"]),E(Lm,{visible:u.value,"onUpdate:visible":m[2]||(m[2]=z=>u.value=z),formFields:s.value,onAdd:f},null,8,["visible","formFields"]),E(Mm,{visible:d.value,"onUpdate:visible":m[3]||(m[3]=z=>d.value=z),formFields:s.value,onAdd:f},null,8,["visible","formFields"])])}}}),zx=Ce({__name:"Setting",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=$t(),a=sn(n,"modelValue",r),i=Ee({get(){return a.value.fieldSetting},set(u){a.value.fieldSetting=u,r("update:modelValue",{...a.value,fieldSetting:u})}}),{getNodeFields:s}=Ur(),l=Ee(()=>{var d;const u=(d=s())==null?void 0:d[0];return(u==null?void 0:u.fields)??[]});return Ln(()=>{const u=n.modelValue.fieldSetting;if(u.length>=1){const d=l.value.map(f=>f.fieldId),c=u.filter(f=>d.includes(f.fieldId));a.value.fieldSetting=Et(c)}else a.value.fieldSetting=l.value.map(d=>({...d,calcType:"calcType"in d?d.calcType:Ua.field}))}),(u,d)=>{const c=Xt;return D(),ee(yr,{modelValue:x(a),"onUpdate:modelValue":d[3]||(d[3]=f=>wt(a)?a.value=f:null),"default-active":"set"},{set:F(()=>[E(c,{label:"字段设置",prop:"fieldSetting"},{default:F(()=>[Te("div",null,[Te("div",{class:"field-flex"},[E(Gx,{fields:l.value,"select-fields":x(a).fieldSetting,"onUpdate:selectFields":d[0]||(d[0]=f=>x(a).fieldSetting=f)},null,8,["fields","select-fields"]),E(jx,{fields:x(a).fieldSetting,"onUpdate:fields":d[1]||(d[1]=f=>x(a).fieldSetting=f)},null,8,["fields"])]),E(Ux,{fields:i.value,"onUpdate:fields":d[2]||(d[2]=f=>i.value=f),style:{width:"540px"}},null,8,["fields"])])]),_:1})]),preview:F(({isPreview:f})=>[x(o).selectNode&&f?(D(),ee(Gr,{key:0,ref:"PreviewTableDataRef","cur-fields":x(a).fieldSetting,id:x(o).selectNode.id},null,8,["cur-fields","id"])):Xe("",!0)]),_:1},8,["modelValue"])}}});const $x=Tt(zx,[["__scopeId","data-v-167a20b1"]]),Xx=Object.freeze(Object.defineProperty({__proto__:null,default:$x},Symbol.toStringTag,{value:"Module"})),Hx=Ce({__name:"JoinHeader",props:{leftId:{},rightId:{},options:{},isDisTable:{type:Boolean}},emits:["update:leftId","update:rightId","change"],setup(e,{emit:t}){const n=e,r=t,{leftId:o,rightId:a}=rg(n,r),i=l=>{const u=n.options.filter(d=>d.pId!==l)[0];a.value===l&&(a.value=u.pId),r("change")},s=l=>{const u=n.options.filter(d=>d.pId!==l)[0];o.value===l&&(o.value=u.pId),r("change")};return(l,u)=>{const d=Wn,c=pr,f=Pr,h=kr;return D(),ee(h,{gutter:0},{default:F(()=>[E(f,{span:11},{default:F(()=>[Te("div",{class:"join-header"},[Te("span",{class:"join-header_label"},"左侧表："),E(c,{disabled:l.isDisTable,modelValue:x(o),"onUpdate:modelValue":u[0]||(u[0]=m=>wt(o)?o.value=m:null),onChange:i,class:"select-w"},{default:F(()=>[(D(!0),Ie(dt,null,It(l.options,m=>(D(),ee(d,{key:m.pId,label:m.pNodeName,value:m.pId},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])])]),_:1}),E(f,{span:1}),E(f,{span:11},{default:F(()=>[Te("div",{class:"join-header"},[Te("span",{class:"join-header_label"},"右侧表："),E(c,{disabled:l.isDisTable,modelValue:x(a),"onUpdate:modelValue":u[1]||(u[1]=m=>wt(a)?a.value=m:null),onChange:s,class:"select-w"},{default:F(()=>[(D(!0),Ie(dt,null,It(l.options,m=>(D(),ee(d,{key:m.pId,label:m.pNodeName,value:m.pId},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])])]),_:1}),E(f,{span:1})]),_:1})}}});const Wx=Tt(Hx,[["__scopeId","data-v-6d304e8d"]]),Yx=Ce({__name:"SelectField",props:{modelValue:{},fields:{},type:{},dir:{default:"l"}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=Ee(()=>({"--event-flow-border-color":n.dir==="l"?"#A6C5F6":"#8FE6CD"})),a=Dr(n,"modelValue",r),i=vn(),s=Ee(()=>i.batchGetInfosByFields(n.fields));return(l,u)=>(D(),ee(Yi,{class:"select-field--border",style:Wo(o.value),modelValue:x(a),"onUpdate:modelValue":u[0]||(u[0]=d=>wt(a)?a.value=d:null),placeholder:"选择字段",fields:s.value},null,8,["style","modelValue","fields"]))}});const Fp=Tt(Yx,[["__scopeId","data-v-c35ad6b2"]]),Kx=Ce({__name:"JoinCondition",props:{modelValue:{},options:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,o=sn(n,"modelValue",t),{isFlowMode:a}=_o(),i=we(!1);Ln(()=>{if(n.options.length>=1&&!o.value.rightTable&&!o.value.leftTable)if(a.value){const c=n.options.filter(f=>f.pType===Ct.dataInput);c.length>1?(o.value.leftTable=n.options[0].pId,o.value.rightTable=n.options[1].pId,i.value=!1):(o.value.leftTable=n.options.filter(f=>f.pId!==c[0].pId)[0].pId,o.value.rightTable=c[0].pId,i.value=!0)}else o.value.leftTable=n.options[0].pId,o.value.rightTable=n.options[1].pId,i.value=!1;else a.value&&n.options.filter(f=>f.pType===Ct.dataInput).length===1&&(i.value=!0)});const s=c=>{var h;const f=n.options.filter(m=>m.pId===c);return((h=f==null?void 0:f[0])==null?void 0:h.fields)??[]},l=()=>{o.value.joinCondition.push({left:"",right:""})},u=()=>{o.value.joinCondition=o.value.joinCondition.map(c=>({left:c.right,right:c.left}))},d=c=>{o.value.joinCondition.splice(c,1)};return(c,f)=>{const h=og,m=fs,v=Xt,b=Pr,w=Lt,L=kr;return D(),Ie("section",null,[E(v,{label:"设置连接方式",required:""},{default:F(()=>[E(m,{modelValue:x(o).joinWay,"onUpdate:modelValue":f[0]||(f[0]=z=>x(o).joinWay=z)},{default:F(()=>[E(h,{label:x($l).left},{default:F(()=>[E(yn,{"icon-class":"leftJoin"}),St(" 左连接 ")]),_:1},8,["label"]),E(h,{label:x($l).inner},{default:F(()=>[E(yn,{"icon-class":"intersection"}),St(" 内连接 ")]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),E(v,{style:{"margin-bottom":"0px"},label:"设置连接条件",required:""}),Te("div",{style:{width:"100%"}},[E(Wx,{"left-id":x(o).leftTable,"onUpdate:leftId":f[1]||(f[1]=z=>x(o).leftTable=z),"right-id":x(o).rightTable,"onUpdate:rightId":f[2]||(f[2]=z=>x(o).rightTable=z),options:c.options,"is-dis-table":i.value,onChange:u},null,8,["left-id","right-id","options","is-dis-table"]),(D(!0),Ie(dt,null,It(x(o).joinCondition,(z,K)=>(D(),ee(L,{gutter:0,key:K,style:{"align-items":"center"},class:"mt-10"},{default:F(()=>[E(b,{span:11},{default:F(()=>[E(Fp,{modelValue:z.left,"onUpdate:modelValue":he=>z.left=he,fields:s(x(o).leftTable)},null,8,["modelValue","onUpdate:modelValue","fields"])]),_:2},1024),E(b,{span:1,style:{"text-align":"center"}},{default:F(()=>[St("=")]),_:1}),E(b,{span:11},{default:F(()=>[E(Fp,{dir:"r",modelValue:z.right,"onUpdate:modelValue":he=>z.right=he,fields:s(x(o).rightTable)},null,8,["modelValue","onUpdate:modelValue","fields"])]),_:2},1024),E(b,{span:1},{default:F(()=>[E(w,{type:"danger",link:"",icon:x(Lr),onClick:io(he=>d(K),["stop"])},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1024))),128)),E(w,{onClick:l,class:"mt-10",type:"primary",icon:x(gu),link:""},{default:F(()=>[St(" 添加 ")]),_:1},8,["icon"])]),E(v,{prop:"joinCondition"})])}}}),qx=Ce({__name:"JoinSetting",props:{modelValue:{},options:{},joinSetting:{},columnSetting:{},joinCondition:{}},emits:["update:modelValue","update:joinSetting","update:columnSetting","update:joinCondition"],setup(e,{emit:t}){const n=e,r=t,o=sn(n,"columnSetting",r),a=sn(n,"joinSetting",r),i=sn(n,"modelValue",r),s=vn(),l=we([]),u=we([]),d=Ee(()=>[...l.value,...u.value]),c=Ee(()=>{const w=d.value??[];return s.batchGetInfosByFields(w)}),f=Ee({get(){return n.columnSetting.map(w=>w.fieldId)},set(w){const L=In(w.map(z=>{var Fe;const K=n.columnSetting.find(Oe=>Oe.fieldId===z);return K||((Fe=d.value)==null?void 0:Fe.find(Oe=>Oe.fieldId===z))}));o.value=L}});Au(()=>{const w=n.modelValue.joinCondition.filter(ae=>ae.left&&ae.right);if(w.length<1)return;const L=n.options.filter(ae=>ae.pId===n.modelValue.leftTable)[0],z=n.options.filter(ae=>ae.pId===n.modelValue.rightTable)[0],K=w.reduce((ae,st)=>(st.left&&ae.push(st.left),ae),[]),he=w.reduce((ae,st)=>(st.right&&ae.push(st.right),ae),[]),Fe=L.fields.filter(ae=>!K.includes(ae.fieldId));l.value=Fe.map(ae=>({...ae,from:"left"})),l.value;const Oe=z.fields.filter(ae=>!he.includes(ae.fieldId));u.value=Oe.map(ae=>({...ae,from:"right"}));const at=L.fields.filter(ae=>K.includes(ae.fieldId));let ke=[];const ze=n.columnSetting.filter(ae=>ae.from==="connection");n.modelValue.joinSetting==="1"?ke=at.map(ae=>{const st=ze.find(yt=>ae.fieldId===yt.fieldId);return st||{...ae,from:"connection"}}):ke=[...z.fields.filter(st=>he.includes(st.fieldId)),...at].map(st=>{const yt=ze.find(bt=>st.fieldId===bt.fieldId);return yt||{...st,from:"connection"}});const He=n.columnSetting.filter(ae=>ae.from!=="connection"&&d.value.some(st=>st.fieldId===ae.fieldId));o.value=[...ke,...He]});const h=we({}),m=(w,L)=>{h.value[L]=w},v=w=>{var L;(L=h.value[w])==null||L.openEdit()},b=w=>{o.value.find(z=>z.fieldId===w)&&(n.modelValue.joinCondition.filter(z=>z.left!==w),i.value.joinCondition=n.modelValue.joinCondition.filter(z=>z.left!==w),o.value=n.columnSetting.filter(z=>z.fieldId!==w))};return(w,L)=>{const z=Cu,K=Xt,he=Lt,Fe=ta;return D(),Ie(dt,null,[E(K,{label:"连接设置"},{default:F(()=>[E(z,{modelValue:x(a),"onUpdate:modelValue":L[0]||(L[0]=Oe=>wt(a)?a.value=Oe:null),"true-label":"1","false-label":"0"},{default:F(()=>[St(" 合并连接字段 ")]),_:1},8,["modelValue"])]),_:1}),E(K,{label:"字段设置"},{default:F(()=>[E(hr,{style:{width:"200px"},modelValue:f.value,"onUpdate:modelValue":L[1]||(L[1]=Oe=>f.value=Oe),ref:"buttonSelectFieldRef",placeholder:"添加字段",fields:c.value,multiple:""},null,8,["modelValue","fields"])]),_:1}),E(Fe,null,{default:F(()=>[E(x(xu),{tag:"div",modelValue:x(o),"onUpdate:modelValue":L[2]||(L[2]=Oe=>wt(o)?o.value=Oe:null),group:{name:"optionItem",pull:!0},handle:".drag",animation:"300","item-key":"fieldId",dragClass:"dragClass",ghostClass:"ghostClass",class:"editor-draggable"},{item:F(({element:Oe,index:at})=>[Te("div",{class:Yo(Oe.from)},[Te("div",{style:{padding:"10px"},class:"editor-draggable-item"},[Te("div",{class:"header-flex",style:{width:"180px"}},[(D(),ee(Cm,{width:"91px",key:Oe.fieldId,style:{height:"32px"},info:x(o)[at],"onUpdate:info":ke=>x(o)[at]=ke,ref:ke=>m(ke,Oe.fieldId)},null,8,["info","onUpdate:info"])),E(he,{link:"",icon:x(so),onClick:ke=>v(Oe.fieldId)},null,8,["icon","onClick"]),E(he,{link:"",icon:x(oa),class:"drag"},null,8,["icon"]),E(he,{link:"",icon:x(zp),onClick:ke=>b(Oe.fieldId)},null,8,["icon","onClick"])])]),Te("div",{class:"cont-box",style:{width:"100%",height:"80px"}})],2)]),_:1},8,["modelValue"])]),_:1})],64)}}});const Qx=Tt(qx,[["__scopeId","data-v-69e33739"]]),Zx=Ce({__name:"Setting",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","update:modelValue"],setup(e,{emit:t}){const n=e,o=sn(n,"modelValue",t),a=$t(),{getNodeFields:i}=Ur(),s=Ee(()=>i()??[]);return Ln(()=>{const l=n.modelValue.columnSetting,u=s.value.map(c=>c.fields.map(f=>f.fieldId)).flat();l.length>=1&&(o.value.columnSetting=l.filter(c=>u.includes(c.fieldId)));const d=n.modelValue.joinCondition;d.length>=1&&(o.value.joinCondition=d.filter(c=>u.includes(c.left)&&u.includes(c.right)))}),(l,u)=>(D(),ee(yr,{modelValue:x(o),"onUpdate:modelValue":u[5]||(u[5]=d=>wt(o)?o.value=d:null),defaultActive:"set"},{set:F(()=>[E(ua,{width:"500px"},{aside:F(()=>[E(Kx,{modelValue:x(o),"onUpdate:modelValue":u[0]||(u[0]=d=>wt(o)?o.value=d:null),options:s.value},null,8,["modelValue","options"])]),main:F(()=>[E(Qx,{joinSetting:x(o).joinSetting,"onUpdate:joinSetting":u[1]||(u[1]=d=>x(o).joinSetting=d),columnSetting:x(o).columnSetting,"onUpdate:columnSetting":u[2]||(u[2]=d=>x(o).columnSetting=d),joinCondition:x(o).joinCondition,"onUpdate:joinCondition":u[3]||(u[3]=d=>x(o).joinCondition=d),modelValue:x(o),"onUpdate:modelValue":u[4]||(u[4]=d=>wt(o)?o.value=d:null),options:s.value},null,8,["joinSetting","columnSetting","joinCondition","modelValue","options"])]),_:1})]),preview:F(({isPreview:d})=>[x(a).selectNode&&d?(D(),ee(Gr,{key:0,id:x(a).selectNode.id,"cur-fields":x(o).columnSetting,ref:"PreviewTableDataRef"},null,8,["id","cur-fields"])):Xe("",!0)]),_:1},8,["modelValue"]))}}),Jx=Object.freeze(Object.defineProperty({__proto__:null,default:Zx},Symbol.toStringTag,{value:"Module"})),eR=Ce({__name:"AddField",emits:["confirm"],setup(e,{emit:t}){const n=t,r=()=>{$p.prompt("请输入一个字段名称","添加字段",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:o})=>{n("confirm",o)})};return(o,a)=>{const i=Lt;return D(),ee(i,{type:"primary",text:"",icon:x(gu),onClick:r},{default:F(()=>[St("添加字段")]),_:1},8,["icon"])}}}),tR=Ce({__name:"BulkEdit",props:{fields:{}},emits:["confirm"],setup(e,{emit:t}){const n=e,r=t,o=we(!1),a=we(""),i=()=>{const l=a.value.split(`
`).map(u=>{const d=n.fields.find(c=>c.alias===u);return d||Wl({fieldType:ft.input,type:Ft.string,comment:u,alias:u})});r("confirm",l),o.value=!1},s=()=>{a.value=n.fields.map(l=>l.comment).join(`
`),o.value=!0};return(l,u)=>{const d=Lt,c=Cn,f=aa;return D(),Ie(dt,null,[E(d,{type:"primary",text:"",icon:x(so),onClick:s},{default:F(()=>[St(" 批量编辑 ")]),_:1},8,["icon"]),E(f,{modelValue:o.value,"onUpdate:modelValue":u[2]||(u[2]=h=>o.value=h),title:"批量编辑",width:"700px","append-to-body":""},{footer:F(()=>[Te("span",{class:"dialog-footer"},[E(d,{onClick:u[1]||(u[1]=h=>o.value=!1)},{default:F(()=>[St("取消")]),_:1}),E(d,{type:"primary",onClick:i},{default:F(()=>[St("确定")]),_:1})])]),default:F(()=>[Te("div",{class:"color2 mb-5"},"输入字段名称 （每行一个）"),E(c,{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=h=>a.value=h),type:"textarea",rows:15,resize:"none"},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}}}),nR=Ce({__name:"EditField",props:{info:{}},emits:["update:info","delete"],setup(e,{emit:t}){const n=e,r=t,o=we(!0),a=we(""),i=we(),s=()=>{o.value=!1,a.value=n.info.alias??"",Fr(()=>{var d;(d=i.value)==null||d.focus()})},l=()=>{const d=n.info;d.alias=a.value?a.value:n.info.alias,r("update:info",d),o.value=!0},u=Ee(()=>n.info.alias);return(d,c)=>{const f=Cn,h=Lt;return D(),Ie("div",{class:"field-name",style:{position:"relative"}},[o.value?(D(),ee(fo,{key:0,content:u.value,style:{width:"75px"}},null,8,["content"])):(D(),Ie("div",{key:1,class:"edit-input"},[E(f,{ref_key:"ElInputRef",ref:i,modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=m=>a.value=m),onBlur:l,onKeyup:qa(l,["enter"]),placeholder:"请输入字段名称",style:{height:"100%"}},null,8,["modelValue","onKeyup"])])),E(h,{type:"primary",link:"",icon:x(so),onClick:s},null,8,["icon"]),E(h,{type:"primary",link:"",icon:x(jp),onClick:c[1]||(c[1]=m=>r("delete"))},null,8,["icon"])])}}});const rR=Tt(nR,[["__scopeId","data-v-7b6a6e18"]]),oR=Ce({__name:"SetFields",props:{pNodeId:{},pFields:{},waitFieldId:{},toColumnFields:{},getValueField:{}},emits:["update:waitFieldId","update:toColumnFields","update:getValueField"],setup(e,{emit:t}){const n=e,r=t,o=$t(),{isFlowMode:a}=_o(),i=vn(),s=Ee(()=>{const K=[Ge.input,Ge.radio,Ge.number],he=n.pFields.filter(Fe=>K.includes(Fe.fieldType));return i.batchGetInfosByFields(he)}),l=Ee({get(){return n.waitFieldId},set(K){r("update:waitFieldId",K),r("update:toColumnFields",[])}});ao(()=>l.value,()=>{var K;(K=u.value)==null||K.reload()});const u=we(),d=async()=>{var Fe,Oe;const K=[],he=(Fe=o.graphInstance)==null?void 0:Fe.getCellById(n.pNodeId);if(K.push(he),he){const at=(Oe=o.graphInstance)==null?void 0:Oe.getPredecessors(he,{deep:!0});at&&at.forEach(ke=>{var He;K.push(ke);const ze=(He=o.graphInstance)==null?void 0:He.getConnectedEdges(ke);ze==null||ze.forEach(ae=>{K.every(st=>st.id!==ae.id)&&K.push(ae)})})}return a.value?await Ng({appId:o.appId,cells:In(K),limit:10,dataStreamId:o.dataId,cellsId:n.pNodeId,fieldName:l.value,idDistinct:!0}):await Og({appId:o.appId,cells:In(K),limit:10,dataStreamId:o.dataId,cellsId:n.pNodeId,fieldName:l.value,idDistinct:!0})},c=we([]),f=K=>{c.value=K},h=Ee({get(){const K=n.toColumnFields.map(he=>he.fieldId);return c.value.filter(he=>K.includes(he.id)).map(he=>he.id)},set(K){const he=c.value.filter(Oe=>!K.includes(Oe.id)).map(Oe=>Oe.id),Fe=n.toColumnFields.filter(Oe=>!he.includes(Oe.fieldId));K.forEach(Oe=>{if(Fe.findIndex(ke=>ke.fieldId===Oe)===-1){const ke=c.value.filter(ae=>ae.id===Oe)[0],ze=n.pFields.find(ae=>ae.fieldType),He=Wl({fieldType:(ze==null?void 0:ze.fieldType)??ft.input,type:(ze==null?void 0:ze.type)??Ft.string,comment:ke.value,alias:ke.value,fieldId:ke.id});Fe.push(He)}}),r("update:toColumnFields",Fe)}}),m=Ee({get(){var K;return((K=n.getValueField)==null?void 0:K.fieldId)??""},set(K){const he=n.pFields.find(Fe=>Fe.fieldId===K);he&&r("update:getValueField",he)}}),v=Ee({get(){var K;return((K=n.getValueField)==null?void 0:K.summary)??""},set(K){n.getValueField&&r("update:getValueField",{...n.getValueField,summary:K})}}),b=Ee(()=>{var K;return((K=n.getValueField)==null?void 0:K.fieldType)===Ge.number?wm:Sm}),w=K=>{const he=Wl({fieldType:ft.input,type:Ft.string,comment:K,alias:K});r("update:toColumnFields",[...n.toColumnFields,he])},L=K=>{r("update:toColumnFields",[...K])},z=K=>{const he=n.toColumnFields.filter(Fe=>Fe.fieldId!==K);r("update:toColumnFields",he)};return(K,he)=>{const Fe=Xt,Oe=Wn,at=pr;return D(),Ie("div",{style:{width:"100%",height:"100%",overflow:"auto"}},[E(Fe,{"label-width":"150px",label:"待行转列的字段",prop:"waitField"},{default:F(()=>[E(Yi,{style:{"max-width":"280px"},modelValue:l.value,"onUpdate:modelValue":he[0]||(he[0]=ke=>l.value=ke),fields:s.value},null,8,["modelValue","fields"])]),_:1}),E(ag,{"label-width":"150px",label:"转换成列的字段值",prop:"toColumnFields"},{default:F(()=>[Te("div",{class:"field-form-box"},[E(Ki,{class:"field-select",ref_key:"AzSelectRef",ref:u,modelValue:h.value,"onUpdate:modelValue":he[1]||(he[1]=ke=>h.value=ke),style:{"max-width":"280px"},placeholder:"请选择",load:d,onLoadFinish:f,multiple:""},{default:F(({options:ke})=>[(D(!0),Ie(dt,null,It(ke,ze=>(D(),ee(Oe,{key:ze.id,label:ze.value,value:ze.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),E(eR,{onConfirm:w}),E(tR,{fields:K.toColumnFields,onConfirm:L},null,8,["fields"])])]),_:1}),E(Fe,{"label-width":"150px",label:"取值字段",prop:"getValueField"},{default:F(()=>[Te("div",{class:"field-form-box"},[E(Yi,{class:"field-select",modelValue:m.value,"onUpdate:modelValue":he[2]||(he[2]=ke=>m.value=ke),fields:s.value},null,8,["modelValue","fields"]),K.getValueField?(D(),ee(at,{key:0,style:{width:"120px"},modelValue:v.value,"onUpdate:modelValue":he[3]||(he[3]=ke=>v.value=ke),placeholder:"请选择汇总方式"},{default:F(()=>[(D(!0),Ie(dt,null,It(b.value,ke=>(D(),ee(Oe,{key:ke.value,label:ke.label,value:ke.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):Xe("",!0)])]),_:1}),K.toColumnFields.length>0?(D(),Ie("div",{key:0,class:"field-table-box"},[E(x(xu),{list:K.toColumnFields,ref:"draggableRef",itemKey:"fieldId",class:"field-list-wrapper",animation:"300"},{item:F(({element:ke})=>[Te("div",{class:"field-cell"},[E(rR,{info:ke,onDelete:ze=>z(ke.fieldId)},null,8,["info","onDelete"]),Te("div",{class:"field-blank"})])]),_:1},8,["list"])])):Xe("",!0)])}}});const aR=Tt(oR,[["__scopeId","data-v-e02e434b"]]),iR=Ce({__name:"Setting",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=$t(),a=sn(n,"modelValue",r),{getNodeFields:i}=Ur(),s=Ee(()=>{var d,c;return((c=(d=i())==null?void 0:d[0])==null?void 0:c.fields)??[]}),l=Ee(()=>{var d,c;if(o.selectNode){const f=(d=o.graphInstance)==null?void 0:d.getNeighbors(o.selectNode,{incoming:!0});return((c=f==null?void 0:f[0])==null?void 0:c.id)??""}return""}),u=Ee(()=>[...a.value.classFields,...a.value.toColumnFields]);return Ln(()=>{const d=s.value.map(m=>m.fieldId),c=n.modelValue.classFields;c.length>=1&&(a.value.classFields=c.filter(m=>d.includes(m.fieldId)));const f=n.modelValue.waitField;f&&(d.includes(f)||(a.value.waitField=""));const h=n.modelValue.getValueField;h&&(d.includes(h.fieldId)||(a.value.getValueField=null))}),(d,c)=>{const f=Xt;return D(),ee(yr,{modelValue:x(a),"onUpdate:modelValue":c[4]||(c[4]=h=>wt(a)?a.value=h:null),defaultActive:"set"},{set:F(()=>[E(ua,{width:"450px"},{aside:F(()=>[E(Im,{modelValue:x(a).classFields,"onUpdate:modelValue":c[0]||(c[0]=h=>x(a).classFields=h),"p-fields":s.value},null,8,["modelValue","p-fields"]),E(f,{label:"",style:{"margin-top":"18px"},prop:"classFields"})]),main:F(()=>[E(aR,{waitFieldId:x(a).waitField,"onUpdate:waitFieldId":c[1]||(c[1]=h=>x(a).waitField=h),toColumnFields:x(a).toColumnFields,"onUpdate:toColumnFields":c[2]||(c[2]=h=>x(a).toColumnFields=h),getValueField:x(a).getValueField,"onUpdate:getValueField":c[3]||(c[3]=h=>x(a).getValueField=h),"p-fields":s.value,pNodeId:l.value},null,8,["waitFieldId","toColumnFields","getValueField","p-fields","pNodeId"])]),_:1})]),preview:F(({isPreview:h})=>[x(o).selectNode&&h?(D(),ee(Gr,{key:0,id:x(o).selectNode.id,"cur-fields":u.value,ref:"PreviewTableDataRef"},null,8,["id","cur-fields"])):Xe("",!0)]),_:1},8,["modelValue"])}}}),sR=Object.freeze(Object.defineProperty({__proto__:null,default:iR},Symbol.toStringTag,{value:"Module"})),lR=Ce({__name:"InputDataSource",props:{setting:{},visible:{type:Boolean}},emits:["update:visible"],setup(e,{emit:t}){const n=e,o=Dr(n,"visible",t),a=()=>{o.value=!0},i=Ee(()=>n.setting.buTableName);return(s,l)=>{const u=Lt,d=Wp;return D(),Ie("section",{class:"input-source"},[Te("section",{class:"select-datasource"},[Te("div",{class:"label"},"输入源："),E(u,{type:"primary",text:"",onClick:a},{default:F(()=>[St(" 更改输入源 ")]),_:1})]),Te("section",{class:"select-form mb-10"},[E(fo,{content:i.value},null,8,["content"])]),Te("section",{class:"select-field"},[Te("div",{class:"label"},"已选字段："),E(d,{direction:"vertical",size:10,alignment:"left"},{default:F(()=>[(D(!0),Ie(dt,null,It(s.setting.fieldsOptions,c=>(D(),ee(Rm,{key:c.fieldId,fieldInfo:c},null,8,["fieldInfo"]))),128))]),_:1})])])}}});const uR=Tt(lR,[["__scopeId","data-v-ee28c134"]]),Dm=Ce({__name:"OutputTo",props:{modelValue:{}},emits:["update:modelValue","reset"],setup(e,{emit:t}){const n=e,r=t,o=Dr(n,"modelValue",r),a=[{label:"应用表单",value:zt.form},{label:"数据建模表",value:zt.dataModel},{label:"数据连接",value:zt.connection}],i=()=>{r("reset")};return(s,l)=>{const u=Ru,d=fs,c=Xt;return D(),ee(c,{label:"选择数据源",required:""},{default:F(()=>[E(d,{modelValue:x(o),"onUpdate:modelValue":l[0]||(l[0]=f=>wt(o)?o.value=f:null),onChange:i},{default:F(()=>[(D(),Ie(dt,null,It(a,({label:f,value:h})=>E(u,{label:h,key:h},{default:F(()=>[St(mn(f),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1})}}}),dR=()=>Mn({Tree:[],get TreeMap(){const t=new Map;return function n(r){r.forEach(o=>{t.set(o.id,o),o.children.length>=1&&n(o.children)})}(this.Tree),t},setTreeChildren(t,n){(function r(o,a){for(let i=0;i<o.length;i++){const s=o[i];if(s.id===t&&s.children.length<1){s.children.push(...a);break}else s.children.length>=1&&r(s.children,a)}})(this.Tree,n)},async init(){if(this.Tree.length>=1)return Et(this.Tree);const n=(await ig()).map(r=>({label:r.name,id:r.id,children:[],data:r}));return this.Tree.push(...n),Et(n)},async load2Children(t){var a,i,s;if(t.children.length>=1)return Et(t.children);if(this.TreeMap.has(t.id)&&((i=((a=this.TreeMap.get(t.id))==null?void 0:a.children)??[])==null?void 0:i.length)>=1)return Et(((s=this.TreeMap.get(t.id))==null?void 0:s.children)??[]);const n=t.id,o=(await sg({appId:n})).map(l=>({label:l.name,id:l.id,children:[],data:l}));return this.setTreeChildren(t.id,o),Et(o)},async load3Children(t){var a,i,s;if(t.children.length>=1)return Et(t.children);if(this.TreeMap.has(t.id)&&((i=((a=this.TreeMap.get(t.id))==null?void 0:a.children)??[])==null?void 0:i.length)>=1)return Et(((s=this.TreeMap.get(t.id))==null?void 0:s.children)??[]);const n=t.id,o=(await lg({entryId:n})).map(l=>({label:l.fieldName,id:l.id,children:[],data:l}));return this.setTreeChildren(t.id,o),Et(o)},getLabelById(t){var n;return(n=this.TreeMap.get(t))==null?void 0:n.label}}),cR=dR,Lp=Symbol("entryDataSystemKey");function ni(){const e=Wi(Lp,void 0);if(e)return e;{const t=cR();return Tu(Lp,t),t}}const fR=Ce({__name:"Cascader",props:{modelValue:{}},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,r=t,o=ni(),a={lazy:!0,value:"id",children:"children",checkStrictly:!0,lazyLoad(u,d){const{level:c}=u;c===0?o.init().then(f=>{d(f)}):c===1?o.load2Children(u.data).then(f=>{d(f)}):c===2?o.load3Children(u.data).then(f=>{const h=f.map(m=>({...m,leaf:!0}));d(h)}):d([])}},i=we(),s=Ee({get(){return n.modelValue.split(",")},set(u){r("update:modelValue",u.join(","))}}),l=u=>{r("change"),setTimeout(()=>{var d;(d=i.value)==null||d.togglePopperVisible(!1)},50)};return(u,d)=>(D(),ee(x(Xp),{"popper-class":"cascader-reset",ref_key:"formCascader",ref:i,onChange:l,class:"w100",modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=c=>s.value=c),props:a,"show-all-levels":!1,filterable:"",clearable:""},null,8,["modelValue"]))}});const pR=Ce({__name:"SelectForm",props:{buId:{},appId:{},entryId:{}},emits:["update:buId","update:appId","update:entryId","change"],setup(e,{emit:t}){const n=e,r=t,o=Ee({get(){return n.buId||n.entryId?n.entryId!==n.buId?In([n.appId,n.entryId,n.buId]).join(","):In([n.appId,n.buId]).join(","):""},set(a){const i=a.split(","),s=i[0]??"";r("update:appId",s);const l=i[1]??"";r("update:entryId",l);const u=i[2]??l;r("update:buId",u)}});return(a,i)=>(D(),ee(x(Xt),{label:"选择表单"},{default:F(()=>[E(fR,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=s=>o.value=s),onChange:i[1]||(i[1]=s=>r("change"))},null,8,["modelValue"])]),_:1}))}}),hR=Ce({__name:"ConnectionParams",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=we([]),a=()=>{o.value.push({key:"",value:""})},i=s=>{o.value.splice(s,1)};return ao(()=>n.modelValue,s=>{if(s){const l=s.split("&");o.value=l.reduce((u,d)=>{const[c="",f=""]=d.split("=");return u.push({key:c,value:f||""}),u},[])}else o.value=[]},{immediate:!0}),ao(()=>o.value,s=>{const l=s.map(u=>`${u.key}=${u.value}`).join("&");r("update:modelValue",l)},{deep:!0}),(s,l)=>{const u=Lt,d=Cn,c=Pr,f=kr;return D(),Ie("div",{class:"connection-params"},[Te("div",{class:"connection-params__title"},[Te("span",null,"可选项"),Te("span",{class:"tip"},"(引擎连接参数)"),E(u,{type:"primary",text:"",onClick:a},{default:F(()=>[St("添加")]),_:1})]),(D(!0),Ie(dt,null,It(o.value,(h,m)=>(D(),Ie("div",{class:"connection-params__item",key:m},[E(f,{align:"middle",gutter:20,class:"item-row"},{default:F(()=>[E(c,{span:9},{default:F(()=>[E(d,{modelValue:h.key,"onUpdate:modelValue":v=>h.key=v,placeholder:"key",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),E(c,{span:9},{default:F(()=>[E(d,{modelValue:h.value,"onUpdate:modelValue":v=>h.value=v,placeholder:"value",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),E(c,{span:6,class:"delete-icon"},{default:F(()=>[E(yn,{"icon-class":"Delete",onClick:v=>i(m)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])}}});const Pm=Tt(hR,[["__scopeId","data-v-062903d7"]]),km=Ce({__name:"Connection",props:{modelValue:{},isHavePrimary:{type:Boolean}},emits:["update:modelValue","change","changePrimaryKey"],setup(e,{emit:t}){const n=e,r=t,o=sn(n,"modelValue",r),a=we([]),i=async()=>{var m;const h=await $g({titleName:"",dbType:"",limit:1e3,current:1});return a.value=(h==null?void 0:h.records)??[],(m=u.value)==null||m.reload(),(h==null?void 0:h.records)??[]},s=()=>{var h;(h=u.value)==null||h.reload()},l=Ee(()=>{const h=a.value.find(v=>String(v.id)===String(o.value.buId));return{id:String((h==null?void 0:h.id)??""),dbName:(h==null?void 0:h.dbName)??"",isHavePrimary:n.isHavePrimary}}),u=we(),d=we(),c=async()=>{if(!l.value.id)return[];const h=await Fg(l.value);return d.value=h,h},f=h=>{var v;const m=(v=d.value)==null?void 0:v.find(b=>b.name===h);m&&(o.value.buTableName=m.comment,r("changePrimaryKey",m.primaryKey)),r("change")};return(h,m)=>{const v=Wn,b=Xt;return D(),Ie("section",null,[E(b,{required:""},{default:F(()=>[E(Ki,{modelValue:x(o).buId,"onUpdate:modelValue":m[0]||(m[0]=w=>x(o).buId=w),load:i,onChange:s},{default:F(({options:w})=>[(D(!0),Ie(dt,null,It(w??[],L=>(D(),ee(v,{key:L.id,label:L.titleName,value:String(L.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),E(b,{label:"数据库名称"},{default:F(()=>{var w;return[Te("span",null,mn((w=l.value)==null?void 0:w.dbName),1)]}),_:1}),E(b,{label:"选择表",required:""},{default:F(()=>[E(Ki,{ref_key:"SelectBuTableRef",ref:u,modelValue:x(o).buTable,"onUpdate:modelValue":m[1]||(m[1]=w=>x(o).buTable=w),load:c,onChange:f},{default:F(({options:w})=>[(D(!0),Ie(dt,null,It(w??[],L=>(D(),ee(v,{key:L.name,label:L.comment,value:L.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])}}}),Vm=Ce({__name:"DataModel",props:{modelValue:{},appId:{}},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,r=t,o=sn(n,"modelValue",r),a=async()=>(await ug({limit:1e3,current:1,appId:n.appId})).records,i=we([]),s=u=>{i.value=u},l=u=>{const d=i.value.find(c=>c.id===u);d&&(o.value.buTableName=d.name),r("change")};return(u,d)=>{const c=Wn,f=Xt;return D(),ee(f,{label:"选择数据表",required:""},{default:F(()=>[E(Ki,{modelValue:x(o).buId,"onUpdate:modelValue":d[0]||(d[0]=h=>x(o).buId=h),load:a,onLoadFinish:s,onChange:l},{default:F(({options:h})=>[(D(!0),Ie(dt,null,It(h??[],m=>(D(),ee(c,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})}}}),mR=Ce({__name:"DataSource",props:{modelValue:{},appId:{},dataDealMode:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=sn(e,"modelValue",t),a=Mn({buId:[{required:!0,message:()=>o.value.dataSources===zt.form?"请选择表单":o.value.dataSources===zt.dataModel?"请选择数据表":o.value.dataSources===zt.connection?"请选择数据连接":"请选择表",trigger:"change"}],buTable:[{required:!0,message:"请选择表",trigger:"change"}]}),i=ni(),{isFlowMode:s}=_o(),l=()=>{const c=i.getLabelById(o.value.buId);o.value.buTableName=c??"",c&&(o.value.cellsName=c),d()},u=()=>{o.value.buId="",o.value.appId="",o.value.entryId="",o.value.buTable="",d()},d=()=>{o.value.fieldsOptions=[]};return(c,f)=>{const h=ra;return D(),ee(h,{ref:"ElFormRef",model:x(o),rules:a,"label-suffix":"：","label-position":"top","status-icon":""},{default:F(()=>[E(Dm,{modelValue:x(o).dataSources,"onUpdate:modelValue":f[0]||(f[0]=m=>x(o).dataSources=m),onReset:u},null,8,["modelValue"]),x(o).dataSources===x(zt).form?(D(),ee(pR,{key:0,"app-id":x(o).appId,"onUpdate:appId":f[1]||(f[1]=m=>x(o).appId=m),"entry-id":x(o).entryId,"onUpdate:entryId":f[2]||(f[2]=m=>x(o).entryId=m),buId:x(o).buId,"onUpdate:buId":f[3]||(f[3]=m=>x(o).buId=m),onChange:l},null,8,["app-id","entry-id","buId"])):Xe("",!0),x(o).dataSources===x(zt).dataModel?(D(),ee(Vm,{key:1,modelValue:x(o),"onUpdate:modelValue":f[4]||(f[4]=m=>wt(o)?o.value=m:null),"app-id":c.appId,onChange:d},null,8,["modelValue","app-id"])):Xe("",!0),x(o).dataSources===x(zt).connection?(D(),ee(km,{key:2,modelValue:x(o),"onUpdate:modelValue":f[5]||(f[5]=m=>wt(o)?o.value=m:null),"app-id":c.appId,onChange:d,"is-have-primary":x(s)},null,8,["modelValue","app-id","is-have-primary"])):Xe("",!0),x(s)?(D(),ee(Pm,{key:3,modelValue:x(o).configParams,"onUpdate:modelValue":f[6]||(f[6]=m=>x(o).configParams=m)},null,8,["modelValue"])):Xe("",!0)]),_:1},8,["model","rules"])}}}),Bm=(e,t)=>{const{loadFinish:n,emitTable:r}=t,o=we([]),a=we([]),i=vn();return{multipleSelection:a,tableData:o,fieldDataSystem:i,load:async()=>{if(!e.id)return[];if(a.value=[],e.sourceType===zt.form){const l=e.entryId===e.id,u=await sf({type:l?1:0,tableId:l?void 0:e.id,entryId:l?e.id:void 0});r==null||r(u.table),o.value=u.schemaList.map(d=>({...d,fieldId:`${e.currentNodeId}_${d.name}`,entryId:e.entryId})),i.batchSetInfosByFields(o.value),n==null||n(u)}if(e.sourceType===zt.dataModel){const l=await sf({type:2,modelId:e.id});r==null||r(l.table),o.value=l.schemaList.map(u=>({...u,fieldId:`${e.currentNodeId}_${u.name}`,modelId:e.id})),i.batchSetInfosByFields(o.value),n==null||n(l)}if(e.sourceType===zt.connection){const l=await Lg({id:e.id,tableName:e.buTable,dbName:""});o.value=l.schemaList.map(u=>({...u,connectionId:`${e.id}_${e.buTable}`,fieldId:`${e.currentNodeId}_${u.name}`,fieldType:lx(u.type)})),i.batchSetInfosByFields(o.value),n==null||n(l)}}}},Um=Ce({__name:"PrimaryKeyTitle",setup(e){return(t,n)=>{const r=Nu,o=cg,a=na;return D(),Ie("div",{style:{display:"inline-flex","align-items":"center"}},[Te("span",null,"主键"),E(a,{effect:"dark",content:"多个主键时，业务上字段值组合后惟一",placement:"top-start"},{default:F(()=>[E(o,{type:"primary"},{default:F(()=>[E(r,null,{default:F(()=>[E(x(dg))]),_:1})]),_:1})]),_:1})])}}}),vR=Ce({__name:"FieldTable",props:{id:{},entryId:{},buTable:{},sourceType:{},multiple:{type:Boolean},modelValue:{},isDel:{type:Boolean,default:!1},currentNodeId:{},dataDealMode:{}},emits:["update:modelValue","update:buTable"],setup(e,{emit:t}){const n=e,r=t,o=h=>{r("update:buTable",h)},a=h=>{setTimeout(()=>{var m;if(n.modelValue.length>=1){const v=n.modelValue.map(b=>{const w=s.value.filter(L=>L.fieldId===b.fieldId)[0];return b.primaryKey&&(w.primaryKey=!0),w});v.length>=1&&c(In(v))}else(m=d.value)==null||m.toggleAllSelection()},0)},{load:i,tableData:s}=Bm(Mn(Hp(n)),{emitTable:o,loadFinish:a}),l=h=>{r("update:modelValue",In(h))},u=we(),d=we(),c=h=>{h&&h.forEach(m=>{var v;(v=d.value)==null||v.toggleRowSelection(m,!0)})},f=(h,m,v,b)=>Ou(v)??"";return ao(()=>n.id,()=>{var h;n.id&&(n.sourceType===zt.form||n.sourceType===zt.dataModel)&&((h=u.value)==null||h.reload())}),ao(()=>n.buTable,()=>{var h;n.buTable&&n.sourceType===zt.connection&&((h=u.value)==null||h.reload())}),ao(()=>n.sourceType,()=>{s.value=[]}),(h,m)=>{const v=dr,b=Cu;return D(),ee(cs,{load:x(i),ref_key:"loadingDataRef",ref:u},{default:F(()=>[E(x(Mr),{ref_key:"ElTableRef",ref:d,class:"form-field-list",onSelectionChange:l,data:x(s),style:{width:"100%",height:"100%"},"max-height":"100%","row-key":"fieldId"},{default:F(()=>[h.multiple?(D(),ee(v,{key:0,type:"selection",width:"55"})):Xe("",!0),E(v,{"show-overflow-tooltip":"",prop:"comment",label:"字段名称"}),E(v,{formatter:f,prop:"fieldType",label:"类型"}),h.dataDealMode===x(ur).flow?(D(),ee(v,{key:1,label:"主键",width:"80px"},{header:F(()=>[E(Um)]),default:F(({row:w})=>[E(b,{modelValue:w.primaryKey,"onUpdate:modelValue":L=>w.primaryKey=L,disabled:w.name==="id"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1})):Xe("",!0)]),_:1},8,["data"])]),_:1},8,["load"])}}});const _R=Tt(vR,[["__scopeId","data-v-012e802f"]]),bR=Ce({__name:"DataSourceSetting",props:{modelValue:{type:Boolean},settingForm:{},dataDealMode:{},appId:{},currentNodeId:{default:""}},emits:["update:modelValue","update:settingForm"],setup(e,{emit:t}){const n=e,r=t,{resetCurrentNode:o}=wy(),a=Ee({get(){return n.modelValue},set(h){r("update:modelValue",h)}}),i=we(Et(n.settingForm)),s=async()=>{if(i.value.fieldsOptions.length>=1){const h=n.settingForm.buId,m=i.value.buId;h&&m&&h!==m?$p.confirm("此操作会同步更改后续节点的配置，无法还原？","确定要更改输入源？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o(),r("update:settingForm",i.value),a.value=!1}):(r("update:settingForm",i.value),a.value=!1)}else Ko.error("至少选择一个字段")},l=we(!1),u=()=>{i.value=Et(n.settingForm),setTimeout(()=>{l.value=!0})},d=()=>{a.value=!1},c=h=>{i.value.buTable=h},f=h=>{i.value.buTableName=h,i.value.fieldsOptions=[]};return(h,m)=>{const v=Lt,b=aa;return D(),ee(b,{onOpen:u,modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=w=>a.value=w),title:"输入数据配置",width:"900px","destroy-on-close":""},{footer:F(()=>[Te("div",{class:"az_drawer_footer"},[E(v,{type:"primary",onClick:s},{default:F(()=>[St("确定")]),_:1}),E(v,{onClick:d},{default:F(()=>[St("取消")]),_:1})])]),default:F(()=>[E(ua,{width:"350px"},{aside:F(()=>[l.value?(D(),ee(mR,{key:0,modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=w=>i.value=w),appId:h.appId,onUpdateBuTableName:f,dataDealMode:h.dataDealMode},null,8,["modelValue","appId","dataDealMode"])):Xe("",!0)]),main:F(()=>[l.value?(D(),ee(_R,{key:0,modelValue:i.value.fieldsOptions,"onUpdate:modelValue":m[1]||(m[1]=w=>i.value.fieldsOptions=w),id:i.value.buId,"entry-id":i.value.entryId,"source-type":i.value.dataSources,multiple:"","onUpdate:buTable":c,buTable:i.value.buTable,currentNodeId:h.currentNodeId,dataDealMode:h.dataDealMode},null,8,["modelValue","id","entry-id","source-type","buTable","currentNodeId","dataDealMode"])):Xe("",!0)]),_:1})]),_:1},8,["modelValue"])}}});const yR=Tt(bR,[["__scopeId","data-v-96321721"]]),gR=Ce({__name:"Setting",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","update:modelValue"],setup(e,{emit:t}){const n=e,o=sn(n,"modelValue",t),a=$t(),i=Ee(()=>!o.value.buId),s=we(!1),l=()=>{s.value=!0},u=we(),d=c=>{o.value=Et(c);const f=Et(n.modelValue);o.value.cellsName=c.buTableName,Bp(f,c)||Fr(()=>{var h;(h=u.value)==null||h.reload()})};return(c,f)=>{var v;const h=Lt,m=ta;return D(),Ie(dt,null,[E(yr,{modelValue:x(o),"onUpdate:modelValue":f[1]||(f[1]=b=>wt(o)?o.value=b:null),tabTags:["info","preview"],defaultActive:"preview"},{preview:F(()=>[i.value?(D(),ee(fg,{key:0},{description:F(()=>[E(h,{type:"primary",onClick:l},{default:F(()=>[St(" 请选择数据源 ")]),_:1})]),_:1})):(D(),ee(ua,{key:1,width:"224px"},{aside:F(()=>[E(m,null,{default:F(()=>[E(uR,{visible:s.value,"onUpdate:visible":f[0]||(f[0]=b=>s.value=b),setting:x(o)},null,8,["visible","setting"])]),_:1})]),main:F(()=>[x(a).selectNode?(D(),ee(Gr,{key:0,ref_key:"PreviewTableDataRef",ref:u,"cur-fields":x(o).fieldsOptions,id:x(a).selectNode.id},null,8,["cur-fields","id"])):Xe("",!0)]),_:1}))]),_:1},8,["modelValue"]),E(yR,{"setting-form":x(o),"onUpdate:settingForm":d,modelValue:s.value,"onUpdate:modelValue":f[2]||(f[2]=b=>s.value=b),dataDealMode:x(a).dataDealMode,appId:x(a).appId,currentNodeId:(v=x(a).selectNode)==null?void 0:v.id},null,8,["setting-form","modelValue","dataDealMode","appId","currentNodeId"])],64)}}}),ER=Object.freeze(Object.defineProperty({__proto__:null,default:gR},Symbol.toStringTag,{value:"Module"})),TR=Ce({__name:"SelectFieldTable",props:{tableData:{}},setup(e){const t=n=>Ou(n)??"";return(n,r)=>{const o=Pr,a=kr;return D(),Ie(dt,null,[E(a,{class:"field-table thead"},{default:F(()=>[E(o,{span:12},{default:F(()=>[Te("div",{class:"field-table_cell field-table_header"},"字段名称")]),_:1}),E(o,{span:12},{default:F(()=>[Te("div",{class:"field-table_cell field-table_header"},"类型")]),_:1})]),_:1}),(D(!0),Ie(dt,null,It(n.tableData,i=>(D(),ee(a,{class:"field-table",key:i.sourceField},{default:F(()=>[E(o,{span:12},{default:F(()=>[Te("div",{class:"field-table_cell"},mn(i.sourceFieldInfo.comment),1)]),_:2},1024),E(o,{span:12},{default:F(()=>[Te("div",{class:"field-table_cell"},mn(t(i.sourceFieldInfo.fieldType)??""),1)]),_:2},1024)]),_:2},1024))),128))],64)}}});const IR=Tt(TR,[["__scopeId","data-v-b129f672"]]),SR=Ce({__name:"AsyncSelectFieldTable",props:{id:{},entryId:{},buTable:{},sourceType:{},modelValue:{},currentNodeId:{},dataDealMode:{}},emits:["update:buTable","update:modelValue"],setup(e,{emit:t}){const n=e,r=t,o=Ee({get(){return n.modelValue},set(c){r("update:modelValue",c)}}),a=c=>{r("update:buTable",c)},{load:i,tableData:s}=Bm(Mn(Hp(n)),{emitTable:a}),l=c=>Ou(c)??"",u=c=>{const f=pg(c);return s.value.filter(m=>f.includes(m.fieldType))},d=c=>{const f=s.value.filter(h=>h.fieldId===c)[0];f&&o.value.forEach(h=>{h.targetField===c&&(h.targetFieldInfo=f)}),c||o.value.forEach(h=>{h.targetField||(h.targetFieldInfo=null)})};return(c,f)=>{const h=Pr,m=kr,v=Wn,b=pr,w=Cu;return D(),ee(cs,{load:x(i),ref:"loadingDataRef"},{default:F(()=>[E(m,{class:"field-table thead"},{default:F(()=>[E(h,{span:10},{default:F(()=>[Te("div",{class:"field-table_cell field-table_header"},"字段名称")]),_:1}),E(h,{span:10},{default:F(()=>[Te("div",{class:"field-table_cell field-table_header"},"类型")]),_:1}),c.dataDealMode===x(ur).flow?(D(),ee(h,{key:0,span:4},{default:F(()=>[E(Um,{class:"field-table_cell field-table_header"})]),_:1})):Xe("",!0)]),_:1}),x(s).length>=1?(D(!0),Ie(dt,{key:0},It(o.value,(L,z)=>(D(),ee(m,{class:"field-table",key:z},{default:F(()=>{var K;return[E(h,{span:10},{default:F(()=>[Te("div",{class:"field-table_cell"},[E(b,{size:"small",modelValue:L.targetField,"onUpdate:modelValue":he=>L.targetField=he,onChange:d,placeholder:"请选择控件",clearable:""},{default:F(()=>[(D(!0),Ie(dt,null,It(u(L.sourceFieldInfo.fieldType),(he,Fe)=>(D(),ee(v,{key:he.fieldId+Fe,label:he.comment,value:he.fieldId,disabled:o.value.some(Oe=>Oe.targetField===he.fieldId)},null,8,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),_:2},1024),E(h,{span:10},{default:F(()=>{var he;return[Te("div",{class:"field-table_cell"},mn((he=L.targetFieldInfo)!=null&&he.fieldType?l(L.targetFieldInfo.fieldType):""),1)]}),_:2},1024),c.dataDealMode===x(ur).flow&&((K=L.targetFieldInfo)!=null&&K.fieldType)?(D(),ee(h,{key:0,span:4},{default:F(()=>[Te("div",{class:"field-table_cell",style:{padding:"0 12px"}},[E(w,{modelValue:L.targetFieldInfo.primaryKey,"onUpdate:modelValue":he=>L.targetFieldInfo.primaryKey=he,disabled:L.targetFieldInfo.name==="id"&&L.targetFieldInfo.primaryKey},null,8,["modelValue","onUpdate:modelValue","disabled"])])]),_:2},1024)):Xe("",!0)]}),_:2},1024))),128)):(D(),Ie("div",{key:1},"暂无可选项"))]),_:1},8,["load"])}}});const wR=Tt(SR,[["__scopeId","data-v-a1d0c7fc"]]),AR=Ce({__name:"SetFieldMapRule",props:{preName:{},settingForm:{},currentNodeId:{},dataDealMode:{}},emits:["confirm"],setup(e,{expose:t,emit:n}){const r=e,o=n,a=we(Et(r.settingForm)),i=we(!1),s=async()=>{a.value=Et(r.settingForm),await u(),Fr(()=>{i.value=!0})},l=we([]),u=async()=>{l.value=a.value.inputFieldList.map(f=>{var b;const h=f.fieldId,m=((b=a.value.mappingConfig.find(w=>w.sourceField===h))==null?void 0:b.targetField)??"",v=a.value.outputFieldList.find(w=>w.fieldId===m);return{sourceField:h,targetField:m,sourceFieldInfo:f,targetFieldInfo:v??null}})},d=async()=>{if(a.value.mappingConfig=[],a.value.inputFieldList=[],a.value.outputFieldList=[],l.value.forEach(f=>{f.sourceField&&f.targetField&&(a.value.mappingConfig.push({sourceField:f.sourceField,targetField:f.targetField}),a.value.inputFieldList.push(f.sourceFieldInfo),a.value.outputFieldList.push(f.targetFieldInfo))}),a.value.mappingConfig.length>=1)o("confirm",a.value);else return Ko.error("请选择输出表字段"),!1},c=()=>{i.value=!1};return t({open:async()=>{await s()}}),(f,h)=>{const m=Pr,v=kr,b=Nu,w=ta,L=aa;return D(),ee(L,{modelValue:i.value,"onUpdate:modelValue":h[2]||(h[2]=z=>i.value=z),title:"字段映射规则设置","destroy-on-close":"",width:"1000px"},{footer:F(()=>[E(ps,{"on-submit":d,editMode:"",onClose:c})]),default:F(()=>[E(v,{gutter:0},{default:F(()=>[E(m,{span:11},{default:F(()=>[Te("b",null,mn(f.preName),1)]),_:1}),E(m,{span:2}),E(m,{span:11},{default:F(()=>[Te("b",null,"输出表："+mn(a.value.buTableName),1)]),_:1})]),_:1}),E(w,{height:"550px"},{default:F(()=>[E(v,{gutter:0},{default:F(()=>[E(m,{span:11},{default:F(()=>[E(IR,{tableData:l.value},null,8,["tableData"])]),_:1}),E(m,{span:2},{default:F(()=>[Te("div",{style:{height:"43px"}}),(D(!0),Ie(dt,null,It(l.value,(z,K)=>(D(),Ie("div",{class:"right_arr",key:K},[E(b,null,{default:F(()=>[E(x(hg))]),_:1})]))),128))]),_:1}),E(m,{span:11},{default:F(()=>[E(wR,{dataDealMode:f.dataDealMode,id:a.value.buId,"entry-id":a.value.entryId,"bu-table":a.value.buTable,"onUpdate:buTable":h[0]||(h[0]=z=>a.value.buTable=z),"source-type":a.value.dataSources,modelValue:l.value,"onUpdate:modelValue":h[1]||(h[1]=z=>l.value=z),currentNodeId:f.currentNodeId},null,8,["dataDealMode","id","entry-id","bu-table","source-type","modelValue","currentNodeId"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const xR=Tt(AR,[["__scopeId","data-v-2aea09df"]]),RR=Ce({__name:"EntryCascader",props:{appId:{},modelValue:{}},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,r=t,o=ni(),a={lazy:!0,value:"id",children:"children",checkStrictly:!0,lazyLoad(u,d){const{level:c}=u;c===0?o.init().then(f=>{const h=f.find(m=>m.id===n.appId);h?o.load2Children(h).then(m=>{d(m)}):d([])}):c===1?o.load3Children(u.data).then(f=>{const h=f.map(m=>({...m,leaf:!0}));d(h)}):d([])}},i=we(),s=Ee({get(){return n.modelValue.split(",")},set(u){r("update:modelValue",Array.isArray(u)?u.join(","):"")}}),l=u=>{r("change"),setTimeout(()=>{var d;(d=i.value)==null||d.togglePopperVisible(!1)},50)};return(u,d)=>(D(),ee(x(Xp),{ref_key:"formCascader",ref:i,onChange:l,class:"w100",modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=c=>s.value=c),props:a,"show-all-levels":!1,clearable:""},null,8,["modelValue"]))}}),CR=Ce({__name:"SelectForm",props:{buId:{},entryId:{},currentAppId:{}},emits:["update:entryId","update:buId","change"],setup(e,{emit:t}){const n=e,r=t,o=Ee({get(){return n.entryId===n.buId?n.buId:In([n.entryId,n.buId]).join(",")},set(a){if(a){const i=a.split(","),s=i[0]??"";r("update:entryId",s);const l=i[1]??s;r("update:buId",l)}else r("update:entryId",""),r("update:buId","")}});return(a,i)=>(D(),ee(x(Xt),{label:"选择表单",required:""},{default:F(()=>[E(RR,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=s=>o.value=s),appId:a.currentAppId,onChange:i[1]||(i[1]=s=>r("change"))},null,8,["modelValue","appId"])]),_:1}))}}),NR=Ce({__name:"DataSource",props:{modelValue:{},appId:{},dataDealMode:{}},emits:["update:modelValue"],setup(e,{expose:t,emit:n}){const a=sn(e,"modelValue",n),i=Mn({buId:[{required:!0,message:()=>a.value.dataSources===zt.form?"请选择表单":a.value.dataSources===zt.dataModel?"请选择数据表":a.value.dataSources===zt.connection?"请选择数据连接":"请选择表",trigger:"change"}],buTable:[{required:!0,message:"请选择表",trigger:"change"}]});ni();const s=()=>{},l=c=>{a.value.dataProcessingRule=c?sr.cover:sr.append},u=()=>{a.value.buId="",a.value.appId="",a.value.entryId="",a.value.buTable="",a.value.buTableName="",a.value.mappingConfig=[],a.value.outputFieldList=[],a.value.inputFieldList=[]},d=we();return t({validate(){var c;return(c=d.value)==null?void 0:c.validate()}}),(c,f)=>{const h=Xt,m=ra;return D(),ee(m,{ref_key:"ElFormRef",ref:d,model:x(a),rules:i,"label-suffix":"：","label-position":"top","status-icon":""},{default:F(()=>[E(Dm,{modelValue:x(a).dataSources,"onUpdate:modelValue":f[0]||(f[0]=v=>x(a).dataSources=v),onReset:u},null,8,["modelValue"]),x(a).dataSources===x(zt).form?(D(),ee(CR,{key:0,"bu-id":x(a).buId,"onUpdate:buId":f[1]||(f[1]=v=>x(a).buId=v),"entry-id":x(a).entryId,"onUpdate:entryId":f[2]||(f[2]=v=>x(a).entryId=v),onChange:s,"current-app-id":c.appId},null,8,["bu-id","entry-id","current-app-id"])):Xe("",!0),x(a).dataSources===x(zt).dataModel?(D(),ee(Vm,{key:1,modelValue:x(a),"onUpdate:modelValue":f[3]||(f[3]=v=>wt(a)?a.value=v:null),"app-id":c.appId},null,8,["modelValue","app-id"])):Xe("",!0),x(a).dataSources===x(zt).connection?(D(),ee(km,{key:2,"is-have-primary":!1,modelValue:x(a),"onUpdate:modelValue":f[4]||(f[4]=v=>wt(a)?a.value=v:null),"app-id":c.appId,onChangePrimaryKey:l},null,8,["modelValue","app-id"])):Xe("",!0),E(h,{prop:"buId"}),c.dataDealMode===x(ur).flow?(D(),ee(Pm,{key:3,modelValue:x(a).configParams,"onUpdate:modelValue":f[5]||(f[5]=v=>x(a).configParams=v)},null,8,["modelValue"])):Xe("",!0)]),_:1},8,["model","rules"])}}}),OR=Ce({__name:"DataSetRule",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,r=t,{isBatchMode:o,isFlowMode:a}=_o(),i=Dr(n,"modelValue",r);return(s,l)=>{const u=Ru,d=na,c=fs;return D(),ee(c,{modelValue:x(i),"onUpdate:modelValue":l[0]||(l[0]=f=>wt(i)?i.value=f:null)},{default:F(()=>[x(o)?(D(),Ie(dt,{key:0},[E(u,{label:x(sr).cover},{default:F(()=>[St(" 覆盖（删除表中原数据，并插入新数据） ")]),_:1},8,["label"]),E(u,{label:x(sr).append},{default:F(()=>[St(" 追加（保留表中原数据，并插入新数据） ")]),_:1},8,["label"])],64)):Xe("",!0),x(a)?(D(),Ie(dt,{key:1},[E(d,{effect:"dark",content:"实时处理方式为追加时，无需设置目标表主键",placement:"top-start"},{default:F(()=>[Te("span",null,[n.modelValue===x(sr).append?(D(),ee(u,{key:0,label:x(sr).append},{default:F(()=>[St(" 追加（保留表中原数据，并插入新数据） ")]),_:1},8,["label"])):Xe("",!0)])]),_:1}),E(d,{effect:"dark",content:"实时处理方式为更新时，必须设置目标表主键",placement:"top-start"},{default:F(()=>[Te("span",null,[n.modelValue===x(sr).cover?(D(),ee(u,{key:0,label:x(sr).cover},{default:F(()=>[St(" 更新（根据主键更新表中数据、新增数据） ")]),_:1},8,["label"])):Xe("",!0)])]),_:1})],64)):Xe("",!0)]),_:1},8,["modelValue"])}}}),FR=Ce({__name:"Setting",props:{visible:{type:Boolean},modelValue:{}},emits:["update:visible","update:modelValue"],setup(e,{emit:t}){const o=sn(e,"modelValue",t),a=$t(),{getNodeFields:i}=Ur(),s=Ee(()=>{var v;return(v=i())==null?void 0:v[0]}),l=Ee(()=>{var m;return((m=s.value)==null?void 0:m.pNodeName)??""}),u=Ee(()=>{var m;return((m=a.selectNode)==null?void 0:m.id)??""}),d=we(),c=we(),f=async()=>{var m,v,b;try{await((m=d.value)==null?void 0:m.validate()),o.value.inputFieldList=((v=s.value)==null?void 0:v.fields)??[],(b=c.value)==null||b.open()}catch{Ko.error("请选择左侧输出表")}},h=m=>{o.value=m};return(m,v)=>{const b=ta,w=Xt,L=Lt;return D(),ee(yr,{modelValue:x(o),"onUpdate:modelValue":v[2]||(v[2]=z=>wt(o)?o.value=z:null),tabTags:["info","set"],defaultActive:"set"},{set:F(()=>[E(ua,{width:"384px"},{aside:F(()=>[E(b,null,{default:F(()=>[E(NR,{ref_key:"dataSourceRef",ref:d,modelValue:x(o),"onUpdate:modelValue":v[0]||(v[0]=z=>wt(o)?o.value=z:null),"app-id":x(a).appId,dataDealMode:x(a).dataDealMode},null,8,["modelValue","app-id","dataDealMode"])]),_:1})]),main:F(()=>[E(w,{label:"数据处理规则"},{default:F(()=>[E(OR,{modelValue:x(o).dataProcessingRule,"onUpdate:modelValue":v[1]||(v[1]=z=>x(o).dataProcessingRule=z)},null,8,["modelValue"])]),_:1}),E(w,{label:"字段映射规则"},{default:F(()=>[E(L,{plain:"",onClick:f},{default:F(()=>[St("设置规则")]),_:1}),E(xR,{ref_key:"SetFieldMapRuleRef",ref:c,"setting-form":x(o),dataDealMode:x(a).dataDealMode,preName:l.value,onConfirm:h,currentNodeId:u.value},null,8,["setting-form","dataDealMode","preName","currentNodeId"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),LR=Object.freeze(Object.defineProperty({__proto__:null,default:FR},Symbol.toStringTag,{value:"Module"})),Gm={},MR=Object.assign({"../../nodes/dataProcessing/classSummary/Setting.vue":mx,"../../nodes/dataProcessing/columnToRow/Setting.vue":bx,"../../nodes/dataProcessing/dataFilter/Setting.vue":gx,"../../nodes/dataProcessing/dataMerge/Setting.vue":Vx,"../../nodes/dataProcessing/fieldSetting/Setting.vue":Xx,"../../nodes/dataProcessing/multiTableJoin/Setting.vue":Jx,"../../nodes/dataProcessing/rowToColumn/Setting.vue":sR,"../../nodes/outInput/dataInput/Setting.vue":ER,"../../nodes/outInput/dataOutput/Setting.vue":LR});Object.entries(MR).forEach(([e,t])=>{const n=e.split(ds.sep),r=n[n.length-2];let o=t;o=o.default||o,Gm[r]=o});function DR(e){const t=Gm[e]??null;return t||console.error(`你需要查找节点类型为${e}的配置组件, 但是并没有找到, 请检查一下是否存在该类型, 或者组件路径存在问题`),t}const PR=Ce({__name:"NodeSettingPanel",setup(e){const t=$t(),n=we(!1);ao(()=>t.selectNode,()=>{n.value=mg(t.selectNode)});const r=o=>{var a,i;(i=t.selectNode)==null||i.prop("data",{...(a=t.selectNode)==null?void 0:a.prop("data"),...o})};return(o,a)=>{var i,s,l,u;return n.value&&x(t).selectNode&&((i=x(t).selectNode)==null?void 0:i.shape)!=="edge"?(D(),ee(vg(x(DR)((s=x(t).selectNode)==null?void 0:s.shape)),{key:(l=x(t).selectNode)==null?void 0:l.id,visible:n.value,"onUpdate:visible":a[0]||(a[0]=d=>n.value=d),modelValue:(u=x(t).selectNode)==null?void 0:u.data,ref:"settingRef","onUpdate:modelValue":r},null,40,["visible","modelValue"])):Xe("",!0)}}}),kR=Ce({__name:"App",props:{data:{},appId:{default:""},entryId:{default:""},flowMode:{default:Go.designer},scene:{default:Mp.dataFactory},dataDealMode:{default:ur.batch},dataId:{default:""}},setup(e,{expose:t}){const n=e,r=aE({mode:n.flowMode,appId:n.appId,entryId:n.entryId,dataId:n.dataId,scene:n.scene,viewMode:zl.simple,dataDealMode:n.dataDealMode}),o=r.TeleportContainer;return Tu(Ay,r),ni(),vn(),hs(),Ln(()=>{var a;r.renderGraph({container:document.getElementById("container"),cells:((a=n.data)==null?void 0:a.cells)??[]})}),t({getGraphData:async()=>{var i;return((i=r.getGraphData())==null?void 0:i.cells)??[]},clearGraphData:r.clearGraphData}),(a,i)=>(D(),Ie(dt,null,[Te("div",{class:"designer-flow"},[x(r).graphInstance?(D(),ee(sE,{key:0,id:"dndContainer",onDargInNode:i[0]||(i[0]=(s,l)=>x(r).dargInNode(s,l)),scene:a.scene},null,8,["scene"])):Xe("",!0),Te("div",{class:"flow-content"},[Te("div",{class:"toolbar"},[E(zA,null,{"right-operation":F(()=>[Rr(a.$slots,"right-operation",{},void 0,!0)]),_:3})]),Te("div",{id:"container"}),Te("div",{class:"set_panel_wrap"},[x(r).graphInstance&&[x(Go).designer].includes(a.flowMode)?(D(),ee(PR,{key:0})):Xe("",!0)])])]),E(x(o))],64))}});const VR=Tt(kR,[["__scopeId","data-v-02b30ef9"]]),BR=Ce({__name:"DesignHeader",props:{graphData:{},dataStreamId:{},loading:{type:Boolean}},emits:["back","update:graphData","saveGraph","publishData"],setup(e,{emit:t}){const n=e,r=t,o=we(Et(n.graphData.name??"")),a=we(!1),i=we(),s=we(!1),l=async()=>{if(o.value&&o.value!==n.graphData.name){a.value=!0;try{await cf({id:n.dataStreamId,name:o.value}),r("update:graphData",{...n.graphData,name:o.value})}catch{o.value=n.graphData.name}finally{a.value=!1}}s.value=!1},u=()=>{var b;(b=i.value)==null||b.blur()},d=()=>{s.value=!0,Fr(()=>{var b;(b=i.value)==null||b.focus()})},c=we(Et(n.graphData.description??"")),f=we(!1),h=async()=>{try{f.value=!0,await cf({id:n.dataStreamId,description:c.value})}catch{c.value=n.graphData.description}finally{f.value=!1}},m=()=>{r("saveGraph")},v=()=>{r("publishData")};return(b,w)=>{const L=Nu,z=na,K=Lt,he=Eu;return D(),Ie("div",{class:"header-box"},[Te("div",{class:"header-left"},[E(L,{class:"designer-back",onClick:w[0]||(w[0]=Fe=>r("back"))},{default:F(()=>[E(x(_g))]),_:1}),b.graphData.name?(D(),Ie("div",{key:0,class:"designer-rename"},[lf(E(yg,{class:"ml-5 rename-input",modelValue:o.value,"onUpdate:modelValue":w[1]||(w[1]=Fe=>o.value=Fe),isBlurCache:"",placeholder:"请输入名称",onBlur:l,readonly:a.value,onKeyup:qa(u,["enter"]),ref_key:"renameInputRef",ref:i,maxlength:"10",title:"重命名"},{suffix:F(()=>[a.value?(D(),ee(L,{key:0,class:"is-loading"},{default:F(()=>[E(x(bg))]),_:1})):Xe("",!0)]),_:1},8,["modelValue","readonly","onKeyup"]),[[uf,s.value]]),E(z,{effect:"dark",content:"重命名",placement:"bottom","show-after":200},{default:F(()=>[lf(Te("div",{class:"rename-display",onClick:d},[Te("span",{class:"rename-name az-ellipsis"},mn(o.value),1)],512),[[uf,!s.value]])]),_:1})])):Xe("",!0)]),Te("div",{class:"designer_operate"},[E(he,{width:"300",trigger:"click",title:"流程备注",onAfterLeave:h},{reference:F(()=>[E(K,{type:"primary",loading:f.value,text:""},{default:F(()=>[St("备注")]),_:1},8,["loading"])]),default:F(()=>[E(x(Cn),{type:"textarea",modelValue:c.value,"onUpdate:modelValue":w[2]||(w[2]=Fe=>c.value=Fe),placeholder:"请输入流程备注"},null,8,["modelValue"])]),_:1}),E(K,{loading:b.loading,onClick:m},{default:F(()=>[St("保 存")]),_:1},8,["loading"]),E(K,{loading:b.loading,type:"primary",onClick:v},{default:F(()=>[St(" 发 布 ")]),_:1},8,["loading"])])])}}});const UR=Tt(BR,[["__scopeId","data-v-0c109e96"]]),GR=Ce({__name:"routePage",setup(e){const t=Oa("dataStreamId"),n=Oa("appId"),r=Oa("appEntryId"),o=Oa("dataDealMode"),a=Oa("flowMode"),i=we(),s=we(""),l=we(""),u=we(),d=we(!1),c=async()=>{var v;d.value=!0;try{const b=await((v=i.value)==null?void 0:v.getGraphData());b&&(await Mg({dataStreamId:t.value,cells:b??[],appId:n.value}),Ko.success("保存成功!"))}catch{d.value=!1}finally{d.value=!1}},f=async()=>{var v;d.value=!0;try{const b=await((v=i.value)==null?void 0:v.getGraphData());b&&(await Dg({dataStreamId:t.value,cells:b??[],appId:n.value}),Ko.success("发布成功!"))}catch{d.value=!1}finally{d.value=!1}},h=async()=>{const v=await Pg(t.value);u.value=v,s.value=v==null?void 0:v.name,l.value=v==null?void 0:v.description},m=()=>{n.value?df(gg,{replace:!0,query:{appId:n.value,app_setting_menu:"data_factory"}}):df(Eg,{replace:!0})};return(v,b)=>{const w=ny;return D(),ee(w,{load:h,class:"eventFlow_designer_page",queryKeys:["dataStreamId","appId","dataDealMode","flowMode"]},{default:F(()=>[u.value&&x(t)?(D(),ee(UR,{key:0,class:"eventFlow_page-header",loading:d.value,graphData:u.value,"onUpdate:graphData":b[0]||(b[0]=L=>u.value=L),dataStreamId:x(t),onBack:m,onSaveGraph:c,onPublishData:f},null,8,["loading","graphData","dataStreamId"])):Xe("",!0),Te("div",{class:"eventFlow_page-container"},[u.value?(D(),ee(VR,{key:0,data:u.value,ref_key:"eventFlow",ref:i,dataId:x(t),appId:x(n),entryId:x(r),dataDealMode:x(o),flowMode:x(a)},null,8,["data","dataId","appId","entryId","dataDealMode","flowMode"])):Xe("",!0)])]),_:1})}}});const OC=Tt(GR,[["__scopeId","data-v-5005b62c"]]);export{OC as default};

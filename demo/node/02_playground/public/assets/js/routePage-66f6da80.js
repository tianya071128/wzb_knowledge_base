import{r as i,sX as T,c,bs as V,sY as _,d as D,sZ as w,s_ as A,s$ as z,bp as L,t0 as B,i as r,as as F,bi as h,o as v,f as E,k as P,B as s,C as x,w as I,m as O,b as S,l as U,fx as $,aN as M,U as R,_ as q}from"./index-b80d5ef5.js";import{A as j}from"./AppListTree-72b42f39.js";import{g as G,l as H,e as W}from"./log-64267fd3.js";import{_ as X}from"./DetailDrawer.vue_vue_type_script_setup_true_lang-c85f86c1.js";const Y=()=>{const g=i(!1),t=i(""),u=T(),m=c(()=>u.isPlatformAdmin),d=c(()=>{let a=[{label:"操作人",prop:"createName"},{label:"操作账号",prop:"account"},{label:"所属机构",prop:"orgName"},{label:"手机号码",prop:"phone"},{label:"操作时间",prop:"createTime"},{label:"应用/表单",prop:"appOrForm"},{label:"操作类型",prop:"operationType"},{label:"功能模块",prop:"module"},{label:"操作详情",prop:"logDetail"},{label:"IP",prop:"remoteAddr"},{label:"操作结果",prop:"isFail",formatter:p=>V(p.isFail,_)},{label:"失败原因",prop:"failInfo"}];return m.value||(a=a.filter(p=>p.prop!=="orgName")),a});return{detailVisible:g,items:d,logId:t,loadDetails:async()=>await G(t.value)}},Z=Y,J=D({__name:"routePage",setup(g){const t=i(""),u=i(),m=T(),d=c(()=>m.isPlatformAdmin),y=c(()=>{var l;const o={query:{list:[{label:"操作人",prop:"createName",type:"input"},{label:"手机号码",prop:"phone",type:"input"},{label:"功能模块",prop:"module",type:"select",options:w},{label:"表单名称",prop:"entryId",type:"select",options:async()=>(await A(t.value||"0")).map(n=>({label:n.name,value:n.id})),isVirtualized:!0},{label:"操作类型",prop:"operationType",type:"select",options:z},{label:"操作时间",prop:["startTime","endTime"],type:"timerange"},{label:"操作结果",prop:"isFail",type:"select",options:L(_)}]},request:{api:H,extraParams:{logType:B.appManage,appId:t.value}},table:{tableProps:{height:"100%"},tableCols:[{label:"操作人",prop:"createName"},{label:"操作账号",prop:"account"},{label:"所属机构",prop:"orgName"},{label:"手机号码",prop:"phone"},{label:"操作时间",prop:"createTime"},{label:"应用/表单",prop:"appOrForm"},{label:"功能模块",prop:"module"},{label:"操作类型",prop:"operationType"},{label:"操作详情",prop:"logDetail",minWidth:"200px",slots:{default({row:e}){return r("div",{innerHTML:e.logDetail},null)}}},{label:"IP",prop:"remoteAddr"},{label:"操作结果",prop:"isFail",slots:{default({row:e}){return r("span",null,[V(e.isFail,_)])}}},{label:"失败原因",prop:"failInfo",showOverflowTooltip:!0},{label:"操作",slots:{default({row:e}){return r(F,{list:[{id:"view",type:"primary",text:"查看详情",onClick:()=>{C.value=e.id,a.value=!0}}]},null)}}}]}};return!d.value&&((l=o.table)!=null&&l.tableCols)&&(o.table.tableCols=o.table.tableCols.filter(e=>e.prop!=="orgName")),o}),{detailVisible:a,items:p,logId:C,loadDetails:N}=Z(),b=i(!1),k=async()=>{var o;try{b.value=!0;const l=(o=u.value)==null?void 0:o.handleGetParams();await W($(l,["limit","current"])),M.success("导出成功")}finally{b.value=!1}};return(o,l)=>{const e=R,n=h("az-page");return v(),E("div",{class:"layout_box az_layout_tree"},[P("div",{class:"az_page_tree"},[r(j,{modelValue:s(t),"onUpdate:modelValue":l[0]||(l[0]=f=>x(t)?t.value=f:null),class:"app-tree"},null,8,["modelValue"])]),P("div",{class:"az_page_table"},[r(n,{ref_key:"azPageRef",ref:u,config:s(y)},{operation:I(()=>[r(e,{type:"warning",onClick:k,loading:s(b)},{default:I(()=>[O(" 导出 ")]),_:1},8,["loading"])]),_:1},8,["config"]),s(a)?(v(),S(X,{key:0,list:s(p),modelValue:s(a),"onUpdate:modelValue":l[1]||(l[1]=f=>x(a)?a.value=f:null),load:s(N)},null,8,["list","modelValue","load"])):U("",!0)])])}}});const le=q(J,[["__scopeId","data-v-7953f8ef"]]);export{le as default};

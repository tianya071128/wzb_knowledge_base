import{d as U,v as z,o as p,f as C,k as S,F as E,g as N,p as le,B as f,t as J,_ as q,c as O,i as u,w as m,a3 as K,a as H,a8 as ae,ac as X,r as I,bx as se,C as P,b as k,dj as ne,mu as oe,l as L,aT as de,fV as Y,bi as ue,m as M,U as Z,bn as re,gv as R,R as ie,x as ce,y as me,K as pe,H as W,h as _e,dl as ye,bp as fe,gj as Q,bs as ge,L as be,q as ve,br as he,Q as Ve,N as Ie,O as Ce}from"./index-b80d5ef5.js";/* empty css                          */import{c as D,a as Te,g as ke}from"./utils-a7200637.js";import{g as Se}from"./messageTemplate-8658e6b4.js";const we=U({__name:"select-tab",props:{active:{},list:{}},emits:["update:active","clickActive"],setup(T,{emit:V}){const y=T,s=V,r=z(y,"active",s),t=async n=>{r.value=n.__id__,s("clickActive",n)};return(n,b)=>(p(),C("div",{class:"select-tab-content right-border select-padding"},[S("ul",{class:"dynamic-type"},[(p(!0),C(E,null,N(n.list,e=>(p(),C("li",{class:le({"dynamic--active":f(r)===e.__id__}),onClick:l=>t(e),key:e.__id__},J(e.__label__),11,["onClick"]))),128))])]))}});const Be=q(we,[["__scopeId","data-v-90ba90c0"]]),xe=U({__name:"SelectorsDynamicCustom",props:{modelValue:{},dynamicList:{},sourceId:{},entryId:{}},emits:["update:modelValue"],setup(T,{emit:V}){const y=T,s=V,r=e=>{const l=[H.input];return ae(e,{blockFilter(c){return c.type===H.subform},excludeFilter(c){return!l.includes(c.type)}})},t=(e,l)=>e.indexOf("custom")!==-1&&e.indexOf(l)!==-1,n=O({get(){const e=y.modelValue.find(l=>t(l,D.phone));if(e){const l=e.split("@")[3];return{fieldId:l,fieldType:l.split("_")[1]}}else return null},set(e){const c=[...y.modelValue.filter(i=>!t(i,D.phone))];e&&c.push(`custom@${D.phone}@${e==null?void 0:e.fieldType}@${e==null?void 0:e.fieldId}`),s("update:modelValue",[...c])}}),b=O({get(){const e=y.modelValue.find(l=>t(l,D.email));if(e){const l=e.split("@")[3];return{fieldId:l,fieldType:l.split("_")[1]}}else return null},set(e){const c=[...y.modelValue.filter(i=>!t(i,D.email))];e&&c.push(`custom@${D.email}@${e==null?void 0:e.fieldType}@${e==null?void 0:e.fieldId}`),s("update:modelValue",[...c])}});return(e,l)=>{const c=X;return p(),C("div",{class:"custom_wrapper"},[u(c,{label:"手机号：","label-width":"100px"},{default:m(()=>[S("div",null,[S("p",{class:"Gray_75"},"指定手机号字段，用于发送短信"),u(K,{style:{width:"300px"},modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=i=>n.value=i),sourceId:e.sourceId,entryId:e.entryId,filter:r,placeholder:"选择手机号",clearable:"",prop:{fieldId:"fieldId",fieldType:"fieldType",subformId:"subformId"}},null,8,["modelValue","sourceId","entryId"])])]),_:1}),u(c,{label:"邮箱：","label-width":"100px"},{default:m(()=>[S("div",null,[S("p",{class:"Gray_75"},"指定邮箱字段，用于发送邮件"),u(K,{style:{width:"300px"},modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=i=>b.value=i),sourceId:e.sourceId,entryId:e.entryId,filter:r,placeholder:"选择邮箱",prop:{fieldId:"fieldId",fieldType:"fieldType",subformId:"subformId"}},null,8,["modelValue","sourceId","entryId"])])]),_:1})])}}});const De=q(xe,[["__scopeId","data-v-40c36562"]]),Oe=U({__name:"SelectorsDynamic",props:{dynamicList:{},modelValue:{},sourceId:{},entryId:{}},emits:["update:modelValue"],setup(T,{emit:V}){const y=T,r=z(y,"modelValue",V),t=I(),n=I(""),b=I(!0);se(()=>{n.value=y.dynamicList[0].__id__;const i=y.dynamicList.find(_=>_.__id__===n.value);t.value=i});const e=I(),l=i=>{t.value=i,b.value=!1,de(()=>{b.value=!0})},c=async()=>{var _;return{records:[...((_=t.value)==null?void 0:_.children)??[]],total:1}};return(i,_)=>(p(),C("div",{class:"dynamic_wrapper"},[u(Be,{class:"dynamicTabOptions",active:n.value,"onUpdate:active":_[0]||(_[0]=g=>n.value=g),onClickActive:l,list:i.dynamicList},null,8,["active","list"]),b.value?(p(),C("div",{key:0,class:"dynamicContent"},[t.value?(p(),C(E,{key:0},[t.value.__id__==="custom"?(p(),C("div",{key:0},[u(De,{modelValue:f(r),"onUpdate:modelValue":_[1]||(_[1]=g=>P(r)?r.value=g:null),dynamicList:t.value.children,sourceId:i.sourceId,entryId:i.entryId},null,8,["modelValue","dynamicList","sourceId","entryId"])])):(p(),k(oe,{key:1,modelValue:f(r),"onUpdate:modelValue":_[2]||(_[2]=g=>P(r)?r.value=g:null),ref_key:"TabPaneWrapperRef",ref:e,class:"select-tab-content",multiple:"",type:f(ne).dynamic,load:c},null,8,["modelValue","type"]))],64)):L("",!0)])):L("",!0)]))}});const Ue=q(Oe,[["__scopeId","data-v-61dc7ed3"]]),Le=U({__name:"TemplateSelectorDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","change"],setup(T,{emit:V}){const y=T,s=V,r=z(y,"modelValue",s),t=()=>{s("change",n.value),r.value=!1},n=I(""),b=O(()=>({id:"lowcode_message_template_select",query:{list:[{type:"input",label:"模板名称",prop:"templateName"},{type:"input",label:"模板内容",prop:"templateContent"},{type:"select",label:"使用场景",prop:"templateUsage",options:"msg_template_usage",extraOptions:[{label:"全部",value:""}]}]},request:{api:Se},table:{tableCols:[{prop:"templateName",label:"模板名称",width:"200px"},{prop:"templateContent",label:"模板内容",slots:{default({row:e}){return u(Y,{modelValue:e.templateContent,preview:!0,group:[{id:"msg",title:"模板关键字",dictOptions:{dictKey:"msg_template_keyword"}}]},null)}}}],tableProps:{height:"300px",highlightCurrentRow:!0,"onCurrent-change":e=>{n.value=e.templateContent}}},operation:{hideTableOperation:!0}}));return(e,l)=>{const c=ue("az-page"),i=Z,_=re;return p(),k(_,{modelValue:f(r),"onUpdate:modelValue":l[1]||(l[1]=g=>P(r)?r.value=g:null),title:"选择模板",width:"800","append-to-body":""},{footer:m(()=>[S("span",{class:"dialog-footer"},[u(i,{onClick:l[0]||(l[0]=g=>r.value=!1)},{default:m(()=>[M("取消")]),_:1}),u(i,{type:"primary",onClick:t,disabled:!f(n)},{default:m(()=>[M(" 确定 ")]),_:1},8,["disabled"])])]),default:m(()=>[u(c,{config:f(b)},null,8,["config"])]),_:1},8,["modelValue"])}}}),$e=U({__name:"TemplateSelector",emits:["change"],setup(T,{emit:V}){const y=V,s=I(!1),r=t=>{y("change",t)};return(t,n)=>{const b=Z;return p(),C("div",null,[u(b,{onClick:n[0]||(n[0]=e=>s.value=!0)},{default:m(()=>[M("模板选择")]),_:1}),u(Le,{modelValue:f(s),"onUpdate:modelValue":n[1]||(n[1]=e=>P(s)?s.value=e:null),onChange:r},null,8,["modelValue"])])}}}),Fe=U({__name:"MessageRemindConfig",props:{labelWidth:{default:"100px"},hideMemberSelect:{type:Boolean},hideTemplateSelector:{type:Boolean},disabledMemberSelect:{type:Boolean},sourceId:{},entryId:{},fields:{},fieldsGroupTitle:{},extraDynamicOptions:{},modelValue:{default:()=>({selectors:[],msgBase:[{fields:[],channel:R.mail,title:"",rawContent:""}],hasSubDept:"0"})},memberSelectRequired:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(T,{expose:V,emit:y}){const s=T,t=ie(s,"modelValue",y),n=I([]),b=I([]),e=ce(),l=async()=>{const a=await ke({entryId:s.entryId,extraDynamicOptions:s.extraDynamicOptions,sourceId:s.sourceId,dataSystem:e});n.value=a.dynamicOptions,b.value=function o(v){return v.map(h=>({__id__:h.id,__label__:h.name,children:h.children?o(h.children):[]}))}(n.value)},c=O({get(){return t.value.hasSubDept==="1"},set(a){a&&(t.value.hasSubDept=a?"1":"0")}}),i=I(s.modelValue.msgBase[0]),_=O({get(){var a;return((a=t.value.msgBase)==null?void 0:a.map(o=>o.channel))??[]},set(a){t.value.msgBase=a.sort((o,v)=>+o-+v).map(o=>{var v;return((v=t.value.msgBase)==null?void 0:v.find(h=>h.channel===o))??{...i.value,channel:o}})}}),g=I(R.mail);me(()=>[...t.value.msgBase??[]],a=>{var o;a.some(v=>v.channel===g.value)||(g.value=((o=a[0])==null?void 0:o.channel)??R.mail)},{immediate:!0});const A=(a,o)=>{var h;return`msgBase.${(h=t.value.msgBase)==null?void 0:h.findIndex(B=>B.channel===a)}.${o}`},ee=O(()=>[{id:"field",title:s.fieldsGroupTitle?s.fieldsGroupTitle:s.entryId?"当前表单控件":"当前数据集控件",fieldOptions:{entryId:s.entryId,sourceId:s.sourceId,fields:s.fields}},{id:Te,title:"URL 链接",urlOptions:{},hidden:g.value==R.mail},{id:"msg",title:"模板关键字",hidden:!0,dictOptions:{dictKey:"msg_template_keyword"}}]),G=I();return V({validate:async()=>{var a,o;await((o=(a=G.value)==null?void 0:a.ruleFormRef)==null?void 0:o.validate().catch(v=>{var B,$,F;const h=($=(B=Object.keys(v).find(x=>x.startsWith("msgBase.")))==null?void 0:B.split("."))==null?void 0:$[1];if(h){const x=(F=t.value.msgBase[Number(h)])==null?void 0:F.channel;x&&(g.value=x)}return Promise.reject(v)})),t.value}}),(a,o)=>{const v=ve,h=he,B=Ve,$=Ie,F=Ce,x=X;return p(),k(be,{load:l,style:{width:"100%"}},{default:m(()=>[u(pe,{model:f(t),ref_key:"azFormRef",ref:G},{default:m(()=>{var j;return[a.hideMemberSelect?L("",!0):(p(),k(W,{key:0,label:"提醒人",labelWidth:a.labelWidth,prop:"selectors",rules:a.memberSelectRequired?[{required:!0,message:"请选择提醒人",trigger:"change"}]:void 0},{default:m(()=>[S("div",{class:"message-selectors"},[_e(a.$slots,"selectors-prefix",{},void 0,!0),u(ye,{modelValue:f(t).selectors,"onUpdate:modelValue":o[0]||(o[0]=d=>f(t).selectors=d),class:"message-selectors-pane",dynamicOptionsPlus:n.value,"is-child-org":"",childOrg:c.value,"onUpdate:childOrg":o[1]||(o[1]=d=>c.value=d),multiple:"",disabled:!!a.disabledMemberSelect},{dynamic:m(({modelValue:d,updateValue:w})=>[u(Ue,{dynamicList:b.value,modelValue:d,sourceId:a.sourceId,entryId:a.entryId,"onUpdate:modelValue":te=>w(te)},null,8,["dynamicList","modelValue","sourceId","entryId","onUpdate:modelValue"])]),_:1},8,["modelValue","dynamicOptionsPlus","childOrg","disabled"])])]),_:3},8,["labelWidth","rules"])),u(W,{label:"提醒方式",labelWidth:a.labelWidth,rules:[{required:!0,message:"请选择提醒方式",trigger:"change"}],prop:"msgBase"},{default:m(()=>[u(h,{modelValue:_.value,"onUpdate:modelValue":o[2]||(o[2]=d=>_.value=d)},{default:m(()=>[(p(!0),C(E,null,N(f(fe)(f(Q)),d=>(p(),k(v,{key:d.value,label:d.value},{default:m(()=>[M(J(d.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["labelWidth"]),(j=_.value)!=null&&j.length?(p(),k(x,{key:1,label:"提醒内容",labelWidth:a.labelWidth,class:"message_content"},{default:m(()=>[u(F,{style:{width:"100%"},modelValue:g.value,"onUpdate:modelValue":o[3]||(o[3]=d=>g.value=d),type:"border-card"},{default:m(()=>[(p(!0),C(E,null,N(f(t).msgBase,d=>(p(),k($,{key:d.channel,label:f(ge)(d.channel,f(Q)),name:d.channel},{default:m(()=>[u(W,{style:{"margin-bottom":"6px"},hideLabel:"",prop:A(d.channel,"title"),rules:[{required:!0,message:"请输入标题",trigger:"change"}]},{default:m(()=>[u(B,{placeholder:"标题",modelValue:d.title,"onUpdate:modelValue":w=>d.title=w},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]),u(W,{hideLabel:"",prop:A(d.channel,"rawContent"),rules:[{required:!0,message:"请输入内容",trigger:"change"}]},{default:m(()=>[S("div",{class:"content-wrap"},[u(Y,{modelValue:d.rawContent,"onUpdate:modelValue":w=>d.rawContent=w,group:ee.value},null,8,["modelValue","onUpdate:modelValue","group"]),a.hideTemplateSelector?L("",!0):(p(),k($e,{key:0,onChange:w=>{d.rawContent+=w},class:"ml-10"},null,8,["onChange"]))])]),_:2},1032,["prop"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["labelWidth"])):L("",!0)]}),_:3},8,["model"])]),_:3})}}});const qe=q(Fe,[["__scopeId","data-v-b1f49220"]]);export{qe as M};

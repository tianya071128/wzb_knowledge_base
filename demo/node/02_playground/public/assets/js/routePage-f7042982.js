import{d as C,aY as k,bf as v,r as f,c as I,D as A,i as t,n as D,A as m,bg as S,bh as P,as as q,bi as z,o as B,f as N,w as y,m as R,B as T,bj as _,U as V,bk as $,aN as b,bl as U}from"./index-b80d5ef5.js";import{_ as j,a as F}from"./FormLabel.vue_vue_type_script_setup_true_lang-ceed9d28.js";import{u as L}from"./useExtractQuery-f96f705c.js";const Y=C({__name:"routePage",setup(M){k();const c=v(),p=L("appId"),h=()=>{c(_,{query:{appId:p.value}})},d=f(),u=()=>{var e;(e=d.value)==null||e.refresh()},g=f(),E=I(()=>({id:"lowCode_aggregationTable",query:{list:[{type:"input",label:"名称",prop:"name"}]},request:{api:A,extraParams:{appId:p.value}},table:{tableCols:[{label:"名称",prop:"name"},{label:"说明",prop:"desc"},{label:"数据来源表",prop:"source",slots:{default({row:e}){var l,r;const a=e.aggregateJson;if(a.isSql==="1")return t("div",null,["自定义SQL"]);const n=D([{type:m.form,id:(l=a==null?void 0:a.dataSources)==null?void 0:l.singleEntryId},...((r=a.dataSources)==null?void 0:r.multiples)??[]]).filter(s=>!!(s!=null&&s.id)),o=n.map((s,x)=>{const i=[];return s.type===m.form?i.push(t(j,{entryId:s.id},null)):i.push(t(F,{id:s.id},null)),x!==n.length-1&&i.push("、"),i});return t("div",null,[o])}}},{prop:"isEnable",label:"状态",slots:{default({row:e}){return t(P,{modelValue:e.isEnable,"onUpdate:modelValue":a=>e.isEnable=a,updateFetch:async()=>{await S(e.id),u()}},null)}}},{fixed:"right",width:200,label:"操作",slots:{default({row:e}){let l=[{id:"1",type:"primary",onClick:()=>{c(_,{query:{appId:p.value,id:e.id}})},text:"编辑"},{id:"2",type:"primary",onClick:async()=>{await $(e.id),b.success("复制成功"),u()},text:"复制"},{id:"3",type:"danger",text:"删除",popconfirmProps:{title:"删除后，将不可恢复，确认要删除？",confirm:async()=>{await U(e.id),b.success("删除成功"),u()}}}];return e.isEnable==0&&(l=l.filter(r=>r.text==="复制")),t(q,{key:e.id,num:3,list:l},null)}}}]},operation:{fullEl:g}}));return(e,a)=>{const n=V,o=z("az-page");return B(),N("div",{ref_key:"pendingRef",ref:g,class:"layout_box"},[t(o,{config:T(E),ref_key:"azPageRef",ref:d},{operation:y(()=>[t(n,{onClick:h,type:"primary"},{default:y(()=>[R("新增聚合表")]),_:1})]),_:1},8,["config"])],512)}}});export{Y as default};

import{d as se}from"./default-component-4c80201b.js";import{d as j,o as d,f as A,k as w,B as u,i as P,j as Q,t as Y,l as D,b,_ as W,R as ee,c as F,mh as k,n as ue,mi as ae,F as L,w as _,g as G,cj as pe,mj as me,bt as de,mk as ie,H,a3 as ce,aT as fe,a8 as J,a as ye,ao as ve,ap as Ie,ac as ge,ml as _e,mm as Pe,z as X,Y as K,a9 as be,r as U,mn as Ce,mo as Ve,g2 as he,m as N,p as te,mp as Ee,K as Se,eh as ke,dC as Fe,dD as Te,v as M,x as ne,y as qe,mq as Re,C as Z,I as oe,fx as le,L as $e,a$ as x,$ as De,mr as Ue,h as Ae,e as Be,S as ze,a2 as Oe,Q as we,U as Ke,bn as Ne}from"./index-b80d5ef5.js";import{B as je}from"./ButtonState-cb54910b.js";import{S as Le}from"./SelectFieldByMultEntry-84abd0c3.js";import{m as Me}from"./fieldDefaultComponent-58752d9c.js";import{_ as We}from"./SelectCascaderEntry.vue_vue_type_script_setup_true_lang-673c5dca.js";import{_ as He}from"./SelectForm.vue_vue_type_script_setup_true_lang-0170236d.js";const Je=j({__name:"ComponentDisplay",props:{componentInfo:{}},setup(B){return(h,p)=>(d(),A("div",{class:"component-content"},[w("img",{class:"component-icon",src:h.componentInfo.icon||u(se),alt:""},null,8,["src"]),w("div",{class:"components-other"},[w("div",{class:"other-header"},[P(Q,{class:"components-name",content:h.componentInfo.name},null,8,["content"]),h.componentInfo.version?(d(),A("div",{key:0,class:"components-version az-ellipsis"}," 版本："+Y(h.componentInfo.version),1)):D("",!0)]),h.componentInfo.refer?(d(),b(Q,{key:0,class:"components-remark",content:h.componentInfo.refer},null,8,["content"])):D("",!0)])]))}});const sa=W(Je,[["__scopeId","data-v-72248efe"]]),Qe=j({inheritAttrs:!1,__name:"ParamsValueSet",props:{modelValue:{},paramInfo:{},appId:{},getParamsTypeOptions:{},currentEntryInfo:{},group:{}},emits:["update:modelValue","typeChange"],setup(B,{emit:h}){const p=B,v=h,r=ee(p,"modelValue",v),c=(a="请输入")=>{var o;return(o=p.paramInfo)!=null&&o.param.required?[{required:!0,message:a,trigger:"change"}]:[]},S=()=>{fe(()=>{v("typeChange",r.value)})},T=F(()=>{var a,o,f,t;return((o=(a=p.paramInfo)==null?void 0:a.parentParam)==null?void 0:o.type)===k.custom?"父参数设置为自定义时, 子参数无需设置!":(f=p.paramInfo)!=null&&f.parentParam&&!((t=p.paramInfo)!=null&&t.parentParam.value)&&!p.paramInfo.parentParam.fieldId?"请先设置父参数的具体取值":""}),E=a=>{var o,f,t;return(f=(o=p.paramInfo)==null?void 0:o.param.subCelements)!=null&&f.length?J(a,{excludeFilter(e){return e.type!==ye.subform}}):(t=p.paramInfo)!=null&&t.parentParam?J(a,{excludeFilter(e,s,m){var y,l,C;return((y=m==null?void 0:m.parentField)==null?void 0:y.fieldId)!==((C=(l=p.paramInfo)==null?void 0:l.parentParam)==null?void 0:C.fieldId)}}):J(a,{excludeFilter(e,s){return!(s!=null&&s.isFormItem)}})},I=F({get(){return{fieldId:r.value.fieldId,entryId:r.value.entryId}},set(a){r.value.fieldId=a.fieldId,r.value.entryId=a.entryId}}),z=F(()=>{var a;return(a=p.paramInfo)!=null&&a.parentParam?{entryIds:ue(p.paramInfo.parentParam.entryId)}:{appId:p.appId??""}}),q=F(()=>{var a,o;return((a=p.paramInfo)==null?void 0:a.param)&&ae((o=p.paramInfo)==null?void 0:o.param)}),O=F(()=>q.value&&Me(q.value.type)),$=F({get(){return r.value.entryId?{appId:r.value.appId??p.appId??"",entryId:r.value.entryId}:void 0},set(a){r.value.appId=a==null?void 0:a.appId,r.value.entryId=a==null?void 0:a.entryId}}),n=F({get(){return r.value.entryId},set(a){r.value.appId=void 0,r.value.entryId=a}});return(a,o)=>{var s,m,y,l,C;const f=ve,t=Ie,e=ge;return d(),A("div",{class:"params_value"},[T.value?(d(),A("div",{key:1,class:"params_value-tip"},Y(T.value),1)):(d(),A(L,{key:0},[P(e,null,{default:_(()=>[P(t,{modelValue:u(r).type,"onUpdate:modelValue":o[0]||(o[0]=i=>u(r).type=i),placeholder:"请选择",style:{width:"120px","margin-right":"10px"},onChange:S},{default:_(()=>{var i;return[(d(!0),A(L,null,G(a.getParamsTypeOptions(u(r),(i=a.paramInfo)==null?void 0:i.parentParam),(R,V)=>(d(),b(f,{key:V,label:R.label,value:R.value},null,8,["label","value"]))),128))]}),_:1},8,["modelValue"])]),_:1}),u(r).type===u(k).custom?(d(),b(e,{key:0,prop:`${(s=a.paramInfo)==null?void 0:s.propPrefix}.value`,class:"params_value-fill",rules:[...c()]},{default:_(()=>[(d(),b(pe(O.value),{modelValue:u(r).value,"onUpdate:modelValue":o[1]||(o[1]=i=>u(r).value=i),field:q.value,mode:u(me).customBtn,isParse:"",group:a.group},null,8,["modelValue","field","mode","group"]))]),_:1},8,["prop","rules"])):D("",!0),u(r).type===u(k).system?(d(),b(e,{key:1,prop:`${(m=a.paramInfo)==null?void 0:m.propPrefix}.value`,class:"params_value-fill",rules:[...c("请选择")]},{default:_(()=>[P(de,{modelValue:u(r).value,"onUpdate:modelValue":o[2]||(o[2]=i=>u(r).value=i),load:u(ie)},{default:_(({options:i})=>[(d(!0),A(L,null,G(i,(R,V)=>(d(),b(f,{key:V,label:R.label,value:R.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","load"])]),_:1},8,["prop","rules"])):D("",!0),u(r).type===u(k).form?(d(),b(H,{key:2,prop:`${(y=a.paramInfo)==null?void 0:y.propPrefix}.entryId`,hideLabel:"",class:"params_value-fill",rules:[...c("请选择")]},{default:_(()=>[u(r).acrossApp?(d(),b(We,{key:0,class:"w100",modelValue:$.value,"onUpdate:modelValue":o[3]||(o[3]=i=>$.value=i),appId:a.appId,isType:""},null,8,["modelValue","appId"])):(d(),b(He,{key:1,modelValue:n.value,"onUpdate:modelValue":o[4]||(o[4]=i=>n.value=i),appId:a.appId},null,8,["modelValue","appId"]))]),_:1},8,["prop","rules"])):D("",!0),u(r).type===u(k).field?(d(),b(H,{key:3,prop:`${(l=a.paramInfo)==null?void 0:l.propPrefix}.fieldId`,hideLabel:"",class:"params_value-fill",rules:[...c("请选择")]},{default:_(()=>[P(Le,{modelValue:I.value,"onUpdate:modelValue":o[5]||(o[5]=i=>I.value=i),entryInfo:z.value,isSelectSubform:"",filter:E},null,8,["modelValue","entryInfo"])]),_:1},8,["prop","rules"])):D("",!0),u(r).type===u(k).currentField?(d(),b(H,{key:4,prop:`${(C=a.paramInfo)==null?void 0:C.propPrefix}.fieldId`,hideLabel:"",class:"params_value-fill",rules:[...c("请选择")]},{default:_(()=>{var i,R,V;return[P(ce,{modelValue:I.value,"onUpdate:modelValue":o[6]||(o[6]=g=>I.value=g),isSelectSubform:"",filter:E,fields:(i=a.currentEntryInfo)==null?void 0:i.fields,"entry-id":(R=a.currentEntryInfo)==null?void 0:R.entryId,"source-id":(V=a.currentEntryInfo)==null?void 0:V.sourceId,prop:{fieldId:"fieldId",entryId:"entryId"}},null,8,["modelValue","fields","entry-id","source-id"])]}),_:1},8,["prop","rules"])):D("",!0)],64))])}}});const Ye=W(Qe,[["__scopeId","data-v-b3f6a43d"]]),Ge=j({__name:"ComponentPublicParamsSet",props:{modelValue:{},componentInfo:{},appId:{},currentEntryInfo:{},hideCurrentEntryInfo:{type:Boolean},group:{},paramsTypeOptions:{},ignoreKeys:{}},emits:["update:modelValue"],setup(B,{expose:h,emit:p}){const v=B,c=ee(v,"modelValue",p),S=F(()=>[..._e].map(e=>{var m;const s=(m=v.paramsTypeOptions)==null?void 0:m.find(y=>y.value===e.value);return{...e,...s??{}}}).filter(e=>!(e.hidden||e.value===k.currentField&&(!v.currentEntryInfo||v.hideCurrentEntryInfo))).sort(e=>(e.sort??0)-(e.sort??0))),T=(t,e)=>{var m,y;let s=S.value;return(m=t.select)!=null&&m.length&&(s=s.filter(l=>{var C;return(C=t.select)==null?void 0:C.includes(l.value)})),(y=t.subCelements)!=null&&y.length?s=s.filter(l=>![k.form,k.system].includes(l.value)):e&&(s=s.filter(l=>[e.type,k.custom].includes(l.value))),[...s]},E=F(()=>Pe(c.value??[]));X(()=>{var e;if(!v.componentInfo)return;let t=K(c.value??[]);t=function s(m,y,l){var i,R;const C=[];for(const V of m){let g=y.find(re=>re.id===V.id);g?g={...V,type:g.type,appId:g.appId,entryId:g.entryId,fieldId:g.fieldId,value:g.value,subCelements:g.subCelements}:g={...V,type:(l==null?void 0:l.type)??((i=T(V)[0])==null?void 0:i.value),subCelements:void 0},(R=V.subCelements)!=null&&R.length&&(Array.isArray(g.subCelements)||(g.subCelements=[]),g.subCelements=s(V.subCelements??[],g.subCelements,g)),C.push(g)}return C.sort((V,g)=>Number(g.required)-Number(V.required)),C}(((e=v.componentInfo)==null?void 0:e.inputParams)??[],t),be(t,c.value)||(c.value=K(t))});const I=t=>{const e=E.value.get(t.id);return e!=null&&e.parentParam?(e==null?void 0:e.parentParam.subCelements)??[]:c.value},z=t=>{var s;const e=E.value.get(t.id);e!=null&&e.param&&(e.param.appId=void 0,e.param.entryId=void 0,e.param.fieldId=void 0,e.param.value=void 0,(s=e.param.subCelements)!=null&&s.length&&e.param.subCelements.forEach(m=>{m.type=t.type,z(m)}))},q=(t,e)=>{var m,y;const s=E.value.get(e.id);s&&((m=I(e))==null||m.splice(s.index,1,t),e.type!==k.custom&&((y=e.subCelements)!=null&&y.length)&&e.subCelements.forEach(l=>{l.type!==k.custom&&q({...l,entryId:void 0,appId:void 0,fieldId:void 0,value:void 0},l)}))},O=F(()=>{var t;return((t=c.value)==null?void 0:t.map(e=>ae(e)))??[]}),$=F(()=>{var t;return((t=c.value)==null?void 0:t.reduce((e,s)=>s.type===k.custom?{...e,[s.key]:s.value??null}:e,{}))??{}}),a=U({hide:new Set([])});X(()=>{Ce(v.componentInfo.conditionParam).forEach(async e=>{var m;const s=await Ve(e.condition,{onlyExistVal:!0,formData:$.value,getFieldInfo(y){return he(y,O.value)}});for(const y of e.action)y.type==="show"&&((m=y.params)==null||m.forEach(l=>{s?a.value.hide.delete(l):a.value.hide.add(l)}))})});const o=({row:t})=>{var e;return a.value.hide.has(t.key)||(e=v.ignoreKeys)!=null&&e.includes(t.key)?"component_request-hide-row":""},f=U();return h({validate(){var t,e;return(e=(t=f.value)==null?void 0:t.ruleFormRef)==null?void 0:e.validate()}}),(t,e)=>{const s=ke,m=Fe,y=Te;return d(),A(L,null,[P(s,{class:"mb-10",type:"info",closable:!1},{title:_(()=>[w("span",null,[N(" 配置插件需要的参数，名称有红星( "),w("span",{class:"az-required"}),N(" )的为必填参数，没有红星的可以选填。 ")])]),_:1}),P(Se,{model:u(c),ref_key:"azFormRef",ref:f},{default:_(()=>[P(y,{data:u(c),class:"component_request-table",style:{width:"100%"},"row-key":"id","max-height":"50vh","tree-props":{children:"subCelements"},"default-expand-all":"","empty-text":"没有需要设置的参数",border:"","row-class-name":o},{default:_(()=>[P(m,{prop:"label",label:"名称",width:"180","class-name":"component_request-label-column"},{default:_(({row:l})=>[w("span",{class:te(["params-label",{"az-required":l.required}])},[P(Q,{class:"params-name"},{default:_(()=>[N(Y(l.name),1)]),_:2},1024),l!=null&&l.remarks?(d(),b(Ee,{key:0,tip:(l==null?void 0:l.remarks)??""},null,8,["tip"])):D("",!0)],2)]),_:1}),P(m,{label:"取值","min-width":"300"},{default:_(({row:l})=>{var C;return[!a.value.hide.has(l.key)&&!((C=t.ignoreKeys)!=null&&C.includes(l.key))?(d(),b(Ye,{key:0,"model-value":l,"onUpdate:modelValue":i=>q(i,l),paramInfo:E.value.get(l.id),appId:t.appId,onTypeChange:z,"get-params-type-options":T,currentEntryInfo:t.currentEntryInfo,group:t.group},null,8,["model-value","onUpdate:modelValue","paramInfo","appId","currentEntryInfo","group"])):D("",!0)]}),_:1})]),_:1},8,["data"])]),_:1},8,["model"])],64)}}});const Xe=W(Ge,[["__scopeId","data-v-35035abe"]]),Ze=j({__name:"ComponentParamsSet",props:{modelValue:{},customParams:{},componentId:{},labelWidth:{},appId:{},currentEntryInfo:{},clientScene:{},customParamsProp:{}},emits:["update:modelValue","update:customParams"],setup(B,{expose:h,emit:p}){const v=B,r=p,c=M(v,"modelValue",r),S=M(v,"customParams",r),T=U(),E=ne(),I=U(),z=async()=>{if(!v.componentId)return Promise.reject({msg:"缺少必要参数",loadState:x.danger});const n=await E.getComponentData(v.componentId);if(!n)return Promise.reject({msg:"内部组件不可使用!",loadState:x.danger});I.value=n};qe(()=>v.componentId,()=>{var n,a;return(a=(n=T.value)==null?void 0:n.reload)==null?void 0:a.call(n)});const q=F(()=>{var n,a;return(n=I.value)!=null&&n.classId?Re((a=I.value)==null?void 0:a.classId,"paramsConfigComponent"):null}),O=U(),$=U();return h({validate(){var n,a;return $.value?(n=$.value)==null?void 0:n.validate():(a=O.value)==null?void 0:a.validate()}}),(n,a)=>(d(),b($e,{class:"component_request",load:z,ref_key:"loadingDataRef",ref:T},{default:_(()=>{var o,f;return[q.value?(d(),b(u(q),{key:0,ref_key:"customParamsComponentRef",ref:O,modelValue:u(S),"onUpdate:modelValue":a[0]||(a[0]=t=>Z(S)?S.value=t:null),clientScene:n.clientScene,currentEntryInfo:n.currentEntryInfo,otherProp:(o=I.value)!=null&&o.classId?(f=n.customParamsProp)==null?void 0:f[I.value.classId]:void 0},null,8,["modelValue","clientScene","currentEntryInfo","otherProp"])):I.value?(d(),b(Xe,oe({key:1,ref_key:"componentPublicParamsSetRef",ref:$,modelValue:u(c),"onUpdate:modelValue":a[1]||(a[1]=t=>Z(c)?c.value=t:null),componentInfo:I.value,appId:n.appId,currentEntryInfo:n.currentEntryInfo},u(le)(n.$attrs,["class","style"])),null,16,["modelValue","componentInfo","appId","currentEntryInfo"])):D("",!0)]}),_:1},512))}}),xe=j({inheritAttrs:!1,__name:"ComponentParamsSetWrapper",props:{modelValue:{},customParams:{},componentId:{},disabled:{type:Boolean},currentEntryInfo:{},ignoreKeys:{}},emits:["update:modelValue","update:customParams"],setup(B,{emit:h}){const p=B,v=h,r=M(p,"modelValue",v),c=M(p,"customParams",v),S=U(!1),T=U(),E=U([]),I=U(),z=()=>{p.disabled||!p.componentId||(E.value=K(r.value??[]),I.value=K(c.value),S.value=!0)},q=async()=>{var n;await((n=T.value)==null?void 0:n.validate()),r.value=K(E.value),c.value=K(I.value),S.value=!1},O=ne(),{addRule:$}=De();return $({validator(n,a,o){Ue({dataSystem:O,componentId:p.componentId,data:r.value,currentEntryInfo:p.currentEntryInfo,customParams:p.customParams,ignoreKeys:p.ignoreKeys}).then(()=>o()).catch(f=>o(typeof f=="string"?new Error(f):new Error((f==null?void 0:f.msg)??"未知异常")))},trigger:"change"}),(n,a)=>{const o=we,f=Ke,t=Ne;return d(),A("div",{class:te(["paramsset_wrapper",n.$attrs.class]),style:Oe(n.$attrs.style)},[w("div",{onClick:z},[Ae(n.$slots,"default",{},()=>{var e;return[P(je,{isSet:!!((e=u(r))!=null&&e.length)||!!u(c),disabled:!n.componentId||n.disabled,text:"设置请求参数"},null,8,["isSet","disabled"])]},!0)]),Be(P(o,{"model-value":JSON.stringify(u(r)??"")},null,8,["model-value"]),[[ze,!1]]),P(t,{modelValue:S.value,"onUpdate:modelValue":a[3]||(a[3]=e=>S.value=e),title:"请求参数设置",width:"800","destroy-on-close":"","close-on-click-modal":!1,"append-to-body":""},{footer:_(()=>[w("span",{class:"dialog-footer"},[P(f,{onClick:a[2]||(a[2]=e=>S.value=!1)},{default:_(()=>[N("取消")]),_:1}),P(f,{type:"primary",onClick:q},{default:_(()=>[N("确定")]),_:1})])]),default:_(()=>[P(Ze,oe({ref_key:"componentParamsSetRef",ref:T,modelValue:E.value,"onUpdate:modelValue":a[0]||(a[0]=e=>E.value=e),customParams:I.value,"onUpdate:customParams":a[1]||(a[1]=e=>I.value=e),componentId:n.componentId,currentEntryInfo:n.currentEntryInfo,ignoreKeys:n.ignoreKeys},u(le)(n.$attrs,["class","style"])),null,16,["modelValue","customParams","componentId","currentEntryInfo","ignoreKeys"])]),_:1},8,["modelValue"])],6)}}});const ua=W(xe,[["__scopeId","data-v-dd177608"]]);export{ua as C,sa as a};

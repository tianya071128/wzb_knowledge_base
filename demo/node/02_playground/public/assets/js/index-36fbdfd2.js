import{d8 as P,d as I,r as v,c as $,bK as A,o as b,f as q,k as C,i as r,w as i,m as x,t as Y,B as V,Bq as B,Br as j,aN as K,eh as W,ac as T,Q as F,bm as z,U as D,_ as L,sR as G,sT as le,b as h,I as U,h as X,v as O,sV as ae,C as Q,vL as E,uj as oe,ui as se,kV as te,z as re,bc as ne,ho as ie,nL as de,F as ue,Bs as me,Bt as pe,bx as ce,Bu as H,ao as fe,ap as _e,l as J,av as ve,d2 as ge,d3 as we,bn as ye,e as be,cp as Pe,ca as Ve}from"./index-b80d5ef5.js";import{R}from"./encryption-40d88f62.js";import{f as he}from"./findPass-21dc58f0.js";const N={selectUserSignPwd(g){return P.value.request.get(`${P.value.SYSTEMURL}/cmp/selectUserSignPwd`,{params:{userId:g}})},addSignPwd(g){return P.value.request.post(`${P.value.SYSTEMURL}/cmp/addSignPwd`,g)},updateSignPwd(g){return P.value.request.post(`${P.value.SYSTEMURL}/cmp/updateSignPwd`,g)},resetSignPwd(g){return P.value.request.post(`${P.value.SYSTEMURL}/cmp/resetSignPwd`,g)}},Se=I({__name:"SetSignPassword",emits:["refresh"],setup(g,{emit:m}){const s=m,u={signPwd:"",confirmSignPwd:"",userId:""},e=v({...u}),c=v(),l=v(!1),p=$(()=>P.value.userInfo.nickname),n=A({signPwd:[{required:!0,message:"请输入签章密码",trigger:"blur"},{validator:(o,t,d)=>{t===""?d("密码不能为空"):j(t)?d():d(new Error(B))},trigger:"blur"}],confirmSignPwd:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:(o,t,d)=>{t===""?d("确认密码不能为空"):t!==e.value.signPwd?d(new Error("两次填写的密码不一致！")):d()},trigger:"blur"}]}),a=async()=>{var o,t,d;await((o=c.value)==null?void 0:o.validate()),l.value=!0;try{await N.addSignPwd({signPwd:R(e.value.signPwd),confirmSignPwd:R(e.value.confirmSignPwd),userId:((d=(t=P.value)==null?void 0:t.userInfo)==null?void 0:d.userId)??""}),K.success("密码设置成功"),e.value={...u},s("refresh")}finally{l.value=!1}};return(o,t)=>{const d=W,f=T,S=F,y=z,M=D;return b(),q("div",{class:"sign-password"},[C("h2",{class:"sign-password-header"},"设置签章密码"),C("div",{class:"sign-password-main"},[r(d,{closable:!1,title:"第一次登录印章平台，请设置签章密码，可用做签章密码校验。",type:"info"}),r(y,{"label-suffix":"：",model:e.value,"label-width":"100px",style:{"max-width":"600px"},ref_key:"ElFromRef",ref:c,rules:n},{default:i(()=>[r(f,{label:"用户名称"},{default:i(()=>[x(Y(p.value),1)]),_:1}),r(f,{label:"签章密码",prop:"signPwd"},{default:i(()=>[r(S,{placeholder:"请输入签章密码",modelValue:e.value.signPwd,"onUpdate:modelValue":t[0]||(t[0]=k=>e.value.signPwd=k),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(f,{label:"确认密码",prop:"confirmSignPwd"},{default:i(()=>[r(S,{placeholder:"请输入密码",modelValue:e.value.confirmSignPwd,"onUpdate:modelValue":t[1]||(t[1]=k=>e.value.confirmSignPwd=k),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),r(d,{closable:!1,title:V(B),type:"warning"},null,8,["title"]),C("div",{style:{"text-align":"left"}},[r(M,{loading:l.value,type:"primary",onClick:a},{default:i(()=>[x(" 确定 ")]),_:1},8,["loading"])])])])}}});const Ie=L(Se,[["__scopeId","data-v-b60ab74d"]]),xe=I({__name:"MobileFormItem",props:{modelValue:{},label:{default:"手机号码"},required:{type:Boolean,default:!0},hideLabel:{type:Boolean},inputProps:{},extraRules:{}},emits:["update:modelValue"],setup(g,{emit:m}){const s=g,u=m,e=$({set(l){var p;u("update:modelValue",(p=l==null?void 0:l.replaceAll(" ",""))==null?void 0:p.slice(0,11))},get(){return G(s.modelValue)}}),c=$(()=>{let l=[];return s.required&&l.push({required:!0,message:`${s.label}不能为空`,trigger:"blur"}),s.extraRules&&(l=[...l,...s.extraRules??[]]),l.push({pattern:le,message:"请输入正确的手机号码",trigger:"blur"}),l});return(l,p)=>{const w=F,_=T;return b(),h(_,U({label:l.label,rules:c.value},l.$attrs),{default:i(()=>[r(w,U({modelValue:e.value,"onUpdate:modelValue":p[0]||(p[0]=n=>e.value=n),formatter:V(G),placeholder:`请输入${l.label}`},l.inputProps),{suffix:i(()=>[X(l.$slots,"suffix")]),_:3},16,["modelValue","formatter","placeholder"])]),_:3},16,["label","rules"])}}}),Ce=I({__name:"EmailFormItem",props:{modelValue:{},label:{default:"邮箱"},required:{type:Boolean,default:!0},hideLabel:{type:Boolean},inputProps:{}},emits:["update:modelValue"],setup(g,{emit:m}){const s=g,e=O(s,"modelValue",m),c=$(()=>{const l=[];return s.required&&l.push({required:!0,message:`${s.label}不能为空`,trigger:"blur"}),l.push({pattern:ae,message:"请输入正确的邮箱",trigger:"blur"}),l});return(l,p)=>{const w=F,_=T;return b(),h(_,U({label:l.label,rules:c.value},l.$attrs),{default:i(()=>[r(w,U({modelValue:V(e),"onUpdate:modelValue":p[0]||(p[0]=n=>Q(e)?e.value=n:null),placeholder:`请输入${l.label}`},l.inputProps),{suffix:i(()=>[X(l.$slots,"suffix")]),_:3},16,["modelValue","placeholder"])]),_:3},16,["label","rules"])}}}),Ee={name:"PhoneCode"},Re=I({...Ee,props:{modelValue:{},mobile:{},type:{},receiverType:{},isDisabled:{type:Boolean}},emits:["update:modelValue","code-success"],setup(g,{expose:m,emit:s}){const u=g,e=s,c=$(()=>u.receiverType??E),l=O(u,"modelValue",e),p=$(()=>c.value===E?oe(u.mobile)&&!u.isDisabled:se(u.mobile)),w=v(),_=()=>{var y;(y=w.value)==null||y.show()},n=v(!1),a=v(!1),{counter:o,pause:t,resume:d,isActive:f}=te(1e3,{controls:!0});re(()=>{o.value===60&&t()}),t();const S=async y=>{n.value=!0;try{await(c.value===E?me:pe)({receiver:u.mobile,type:u.type}),a.value=!0,o.value=1,d(),e("code-success")}finally{n.value=!1}};return m({hasCode:a}),(y,M)=>{const k=D,Z=F;return b(),q(ue,null,[r(Z,U({modelValue:V(l),"onUpdate:modelValue":M[0]||(M[0]=ee=>Q(l)?l.value=ee:null),placeholder:"请输入验证码",formatter:V(ie),class:"phone_code",maxlength:"6"},y.$attrs),{suffix:i(()=>[r(k,{loading:n.value,class:"phone_code-btn",type:V(f)?"info":"primary",text:"",disabled:!p.value||V(f),onClick:ne(_,["stop"])},{default:i(()=>[x(Y(V(f)?`${60-V(o)}s后重新发送`:a.value?"重新获取":"获取验证码"),1)]),_:1},8,["loading","type","disabled","onClick"])]),_:1},16,["modelValue","formatter"]),r(de,{onSuccess:S,captchaType:"blockPuzzle",imgSize:{width:"330px",height:"190px"},ref_key:"verify",ref:w},null,512)],64)}}});const $e=L(Re,[["__scopeId","data-v-7d65cc70"]]),Ue=I({__name:"CodeFormItem",props:{modelValue:{},label:{default:"验证码"},mobile:{},type:{},inputProps:{},receiverType:{default:E},isDisabled:{type:Boolean}},emits:["update:modelValue"],setup(g,{emit:m}){const s=g,e=O(s,"modelValue",m),c=v(),l=v(),p=v(!1),w=(a,o,t)=>{var d;p.value=!1,(d=l.value)!=null&&d.hasCode?o.length!==6?t("请输入 6 位验证码"):t():(p.value=!0,t(`您还没有获取${s.label}!`))},_=[{required:!0,message:`${s.label}不能为空`,trigger:"blur"},{validator:w,trigger:"blur"}],n=()=>{var a;p.value&&((a=c.value)==null||a.validate("blur"))};return(a,o)=>{const t=T;return b(),h(t,U({label:a.label,rules:_},a.$attrs,{ref_key:"formItemRef",ref:c}),{default:i(()=>[r($e,U({modelValue:V(e),"onUpdate:modelValue":o[0]||(o[0]=d=>Q(e)?e.value=d:null),mobile:a.mobile,ref_key:"phoneCodeRef",ref:l,onCodeSuccess:n,type:a.type,receiverType:a.receiverType},a.inputProps,{isDisabled:a.isDisabled}),null,16,["modelValue","mobile","type","receiverType","isDisabled"])]),_:1},16,["label"])}}}),Te=I({__name:"VerifyIdentity",emits:["verify"],setup(g,{emit:m}){const s=m,u={receiver:"",receiverType:E,code:"",codeType:H},e=v({...u});ce(()=>{var _,n;e.value={...u,receiver:((n=(_=P.value)==null?void 0:_.userInfo)==null?void 0:n.mobile)??""}});const c=v(),l=v(!1),p=async()=>{var _;await((_=c.value)==null?void 0:_.validate()),l.value=!0;try{const n=await he(e.value);s("verify",{codeId:n.codeId,userId:n.userId})}finally{l.value=!1}},w=_=>{var t,d,f,S;const n=((d=(t=P.value)==null?void 0:t.userInfo)==null?void 0:d.mobile)??"",a=((S=(f=P.value)==null?void 0:f.userInfo)==null?void 0:S.email)??"",o=_===E?n:a;e.value.receiver=o};return(_,n)=>{const a=fe,o=_e,t=D,d=z;return b(),h(d,{ref_key:"ruleFormRef1",ref:c,model:e.value,"label-position":"top","hide-required-asterisk":"",style:{width:"400px",margin:"0 auto"}},{default:i(()=>[e.value.receiverType==V(E)?(b(),h(xe,{key:0,modelValue:e.value.receiver,"onUpdate:modelValue":n[1]||(n[1]=f=>e.value.receiver=f),class:"az_form-one-border",label:"找回方式",prop:"receiver",inputProps:{placeholder:"请输入手机号码",disabled:!0}},{suffix:i(()=>[r(o,{modelValue:e.value.receiverType,"onUpdate:modelValue":n[0]||(n[0]=f=>e.value.receiverType=f),placeholder:"请选择",class:"az_form-border",style:{width:"115px","margin-bottom":"7px"},onChange:w},{default:i(()=>[r(a,{label:"手机号",value:0}),r(a,{label:"邮箱",value:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])):(b(),h(Ce,{key:1,modelValue:e.value.receiver,"onUpdate:modelValue":n[3]||(n[3]=f=>e.value.receiver=f),class:"az_form-one-border",label:"找回方式",prop:"receiver",inputProps:{placeholder:"请输入邮箱",disabled:!0}},{suffix:i(()=>[r(o,{modelValue:e.value.receiverType,"onUpdate:modelValue":n[2]||(n[2]=f=>e.value.receiverType=f),placeholder:"请选择",class:"az_form-border",style:{width:"115px","margin-bottom":"7px"},onChange:w},{default:i(()=>[r(a,{label:"手机号",value:0}),r(a,{label:"邮箱",value:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])),r(Ue,{modelValue:e.value.code,"onUpdate:modelValue":n[4]||(n[4]=f=>e.value.code=f),prop:"code",mobile:e.value.receiver,type:V(H),class:"az_form-one-border",receiverType:e.value.receiverType},null,8,["modelValue","mobile","type","receiverType"]),r(t,{style:{width:"100%"},type:"primary",size:"large",loading:l.value,onClick:p},{default:i(()=>[x(" 下一步 ")]),_:1},8,["loading"])]),_:1},8,["model"])}}}),Fe=I({__name:"FillPassword",props:{verifyData:{}},emits:["refresh"],setup(g,{emit:m}){const s=m,u=g,e=v({signPwd:"",confirmSignPwd:"",codeId:u.verifyData.codeId,userId:u.verifyData.userId}),c=v(!1),l=v(),_=A({signPwd:[{required:!0,message:"请输入签章密码",trigger:"blur"},{validator:(a,o,t)=>{o===""?t("密码不能为空"):j(o)?t():t(new Error(B))},trigger:"blur"}],confirmSignPwd:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:(a,o,t)=>{o===""?t("确认密码不能为空"):o!==e.value.signPwd?t(new Error("两次填写的密码不一致！")):t()},trigger:"blur"}]}),n=async()=>{var a;await((a=l.value)==null?void 0:a.validate()),c.value=!0;try{await N.resetSignPwd({...e.value,signPwd:R(e.value.signPwd),confirmSignPwd:R(e.value.confirmSignPwd)}),K.success("密码设置成功"),s("refresh")}finally{c.value=!1}};return(a,o)=>{const t=F,d=T,f=D,S=z;return b(),h(S,{ref_key:"ruleFormRef2",ref:l,model:e.value,"label-position":"top","hide-required-asterisk":"",style:{width:"400px",margin:"0 auto"},rules:_},{default:i(()=>[r(d,{label:"签章密码",prop:"signPwd"},{default:i(()=>[r(t,{placeholder:"请输入签章密码",modelValue:e.value.signPwd,"onUpdate:modelValue":o[0]||(o[0]=y=>e.value.signPwd=y),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(d,{label:"确认密码",prop:"confirmSignPwd"},{default:i(()=>[r(t,{placeholder:"请输入密码",modelValue:e.value.confirmSignPwd,"onUpdate:modelValue":o[1]||(o[1]=y=>e.value.confirmSignPwd=y),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(f,{style:{width:"100%"},type:"primary",size:"large",loading:c.value,onClick:n},{default:i(()=>[x(" 提交 ")]),_:1},8,["loading"])]),_:1},8,["model","rules"])}}}),ke=I({__name:"ResetPassword",setup(g){const m=v(!1),s=v(0),u=v({userId:"",codeId:""}),e=()=>{m.value=!0,s.value=0},c=p=>{u.value={...p},s.value=1},l=()=>{m.value=!1,s.value=0};return(p,w)=>{const _=ve,n=ge,a=we,o=ye;return b(),q("div",null,[r(_,{size:"small",link:"",onClick:e},{default:i(()=>[x("忘记密码")]),_:1}),r(o,{modelValue:m.value,"onUpdate:modelValue":w[0]||(w[0]=t=>m.value=t),title:"找回密码",width:"800"},{default:i(()=>[(b(),q("div",{class:"reset-box",key:String(m.value)},[C("div",{style:{width:"100%","padding-bottom":"30px"}},[r(a,{"finish-status":"success",active:s.value,"align-center":""},{default:i(()=>[r(n,{title:"账号校验"}),r(n,{title:"重置密码"})]),_:1},8,["active"])]),s.value===0?(b(),h(Te,{key:0,onVerify:c})):J("",!0),s.value===1?(b(),h(Fe,{key:1,verifyData:u.value,onRefresh:l},null,8,["verifyData"])):J("",!0)]))]),_:1},8,["modelValue"])])}}});const qe=L(ke,[["__scopeId","data-v-6d1f648d"]]),Be=I({__name:"EditSignPassword",setup(g){const m={signPwd:"",oldSignPwd:"",confirmSignPwd:"",userId:""},s=v({...m}),u=v(),e=v(!1),c=$(()=>P.value.userInfo.nickname),w=A({signPwd:[{required:!0,message:"请输入签章密码",trigger:"blur"},{validator:(n,a,o)=>{a===""?o("密码不能为空"):j(a)?o():o(new Error(B))},trigger:"blur"}],oldSignPwd:[{required:!0,message:"请输入原密码",trigger:"blur"}],confirmSignPwd:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:(n,a,o)=>{a===""?o("确认密码不能为空"):a!==s.value.signPwd?o(new Error("两次填写的密码不一致！")):o()},trigger:"blur"}]}),_=async()=>{var n,a,o;await((n=u.value)==null?void 0:n.validate()),e.value=!0;try{await N.updateSignPwd({oldSignPwd:R(s.value.oldSignPwd),signPwd:R(s.value.signPwd),confirmSignPwd:R(s.value.confirmSignPwd),userId:((o=(a=P.value)==null?void 0:a.userInfo)==null?void 0:o.userId)??""}),K.success("密码修改成功"),s.value={...m}}finally{e.value=!1}};return(n,a)=>{const o=T,t=F,d=z,f=W,S=D;return b(),q("div",{class:"sign-password"},[C("h2",{class:"sign-password-header"},"修改签章密码"),C("div",{class:"sign-password-main"},[r(d,{"label-suffix":"：",model:s.value,"label-width":"100px",style:{"max-width":"600px"},ref_key:"ElFromRef",ref:u,rules:w},{default:i(()=>[r(o,{label:"用户名称"},{default:i(()=>[x(Y(c.value),1)]),_:1}),r(o,{label:"原密码",prop:"oldSignPwd"},{default:i(()=>[r(t,{placeholder:"请输入原密码",modelValue:s.value.oldSignPwd,"onUpdate:modelValue":a[0]||(a[0]=y=>s.value.oldSignPwd=y),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(o,{label:"新密码",prop:"signPwd"},{default:i(()=>[r(t,{placeholder:"请输入新密码",modelValue:s.value.signPwd,"onUpdate:modelValue":a[1]||(a[1]=y=>s.value.signPwd=y),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),r(o,{label:"确认密码",prop:"confirmSignPwd"},{default:i(()=>[r(t,{placeholder:"请输入密码",modelValue:s.value.confirmSignPwd,"onUpdate:modelValue":a[2]||(a[2]=y=>s.value.confirmSignPwd=y),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),r(f,{closable:!1,title:V(B),type:"warning"},null,8,["title"]),C("div",{style:{"text-align":"left",display:"flex","justify-content":"space-between"}},[r(S,{loading:e.value,type:"primary",onClick:_},{default:i(()=>[x(" 确定 ")]),_:1},8,["loading"]),r(qe)])])])}}});const De=L(Be,[["__scopeId","data-v-e5925bff"]]),Ne=I({__name:"index",setup(g){const m=v(!1),s=v(!0),u=async()=>{m.value=!0;try{s.value=await N.selectUserSignPwd(P.value.userInfo.userId??"")}finally{m.value=!1}};return u(),(e,c)=>{const l=Pe,p=Ve;return be((b(),h(l,null,{default:i(()=>[s.value?(b(),h(De,{key:1})):(b(),h(Ie,{key:0,onRefresh:u}))]),_:1})),[[p,m.value]])}}});export{Ne as default};

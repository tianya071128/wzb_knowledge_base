import{d as D,bK as Ge,sT as Me,r as c,c as z,sR as ue,o as f,f as M,i as e,w as o,B as v,k as C,rT as X,H as $e,r$ as De,t1 as Ae,F as G,g as ie,b as I,t2 as re,l as $,t3 as ye,eh as Fe,Q as we,ac as de,gT as Je,ao as he,bm as me,y as K,lF as Ke,m as h,d9 as Ye,ad as xe,aR as Xe,t as E,t4 as Ze,t5 as el,U as j,lI as ll,P as Pe,bn as Z,_ as ee,nH as al,e9 as tl,e as Q,rS as ol,bF as Ue,fo as Te,t6 as sl,ap as nl,ca as ul,v as O,aT as rl,bu as pe,C as A,bv as le,t7 as il,aN as F,t8 as dl,t9 as ml,sn as pl,N as Le,O as ze,dj as Oe,is as ae,h as cl,cR as fl,cS as bl,dl as te,gS as vl,ta as _l,sl as yl,tb as gl,sW as Vl,tc as wl,Y as H,rC as ke,bs as qe,td as ge,te as Ve,tf as J,tg as Ne,th as hl,bT as xl,bU as kl,sS as Il,ti as Sl,E as Cl,ab as Ul,bi as je,tj as Tl,aa as ce,tk as Bl,tl as Rl,tm as El,tn as Ml,to as $l,tp as Dl,cc as ne,sj as Al,tq as Be,by as Fl,tr as Re,dN as Pl,ts as Ll,tt as zl,rW as Ol,bh as ql,iC as Nl,ae as jl,tu as Wl,tv as Ql,tw as Hl,tx as Gl,ty as Jl,tz as Kl,tA as Yl}from"./index-b80d5ef5.js";import{A as Ee,u as We}from"./AddAndEditMember-2206634e.js";import{_ as Xl}from"./batch-53af5de6.js";import{Q as Zl}from"./Qrcode-850531ac.js";import{_ as ea}from"./ViewMember.vue_vue_type_script_setup_true_lang-d1e066ac.js";import{_ as la}from"./SelectOrg.vue_vue_type_script_setup_true_lang-3e503345.js";import{_ as Qe}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import{_ as aa}from"./ResetPassword.vue_vue_type_script_setup_true_lang-65983c50.js";import{u as ta}from"./useQueryTab-05fa7456.js";import"./AzPasswordFormItem-db212711.js";import"./AccountFormItem.vue_vue_type_script_setup_true_lang-c783353b.js";import"./html2canvas.esm-0543ed55.js";import"./LoadingData-195d0581.js";import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";import"./SetPasswordFormItem-fa70a559.js";import"./PasswordFormItem.vue_vue_type_script_setup_true_lang-6a395c05.js";import"./allUser-b2fd4b31.js";import"./useExtractQuery-f96f705c.js";const oa=D({__name:"InviteSpecifiedMembers",setup(U,{expose:k}){const m=Ge({mobile:[{required:!0,message:"请输入手机号",trigger:"change"},{pattern:Me,message:"请输入正确的手机号码",trigger:"blur"}],orgIds:[{required:!0,message:"请选择加入组织",trigger:"change"}]}),s=c({...{mobile:"",leader:"",orgIds:[],roleIds:[],dataScope:ye,dataScopeDeptIds:[]}}),i=c([]),u=c([]),p=c(),b=z({set(r){s.value.mobile=r==null?void 0:r.replaceAll(" ","")},get(){return ue(s.value.mobile)}});return k({ruleFormRef:p,form:s}),(r,t)=>{const a=Fe,l=we,n=de,d=Je,y=he,g=me;return f(),M("div",null,[e(a,{title:"可邀请其他机构内的用户加入我们！需用户登录平台同意加入",type:"info",center:"",closable:!1,"show-icon":""}),e(g,{ref_key:"ruleFormRef",ref:p,model:s.value,class:"mt-20",rules:m,"label-width":"110px","label-position":"left","status-icon":""},{default:o(()=>[e(n,{label:"手机号",prop:"mobile"},{default:o(()=>[e(l,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=_=>b.value=_),formatter:v(ue),placeholder:"请输入手机号"},null,8,["modelValue","formatter"])]),_:1}),e(d,{"content-position":"left"},{default:o(()=>[C("b",null,"加入的组织信息")]),_:1}),e(n,{label:"加入组织",prop:"orgIds"},{default:o(()=>[e(X,{modelValue:s.value.orgIds,"onUpdate:modelValue":t[1]||(t[1]=_=>s.value.orgIds=_),type:"org",multiple:"","init-options":u.value},null,8,["modelValue","init-options"])]),_:1}),e(n,{label:"直属主管"},{default:o(()=>[e(X,{modelValue:s.value.leader,"onUpdate:modelValue":t[2]||(t[2]=_=>s.value.leader=_),label:"直属主管",placeholder:"请选择直属主管",type:"member","init-options":i.value},null,8,["modelValue","init-options"])]),_:1}),e(n,{label:"角色",prop:"roleIds"},{default:o(()=>[e(X,{modelValue:s.value.roleIds,"onUpdate:modelValue":t[3]||(t[3]=_=>s.value.roleIds=_),label:"角色",placeholder:"请选择角色",type:"role",multiple:""},null,8,["modelValue"])]),_:1}),e($e,{label:"数据权限",prop:"dataScope"},{default:o(()=>[e(De,{modelValue:s.value.dataScope,"onUpdate:modelValue":t[4]||(t[4]=_=>s.value.dataScope=_),style:{width:"100%"},placeholder:"请选择模块（子系统）",load:v(Ae)},{default:o(({options:_})=>[(f(!0),M(G,null,ie(_,T=>(f(),I(y,{key:T.value,label:T.label,value:T.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","load"])]),_:1}),s.value.dataScope==v(re)?(f(),I(n,{key:0,label:"数据访问范围",prop:"dataScopeDeptIds"},{default:o(()=>[e(X,{modelValue:s.value.dataScopeDeptIds,"onUpdate:modelValue":t[5]||(t[5]=_=>s.value.dataScopeDeptIds=_),label:"机构",type:"org",multiple:"",checkStrictly:!1},null,8,["modelValue"])]),_:1})):$("",!0)]),_:1},8,["model","rules"])])}}}),sa=D({__name:"BatchAddMembers",setup(U){const k=c(),m=c("loading"),x=async(r,t)=>{try{m.value="loading",b.value=0,p.value=!0;const a=await Ze({fileId:t.id});k.value=a,m.value="success",b.value=100}catch{s.value=[],m.value="error"}},s=c([]),i=async()=>{await el()},u=()=>{var t;const r=document.createElement("a");r.href=(t=k.value)==null?void 0:t.failureFileInfo.filePath,r.download="导入结果",r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)},p=c(!1),b=c(100);return K(()=>b.value,r=>{r<80&&setTimeout(()=>{m.value==="loading"&&(b.value+=20)},1200)}),(r,t)=>{const a=j,l=ll,n=Pe,d=Z;return f(),M("div",{style:{"text-align":"center"}},[C("div",{class:"upload_tips"},[C("img",{src:Xl,alt:"下载提示"}),C("span",{class:"tips_16"},"请下载模板，按格式修改后导入"),C("span",{class:"tips_12"},"已经在平台内或信息有误的成员不导入")]),C("div",{class:"upload-box"},[e(Ye,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=y=>s.value=y),limit:1,type:"file",onUploadFinish:x,accept:["xlsx","xls"],imgWidth:"80px",size:5120},{fileTrigger:o(()=>[e(a,{type:"primary",icon:v(Ke),plain:""},{default:o(()=>[h(" 上传文件，单个文件5MB以内 ")]),_:1},8,["icon"])]),_:1},8,["modelValue"])]),e(a,{type:"primary",link:"",onClick:i},{default:o(()=>[h("下载导入模板")]),_:1}),e(d,{title:"批量导入成员",width:"600px",modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=y=>p.value=y)},xe({default:o(()=>{var y,g,_;return[m.value!=="error"?(f(),M("div",{key:0,class:"body-wrapper"},[e(l,{percentage:b.value},null,8,["percentage"]),m.value==="loading"?(f(),M("span",{key:0},[e(n,{class:"is-loading"},{default:o(()=>[e(v(Xe))]),_:1}),h(" 正在导入，请耐心等待... ")])):(f(),M(G,{key:1},[C("span",null,[h(" 成功数： "),C("span",{class:"success-num"},E(((y=k.value)==null?void 0:y.successCount)??0),1),h(" 失败数： "),C("span",{class:"fail-num"},E(((g=k.value)==null?void 0:g.failureCount)??0),1)]),C("span",null,[(_=k.value)!=null&&_.failureFileInfo?(f(),I(a,{key:0,type:"primary",plain:"",onClick:u},{default:o(()=>[h(" 下载文件并查看结果 ")]),_:1})):$("",!0)])],64))])):(f(),M("span",{key:1},"导入失败，请检查您的网络并重试"))]}),_:2},[m.value!=="loading"?{name:"footer",fn:o(()=>[C("span",{class:"dialog-footer"},[e(a,{onClick:t[1]||(t[1]=y=>p.value=!1)},{default:o(()=>[h("关闭")]),_:1})])]),key:"0"}:void 0]),1032,["modelValue"])])}}});const na=ee(sa,[["__scopeId","data-v-2c014673"]]),ua=D({__name:"InviteMembers",setup(U){const k=al(),m=c(7),x=[{label:"1天",value:1},{label:"7天",value:7},{label:"15天",value:15},{label:"永久有效",value:-1}],s=()=>{Te(`企业【${k.corpName}】 邀请您加入我们，开展业务协作！
      打开此链接：${a.value}
      录入信息后即可加入我们。`)},i=c(!1),u=c(),p=async()=>{var n;i.value=!0,await((n=u.value)==null?void 0:n.downloadQrcode()),i.value=!1},b=c(!1),r=c(""),t=async()=>{b.value=!0,r.value=await sl({validTime:m.value}),b.value=!1};t();const a=z(()=>{let n=`#/invitation/joinEnterprise?invitation_code=${r.value}`;return n=tl.join(location.host,location.pathname,n),`${location.protocol}//${n}`}),l=()=>{Te(r.value)};return(n,d)=>{const y=Fe,g=he,_=nl,T=j,B=ul;return f(),M("div",null,[e(y,{class:"mb-20",title:"可通过以下任意方式，邀请用户加入本组织/部门",type:"info",center:"","show-icon":"",closable:!1}),C("div",{class:"mt-20"},[C("div",{class:"center"},[C("span",null,"链接有效期："),e(_,{modelValue:m.value,"onUpdate:modelValue":d[0]||(d[0]=R=>m.value=R),placeholder:"请选择有效期",onChange:t},{default:o(()=>[(f(),M(G,null,ie(x,R=>e(g,{key:R.value,label:R.label,value:R.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),Q((f(),M("div",null,[C("div",{class:"center"},[e(Zl,{ref_key:"qrcodeRef",ref:u,text:a.value,filename:"邀请成员","tip-text":"录入信息后加入我们",title:"邀请您加入我们"},null,8,["text"])]),C("div",{class:"center"},[e(T,{type:"primary",onClick:p,plain:"",icon:v(ol),loading:i.value},{default:o(()=>[h(" 下载二维码 ")]),_:1},8,["icon","loading"]),e(T,{type:"primary",onClick:l,plain:"",icon:v(Ue)},{default:o(()=>[h(" 复制企业邀请码 ")]),_:1},8,["icon"]),e(T,{type:"primary",onClick:s,plain:"",icon:v(Ue)},{default:o(()=>[h(" 复制邀请链接 ")]),_:1},8,["icon"])])])),[[B,b.value]])])])}}});const ra=ee(ua,[["__scopeId","data-v-3a54c327"]]),ia=D({__name:"InviteAndEditMember",props:{modelValue:{type:Boolean},edit:{}},emits:["update:modelValue","submit"],setup(U,{emit:k}){const m=U,x=k,s=O(m,"modelValue",x),i=z(()=>!!m.edit),u=z(()=>i.value?"编辑成员":"邀请成员"),p=z(()=>r.value==="4"?"发送邀请":"确定"),b=z(()=>r.value==="4"?"保存并继续邀请":"保存并继续新增"),r=c("1"),t=c(),a=c(),l=async()=>{var g,_,T,B,R,q;if(r.value==="1"){if(!t.value)return;await((g=t.value)==null?void 0:g.ruleFormRef.validate()),i.value?(await il((_=t.value)==null?void 0:_.form),F.success("编辑成员成功")):(await dl((T=t.value)==null?void 0:T.form),F.success("新增成员成功"))}if(r.value==="4"){if(!a.value)return;await((R=(B=a.value)==null?void 0:B.ruleFormRef)==null?void 0:R.validate());const N={...((q=a.value)==null?void 0:q.form)??{}};N.dataScope!=re&&(N.dataScopeDeptIds=[]),await ml(N),F.success("邀请成员成功")}x("submit")},n=c(!1);K(s,()=>{s.value?n.value=!0:rl(()=>{s.value||(n.value=!1)})});const d=c(),y=async()=>{var g,_;(g=m.edit)!=null&&g.memberId?d.value=await pl((_=m.edit)==null?void 0:_.memberId):d.value=null};return(g,_)=>{const T=Le,B=ze;return f(),I(le,{modelValue:v(s),"onUpdate:modelValue":_[2]||(_[2]=R=>A(s)?s.value=R:null),title:u.value,"show-load":y},xe({default:o(()=>[i.value?$("",!0):(f(),I(B,{key:0,modelValue:r.value,"onUpdate:modelValue":_[0]||(_[0]=R=>r.value=R),class:"az_tabs-custom"},{default:o(()=>[e(T,{label:"添加新成员",name:"1"},{default:o(()=>[n.value?(f(),I(Ee,{key:0,edit:d.value,ref_key:"addAndEditMemberRef",ref:t},null,8,["edit"])):$("",!0)]),_:1}),e(T,{label:"批量导入成员",name:"2",lazy:""},{default:o(()=>[e(na)]),_:1}),e(T,{label:"邀请成员",name:"3",lazy:""},{default:o(()=>[e(ra)]),_:1}),e(T,{label:"邀请指定成员",name:"4",lazy:""},{default:o(()=>[e(oa,{ref_key:"addISMembersRef",ref:a},null,512)]),_:1})]),_:1},8,["modelValue"])),i.value?(f(),I(Ee,{key:1,edit:d.value,ref_key:"addAndEditMemberRef",ref:t},null,8,["edit"])):$("",!0)]),_:2},[r.value==="1"||r.value==="4"||i.value?{name:"footer",fn:o(()=>[e(pe,{editMode:i.value,"submit-text":p.value,"continue-text":b.value,onClose:_[1]||(_[1]=R=>s.value=!1),"on-submit":l},null,8,["editMode","submit-text","continue-text"])]),key:"0"}:void 0]),1032,["modelValue","title"])}}}),da=D({__name:"SelectRole",props:{modelValue:{},placeholder:{default:"选择角色"},multiple:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(U,{emit:k}){const m=U,x=k,s=z({get(){return(Array.isArray(m.modelValue)?[...m.modelValue]:m.modelValue?[m.modelValue]:[]).map(p=>({id:p,type:Oe.role}))},set(u){var b;u=vl(u);let p;m.multiple?p=u.map(r=>r.id):p=(b=u==null?void 0:u[0])==null?void 0:b.id,x("update:modelValue",p)}}),i=z(()=>[{label:"角色",name:ae.role}]);return(u,p)=>(f(),I(te,{modelValue:s.value,"onUpdate:modelValue":p[0]||(p[0]=b=>s.value=b),tabsList:i.value,placeholder:u.placeholder,multiple:u.multiple,searchPlaceholder:"搜索角色",dialogTitle:"角色列表"},xe({_:2},[ie(u.$slots||{},(b,r,t)=>({name:r,fn:o(a=>[cl(u.$slots,r,fl(bl(a)))])}))]),1032,["modelValue","tabsList","placeholder","multiple"]))}}),ma=D({__name:"PermissionDistribution",props:{modelValue:{type:Boolean},id:{}},emits:["update:modelValue","submit"],setup(U,{emit:k}){const m=U,x=k,s=O(m,"modelValue",x),i=c(),u=c({memberId:"",roleIds:[],dataScope:ye,dataScopeDeptIds:[],userId:""}),p={roleIds:[{required:!0,message:"请选择角色",trigger:"change"}],dataScope:[{required:!0,message:"请选择数据权限",trigger:"change"}],dataScopeDeptIds:[{required:!0,message:"请选择数据访问范围",trigger:"change"}]},b=c([]),r=async()=>{if(!m.modelValue)return;const a=m.id,l=await _l(a),n=await yl({current:1,limit:999}),d=(l.roleList??[]).filter(y=>n.records.some(g=>g.id===y.id));a===m.id&&(u.value={memberId:m.id,roleIds:(d??[]).map(y=>y.id)??[],dataScope:l.dataScope??ye,dataScopeDeptIds:l.dataScopeDeptIds??[],userId:l.userId??""},b.value=d??[])},t=async()=>{var l;await((l=i.value)==null?void 0:l.validate());const a={...u.value};a.dataScope!=re&&(a.dataScopeDeptIds=[]),await gl(a),F.success("权限分配成功!"),x("submit")};return(a,l)=>{const n=de,d=he,y=me;return f(),I(le,{modelValue:v(s),"onUpdate:modelValue":l[4]||(l[4]=g=>A(s)?s.value=g:null),title:"权限分配","show-load":r},{footer:o(()=>[e(pe,{editMode:"",onClose:l[3]||(l[3]=g=>s.value=!1),"on-submit":t})]),default:o(()=>[e(y,{model:u.value,rules:p,"label-position":"left","label-width":"120px",ref_key:"ruleFormRef",ref:i},{default:o(()=>[e(n,{label:"角色分配",prop:"roleIds"},{default:o(()=>[e(da,{modelValue:u.value.roleIds,"onUpdate:modelValue":l[0]||(l[0]=g=>u.value.roleIds=g),multiple:"",roleProp:{isSystem:!0},lock:[{type:v(Oe).role,id:"5"}]},null,8,["modelValue","lock"])]),_:1}),e($e,{label:"数据权限",prop:"dataScope"},{default:o(()=>[e(De,{modelValue:u.value.dataScope,"onUpdate:modelValue":l[1]||(l[1]=g=>u.value.dataScope=g),style:{width:"100%"},placeholder:"请选择模块（子系统）",load:v(Ae)},{default:o(({options:g})=>[(f(!0),M(G,null,ie(g,_=>(f(),I(d,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","load"])]),_:1}),u.value.dataScope==v(re)?(f(),I(n,{key:0,label:"数据访问范围",prop:"dataScopeDeptIds"},{default:o(()=>[e(X,{modelValue:u.value.dataScopeDeptIds,"onUpdate:modelValue":l[2]||(l[2]=g=>u.value.dataScopeDeptIds=g),label:"机构",type:"org",multiple:"",checkStrictly:!1},null,8,["modelValue"])]),_:1})):$("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),pa=D({__name:"AccountSetting",props:{modelValue:{type:Boolean},accountSetForm:{}},emits:["update:modelValue","submit"],setup(U,{emit:k}){const m=U,x=k,s=O(m,"modelValue",x),i=c(),u=c();K(()=>m.accountSetForm,()=>{m.accountSetForm&&(u.value={memberId:m.accountSetForm.memberId,mobile:m.accountSetForm.mobile,username:m.accountSetForm.username},setTimeout(()=>{var t;(t=i.value)==null||t.clearValidate()},100))});const p=z({set(t){u.value&&(u.value.mobile=t==null?void 0:t.replaceAll(" ",""))},get(){var t;return ue(((t=u.value)==null?void 0:t.mobile)??"")}}),b={username:[{required:!0,message:"账号不能为空",trigger:"blur"},{pattern:Vl,message:"账号由字母开头, 并且由字母和数字二种组成",trigger:"blur"}],mobile:[{required:!0,message:"手机号不能为空",trigger:"blur"},{pattern:Me,message:"请输入正确的手机号码",trigger:"blur"}]},r=async()=>{var t;await((t=i.value)==null?void 0:t.validate()),u.value&&(await wl(H(u.value)),F.success("设置成功！"),x("submit"))};return(t,a)=>{const l=we,n=de,d=me;return f(),I(le,{modelValue:v(s),"onUpdate:modelValue":a[3]||(a[3]=y=>A(s)?s.value=y:null),title:"账号设置"},{footer:o(()=>[e(pe,{editMode:"",onClose:a[2]||(a[2]=y=>s.value=!1),"on-submit":r,"submit-text":"保存"})]),default:o(()=>[u.value?(f(),I(d,{key:0,model:u.value,rules:b,"label-position":"left","label-width":"120px",ref_key:"ruleFormRef",ref:i},{default:o(()=>[e(n,{label:"账号",prop:"username"},{default:o(()=>[e(l,{modelValue:u.value.username,"onUpdate:modelValue":a[0]||(a[0]=y=>u.value.username=y),placeholder:"请输入账号",maxlength:"50"},null,8,["modelValue"])]),_:1}),e(n,{label:"手机号码",prop:"mobile"},{default:o(()=>[e(l,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=y=>p.value=y),formatter:v(ue),placeholder:"请输入手机号"},null,8,["modelValue","formatter"])]),_:1})]),_:1},8,["model"])):$("",!0)]),_:1},8,["modelValue"])}}}),ca=D({__name:"ViewExamineMember",props:{modelValue:{type:Boolean},view:{}},emits:["update:modelValue"],setup(U,{emit:k}){const m=U,s=O(m,"modelValue",k),i=c(),u=async()=>{var p;i.value=await hl(((p=m.view)==null?void 0:p.id)??"")};return(p,b)=>{const r=xl,t=kl;return f(),I(le,{modelValue:v(s),"onUpdate:modelValue":b[0]||(b[0]=a=>A(s)?s.value=a:null),title:"查看详情","show-load":u},{default:o(()=>{var a;return[e(t,{column:2,border:"",style:{"margin-top":"30px"}},{default:o(()=>{var l,n;return[e(r,{label:"姓名"},{default:o(()=>{var d;return[h(E(((d=i.value)==null?void 0:d.nickname)||"-"),1)]}),_:1}),e(r,{label:"账号"},{default:o(()=>{var d;return[h(E(((d=i.value)==null?void 0:d.username)||"-"),1)]}),_:1}),e(r,{label:"手机号码"},{default:o(()=>{var d;return[h(E(v(ke)(((d=i.value)==null?void 0:d.mobile)||"")),1)]}),_:1}),e(r,{label:"申请时间"},{default:o(()=>{var d;return[h(E(((d=i.value)==null?void 0:d.createTime)||"-"),1)]}),_:1}),e(r,{label:"状态",span:2},{default:o(()=>{var d;return[h(E(v(qe)((d=i.value)==null?void 0:d.status,v(ge))),1)]}),_:1}),((l=i.value)==null?void 0:l.status)!=v(Ve)?(f(),M(G,{key:0},[e(r,{label:"审核人"},{default:o(()=>{var d;return[h(E(((d=i.value)==null?void 0:d.auditUserName)||"-"),1)]}),_:1}),e(r,{label:"审核时间"},{default:o(()=>{var d;return[h(E(((d=i.value)==null?void 0:d.auditTime)||"-"),1)]}),_:1}),e(r,{label:"审核结果"},{default:o(()=>{var d;return[h(E(((d=i.value)==null?void 0:d.status)==v(J)?"同意加入":"拒绝加入"),1)]}),_:1}),((n=i.value)==null?void 0:n.status)==v(Ne)?(f(),I(r,{key:0,label:"拒绝原因"},{default:o(()=>{var d;return[h(E(((d=i.value)==null?void 0:d.reason)||"-"),1)]}),_:1})):$("",!0)],64)):$("",!0)]}),_:1}),((a=i.value)==null?void 0:a.status)==v(J)?(f(),I(t,{key:0,column:1,border:"",style:{"margin-top":"30px"},title:"加入后组织信息"},{default:o(()=>[e(r,{label:"直属主管"},{default:o(()=>{var l;return[h(E(((l=i.value)==null?void 0:l.leaderName)||"-"),1)]}),_:1}),e(r,{label:"所属部门"},{default:o(()=>{var l;return[h(E((((l=i.value)==null?void 0:l.orgNames)??[]).join("、")||"-"),1)]}),_:1})]),_:1})):$("",!0)]}),_:1},8,["modelValue"])}}}),fa=D({__name:"ExamineDrawer",props:{modelValue:{type:Boolean},ids:{}},emits:["update:modelValue","submit"],setup(U,{emit:k}){const m=U,x=k,s=O(m,"modelValue",x),i={ids:m.ids,status:J,leader:"",orgIds:[],reason:""},u=c(),p=c(H(i)),b={};K(s,()=>{s.value&&(p.value=H({...i,ids:m.ids}),setTimeout(()=>{var l;(l=u.value)==null||l.clearValidate()},100))});const r=async()=>{var n;await((n=u.value)==null?void 0:n.validate());const l={...p.value};l.status==J?delete l.reason:(delete l.leader,delete l.orgIds),await Sl(l),x("submit")},{firstOrgName:t,getOrgName:a}=We();return K(()=>p.value.orgIds,async l=>{a(l==null?void 0:l[0])},{immediate:!0}),(l,n)=>{const d=Cl,y=Ul,g=de,_=we,T=me;return f(),I(le,{modelValue:v(s),"onUpdate:modelValue":n[5]||(n[5]=B=>A(s)?s.value=B:null),title:"审核"},{footer:o(()=>[e(pe,{editMode:"",onClose:n[4]||(n[4]=B=>s.value=!1),"on-submit":r})]),default:o(()=>[e(T,{model:p.value,rules:b,"label-position":"left","label-width":"120px",ref_key:"ruleFormRef",ref:u},{default:o(()=>[e(g,{required:"",label:"审核结果"},{default:o(()=>[e(y,{modelValue:p.value.status,"onUpdate:modelValue":n[0]||(n[0]=B=>p.value.status=B),class:"ml-4"},{default:o(()=>[e(d,{label:v(J)},{default:o(()=>[h("同意加入")]),_:1},8,["label"]),e(d,{label:v(Ne)},{default:o(()=>[h("拒绝加入")]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),p.value.status==v(J)?(f(),M(G,{key:0},[e(g,{label:"直属主管",prop:"leader"},{default:o(()=>[e(Il,{modelValue:p.value.leader,"onUpdate:modelValue":n[1]||(n[1]=B=>p.value.leader=B),placeholder:"请选择直属主管","is-member-id":""},null,8,["modelValue"])]),_:1}),e(g,{label:"所属部门",prop:"orgIds",rules:[{required:!0,message:"请选择所属部门",trigger:"change"}]},{default:o(()=>[e(la,{modelValue:p.value.orgIds,"onUpdate:modelValue":n[2]||(n[2]=B=>p.value.orgIds=B),multiple:"",drag:"",placeholder:"请选择所属部门"},null,8,["modelValue"]),C("span",{class:"tips"}," 第一个为主部门，当前主部门为"+E(v(t)),1)]),_:1})],64)):(f(),I(g,{key:1,label:"拒绝原因"},{default:o(()=>[e(_,{modelValue:p.value.reason,"onUpdate:modelValue":n[3]||(n[3]=B=>p.value.reason=B),rows:2,type:"textarea",placeholder:"请输入拒绝原因"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});const ba=ee(fa,[["__scopeId","data-v-3b843b7d"]]),va=D({__name:"ExamineMember",emits:["refresh"],setup(U,{emit:k}){const m=k,x=c(),s=()=>{var l;(l=x.value)==null||l.refresh()},i={id:"examine_member",query:{list:[{type:"input",label:"账号",prop:"account"},{type:"input",label:"姓名",prop:"nickname"},{type:"select",label:"状态",prop:"status",options:ge,isAll:!0,initValue:Ve}]},request:{api:Tl},table:{tableCols:[{type:"selection"},{prop:"nickname",label:"姓名",width:150},{prop:"username",label:"账号",showOverflowTooltip:!0,width:200},{prop:"mobile",label:"手机",width:150,slots:{default({row:l}){return e("span",null,[ke(l.mobile)])}}},{prop:"status",label:"状态",width:150,slots:{default({row:l}){return e("span",null,[qe(l.status,ge)])}}},{prop:"createTime",label:"申请时间",width:250},{fixed:"right",label:"操作",minWidth:180,slots:{default({row:l}){const n=()=>{u.value=H(l),p.value=!0},d=()=>{b.value=!0,r.value=[l.id]},y=[{type:"primary",onClick:n,text:"查看",premission:"system:member:jraudit:detail"}];return l.status==Ve&&y.unshift({type:"primary",onClick:d,text:"审核",premission:"system:member:jraudit:audit"}),e(Qe,{rowId:l.id,list:y},null)}}}]}},u=c(),p=c(!1),b=c(!1),r=c([]),t=l=>{b.value=!0,r.value=l.map(n=>n.id)},a=()=>{s(),m("refresh")};return setTimeout(()=>{a()},2e3),(l,n)=>{const d=j,y=je("az-page");return f(),M(G,null,[e(y,{class:"layout_box",ref_key:"azPageRef",ref:x,config:i,maxHeight:"var(--az-layout-main-height) - 32px - 40px"},{operation:o(({multipleSelection:g})=>[e(d,{type:"primary",disabled:!g.length,onClick:_=>t(g)},{default:o(()=>[h(" 批量审核 ")]),_:2},1032,["disabled","onClick"])]),_:1},512),e(ca,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=g=>p.value=g),view:u.value},null,8,["modelValue","view"]),e(ba,{modelValue:b.value,"onUpdate:modelValue":n[1]||(n[1]=g=>b.value=g),ids:r.value,onSubmit:a},null,8,["modelValue","ids"])],64)}}}),_a=D({__name:"BatchLeader",props:{modelValue:{type:Boolean},list:{}},emits:["update:modelValue","refresh"],setup(U,{emit:k}){const m=U,x=k,s=O(m,"modelValue",x),i=c(!1),u=c(),p=async()=>{const r=m.list.map(t=>{var a;return{memberId:t.memberId,leader:((a=u.value)==null?void 0:a.id)??""}});await Bl(r),F.success("设置主管成功"),x("refresh"),s.value=!1},b=async()=>{var r;if(!((r=u.value)!=null&&r.id))ce.confirm("未设置内容，将要清空处理。确定要清空？","注意",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",async beforeClose(t,a,l){if(t==="confirm"){a.confirmButtonLoading=!0;try{await p(),l()}finally{a.confirmButtonLoading=!1}}else l()}});else try{i.value=!0,await p()}finally{i.value=!1}};return(r,t)=>{const a=j,l=Z;return f(),I(l,{modelValue:v(s),"onUpdate:modelValue":t[2]||(t[2]=n=>A(s)?s.value=n:null),width:"400px","append-to-body":"",title:"设置主管"},{footer:o(()=>[C("span",{class:"dialog-footer"},[e(a,{onClick:t[1]||(t[1]=n=>s.value=!1)},{default:o(()=>[h("取消")]),_:1}),e(a,{type:"primary",onClick:b,loading:v(i)},{default:o(()=>[h(" 确定 ")]),_:1},8,["loading"])])]),default:o(()=>[e(te,{tabs:[v(ae).memberSelectMemberIdByOrg],modelValue:v(u),"onUpdate:modelValue":t[0]||(t[0]=n=>A(u)?u.value=n:null),"dialog-title":"直属主管",placeholder:"直属主管"},null,8,["tabs","modelValue"])]),_:1},8,["modelValue"])}}}),ya=D({__name:"BatchDept",props:{modelValue:{type:Boolean},list:{}},emits:["update:modelValue","refresh"],setup(U,{emit:k}){const m=U,x=k,s=O(m,"modelValue",x),i=c(!1),u=c([]),p=async()=>{const a=m.list.map(l=>{var n;return{memberId:l.memberId,orgIds:((n=u.value)==null?void 0:n.map(d=>d.id))??[]}});await Rl(a),F.success("设置部门成功"),x("refresh"),s.value=!1},b=async()=>{var a;if(!((a=u.value)!=null&&a.length))ce.confirm("未设置内容，将要清空处理。确定要清空？","注意",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",async beforeClose(l,n,d){if(l==="confirm"){n.confirmButtonLoading=!0;try{await p(),d()}finally{n.confirmButtonLoading=!1}}else d()}});else try{i.value=!0,await p()}finally{i.value=!1}},{firstOrgName:r,getOrgName:t}=We();return K(()=>u.value,async a=>{var l;t((l=a==null?void 0:a[0])==null?void 0:l.id)},{immediate:!0}),(a,l)=>{const n=j,d=Z;return f(),I(d,{modelValue:v(s),"onUpdate:modelValue":l[2]||(l[2]=y=>A(s)?s.value=y:null),width:"400px","append-to-body":"",title:"设置部门"},{footer:o(()=>[C("span",{class:"dialog-footer"},[e(n,{onClick:l[1]||(l[1]=y=>s.value=!1)},{default:o(()=>[h("取消")]),_:1}),e(n,{type:"primary",onClick:b,loading:v(i)},{default:o(()=>[h(" 确定 ")]),_:1},8,["loading"])])]),default:o(()=>[e(te,{modelValue:v(u),"onUpdate:modelValue":l[0]||(l[0]=y=>A(u)?u.value=y:null),"dialog-title":"所属部门",placeholder:"所属部门",tabs:[v(ae).org],drag:"",multiple:""},null,8,["modelValue","tabs"]),C("span",{class:"tips"},"第一个为主部门，当前主部门为"+E(v(r)),1)]),_:1},8,["modelValue"])}}});const ga=ee(ya,[["__scopeId","data-v-d6dea9a3"]]),Va=D({__name:"BatchRole",props:{modelValue:{type:Boolean},list:{}},emits:["update:modelValue","refresh"],setup(U,{emit:k}){const m=U,x=k,s=O(m,"modelValue",x),i=c(!1),u=c([]),p=async()=>{const r=m.list.map(t=>{var a;return{memberId:t.memberId,roleIds:((a=u.value)==null?void 0:a.map(l=>l.id))??[]}});await El(r),F.success("分配角色成功"),x("refresh"),s.value=!1},b=async()=>{var r;if(!((r=u.value)!=null&&r.length))ce.confirm("未设置内容，将要清空处理。确定要清空？","注意",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",async beforeClose(t,a,l){if(t==="confirm"){a.confirmButtonLoading=!0;try{await p(),l()}finally{a.confirmButtonLoading=!1}}else l()}});else try{i.value=!0,await p()}finally{i.value=!1}};return(r,t)=>{const a=j,l=Z;return f(),I(l,{modelValue:v(s),"onUpdate:modelValue":t[2]||(t[2]=n=>A(s)?s.value=n:null),width:"400px","append-to-body":"",title:"分配角色"},{footer:o(()=>[C("span",{class:"dialog-footer"},[e(a,{onClick:t[1]||(t[1]=n=>s.value=!1)},{default:o(()=>[h("取消")]),_:1}),e(a,{type:"primary",onClick:b,loading:v(i)},{default:o(()=>[h(" 确定 ")]),_:1},8,["loading"])])]),default:o(()=>[e(te,{modelValue:v(u),"onUpdate:modelValue":t[0]||(t[0]=n=>A(u)?u.value=n:null),"dialog-title":"分配角色",placeholder:"选择角色",tabs:[v(ae).role],multiple:""},null,8,["modelValue","tabs"])]),_:1},8,["modelValue"])}}}),wa=D({__name:"BatchPost",props:{modelValue:{type:Boolean},list:{}},emits:["update:modelValue","refresh"],setup(U,{emit:k}){const m=U,x=k,s=O(m,"modelValue",x),i=c(!1),u=c([]),p=async()=>{const r=m.list.map(t=>{var a;return{memberId:t.memberId,orgJobIds:((a=u.value)==null?void 0:a.map(l=>l.id))??[]}});await Ml(r),F.success("设置岗位成功"),x("refresh"),s.value=!1},b=async()=>{var r;if(!((r=u.value)!=null&&r.length))ce.confirm("未设置内容，将要清空处理。确定要清空？","注意",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",async beforeClose(t,a,l){if(t==="confirm"){a.confirmButtonLoading=!0;try{await p(),l()}finally{a.confirmButtonLoading=!1}}else l()}});else try{i.value=!0,await p()}finally{i.value=!1}};return(r,t)=>{const a=j,l=Z;return f(),I(l,{modelValue:v(s),"onUpdate:modelValue":t[2]||(t[2]=n=>A(s)?s.value=n:null),width:"400px","append-to-body":"",title:"设置岗位"},{footer:o(()=>[C("span",{class:"dialog-footer"},[e(a,{onClick:t[1]||(t[1]=n=>s.value=!1)},{default:o(()=>[h("取消")]),_:1}),e(a,{type:"primary",onClick:b,loading:v(i)},{default:o(()=>[h(" 确定 ")]),_:1},8,["loading"])])]),default:o(()=>[e(te,{modelValue:v(u),"onUpdate:modelValue":t[0]||(t[0]=n=>A(u)?u.value=n:null),"dialog-title":"选择岗位",placeholder:"选择岗位",tabs:[v(ae).jobByOrg],multiple:""},null,8,["modelValue","tabs"])]),_:1},8,["modelValue"])}}}),ha={name:"Member"},xa=D({...ha,setup(U){const{menuId:k}=$l(),m=c(),x=c(),s=c({orgId:"",menuId:k.value}),i=async V=>{await Ql(V.map(w=>w.memberId)),a()},u=async(V,w)=>{await Hl({memberIds:w.filter(P=>P.status!=V).map(P=>P.memberId),status:V}),a()},p={query:{list:[{type:"input",label:"账号",prop:"account"},{type:"input",label:"姓名",prop:"nickname"},{type:"input",label:"手机号",prop:"mobile"},{type:"select",label:"状态",prop:"status",options:Dl,isAll:!0,initValue:ne},{type:"select",label:"待完善",prop:"toBeFill",clearable:!0,options:"user_toBeFill",isAll:!0}]},request:{api:Al,extraParams:s},operation:{fullEl:m,batchDelete:{api:i,confirmTitle:"把用户移除本企业/单位后，将无法访问本企业下的所有数据，确认要移除？",text:"移除",premission:"system:member:plout"},batchDecide:{api:u.bind(null,Be),premission:"system:member:pldisable"},batchEnable:{api:u.bind(null,ne),premission:"system:member:plenable"}},table:{tableCols:[{type:"selection"},{prop:"username",label:"账号",showOverflowTooltip:!0,width:200},{prop:"nickname",label:"姓名",width:150,slots:{default({row:V}){return e("div",{style:"display: flex;flex-wrap:wrap;gap:4px;"},[e("span",null,[V.nickname]),V.isCorporation==1&&e(Fl,null,{default:()=>[h("法定代表人")]})])}}},{prop:"mobile",label:"手机",width:150,slots:{default({row:V}){return e("span",null,[ke(V.mobile)])}}},{prop:"orgList",label:"所属组织",minWidth:200,showOverflowTooltip:!0,slots:{default({row:V}){return e("span",null,[(V.orgList??[]).map(w=>w==null?void 0:w.name).join("、")||"-"])}}},{prop:"leader",label:"直属主管",showOverflowTooltip:!0,slots:{default({row:V}){var w;return e("span",null,[((w=V.leader)==null?void 0:w.nickname)||"-"])}}},{prop:"roleNames",label:"角色信息",width:150,showOverflowTooltip:!0},{prop:"orgJobNames",label:"岗位信息",width:150,showOverflowTooltip:!0},{prop:"email",label:"邮箱",showOverflowTooltip:!0},{prop:"address",label:"地址",width:150,showOverflowTooltip:!0},{prop:"idCard",label:"身份证号码",width:150,showOverflowTooltip:!0},{prop:"status",label:"状态",width:100,showOverflowTooltip:!0,slots:{default({row:V}){return V.status===Re?Pl("span",{},Ll):e(ql,{modelValue:V.status,"onUpdate:modelValue":w=>V.status=w,updateFetch:async()=>{await zl({memberId:V.memberId,status:V.status===ne?Be:ne}),a()},disabled:!Ol("system:member:enable")},null)}}},{fixed:"right",label:"操作",minWidth:180,slots:{default({row:V}){let Y=[{type:"primary",onClick:()=>{r.value=H(V),b.value=!0},text:"编辑",premission:"system:member:edit"},{type:"primary",onClick:()=>{n.value=!0,d.value=V.memberId},text:"权限分配",premission:"system:member:auth"},{type:"primary",onClick:()=>{g.value=V,y.value=!0},text:"查看",premission:"system:member:detail"},{type:"primary",onClick:async()=>{var se;(se=x.value)==null||se.reset(V.userId)},text:"重置密码",premission:"system:member:pwd"},{type:"primary",onClick:async()=>{await Yl({userId:V.userId}),F.success("解锁成功"),a()},text:"解锁",premission:"system:member:jiesuo"},{type:"primary",onClick:()=>{fe.value=!0,Ie.value=H(V)},text:"账号设置",premission:"system:member:set"},{type:"danger",text:"移除",premission:"system:member:remove",popconfirmProps:{title:"把用户移除本企业/单位后，将无法访问本企业下的所有数据，确认要移除？",confirm:async()=>{await Kl(V.memberId),F.success("移除成功"),a()}}},{type:"danger",text:"删除",premission:"system:member:delete",popconfirmProps:{title:"您确定要删除该成员吗?",confirm:async()=>{await Jl(V.memberId),F.success("删除成功"),a()}}}];return V.status===Re||(Y=Y.filter(se=>se.text!=="解锁")),e(Qe,{rowId:V.memberId,list:Y},null)}}}]}},b=c(!1),r=c(),t=c(),a=()=>{var V;(V=t.value)==null||V.refresh()},l=()=>{r.value=null,b.value=!0},n=c(!1),d=c(""),y=c(!1),g=c(),_=c(!1),T=c(!1),B=c(!1),R=c(!1),q=c([]),N=(V,w)=>{switch(w){case"leader":_.value=!0;break;case"org":T.value=!0;break;case"role":B.value=!0;break;case"post":R.value=!0;break}q.value=H(V)},fe=c(!1),Ie=c(),be=c(!1),He=async()=>{var V,w;be.value=!0;try{const P=(V=t.value)==null?void 0:V.handleGetParams();P.ids=(w=t.value)==null?void 0:w.multipleSelection.map(L=>L.memberId),Gl(P)}finally{be.value=!1}},{activeTab:ve}=ta(["manag","verify"],{queryKey:"type"});return(V,w)=>{const P=Pe,L=j,Se=je("az-page"),_e=Le,Ce=ze,W=Nl("premission");return f(),M("div",{class:"member_page"},[e(Ce,{modelValue:v(ve),"onUpdate:modelValue":w[9]||(w[9]=S=>A(ve)?ve.value=S:null),class:"az_tabs-page",type:"border-card"},{default:o(()=>[e(_e,{label:"成员管理",name:"manag"},{default:o(()=>[C("div",{class:"layout_box az_layout_tree",ref_key:"memberRef",ref:m},[C("div",{class:"az_page_tree"},[C("span",null,[Q((f(),I(L,{type:"primary",style:{"margin-bottom":"10px"},onClick:l},{default:o(()=>[e(P,{size:16,style:{"margin-right":"8px"}},{default:o(()=>[e(v(jl))]),_:1}),h(" 邀请成员 ")]),_:1})),[[W,"system:member:add"]])]),e(Wl,{class:"org-tree",modelValue:s.value.orgId,"onUpdate:modelValue":w[0]||(w[0]=S=>s.value.orgId=S),"is-filter-org":"",isMemberCount:"",topTree:{id:"",name:"全部成员"}},null,8,["modelValue"])]),e(Se,{class:"az_page_table",ref_key:"azPageRef",ref:t,config:p,maxHeight:"var(--az-layout-main-height) - 32px - 40px"},{operation:o(({multipleSelection:S,total:Y})=>[Q((f(),I(L,{type:"primary",disabled:!S.length,onClick:oe=>N(S,"leader")},{default:o(()=>[h(" 设置主管 ")]),_:2},1032,["disabled","onClick"])),[[W,"system:member:plsq"]]),Q((f(),I(L,{type:"primary",disabled:!S.length,onClick:oe=>N(S,"org")},{default:o(()=>[h(" 设置部门 ")]),_:2},1032,["disabled","onClick"])),[[W,"system:member:plsq"]]),Q((f(),I(L,{type:"primary",disabled:!S.length,onClick:oe=>N(S,"role")},{default:o(()=>[h(" 分配角色 ")]),_:2},1032,["disabled","onClick"])),[[W,"system:member:plsq"]]),Q((f(),I(L,{type:"primary",disabled:!S.length,onClick:oe=>N(S,"post")},{default:o(()=>[h(" 设置岗位 ")]),_:2},1032,["disabled","onClick"])),[[W,"system:member:plsq"]]),Q((f(),I(L,{onClick:He,type:"primary",disabled:Y===0,exportLoading:be.value},{default:o(()=>[h(" 导出 ")]),_:2},1032,["disabled","exportLoading"])),[[W,"system:member:export"]])]),_:1},512),e(ia,{modelValue:b.value,"onUpdate:modelValue":w[1]||(w[1]=S=>b.value=S),edit:r.value,onSubmit:a},null,8,["modelValue","edit"]),e(aa,{ref_key:"resetPasswordRef",ref:x,onRefresh:a},null,512),e(ma,{modelValue:n.value,"onUpdate:modelValue":w[2]||(w[2]=S=>n.value=S),id:d.value,onSubmit:a},null,8,["modelValue","id"]),_.value?(f(),I(_a,{key:0,modelValue:_.value,"onUpdate:modelValue":w[3]||(w[3]=S=>_.value=S),list:q.value,onRefresh:a},null,8,["modelValue","list"])):$("",!0),T.value?(f(),I(ga,{key:1,modelValue:T.value,"onUpdate:modelValue":w[4]||(w[4]=S=>T.value=S),list:q.value,onRefresh:a},null,8,["modelValue","list"])):$("",!0),B.value?(f(),I(Va,{key:2,modelValue:B.value,"onUpdate:modelValue":w[5]||(w[5]=S=>B.value=S),list:q.value,onRefresh:a},null,8,["modelValue","list"])):$("",!0),R.value?(f(),I(wa,{key:3,modelValue:R.value,"onUpdate:modelValue":w[6]||(w[6]=S=>R.value=S),list:q.value,onRefresh:a},null,8,["modelValue","list"])):$("",!0),g.value?(f(),I(ea,{key:4,modelValue:y.value,"onUpdate:modelValue":w[7]||(w[7]=S=>y.value=S),view:g.value},null,8,["modelValue","view"])):$("",!0),e(pa,{modelValue:fe.value,"onUpdate:modelValue":w[8]||(w[8]=S=>fe.value=S),accountSetForm:Ie.value,onSubmit:a},null,8,["modelValue","accountSetForm"])],512)]),_:1}),e(_e,{label:"加入待审核",name:"verify",lazy:""},{default:o(()=>[e(va,{onRefresh:a})]),_:1})]),_:1},8,["modelValue"])])}}});const qa=ee(xa,[["__scopeId","data-v-dd7ecbfd"]]);export{qa as default};

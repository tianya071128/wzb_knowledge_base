import{os as H,c as m,dV as pe,d as q,v as Ge,r as N,a8 as ft,a as E,i9 as mt,o as v,b as O,w as x,k as A,i as R,B as l,oa as yt,ot as Je,l as U,ou as bt,bv as ht,U as de,Z as Se,e0 as oe,ov as ge,ow as It,cC as gt,ox as ke,oy as He,gM as kt,d_ as Fe,dS as ve,oz as Xe,hQ as Ae,ka as wt,o0 as Ye,y as ee,a9 as Ue,W as Vt,x as ze,g2 as Dt,oA as Ft,jN as Ct,dU as Ot,e1 as ce,bK as we,eK as Ve,e as Ce,f as $,F as J,g as ae,p as te,ex as St,ew as Tt,j as Te,t as le,S as Rt,L as Re,ca as Ze,_ as ne,oB as je,a$ as et,oC as Et,gS as xt,I as Ee,oD as Nt,n as tt,dj as at,C as xe,ku as $t,cm as We,dW as Oe,Y as _e,aT as lt,m as ue,bc as nt,bz as Bt,dY as st,cI as Pt,e4 as Lt,aN as ot,J as it,Q as Mt,dH as At,z as Ut,dI as zt,dJ as qt,aU as Ne,dE as qe,bp as Kt,dP as jt,dQ as Wt,ba as rt,at as Qt,oE as Gt,q as Jt,b0 as Ht,e3 as Xt,oF as ie,bX as Pe,cj as ut,oG as Yt,oH as Zt,oI as ea,oJ as ta,oK as aa,oL as la,oM as na,oN as sa,oO as oa,oP as ia,oQ as ra,oR as ua,oS as ca,iu as da,hX as Le,dk as pa,a2 as va,gK as _a,c1 as fa,ac as ma,P as ct,av as ya,bm as ba,N as dt,O as pt,oT as ha,oU as Ia,oV as Qe,jL as ga,oW as ka,cg as he,ch as Ie,V as wa,oX as Va,bJ as Da,oY as Fa,oZ as Ca,o_ as Oa,o$ as Sa,d$ as Ta,p0 as Ra,p1 as Ea}from"./index-b80d5ef5.js";import{R as xa}from"./Resize-eb80395d.js";import{u as Me}from"./useQueryTab-05fa7456.js";import{F as Na}from"./FormShare-9773b44c.js";import{a as $a}from"./LoadingData-195d0581.js";import{_ as Ba}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import{m as Pa}from"./Base.vue_vue_type_script_setup_true_lang-03820366.js";import{E as La,a as Ma,b as Aa}from"./el-dropdown-item-455a6589.js";function Ua(){const i=H(),t=m(()=>{if(!i.detailsItem)return-1;const a=pe(i.detailsItem);return i.tableData.findIndex(e=>pe(e)===a)});return{prveDisable:m(()=>t.value===-1||t.value===0),nextDisable:m(()=>t.value===-1||t.value===i.tableData.length-1),handleSwitch(a){if(t.value===-1)return;const e=t.value+a;e<0||e>i.tableData.length-1||(i.detailsItem=i.tableData[e])}}}const za=q({__name:"Details",props:{modelValue:{type:Boolean},notUpdateData:{type:Boolean}},emits:["update:modelValue"],setup(i,{emit:t}){const n=Ge(i,"modelValue",t),o=H(),s=m({get(){return n.value},set(w){n.value=w}}),c=N(),p=N(),r=m(()=>{var w;return(w=c.value)==null?void 0:w.designerForms}),y=m(()=>{var w;return((w=c.value)==null?void 0:w.activeFormIndex)??0}),d=m(()=>{var w;return(w=r.value)==null?void 0:w.map(I=>({entryId:I.entryId,dataId:I.dataId}))}),k=m(()=>({sourceId:o.sourceId,dataIds:d.value??[],appId:o.appId??"",viewId:o.view.id,entryId:o.entryId})),u=m(()=>{var _,F,T,L,h;const w=(T=(F=(_=r.value)==null?void 0:_[0])==null?void 0:F.formDesigner)==null?void 0:T.fields,I=(h=(L=r.value)==null?void 0:L[0])==null?void 0:h.options.formData,g={fields:ft(w??[],{blockFilter(D){return D.type===E.subform||D.type===E.linkSubform||D.type===E.uploadImg||D.type===E.uploadFile||D.type===E.plugin},excludeFilter(D,M){return!(M!=null&&M.isFormItem)||D.source===mt.system}}).slice(0,3)??[],formData:I};return JSON.stringify(g)}),{prveDisable:b,nextDisable:f,handleSwitch:V}=Ua();return(w,I)=>{const C=de;return v(),O(ht,{modelValue:s.value,"onUpdate:modelValue":I[2]||(I[2]=g=>s.value=g),"destroy-on-close":"",title:"详情",size:"90%","append-to-body":"",direction:"btt",class:"table-details","close-on-click-modal":!l(o).isEdit},{header:x(()=>{var g;return[A("div",{class:"az_flex"},[A("div",{ref_key:"tabTeleportRef",ref:p},null,512),A("div",{class:"table-details-quick"},[R(C,{link:"",icon:l(yt),style:{"font-size":"20px"},title:"上一条",disabled:l(b),onClick:I[0]||(I[0]=_=>l(V)(-1))},null,8,["icon","disabled"]),R(C,{link:"",icon:l(Je),style:{"font-size":"20px"},title:"下一条",disabled:l(f),onClick:I[1]||(I[1]=_=>l(V)(1))},null,8,["icon","disabled"]),(g=r.value)!=null&&g.length?(v(),O(Na,{key:0,entryId:r.value[y.value].entryId,options:k.value,dataSummary:u.value},null,8,["entryId","options","dataSummary"])):U("",!0)])])]}),default:x(()=>[R(bt,{ref_key:"detailsContentRef",ref:c,"tab-teleport":p.value,notUpdateData:w.notUpdateData},null,8,["tab-teleport","notUpdateData"])]),_:1},8,["modelValue","close-on-click-modal"])}}});const De=`select_${Se()}`,$e={label:"全部",value:De},Be=`select_${Se()}`;function fe(i){var C,g;const t=H(),a=m(()=>l(i)),e=m(()=>{var _,F,T;return{label:((T=(F=(_=a.value)==null?void 0:_.displayItems)==null?void 0:F.emptyOptions)==null?void 0:T.alias)||"为空",value:Be}}),n=m(()=>{var _,F;return(F=t.matchField((_=a.value)==null?void 0:_.fieldId))==null?void 0:F.field}),o=m(()=>{var _;return(_=n.value)==null?void 0:_.type}),s=((C=a.value)==null?void 0:C.filterId)??`${(g=a.value)==null?void 0:g.fieldId}.${Se()}`,c=m(()=>{var _;return((_=a.value)==null?void 0:_.isAll)!==!1}),p=m(()=>o.value&&[E.multiple,E.department,E.cascader,E.linkData].includes(o.value)),r=m(()=>o.value&&[E.radio,E.multiple].includes(o.value)),y=m(()=>{var _;return o.value===E.department&&((_=a.value)!=null&&_.isContainChild)?oe.dependOrg:p.value?oe.contain:oe.equal}),d=_=>{var F,T,L,h;_===De||_==null?t.filterListPlus.delete(s):_===Be?t.filterListPlus.set(s,{fieldId:((F=a.value)==null?void 0:F.fieldId)??"",type:oe.empty,value:null}):t.filterListPlus.set(s,{fieldId:((T=a.value)==null?void 0:T.fieldId)??"",type:y.value,controlType:(L=a.value)!=null&&L.isContainChild&&o.value!==E.department&&((h=a.value)!=null&&h.isContainChild)?kt.tree:void 0,value:[_]})},k=m({get(){const _=t.filterListPlus.get(s);return _?_.type===oe.empty?Be:_.value[0]:c.value?De:void 0},set(_){d(_),t.runSearch({isReset:!0,mode:ge.statisticsScreen})}}),u=m(()=>{var T;if(!r.value)return[];const _=a.value;let F=[];if(!_||!n.value)F=[];else{const L=It(n.value)??[];F=((T=_.options)==null?void 0:T.filter(h=>L.some(D=>D.value===h.value)).map(h=>{var D;return{value:h.value,label:h.alias||(((D=L.find(M=>M.value===h.value))==null?void 0:D.label)??"")}}))??[]}return c.value&&F.unshift($e),[...F]}),b=_=>{var F;return(F=u.value.find(T=>T.value===_))==null?void 0:F.label};gt(()=>t.filterListPlus.delete(s));const f=N(new Map),V=m(()=>{var _,F,T,L;return!!((F=(_=a.value)==null?void 0:_.displayItems)!=null&&F.isStatistics||((L=(T=a.value)==null?void 0:T.displayItems)==null?void 0:L.type)===ke.valuable)}),w=async()=>{var h,D,M,Q;if(!((h=n.value)!=null&&h.fieldId)||!V.value)return;const _=[];(D=t.view.dataFilter)!=null&&D.length&&_.push(t.view.dataFilter);const F=[...t.filterListPlus.entries()].filter(([P])=>P!==s).map(([,P])=>{var K;return{cn:Fe.and,leftTableName:ve(P.fieldId).entryId,leftFieldName:ve(P.fieldId).fieldId,leftFieldType:(K=t.matchField(P.fieldId))==null?void 0:K.field.type,type:P.type,value:P.value,controlType:P.controlType}});F.length&&_.push([{cn:Fe.or,conditionSets:F}]);const T=ve((M=n.value)==null?void 0:M.fieldId),L=await Xe({column:T.fieldId,isGroup:0,tableName:T.entryId??"",fieldType:n.value.type,isShowCount:0,viewId:t.view.id,filterConditions:_,isShowChild:(Q=a.value)!=null&&Q.isContainChild?0:1});f.value=new Map(L.map(P=>{var re,S,B;let K=P!=null&&P.isAll?$e.value:P!=null&&P.isEmpty?e.value.value:(re=n.value)!=null&&re.type&&[E.parent,E.cascader].includes(n.value.type)&&!(n.value.type===E.cascader&&((S=n.value.options.cascaderData)==null?void 0:S.type)===Ae.custom)?P==null?void 0:P.id:P==null?void 0:P[T.fieldId];const X=parseFloat(P.count);return((B=n.value)==null?void 0:B.type)===E.switch&&K!=null&&wt(K)&&(K=Number(K)),[K,X]}))},I=Ye(w,300);return t.on(He,()=>{I()}),{selectValue:k,options:u,getLabel:b,fieldType:o,allValue:De,allOption:$e,filterField:n,emptyOption:e,filterId:s,loadCount:w,countMap:f,isCount:V,render:t,setValue:d}}function me(i){ee([()=>i.value.options,()=>i.value.selectValue],(t,a)=>{if(!Ue(t,a)){const e=[];Vt(i.value.options,i.value.childrenKey??`ceshi_${Se()}`,n=>{e.push(n==null?void 0:n[i.value.key??"value"])}),e.includes(i.value.selectValue)||i.value.onUpdateValue(e[0])}},{immediate:!0})}function qa(i){const t=N(!1),a=m(()=>l(i.filterItem)),{selectValue:e,allOption:n,filterField:o,emptyOption:s,loadCount:c,countMap:p,setValue:r}=fe(a),y=m(()=>{var h;return((h=o.value)==null?void 0:h.type)===E.linkData?o.value.options.sourceId:""}),d=N(),k=m(()=>{var h,D,M;return((M=(D=(h=d.value)==null?void 0:h.entryIds)==null?void 0:D[0])==null?void 0:M.entryId)??""}),u=ze(),b=async()=>{await c(),y.value&&(d.value=await u.getSoureceData(y.value),d.value&&await g()),t.value=!0},f=m(()=>{var h;if(((h=o.value)==null?void 0:h.type)===E.linkData)return o.value.options.linkFieldId}),V=m(()=>{var h;if(d.value&&f.value){let D=(h=Dt(f.value,d.value.fields??[]))==null?void 0:h.field;if(!D){const M=o.value.options.linkFieldType,Q=M&&Ft(M);Q&&(Q.fieldId=f.value,D=Q)}return D}}),w=m(()=>{var D,M,Q,P,K;return{sourceId:y.value,conditions:((M=(D=a.value)==null?void 0:D.displayItems)==null?void 0:M.condition)??[],filterConditions:Ct({field:((Q=o.value)==null?void 0:Q.type)===E.linkData?o.value:void 0,query:(P=i.searchName)==null?void 0:P.trim(),noPrecise:!0}),limit:1e4,disableRequest:!d.value,showField:[{fieldId:((K=V.value)==null?void 0:K.fieldId)??""}]}}),{getData:I,tableData:C,directGetData:g,loading:_}=Ot(w),F=m(()=>{var D,M,Q,P,K;let h=[...C.value.map(X=>({value:ce({entryId:k.value,fieldId:"id",rowData:X}),label:ce({fieldId:f.value??"",rowData:X})??""}))];return((D=a.value)==null?void 0:D.isAll)!==!1&&h.unshift(n),(Q=(M=a.value)==null?void 0:M.displayItems)!=null&&Q.isEmpty&&h.push(s.value),((K=(P=a.value)==null?void 0:P.displayItems)==null?void 0:K.type)===ke.valuable&&(h=h.filter(X=>{var re;return[n.value].includes(X.value)||!!((re=p.value)!=null&&re.get(X.value))})),h}),T=m(()=>F.value.filter(h=>{var D;return(D=i.searchName)!=null&&D.trim()?![s.value.value,n.value].includes(h.value):!0}));return ee(()=>{var h;return(h=i.searchName)==null?void 0:h.trim()},()=>{d.value&&I()}),me(m(()=>({selectValue:e.value,item:a.value,options:t.value?F.value:[],onUpdateValue(h){e.value=h}}))),{init:b,loading:_,selectValue:e,handleChange:h=>{e.value!==h.value&&(e.value=h.value)},normlOptions:T,linkField:V,allOption:n,countMap:p,setValue:r}}const Ka=q({__name:"LinkDataFilter",props:{searchName:{},filterItem:{}},setup(i){const t=i,{init:a,loading:e,selectValue:n,handleChange:o,normlOptions:s,linkField:c,allOption:p,countMap:r}=qa(we({...Ve(t)}));return(y,d)=>{const k=Ze;return v(),O(Re,{load:l(a)},{default:x(()=>[Ce((v(),$("div",{class:"other_tree"},[Ce(A("div",null,[(v(!0),$(J,null,ae(l(s),u=>{var b,f,V;return v(),$("div",{class:te(["other_tree-wrapper",{"is-active":l(n)===u.value}]),onClick:w=>l(o)(u),key:u.value},[A("div",{class:"other_tree-label"},[l(c)&&u.value!==l(p).value?(v(),O(St,{key:0,bubble:"",emptyText:" ",mode:l(Tt).list,content:u.label,field:l(c),"other-props":{norml:!0}},null,8,["mode","content","field"])):(v(),O(Te,{key:1,style:{display:"block"},content:u.label,"show-after":300},null,8,["content"])),(f=(b=y.filterItem)==null?void 0:b.displayItems)!=null&&f.isStatistics?(v(),$("div",{key:2,class:"label-count"}," ("+le(((V=l(r))==null?void 0:V.get(u.value))??0)+") ",1)):U("",!0)])],10,["onClick"])}),128)),l(s).length?U("",!0):(v(),$("div",{key:0,class:"other_tree-empty"},"暂无数据"))],512),[[Rt,!l(e)]])])),[[k,l(e)]])]),_:1},8,["load"])}}});const ja=ne(Ka,[["__scopeId","data-v-821d49fa"]]);function Wa(i){const t=N(!1),a=m(()=>l(i.filterItem)),{render:e,selectValue:n,allOption:o,filterField:s,emptyOption:c,loadCount:p,countMap:r,setValue:y}=fe(a),d=N([]),k=async()=>{var g,_,F,T,L;if(await p(),!((g=s.value)!=null&&g.fieldId))return;const I=ve(s.value.fieldId),C=await Xe({column:I.fieldId,isGroup:0,tableName:I.entryId??"",filterConditions:(F=(_=a.value)==null?void 0:_.displayItems)!=null&&F.condition?[(L=(T=a.value)==null?void 0:T.displayItems)==null?void 0:L.condition]:void 0,fieldType:s.value.type,isShowCount:1});d.value=C.map(h=>h==null?void 0:h[I.fieldId]).filter(h=>h!=null).map(h=>({label:h,value:h}))},u=async()=>{var C;if(!s.value)return;let I=await Et(s.value);I=((C=a.value.options)==null?void 0:C.filter(g=>I.some(_=>_.value===g.value)).map(g=>{var _;return{value:g.value,label:g.alias||(((_=I.find(F=>F.value===g.value))==null?void 0:_.label)??"")}}))??[],d.value=[...I]},b=async()=>{if(!s.value)return Promise.reject({loadState:et.danger,msg:"筛选控件配置异常!"});const I=[];[E.switch,E.radio,E.multiple].includes(s.value.type)||I.push(k()),[E.radio,E.multiple].includes(s.value.type)&&I.push(u()),await Promise.all(I),t.value=!0},f=m(()=>{var C,g,_,F,T,L;let I=[...d.value];return((C=s.value)==null?void 0:C.type)===E.switch&&(I=[{label:s.value.options.activeText||"开",value:je.activeValue},{label:s.value.options.inactiveText||"关",value:je.inactiveValue}]),((g=a.value)==null?void 0:g.isAll)!==!1&&I.unshift(o),(F=(_=a.value)==null?void 0:_.displayItems)!=null&&F.isEmpty&&I.push(c.value),((L=(T=a.value)==null?void 0:T.displayItems)==null?void 0:L.type)===ke.valuable&&(I=I.filter(h=>{var D;return[o.value].includes(h.value)||!!((D=r.value)!=null&&D.get(h.value))})),I}),V=m(()=>{var I;return(I=i.searchName)!=null&&I.trim()?f.value.filter(C=>{var g;return C.label.includes((g=i.searchName)==null?void 0:g.trim())}):f.value}),w=Ye(b,300);return e.on(He,()=>{w()}),me(m(()=>({selectValue:n.value,item:a.value,options:t.value?f.value:[],onUpdateValue(I){n.value=I}}))),{selectValue:n,init:b,normlOptions:V,countMap:r,render:e,setValue:y}}const Qa=q({__name:"OtherFilter",props:{searchName:{},filterItem:{}},setup(i){const t=i,{selectValue:a,init:e,normlOptions:n,countMap:o}=Wa(we({...Ve(t)})),s=c=>{a.value!==c.value&&(a.value=c.value)};return(c,p)=>(v(),O(Re,{load:l(e)},{default:x(()=>[A("div",{class:"other_filter"},[(v(!0),$(J,null,ae(l(n),r=>{var y,d,k,u,b;return v(),$("div",{key:r.value,class:te(["other_filter-wrapper",{"is-active":l(a)===r.value}]),onClick:f=>s(r)},[A("div",{class:te(["other_filter-label",{"is-count":(d=(y=c.filterItem)==null?void 0:y.displayItems)==null?void 0:d.isStatistics}])},[R(Te,{class:"label-content",content:r.label,"show-after":300},null,8,["content"]),(u=(k=c.filterItem)==null?void 0:k.displayItems)!=null&&u.isStatistics?(v(),$("div",{key:0,class:"label-count"}," ("+le(((b=l(o))==null?void 0:b.get(r.value))??0)+") ",1)):U("",!0)],2)],10,["onClick"])}),128)),l(n).length?U("",!0):(v(),$("div",{key:0,class:"other_filter-empty"},"暂无数据"))])]),_:1},8,["load"]))}});const Ga=ne(Qa,[["__scopeId","data-v-62b7744a"]]),Ja=q({__name:"OrgTree",props:{modelValue:{}},emits:["update:modelValue"],setup(i,{expose:t,emit:a}){const e=i,n=a,o=m({get(){return e.modelValue?xt(e.modelValue):[]},set(c){n("update:modelValue",c[0]??"")}}),s=N();return t({treeData:m(()=>{var c;return((c=s.value)==null?void 0:c.treeData)??[]})}),(c,p)=>(v(),O(Nt,Ee({modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=r=>o.value=r)},c.$attrs,{ref_key:"orgTabPaneRef",ref:s}),null,16,["modelValue"]))}});function Ha(i){const t=m(()=>l(i.filterItem)),{selectValue:a,allOption:e,emptyOption:n,loadCount:o,countMap:s,setValue:c}=fe(t);return{orgVal:m({get(){var y,d;return a.value===e.value?e.value:a.value===n.value.value?n.value.value:(d=(y=tt(a.value))==null?void 0:y[0])==null?void 0:d.id},set(y){y===e.value?a.value=e.value:y===n.value.value?a.value=n.value.value:y?a.value={id:y,type:at.org}:a.value=y}}),allOption:e,countMap:s,emptyOption:n,init:async()=>{await o()},selectValue:a,setValue:c}}const Xa=q({__name:"OrgFilter",props:{searchName:{},filterItem:{}},setup(i){const t=i,{orgVal:a,allOption:e,countMap:n,emptyOption:o,init:s}=Ha(we({...Ve(t)})),c=N();return me(m(()=>{var p;return{selectValue:a.value,item:t.filterItem,options:((p=c.value)==null?void 0:p.treeData)??[],onUpdateValue(r){a.value=r},childrenKey:"children",key:"id"}})),(p,r)=>{const y=$a;return v(),O(y,{load:l(s)},{default:x(()=>{var d,k,u,b,f,V;return[R(Ja,{ref_key:"orgTreeRef",ref:c,modelValue:l(a),"onUpdate:modelValue":r[0]||(r[0]=w=>xe(a)?a.value=w:null),topTree:p.filterItem.isAll!==!1?{id:l(e).value,name:"全部"}:void 0,name:p.searchName,isStatistics:!!((k=(d=p.filterItem)==null?void 0:d.displayItems)!=null&&k.isStatistics),countMap:l(n),onlyExistVal:((b=(u=p.filterItem)==null?void 0:u.displayItems)==null?void 0:b.type)===l(ke).valuable,bottomTree:(V=(f=p.filterItem)==null?void 0:f.displayItems)!=null&&V.isEmpty?{id:l(o).value,name:l(o).label}:void 0},null,8,["modelValue","topTree","name","isStatistics","countMap","onlyExistVal","bottomTree"])]}),_:1},8,["load"])}}}),Ya=q({inheritAttrs:!1,__name:"CascaderTree",props:{field:{},modelValue:{},allOption:{},emptyOption:{},name:{},auth:{},isStatistics:{type:Boolean},countMap:{},onlyExistVal:{type:Boolean}},emits:["update:modelValue","updateData"],setup(i,{expose:t,emit:a}){const e=i,n=a,o=Ge(e,"modelValue",n),s=N(),{getData:c,customOptions:p,dataType:r,soureceData:y,parentField:d}=$t(e.field,{noCache:!0}),k=m(()=>({label:"__label__",children:"__children__",isLeaf:"__leaf__"})),u=N(!1),b=We([]),f=S=>{const B=[...S];return e.allOption&&B.unshift({__label__:e.allOption.name,__leaf__:!0,__value__:e.allOption.id,__childrenId__:"",__parentId__:""}),e.emptyOption&&B.push({__label__:e.emptyOption.name,__leaf__:!0,__value__:e.emptyOption.id,__childrenId__:"",__parentId__:""}),B},V=async()=>{u.value=!0;try{r.value===Ae.custom?b.value=f(p.value):b.value=f(await c())}finally{u.value=!1}};V();const w=S=>{o.value=S.__value__},I=(S,B)=>S?B.__label__.includes(S):!0;ee([()=>e.name],()=>{var S;(S=s.value)==null||S.filter(e.name)});const C=()=>{V(),n("updateData",g.value??"")},g=m(()=>{var S,B;return(B=(S=y.value)==null?void 0:S.entryIds[0])==null?void 0:B.entryId}),_=N(new Set),F=(S,B)=>{S?_.value.add(B):_.value.delete(B)},T=N(!1),L=N(""),h=N(""),D=m(()=>{const S=!!L.value;return{renderOptions:{entryId:g.value??"",mode:S?Oe.edit:Oe.enter,formData:h.value&&d.value?{[ve(d.value.fieldId).fieldId]:h.value}:void 0,useDefault:h.value&&d.value?!0:void 0},dataId:L.value||void 0}}),M=S=>async(...B)=>{var j,z;await((z=(j=e.auth)==null?void 0:j.beforeCallback)==null?void 0:z.call(j))!==!1&&S(...B)},Q=S=>{var Z,j,z,G,se,W;const B=[];return(j=(Z=e.auth)==null?void 0:Z.add)!=null&&j.enable&&B.push({type:"primary",text:"添加下级",onClick(){P(S.__linkFieldValue__)}}),(G=(z=e.auth)==null?void 0:z.edit)!=null&&G.enable&&B.push({type:"primary",text:"编辑",onClick:M(()=>{L.value=S.__dataId__,h.value="",T.value=!0})}),(W=(se=e.auth)==null?void 0:se.delete)!=null&&W.enable&&B.push({type:"danger",text:"删除",popconfirmProps:{title:"您确定要删除该数据吗?",confirm:M(async()=>{if(!g.value)return console.warn("没有提取到对应的条目 id");await Lt({id:S.__dataId__,entryId:g.value}),C()})}}),B},P=M(S=>{L.value="",h.value=S??"",T.value=!0}),K=We([]),X=N([]),re=m(()=>{var B;const S=new Map;return function Z(j){var z;for(const G of j)S.set(G.key,G),(z=G.childNodes)!=null&&z.length&&Z(G.childNodes)}(((B=s.value)==null?void 0:B.root.childNodes)??[]),S});return ee([b,()=>e.countMap,()=>e.onlyExistVal],()=>{var Z;const S=_e([...b.value]);if(e.onlyExistVal&&function j(z){var G,se,W,ye;for(let Y=z.length-1;Y>=0;Y--)(G=z[Y].__children__)!=null&&G.length&&j(z[Y].__children__),z[Y].__value__!==((se=e.allOption)==null?void 0:se.id)&&(((W=e.countMap)==null?void 0:W.get(z[Y].__value__))??0)<=0&&!((ye=z[Y].__children__)!=null&&ye.length)&&z.splice(Y,1)}(S),Ue(S,K.value))return;K.value=S,X.value=[];const B=((Z=s.value)==null?void 0:Z.store.nodesMap)??{};Object.values(B).forEach(j=>{j.expanded&&X.value.push(j.key)}),lt(()=>{var j,z,G;o.value&&!re.value.has(o.value)?o.value=((z=(j=s.value)==null?void 0:j.root.data[0])==null?void 0:z.__value__)??"":(G=s.value)==null||G.setCurrentKey(o.value)})},{immediate:!0}),t({treeData:K}),(S,B)=>{var G,se;const Z=de,j=Pt,z=Ze;return v(),$(J,null,[(se=(G=S.auth)==null?void 0:G.add)!=null&&se.enable?(v(),O(Z,{key:0,type:"primary",class:"w100 mb-10",onClick:B[0]||(B[0]=W=>l(P)())},{default:x(()=>[ue(" 新增 ")]),_:1})):U("",!0),Ce((v(),O(j,Ee({ref_key:"treeRef",ref:s,class:"cascader_tree","filter-node-method":I,props:k.value,"node-key":"__value__","highlight-current":"","expand-on-click-node":!1,data:K.value,defaultExpandedKeys:X.value,"current-node-key":l(o),onCurrentChange:w},S.$attrs),{default:x(({data:W})=>{var ye,Y,Ke;return[A("div",{class:"cascader_tree-container"},[A("div",{class:"tree-label"},[R(Te,{class:"label-content",content:W.__label__,"show-after":300},null,8,["content"]),S.isStatistics?(v(),$("div",{key:0,class:"label-count"}," ("+le(((ye=S.countMap)==null?void 0:ye.get(W.__value__))??0)+") ",1)):U("",!0)]),(v(!0),$(J,null,ae(S.field.options.showOtherFieldIds,be=>(v(),$(J,{key:be},[l(ce)({rowData:W,fieldId:be})?(v(),$("div",{key:0,class:"cascader_tree-tip"},le(l(ce)({rowData:W,fieldId:be})),1)):U("",!0)],64))),128))]),W.__value__!==((Y=e.allOption)==null?void 0:Y.id)&&W.__value__!==((Ke=e.emptyOption)==null?void 0:Ke.id)?(v(),O(Ba,{key:0,list:Q(W),num:0,rowId:"index1",placement:"right",transition:"el-fade-in-linear",onVisibleChange:be=>F(be,W.__value__)},{default:x(()=>[A("div",{class:te(["cascader_tree-icon",{"is-visible":_.value.has(W.__value__)}]),onClick:B[1]||(B[1]=nt(()=>{},["stop"]))},[R(Bt,{"icon-class":"MoreFilled"})],2)]),_:2},1032,["list","onVisibleChange"])):U("",!0)]}),_:1},16,["props","data","defaultExpandedKeys","current-node-key"])),[[z,u.value]]),R(st,{modelValue:T.value,"onUpdate:modelValue":B[2]||(B[2]=W=>T.value=W),prop:D.value,onSuccess:C,onEditSuccess:C},null,8,["modelValue","prop"])],64)}}});const Za=ne(Ya,[["__scopeId","data-v-00e44262"]]);function el(i){const t=m(()=>l(i.filterItem)),{selectValue:a,allOption:e,filterField:n,emptyOption:o,loadCount:s,countMap:c,render:p,setValue:r}=fe(t),y=async()=>{await s()},d=m(()=>{var b,f,V,w,I,C,g,_,F,T;const u=!!(n.value&&[E.parent,E.cascader].includes(n.value.type)&&!(((b=n.value)==null?void 0:b.type)===E.cascader&&n.value.options.cascaderData.type===Ae.custom));return{add:{enable:!!(u&&((w=(V=(f=t.value)==null?void 0:f.isSource)==null?void 0:V.auth)!=null&&w.includes(0)))},edit:{enable:!!(u&&((g=(C=(I=t.value)==null?void 0:I.isSource)==null?void 0:C.auth)!=null&&g.includes(1)))},delete:{enable:!!(u&&((T=(F=(_=t.value)==null?void 0:_.isSource)==null?void 0:F.auth)!=null&&T.includes(2)))},beforeCallback(){if(p.preview)return ot.warning("预览模式下不支持操作数据"),!1}}});return{init:y,parentFieldAuth:d,handleUPdateData:u=>{var b;(b=p.soureceInfo)!=null&&b.entryIds.some(f=>f.entryId===u)&&p.runSearch({isReset:!1,mode:ge.other})},selectValue:a,allOption:e,emptyOption:o,filterField:n,countMap:c,setValue:r}}const tl=q({__name:"CascaderFilter",props:{searchName:{},filterItem:{}},setup(i){const t=i,{selectValue:a,init:e,allOption:n,emptyOption:o,filterField:s,parentFieldAuth:c,handleUPdateData:p,countMap:r}=el(we({...Ve(t)})),y=N();return me(m(()=>{var d;return{selectValue:a.value,item:t.filterItem,options:((d=y.value)==null?void 0:d.treeData)??[],onUpdateValue(k){a.value=k},childrenKey:"__children__",key:"__value__"}})),(d,k)=>(v(),O(Re,{load:l(e)},{default:x(()=>{var u,b,f,V,w,I;return[R(Za,{ref_key:"cascaderTree",ref:y,modelValue:l(a),"onUpdate:modelValue":k[0]||(k[0]=C=>xe(a)?a.value=C:null),allOption:d.filterItem.isAll!==!1?{id:l(n).value,name:"全部"}:void 0,emptyOption:(b=(u=d.filterItem)==null?void 0:u.displayItems)!=null&&b.isEmpty?{id:l(o).value,name:l(o).label}:void 0,field:l(s),name:d.searchName,auth:l(c),isStatistics:!!((V=(f=d.filterItem)==null?void 0:f.displayItems)!=null&&V.isStatistics),countMap:l(r),onUpdateData:l(p),onlyExistVal:((I=(w=d.filterItem)==null?void 0:w.displayItems)==null?void 0:I.type)===l(ke).valuable},null,8,["modelValue","allOption","emptyOption","field","name","auth","isStatistics","countMap","onUpdateData","onlyExistVal"])]}),_:1},8,["load"]))}}),al=q({__name:"LeftFilter",setup(i){const t=H(),a=m(()=>t.view.basis.treeFilter),e=N(""),n=m(()=>{var o,s,c;return(c=(s=t.matchField((o=a.value)==null?void 0:o.fieldId))==null?void 0:s.field)==null?void 0:c.type});return(o,s)=>{const c=Mt;return a.value?(v(),$("div",{key:0},[R(c,{modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=p=>e.value=p),clearable:"",class:"az_input-radius mb-10",placeholder:"搜索","prefix-icon":l(it)},null,8,["modelValue","prefix-icon"]),n.value===l(E).linkData?(v(),O(ja,{key:0,searchName:e.value,filterItem:a.value},null,8,["searchName","filterItem"])):n.value===l(E).parent||n.value===l(E).cascader?(v(),O(tl,{key:1,searchName:e.value,filterItem:a.value},null,8,["searchName","filterItem"])):n.value===l(E).department||n.value===l(E).departmentSingle?(v(),O(Xa,{key:2,searchName:e.value,filterItem:a.value},null,8,["searchName","filterItem"])):(v(),O(Ga,{key:3,searchName:e.value,filterItem:a.value},null,8,["searchName","filterItem"]))])):U("",!0)}}}),ll=q({__name:"FullOperation",setup(i){const{isFullscreen:t,toggle:a}=At(),e=H();return Ut(()=>{const n=zt(e.fullEl);n&&n.classList[t.value?"add":"remove"]("az-full")}),(n,o)=>{const s=de,c=Ne;return v(),O(c,{content:l(t)?"退出全屏":"全屏",placement:"top","show-after":300},{default:x(()=>[R(s,{icon:l(qt),onClick:l(a)},null,8,["icon","onClick"])]),_:1},8,["content"])}}}),nl=q({__name:"ModeOperation",setup(i){const t=H(),{tableMode:a}=qe(t.id),e=m(()=>Kt(jt)),n=N(),o=s=>{a.value=s};return(s,c)=>{const p=de,r=Ne,y=rt;return v(),$(J,null,[R(r,{content:"表格模式",placement:"top","show-after":300},{default:x(()=>[R(p,{icon:l(Wt),ref_key:"buttonRef",ref:n},null,8,["icon"])]),_:1}),R(y,{width:150,placement:"bottom",trigger:"click",offset:20,"virtual-triggering":"","virtual-ref":n.value,"hide-after":0,transition:"el-zoom-in-top","popper-class":"az-custom-popper"},{default:x(()=>[A("ul",{class:"az-custom-popper-menu"},[(v(!0),$(J,null,ae(e.value,(d,k)=>(v(),$("li",{key:k,class:te(["az-custom-popper-menu__item",{"az-custom-popper-menu__active":l(a)===d.value}]),onClick:u=>o(d.value)},le(d.label),11,["onClick"]))),128))])]),_:1},8,["virtual-ref"])],64)}}});function sl(){const i=H(),{tableFields:t}=qe(i.id),a=N(_e(t.value)),e=N(),n=m({set(p){a.value.forEach(r=>r.show=p)},get(){return a.value.every(p=>p.show)}}),o=m(()=>!(a.value.every(p=>p.show)||a.value.every(p=>!p.show)));return{render:i,tableFields:t,fields:a,fieldSetting:e,checkAll:n,isIndeterminate:o,saveFieldSetting:()=>{t.value=_e(a.value)},handlerPopoverShow:()=>{a.value=_e(t.value)}}}const ol=q({__name:"FieldsOperation",setup(i){const{fields:t,checkAll:a,isIndeterminate:e,saveFieldSetting:n,handlerPopoverShow:o}=sl(),s=N(),c=N(),p=()=>{var d,k;(k=(d=l(c).popperRef)==null?void 0:d.delayHide)==null||k.call(d)},r=()=>{var d,k;(k=(d=l(c)).hide)==null||k.call(d)},y=()=>{r(),n()};return(d,k)=>{const u=de,b=Ne,f=Jt,V=rt;return v(),$(J,null,[R(b,{content:"字段管理",placement:"top","show-after":300},{default:x(()=>[Ce(R(u,{icon:l(Qt),ref_key:"fieldSetting",ref:s,onClick:l(o)},null,8,["icon","onClick"]),[[l(Gt),p]])]),_:1}),R(V,{ref_key:"popoverRef",ref:c,width:250,placement:"bottom-end",trigger:"click",offset:20,"virtual-triggering":"","virtual-ref":s.value,"hide-after":0,transition:"el-zoom-in-top"},{default:x(()=>[A("div",{class:"az_page-operation-field"},[A("div",{class:"field-all"},[R(f,{modelValue:l(a),"onUpdate:modelValue":k[0]||(k[0]=w=>xe(a)?a.value=w:null),indeterminate:l(e)},{default:x(()=>[ue(" 勾选您要显示的字段 ")]),_:1},8,["modelValue","indeterminate"])]),A("ul",{class:"field-select"},[(v(!0),$(J,null,ae(l(t),(w,I)=>(v(),$("li",{key:I},[R(f,{class:"w100",modelValue:w.show,"onUpdate:modelValue":C=>w.show=C,label:w.label},null,8,["modelValue","onUpdate:modelValue","label"])]))),128)),l(t).length?U("",!0):(v(),$("li",{key:0,class:"az-data-empty"},"没有可勾选的字段"))]),A("div",{class:"field-submit"},[R(u,{onClick:r},{default:x(()=>[ue("取消")]),_:1}),R(u,{type:"primary",onClick:y},{default:x(()=>[ue("保存")]),_:1})])])]),_:1},8,["virtual-ref"])],64)}}});const il=ne(ol,[["__scopeId","data-v-437a454f"]]),vt=q({__name:"TableOperation",props:{holdNum:{default:5}},setup(i){const t=H();return(a,e)=>{const n=de,o=Ne,s=Xt;return v(),O(s,null,{default:x(()=>[a.holdNum>1?(v(),O(o,{key:0,content:"刷新",placement:"top","show-after":300},{default:x(()=>[R(n,{icon:l(Ht),onClick:e[0]||(e[0]=c=>l(t).runSearch({isReset:!1,mode:l(ge).btnOperating}))},null,8,["icon"])]),_:1})):U("",!0),a.holdNum>2?(v(),O(ll,{key:1})):U("",!0),a.holdNum>3?(v(),O(nl,{key:2})):U("",!0),a.holdNum>4&&!l(t).publish?(v(),O(il,{key:3})):U("",!0)]),_:1})}}}),rl=q({__name:"Operation",setup(i){const t=H(),a=m(()=>t.view.basis.style!==ie.addOrView&&(y.value.length||!t.view.quickFilter.length)),e=N(),{width:n}=Pe(e),o=N(),{width:s}=Pe(o),c=m(()=>Math.floor((n.value-s.value-12)/46)),p=Object.assign({"./TableBtn/AddBtn.vue":ea,"./TableBtn/BatchDeleteBtn.vue":ta,"./TableBtn/BtnWrapper.vue":aa,"./TableBtn/CustomBtn.vue":la,"./TableBtn/DeleteBtn.vue":na,"./TableBtn/DownloadBtn.vue":sa,"./TableBtn/EditBtn.vue":oa,"./TableBtn/ExportBtn.vue":ia,"./TableBtn/ImportBtn.vue":ra,"./TableBtn/PrintBtn.vue":ua,"./TableBtn/SignatureBtn.vue":ca}),r=d=>{const k=Yt(`${d.type===Zt.system?d.systemType:"Custom"}Btn`);try{const u=p[`./TableBtn/${k}.vue`];return u?u.default??u:Promise.reject("按钮文件没有找到")}catch{return console.error(`按钮“${d.name}”的“${k}”路径错误，请检查！`),null}},y=m(()=>t.getEventBtns());return(d,k)=>a.value?(v(),$("div",{key:0,class:"table_render_operation",ref_key:"containerRef",ref:e},[A("div",{class:"operation-btns",ref_key:"operationBtnsRef",ref:o},[(v(!0),$(J,null,ae(y.value,u=>(v(),O(ut(r(u)),{key:u.btnId,btn:u},null,8,["btn"]))),128))],512),A("div",{class:"operation-other"},[R(vt,{holdNum:c.value},null,8,["holdNum"])])],512)):U("",!0)}});function ul(){const i="quick_screent",t=H(),a=m(()=>[...t.view.quickFilter].map(b=>({...b,filterId:`${i}_${b.fieldId}`}))),e=u=>{var b;return u.alias||((b=t.matchField(u.fieldId))==null?void 0:b.field.options.label)},n=m(()=>{const u=Math.max(...(a.value||[]).map(b=>{const f=e(b);return da(f??"",14)}));return u<180?u+30:180}),o={[`${E.date}.${oe.between}`]:2,[`${E.date}.${oe.dateDynamic}`]:2},s=u=>{const b=n.value+200,f=t.matchField(u.fieldId),V=o[`${f==null?void 0:f.field.type}.${u.type}`]??1;return b*V+"px"},c=u=>{var b;return((b=t.filterListPlus.get(u.filterId))==null?void 0:b.value)??null},p=(u,b)=>{!Array.isArray(u)||u.length===0?t.filterListPlus.delete(b.filterId):t.filterListPlus.set(b.filterId,{fieldId:b.fieldId??"",type:b.type,value:u})},r=()=>{t.runSearch({isReset:!0,mode:ge.quickScreen})};return{filterList:a,getFilterLabel:e,labelWidth:n,getWidth:s,getVal:c,setVal:p,onSearch:r,onQuery:()=>{t.disabledLoad=!1,r()},onReset:()=>{for(const u of a.value)p(null,u);r()},render:t,getSelectRange:u=>{var V,w,I,C,g;const b=(V=u.selectRange)==null?void 0:V.type;let f;if(b===Le.custom)(I=(w=u.selectRange)==null?void 0:w.custom)!=null&&I.length&&(f=(C=u.selectRange)==null?void 0:C.custom);else if(b===Le.link){const _=a.value.find(T=>{var L;return T.fieldId===((L=u.selectRange)==null?void 0:L.linkFieldId)}),F=_&&c(_);Array.isArray(F)&&(f=F)}return f=f&&[...f],(g=u.selectRange)!=null&&g.isChildOrg&&(f==null||f.push({type:at.dynamic,id:pa.selectedOrgToChild})),f}}}const cl=q({__name:"QuickScreen",setup(i){const{filterList:t,getFilterLabel:a,labelWidth:e,getVal:n,setVal:o,onSearch:s,onQuery:c,onReset:p,render:r,getWidth:y,getSelectRange:d}=ul(),k=C=>{const g=r.matchField(C.fieldId);return(g==null?void 0:g.field.type)&&Pa(g==null?void 0:g.field.type)},u=N(),{width:b}=Pe(u),f=N(r.preview),V=m(()=>t.value.map(C=>({filterItem:C,width:y(C)}))),w=m(()=>{if(b.value<=0)return V.value.length;let C=0,g=b.value-167-5;for(const _ of V.value)if(g>parseInt(_.width))C++,g-=parseInt(_.width);else break;return C<V.value.length&&g<60&&C>0&&C--,C}),I=m(()=>w.value<V.value.length);return(C,g)=>{const _=ma,F=de,T=ct,L=ya,h=ba;return v(),$("div",{class:"quick_screen"},[A("div",{class:"quick_screen-form",ref_key:"screenContainerRef",ref:u},[R(h,{"label-width":l(e),onSubmit:g[1]||(g[1]=nt(()=>{},["prevent"]))},{default:x(()=>[A("div",{class:"quick_screen-container"},[(v(!0),$(J,null,ae(V.value.slice(0,f.value?V.value.length:w.value),D=>(v(),O(_,{class:"quick_screen-item",style:va({"flex-basis":D.width,width:D.width}),key:D.filterItem.fieldId},{label:x(()=>[R(Te,{content:l(a)(D.filterItem),style:{"max-width":"100%"}},null,8,["content"])]),default:x(()=>{var M;return[(v(),O(ut(k(D.filterItem)),{"model-value":l(n)(D.filterItem),"onUpdate:modelValue":Q=>l(o)(Q,D.filterItem),operate:D.filterItem.type,fieldInfo:l(r).matchField(D.filterItem.fieldId),class:"condition-compare w100",onOnSearch:l(s),mode:l(_a).userUse,selectRange:l(d)(D.filterItem),onlyInstitution:((M=D.filterItem.selectRange)==null?void 0:M.type)===l(Le).institution},null,40,["model-value","onUpdate:modelValue","operate","fieldInfo","onOnSearch","mode","selectRange","onlyInstitution"]))]}),_:2},1032,["style"]))),128)),A("div",{class:"search-btn"},[R(F,{type:"primary",icon:l(it),onClick:l(c)},{default:x(()=>[ue(" 查询 ")]),_:1},8,["icon","onClick"]),R(F,{onClick:l(p)},{default:x(()=>[ue("重置")]),_:1},8,["onClick"]),I.value?(v(),$("div",{key:0,class:te(["search-expansion",{"is-packup":f.value}]),onClick:g[0]||(g[0]=D=>f.value=!f.value)},[R(L,{underline:!1,type:"primary"},{default:x(()=>[R(T,{class:"search-expansion-icon"},{default:x(()=>[R(l(fa))]),_:1}),ue(" "+le(f.value?"收起":"展开"),1)]),_:1})],2)):U("",!0)])])]),_:1},8,["label-width"])],512),l(r).getEventBtns().length?U("",!0):(v(),$("div",{key:0,class:"quick_screen-operation ml-5"},[R(vt)]))])}}});const dl=ne(cl,[["__scopeId","data-v-214aaff1"]]),pl=q({__name:"StatisticsDropdown",props:{filterItem:{}},setup(i){const t=i,a=N(),e=N(!1),n=r=>{e.value=r},{options:o,selectValue:s,getLabel:c}=fe(t.filterItem);me(m(()=>({selectValue:s,item:t.filterItem,options:o.value,onUpdateValue(r){s.value=r}})));const p=r=>{var y;s.value!==r&&(s.value=r,(y=a.value)==null||y.handleClose())};return(r,y)=>{const d=ct,k=La,u=Ma,b=Aa;return v(),O(b,{ref_key:"DropdownRef",ref:a,class:"statistics-dropdown",trigger:"click",onVisibleChange:n,"hide-on-click":!1,onCommand:p,"popper-class":"statistics-popper"},{dropdown:x(()=>[R(u,null,{default:x(()=>[(v(!0),$(J,null,ae(l(o),(f,V)=>(v(),O(k,{key:V,command:f.value},{default:x(()=>[A("span",{class:te({"is-active":l(s)===f.value})},le(f.label),3)]),_:2},1032,["command"]))),128))]),_:1})]),default:x(()=>[A("span",{class:te(["statistics-label",{"is-expanded":e.value}])},[A("span",{class:"mr-5"},le(l(c)(l(s))),1),R(d,null,{default:x(()=>[R(l(Je))]),_:1}),A("span",{class:"statistics-line"})],2)]),_:1},512)}}});const vl=ne(pl,[["__scopeId","data-v-6191dba6"]]),_l=q({__name:"StatisticsSingle",props:{filterItem:{}},setup(i){const t=i,{options:a,selectValue:e}=fe(t.filterItem);return me(m(()=>({selectValue:e,item:t.filterItem,options:a.value,onUpdateValue(n){e.value=n}}))),(n,o)=>{const s=dt,c=pt;return v(),O(c,Ee({modelValue:l(e),"onUpdate:modelValue":o[0]||(o[0]=p=>xe(e)?e.value=p:null),class:"statistics_screen"},n.$attrs),{default:x(()=>[(v(!0),$(J,null,ae(l(a),(p,r)=>(v(),O(s,{key:r,label:p.label,name:p.value},null,8,["label","name"]))),128))]),_:1},16,["modelValue"])}}}),fl=q({__name:"StatisticsScreen",setup(i){const t=H(),a=m(()=>t.view.statisticsFilter),e=m(()=>{const n=a.value;return n.length===1?n[0]:null});return(n,o)=>{const s=dt,c=pt;return e.value?(v(),O(_l,{key:0,filterItem:e.value},null,8,["filterItem"])):(v(),O(c,Ee({key:1,class:"statistics_screen is-many"},n.$attrs),{default:x(()=>[(v(!0),$(J,null,ae(a.value,(p,r)=>(v(),O(s,{key:r,label:p.fieldId,name:p.fieldId},{label:x(()=>[R(vl,{filterItem:p},null,8,["filterItem"])]),_:2},1032,["label","name"]))),128))]),_:1},16))}}});const ml=ne(fl,[["__scopeId","data-v-4502e066"]]);var _t=(i=>(i.listClickData="field",i))(_t||{});function yl(i){const t=H(),a=ze();return{handleRowClick:async n=>{var o,s,c,p,r,y,d,k,u,b;if(!t.publish){if(((o=t.view.basis.clickDataOptions.appointOptions)==null?void 0:o.type)===ha.link){const f=Ia(t.view.basis.clickDataOptions.appointOptions.link??"",{[_t.listClickData]:n});(s=i.linkCallback)==null||s.call(i,f,n);return}else if(((c=t.view.basis.clickDataOptions.appointOptions)==null?void 0:c.formType)===Qe.fix){const f={appId:t.appId,entryId:((p=t.view.basis.clickDataOptions.appointOptions)==null?void 0:p.targetEntryId)??"",mode:Oe.enter};if((r=t.view.basis.clickDataOptions.appointOptions.transferValueField)!=null&&r.length){const V=await ga(t.view.basis.clickDataOptions.appointOptions.transferValueField,{formData:n,isNotNull:!0,dataSystem:a});f.formData=V,f.useDefault=!0}(y=i.formCallback)==null||y.call(i,f);return}else if(((d=t.view.basis.clickDataOptions.appointOptions)==null?void 0:d.formType)===Qe.trends){const f=t.view.basis.clickDataOptions.appointOptions.trendsFormFieldId,V=t.matchField(f);let w=f?ce({fieldId:f,rowData:n}):"";(k=V==null?void 0:V.helper)!=null&&k.getFormat&&(w=V.helper.getFormat(w,V.field)),Array.isArray(w)&&(w=w[0]??"");const I={appId:t.appId,entryId:w,mode:Oe.enter};(u=t.view.basis.clickDataOptions.appointOptions.trendsFormPamras)!=null&&u.length&&(I.externalInject={[t.sourceId]:t.view.basis.clickDataOptions.appointOptions.trendsFormPamras.reduce((C,g)=>({...C,[g]:ce({fieldId:g,rowData:n})??null}),{})}),(b=i.formCallback)==null||b.call(i,I);return}}i.detailsCallback(n)}}}const bl=q({__name:"TableRegion",setup(i){const t=H(),a=N(!1),e=N(),{handleRowClick:n}=yl({detailsCallback(d){t.detailsItem=d,t.isDetails=!0},linkCallback(d){ka(d)},formCallback(d){if(!d.entryId)return ot.error("未找到对应的页面");a.value=!0,e.value=_e(d)}}),o=d=>{d||(a.value=!1)},s=he(()=>Ie(()=>import("./TreeTable-23b3c16b.js"),["./TreeTable-23b3c16b.js","./index-b80d5ef5.js","..\\css\\index-13cb634b.css","./utils-052731c0.js","./formDesigner-462b10d7.js"],import.meta.url)),c=he(()=>Ie(()=>import("./GanttTable-1dc3ba13.js"),["./GanttTable-1dc3ba13.js","./index-b80d5ef5.js","..\\css\\index-13cb634b.css","./Resize-eb80395d.js","..\\css\\Resize-9e524632.css","..\\css\\GanttTable-1ed6569f.css"],import.meta.url)),p=he(()=>Ie(()=>import("./CommonTable-c7825a49.js"),["./CommonTable-c7825a49.js","./index-b80d5ef5.js","..\\css\\index-13cb634b.css","..\\css\\CommonTable-26b49e2e.css"],import.meta.url)),r=he(()=>Ie(()=>import("./SlaveTable-f286c7d0.js"),["./SlaveTable-f286c7d0.js","./index-b80d5ef5.js","..\\css\\index-13cb634b.css","./Resize-eb80395d.js","..\\css\\Resize-9e524632.css","..\\css\\SlaveTable-42ca5f81.css"],import.meta.url)),y=he(()=>Ie(()=>import("./AddOrViewTable-cba3646d.js"),["./AddOrViewTable-cba3646d.js","./index-b80d5ef5.js","..\\css\\index-13cb634b.css","./Resize-eb80395d.js","..\\css\\Resize-9e524632.css","./useQueryTab-05fa7456.js","./useExtractQuery-f96f705c.js","./FormShare-9773b44c.js","./dataShare-2d7ae3f7.js","..\\css\\FormShare-2b578c67.css","./LoadingData-195d0581.js","./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js","..\\css\\LoadingData-c62058eb.css","./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js","..\\css\\TableOperation-e7627c56.css","./Base.vue_vue_type_script_setup_true_lang-03820366.js","./useFieldMaxWidth-d82f063e.js","./AddressBase.vue_vue_type_script_setup_true_lang-d809ffc6.js","./AzCascader.vue_vue_type_style_index_0_lang-adc6a4ab.js","..\\css\\AzCascader-6c13ae3b.css","./AzDatePicker.vue_vue_type_style_index_0_lang-c5632a92.js","..\\css\\AzDatePicker-bc99fde3.css","./index-318b68f4.js","./AzInputNumber-d6212644.js","./el-input-number-c15b1cc7.js","..\\css\\el-input-number-3100e046.css","..\\css\\AzInputNumber-7eb04079.css","./AzTimePicker.vue_vue_type_style_index_0_lang-3726374e.js","..\\css\\AzTimePicker-c7c3a174.css","./useMultipleVal-904406c1.js","./CascaderBase.vue_vue_type_style_index_0_lang-83862970.js","..\\css\\CascaderBase-b08fbeae.css","./el-dropdown-item-455a6589.js","..\\css\\el-dropdown-item-ee6896fd.css","./CardShowFieldItem-fd24f218.js","..\\css\\CardShowFieldItem-2ebcfade.css","..\\css\\Base-0cce8938.css","..\\css\\AddOrViewTable-a076c912.css"],import.meta.url));return(d,k)=>(v(),$("div",null,[l(t).view.basis.style===l(ie).tree?(v(),O(l(s),{key:0,onRowClick:l(n)},null,8,["onRowClick"])):l(t).view.basis.style===l(ie).gantt?(v(),O(l(c),{key:1,onRowClick:l(n)},null,8,["onRowClick"])):l(t).view.basis.style===l(ie).slave?(v(),O(l(r),{key:2})):l(t).view.basis.style===l(ie).addOrView?(v(),O(l(y),{key:3})):(v(),O(l(p),{key:4,onRowClick:l(n)},null,8,["onRowClick"])),e.value?(v(),O(st,{key:5,modelValue:a.value,"onUpdate:modelValue":k[0]||(k[0]=u=>a.value=u),prop:{renderOptions:e.value},onSuccess:o},null,8,["modelValue","prop"])):U("",!0)]))}});function hl(i){const t=m(()=>{const a=l(i.filter);let e;try{e=JSON.parse(a??""),wa(e)||(e=void 0)}catch{e=void 0}return Object.entries(e??{}).reduce((o,s)=>{const[c,p]=s,r=i.tableRender.matchField(c);return r?[...o,{cn:Fe.and,leftTableName:r.field.entryId,leftFieldName:ve(r.field.fieldId).fieldId,leftFieldType:r.field.type,type:oe.equal,value:p&&tt(p)}]:o},[])});i.tableRender.otherFilter=t.value.length?[{cn:Fe.or,conditionSets:t.value}]:void 0,ee(()=>i.tableRender.otherFilter,(a,e)=>{Ue(a,e)||i.tableRender.runSearch({isReset:!0,mode:ge.other})})}function Rl(i){const{activeTab:t}=Me(m(()=>i.value.map(n=>n.id??"")),{queryKey:"listViewId",removeKeys:["dataId"],cacheKeys:["filter"]}),{activeTab:a}=Me([],{queryKey:"filter",isNoCorrect:!0,unNoCorrect:!0}),e=N(new Map);return ee(a,n=>{n?e.value.set(t.value,n):e.value.delete(t.value)},{immediate:!0}),{activeTab:t,filterMap:e}}const Il=q({__name:"TableRenderWrapper",props:{view:{},options:{},active:{type:Boolean},filter:{}},setup(i){const t=i,a=N(null),e=Va(we({fullEl:a,...Ve(t)}));Da(Fa,e),hl({tableRender:e,filter:m(()=>t.filter)});const n=m({get(){return e.isDetails},set(){e.closeDetailsMode()}});e.on(Ca,({operate:r,mode:y})=>{r==="close"&&y===Oa.delete&&e.closeDetailsMode()});const{tableFields:o}=qe(e.id);ee(()=>[...e.view.display],()=>{const r=e.view.display.map(y=>{var k,u;const d=y.alias||((k=e.matchField(y.fieldId))==null?void 0:k.field.options.label)||"";return{prop:y.fieldId,label:d,show:((u=o.value.find(b=>b.prop===y.fieldId))==null?void 0:u.show)??!0}});o.value=r},{immediate:!0});const s=m(()=>e.view.basis.style===ie.addOrView),{activeTab:c}=Me([],{queryKey:"dataId",isNoCorrect:!0,unNoCorrect:!0,noQuery:e.preview}),p=m(()=>Sa(c.value));return ee(()=>pe(e.detailsItem??{}),r=>{r!==pe(p.value)&&t.active&&!s.value&&!e.preview&&(c.value=r&&e.soureceInfo?e.soureceInfo.forms.map(y=>[y.entryId,ce({fieldId:Ta,rowData:e.detailsItem??{},entryId:y.entryId})].join(".")).join(",")??"":"")}),ee(()=>pe(p.value),r=>{lt(()=>{t.active&&r!==pe(e.detailsItem??{})&&!s.value&&!e.preview&&(e.isDetails=!!r,e.detailsItem=r?_e(p.value):null)})},{immediate:!0}),(r,y)=>(v(),$("div",{class:te(["table_render_wrapper",{"table_render-addview":l(e).view.basis.style===l(ie).addOrView}]),ref_key:"tableRenderRef",ref:a},[l(e).view.basis.treeFilter?(v(),O(xa,{key:0,class:"render-left",options:{id:`list-${l(e).view.id}`,init:250,max:400,min:150}},{default:x(()=>[A("div",{class:"render-left-content"},[R(al)])]),_:1},8,["options"])):U("",!0),A("div",{class:te(["render-table",{"is-statistics-screen":l(e).view.statisticsFilter.length}])},[l(e).view.statisticsFilter.length?(v(),O(ml,{key:0,class:"table-statistics-screen"})):U("",!0),l(e).filterReady?(v(),$("div",{key:1,class:"table-container"},[l(e).view.quickFilter.length?(v(),O(dl,{key:0,class:"quick_screen"})):U("",!0),R(rl),R(bl,{class:"table-wrapper"}),l(e).isSameScreen?U("",!0):(v(),O(za,{key:1,modelValue:n.value,"onUpdate:modelValue":y[0]||(y[0]=d=>n.value=d)},null,8,["modelValue"]))])):(v(),$("div",{key:2,class:"table-container-ready"},le("暂无数据")))],2)],2))}});const gl=ne(Il,[["__scopeId","data-v-a8e96619"]]),kl=q({__name:"TableRender",props:{view:{},options:{},active:{type:Boolean},filter:{}},setup(i){const t=i,a=ze(),e=N(),n=N(),o=m(()=>n.value?Ra(t.view,n.value,{publish:t.options.publish}):t.view),s=async()=>{const c=await a.getSoureceData(t.view.basis.sourceId);if(c===null||t.view.basis.style===ie.tree&&!Ea(c))return Promise.reject({msg:"数据来源已被删除，可由应用管理员重新配置!",loadState:et.danger});n.value=c};return ee(()=>t.view.basis.sourceId,()=>{var c;(c=e.value)==null||c.load()}),(c,p)=>(v(),O(Re,{ref_key:"loadingDataRef",ref:e,load:s,class:"table_render",isFailImg:"",center:!1},{default:x(()=>[R(gl,{options:c.options,view:o.value,active:c.active,filter:c.filter},null,8,["options","view","active","filter"])]),_:1},512))}});const El=ne(kl,[["__scopeId","data-v-15508f3a"]]);export{El as T,za as _,_t as t,Rl as u};

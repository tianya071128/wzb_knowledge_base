import{bI as rt,bJ as dt,lx as R,pP as Se,bK as Me,d as h,r as T,o as m,b as v,w as c,i as u,B as e,K as xe,Q as Ae,ac as ne,eP as Ve,k,t as U,m as S,eu as ge,a4 as fe,bs as de,g7 as _e,av as ye,bC as G,_ as j,v as A,gc as ue,l as E,pa as ut,R as $e,C as L,U as X,bn as ie,H as Y,gh as it,bm as ve,f as D,j as Ie,pQ as pt,c as P,ly as V,cj as ct,eO as Pe,F as z,g as oe,g8 as q,a5 as mt,gd as ce,ge as Q,eR as H,I as Re,eQ as Ue,ax as gt,cR as ft,cS as _t,fx as yt,a9 as vt,bH as ee,y as be,lE as It,P as Oe,L as kt,J as xt,p as Vt,bz as Te,g9 as bt,ga as Tt,c3 as Ct,N as Et,O as Ft,gv as Dt,bt as Ne,pR as Le,a1 as Be,ao as qe,D as ht,q as ze,n as je,A as me,bi as We,fs as He,bc as wt,b3 as St,pS as ae,x as Mt,E as Qe,ab as Ce,ci as At,bu as $t,e as Fe,S as De,bv as Pt,lz as re,c5 as Rt,eN as Ut,gV as Ot,gj as Nt,as as Lt,bh as Bt,aN as he}from"./index-b80d5ef5.js";/* empty css                        */import{u as se}from"./useExtractQuery-f96f705c.js";import{C as qt,c as zt,t as jt}from"./index-a513aa2a.js";import{C as Je}from"./ConditionWrapper-43da1676.js";import{a as pe}from"./LoadingData-195d0581.js";import{_ as Wt,S as Ht}from"./ParamsSetWrapper.vue_vue_type_script_setup_true_lang-c3f6631f.js";import{M as Qt}from"./MessageRemindConfig-98484405.js";import{d as Jt}from"./default-component-4c80201b.js";import{C as Gt,a as Kt}from"./ComponentParamsSetWrapper-71afc840.js";import{a as Yt,A as J,T as Xt,_ as Zt,b as ea,R as ta}from"./EditItemTargetForm.vue_vue_type_script_setup_true_lang-199df786.js";import{S as Ge}from"./SetFieldDefault-5fc1ae2a.js";import{F as aa}from"./FieldCondition-1c72aa9d.js";import{_ as la}from"./SelectCascaderEntry.vue_vue_type_script_setup_true_lang-673c5dca.js";import{_ as Ke,a as Ye}from"./FormLabel.vue_vue_type_script_setup_true_lang-ceed9d28.js";import{g as na,x as oa}from"./dataFactory-e27a5721.js";import{u as sa}from"./utils-a7200637.js";const we=Symbol("计划任务创建数据控制中心");function ra(){return Me({createModel:{...Xe},validPlanForm:()=>Promise.resolve(!1),validTaskForm:()=>Promise.resolve(!1)})}function te(){const I=rt(we,void 0);if(I)return I;{const g=ra();return dt(we,g),g}}const Xe={appId:"",type:R.form,cron:"",entryId:"",executeTask:[],planName:"",status:Se.enable,conditionDTO:null},da=h({__name:"PlanForm",setup(I){const g=te(),_={planName:[{required:!0,message:"请输入计划名称",trigger:"change"}],cron:[{required:!0,message:"请输入计划执行时间",trigger:"change"}]},y=T(),t=async()=>{var d,i;try{return await((i=(d=y.value)==null?void 0:d.ruleFormRef)==null?void 0:i.validate())}catch{throw"plan"}};return g.validPlanForm=t,(d,i)=>{const a=Ae,r=ne;return m(),v(xe,{model:e(g).createModel,rules:_,ref_key:"formRef",ref:y},{default:c(()=>[u(r,{label:"计划名称",prop:"planName"},{default:c(()=>[u(a,{modelValue:e(g).createModel.planName,"onUpdate:modelValue":i[0]||(i[0]=l=>e(g).createModel.planName=l),placeholder:"请输入计划名称"},null,8,["modelValue"])]),_:1}),u(r,{label:"执行时间",prop:"cron"},{default:c(()=>[u(qt,{modelValue:e(g).createModel.cron,"onUpdate:modelValue":i[1]||(i[1]=l=>e(g).createModel.cron=l),style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),ua=h({__name:"Data",props:{data:{}},emits:["update:data","editData","del"],setup(I,{emit:g}){const _=g,y=te(),t=()=>{y.createModel.type===R.form&&(y.createModel.executeTask=[],_("del"))},d=a=>de(a,_e),{getFormHtmlName:i}=Ve();return(a,r)=>{const l=ye,n=G;return m(),v(n,{shadow:"hover"},{default:c(()=>[k("div",{class:"task_card"},[k("div",{class:"task_card-left"},[k("div",{class:"title"},U(d(a.data.excuteAction.executeType)),1),k("div",{class:"desc"},[S(" 表单名称： "),k("span",{class:"form-name"},U(e(i)(a.data.excuteAction.entryId)),1)])]),k("div",{class:"task_card-right"},[u(l,{type:"primary",underline:!1,icon:e(ge),onClick:r[0]||(r[0]=o=>_("editData"))},null,8,["icon"]),u(l,{type:"primary",underline:!1,icon:e(fe),onClick:t},null,8,["icon"])])])]),_:1})}}});const ia=j(ua,[["__scopeId","data-v-00cb2a40"]]),pa=h({__name:"Plugin",props:{data:{}},emits:["update:data","del"],setup(I,{emit:g}){const _=I,y=g,t=te(),d=A(_,"data",y),i=()=>{t.createModel.type===R.form&&(t.createModel.executeTask=[],y("del"))},a=T(),r=async()=>{const l=await ut.getById(_.data.pluginTask.id);return d.value.pluginTask={...d.value.pluginTask,name:l.name,version:l.version,remark:l.remark},d.value.pluginTask.executeParamList.length||setTimeout(()=>{var n;return(n=a.value)==null?void 0:n.handleSet()}),l};return(l,n)=>{const o=ye,f=pe,p=G;return m(),v(p,{shadow:"hover"},{default:c(()=>[u(f,{load:r,ref:"pluginLoadRef"},{default:c(()=>{var s,x,b,M;return[k("div",{class:"task_card"},[k("div",{class:"task_card-left"},[k("div",{class:"title"},[S(U((s=l.data.pluginTask)==null?void 0:s.name)+" ",1),k("span",null,U((x=l.data.pluginTask)==null?void 0:x.version),1)]),k("div",{class:"desc"},U((b=l.data.pluginTask)==null?void 0:b.remark),1)]),k("div",{class:"task_card-right"},[e(t).createModel.type===e(R).form?(m(),v(Wt,{key:0,ref_key:"paramsSetWrapperRef",ref:a,modelValue:e(d).pluginTask.executeParamList,"onUpdate:modelValue":n[0]||(n[0]=$=>e(d).pluginTask.executeParamList=$),"plugin-id":(M=l.data.pluginTask)==null?void 0:M.id,entryId:e(t).createModel.entryId,group:[{id:"form",title:"当前表单",fieldOptions:{entryId:e(t).createModel.entryId}}],scenario:e(ue).PLAN},{default:c(()=>[u(o,{type:"primary",underline:!1,icon:e(ge)},null,8,["icon"])]),_:1},8,["modelValue","plugin-id","entryId","group","scenario"])):E("",!0),u(o,{type:"primary",underline:!1,icon:e(fe),onClick:i},null,8,["icon"])])])]}),_:1},512)]),_:1})}}});const ca=j(pa,[["__scopeId","data-v-96182938"]]),ma=h({__name:"MessageConfig",props:{modelValue:{type:Boolean},form:{},entryId:{}},emits:["update:modelValue","update:form"],setup(I,{emit:g}){const _=I,y=g,t=A(_,"modelValue",y),d=$e(_,"form",y),i=T({msgExpressions:{..._.form}}),a=T(),r=T(),l=async()=>{var n,o,f;await Promise.all([(o=(n=a.value)==null?void 0:n.ruleFormRef)==null?void 0:o.validate(),(f=r.value)==null?void 0:f.validate()]),d.value=i.value.msgExpressions,t.value=!1};return(n,o)=>{const f=X,p=ie;return m(),v(p,{modelValue:e(t),"onUpdate:modelValue":o[2]||(o[2]=s=>L(t)?t.value=s:null),title:"消息设置",width:"800px","append-to-body":""},{footer:c(()=>[u(f,{onClick:o[1]||(o[1]=s=>t.value=!1)},{default:c(()=>[S("取消")]),_:1}),u(f,{type:"primary",onClick:l},{default:c(()=>[S("确定")]),_:1})]),default:c(()=>[u(xe,{model:e(i),labelWidth:"92px",ref_key:"formRef",ref:a},{default:c(()=>[u(Qt,{modelValue:e(i).msgExpressions,"onUpdate:modelValue":o[0]||(o[0]=s=>e(i).msgExpressions=s),ref_key:"messageRemindConfigRef",ref:r,labelWidth:"90px",entryId:n.entryId},null,8,["modelValue","entryId"])]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ga=h({__name:"Message",props:{data:{}},emits:["update:data","editData","del"],setup(I,{emit:g}){const _=I,y=g,t=A(_,"data",y),d=te(),i=()=>{d.createModel.type===R.form&&(d.createModel.executeTask=[],y("del"))},a=T(!1);return(()=>{var l,n;(n=(l=_.data.messageModuleVO)==null?void 0:l.excuteConfig.selectors)!=null&&n.length||(a.value=!0)})(),(l,n)=>{const o=ye,f=G;return m(),v(f,{shadow:"hover",class:"inside-card"},{default:c(()=>[k("div",{class:"card-wrapper"},[k("div",{class:"card-header"},[k("span",{class:"title"},"消息提醒"),k("span",{class:"vision"},"(v1.0.0)")]),k("div",{class:"tip"}," 悦文云提供的内置的消息提醒，可统一设置站内信、短信、邮件等消息 ")]),u(o,{type:"primary",underline:!1,icon:e(ge),onClick:n[0]||(n[0]=p=>a.value=!0)},null,8,["icon"]),u(o,{type:"primary",underline:!1,icon:e(fe),onClick:i},null,8,["icon"]),e(d).createModel.type===e(R).form?(m(),v(ma,{key:0,modelValue:e(a),"onUpdate:modelValue":n[1]||(n[1]=p=>L(a)?a.value=p:null),entryId:e(d).createModel.entryId,form:e(t).messageModuleVO.excuteConfig,"onUpdate:form":n[2]||(n[2]=p=>e(t).messageModuleVO.excuteConfig=p)},null,8,["modelValue","entryId","form"])):E("",!0)]),_:1})}}});const fa=j(ga,[["__scopeId","data-v-ef414350"]]),_a=h({__name:"ComponentConfig",props:{modelValue:{type:Boolean},form:{},entryId:{}},emits:["update:modelValue","update:form"],setup(I,{emit:g}){const _=I,y=g,t=se("appId"),d=A(_,"modelValue",y),i=$e(_,"form",y),a=T({..._.form}),r=T(),l=async()=>{var n;await((n=r.value)==null?void 0:n.validate()),i.value={...a.value},d.value=!1};return(n,o)=>{const f=ve,p=X,s=ie;return m(),v(s,{modelValue:e(d),"onUpdate:modelValue":o[2]||(o[2]=x=>L(d)?d.value=x:null),title:"组件配置",width:"800px","append-to-body":""},{footer:c(()=>[u(p,{onClick:o[1]||(o[1]=x=>d.value=!1)},{default:c(()=>[S("取消")]),_:1}),u(p,{type:"primary",onClick:l},{default:c(()=>[S("确定")]),_:1})]),default:c(()=>[u(f,{model:e(a),ref_key:"formRef",ref:r},{default:c(()=>{var x;return[(x=e(a))!=null&&x.inputParams?(m(),v(Y,{key:0,label:"请求参数设置",labelWidth:"150px",prop:"inputParams"},{default:c(()=>{var b;return[u(Gt,{modelValue:e(a).inputParams,"onUpdate:modelValue":o[0]||(o[0]=M=>e(a).inputParams=M),style:{width:"300px"},componentId:(b=e(a))==null?void 0:b.componentId,appId:e(t),currentEntryInfo:{entryId:n.entryId},group:[{id:"field",title:"表单控件",fieldOptions:{entryId:n.entryId}},e(it)({title:"系统数据"})]},null,8,["modelValue","componentId","appId","currentEntryInfo","group"])]}),_:1})):E("",!0)]}),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ya=h({__name:"Components",props:{data:{},entryId:{}},emits:["update:data"],setup(I,{emit:g}){const _=te(),d=A(I,"data",g),i=T(),a=async()=>{var o,f;const n=await pt(((o=d.value.componentExpressions)==null?void 0:o.componentId)??"");i.value=n,!((f=d.value.componentExpressions)!=null&&f.inputParams.length)&&(r.value=!0)},r=T(!1),l=()=>{_.createModel.type===R.form&&(_.createModel.executeTask=[])};return(n,o)=>{const f=ye,p=G,s=pe;return m(),v(s,{load:a,ref:"componentConfigRef"},{default:c(()=>[u(p,{shadow:"hover",class:"inside-card"},{default:c(()=>{var x,b,M,$,w,K;return[k("div",{class:"img-wrapper"},[k("img",{src:((x=e(i))==null?void 0:x.icon)||e(Jt)},null,8,["src"])]),k("div",{class:"card-wrapper"},[k("div",{class:"card-header"},[k("span",{class:"title"},U((b=e(i))==null?void 0:b.name),1),(M=e(i))!=null&&M.version?(m(),D("span",{key:0,class:"vision"}," ("+U(($=e(i))==null?void 0:$.version)+") ",1)):E("",!0)]),(w=e(i))!=null&&w.refer?(m(),D("div",{key:0,class:"tip"},[u(Ie,{content:(K=e(i))==null?void 0:K.refer,style:{width:"100%"}},null,8,["content"])])):E("",!0)]),u(f,{type:"primary",underline:!1,icon:e(ge),onClick:o[0]||(o[0]=W=>r.value=!0)},null,8,["icon"]),u(f,{type:"primary",underline:!1,icon:e(fe),onClick:l},null,8,["icon"]),e(_).createModel.type===e(R).form?(m(),v(_a,{key:0,entryId:n.entryId,modelValue:e(r),"onUpdate:modelValue":o[1]||(o[1]=W=>L(r)?r.value=W:null),form:e(d).componentExpressions,"onUpdate:form":o[2]||(o[2]=W=>e(d).componentExpressions=W)},null,8,["entryId","modelValue","form"])):E("",!0)]}),_:1})]),_:1},512)}}});const va=j(ya,[["__scopeId","data-v-16af9a37"]]),Ia=h({__name:"TaskDisplay",props:{data:{},entryId:{}},emits:["editData","del"],setup(I,{emit:g}){const _=I,y=g,t=P(()=>{switch(_.data.taskType){case V.data:return ia;case V.plugin:return ca;case V.message:return fa;case V.components:return va}});return(d,i)=>(m(),v(ct(e(t)),{entryId:d.entryId,data:d.data,onEditData:i[0]||(i[0]=a=>y("editData")),onDel:i[1]||(i[1]=a=>y("del"))},null,40,["entryId","data"]))}});const ka=j(Ia,[["__scopeId","data-v-6d4cd2d4"]]),xa=h({__name:"ExecuteActionEnd",props:{executeList:{},single:{type:Boolean}},emits:["onAdd","onEdit","onDel"],setup(I,{emit:g}){const _=g,y=a=>de(a,_e),{getFormHtmlName:t}=Ve(),{getPluginHtmlName:d,getPluginInfoPlus:i}=Pe();return(a,r)=>{const l=X;return m(),D("div",{class:"ex"},[(m(!0),D(z,null,oe(a.executeList,(n,o)=>{var f,p;return m(),v(Yt,{key:o,name:(f=n.pluginExpressions)!=null&&f.id?e(d)({id:(p=n.pluginExpressions)==null?void 0:p.id,scenario:e(ue).SMART}):y(n.executeType),class:"ex-item",type:"executeAction","is-delete":"",onOnDel:s=>_("onDel",o),onOnEdit:s=>_("onEdit",n,o)},{formName:c(()=>{var s,x,b,M;return[n.executeType===e(q).plugin?(m(),D("span",{key:0},U((s=n.pluginExpressions)!=null&&s.id?((M=(b=e(i)({id:(x=n.pluginExpressions)==null?void 0:x.id,scenario:e(ue).SMART}))==null?void 0:b.apiVO)==null?void 0:M.remark)??"":""),1)):n.executeType===e(q).message?(m(),D("span",{key:1}," 悦文云提供的内置的消息提醒，可统一设置站内信、短信、邮件等消息 ")):(m(),D(z,{key:2},[S(" 目标表单： "),k("span",{style:{color:"var(--el-color-primary)"}},U(e(t)(n.entryId)),1)],64))]}),_:2},1032,["name","onOnDel","onOnEdit"])}),128)),a.single?E("",!0):(m(),v(l,{key:0,onClick:r[0]||(r[0]=n=>_("onAdd")),class:"ex-item ex-btn",icon:e(mt)},{default:c(()=>[S(" 添加执行动作 ")]),_:1},8,["icon"]))])}}});const Va=j(xa,[["__scopeId","data-v-abc3dcea"]]),ba=h({inheritAttrs:!1,__name:"ExecuteCondition",props:{modelValue:{},conditionText:{},targetEntryId:{},entryId:{}},emits:["update:modelValue"],setup(I,{expose:g,emit:_}){const d=A(I,"modelValue",_),i=P({get(){var r;return(r=d.value)==null?void 0:r.map(l=>ce({targetFieldId:"fieldId",targetFieldType:"fieldType",valuedType:"defaultType",value:"customDefault",triggerFieldId:"currentFieldId",triggerFieldType:"currentFieldType"},l,(n,o)=>n==="valuedType"?{[Q.target_field]:H.currentField,[Q.customize]:H.custom,[Q.isNull]:H.empty}[o]??o:n==="child"?o==null?void 0:o.map(f=>ce({targetFieldId:"fieldId",targetFieldType:"fieldType",valuedType:"defaultType",value:"customDefault",triggerFieldId:"currentFieldId",triggerFieldType:"currentFieldType"},f,(p,s)=>p==="valuedType"?{[Q.target_field]:H.currentField,[Q.customize]:H.custom,[Q.isNull]:H.empty}[s]??s:s)):o))},set(r){d.value=r.map(l=>ce({fieldId:"targetFieldId",fieldType:"targetFieldType",defaultType:"valuedType",customDefault:"value",currentFieldId:"triggerFieldId",currentFieldType:"triggerFieldType"},l,(n,o)=>n==="defaultType"?{[H.currentField]:Q.target_field,[H.custom]:Q.customize,[H.empty]:Q.isNull}[o]??o:n==="child"?o==null?void 0:o.map(f=>ce({fieldId:"targetFieldId",fieldType:"targetFieldType",defaultType:"valuedType",customDefault:"value",currentFieldId:"triggerFieldId",currentFieldType:"triggerFieldType"},f,(p,s)=>p==="defaultType"?{[H.currentField]:Q.target_field,[H.custom]:Q.customize,[H.empty]:Q.isNull}[s]??s:s)):o))}}),a=T();return g({validate(){var r;return(r=a.value)==null?void 0:r.validate()}}),(r,l)=>{const n=ne;return m(),D(z,null,[k("div",{class:"hide-label"},[u(n,Re(r.$attrs,{style:{display:"block"}}),null,16)]),u(Ge,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=o=>i.value=o),ref_key:"SetFieldDefaultRef",ref:a,"left-entry-id":r.targetEntryId,rightFieldColumnName:r.conditionText,"right-entry-id":r.entryId,customTypeList:e(Ue),isSubform:"",formulaProp:{mode:e(gt).server,group:[{id:r.targetEntryId,fieldOptions:{entryId:r.targetEntryId}},{id:r.entryId,fieldOptions:{entryId:r.entryId}}]}},null,8,["modelValue","left-entry-id","rightFieldColumnName","right-entry-id","customTypeList","formulaProp"]),u(n,ft(_t(e(yt)(r.$attrs,["label"]))),null,16)],64)}}});const ke=j(ba,[["__scopeId","data-v-5337cbe5"]]),Ta=h({__name:"ExecuteConditionFilter",props:{modelValue:{},targetFieldId:{},triggerFieldId:{}},emits:["update:modelValue"],setup(I,{expose:g,emit:_}){const d=A(I,"modelValue",_),i=T();return g({validate(){var a;return(a=i.value)==null?void 0:a.validate()}}),(a,r)=>{const l=ne;return m(),v(l,Re({style:{display:"block"}},a.$attrs),{default:c(()=>[u(aa,{style:{width:"100%"},ref_key:"FieldConditionRef",ref:i,condition:e(d),"onUpdate:condition":r[0]||(r[0]=n=>L(d)?d.value=n:null),conditionForm:a.targetFieldId,compareForm:a.triggerFieldId,isDataType:"",controlTypeFieldName:"触发表单字段"},null,8,["condition","conditionForm","compareForm"])]),_:1},16)}}}),Ca=h({__name:"ExecuteAction",props:{modelValue:{},single:{type:Boolean,default:!1},appId:{},entryId:{}},emits:["update:modelValue","onAdd"],setup(I,{expose:g,emit:_}){const y=I,t=_,d=T(J.end),i=A(y,"modelValue",t,{deep:!0,clone:!0,passive:!0,shouldEmit(C){return!vt(C,y.modelValue)}}),{getPluginHtmlName:a}=Pe(),r={conditions:[],entryId:"",executeType:"",addExpressions:[],editExpressions:[],formId:"",smartId:"",taskType:""},l=T(ee(r)),n=T(),o=T(),f=T(),p=Me({entryId:[{required:!0,message:"请选择目标表单",trigger:"change"}],conditions:[{type:"array",required:!0,message:"请选择添加过滤条件",trigger:"change",validator:(C,F,O)=>{var Z;const N=(Z=n.value)==null?void 0:Z.validate();N?N.then(()=>{O()}).catch(()=>{O(new Error)}):O()}}],addExpressions:[{type:"array",required:!0,trigger:"change",validator:(C,F,O)=>{var N;if(F.length>=1){const Z=(N=o.value)==null?void 0:N.validate();Z?Z.then(()=>{O()}).catch(()=>{O(new Error("请完善添加规则"))}):O()}else O(new Error("请选择添加规则"))}}],editExpressions:[{type:"array",required:!0,message:"请选择添加规则",trigger:"change",validator:(C,F,O)=>{var N;if(F.length>=1){const Z=(N=f.value)==null?void 0:N.validate();Z?Z.then(()=>{O()}).catch(()=>{O(new Error)}):O()}else O(new Error)}}]}),s=T(),x=P(()=>{var C,F;return(C=l.value.pluginExpressions)!=null&&C.id?a({id:(F=l.value.pluginExpressions)==null?void 0:F.id,scenario:ue.SMART}):de(l.value.executeType,_e)}),b=T(-1),M=P(()=>{const C=l.value.executeType;return C===q.edit||C===q.addOrEdit?"修改为":"设置为"}),$=P(()=>(l.value.executeType,l.value.executeType===q.addOrEdit)),w=P(()=>l.value.executeType===q.del),K=P(()=>{switch(l.value.executeType){case q.add:return"在目标表单中新增数据，创建规则如下";case q.edit:case q.addOrEdit:return"符合过滤条件的数据，修改规则如下";default:return""}}),W=P(()=>{const C=[q.del,q.edit,q.addOrEdit],F=l.value.executeType;return F&&C.includes(F)}),B=P(()=>{switch(l.value.executeType){case q.del:return"删除目标表单中的哪些数据";case q.edit:case q.addOrEdit:return"修改目标表单中的哪些数据";default:return""}}),le=P({get(){return l.value.entryId},set(C){l.value=ee({...r,executeType:l.value.executeType,entryId:C})}}),Ze=C=>{l.value.executeType=C,d.value=J.edit},et=()=>{},Ee=()=>{b.value=-1,d.value=J.start,t("onAdd")},tt=()=>{l.value=ee(r),d.value=J.start},at=T(),lt=async()=>{var F,O;await((F=s.value)==null?void 0:F.validate()),await((O=at.value)==null?void 0:O.validate());const C=ee(l.value);b.value===-1?i.value.executeActions.push(C):i.value.executeActions.splice(b.value,1,C),l.value=ee(r),d.value=J.end},nt=C=>{C>=0&&i.value.executeActions.splice(C,1),d.value=J.end,l.value=ee(r)},ot=(C,F)=>{b.value=F,l.value=ee(C),d.value=J.edit},st=()=>{l.value=ee(r),d.value=J.start};return be(()=>i.value,C=>{var F;y.single&&((F=C.executeActions)==null?void 0:F.length)===0&&Ee()},{deep:!0,immediate:!0}),g({initState:et}),(C,F)=>{const O=ve;return m(),v(O,{style:{padding:"10px 0"},ref_key:"ruleFormRef",ref:s,class:"executeFormClass","label-suffix":"：",model:l.value,rules:p},{default:c(()=>[d.value===e(J).edit?(m(),v(Xt,{key:0,title:"设置执行动作",onOnSave:lt,onOnClose:st},{default:c(()=>[u(Zt,{label:"执行动作",labelWidth:"100px",name:x.value,onOnReplace:tt},null,8,["name"]),u(ea,{label:"目标表单",appId:y.appId,prop:"entryId",modelValue:le.value,"onUpdate:modelValue":F[0]||(F[0]=N=>le.value=N),labelWidth:"100px"},null,8,["appId","modelValue"]),l.value.entryId?(m(),D(z,{key:0},[W.value?(m(),v(Ta,{key:0,"target-field-id":l.value.entryId,"trigger-field-id":y.entryId,label:B.value,prop:"conditions",ref_key:"ExecuteCFRef",ref:n,modelValue:l.value.conditions,"onUpdate:modelValue":F[1]||(F[1]=N=>l.value.conditions=N)},null,8,["target-field-id","trigger-field-id","label","modelValue"])):E("",!0),$.value?(m(),D(z,{key:1},[u(ke,{entryId:C.entryId,label:K.value,ref_key:"addExpressionsRef",ref:o,prop:"addExpressions","condition-text":M.value,modelValue:l.value.editExpressions,"onUpdate:modelValue":F[2]||(F[2]=N=>l.value.editExpressions=N),targetEntryId:l.value.entryId},null,8,["entryId","label","condition-text","modelValue","targetEntryId"]),u(ke,{entryId:C.entryId,label:"若找不到符合过滤条件的数据，则根据以下配置在目标表单中新增数据",prop:"editExpressions",ref_key:"editExpressionsRef",ref:f,"condition-text":"设置为",modelValue:l.value.addExpressions,"onUpdate:modelValue":F[3]||(F[3]=N=>l.value.addExpressions=N),targetEntryId:l.value.entryId},null,8,["entryId","modelValue","targetEntryId"])],64)):E("",!0),!$.value&&!w.value?(m(),v(ke,{key:2,entryId:C.entryId,label:K.value,ref_key:"addExpressionsRef",ref:o,prop:"addExpressions","condition-text":M.value,modelValue:l.value.addExpressions,"onUpdate:modelValue":F[4]||(F[4]=N=>l.value.addExpressions=N),targetEntryId:l.value.entryId},null,8,["entryId","label","condition-text","modelValue","targetEntryId"])):E("",!0)],64)):E("",!0)]),_:1})):d.value===e(J).start?(m(),v(ta,{key:1,isAll:"",hideTitle:"","model-value":l.value.executeType,"onUpdate:modelValue":Ze},null,8,["model-value"])):(m(),v(Va,{key:2,single:C.single,onOnAdd:Ee,onOnDel:nt,onOnEdit:ot,"execute-list":e(i).executeActions},null,8,["single","execute-list"]))]),_:1},8,["model","rules"])}}});const Ea=j(Ca,[["__scopeId","data-v-8fe93d18"]]),Fa=h({__name:"MessageCard",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(I,{emit:g}){const t=A(I,"modelValue",g);return(d,i)=>{const a=Oe,r=G;return m(),v(r,{shadow:"never",class:"card",onClick:i[0]||(i[0]=l=>t.value=!e(t))},{default:c(()=>[k("div",{class:"card-header"},[k("span",{class:"title"},"消息提醒"),k("span",{class:"vision"},"(v1.0.0)")]),k("div",{class:"tip"}," 悦文云提供的内置的消息提醒，可统一设置站内信、短信、邮件等消息 "),e(t)?(m(),v(a,{key:0,class:"check"},{default:c(()=>[u(e(It))]),_:1})):E("",!0)]),_:1})}}});const Da=j(Fa,[["__scopeId","data-v-d67b06be"]]),ha=h({__name:"ComponentCard",props:{modelValue:{}},emits:["update:modelValue"],setup(I,{emit:g}){const _=I,y=g,t=T([]),d=async()=>{t.value=await bt(Tt.plan_job)},i=A(_,"modelValue",y),a=T(""),r=P(()=>a.value?t.value.filter(l=>["refer","name"].some(o=>l[o].includes(a.value))):t.value);return(l,n)=>{const o=Ae,f=Oe,p=Ct,s=G;return m(),v(s,null,{default:c(()=>[u(kt,{load:d,class:"component_pane-loading"},{default:c(()=>{var x;return[u(o,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=b=>a.value=b),class:"az_input-radius mb-10","prefix-icon":e(xt),clearable:"",placeholder:"输入组件名称、描述进行搜索"},null,8,["modelValue","prefix-icon"]),k("div",{class:"component_pane-content"},[k("div",{class:"az-flex-width"},[(m(!0),D(z,null,oe(e(r),b=>(m(),D("div",{class:Vt(["component-item",{selected:e(i)===b.id}]),key:b.id,onClick:()=>i.value=b.id},[u(Kt,{"component-info":b},null,8,["component-info"]),e(i)===b.id?(m(),v(f,{key:0,class:"choose-icon"},{default:c(()=>[u(Te,{"icon-class":"Select"})]),_:1})):E("",!0)],10,["onClick"]))),128)),(x=e(r))!=null&&x.length?E("",!0):(m(),v(p,{key:0,class:"w100",description:a.value?"搜索无组件":"暂无组件","image-size":60},null,8,["description"]))])])]}),_:1})]),_:1})}}});const wa=j(ha,[["__scopeId","data-v-328f32f7"]]),Sa=h({__name:"SelectDialog",props:{modelValue:{type:Boolean},defaultValue:{}},emits:["update:modelValue","change"],setup(I,{emit:g}){const _=I,y=g,t=A(_,"modelValue",y),d=te(),i=se("appId"),a=T(V.plugin),r=()=>{const p={type:a.value,value:n.value[a.value]};y("change",p),t.value=!1},l={entryId:"",id:"",name:"",status:1,formId:"",triggerType:"",triggerCondition:[],executeActions:[]},n=T({[V.plugin]:"",[V.data]:{...l},[V.message]:!1,[V.components]:""}),o=P(()=>{var p,s;switch(a.value){case V.plugin:case V.message:case V.components:return!n.value[a.value];case V.data:return!((s=(p=n.value[V.data])==null?void 0:p.executeActions)!=null&&s.length);default:return!0}});return(()=>{_.defaultValue&&(a.value=_.defaultValue.type,_.defaultValue.type===V.data&&(n.value[V.data].executeActions=[_.defaultValue.value]))})(),(p,s)=>{const x=Et,b=Ft,M=X,$=ie;return m(),v($,{modelValue:e(t),"onUpdate:modelValue":s[6]||(s[6]=w=>L(t)?t.value=w:null),title:"选择任务","append-to-body":"",width:"800px"},{footer:c(()=>[k("span",{class:"dialog-footer"},[u(M,{onClick:s[5]||(s[5]=w=>t.value=!1)},{default:c(()=>[S("取消")]),_:1}),u(M,{type:"primary",onClick:r,disabled:e(o)},{default:c(()=>[S(" 确定 ")]),_:1},8,["disabled"])])]),default:c(()=>[u(b,{type:"border-card",modelValue:e(a),"onUpdate:modelValue":s[4]||(s[4]=w=>L(a)?a.value=w:null)},{default:c(()=>[u(x,{label:"插件类",name:e(V).plugin},{default:c(()=>[u(Ht,{modelValue:e(n)[e(V).plugin],"onUpdate:modelValue":s[0]||(s[0]=w=>e(n)[e(V).plugin]=w),scenario:e(ue).PLAN},null,8,["modelValue","scenario"])]),_:1},8,["name"]),e(d).createModel.type===e(R).form?(m(),v(x,{key:0,label:"数据类",name:e(V).data},{default:c(()=>[u(Ea,{"app-id":e(i)??e(d).createModel.appId??"","entry-id":e(d).createModel.entryId,modelValue:e(n)[e(V).data],"onUpdate:modelValue":s[1]||(s[1]=w=>e(n)[e(V).data]=w),single:""},null,8,["app-id","entry-id","modelValue"])]),_:1},8,["name"])):E("",!0),u(x,{label:"消息类",name:e(V).message},{default:c(()=>[u(Da,{modelValue:e(n)[e(V).message],"onUpdate:modelValue":s[2]||(s[2]=w=>e(n)[e(V).message]=w)},null,8,["modelValue"])]),_:1},8,["name"]),u(x,{label:"组件类",name:e(V).components},{default:c(()=>[u(wa,{modelValue:e(n)[e(V).components],"onUpdate:modelValue":s[3]||(s[3]=w=>e(n)[e(V).components]=w)},null,8,["modelValue"])]),_:1},8,["name"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Ma=h({__name:"TaskSelector",props:{modelValue:{},entryId:{}},emits:["update:modelValue"],setup(I,{emit:g}){const t=A(I,"modelValue",g),d=T(!1),i=()=>{d.value=!0},a=o=>{const{type:f,value:p}=o;f===V.plugin?t.value=[{taskType:V.plugin,pluginTask:{id:p,executeParamList:[],tenantApiId:""}}]:f===V.data?t.value=[{taskType:V.data,excuteAction:p.executeActions[0]}]:f===V.message?t.value=[{taskType:V.message,messageModuleVO:{excuteConfig:{selectors:[],msgBase:[{title:"",rawContent:"",channel:Dt.mail}],hasSubDept:"0"}}}]:f===V.components&&(t.value=[{taskType:V.components,componentExpressions:{componentId:p,inputParams:[],outputAsyncParams:[],outputParams:[]}}])},r=T(),l=o=>{(o==null?void 0:o.taskType)===V.data&&(r.value={type:V.data,value:o.excuteAction},d.value=!0)},n=()=>{r.value=void 0};return(o,f)=>{const p=X;return m(),D("div",{class:"task_selector"},[e(t).length?E("",!0):(m(),v(p,{key:0,onClick:i},{default:c(()=>[S("选择任务")]),_:1})),(m(!0),D(z,null,oe(e(t),(s,x)=>(m(),v(ka,{key:x,data:s,entryId:o.entryId,onEditData:()=>l(s),onDel:n},null,8,["data","entryId","onEditData"]))),128)),e(d)?(m(),v(Sa,{key:1,modelValue:e(d),"onUpdate:modelValue":f[0]||(f[0]=s=>L(d)?d.value=s:null),defaultValue:e(r),onChange:a},null,8,["modelValue","defaultValue"])):E("",!0)])}}}),Aa=h({__name:"ExecuteForm",props:{form:{}},emits:["update:form"],setup(I,{emit:g}){const t=A(I,"form",g),d=se("appId"),i=async()=>(await Le(d.value??"")).filter(o=>o.type===Be.form),a=(n,o,f)=>{var p;(p=t.value.executeTask)!=null&&p.length||f("您还没有选择执行任务"),f()},r=()=>{t.value.executeTask=[],t.value.conditionDTO=null},l=P({get(){return t.value.entryId?{entryId:t.value.entryId,appId:t.value.appId}:null},set(n){t.value.appId=(n==null?void 0:n.appId)??"",t.value.entryId=(n==null?void 0:n.entryId)??""}});return(n,o)=>{const f=qe;return m(),D(z,null,[u(Y,{label:"执行数据",prop:"entryId",rules:[{required:!0,message:"请选择执行数据",trigger:"change"}]},{default:c(()=>[e(d)?(m(),v(Ne,{key:0,load:i,modelValue:e(t).entryId,"onUpdate:modelValue":o[0]||(o[0]=p=>e(t).entryId=p),filterable:"",onChange:r},{default:c(({options:p})=>[(m(!0),D(z,null,oe(p,s=>(m(),v(f,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(m(),v(la,{key:1,modelValue:e(l),"onUpdate:modelValue":o[1]||(o[1]=p=>L(l)?l.value=p:null),style:{width:"250px"}},null,8,["modelValue"]))]),_:1}),e(t).entryId?(m(),v(Y,{key:0,label:"执行条件",prop:"conditionDTO",rules:[{required:!0,message:"请选择执行条件",trigger:"change"}]},{default:c(()=>[k("div",{style:{width:"250px"}},[u(Je,{condition:e(t).conditionDTO,"onUpdate:condition":o[2]||(o[2]=p=>e(t).conditionDTO=p),btnText:"设置执行条件",msg:"执行条件异常",conditionForm:e(t).entryId,validate:""},null,8,["condition","conditionForm"])])]),_:1})):E("",!0),e(t).entryId?(m(),v(Y,{key:1,label:"执行任务",prop:"executeTask",rules:[{required:!0,message:"请选择执行任务",trigger:"change"},{validator:a,trigger:"change"}]},{default:c(()=>[k("div",{style:{width:"520px"}},[u(Ma,{modelValue:e(t).executeTask,"onUpdate:modelValue":o[3]||(o[3]=p=>e(t).executeTask=p),entryId:e(t).entryId},null,8,["modelValue","entryId"])])]),_:1},8,["rules"])):E("",!0)],64)}}}),$a=h({__name:"AggregateDialog",props:{modelValue:{type:Boolean},aggregateId:{}},emits:["update:modelValue","update:aggregateId","change"],setup(I,{emit:g}){const _=I,y=g,t=A(_,"modelValue",y),d=A(_,"aggregateId",y),i=se("appId"),a=T(""),r=T(""),l=()=>{d.value=a.value,t.value=!1,y("change",{aggregateId:a.value,appId:r.value})},n=P(()=>{const o=[{type:"input",label:"名称",prop:"name"},{type:"select",label:"所属应用",prop:"appId",options:async()=>(await He({appId:"",name:"",orgIds:[]})).map(s=>({label:s.name,value:s.id}))}];let f={isEnable:0};return i.value&&(o.pop(),f={appId:i.value,isEnable:0}),{id:"lowCode_aggregationChoose",query:{list:o},operation:{hideTableOperation:!0},request:{api:ht,extraParams:f},table:{tableCols:[{label:"选择",width:"55px",slots:{default({row:p}){return u(ze,{"model-value":p.id===a.value},null)}}},{label:"名称",prop:"name"},{label:"说明",prop:"desc"},{label:"所属应用",prop:"appName"},{label:"数据来源表",prop:"source",slots:{default({row:p}){var M,$;const s=p.aggregateJson;if(s.isSql==="1")return u("div",null,["自定义SQL"]);const x=je([{type:me.form,id:(M=s==null?void 0:s.dataSources)==null?void 0:M.singleEntryId},...(($=s.dataSources)==null?void 0:$.multiples)??[]]).filter(w=>!!(w!=null&&w.id)),b=x.map((w,K)=>{const W=[];return w.type===me.form?W.push(u(Ke,{entryId:w.id},null)):W.push(u(Ye,{id:w.id},null)),K!==x.length-1&&W.push("、"),W});return u("div",null,[b])}}}],tableProps:{maxHeight:"400px","onRow-click":p=>{a.value===p.id?(a.value="",r.value=""):(a.value=p.id,r.value=p.appId)}}}}});return be(()=>t.value,o=>{o&&(a.value=d.value??"")}),(o,f)=>{const p=We("az-page"),s=X,x=ie;return m(),v(x,{width:"800px",modelValue:e(t),"onUpdate:modelValue":f[1]||(f[1]=b=>L(t)?t.value=b:null),title:"选择聚合表","append-to-body":""},{footer:c(()=>[k("span",{class:"dialog-footer"},[u(s,{onClick:f[0]||(f[0]=b=>t.value=!1)},{default:c(()=>[S("取消")]),_:1}),u(s,{type:"primary",onClick:l},{default:c(()=>[S("确定")]),_:1})])]),default:c(()=>[u(p,{config:e(n)},null,8,["config"])]),_:1},8,["modelValue"])}}}),Pa=h({__name:"AggregateItem",props:{aggregateId:{}},emits:["delete"],setup(I,{emit:g}){const _=I,y=g,t=T(null),d=async()=>{t.value=await St(_.aggregateId)},i=P(()=>{var a,r,l,n,o;return je([{type:me.form,id:(l=(r=(a=t.value)==null?void 0:a.aggregateJson)==null?void 0:r.dataSources)==null?void 0:l.singleEntryId},...((o=(n=t.value)==null?void 0:n.aggregateJson.dataSources)==null?void 0:o.multiples)??[]]).filter(f=>!!(f!=null&&f.id))});return(a,r)=>{const l=pe,n=G;return m(),v(n,{shadow:"hover",key:a.aggregateId},{default:c(()=>[u(l,{load:d,class:"aggregate_item"},{default:c(()=>{var o,f,p;return[k("div",{class:"aggregate_item-body"},[u(Ie,{content:(o=e(t))==null?void 0:o.name},null,8,["content"]),k("div",{class:"source"},[k("span",{class:"font-666"},"数据来源："),((f=e(t))==null?void 0:f.aggregateJson.isSql)==="1"?(m(),D(z,{key:0},[S(" 自定义SQL ")],64)):(m(!0),D(z,{key:1},oe(e(i),(s,x)=>(m(),D(z,{key:s.id},[s.type===e(me).form?(m(),v(Ke,{key:0,entryId:s.id},null,8,["entryId"])):(m(),v(Ye,{key:1,id:s.id},null,8,["id"])),x!==e(i).length-1?(m(),D("span",{key:2},"，")):E("",!0)],64))),128))]),k("div",{class:"desc"},U((p=e(t))==null?void 0:p.desc),1)]),k("div",{class:"aggregate_item-operation"},[u(Te,{"icon-class":"Delete",class:"delete-icon",onClick:r[0]||(r[0]=wt(s=>y("delete",a.aggregateId),["stop"]))})])]}),_:1})]),_:1})}}});const Ra=j(Pa,[["__scopeId","data-v-cb70d828"]]),Ua=h({__name:"AggregateChoose",props:{modelValue:{}},emits:["update:modelValue","change"],setup(I,{emit:g}){const _=I,y=g,t=T(!1),d=A(_,"modelValue",y);return(i,a)=>{const r=X,l=ne,n=ve;return m(),D("div",null,[e(d)?(m(),v(Ra,{key:1,"aggregate-id":e(d),onDelete:a[1]||(a[1]=o=>{d.value="",y("change",{aggregateId:"",appId:""})}),onClick:a[2]||(a[2]=o=>t.value=!0)},null,8,["aggregate-id"])):(m(),v(r,{key:0,onClick:a[0]||(a[0]=o=>t.value=!0)},{default:c(()=>[S(" 选择聚合表 ")]),_:1})),u(n,null,{default:c(()=>[u(l,null,{default:c(()=>[u($a,{modelValue:e(t),"onUpdate:modelValue":a[3]||(a[3]=o=>L(t)?t.value=o:null),aggregateId:e(d),"onUpdate:aggregateId":a[4]||(a[4]=o=>L(d)?d.value=o:null),onChange:a[5]||(a[5]=o=>y("change",o))},null,8,["modelValue","aggregateId"])]),_:1})]),_:1})])}}}),Oa=h({__name:"ExecuteAggregate",props:{form:{}},emits:["update:form"],setup(I,{emit:g}){const t=A(I,"form",g),d=()=>{t.value.type===R.aggregate&&(t.value.aggregateTask?t.value.aggregateTask.fieldMapper=[]:t.value.aggregateTask={entryId:"",fieldMapper:[],dataProcessMethod:ae.append})},i=p=>{d(),t.value.aggregateTask.entryId="",t.value.appId=p.appId},a=async()=>(await Le(t.value.appId??"")).filter(s=>s.type===Be.form),r=P({get(){var p;return((p=t.value.aggregateTask)==null?void 0:p.entryId)??""},set(p){t.value.aggregateTask||(t.value.aggregateTask={entryId:"",fieldMapper:[],dataProcessMethod:ae.append}),t.value.aggregateTask.entryId=p}}),l=P(()=>Ue.filter(p=>p.value===H.currentField)),n=T([]),o=Mt(),f=async()=>{var p;n.value=((p=await o.getAggregateInfo(t.value.aggregateId))==null?void 0:p.fields)??[]};return(p,s)=>{var W;const x=ne,b=qe,M=Qe,$=G,w=Ce,K=pe;return m(),D(z,null,[u(Y,{label:"选择聚合表",prop:"aggregateId",rules:[{required:!0,message:"请选择聚合表",trigger:"change"}]},{default:c(()=>[u(x,null,{default:c(()=>[u(Ua,{modelValue:e(t).aggregateId,"onUpdate:modelValue":s[0]||(s[0]=B=>e(t).aggregateId=B),onChange:i},null,8,["modelValue"])]),_:1})]),_:1}),e(t).appId?(m(),v(Y,{key:0,label:"聚合结果输出列",rules:[{required:!0,message:"请选择聚合结果输出列",trigger:"change"}]},{default:c(()=>[u(Ne,{load:a,modelValue:e(r),"onUpdate:modelValue":s[1]||(s[1]=B=>L(r)?r.value=B:null),filterable:"",style:{width:"200px"},onChange:d},{default:c(({options:B})=>[(m(!0),D(z,null,oe(B,le=>(m(),v(b,{key:le.id,label:le.name,value:le.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),(W=e(t).aggregateTask)!=null&&W.entryId&&e(t).aggregateId?(m(),v(x,{key:1,label:"表单传递值"},{default:c(()=>[k("div",{class:"w100"},[u(Ge,{modelValue:e(t).aggregateTask.fieldMapper,"onUpdate:modelValue":s[2]||(s[2]=B=>e(t).aggregateTask.fieldMapper=B),leftEntryId:e(t).aggregateTask.entryId,rightAggregateId:e(t).aggregateId,leftFieldColumnName:"目标表单字段名称",customTypeList:e(l)},null,8,["modelValue","leftEntryId","rightAggregateId","customTypeList"])])]),_:1})):E("",!0),e(r)?(m(),v(x,{key:2,label:"数据处理方式"},{default:c(()=>[u(w,{modelValue:e(t).aggregateTask.dataProcessMethod,"onUpdate:modelValue":s[5]||(s[5]=B=>e(t).aggregateTask.dataProcessMethod=B),style:{width:"100%"},class:"radio-wrapper"},{default:c(()=>[u($,{style:{width:"560px","margin-bottom":"12px"},shadow:"hover",onClick:s[3]||(s[3]=B=>e(t).aggregateTask.dataProcessMethod=e(ae).append)},{default:c(()=>[u(M,{label:e(ae).append},{default:c(()=>[S("追加")]),_:1},8,["label"]),k("div",{class:"desc"}," 保留原数据，添加新数据记录，适用于按周期统计数据，如统计每月的销售额 ")]),_:1}),u($,{style:{width:"560px"},shadow:"hover",onClick:s[4]||(s[4]=B=>e(t).aggregateTask.dataProcessMethod=e(ae).update)},{default:c(()=>[u(M,{label:e(ae).update},{default:c(()=>[S("更新")]),_:1},8,["label"]),k("div",{class:"desc"}," 按条件更新特定的数据，未匹配的数据则新增，适用于统计全量数据，如统计每个销售的总销售额 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(r)&&e(t).aggregateId&&e(t).aggregateTask.dataProcessMethod===e(ae).update?(m(),v(Y,{key:3,label:"更新条件",prop:"conditionDTO",rules:[{required:!0,message:"请选择更新条件",trigger:"change"}]},{default:c(()=>[u(K,{style:{width:"250px"},load:f},{default:c(()=>[u(Je,{condition:e(t).conditionDTO,"onUpdate:condition":s[6]||(s[6]=B=>e(t).conditionDTO=B),btnText:"设置更新条件",msg:"更新条件异常",conditionForm:e(r),validate:"",compareFields:e(n),controlTypeFieldName:"当前聚合表字段"},null,8,["condition","conditionForm","compareFields"])]),_:1})]),_:1})):E("",!0)],64)}}});const Na=j(Oa,[["__scopeId","data-v-ed7e8ea6"]]),La=h({__name:"DataStreamDialog",props:{modelValue:{type:Boolean},dataStreamId:{}},emits:["update:modelValue","update:dataStreamId","change"],setup(I,{emit:g}){const _=I,y=g,t=A(_,"modelValue",y),d=A(_,"dataStreamId",y),i=se("appId"),a=T(""),r=T(""),l=()=>{d.value=a.value,t.value=!1,y("change",{dataStreamId:a.value,appId:r.value})},n=T([]),o=P(()=>{const f=[{type:"input",label:"名称",prop:"name"},{type:"select",label:"所属应用",prop:"appId",options:async()=>(n.value=await He({appId:"",name:"",orgIds:[]}),n.value.map(s=>({label:s.name,value:s.id})))}];let p={isEnable:0};return i.value&&(f.pop(),p={appId:i.value,isEnable:0}),{id:"lowCode_dataStreamChoose",query:{list:f},operation:{hideTableOperation:!0},request:{api:na,extraParams:p},table:{tableCols:[{label:"选择",width:"55px",slots:{default({row:s}){return u(ze,{"model-value":s.id===a.value},null)}}},{label:"数据流名称",prop:"name"},{label:"输出表名",prop:"outputTableName"},{label:"所属应用",prop:"appId",slots:{default({row:s}){const x=n.value.find(b=>b.id===s.appId);return u("span",null,[x?x.name:"-"])}}},{label:"说明",prop:"description"}],tableProps:{height:"400px","onRow-click":s=>{a.value===s.id?(a.value="",r.value=""):(a.value=s.id,r.value=s.appId)}}}}});return be(()=>t.value,f=>{f&&(a.value=d.value??"")}),(f,p)=>{const s=We("az-page"),x=X,b=ie;return m(),v(b,{width:"800px",modelValue:e(t),"onUpdate:modelValue":p[1]||(p[1]=M=>L(t)?t.value=M:null),title:"选择数据流","append-to-body":""},{footer:c(()=>[k("span",{class:"dialog-footer"},[u(x,{onClick:p[0]||(p[0]=M=>t.value=!1)},{default:c(()=>[S("取消")]),_:1}),u(x,{type:"primary",onClick:l},{default:c(()=>[S("确定")]),_:1})])]),default:c(()=>[u(s,{config:e(o)},null,8,["config"])]),_:1},8,["modelValue"])}}}),Ba=h({__name:"DataStreamItem",props:{dataStreamId:{}},emits:["delete"],setup(I,{emit:g}){const _=I,y=g,t=T(null),d=async()=>{t.value=await oa(_.dataStreamId)};return(i,a)=>{const r=pe,l=G;return m(),v(l,{shadow:"hover"},{default:c(()=>[u(r,{load:d,class:"dataStream_item"},{default:c(()=>{var n,o,f,p;return[k("div",{class:"dataStream_item-body"},[u(Ie,{content:(n=e(t))==null?void 0:n.name},null,8,["content"]),k("div",null,"输出表名："+U(((f=(o=e(t))==null?void 0:o.outputCellsInfo)==null?void 0:f.cellsName)??"-"),1),k("div",{class:"desc"},U((p=e(t))==null?void 0:p.description),1)]),k("div",{class:"dataStream_item-operation"},[u(Te,{"icon-class":"Delete",class:"delete-icon",onClick:a[0]||(a[0]=s=>y("delete",i.dataStreamId))})])]}),_:1})]),_:1})}}});const qa=j(Ba,[["__scopeId","data-v-34b57981"]]),za=h({__name:"DataStreamChoose",props:{modelValue:{}},emits:["update:modelValue","change"],setup(I,{emit:g}){const _=I,y=g,t=T(!1),d=A(_,"modelValue",y);return(i,a)=>{const r=X,l=ne,n=ve;return m(),D("div",null,[e(d)?(m(),v(qa,{key:1,dataStreamId:e(d),onDelete:a[1]||(a[1]=o=>d.value="")},null,8,["dataStreamId"])):(m(),v(r,{key:0,onClick:a[0]||(a[0]=o=>t.value=!0)},{default:c(()=>[S(" 选择数据流 ")]),_:1})),u(n,null,{default:c(()=>[u(l,null,{default:c(()=>[u(La,{modelValue:e(t),"onUpdate:modelValue":a[2]||(a[2]=o=>L(t)?t.value=o:null),dataStreamId:e(d),"onUpdate:dataStreamId":a[3]||(a[3]=o=>L(d)?d.value=o:null),onChange:a[4]||(a[4]=o=>y("change",o))},null,8,["modelValue","dataStreamId"])]),_:1})]),_:1})])}}}),ja=h({__name:"ExecuteDataFactory",props:{form:{}},emits:["update:form"],setup(I,{emit:g}){const t=A(I,"form",g),d=i=>{t.value.appId=i.appId};return(i,a)=>(m(),v(Y,{label:"选择数据流",prop:"dataStreamId",rules:[{required:!0,message:"请选择数据流",trigger:"change"}]},{default:c(()=>[u(za,{modelValue:e(t).dataStreamId,"onUpdate:modelValue":a[0]||(a[0]=r=>e(t).dataStreamId=r),onChange:d},null,8,["modelValue"])]),_:1}))}}),Wa=h({__name:"TaskForm",setup(I){const g=te(),_=T(),y=i=>{const{planName:a,cron:r}=g.createModel;g.createModel={...Xe,planName:a,cron:r,type:i}},t=async()=>{var i,a;try{return await((a=(i=_.value)==null?void 0:i.ruleFormRef)==null?void 0:a.validate())}catch{throw"task"}};g.validTaskForm=t;const{showDataFactroyState:d}=At();return(i,a)=>{const r=Qe,l=Ce;return m(),v(xe,{model:e(g).createModel,ref_key:"formRef",ref:_,"label-width":"140px"},{default:c(()=>[u(Y,{label:"执行类型",prop:"type",rules:[{required:!0,message:"请选择执行类型",trigger:"change"}]},{default:c(()=>[u(l,{modelValue:e(g).createModel.type,"onUpdate:modelValue":a[0]||(a[0]=n=>e(g).createModel.type=n),onChange:y},{default:c(()=>[u(r,{label:e(R).form},{default:c(()=>[S("表单")]),_:1},8,["label"]),e(d)?(m(),v(r,{key:0,label:e(R).dataFactory},{default:c(()=>[S(" 数据工厂 ")]),_:1},8,["label"])):E("",!0),u(r,{label:e(R).aggregate},{default:c(()=>[S("聚合表")]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),e(g).createModel.type===e(R).form?(m(),v(Aa,{key:0,form:e(g).createModel,"onUpdate:form":a[1]||(a[1]=n=>e(g).createModel=n)},null,8,["form"])):e(g).createModel.type===e(R).dataFactory&&e(d)?(m(),v(ja,{key:1,form:e(g).createModel,"onUpdate:form":a[2]||(a[2]=n=>e(g).createModel=n)},null,8,["form"])):e(g).createModel.type===e(R).aggregate?(m(),v(Na,{key:2,form:e(g).createModel,"onUpdate:form":a[3]||(a[3]=n=>e(g).createModel=n)},null,8,["form"])):E("",!0)]),_:1},8,["model"])}}}),Ha=h({__name:"AddPlan",props:{modelValue:{type:Boolean},id:{}},emits:["update:modelValue","onRefresh"],setup(I,{emit:g}){const _=I,y=g,t=te(),d=A(_,"modelValue",y),i=se("appId"),a=async()=>{try{await t.validPlanForm(),await t.validTaskForm(),await re.save(t.createModel),y("onRefresh")}catch(n){throw n==="plan"?r.value="plan":n==="task"&&(r.value="task"),n}},r=T("plan"),l=async()=>{_.id?t.createModel=await re.getById(_.id):t.createModel.appId=i.value??""};return(n,o)=>{const f=Rt,p=Ce;return m(),v(Pt,{modelValue:e(d),"onUpdate:modelValue":o[2]||(o[2]=s=>L(d)?d.value=s:null),title:"title",size:"800px","show-load":l},{header:c(()=>[k("div",{class:"plan-header"},[k("h3",null,U(n.id?"编辑计划":"新增计划"),1),u(p,{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=s=>r.value=s),class:"tabs"},{default:c(()=>[u(f,{label:"plan"},{default:c(()=>[S("制定计划")]),_:1}),u(f,{label:"task"},{default:c(()=>[S("执行内容")]),_:1})]),_:1},8,["modelValue"])])]),footer:c(()=>[u($t,{editMode:!0,onClose:o[1]||(o[1]=s=>d.value=!1),"on-submit":a})]),default:c(()=>[k("div",{class:"form-wrap"},[e(d)?(m(),D(z,{key:0},[Fe(u(da,null,null,512),[[De,r.value==="plan"]]),Fe(u(Wa,null,null,512),[[De,r.value==="task"]])],64)):E("",!0)])]),_:1},8,["modelValue"])}}});const cl=j(Ha,[["__scopeId","data-v-e5adf928"]]),Qa=h({__name:"Desc",props:{item:{}},setup(I){var r;const g=I,_=l=>de(l,_e),{getFormHtmlName:y}=Ve(),{dynamicOptions:t}=sa({entryId:g.item.type===R.form?(r=g.item)==null?void 0:r.entryId:""}),{getComponentHtmlName:d}=Ut(),i=Ot(t.value),a=P(()=>function(l){var n,o,f,p,s;if(l.taskType==V.plugin)return`执行 ${(n=l.pluginTask)==null?void 0:n.name}`;if(l.taskType==V.data)return`${_(((o=l==null?void 0:l.excuteAction)==null?void 0:o.executeType)??"").slice(0,-2)} 【${y(((f=l==null?void 0:l.excuteAction)==null?void 0:f.entryId)??"")}】 的数据`;if(l.taskType==V.message){if(!((p=l.messageModuleVO)!=null&&p.excuteConfig))return"-";let x="发送";const b=l.messageModuleVO.excuteConfig.msgBase.map($=>`【${de($.channel,Nt)}】`);x+=b.join("、");const M=l.messageModuleVO.excuteConfig.selectors.map($=>i({type:$.type,id:$.id},{dynamicOptions:t.value}).__label__);return x+"给 "+M.join("、")}else return l.taskType==V.components?`执行 ${d(((s=l.componentExpressions)==null?void 0:s.componentId)??"")}`:""});return(l,n)=>(m(),D("div",null,[l.item.type===e(R).form?(m(),D("span",{key:0},[S(" 【"+U(l.item.formName??"-")+"】，满足指定条件时 ",1),k("br")])):E("",!0),S(" 计划执行时间："+U(e(zt).toString(e(jt)(l.item.cron),{locale:"zh_CN"}))+"执行任务 ",1),k("br"),S(" 执行内容： "),l.item.type===e(R).form?(m(),D("span",{key:1},U(e(a)(l.item.executeTask[0])),1)):E("",!0),l.item.type===e(R).aggregate?(m(),D("span",{key:2}," 【"+U(l.item.aggregateName??"-")+"】输出到 【"+U(l.item.formName??"-")+"】 ",1)):E("",!0)]))}}),Ja=h({__name:"TaskCard",props:{task:{},index:{}},emits:["refresh","log","edit"],setup(I,{emit:g}){const _=I,y=g,t=P(()=>[{id:"excute",text:"手动执行一次",type:"primary",onClick:async()=>{var a;await re.executeTask((a=_.task)==null?void 0:a.id),he.success("执行成功")}},{id:"edit",text:"编辑",type:"primary",onClick(){var a;y("edit",(a=_.task)==null?void 0:a.id)}},{id:"viewLog",text:"查看日志",type:"primary",onClick(){y("log",_.task)}},{id:"delete",text:"删除",type:"danger",popconfirmProps:{title:"您确定要删除该计划吗?",confirm:async()=>{var a;await re.delete({id:(a=_.task)==null?void 0:a.id}),y("refresh"),he.success("删除成功")}}}]),d=T(_.task.status);return(i,a)=>{const r=G;return m(),v(r,{class:"mb-10",shadow:"hover"},{header:c(()=>{var l;return[k("div",{class:"plan_and_task-header"},[u(Ie,null,{default:c(()=>{var n;return[k("b",null,U((n=i.task)==null?void 0:n.planName),1)]}),_:1}),k("div",{class:"operation_wrapper"},[(m(),v(Lt,{key:(l=i.task)==null?void 0:l.id,list:e(t),num:4},null,8,["list"])),u(Bt,{style:{"margin-left":"24px"},modelValue:e(d),"onUpdate:modelValue":a[0]||(a[0]=n=>L(d)?d.value=n:null),updateFetch:async()=>{await e(re).updateStatus({id:i.task.id,isUse:i.task.status==e(Se).disable})}},null,8,["modelValue","updateFetch"])])])]}),default:c(()=>[u(Qa,{item:i.task},null,8,["item"])]),_:1})}}});const ml=j(Ja,[["__scopeId","data-v-7e6f76a9"]]);export{cl as A,ml as T};

/* empty css              *//* empty css              *//* empty css              *//* empty css              */import{F as T,C as E}from"./index-4a9e77d2.js";import"./index-34056eca.js";import"./index-30749bf5.js";import{P as O}from"./index-d380ed0a.js";import{d as M,r as d,v as $,c as R,dj as j,dk as q,o as A,b as G,w as u,i as a,B as b,is as H,C as z,f8 as I,wc as J}from"./index-b80d5ef5.js";import{S as K}from"./SelectPane-17fa382a.js";import{F as L}from"./index-ba3c5d48.js";import{D as Q}from"./FlowFormRender-c8e3be49.js";import"./use-route-c2b2b5be.js";import"./use-id-d3187131.js";import"./AzPopup-b04fec03.js";import"./useIncreaseCustomFieldValue-c1159fdb.js";import"./index-0e679d15.js";import"./index-ae93b8ef.js";import"./enum-7a2ae6a9.js";import"./useFlowForm-df7c1aa0.js";const ge=M({__name:"Sign",props:{visible:{type:Boolean},flowNode:{},validateForm:{type:Function}},emits:["update:visible","submit"],setup(U,{emit:_}){var v,g;const t=U,c=_,m=d(),y=d(),l=d({signRule:((v=t.flowNode)==null?void 0:v.signRule)==="3"?"1":(g=t.flowNode)==null?void 0:g.signRule,signUsers:[],comment:""}),p=$(t,"visible",c),C=async()=>{var e,n;await((e=m.value)==null?void 0:e.validate()),l.value.signRule!=="1"&&await((n=t==null?void 0:t.validateForm)==null?void 0:n.call(t)),I(l.value.signUsers)||(l.value.signUsers=[l.value.signUsers]);const o={signRule:l.value.signRule,comment:l.value.comment,signUsers:l.value.signUsers.map(r=>r.id)};c("submit",{signRule:o.signRule,comment:o.comment,signUsers:o.signUsers})},k=()=>{var o;l.value.comment="",l.value.signUsers=[],(o=m.value)==null||o.resetValidation()},N=o=>new Promise(e=>{var n;o==="confirm"?(n=m.value)==null||n.validate().then(()=>{e(!0)}).catch(()=>{e(!1)}):e(!0)}),F=()=>{},f={1:[{text:"在我审批前加签",value:"1"}],2:[{text:"在我审批后加签(确定加签，执行我审批通过并加签)",value:"2"}],3:[{text:"在我审批前加签",value:"1"},{text:"在我审批后加签(确定加签，执行我审批通过并加签)",value:"2"}],4:[{text:"添加审批人",value:"4"}]},V=({selectedOptions:o})=>{i.value=!1,l.value.signRule=o[0].value},i=d(!1),x=R(()=>{var e,n;const o=f[((e=t.flowNode)==null?void 0:e.signRule)??"1"];return o?(n=o.find(r=>r.value==l.value.signRule))==null?void 0:n.text:""}),P=R(()=>{var o,e;return(o=t.flowNode)!=null&&o.hasDeptCascade.signHasDeptCascade?[...t.flowNode.signUsers,{type:j.dynamic,id:q.selectedOrgToChild}]:((e=t.flowNode)==null?void 0:e.signUsers)??[]});return(o,e)=>{const n=T,r=O,h=J,S=E,B=L,D=Q;return A(),G(D,{show:b(p),"onUpdate:show":e[5]||(e[5]=s=>z(p)?p.value=s:null),title:"加签","show-cancel-button":"","confirm-button-text":"确定","before-close":N,teleport:"body",onConfirm:C,onOpen:k},{default:u(()=>[a(B,{ref_key:"ruleFormRef",ref:m},{default:u(()=>[a(S,{inset:""},{default:u(()=>[a(n,{modelValue:x.value,"is-link":"",readonly:"",label:"加签方式",placeholder:"选择加签方式",onClick:e[0]||(e[0]=s=>i.value=!0)},null,8,["modelValue"]),a(h,{show:i.value,"onUpdate:show":e[2]||(e[2]=s=>i.value=s),round:"",position:"bottom",teleport:"body"},{default:u(()=>{var s;return[a(r,{columns:f[((s=o.flowNode)==null?void 0:s.signRule)??"1"],onCancel:e[1]||(e[1]=w=>i.value=!1),onConfirm:V},null,8,["columns"])]}),_:1},8,["show"]),a(n,{"is-link":"",readonly:"",name:"picker",label:"加签人员",placeholder:"增加用户",onClick:F,rules:[{required:!0,message:"请选择加签用户"}]},{input:u(()=>{var s;return[a(K,{ref_key:"selectPaneRef",ref:y,modelValue:l.value.signUsers,"onUpdate:modelValue":e[3]||(e[3]=w=>l.value.signUsers=w),selectRange:P.value,multiple:((s=o.flowNode)==null?void 0:s.countersignType)!==4,tabs:[b(H).memberByOrg]},null,8,["modelValue","selectRange","multiple","tabs"])]}),_:1}),a(n,{modelValue:l.value.comment,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.comment=s),type:"textarea",name:"comment",label:l.value.signRule=="2"?"审批通过及加签原因":"加签原因",placeholder:"请输入加签原因","show-word-limit":"",maxlength:"2000"},null,8,["modelValue","label"])]),_:1})]),_:1},512)]),_:1},8,["show"])}}});export{ge as default};

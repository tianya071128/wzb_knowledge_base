import{d as E,v as F,c as B,r as v,bX as ae,o as i,f as h,k as e,F as H,g as J,p as Q,B as k,t as I,a2 as X,i as o,bz as G,l as C,_ as U,b as P,w as D,j as z,h as W,m as $,av as te,eB as le,bC as ne,J as se,C as Y,Q as oe,dD as ie,bv as re,aN as O,U as Z,dC as ue,y as de,d5 as ce,L as pe,iE as me,c3 as ve}from"./index-b80d5ef5.js";import{p as q,c as _e,e as fe,E as ge,h as he,P as ye,b as be}from"./EditAuthInfo-e7e23191.js";import{E as ee}from"./el-image-ee5f9ae3.js";import"./el-image-viewer-e054799e.js";import{A as De}from"./AzConfirmSwitch-689fcef9.js";const we=E({__name:"Classification",props:{itemList:{},modelValue:{}},emits:["update:modelValue"],setup(w,{emit:y}){const r=w,d=F(r,"modelValue",y),f=B(()=>[{label:"全部分类",value:""}].concat(...r.itemList)),u=l=>{d.value=l.value},_=v(!1),p=v("28px"),g=v(),{width:b}=ae(g),m=B(()=>b.value<=0),t=()=>{p.value=_.value?"28px":"auto",_.value=!_.value};return(l,x)=>(i(),h("div",{class:"category"},[e("div",{class:"category-title"},"分类:"),e("div",{class:"category-content",style:X({height:p.value})},[(i(!0),h(H,null,J(f.value,(A,V)=>(i(),h("span",{key:V,class:Q(k(d)===A.value?"is-active":""),onClick:n=>u(A)},I(A.label),11,["onClick"]))),128))],4),e("div",{ref_key:"arrowControlRef",ref:g,class:"arrow-control"},null,512),m.value?(i(),h("div",{key:0,class:"category-arrow",onClick:t},[o(G,{"icon-class":_.value?"ArrowUpBold":"ArrowDownBold"},null,8,["icon-class"])])):C("",!0)]))}});const Ie=U(we,[["__scopeId","data-v-8e518bc5"]]),Pe=E({__name:"PluginCard",props:{cardInfo:{}},emits:["viewLogs","deletePlugin","handleForbidden","goDetail","refresh"],setup(w,{emit:y}){const r=w,a=y,d=()=>{a("viewLogs",r.cardInfo)},f=()=>{a("goDetail",r.cardInfo.tenantAppId)},u=()=>{a("deletePlugin",r.cardInfo.tenantAppId)},_=()=>{u()};return(p,g)=>{const b=ee,m=te,t=le,l=ne;return i(),P(l,{shadow:"hover",class:"plugin-card"},{default:D(()=>[e("div",{onClick:f,class:"flex1"},[p.cardInfo.pmstatus===k(q).off?(i(),h("div",{key:0,class:"off-shelf"}," 已下架 ")):C("",!0),e("div",{class:"plugin-card__header"},[e("div",{class:"header-left"},[e("p",{class:"plugin-card__header-name"},[o(z,{style:{width:"100%"},content:r.cardInfo.name,line:1},null,8,["content"])]),e("p",{class:"plugin-card__header-orgName"},[o(z,{content:r.cardInfo.serviceName,line:2},null,8,["content"])])]),r.cardInfo.iconUrl?(i(),h("div",{key:0,class:"plugin-card__header-icon"},[o(b,{style:{width:"40px"},src:r.cardInfo.iconUrl},null,8,["src"])])):C("",!0)]),e("div",{class:"plugin-card__msg",style:X({padding:`8px ${p.cardInfo.pmstatus===k(q).off?"56px":"0"} 8px 0`})},[o(z,{content:r.cardInfo.remark,line:2},null,8,["content"])],4)]),e("div",{class:"plugin-card__footer"},[W(p.$slots,"footer",{},()=>[o(De,{tip:"禁用后此插件将不可用。确定要禁用？",updateFetch:async()=>{await k(_e)(p.cardInfo.tenantAppId),a("refresh")},"model-value":p.cardInfo.status},null,8,["updateFetch","model-value"]),o(m,{underline:!1,type:"primary",onClick:d},{default:D(()=>[$(" 查看日志 ")]),_:1}),e("div",{class:"plugin-card__footer-icon"},[o(t,{onConfirm:_,title:"是否删除该插件？",width:"auto"},{reference:D(()=>[e("div",null,[o(G,{"icon-class":"Delete"})])]),_:1})])],!0)])]),_:3})}}});const ke=U(Pe,[["__scopeId","data-v-19d2dc31"]]),Ce=E({__name:"Search",props:{modelValue:{}},emits:["update:modelValue"],setup(w,{emit:y}){const d=F(w,"modelValue",y);return(f,u)=>{const _=oe;return i(),h("div",{class:"myPlugin-header"},[e("div",{class:"myPlugin-header_search"},[o(_,{"suffix-icon":k(se),modelValue:k(d),"onUpdate:modelValue":u[0]||(u[0]=p=>Y(d)?d.value=p:null),placeholder:"输入关键字搜索(可搜索接口分类、名称、详细描述、服务商)"},null,8,["suffix-icon","modelValue"])]),W(f.$slots,"default",{},void 0,!0)])}}});const Ae=U(Ce,[["__scopeId","data-v-986592a6"]]),Ve=E({__name:"pluginDetail",props:{detailData:{},visible:{type:Boolean}},emits:["refresh","update:visible","authMethodfn"],setup(w,{emit:y}){const r=y,a=w,d=F(a,"visible",r),f=v(),u=v(),_=t=>{t.filter(l=>l.installFlag===0),u.value&&(u.value.tenantApiList=t.map(l=>({apiId:l.id,createUserName:l.createUserName,id:l.id,status:l.status,tenantAppId:l.tenantAppId,updateUserName:l.updateUserName})))},p=async()=>{if(!(!u.value||!a.detailData)){if(u.value.tenantApiList&&u.value.tenantApiList.length<=0){O({type:"warning",message:"请选择需要安装插件！"});return}u.value={...u.value,apiKeyAuthParamList:a.detailData.apiKeyAuthParamList,basicAuthParam:a.detailData.basicAuthParam,authMethod:a.detailData.authMethod,applicationId:a.detailData.id,status:a.detailData.status},await fe(u.value),r("authMethodfn",a.detailData.authMethod),d.value=!1,O({type:"success",message:"插件安装成功！"})}},g=v(),b=B(()=>{if(a.detailData)return a.detailData.apiList.filter(t=>t.installFlag===1)}),m=async()=>{a.detailData&&(u.value={apiKeyAuthParamList:a.detailData.apiKeyAuthParamList,basicAuthParam:a.detailData.basicAuthParam,authMethod:a.detailData.authMethod,applicationId:a.detailData.id,id:a.detailData.id,status:a.detailData.status},g.value=b.value,g.value&&g.value.length>0&&g.value.forEach(t=>{setTimeout(()=>{var l;(l=f.value)==null||l.toggleRowSelection(t,!0)},0)}))};return(t,l)=>{const x=ee,A=Z,V=ue;return i(),P(re,{modelValue:k(d),"onUpdate:modelValue":l[0]||(l[0]=n=>Y(d)?d.value=n:null),title:"插件详情",size:"600px","show-load":m,class:"plugin-drawer"},{default:D(()=>{var n,s,M,T,S,c,L,N,R,K,j;return[e("div",{class:"plugin-drawer-box"},[e("div",{class:"plugin-drawer-box__header"},[e("div",{class:"plugin-drawer-box__header-left"},[(n=t.detailData)!=null&&n.iconUrl?(i(),h("div",{key:0,class:"plugin-drawer-box__header-icon"},[o(x,{src:(s=t.detailData)==null?void 0:s.iconUrl,class:"p-logo",fit:"scale-down"},null,8,["src"])])):C("",!0),e("div",{class:"left-content"},[e("p",{class:"plugin-drawer-box__header-name"},I((M=t.detailData)==null?void 0:M.name),1),(T=t.detailData)!=null&&T.serviceName?(i(),P(z,{key:0,class:"plugin-drawer-box__header-orgName",content:(S=t.detailData)==null?void 0:S.serviceName},null,8,["content"])):C("",!0)])]),e("div",{class:"plugin-drawer-box__header-right"},[e("span",null,"安装次数:"+I((c=t.detailData)==null?void 0:c.count),1),o(A,{type:"primary",onClick:p},{default:D(()=>[$("安装")]),_:1})])]),e("div",{class:"plugin-drawer-box__body"},[e("div",null,[e("span",null,"所属分类："),e("span",null,I(((L=t.detailData)==null?void 0:L.pluginTypeName)||"-"),1)]),e("div",null,[e("span",null,"版本："),e("span",null,I(((N=t.detailData)==null?void 0:N.version)||"-"),1)]),e("div",null,[e("span",null,"更新时间："),e("span",null,I(((R=t.detailData)==null?void 0:R.updateTime)||"-"),1)]),e("div",null,[e("span",null,"插件介绍："),e("span",null,I(((K=t.detailData)==null?void 0:K.remark)||"-"),1)])]),e("div",{class:"plugin-drawer-box__footer"},[o(k(ie),{ref_key:"multipleTableRef",ref:f,data:(j=t.detailData)==null?void 0:j.apiList,style:{width:"100%"},onSelectionChange:_},{default:D(()=>[o(V,{type:"selection",width:"55"}),o(V,{prop:"name",width:"120",label:"API名称"}),o(V,{prop:"remark",label:"描述"})]),_:1},8,["data"])])])]}),_:1},8,["modelValue"])}}});const Le=U(Ve,[["__scopeId","data-v-5c75f995"]]),Se=E({__name:"routePage",props:{isRoute:{type:Boolean,default:!0}},setup(w){const y=v(),r=()=>{var n;(n=y.value)==null||n.reload()},a=v(!1),d=v(),f=v({}),u=async n=>{try{f.value[n]=!0;const s=await he(n);d.value=s,a.value=!0}catch{}finally{f.value[n]=!1}},_=v([]),p=v(!1),g=v(0),b=v([]),m=v({search:"",pluginTypeId:"",limit:10,current:1}),t=v(!1),l=async()=>{const n=await ye(m.value);b.value=n.records,g.value=+n.total,t.value=!0},x=async()=>{const n=await be({limit:"",current:"",name:"",order:""});_.value=n.map(s=>({value:s.id,label:s.name}))},A=n=>{n!=="0"&&(p.value=!0),r()};x();const V={request:{api:l}};return de(m.value,ce(()=>{r()},300),{deep:!0}),(n,s)=>{var S;const M=Z,T=ve;return i(),h("div",{class:Q(["myPlugin",{layout_box:n.isRoute}])},[t.value?(i(),P(Ae,{key:0,class:"mb-20",modelValue:m.value.search,"onUpdate:modelValue":s[0]||(s[0]=c=>m.value.search=c)},null,8,["modelValue"])):C("",!0),(S=_.value)!=null&&S.length?(i(),P(Ie,{key:1,class:"mb-20",modelValue:m.value.pluginTypeId,"onUpdate:modelValue":s[1]||(s[1]=c=>m.value.pluginTypeId=c),"item-list":_.value},null,8,["modelValue","item-list"])):C("",!0),o(pe,{load:l,ref_key:"loadingDataRef",ref:y},{default:D(()=>{var c;return[((c=b.value)==null?void 0:c.length)>0?(i(),h("div",{key:0,class:"az-grid"},[(i(!0),h(H,null,J(b.value,(L,N)=>(i(),P(ke,{key:N,cardInfo:L},{footer:D(()=>[o(M,{class:"myPlugin-btn",size:"small",type:"primary",onClick:R=>u(L.id),loading:f.value[L.id]},{default:D(()=>[$(" 安装 ")]),_:2},1032,["onClick","loading"]),e("span",null,I(L.count)+"次安装",1)]),_:2},1032,["cardInfo"]))),128))])):(i(),P(T,{key:1}))]}),_:1},512),_.value.length?(i(),P(me,{key:2,currentPage:m.value.current,"onUpdate:currentPage":s[2]||(s[2]=c=>m.value.current=c),pageSize:m.value.limit,"onUpdate:pageSize":s[3]||(s[3]=c=>m.value.limit=c),total:g.value,config:V},null,8,["currentPage","pageSize","total"])):C("",!0),o(ge,{data:d.value,isPluginMarket:1,visible:p.value,"onUpdate:visible":s[4]||(s[4]=c=>p.value=c)},null,8,["data","visible"]),o(Le,{onAuthMethodfn:A,detailData:d.value,visible:a.value,"onUpdate:visible":s[5]||(s[5]=c=>a.value=c)},null,8,["detailData","visible"])],2)}}});const Ee=U(Se,[["__scopeId","data-v-ada8d169"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"}));export{Ie as C,ke as P,Ae as S,Ee as a,ze as r};

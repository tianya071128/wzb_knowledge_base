import{d as Y,v as ae,er as G,r as P,Y as z,c as m,m2 as H,a as t,e0 as te,hX as u,dk as h,is as A,o as i,f as C,i as o,B as g,at as se,w as d,k as ne,m as N,dA as J,bt as oe,F as T,g as Q,b as F,a3 as de,l as _,dl as ue,I as re,es as ie,av as me,ac as pe,Q as ce,ao as fe,ap as ve,q as ye,bm as ge,U as be,bn as Ie,R as Ve,aq as X,j as Fe,rd as ke}from"./index-b80d5ef5.js";import{_ as Re}from"./ButtonSelectField.vue_vue_type_script_setup_true_lang-aae15f71.js";import{E as _e}from"./EditorDraggable-a06dbc71.js";const Se=Y({inheritAttrs:!1,__name:"FilterItemSet",props:{modelValue:{},entryId:{},sourceId:{},fields:{},isOptionaRange:{type:Boolean},list:{}},emits:["update:modelValue"],setup(w,{emit:B}){const f=w,S=ae(f,"modelValue",B),{getFieldInfo:p}=G(),a=P(z(S.value)),b=m(()=>p(a.value.fieldId,f)),O=m(()=>{var e;return H((e=b.value)==null?void 0:e.field.type)}),s=P(!1),v=()=>{s.value=!0,a.value=z(S.value)},c=()=>{S.value=z(a.value),s.value=!1},I=m(()=>{var e,l,r;return f.isOptionaRange&&((e=b.value)==null?void 0:e.field.type)&&[t.member,t.memberSingle,t.department,t.departmentSingle,t.role,t.job].includes((l=b.value)==null?void 0:l.field.type)&&!(a.value.type===te.dependOrg&&[t.member,t.memberSingle].includes((r=b.value)==null?void 0:r.field.type))}),y=m({get(){var e;return((e=a.value.selectRange)==null?void 0:e.type)??u.all},set(e){a.value.selectRange={type:e,custom:null}}}),L=m(()=>{var l;switch((l=b.value)==null?void 0:l.field.type){case t.role:return[{label:"全部角色",value:u.all},{label:"自定义",value:u.custom}];case t.job:return[{label:"全部岗位",value:u.all},{label:"自定义",value:u.custom}];case t.department:case t.departmentSingle:return[{label:"全部部门",value:u.all},{label:"仅机构",value:u.institution},{label:"自定义",value:u.custom}];case t.member:case t.memberSingle:return[{label:"全部成员",value:u.all},{label:"由其他控件确定",value:u.link},{label:"自定义",value:u.custom}]}return[]}),E=m({get(){var e;return((e=a.value.selectRange)==null?void 0:e.custom)??[]},set(e){a.value.selectRange&&(a.value.selectRange.custom=e)}}),U=m(()=>{var l,r;switch((l=b.value)==null?void 0:l.field.type){case t.role:return{tabs:[A.role]};case t.job:return{tabs:[A.jobByOrg]};case t.department:case t.departmentSingle:return{tabs:[A.org],dynamic:[h.org,h.currentUserOrg],customStrictly:!0};case t.member:case t.memberSingle:return{dynamic:[h.user,h.org],isChildOrg:!0,isAll:!0,childOrg:((r=a.value.selectRange)==null?void 0:r.isChildOrg)??!1,"onUpdate:childOrg":R=>{a.value.selectRange&&(a.value.selectRange.isChildOrg=R)}}}return{}}),V=m({get(){var e;return((e=a.value.selectRange)==null?void 0:e.linkFieldId)??""},set(e){a.value.selectRange&&(a.value.selectRange.linkFieldId=e)}}),k=m(()=>{var e;return V.value?(e=p(V.value,f))==null?void 0:e.field.type:void 0}),K=e=>{const l=f.list.map(r=>r.fieldId);return ie(e).filter(r=>l.includes(r.fieldId)&&[t.department,t.departmentSingle,t.role,t.job].includes(r.type))},$=m({get(){var e;return(e=a.value.selectRange)==null?void 0:e.isChildOrg},set(e){a.value.selectRange&&(a.value.selectRange.isChildOrg=e)}});return(e,l)=>{const r=me,R=pe,W=ce,q=fe,Z=ve,x=ye,ee=ge,M=be,le=Ie;return i(),C(T,null,[o(r,{underline:!1,title:"设置",icon:g(se),class:"editor-draggable-icon",onClick:v},null,8,["icon"]),o(le,{modelValue:s.value,"onUpdate:modelValue":l[7]||(l[7]=n=>s.value=n),title:"设置",width:"500","append-to-body":""},{footer:d(()=>[ne("span",{class:"dialog-footer"},[o(M,{onClick:l[6]||(l[6]=n=>s.value=!1)},{default:d(()=>[N("取消")]),_:1}),o(M,{type:"primary",onClick:c},{default:d(()=>[N("确定")]),_:1})])]),default:d(()=>[o(ee,{model:a.value,ref:"ruleFormRef","label-width":"100px"},{default:d(()=>[o(R,{label:"字段名称",prop:"type"},{default:d(()=>[o(J,{"field-id":a.value.fieldId,"entry-id":e.entryId,sourceId:e.sourceId,fields:e.fields},null,8,["field-id","entry-id","sourceId","fields"])]),_:1}),o(R,{label:"字段别名",prop:"type"},{default:d(()=>[o(W,{modelValue:a.value.alias,"onUpdate:modelValue":l[0]||(l[0]=n=>a.value.alias=n),placeholder:"可设置字段显示别名"},null,8,["modelValue"])]),_:1}),o(R,{label:"选项设置",prop:"type"},{default:d(()=>[o(oe,{class:"w100",modelValue:a.value.type,"onUpdate:modelValue":l[1]||(l[1]=n=>a.value.type=n),placeholder:"判断符"},{default:d(()=>[(i(!0),C(T,null,Q(O.value,(n,j)=>(i(),F(q,{key:j,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),I.value?(i(),F(R,{key:0,label:"选项范围",prop:""},{default:d(()=>[o(Z,{modelValue:y.value,"onUpdate:modelValue":l[2]||(l[2]=n=>y.value=n),placeholder:"请选择",class:"w100"},{default:d(()=>[(i(!0),C(T,null,Q(L.value,(n,j)=>(i(),F(q,{key:j,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),y.value===g(u).link?(i(),C(T,{key:0},[o(de,{modelValue:V.value,"onUpdate:modelValue":l[3]||(l[3]=n=>V.value=n),class:"w100 mt-10","entry-id":e.entryId,fields:e.fields,sourceId:e.sourceId,filter:K},null,8,["modelValue","entry-id","fields","sourceId"]),k.value===g(t).department||k.value===g(t).departmentSingle?(i(),F(x,{key:0,modelValue:$.value,"onUpdate:modelValue":l[4]||(l[4]=n=>$.value=n)},{default:d(()=>[N(" 包含子部门成员 ")]),_:1},8,["modelValue"])):_("",!0)],64)):_("",!0),y.value===g(u).custom?(i(),F(ue,re({key:1,modelValue:E.value,"onUpdate:modelValue":l[5]||(l[5]=n=>E.value=n),class:"w100 mt-10",multiple:""},U.value,{"dialog-title":"选择可选范围"}),null,16,["modelValue"])):_("",!0)]),_:1})):_("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Te=Y({__name:"FilterSetField",props:{modelValue:{},entryId:{},sourceId:{},fields:{},isSubform:{type:Boolean,default:!1},isOptionaRange:{type:Boolean}},emits:["update:modelValue"],setup(w,{emit:B}){const f=w,D=B,S=P(),p=Ve(f,"modelValue",D),a=s=>ke(s,{isSubform:f.isSubform}),{getFieldInfo:b}=G(),O=m({get(){return[...p.value??[]]},set(s){p.value=s.map(v=>{var E,U,V;const c=(E=p.value)==null?void 0:E.find(k=>k.fieldId===v.fieldId);if(c)return c;const I=b(v.fieldId,f),y=H(I==null?void 0:I.field.type);return{fieldId:v.fieldId,subformId:v.subformId,alias:"",type:((U=y.find(k=>k.isDefault))==null?void 0:U.value)??((V=y[0])==null?void 0:V.value)}})}});return(s,v)=>(i(),C(T,null,[o(Re,{modelValue:O.value,"onUpdate:modelValue":v[0]||(v[0]=c=>O.value=c),ref_key:"buttonSelectFieldRef",ref:S,placeholder:"选择筛选字段","entry-id":s.entryId,fields:s.fields,disabled:!s.entryId&&!s.fields&&!s.sourceId,sourceId:s.sourceId,filter:a,prop:{fieldId:"fieldId",fieldType:"fieldType",subformId:"subformId"},multiple:""},null,8,["modelValue","entry-id","fields","disabled","sourceId"]),o(_e,{"model-value":g(p)??[],class:"mt-5"},{default:d(({element:c,index:I})=>[o(X,{class:"az-input-prefix az-flex-width",readonly:""},{prefix:d(()=>[o(J,{includeSubFormLabel:"","field-id":c.fieldId,"entry-id":s.entryId,sourceId:s.sourceId,fields:s.fields,class:"color-text"},null,8,["field-id","entry-id","sourceId","fields"])]),_:2},1024),c.alias?(i(),F(X,{key:0,class:"az-input-prefix",readonly:"",style:{"max-width":"100px"}},{prefix:d(()=>[o(Fe,{style:{color:"var(--el-text-color-primary)"},content:c.alias},null,8,["content"])]),_:2},1024)):_("",!0),g(p)?(i(),F(Se,{key:1,modelValue:g(p)[I],"onUpdate:modelValue":y=>g(p)[I]=y,"entry-id":s.entryId,sourceId:s.sourceId,fields:s.fields,isOptionaRange:"",list:O.value},null,8,["modelValue","onUpdate:modelValue","entry-id","sourceId","fields","list"])):_("",!0)]),_:1},8,["model-value"])],64))}});export{Te as _};

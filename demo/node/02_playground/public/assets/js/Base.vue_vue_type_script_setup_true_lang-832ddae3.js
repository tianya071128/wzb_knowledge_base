import{e7 as Ue,oi as ze,fN as Oe,d as ne,gY as qe,B as l,o as t,b as V,w as r,k as $,f as g,F as P,g as ee,i as v,m as M,t as A,l as E,p as te,a2 as _e,oj as We,P as be,av as Ee,aU as xe,_ as oe,cH as Pe,h5 as ye,b_ as He,jG as Fe,c as W,Z as Re,r as L,bx as De,ok as Ze,y as je,cC as Je,ka as ae,a as Se,ol as fe,ev as Ge,om as Ke,on as Qe,I as he,d9 as Ye,dW as ie,aN as ke,dK as Xe,dL as el,oo as ll,aa as al,dN as G,U as Ve,d2 as tl,d3 as nl,dC as Ne,dD as sl,bn as dl,ad as il,dO as ol,a5 as rl,a4 as ul,bG as ge,C as cl,dJ as fl,e as _l,S as pl,dQ as vl,bc as me,gZ as ml,hN as yl,nO as hl,bv as gl,q as bl,mp as kl,h as pe,op as Vl,oq as Il,dy as wl,ez as Rl,lE as Cl,b2 as El}from"./index-b80d5ef5.js";import{_ as xl}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import{k as Fl}from"./keyBy-8fcfdd74.js";function Dl(s,i){var u={};return i=Ue(i),ze(s,function(b,w,x){Oe(u,w,i(b,w,x))}),u}const Sl=ne({__name:"LinkFlag",props:{field:{}},setup(s){const i=qe();return(u,b)=>{const w=be,x=Ee,T=xe;return l(i).fillFieldIdMap.has(u.field.fieldId)?(t(),V(T,{key:0,effect:"light",placement:"top"},{content:r(()=>[$("div",{style:{"max-width":"250px"}},[$("span",{style:{"margin-right":"5px"}},"此控件值由"),(t(!0),g(P,null,ee(l(i).fillFieldIdMap.get(u.field.fieldId),(F,B)=>{var z;return t(),g(P,{key:F},[v(x,{underline:!1,type:"primary",style:{"vertical-align":"inherit"},onClick:D=>l(i).scrollToField(F)},{default:r(()=>{var D;return[M(A(((D=l(i).fields.get(F))==null?void 0:D.options.label)??""),1)]}),_:2},1032,["onClick"]),B!==(((z=l(i).fillFieldIdMap.get(u.field.fieldId))==null?void 0:z.length)??0)-1?(t(),g("span",{key:0}," 、 ")):E("",!0)],64)}),128)),$("span",{style:{"margin-left":"5px"}},"填充")])]),default:r(()=>[v(w,{class:te(["link_flag",u.$attrs.class]),style:_e(u.$attrs.style)},{default:r(()=>[v(l(We))]),_:1},8,["class","style"])]),_:1})):E("",!0)}}});const Nl=oe(Sl,[["__scopeId","data-v-2c704528"]]),$l=ne({__name:"ShowFlag",setup(s){return(i,u)=>{const b=be,w=xe;return t(),V(w,{effect:"dark",content:"该控件设置为不可见或始终隐藏",placement:"top"},{default:r(()=>[v(b,{class:te(["show_flag",i.$attrs.class]),style:_e(i.$attrs.style)},{default:r(()=>[v(l(Pe))]),_:1},8,["class","style"])]),_:1})}}});const Tl=oe($l,[["__scopeId","data-v-913eeb0a"]]);var de=(s=>(s.sum="0",s.average="1",s))(de||{});const Ce=[{label:"求和",value:"0"},{label:"平均数",value:"1"}],Pl=[{label:"表格",value:ye.table},{label:"卡片",value:ye.card}];function Hl(s){return{number:Ce.filter(u=>["0","1"].includes(u.value)),slider:Ce.filter(u=>["0","1"].includes(u.value))}[s]}const Al="custom",Zl=s=>{const i=He(s,"subformFieldWidthMap")??["75px","150px","300px"];return[{label:"小",value:i[0]},{label:"标准",value:i[1]},{label:"大",value:i[2]},{label:"自定义",value:Al}]};function $e(s,i){const u=Fe(),b="statistical",w="statistical",x=W(()=>{const e=s.data.map(n=>{var a;return{__id__:n.__id__??Re(),__isDelete__:!((a=n==null?void 0:n.noDelete)!=null&&a.subform_rule)&&(F.value||!(n!=null&&n.isExisting))&&B.value,...n}});return s.field.options.statistical&&Object.keys(s.field.options.statistical).length&&e.push({__id__:b,__isDelete__:!1}),e}),T=W(()=>s.isRender?u.getFieldAuth(s.field.fieldId,"addRecord")&&s.field.options.addRecord:s.field.options.addRecord),F=W(()=>s.isRender?u.getFieldAuth(s.field.fieldId,"deleteRecord")&&s.field.options.deleteRecord:s.field.options.deleteRecord),B=W(()=>s.isRender?!!u.getFieldAuth(s.field.fieldId,"delete"):!0),z=W(()=>s.field.options.deleteBtnText||"删除"),D=W(()=>s.field.options.addBtnText||"添加一行"),K=W(()=>s.isRender?T.value&&u.getFieldAuth(s.field.fieldId,"importRecord")&&s.field.options.importRecord:s.field.options.importRecord),Y=(e,n)=>{if(!s.isRender)return;const a=Re();s.field.fields.forEach(m=>{const C=u.matchFieldData(m.fieldId);if(Array.isArray(C)){const U=ae(n)&&m.type!==Se.autoNumber?u.getFieldVal(m.fieldId,n):u.getDefaultValue(m.fieldId),le={value:null,__id__:a};ae(n)&&(le.isExisting=!0),ae(e)?C.splice(e,0,le):C.push(le),u.setFieldVal(m.fieldId,U,ae(e)?e:C.length-1)}})},Q=e=>{s.isRender&&s.field.fields.forEach(n=>{const a=u.matchFieldData(n.fieldId);Array.isArray(a)&&a.splice(e,1)})},O=()=>{q.value.forEach(e=>{const n=x.value.find(a=>a.__id__===e);if(n){if(!n.__isDelete__)return i.ElMessageError("已有行无删除权限，已为你保留");Q(x.value.findIndex(a=>a.__id__===e))}})},Z=e=>{Array.isArray(e)&&u.setFieldVal(s.field.fieldId,e,void 0,{sonUseDefault:!0,sonNoExisting:!0})},q=L(new Set),j=e=>q.value.has(e),X=e=>{q.value.has(e)?q.value.delete(e):q.value.add(e)},S=W(()=>!y.value&&x.value.some(e=>e.__id__!==b&&j(e.__id__))),y=W({get(){return x.value.some(e=>e.__id__!==b)&&!x.value.some(e=>e.__id__!==b&&!j(e.__id__))},set(e){x.value.forEach(n=>{n.__id__!==b&&q.value[e?"add":"delete"](n.__id__)})}}),R=(e,n)=>{if(!s.isRender)return"-";const a=x.value.filter(m=>m.__id__!==b);if(!a.length)return"-";if(n===de.sum||n===de.average){const m=a.reduce((C,U,le)=>{let se=u.getFieldVal(e.fieldId,le);return ae(se)||(se=0),fe(C).plus(se).toNumber()},0);if(n===de.sum)return m;{let C=e.options.precision;C=ae(C)?Number(C):0,fe.DP=C+2;const U=fe(m).div(a.length).toNumber();return fe.DP=20,U}}else return n},p=(e,n)=>{n.newIndex!==n.oldIndex&&s.field.fields.forEach(a=>{const m=u.matchFieldData(a.fieldId);if(Array.isArray(m)){const C=m.splice(n.oldIndex,1)[0];m.splice(n.newIndex,0,C)}})},I=L(new Map);De(()=>{s.isRender&&(s.field.options.highlightRules??[]).forEach((e,n)=>{Ze({render:u,condition:e.condition,immediate:1,subformFieldId:s.field.fieldId,callback({res:a,rowId:m}){if(!m){console.warn("这里的数据出问题了, 请检查!");return}const C=[...I.value.get(m??"")??[]];C[n]=a?e.color:null,I.value.set(m,C)}})})});const k=({row:e,rowIndex:n})=>{var C;const a=e.__id__;if(a===b)return;let m=(C=I.value.get(a))==null?void 0:C.find(U=>!!U);if(s.field.options.stripe&&!m&&n%2===1&&(m="#fafafa"),!!m)return{"--az-row-color":m}},N=e=>{if(k(e))return"is-row-color"};let d=null;const f=L(),_=L(!1);return je(f,()=>{setTimeout(()=>{!f.value||!s.isRender||(d==null||d.destroy(),d=new Ge(f.value,{handle:".subform_field-draggable-rank",delay:300,preventOnFilter:!1,animation:300,filter:`.${w}`,chosenClass:"row_drag_action",ghostClass:"row_drag_action",onStart(){_.value=!0},onMove(e){return!e.related.classList.contains(w)},onUpdate({item:e,newIndex:n,oldIndex:a,from:m}){if(_.value=!1,a==null||n==null){console.error("拖拽结束, 但是传入参数有问题, 请检查!",n,a);return}Ke(e),Qe(m,e,a),p([],{newIndex:n,oldIndex:a})}}))})},{immediate:!0}),Je(()=>{d==null||d.destroy()}),{render:u,handleAdd:Y,addRecord:T,tableData:x,statisticalId:b,statisticalClass:w,deleteBtnText:z,deleteRecord:F,importRecord:K,deleteAuth:B,handleDelete:Q,addBtnText:D,setSelected:X,getSelected:j,isIndeterminate:S,checkAll:y,selectedIds:q,batchDelete:O,getStatistical:R,handleDragEnd:p,getRowStyle:k,getRowClass:N,dragRef:f,isDrag:_,handleImport:Z}}const Ml=ne({inheritAttrs:!1,__name:"ImportData",props:{field:{}},emits:["refresh","import"],setup(s,{emit:i}){const u=s,b=i,w=Fe(),x=()=>{if(w.mode===ie.preview){ke.warning("预览模式不支持导入");return}T.value=!0},T=L(!1),F=L(0),B=L(""),z=L([]),D=L(),K=()=>{var y,R;const S=u.field.fields.map(p=>({columnName:p.fieldId,fieldType:p.type,label:p.options.label,fieldJson:JSON.stringify(p)}));return[{columnName:"parent_id",fieldType:Se.subform,label:((R=(y=u.field)==null?void 0:y.options)==null?void 0:R.label)??"子表单"},...S]},Y=async()=>{await Xe({fileName:"downExcel",fields:K()})},Q=async(S,y)=>{try{B.value=y.id;const R=await el({fileId:y.id,fields:K()});F.value=1,R.headList.forEach(p=>{var I;if((I=p==null?void 0:p.child)!=null&&I.length)p==null||p.child.forEach(k=>{const{columnValue:N,columnName:d,aliasValue:f,type:_}=k;k.option={columnValue:N,columnName:d,aliasValue:f,type:_}});else{const{columnValue:k,columnName:N,aliasValue:d,type:f}=p;p.option={columnValue:k,columnName:N,aliasValue:d,type:f}}}),D.value=R}catch{z.value=[]}},O=()=>{z.value=[],F.value=0},Z=()=>{var S;(S=D.value)==null||S.dataList.unshift({}),F.value=2},q=()=>{var S,y,R;(y=(S=D.value)==null?void 0:S.headList)==null||y.forEach(p=>{var I;if((I=p==null?void 0:p.child)!=null&&I.length)p==null||p.child.forEach(k=>{const{columnValue:N,columnName:d,aliasValue:f,type:_}=k;k.option={columnValue:N,columnName:d,aliasValue:f,type:_}});else{const{columnValue:k,columnName:N,aliasValue:d,type:f}=p;p.option={columnValue:k,columnName:N,aliasValue:d,type:f}}}),(R=D.value)==null||R.dataList.splice(0,1),F.value=1},j=(S,y)=>{var k,N;const R=((k=D.value)==null?void 0:k.headList.reduce((d,f)=>[...d,f,...f.child??[]],[]))??[],I=(((N=D.value)==null?void 0:N.headFieldMap.reduce((d,f)=>[...d,f,...f.children??[]],[]))??[]).find(d=>d.alias===S);R.forEach(d=>{var f;d.aliasValue!==y&&((f=d.option)==null?void 0:f.aliasValue)===S&&(d.option.aliasValue="0",d.option.columnName="不导入"),I&&d.option&&d.aliasValue===y&&d.type!=="subform"&&(d.option.columnName=I.label,d.option.type=I.type)})},X=async()=>{var p,I,k,N;const S=((I=(p=D.value)==null?void 0:p.headList)==null?void 0:I.map(d=>{var f,_,e,n;return{columnValue:d.columnValue,columnName:((f=d.option)==null?void 0:f.columnName)??d.columnName??"",type:((_=d.option)==null?void 0:_.type)??d.type??"",aliasValue:((e=d.option)==null?void 0:e.aliasValue)??d.aliasValue??"",child:(n=d.child)==null?void 0:n.map(a=>{var m,C,U;return{columnValue:a.columnValue,columnName:((m=a.option)==null?void 0:m.columnName)??"",type:((C=a.option)==null?void 0:C.type)??"",aliasValue:((U=a.option)==null?void 0:U.aliasValue)??""}})}}))??[],y=await ll({fileId:B.value,colunmList:S,entryId:w.entryId,fields:K()}),R=y.childs.map(d=>Dl(Fl(d.columns,"column"),"value"));b("import",R),T.value=!1,O(),al({title:"导入成功",message:G("p",null,[G("span",null,"导入总数： "),G("span",{style:"margin-right: 8px;"},y.dataCount),G("span",null,"成功： "),G("span",{style:"color: var(--el-color-success);margin-right: 8px;"},y.successCount),G("span",null,"失败： "),G("span",{style:"color: var(--el-color-danger);margin-right: 8px;"},y.failureCount),G("br"),G("span",{style:`display: ${y.failureFileInfo?"flex":"none"}`},"失败文件： "),G("a",{style:`color: var(--el-color-primary);display: ${y.failureFileInfo?"flex":"none"}`,href:(k=y.failureFileInfo)==null?void 0:k.url},(N=y.failureFileInfo)==null?void 0:N.fileName)]),showCancelButton:!1,confirmButtonText:"我知道了"}),b("refresh")};return(S,y)=>{const R=Ve,p=tl,I=nl,k=Ne,N=sl,d=ol,f=dl;return t(),g(P,null,[v(R,he({onClick:x,type:"success"},S.$attrs),{default:r(()=>[M(" 导入 ")]),_:1},16),v(f,{modelValue:T.value,"onUpdate:modelValue":y[1]||(y[1]=_=>T.value=_),title:"导入数据",width:"800","append-to-body":""},{default:r(()=>[v(I,{active:F.value,"finish-status":"success","align-center":"",style:{"margin-bottom":"20px"}},{default:r(()=>[v(p,{title:"选择Excel"}),v(p,{title:"预览数据"}),v(p,{title:"配置表单"})]),_:1},8,["active"]),F.value===0?(t(),g("div",{key:0},[$("div",null,[M(" 1.请先下载模板: "),v(R,{type:"primary",link:"",onClick:Y},{default:r(()=>[M(" 下载导入模板 ")]),_:1})]),$("div",null,"2.按模板格式填入数据；"),$("div",null,"3.上传填好数据的excel文件，导入数据。"),$("div",{class:"upload-box"},[v(Ye,{modelValue:z.value,"onUpdate:modelValue":y[0]||(y[0]=_=>z.value=_),limit:1,type:"file",onUploadFinish:Q,accept:["xlsx","xls"],imgWidth:"80px",size:5120},null,8,["modelValue"])])])):E("",!0),F.value===1?(t(),g("div",{key:1},[v(N,{data:D.value.dataList,style:{width:"100%"},height:"250"},{default:r(()=>[(t(!0),g(P,null,ee(D.value.headList,_=>(t(),V(k,{key:_.aliasValue,prop:String(_.columnValue),label:_.columnName},{default:r(()=>[_.child?(t(!0),g(P,{key:0},ee(_.child,e=>(t(),V(k,{key:e.aliasValue,prop:String(e.columnValue),label:e.columnName},null,8,["prop","label"]))),128)):E("",!0)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data"]),$("div",{class:"handle-btn-box"},[v(R,{onClick:O},{default:r(()=>[M("上一步")]),_:1}),v(R,{type:"primary",onClick:Z},{default:r(()=>[M("下一步")]),_:1})])])):E("",!0),F.value===2?(t(),g("div",{key:2},[v(N,{data:D.value.dataList,style:{width:"100%"},height:"250"},{default:r(()=>[v(k,{width:"100"},{default:r(_=>[_.$index===0?(t(),g("span",{key:0},"表单字段")):(t(),g("span",{key:1},A(_.$index),1))]),_:1}),(t(!0),g(P,null,ee(D.value.headList,_=>(t(),V(k,{label:_.columnName,key:_.aliasValue,"min-width":"120"},il({default:r(()=>[(t(!0),g(P,null,ee(_.child,e=>(t(),V(k,{key:e.aliasValue,label:e.columnName},{default:r(n=>[n.$index!==0?(t(),g("span",{key:0},A(n.row[e.columnValue]),1)):(t(),g("span",{key:1},[v(d,{props:{value:"alias"},"node-key":"alias",modelValue:e.option.aliasValue,"onUpdate:modelValue":a=>e.option.aliasValue=a,data:D.value.headFieldMap,"render-after-expand":!1,style:{width:"100%"},onChange:a=>j(a,e.aliasValue)},null,8,["modelValue","onUpdate:modelValue","data","onChange"])]))]),_:2},1032,["label"]))),128))]),_:2},[_.child?void 0:{name:"default",fn:r(e=>[e.$index!==0?(t(),g("span",{key:0},A(e.row[_.columnValue]),1)):(t(),g("span",{key:1},[v(d,{props:{value:"alias"},"node-key":"alias",modelValue:_.option.aliasValue,"onUpdate:modelValue":n=>_.option.aliasValue=n,data:D.value.headFieldMap,"render-after-expand":!1,style:{width:"100%"},onChange:n=>j(n,_.aliasValue)},null,8,["modelValue","onUpdate:modelValue","data","onChange"])]))]),key:"0"}]),1032,["label"]))),128))]),_:1},8,["data"]),$("div",{class:"handle-btn-box"},[v(R,{onClick:q},{default:r(()=>[M("上一步")]),_:1}),v(R,{type:"primary",onClick:X},{default:r(()=>[M("导入")]),_:1})])])):E("",!0)]),_:1},8,["modelValue"])],64)}}});const Te=oe(Ml,[["__scopeId","data-v-86701c2f"]]),Ll=ne({__name:"TableMode",props:{field:{},data:{},isRender:{type:Boolean}},setup(s){const i=s,{render:u,handleAdd:b,addRecord:w,importRecord:x,tableData:T,statisticalId:F,deleteRecord:B,handleDelete:z,deleteBtnText:D,addBtnText:K,setSelected:Y,getSelected:Q,isIndeterminate:O,checkAll:Z,batchDelete:q,getStatistical:j,handleDragEnd:X,statisticalClass:S,getRowStyle:y,getRowClass:R,deleteAuth:p,handleImport:I}=$e(i,{ElMessageError:ke.error}),k=L(),N=L(),d=o=>(parseFloat(o.options.subformWidth??"")||150)+24,f=o=>o.row.__id__===F?S:R(o),_={enable:w.value||B.value,handle:".subform_field-draggable-rank",filter:`.${S}`,onMove(o){return!o.related.classList.contains(S)}},e=W(()=>i.isRender?u.getFieldAuth(i.field.fieldId,"edit"):i.field.options.edit),n=L(!1),a=L(0),m=o=>{i.isRender&&(n.value=!0,a.value=o)},C=(o,h)=>{const J=[{text:i.field.options.editBtnText||"编辑",type:"primary",onClick(){m(o)}},{text:h.__isDelete__?D.value:"",type:"danger",popconfirmProps:{title:"确定要删除?",confirm:z.bind(null,o)}}];return w.value&&J.push({text:"向上插入行",type:"primary",onClick(){b(o)}},{text:"向下插入行",type:"primary",onClick(){b(o+1)}},{text:"复制到下一行",type:"primary",onClick(){b(o+1,o)}},{text:"复制到最后一行",type:"primary",onClick(){b(T.value.filter(ue=>ue.__id__!==F).length,o)}}),J},U=L(null),le=o=>{U.value=o.__id__},se=()=>{U.value=null},Ae=o=>i.isRender?u.getFieldAuth(o.fieldId,"required"):"required"in o.options&&o.options.required,Me=W(()=>i.isRender?i.field.fields.filter(o=>i.data.length?i.data.some((h,J)=>u.getFieldShow(o.fieldId,J)):u.getFieldShow(o.fieldId)):i.field.fields),re=W(()=>[ie.pureView,ie.view].includes(u==null?void 0:u.mode)),Le=(o,h)=>{re.value&&(h==null?void 0:h.property)!=="operate"&&m(u.getRowIndexById(i.field.fieldId,o.__id__)??0)},Ie=o=>{const h=a.value;a.value=a.value+o,X([],{newIndex:a.value,oldIndex:h})},Be=()=>{var o;(o=N.value)==null||o.toggle()};return(o,h)=>{const J=Ve,ue=bl,ve=Ee,ce=Ne;return t(),g("div",{class:"w100 subform_wrapper",ref_key:"el",ref:k},[$("div",{class:"mb-10 sub_form_field"},[l(w)?(t(),V(J,{key:0,type:"primary",icon:l(rl),onClick:h[0]||(h[0]=c=>l(b)())},{default:r(()=>[M(A(l(K)),1)]),_:1},8,["icon"])):E("",!0),l(x)?(t(),V(Te,{key:1,field:o.field,onImport:l(I)},null,8,["field","onImport"])):E("",!0),l(p)&&(l(B)||l(w))?(t(),V(ge,{key:2,title:"确定要删除吗?",confirm:l(q)},{reference:r(()=>[v(J,{type:"danger",plain:"",icon:l(ul),disabled:!l(O)&&!l(Z)},{default:r(()=>[M(A(l(D)),1)]),_:1},8,["icon","disabled"])]),_:1},8,["confirm"])):E("",!0)]),v(ml,{data:l(T),border:"",style:{width:"100%"},drag:_,onDragenter:h[2]||(h[2]=me(()=>{},["stop"])),onDragover:h[3]||(h[3]=me(()=>{},["stop"])),onPointerdown:h[4]||(h[4]=me(()=>{},["stop"])),"class-name":"subform_field",class:te({"is-view":re.value}),onCellMouseEnter:le,onCellMouseLeave:se,onDragEnd:l(X),"row-class-name":f,"row-style":l(y),"row-key":"__id__","max-height":"50vh",fullEl:k.value,onRowClick:Le,ref_key:"azTableRef",ref:N},{default:r(()=>[v(ce,{width:"70",fixed:"left",align:"center","class-name":o.isRender?void 0:"subform_field-other",prop:"operate"},{header:r(()=>[$("div",{class:"subform_field-header"},[v(ue,{modelValue:l(Z),"onUpdate:modelValue":h[1]||(h[1]=c=>cl(Z)?Z.value=c:null),class:"subform_field-checkbox",label:"",indeterminate:l(O)},null,8,["modelValue","indeterminate"]),v(J,{icon:l(fl),link:"",onClick:Be,style:{"margin-left":"2px"},title:"全屏"},null,8,["icon"])])]),default:r(({row:c,$index:H})=>[(c==null?void 0:c.__id__)!==l(F)?(t(),g("div",{key:0,class:"sub_form-index"},[U.value===c.__id__||l(Q)(c.__id__)?(t(),V(ue,{key:0,class:"subform_field-checkbox",style:{height:"auto"},"model-value":l(Q)(c.__id__),"onUpdate:modelValue":we=>l(Y)(c.__id__),label:""},null,8,["model-value","onUpdate:modelValue"])):(t(),g("div",{key:1},A(H+1),1)),l(w)||l(B)?_l((t(),V(ve,{key:2,class:"subform_field-draggable-rank",underline:!1,style:{"margin-left":"5px"},icon:l(vl),title:"拖动排序"},null,8,["icon"])),[[pl,U.value===c.__id__]]):E("",!0)])):(t(),g("div",{key:1},"统计"))]),_:1},8,["class-name"]),(t(!0),g(P,null,ee(Me.value,c=>(t(),V(ce,{key:c.fieldId,width:d(c)},{header:r(()=>[$("div",{class:te({"subform-required":Ae(c)})},[$("span",null,A(c.options.label),1),c.options.tip?(t(),V(kl,{key:0,tip:c.options.tip},null,8,["tip"])):E("",!0),o.isRender?E("",!0):(t(),g(P,{key:1},[!c.options.show||c.options.alwaysHide?(t(),V(Tl,{key:0,style:{"margin-left":"4px"}})):E("",!0),v(Nl,{field:c,style:{"margin-left":"4px"}},null,8,["field"])],64))],2)]),default:r(({row:H,$index:we})=>[(H==null?void 0:H.__id__)!==l(F)?pe(o.$slots,"default",{key:0,row:H,index:we,item:c},void 0,!0):o.field.options.statistical[c.fieldId]?(t(),g("div",{key:1},A(o.field.options.statistical[c.fieldId]===l(de).sum?"总计":"平均")+"："+A(l(j)(c,o.field.options.statistical[c.fieldId])),1)):E("",!0)]),_:2},1032,["width"]))),128)),l(w)||l(B)||e.value&&o.data.some(c=>c.isExisting)?(t(),V(ce,{key:0,fixed:"right",label:"操作",minWidth:"120px","class-name":o.isRender?void 0:"subform_field-other"},{default:r(({$index:c,row:H})=>[(H==null?void 0:H.__id__)!==l(F)?(t(),V(xl,{key:0,num:2,"row-id":String(c),list:C(c,H)},null,8,["row-id","list"])):E("",!0)]),_:1},8,["class-name"])):(t(),V(ce,{key:1,"min-width":"1px"}))]),_:3},8,["data","class","onDragEnd","row-style","fullEl"]),v(gl,{modelValue:n.value,"onUpdate:modelValue":h[9]||(h[9]=c=>n.value=c),title:`编辑行（第${a.value+1}行）`,class:"subform_drawer","append-to-body":""},{footer:r(()=>[$("div",{class:"subform_drawer-footer"},[v(ve,{icon:l(yl),underline:!1,disabled:a.value===0,onClick:h[5]||(h[5]=c=>a.value=a.value-1)},null,8,["icon","disabled"]),$("span",{style:{margin:"0 10px"}},A(a.value+1)+"/"+A(l(T).length),1),v(ve,{icon:l(hl),underline:!1,disabled:a.value===o.data.length-1,onClick:h[6]||(h[6]=c=>a.value=a.value+1)},null,8,["icon","disabled"]),re.value?E("",!0):(t(),V(J,{key:0,style:{"margin-left":"10px"},disabled:a.value===0,onClick:h[7]||(h[7]=c=>Ie(-1))},{default:r(()=>[M(" 上移 ")]),_:1},8,["disabled"])),re.value?E("",!0):(t(),V(J,{key:1,disabled:a.value===o.data.length-1,onClick:h[8]||(h[8]=c=>Ie(1))},{default:r(()=>[M(" 下移 ")]),_:1},8,["disabled"]))])]),default:r(()=>[(t(!0),g(P,null,ee(o.field.fields,c=>(t(),V(Vl,{key:`${c.fieldId}_${a.value}`,field:c,index:a.value,isEdit:"",hidePadding:""},null,8,["field","index"]))),128))]),_:1},8,["modelValue","title"])],512)}}});const Bl=oe(Ll,[["__scopeId","data-v-5f3f2630"]]),Ul=ne({__name:"CardMode",props:{field:{},data:{},isRender:{type:Boolean},labelAfterEl:{}},setup(s){const i=s,{render:u,handleAdd:b,addRecord:w,tableData:x,statisticalId:T,deleteRecord:F,handleDelete:B,deleteBtnText:z,addBtnText:D,setSelected:K,getSelected:Y,isIndeterminate:Q,checkAll:O,batchDelete:Z,deleteAuth:q,dragRef:j,isDrag:X,statisticalClass:S,importRecord:y}=$e(i,{ElMessageError:ke.error});De(()=>{!x.value.filter(f=>f.__id__!==T).length&&i.isRender&&[ie.enter,ie.preview].includes(u.mode)&&b()});const{nextZIndex:R}=Il(),p=L(R()),I=L(!1),k=()=>{i.isRender&&(I.value?O.value=!1:p.value=R(),I.value=!I.value)},N=()=>{O.value=!O.value},d=W(()=>{const f=x.value[0];return!w.value&&x.value.filter(_=>_.__id__!==T).length===1&&!Y(f.__id__)&&!f.__isDelete__});return(f,_)=>{const e=Ve,n=be;return t(),g("div",{class:"subform_card"},[$("div",{class:"subform_card-btns"},[(t(),V(wl,{to:f.labelAfterEl,disabled:!f.labelAfterEl},[d.value?E("",!0):(t(),g(P,{key:0},[I.value?(t(),V(e,{key:0,type:"primary",link:"",onClick:N},{default:r(()=>[M(A(l(O)?"取消全选":"全选"),1)]),_:1})):E("",!0),v(e,{type:"primary",link:"",onClick:k},{default:r(()=>[M(A(I.value?"取消选择":"选择"),1)]),_:1})],64)),l(y)?(t(),V(Te,{key:1,link:"",field:f.field},null,8,["field"])):E("",!0),l(q)&&(l(F)||l(w))?(t(),V(ge,{key:2,title:"确定要删除吗?",confirm:l(Z)},{reference:r(()=>[v(e,{type:"danger",link:"",disabled:!l(Q)&&!l(O)},{default:r(()=>[M(A(l(z)),1)]),_:1},8,["disabled"])]),_:1},8,["confirm"])):E("",!0)],8,["to","disabled"]))]),$("div",{class:te(["subform_card-drag",{"is-select":I.value}]),ref_key:"dragRef",ref:j},[(t(!0),g(P,null,ee(l(x),(a,m)=>(t(),g("div",{key:a.__id__,class:te(["subform_card-item",{"is-selected":l(Y)(a.__id__),"subform_field-draggable-rank":(l(w)||l(F))&&!I.value,[l(S)]:a.__id__===l(T),"is-hideInfo":d.value}]),id:a.__id__,style:_e({display:a.__id__===l(T)?"none":void 0})},[a.__id__!==l(T)?(t(),g(P,{key:0},[a.__isDelete__&&!l(X)?(t(),V(ge,{key:0,title:"确定要删除吗?",confirm:()=>l(B)(m),disabled:!f.isRender},{reference:r(()=>[$("div",{class:"subform_card-close",style:{zIndex:99}},[v(n,null,{default:r(()=>[v(l(Rl))]),_:1})])]),_:2},1032,["confirm","disabled"])):E("",!0),$("div",{class:"subform_card-mask",style:_e({zIndex:p.value}),onClick:C=>l(K)(a.__id__)},[$("div",{class:"subform_card-mark"},[v(n,null,{default:r(()=>[v(l(Cl))]),_:1})])],12,["onClick"]),pe(f.$slots,"container",{index:m},void 0,!0)],64)):E("",!0)],14,["id"]))),128))],2),l(x).filter(a=>a.__id__!==l(T)).length?E("",!0):(t(),V(El,{key:0,style:{padding:"10px 0"},"image-size":50,description:"无数据"})),$("div",null,[l(w)?(t(),V(e,{key:0,type:"primary",link:"",onClick:_[0]||(_[0]=a=>l(b)())},{default:r(()=>[M(A(l(D)),1)]),_:1})):E("",!0)])])}}});const zl=oe(Ul,[["__scopeId","data-v-e99ba25d"]]),jl=ne({__name:"Base",props:{field:{},data:{}},setup(s){return(i,u)=>i.field.options.mode===l(ye).card?(t(),V(zl,he({key:0,field:i.field,data:i.data},i.$attrs),{container:r(({index:b})=>[pe(i.$slots,"container",{index:b})]),_:3},16,["field","data"])):(t(),V(Bl,he({key:1,field:i.field,data:i.data},i.$attrs),{default:r(({row:b,index:w,item:x})=>[pe(i.$slots,"default",{row:b,index:w,item:x})]),_:3},16,["field","data"]))}});export{Nl as L,Tl as S,jl as _,Hl as a,Al as c,Zl as g,Pl as s};

import{d as j,v as ee,r as T,y as ie,o as g,f as M,k,i as l,w as c,B as n,a_ as Ia,e as Q,S as ge,bz as da,a2 as Se,b as D,aR as wa,l as $,aS as La,aq as Aa,t as G,h as oe,F as Y,g as le,ad as va,ae as Da,I as Sa,C as Z,cE as Ba,aT as Ye,P as Ke,aU as _a,av as de,N as ya,O as ga,_ as K,hZ as q,bs as Ea,c as J,is as $e,dk as pa,dl as Ma,lG as Na,mD as Ua,m as U,mE as qa,d9 as Me,aN as X,U as me,bw as Oa,Q as ke,bt as Be,a4 as Fa,a5 as We,ac as Ie,ao as Ge,q as ba,bm as we,Z as Ee,bH as _e,mI as ve,Y as ne,a9 as Ce,aa as Te,ca as Ve,bK as ye,pY as pe,eK as Ne,pZ as be,bu as Ue,dC as qe,dD as Oe,bn as Le,p_ as $a,E as Ze,ab as Qe,p as Xe,cA as ja,p$ as za,q0 as Ha,d5 as je,bx as ea,gT as Ja,ba as ha,bA as Ya,bB as Ka,q1 as Wa,br as Ga,gc as ca,q2 as Za,q3 as Pe,q4 as ka,q5 as Qa,ds as Xa,bp as et,fw as at,eB as tt,eu as lt,pa as he,bv as st,aV as Ca,bC as ot,bi as nt,iC as rt,L as ut,pU as it,b4 as ma,q6 as dt,dN as ze,q7 as pt,q8 as ct,cr as mt,iD as ft}from"./index-b80d5ef5.js";import{_ as vt}from"./batch-53af5de6.js";import{A as _t}from"./AzConfirmSwitch-689fcef9.js";import{_ as yt}from"./TableOperation.vue_vue_type_script_setup_true_lang-4afbb2cb.js";import{E as gt}from"./el-input-number-c15b1cc7.js";import{i as te,l as Ae,g as bt,F as ce,a as ht,b as kt,N as Re}from"./ParamSettingFormTable-3b7d2b84.js";import{u as Ct}from"./processModel-1437813e.js";import"./defaultValue-7c7c87ea.js";import{a as Tt,C as Vt}from"./CodeBlockEdit-23586d14.js";import{E as xt}from"./EditAuthInfo-e7e23191.js";import"./AzPasswordFormItem-db212711.js";const Pt=j({__name:"DesignerTabs",props:{modelValue:{},tabs:{},entryDetails:{}},emits:["update:modelValue","update:entryDetails","back"],setup(x,{emit:s}){const t=x,v=s,i=ee(t,"modelValue",v),e=T(""),m=T(!1),f=T();ie(()=>{var a,o;return(o=(a=t.entryDetails)==null?void 0:a.appEntryVO)==null?void 0:o.name},()=>{var a,o;e.value=((o=(a=t.entryDetails)==null?void 0:a.appEntryVO)==null?void 0:o.name)??""});const d=T(!1),r=async()=>{var a,o;if((a=t.entryDetails)!=null&&a.appEntryVO&&e.value!==((o=t.entryDetails.appEntryVO)==null?void 0:o.name)){m.value=!0;try{await Ba({id:t.entryDetails.appEntryVO.id,name:e.value}),v("update:entryDetails",{...t.entryDetails,appEntryVO:{...t.entryDetails.appEntryVO,name:e.value}})}catch{e.value=t.entryDetails.appEntryVO.name}finally{m.value=!1}}d.value=!1},u=()=>{var a;(a=f.value)==null||a.blur()},_=()=>{d.value=!0,Ye(()=>{var a;(a=f.value)==null||a.focus()})};return(a,o)=>{var B;const p=Ke,y=_a,h=de,R=ya,I=ga;return g(),M(Y,null,[k("div",{class:"designer_page"},[k("div",{class:"designer-other"},[l(p,{class:"designer-back",onClick:o[0]||(o[0]=N=>v("back"))},{default:c(()=>[l(n(Ia))]),_:1}),(B=t.entryDetails)!=null&&B.appEntryVO?(g(),M("div",{key:0,class:"designer-rename"},[Q(l(Aa,{class:"ml-5 rename-input",modelValue:e.value,"onUpdate:modelValue":o[1]||(o[1]=N=>e.value=N),isBlurCache:"",placeholder:"请输入名称",onBlur:r,readonly:m.value,onKeyup:La(u,["enter"]),ref_key:"renameInputRef",ref:f,maxlength:"10",title:"重命名"},{prefix:c(()=>{var N,E,O,L;return[l(da,{iconClass:((E=(N=a.entryDetails)==null?void 0:N.appEntryVO)==null?void 0:E.icon)??"",style:Se({fontSize:"16px",color:((L=(O=a.entryDetails)==null?void 0:O.appEntryVO)==null?void 0:L.color)??""})},null,8,["iconClass","style"])]}),suffix:c(()=>[m.value?(g(),D(p,{key:0,class:"is-loading"},{default:c(()=>[l(n(wa))]),_:1})):$("",!0)]),_:1},8,["modelValue","readonly","onKeyup"]),[[ge,d.value]]),l(y,{effect:"dark",content:"重命名",placement:"bottom","show-after":200},{default:c(()=>{var N,E,O,L;return[Q(k("div",{class:"rename-display",onClick:_},[l(da,{class:"mr-7",iconClass:((E=(N=a.entryDetails)==null?void 0:N.appEntryVO)==null?void 0:E.icon)??"",style:Se({fontSize:"16px",color:((L=(O=a.entryDetails)==null?void 0:O.appEntryVO)==null?void 0:L.color)??""})},null,8,["iconClass","style"]),k("span",{class:"rename-name az-ellipsis"},G(e.value),1)],512),[[ge,!d.value]])]}),_:1})])):oe(a.$slots,"tabsName",{key:1},void 0,!0)]),k("div",{class:"designer-right"},[oe(a.$slots,"default",{},void 0,!0)])]),l(I,Sa({modelValue:n(i),"onUpdate:modelValue":o[2]||(o[2]=N=>Z(i)?i.value=N:null),class:"az_tabs-custom designer_page-tabs"},a.$attrs),{default:c(()=>[(g(!0),M(Y,null,le(a.tabs,N=>(g(),M(Y,{key:N.name},[N.show?$("",!0):(g(),D(R,{key:0,label:N.label,name:N.name},va({_:2},[N.label==="</>"?{name:"label",fn:c(()=>[l(h,{underline:!1},{icon:c(()=>[l(p,{style:{"font-size":"20px"}},{default:c(()=>[l(n(Da))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["label","name"]))],64))),128))]),_:1},16,["modelValue"])],64)}}});const Rt=K(Pt,[["__scopeId","data-v-e17e4832"]]),It="plugin_input_data_type",aa=x=>q.object===Number(x)?"对象":Ea(x,It),wt=j({__name:"MemberSelect",props:{type:{},modelValue:{}},emits:["update:modelValue"],setup(x,{emit:s}){const t=x,v=s,i=J(()=>{switch(t.type){case q.dept:return"部门列表";case q.personnel:return"部门成员列表";case q.job:return"岗位列表";case q.departmentSingle:return"部门单选列表";case q.memberSingle:return"部门成员单选列表";default:return"列表"}}),e=J(()=>{switch(t.type){case q.dept:case q.departmentSingle:return[$e.org];case q.personnel:case q.memberSingle:return[$e.memberByOrg];case q.job:return[$e.jobByOrg];default:return[]}}),m=J(()=>{switch(t.type){case q.dept:case q.departmentSingle:return[pa.org];case q.personnel:case q.memberSingle:return[pa.user];case q.job:default:return[]}}),f=ee(t,"modelValue",v),d=J(()=>t.type!==q.departmentSingle&&t.type!==q.memberSingle);return(r,u)=>(g(),D(Ma,{modelValue:n(f),"onUpdate:modelValue":u[0]||(u[0]=_=>Z(f)?f.value=_:null),"dialog-title":i.value,tabs:e.value,multiple:d.value,dynamic:m.value},null,8,["modelValue","dialog-title","tabs","multiple","dynamic"]))}}),Lt=j({__name:"UploadFile",props:{modelValue:{}},emits:["update:modelValue"],setup(x,{emit:s}){const t=x,v=s,i=T(),e=()=>{m.value="",Ye(()=>{var o;(o=i.value)==null||o.uploadFile()})},m=T(""),f=ee(t,"modelValue",v),d=J(()=>f.value?"已上传附件":"上传附件"),r=J(()=>f.value?"success":""),u=J(()=>f.value?Na:Ua),_=J(()=>!f.value),a=(o,p)=>{setTimeout(()=>{f.value=m.value,X.success("上传成功")},300)};return(o,p)=>{const y=me,h=_a,R=de;return g(),M("div",{class:"PluginUpdateFile"},[k("div",{style:{flex:"1"}},[l(h,{disabled:_.value,effect:"dark",content:"已上传文件,再次点击可重新上传",placement:"top"},{default:c(()=>[l(y,{icon:u.value,style:{width:"100%"},type:r.value,onClick:e},{default:c(()=>[U(G(d.value),1)]),_:1},8,["icon","type"])]),_:1},8,["disabled"])]),_.value?$("",!0):(g(),M("div",{key:0,class:"refresh"},[l(h,{effect:"dark",content:"重置",placement:"top"},{default:c(()=>[l(R,{underline:!1,onClick:p[0]||(p[0]=I=>f.value=""),icon:n(qa)},null,8,["icon"])]),_:1})])),k("div",{style:{display:"none"}},[l(Me,{ref_key:"AzUploadRef",ref:i,limit:1,type:"file",onUploadFinish:a,modelValue:m.value,"onUpdate:modelValue":p[1]||(p[1]=I=>m.value=I),size:1024*10,isShowTip:!1,"is-show-trigger":!1,"show-file-list":!1,accept:[]},null,8,["modelValue"])])])}}});const At=K(Lt,[["__scopeId","data-v-1e249dba"]]),Dt=j({__name:"EnterParamsDefault",props:{paramType:{},modelValue:{},placeholderKeyword:{default:"默认值"}},emits:["update:modelValue"],setup(x,{emit:s}){const t=x,i=ee(t,"modelValue",s),e=J(()=>[q.array,q.arrayObject].includes(t.paramType)?`请输入${t.placeholderKeyword},例如:[ ]`:`请输入${t.placeholderKeyword}`),m=J({get(){return Number(i.value)},set(d){i.value=d.toString()}}),f=J({get(){return i.value?JSON.parse(i.value??"[]"):[]},set(d){i.value=JSON.stringify(d)}});return(d,r)=>{const u=gt,_=Oa,a=ke;return g(),M("div",{class:"w100"},[d.paramType===n(q).number?(g(),D(u,{key:0,modelValue:m.value,"onUpdate:modelValue":r[0]||(r[0]=o=>m.value=o),style:{width:"100%"},"controls-position":"right",placeholder:"请输入数字"},null,8,["modelValue"])):d.paramType===n(q).dateTime?(g(),D(_,{key:1,modelValue:n(i),"onUpdate:modelValue":r[1]||(r[1]=o=>Z(i)?i.value=o:null),class:"date-time",type:"datetime",placeholder:"请选择日期时间",format:"YYYY/MM/DD hh:mm:ss","value-format":"YYYY-MM-DD h:m:s"},null,8,["modelValue"])):d.paramType===n(q).personnel||d.paramType===n(q).dept||d.paramType===n(q).job||d.paramType===n(q).memberSingle||d.paramType===n(q).departmentSingle?(g(),D(wt,{key:2,modelValue:f.value,"onUpdate:modelValue":r[2]||(r[2]=o=>f.value=o),type:d.paramType},null,8,["modelValue","type"])):d.paramType===n(q).annex?(g(),D(At,{key:3,modelValue:n(i),"onUpdate:modelValue":r[3]||(r[3]=o=>Z(i)?i.value=o:null)},null,8,["modelValue"])):(g(),D(a,{key:4,modelValue:n(i),"onUpdate:modelValue":r[4]||(r[4]=o=>Z(i)?i.value=o:null),placeholder:e.value},null,8,["modelValue","placeholder"]))])}}}),St=j({__name:"EnterParamsItem",props:{modelValue:{},isArrayObject:{type:Boolean}},emits:["update:modelValue","delete","add"],setup(x,{expose:s,emit:t}){const v=x,i=t,e=ee(v,"modelValue",i),m=J({get(){return e.value.paramType.toString()},set(d){e.value.paramType=Number(d)}});ie(()=>e.value.paramType,()=>{e.value.defaultValue=""});const f=T();return s({validate(){var d;return(d=f.value)==null?void 0:d.validate()}}),(d,r)=>{const u=ke,_=Ie,a=Ge,o=ba,p=de,y=we;return g(),D(y,{ref_key:"ruleFormRef",ref:f,model:n(e),class:"enterParams"},{default:c(()=>[k("div",{class:"params-item"},[k("div",{class:"name"},[oe(d.$slots,"name",{},()=>[k("div",null,[k("div",{style:Se({width:d.isArrayObject?"0":"25px",textAlign:"right"})},null,4),l(_,{rules:[{required:!0,message:"请输入,例如姓名",trigger:["change","blur"]}],prop:"name"},{default:c(()=>[l(u,{maxlength:"30",modelValue:n(e).name,"onUpdate:modelValue":r[0]||(r[0]=h=>n(e).name=h),placeholder:"请输入,例如姓名"},null,8,["modelValue"])]),_:1})])],!0)]),k("div",{class:"paramName"},[oe(d.$slots,"paramName",{},()=>[l(_,{rules:[{required:!0,message:"请输入,例如name",trigger:["change","blur"]}],prop:"paramName"},{default:c(()=>[l(u,{modelValue:n(e).paramName,"onUpdate:modelValue":r[1]||(r[1]=h=>n(e).paramName=h),maxlength:"30",placeholder:"请输入,例如name"},null,8,["modelValue"])]),_:1})],!0)]),k("div",{class:"type"},[oe(d.$slots,"type",{},()=>[l(_,null,{default:c(()=>[l(Be,{modelValue:m.value,"onUpdate:modelValue":r[2]||(r[2]=h=>m.value=h),style:{width:"100%"},placeholder:"请选择",load:"plugin_input_data_type"},{default:c(({options:h})=>[(g(!0),M(Y,null,le(h,R=>(g(),M(Y,{key:R.value},[Number(R.value)===Number(n(q).arrayObject)?(g(),M(Y,{key:0},[d.isArrayObject?(g(),D(a,{key:0,label:R.label,value:R.value},null,8,["label","value"])):$("",!0)],64)):(g(),D(a,{key:1,label:R.label,value:R.value},null,8,["label","value"]))],64))),128))]),_:1},8,["modelValue"])]),_:1})],!0)]),k("div",{class:"default"},[oe(d.$slots,"default",{},()=>[d.isArrayObject?(g(),D(_,{key:0},{default:c(()=>[l(Dt,{"param-type":n(e).paramType,disabled:d.isArrayObject,modelValue:n(e).defaultValue,"onUpdate:modelValue":r[3]||(r[3]=h=>n(e).defaultValue=h)},null,8,["param-type","disabled","modelValue"])]),_:1})):$("",!0)],!0)]),k("div",{class:"tip"},[oe(d.$slots,"tip",{},()=>[l(_,null,{default:c(()=>[l(u,{type:"textarea",modelValue:n(e).remark,"onUpdate:modelValue":r[4]||(r[4]=h=>n(e).remark=h),autosize:!0,"show-word-limit":"",maxlength:"200",placeholder:"请输入说明"},null,8,["modelValue"])]),_:1})],!0)]),k("div",{class:"operate"},[oe(d.$slots,"operate",{},()=>[l(_,null,{default:c(()=>[k("div",{class:"operate-btn"},[k("div",null,[l(o,{modelValue:n(e).visibleFlag,"onUpdate:modelValue":r[5]||(r[5]=h=>n(e).visibleFlag=h)},{default:c(()=>[U("可见")]),_:1},8,["modelValue"])]),k("div",null,[l(o,{modelValue:n(e).requiredFlag,"onUpdate:modelValue":r[6]||(r[6]=h=>n(e).requiredFlag=h)},{default:c(()=>[U("必填")]),_:1},8,["modelValue"])]),l(p,{onClick:r[7]||(r[7]=h=>i("delete")),type:"danger",underline:!1,icon:n(Fa)},null,8,["icon"]),n(e).paramType===n(q).arrayObject?(g(),D(p,{key:0,onClick:r[8]||(r[8]=h=>i("add")),type:"info",underline:!1,icon:n(We)},null,8,["icon"])):$("",!0)])]),_:1})],!0)])])]),_:3},8,["model"])}}});const Ta=K(St,[["__scopeId","data-v-45d2fbec"]]);function Je(x="param"){return"_"+x+"_"+Ee()}const Bt={name:"EnterParamsTree"},Et=j({...Bt,props:{modelValue:{},isChildren:{type:Boolean,default:!0},parentId:{}},emits:["update:list"],setup(x,{expose:s,emit:t}){const v=x,i=t,e={controlId:Je(),defaultValue:"",name:"",nodeType:"30",paramName:"",paramType:q.text,parentControlId:"",remark:"",requiredFlag:!1,subControls:[],visibleFlag:!1},m=ee(v,"modelValue",i),f=o=>{m.value.splice(o,1)},d=()=>_e({...e,controlId:Je(),parentControlId:v.parentId}),r=()=>{const o=_e({...d()});m.value.push(o)},u=o=>{const p=_e({...d()});m.value[o].subControls.push({...p})},_=T(),a=T();return s({async deepValidate(){var h,R,I;const o=Array.isArray(a.value)?(h=a.value)==null?void 0:h.map(B=>B.validate()):[(R=a.value)==null?void 0:R.validate()],p=Array.isArray(_.value)?_.value.map(B=>B==null?void 0:B.deepValidate()):[(I=_.value)==null?void 0:I.deepValidate()];return Promise.all([...o,...p])}}),(o,p)=>{const y=Ke,h=de;return g(),M("div",{class:"params-tree"},[(g(!0),M(Y,null,le(n(m),(R,I)=>(g(),M(Y,{key:I},[l(Ta,{ref_for:!0,ref_key:"enterParamsItemRef",ref:a,isArrayObject:o.isChildren,modelValue:n(m)[I],"onUpdate:modelValue":B=>n(m)[I]=B,onAdd:B=>u(I),onDelete:B=>f(I)},null,8,["isArrayObject","modelValue","onUpdate:modelValue","onAdd","onDelete"]),R.paramType===n(q).arrayObject&&R.subControls.length>=1?(g(),D(Va,{key:0,ref_for:!0,ref_key:"enterParamsTreeRef",ref:_,class:"params-tree__box",modelValue:R.subControls,"onUpdate:modelValue":B=>R.subControls=B,parentId:R.controlId,isChildren:!1,initParam:e},null,8,["modelValue","onUpdate:modelValue","parentId"])):$("",!0)],64))),128)),k("div",{style:Se({paddingLeft:o.isChildren?"0":"25px"})},[l(h,{onClick:r,type:"primary",class:"params-tree__add",underline:!1},{default:c(()=>[l(y,null,{default:c(()=>[l(n(We))]),_:1}),U(" 添加参数 ")]),_:1})],4)])}}});const Va=K(Et,[["__scopeId","data-v-8197adf6"]]),Mt=j({__name:"EnterParams",setup(x,{expose:s}){const t=te(),v={controlId:Je(),defaultValue:"",name:"",nodeType:"30",paramName:"",paramType:q.text,parentControlId:"",remark:"",requiredFlag:!1,subControls:[],visibleFlag:!1},i=T([]),e=T([]),{isLoading:m,refreshApi:f}=Ct(()=>ve.getRequestParam({apiId:t.ids.apiId??"",nodeType:"30"}).then(a=>(a.length>=1?i.value=a.map(o=>{const{id:p,...y}=o;return y}):i.value.push({...v}),e.value=ne(i.value),a))),d=T(),r=T(!1),u=async()=>{var a;await((a=d.value)==null?void 0:a.deepValidate()),r.value=!0;try{await ve.saveRequestParam({controlsList:i.value,apiId:t.ids.apiId,nodeType:"30"}),X.success("保存成功"),Ae(t.ids),f()}finally{r.value=!1}};return s({onLeave:()=>Ce(e.value,i.value)?Promise.resolve(!0):new Promise((o,p)=>{Te.confirm("您修改了表单但没有保存，是否需要保存表单并继续？","表单有修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(y,h,R){y==="confirm"?(h.confirmButtonLoading=!0,u().then(()=>{h.confirmButtonLoading=!1,o(!0),R()}).catch(()=>{h.confirmButtonLoading=!1,p(),R()})):y==="cancel"?(o(!0),R()):y==="close"&&(p(),R())}})})}),(a,o)=>{const p=me,y=Ve;return Q((g(),M("div",{class:"enter-params"},[k("div",{class:"enter-params__header"},[k("span",{class:"tip"},"设置输入参数，供表单设计调用插件时传入动态参数值"),l(p,{loading:r.value,type:"primary",onClick:u},{default:c(()=>[U(" 保存 ")]),_:1},8,["loading"])]),l(Ta,{isArrayObject:!1,modelValue:{...v}},{name:c(()=>[U("名称：")]),paramName:c(()=>[U("参数名称：")]),type:c(()=>[U("类型：")]),default:c(()=>[U("默认值：")]),tip:c(()=>[U("说明：")]),operate:c(()=>[U("  ")]),_:1},8,["modelValue"]),l(Va,{ref_key:"enterParamsTreeRef",ref:d,class:"mt-10",modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=h=>i.value=h),"parent-id":"","init-param":{...v}},null,8,["modelValue","init-param"])])),[[y,n(m)]])}}});const Nt=K(Mt,[["__scopeId","data-v-cc4877c4"]]),ue={HTTP:"1",CUSTOM:"2"},He={[ue.HTTP]:"http/https",[ue.CUSTOM]:"自定义"},ta=x=>{const s=/\$.*?-.*?\$/g,t=x.filter(v=>(s.lastIndex=0,s.test(v))).map(v=>v.match(s)).flat();return Array.from(new Set(t)).map(v=>({name:"",value:"",id:v??"",paramType:1}))},Ut=x=>{const s=te(),t=ye({testResultList:[],testBtnLoading:!1,saveLoading:!1,loading:!1,originData:null,paramsList:[],testMap:{},showTest:!1}),v=T({apiId:s.ids.apiId??"",reqClassPath:"",testMap:{},customizeType:pe.class,inputList:[]}),i=()=>{t.loading=!0,be.getCustomInfo(s.ids.apiId??"").then(r=>{r?(v.value={id:r.id,apiId:(r.apiId||s.ids.apiId)??"",reqClassPath:r.reqClassPath||"",testMap:r.testMap||{},customizeType:r.customizeType||pe.class,inputList:r.inputList||[]},t.testResultList=r.outputParamList??[],t.testMap=r.testMap,setTimeout(()=>{t.originData=ne(v.value)})):t.originData=ne(v.value)}).finally(()=>{t.loading=!1})},e=()=>{x().then(async r=>{if(r){const u=v.value.inputList;if(u.some(a=>{const o=/\$.*?-.*?\$/g;return o.lastIndex=0,o.test(a.paramValue)})){const a=u.map(o=>o.paramValue);t.paramsList=ta(a),t.showTest=!0}else m({})}})},m=async r=>{t.testBtnLoading=!0;try{const u={...v.value,testMap:r},_=await be.testCustom(u);t.testResultList=_,t.testMap=r,v.value.testMap=r,X.success("测试成功")}finally{t.testBtnLoading=!1}},f=()=>new Promise((r,u)=>{x().then(_=>{_&&(t.saveLoading=!0,be.addCustomReq(v.value).then(()=>{X.success("保存成功"),Ae(s.ids),i(),setTimeout(()=>{t.originData=ne(v.value)}),r(!0)}).finally(()=>{t.saveLoading=!1}))}).catch(_=>u(_))}),d=()=>Ce(t.originData,v.value)?Promise.resolve(!0):new Promise((u,_)=>{Te.confirm("您修改了表单但没有保存，是否需要保存表单并继续？","表单有修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(a,o,p){a==="confirm"?(o.confirmButtonLoading=!0,f().then(()=>{o.confirmButtonLoading=!1,u(!0),p()}).catch(()=>{o.confirmButtonLoading=!1,_(),p()})):a==="cancel"?(u(!0),p()):a==="close"&&(_(),p())}})});return{...Ne(t),onTestApi:e,onSaveConfig:f,requestForm:v,init:i,onLeave:d,resultCallback:m}},qt=Ut,la=j({__name:"CodeBlockTest",props:{dialogModel:{type:Boolean},testMap:{},inputList:{}},emits:["update:dialogModel","testMap"],setup(x,{emit:s}){const t=s,v=x,i=ee(v,"dialogModel",t),e=J(()=>v.inputList),m=T(),f=()=>{Ce(m.value,e.value)||(u.value=[],m.value=ne(e.value),e.value.forEach(async _=>{const a=await bt(_.id),o=v.testMap;if(a){_.name=a.pInfo.nodeName+"."+a.cInfo.name,_.paramType=a.cInfo.paramType;const p=a.cInfo.defaultValue;_.value=o?o[_.id]?o[_.id]:p??"":"",u.value.push(_)}}))},d=()=>{i.value=!1},r=async()=>{const _={};u.value.forEach(a=>{_[a.id]=a.value??""}),t("testMap",_)},u=T([]);return(_,a)=>{const o=qe,p=ke,y=Oe,h=Le;return g(),D(h,{modelValue:n(i),"onUpdate:modelValue":a[1]||(a[1]=R=>Z(i)?i.value=R:null),title:"编辑 API 测试数据",class:"custom_az_dialog",onOpen:f,onClose:d},{footer:c(()=>[l(Ue,{editMode:!0,onClose:a[0]||(a[0]=R=>i.value=!1),"on-submit":r})]),default:c(()=>[l(y,{data:u.value,style:{width:"100%"}},{default:c(()=>[l(o,{prop:"name",label:"参数名称"}),l(o,{prop:"value",label:"参数值"},{default:c(({row:R})=>[l(p,{modelValue:R.value,"onUpdate:modelValue":I=>R.value=I,placeholder:"请输入参数值"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}}}),Ot=j({__name:"CustomRequest",setup(x,{expose:s}){const{init:t,testResultList:v,testBtnLoading:i,saveLoading:e,onTestApi:m,onSaveConfig:f,requestForm:d,onLeave:r,loading:u,paramsList:_,testMap:a,showTest:o,resultCallback:p}=qt(()=>I()),y=C=>aa(C.paramType),h=T(),R=T({reqClassPath:[{required:!0,message:"实现类或者jar包不能为空",trigger:"blur"}]}),I=()=>{var C;return h.value?Promise.all([h.value.validate(),(C=w.value)==null?void 0:C.validateForm()]):Promise.resolve(!1)};t();const B={[pe.class]:"",[pe.jar]:""};let N=0;ie(()=>d.value.customizeType,(C,P)=>{N!==0&&(B[P]=d.value.reqClassPath,d.value.reqClassPath=B[C]??""),N++});const E={flex:"2 1 0%",marginRight:"20px"},O=[{type:"input",key:"paramName",placeholder:"请输入",label:"参数名称",style:{...E}},{type:"paramInput",key:"paramValue",label:"参数值",style:{...E}},{type:"delIcon",label:"",key:""}],L=T({paramValue:[{required:!0,message:"请输入参数值",trigger:"blur"}],paramName:[{required:!0,message:"请输入参数名称",trigger:"blur"}]}),w=T(),V=async()=>{await $a()};return s({onLeave:r}),(C,P)=>{const b=Ie,S=Ze,W=Qe,A=ke,F=de,H=qe,xe=Oe,fe=we,ae=me,De=Ve;return Q((g(),M("div",{class:"custom-request"},[l(fe,{ref_key:"customFormRef",ref:h,"label-width":"80",rules:R.value,model:n(d),class:"custom-form"},{default:c(()=>[l(b,{label:"请求参数"},{default:c(()=>[k("div",{class:"form-table-wrap"},[l(ce,{ref_key:"formTableRef",ref:w,list:O,"label-suffix":"：",model:n(d).inputList,"onUpdate:model":P[0]||(P[0]=z=>n(d).inputList=z),rules:L.value},null,8,["model","rules"])])]),_:1}),l(b,null,{default:c(()=>[l(W,{modelValue:n(d).customizeType,"onUpdate:modelValue":P[1]||(P[1]=z=>n(d).customizeType=z)},{default:c(()=>[l(S,{label:n(pe).class},{default:c(()=>[U("自定义类")]),_:1},8,["label"]),l(S,{label:n(pe).jar},{default:c(()=>[U("上传自定义jar包")]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),n(d).customizeType===n(pe).class?(g(),D(b,{key:0,label:"实现类",prop:"reqClassPath"},{default:c(()=>[l(A,{placeholder:"请输入实现类",modelValue:n(d).reqClassPath,"onUpdate:modelValue":P[2]||(P[2]=z=>n(d).reqClassPath=z)},null,8,["modelValue"])]),_:1})):$("",!0),n(d).customizeType===n(pe).jar?(g(),D(b,{key:1,label:"Jar包",prop:"reqClassPath"},{default:c(()=>[k("div",{class:"jar_upload-wrap"},[k("div",null,[l(F,{underline:!1,type:"primary",onClick:V},{default:c(()=>[U(" 下载JAR包模板 ")]),_:1}),U(" ，按模板规则编辑后，上传文件 ")]),l(Me,{ref:"AzUploadRef",limit:1,modelValue:n(d).reqClassPath,"onUpdate:modelValue":P[3]||(P[3]=z=>n(d).reqClassPath=z),"is-show-tip":!1,type:"file",size:1024*100,accept:["jar"],download:""},null,8,["modelValue"])])]),_:1})):$("",!0),l(b,{label:"测试结果"},{default:c(()=>[l(xe,{data:n(v),border:""},{default:c(()=>[l(H,{"show-overflow-tooltip":"",prop:"paramName",label:"参数名","min-width":"180px"}),l(H,{prop:"paramType","min-width":"180px",formatter:y,label:"类型"}),l(H,{prop:"defaultValue",label:"参考值","min-width":"180px"})]),_:1},8,["data"])]),_:1})]),_:1},8,["rules","model"]),l(ae,{type:"primary",onClick:n(m),loading:n(i)},{default:c(()=>[U(" 测试API ")]),_:1},8,["onClick","loading"]),l(ae,{type:"primary",onClick:n(f),loading:n(e)},{default:c(()=>[U(" 保存 ")]),_:1},8,["onClick","loading"]),l(la,{"input-list":n(_),testMap:n(a),"dialog-model":n(o),"onUpdate:dialogModel":P[4]||(P[4]=z=>Z(o)?o.value=z:null),onTestMap:n(p)},null,8,["input-list","testMap","dialog-model","onTestMap"])])),[[De,n(u)]])}}});const Ft=K(Ot,[["__scopeId","data-v-6c7d5647"]]),$t=x=>{const s=te(),t=T({apiId:s.ids.apiId??"",requestType:1,url:"",bodyType:1,formData:[],httpHeaderList:[],rawbinary:{value:""},testMap:{}}),v=ye({loading:!0,showTest:!1,testMap:{},paramsList:[],outputParamList:[],testBtnLoading:!1,originData:null,saveLoading:!1,apiType:s.ids.apiType??""}),i=T([{name:"",value:"",testValue:""}]),e=()=>{x().then(async u=>{if(u){const _=/\$.*?-.*?\$/g,o=t.value.bodyType===3||t.value.bodyType===4?[{value:t.value.rawbinary.value}]:t.value.formData,p=t.value.url??"",y=[...t.value.httpHeaderList||[],...o||[],{value:p}];if(y.some(R=>(_.lastIndex=0,_.test(R.value)))){const R=y.map(I=>I.value);v.paramsList=ta(R),v.showTest=!0}else m({})}})},m=async u=>{v.testBtnLoading=!0;try{const _={...t.value,testMap:u},a=await be.testHttp(_);v.outputParamList=a,v.testMap=u,t.value.testMap=u,X.success("测试成功")}finally{v.testBtnLoading=!1}},f=()=>{v.loading=!0,be.getHttpInfo(s.ids.apiId??"").then(u=>{u?(t.value={...u},v.outputParamList=u.outputParamList??[],v.testMap=u.testMap,t.value.url=u.url,setTimeout(()=>{v.originData=ne(t.value)})):v.originData=ne(t.value)}).finally(()=>{v.loading=!1})},d=()=>new Promise((u,_)=>{x().then(a=>{a&&(v.saveLoading=!0,be.save(t.value).then(()=>{X.success("保存成功"),Ae(s.ids),setTimeout(()=>{v.originData=ne(t.value)}),u(!0)}).finally(()=>{v.saveLoading=!1}))}).catch(a=>_(a))}),r=()=>Ce(v.originData,t.value)?Promise.resolve(!0):new Promise((_,a)=>{Te.confirm("您修改了表单但没有保存，是否需要保存表单并继续？","表单有修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(o,p,y){o==="confirm"?(p.confirmButtonLoading=!0,d().then(()=>{p.confirmButtonLoading=!1,_(!0),y()}).catch(()=>{p.confirmButtonLoading=!1,a(),y()})):o==="cancel"?(_(!0),y()):o==="close"&&(a(),y())}})});return{...Ne(v),testDatas:i,onTestApi:e,onSaveConfig:d,init:f,resultCallback:m,requestForm:t,onLeave:r}},jt=$t,re={FORM_DATA:1,FORM_URLENCODED:2,RAW:3,BINARY:4},zt=[{label:"form-data",value:re.FORM_DATA},{label:"x-wwww-form-urlencoded",value:re.FORM_URLENCODED},{label:"raw",value:re.RAW},{label:"binary",value:re.BINARY}],Ht=j({__name:"widgetWrap",props:{type:{},value:{}},setup(x){return(s,t)=>(g(),M("span",{"data-type":s.type,"data-value":s.value,class:"rich-widget",contenteditable:"false",role:"presentation"},[oe(s.$slots,"default",{},void 0,!0)],8,["data-type","data-value"]))}});const Jt=K(Ht,[["__scopeId","data-v-a14c4be7"]]),Yt=j({__name:"paramsView",props:{type:{},value:{}},setup(x){const s=x,t=T("success"),v=T({cName:"",pName:""});(async()=>{ht(s.value).then(m=>{v.value={...m},t.value="success"}).catch(m=>{v.value={...m},t.value="error"})})();const e=J(()=>t.value==="error"?"paramsError":"");return(m,f)=>(g(),D(Jt,{type:m.type,value:m.value},{default:c(()=>[k("div",{class:Xe(["paramsDetails",e.value])},[k("div",{class:"name"},G(v.value.pName),1),k("div",{class:"arrow1"}),k("div",{class:"arrow2"}),k("div",{class:"value"},G(v.value.cName),1)],2)]),_:1},8,["type","value"]))}});const Kt=K(Yt,[["__scopeId","data-v-dc1638bd"]]),Wt=/(\[\\n\])|\$.*?-.*?\$|.[a-zA-Z0-9\u4e00-\u9fa5]*|./g,Gt=/\\n/,Zt=/\$.*?-.*?\$/;var se=(x=>(x.at="at",x.params="params",x.text="text",x.br=`
`,x))(se||{});function Qt(x="richText"){return"_"+x+"_"+Ee()}function Xt(x){const s=ye({selection:null,selRange:null,richTextId:Qt(),richText:null,readonly:!1,placeholder:"请输入",keyword:[],eventMitt:ja()}),t=new Map,v=V=>{t.set(V.type,V.view)},i=V=>{const{readonly:C=!1,prefixId:P,keyword:b}=x??{};s.richText=V,s.readonly=C,s.keyword=b??[],v({type:se.params,view:Kt}),s.readonly||(s.richText.classList.add("comment-editor"),s.richText.setAttribute("data-placeholder",s.placeholder),s.richText.setAttribute("contenteditable","true"),s.richText.setAttribute("id",s.richTextId),s.richText.addEventListener("input",p),s.richText.addEventListener("focus",y),s.richText.addEventListener("blur",h),s.richText.onkeydown=S=>{S.keyCode===13&&(S.preventDefault(),I({type:`
`,value:`
`}))},s.richText.addEventListener("paste",R),f(s.richText))},e=()=>{const V=window.getSelection();if(!V)return;let C=V.anchorNode,P=!1;for(;C&&C.nodeType!=C.DOCUMENT_NODE;){const b=C.id;if(b&&b===s.richTextId){P=!0;break}C=C.parentNode}P&&(s.selection=V,s.selRange=V.getRangeAt(0))},m=V=>{const C=V.target;if(C){const b=C.closest(".rich-widget");b&&(d(b),_())}},f=async V=>{s.selRange=document.createRange(),s.selection=window.getSelection(),r(V)},d=V=>{var C;s.selRange&&(s.selRange=s.selRange.cloneRange(),s.selRange.setStartAfter(V),s.selRange.collapse(!0),(C=s.selection)==null||C.removeAllRanges())},r=V=>{var P,b,S;const C=V??s.richText;s.selRange&&((P=s.selRange)==null||P.selectNodeContents(C),(b=s.selRange)==null||b.collapse(!1),(S=s.selection)==null||S.removeAllRanges())},u=()=>{e()},_=async()=>{var V;s!=null&&s.selRange?(V=s.selection)==null||V.addRange(s.selRange):console.error("添加光标失败")},a=(V,C)=>{s.eventMitt.on(V,C)},o=(V,C)=>{s.eventMitt.emit(V,C)},p=V=>{const C=V.data;V.inputType==="insertText"&&s.keyword.length>=1&&s.keyword.includes(C)&&o("on:triggerKeyword",C),o("on:inputChange",C)},y=()=>{s.eventMitt.emit("on:focus")},h=()=>{s.eventMitt.emit("on:blur")},R=async V=>{e();let C;return V.clipboardData&&V.clipboardData.getData&&(C=V.clipboardData.getData("text/plain")),setTimeout(async()=>{var P;(P=s.selection)==null||P.deleteFromDocument(),C&&(await L(C)).forEach(S=>{I(S)})}),V.preventDefault(),!1},I=V=>{var A,F;e(),(A=s.selRange)==null||A.deleteContents();const C=N(V),P=document.createDocumentFragment(),b=document.createTextNode("​");C.prepend(b),C.appendChild(b);let S,W;for(;S=C.firstChild;)W=P.appendChild(S);(F=s.selRange)==null||F.insertNode(P),W?(f(W),_()):console.error(W,"最后一个子元素")},B=V=>{V.forEach(C=>{var S,W,A;const P=N(C);let b;for(;b=P.firstChild;){(S=s.richText)==null||S.appendChild(b);const F=document.createTextNode("​");(W=s.richText)==null||W.prepend(F),(A=s.richText)==null||A.appendChild(F)}s.richText&&r(s.richText)})},N=V=>{const C=document.createElement("div");if(V.type===se.params){const P=t.get(V.type);if(P){const b=l(P,{...V,onClick:m});za(b,C)}}else if(V.type===se.br){const P=document.createElement("br");C.appendChild(P)}else{const P=document.createTextNode(V.value);C.appendChild(P)}return C},E=V=>{const C=[],P=se.text;return V.forEach(b=>{const S=C[C.length-1];S&&S.type&&S.type===P&&b.type===P?S.value=S.value+b.value:C.push(b)}),C},O=async()=>{const V=s.richText;if(!V)return;const C=[];return Array.from(V.childNodes).forEach(function(P){if(P.nodeName==="#text"){let b=P.nodeValue;b&&b.length>0&&b[b.length-1].charCodeAt(0)===8203&&(b=b.slice(0,-1)),b&&C.push({type:se.text,value:b})}else if(P.nodeName==="BR")C.push({type:se.br,value:"\\n"});else if(P.nodeName==="SPAN"){const b=P.getAttribute("data-type"),S=P.getAttribute("data-value");C.push({type:b,value:S})}else console.warn("未处理的元素==>",P.nodeName)}),E(C)},L=async V=>{const C=Wt,P=V,b=[],S=Gt,W=Zt;let A;for(;(A=C.exec(P))!==null;){let H=se.text;S.test(A[0])&&(H=se.br),W.test(A[0])&&(H=se.params),b.push({type:H,value:A[0]})}return E(b)},w=V=>V.map(P=>P.value).join("");return{...Ne(s),init:i,createCursor:u,getCursor:e,insertHtml:I,doLastAddHtml:B,listToString:w,stringToList:L,getDataStructure:O,debrisMerger:E,on:a,emit:o}}const el=j({__name:"RichText",props:{modelValue:{}},emits:["update:modelValue"],setup(x,{emit:s}){const t=x,v=s,i=T(),e=Xt(),m=T(!1),f=te();Ha(async()=>{const p=await e.getDataStructure();p&&(e.listToString(p)??"")!==t.modelValue&&e.stringToList(t.modelValue).then(h=>{h.length>=1&&e.doLastAddHtml(h)})});const d=async()=>{u.value=!1;const p=await e.getDataStructure();if(p){const y=e.listToString(p)??"";v("update:modelValue",y)}},r=()=>{e.createCursor(),setTimeout(()=>{m.value=!0},300)},u=T(!1),_=()=>{u.value=!0};e.on("on:blur",je(d,300,{maxWait:1e3})),e.on("on:focus",je(_,300,{maxWait:1e3})),e.on("on:inputChange",je(d,300,{maxWait:1e3}));const a=kt(f.nodeType);ea(()=>{e.init(i.value)});const o=(p,y)=>{const h=p.id,R=y.controlId,I=`$${h}-${R}$`;e.insertHtml({type:"params",value:I}),m.value=!1};return(p,y)=>{const h=me,R=Ja,I=ha;return g(),M("div",{class:"param-rich el-input"},[k("div",{class:Xe(["richInput el-input__wrapper",u.value?"is-focus":""])},[k("div",{ref_key:"richTextRef",ref:i},null,512)],2),l(I,{visible:m.value,"onUpdate:visible":y[0]||(y[0]=B=>m.value=B),placement:"bottom",width:230,trigger:"click"},{reference:c(()=>[l(h,{onClick:r,class:"richButton",icon:n(We)},null,8,["icon"])]),default:c(()=>[k("div",{style:{height:"300px",overflow:"auto"}},[(g(!0),M(Y,null,le(n(a),(B,N)=>(g(),M(Y,{key:N},[Array.isArray(B.controls)&&B.controls.length>=1?(g(),M("div",{key:0,class:"param-rich-options__wrap"},[l(R,{"content-position":"left"},{default:c(()=>[k("div",{class:"group-name"},G(B.nodeName),1)]),_:2},1024),(g(!0),M(Y,null,le(B.controls,(E,O)=>(g(),M("div",{class:"item",onClick:L=>o(B,E),key:O},G(E.name),9,["onClick"]))),128))])):$("",!0)],64))),128))])]),_:1},8,["visible"])])}}});const al=K(el,[["__scopeId","data-v-397de11e"]]),xa=j({__name:"ParamInputBox",props:{modelValue:{}},emits:["update:modelValue"],setup(x,{emit:s}){const i=ee(x,"modelValue",s);return(e,m)=>(g(),D(al,{modelValue:n(i),"onUpdate:modelValue":m[0]||(m[0]=f=>Z(i)?i.value=f:null)},null,8,["modelValue"]))}}),tl=j({__name:"RequestBody",props:{form:{}},emits:["update:form"],setup(x,{emit:s}){const i=ee(x,"form",s),e=T(),m=[{type:"input",key:"name",label:"参数名称",placeholder:"请输入key",style:{marginRight:"20px",flex:1}},{type:"paramInput",key:"value",label:"参数值",style:{marginRight:"20px",flex:1}},{type:"input",key:"remark",placeholder:"请输入说明",label:"说明",style:{marginRight:"20px",flex:1}},{type:"delIcon",label:"",key:""}],f=ye({formDataModel:[],urlencodedModel:[],raw:"",binary:""});return ie(()=>i.value,d=>{var r,u;switch(d.bodyType){case 1:f.formDataModel=d.formData;break;case 2:f.urlencodedModel=d.formData;break;case 3:f.raw=(r=d.rawbinary)==null?void 0:r.value;break;case 4:f.binary=(u=d.rawbinary)==null?void 0:u.value;break}}),ie(()=>f,d=>{switch(i.value.bodyType){case 1:i.value.formData=d.formDataModel;break;case 2:i.value.formData=d.urlencodedModel;break;case 3:i.value.rawbinary={value:d.raw};break;case 4:i.value.rawbinary={value:d.binary};break}},{deep:!0}),(d,r)=>{const u=Ze,_=Qe;return g(),M("div",null,[l(_,{modelValue:n(i).bodyType,"onUpdate:modelValue":r[0]||(r[0]=a=>n(i).bodyType=a),class:"ml-4"},{default:c(()=>[(g(!0),M(Y,null,le(n(zt),a=>(g(),D(u,{key:a.value,label:a.value},{default:c(()=>[U(G(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),k("div",{class:"mt-10"},[Q(k("div",null,[l(ce,{list:m,"label-suffix":"：",model:f.formDataModel,"onUpdate:model":r[1]||(r[1]=a=>f.formDataModel=a)},null,8,["model"])],512),[[ge,n(i).bodyType===n(re).FORM_DATA]]),Q(k("div",null,[l(ce,{list:m,"label-suffix":"：",model:f.urlencodedModel,"onUpdate:model":r[2]||(r[2]=a=>f.urlencodedModel=a)},null,8,["model"])],512),[[ge,n(i).bodyType===n(re).FORM_URLENCODED]]),Q(k("div",{class:"raw-wrap"},[n(i).bodyType===n(re).RAW?(g(),D(xa,{key:0,modelValue:f.raw,"onUpdate:modelValue":r[3]||(r[3]=a=>f.raw=a)},null,8,["modelValue"])):$("",!0)],512),[[ge,n(i).bodyType===n(re).RAW]]),Q(k("div",null,[l(Me,{ref_key:"AzUploadRef",ref:e,limit:1,modelValue:f.binary,"onUpdate:modelValue":r[4]||(r[4]=a=>f.binary=a),type:"file",size:1024*10,isShowTip:!1,accept:[]},null,8,["modelValue"])],512),[[ge,n(i).bodyType===n(re).BINARY]])])])}}});const ll=K(tl,[["__scopeId","data-v-dca89806"]]),sl=j({__name:"RequestHeader",props:{modelValue:{}},emits:["update:modelValue"],setup(x,{expose:s,emit:t}){const e=ee(x,"modelValue",t),m=[{type:"input",key:"name",label:"参数名称",placeholder:"请输入key",style:{marginRight:"20px",flex:1}},{type:"paramInput",key:"value",label:"参数值",style:{marginRight:"20px",flex:1,minWidth:0}},{type:"input",key:"remark",placeholder:"请输入说明",label:"说明",style:{marginRight:"20px",flex:1}},{type:"delIcon",key:"",label:""}],f=T({}),d=T();return s({validHeader:()=>{var u;return(u=d.value)==null?void 0:u.validateForm()}}),(u,_)=>(g(),M("div",null,[l(ce,{ref_key:"formTableRef",ref:d,list:m,model:n(e),"onUpdate:model":_[0]||(_[0]=a=>Z(e)?e.value=a:null),"label-suffix":"：",rules:f.value},null,8,["model","rules"])]))}}),Pa=j({__name:"CodeBlockOutput",props:{outputList:{}},setup(x){const s=t=>aa(t.paramType);return(t,v)=>{const i=qe,e=Oe;return g(),D(Tt,{label:"Output对象参数列表",prop:"name"},{default:c(()=>[l(e,{data:t.outputList,border:""},{default:c(()=>[l(i,{"show-overflow-tooltip":"",prop:"paramName",label:"参数名",width:"180px"}),l(i,{prop:"paramType",width:"180px",formatter:s,label:"类型"}),l(i,{prop:"defaultValue",label:"参考值"})]),_:1},8,["data"])]),_:1})}}}),ol=j({__name:"HttpRequest",setup(x,{expose:s}){const{showTest:t,onTestApi:v,onSaveConfig:i,outputParamList:e,loading:m,init:f,paramsList:d,testMap:r,testBtnLoading:u,resultCallback:_,requestForm:a,onLeave:o,saveLoading:p}=jt(()=>h());f();const y=T(),h=()=>y.value.validate();return s({onLeave:o}),(R,I)=>{const B=Ge,N=Ie,E=Ya,O=me,L=Ka,w=we,V=ya,C=ga,P=Ve;return Q((g(),M("div",{class:"http-request"},[k("div",{class:"request-config__header"},[l(w,{ref_key:"headerFormRef",ref:y,style:{flex:"1"},model:n(a)},{default:c(()=>[l(L,{gutter:16},{default:c(()=>[l(E,{span:5},{default:c(()=>[l(N,{label:"请求方式/url:"},{default:c(()=>[l(Be,{modelValue:n(a).requestType,"onUpdate:modelValue":I[0]||(I[0]=b=>n(a).requestType=b),filterable:"",load:"REQUEST_TYPE"},{default:c(({options:b})=>[(g(!0),M(Y,null,le(b,S=>(g(),D(B,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(E,{span:19},{default:c(()=>[l(N,{prop:"url",rules:[{required:!0,message:"url不能为空",trigger:"blur"}]},{default:c(()=>[k("div",{class:"flex-center"},[n(m)?$("",!0):(g(),D(xa,{key:0,class:"url-input",modelValue:n(a).url,"onUpdate:modelValue":I[1]||(I[1]=b=>n(a).url=b),placeholder:"请输入url"},null,8,["modelValue"])),l(O,{type:"primary",onClick:n(v),loading:n(u)},{default:c(()=>[U(" 测试API ")]),_:1},8,["onClick","loading"]),l(O,{type:"primary",onClick:n(i),loading:n(p)},{default:c(()=>[U(" 保存 ")]),_:1},8,["onClick","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),l(C,{"tab-position":"left"},{default:c(()=>[l(V,{label:"header"},{default:c(()=>[l(sl,{modelValue:n(a).httpHeaderList,"onUpdate:modelValue":I[2]||(I[2]=b=>n(a).httpHeaderList=b),ref:"headerRef"},null,8,["modelValue"])]),_:1}),Number(n(a).requestType)!==2?(g(),D(V,{key:0,label:"body"},{default:c(()=>[l(ll,{form:n(a),"onUpdate:form":I[3]||(I[3]=b=>Z(a)?a.value=b:null)},null,8,["form"])]),_:1})):$("",!0),l(V,{label:"测试结果"},{default:c(()=>[l(Pa,{style:{"margin-top":"unset"},"output-list":n(e)},null,8,["output-list"])]),_:1})]),_:1}),l(la,{"input-list":n(d),testMap:n(r),"dialog-model":n(t),"onUpdate:dialogModel":I[4]||(I[4]=b=>Z(t)?t.value=b:null),onTestMap:n(_)},null,8,["input-list","testMap","dialog-model","onTestMap"])])),[[P,n(m)]])}}});const nl=K(ol,[["__scopeId","data-v-8a7dcbe3"]]),rl=j({__name:"RequestConfig",setup(x,{expose:s}){const v=te().ids.apiType??"",i=T(),e=T();return s({onLeave:async()=>{var f,d;v==ue.HTTP?await((f=i.value)==null?void 0:f.onLeave()):v==ue.CUSTOM&&await((d=e.value)==null?void 0:d.onLeave())}}),(f,d)=>(g(),M("div",{class:"request-config"},[n(v)==n(ue).HTTP?(g(),D(nl,{key:0,ref_key:"httpRequestRef",ref:i},null,512)):$("",!0),n(v)==n(ue).CUSTOM?(g(),D(Ft,{key:1,ref_key:"customRequestRef",ref:e},null,512)):$("",!0)]))}}),ul=j({__name:"AzCheckboxGroup",props:{load:{type:[String,Symbol,Function,Array]},modelValue:{},checkAll:{type:Boolean},defaultCheckAll:{type:Boolean}},emits:["update:modelValue","loadFinish"],setup(x,{emit:s}){const t=x,v=s,i=J({set(o){v("update:modelValue",o??null)},get(){if(t.modelValue==null)return[];if(e.value!=="success")return[];let o=t.modelValue;return typeof t.load=="string"&&(o=o.map(p=>typeof p=="number"?String(p):p)),o}}),{state:e,options:m,refresh:f}=Wa(t,v),d=J(()=>{var o;return e.value==="loading"?"选项数据正在加载中...":e.value==="fail"?"选项数据加载失败":(o=m.value)!=null&&o.length?"":"暂无数据"}),r=T(!1),u=T(!1),_=o=>{v("update:modelValue",o?m.value.map(p=>p.value):[]),u.value=!1},a=o=>{if(!t.checkAll)return;const p=o.length;r.value=p===m.value.length,u.value=p>0&&p<m.value.length};return ie(()=>e.value,o=>{o==="success"&&(t.defaultCheckAll&&m.value?(r.value=!0,_(r.value)):a(i.value??[]))}),(o,p)=>{var R;const y=ba,h=de;return g(),M(Y,null,[o.checkAll&&((R=n(m))!=null&&R.length)?(g(),D(y,{key:0,modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=I=>r.value=I),indeterminate:u.value,onChange:_,style:{"margin-right":"30px"}},{default:c(()=>[U(" 全部 ")]),_:1},8,["modelValue","indeterminate"])):$("",!0),l(n(Ga),{modelValue:i.value,"onUpdate:modelValue":p[1]||(p[1]=I=>i.value=I),onChange:a},va({_:2},[n(e)==="success"?{name:"default",fn:c(()=>[oe(o.$slots,"default",{options:n(m)},()=>[(g(!0),M(Y,null,le(n(m),I=>(g(),D(y,{key:I.value,label:I.value},{default:c(()=>[U(G(I.label),1)]),_:2},1032,["label"]))),128))])]),key:"0"}:void 0]),1032,["modelValue"]),k("span",{style:{color:"var(--az-font-color-999)"}},[U(G(d.value)+" ",1),n(e)==="fail"?(g(),D(h,{key:0,underline:!1,type:"primary",onClick:n(f)},{default:c(()=>[U(" 刷新 ")]),_:1},8,["onClick"])):$("",!0)])],64)}}}),Ra=j({__name:"ReleaseDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","confirm"],setup(x,{emit:s}){const t=te(),v=x,i=s,e={version:[{required:!0,message:"版本号不能为空",trigger:"blur"}],appScenarios:[{required:!0,message:"请选择应用场景",trigger:"change"}]},m=T({releaseRemark:"",id:t.ids.apiId,version:"",appScenarios:""}),f=ee(v,"visible",i),d=T(),r=async()=>{var y;await((y=d.value)==null?void 0:y.validate()),await Pe.release(m.value),X({type:"success",message:"发布成功"}),setTimeout(()=>{t.version=m.value.version,t.appScenarios=m.value.appScenarios},1e3),i("confirm")},u=J(()=>t.version),_=T(0),a=y=>{_.value=y.length??0},o=J(()=>!t.appScenarios||t.appScenarios.includes("0")),p=J({set(y){y.length===_.value&&(y=[...new Set([ca.All,...y])]),m.value.appScenarios=y.join(",")},get(){return m.value.appScenarios?m.value.appScenarios.split(",").filter(y=>y!==ca.All):[]}});return ie(()=>f.value,y=>{y&&(m.value.releaseRemark="",m.value.version="",m.value.appScenarios=t.appScenarios,t.appScenarios)},{immediate:!0}),(y,h)=>{const R=Ie,I=ke,B=we,N=Le;return g(),D(N,{modelValue:n(f),"onUpdate:modelValue":h[4]||(h[4]=E=>Z(f)?f.value=E:null),title:"发布"},{footer:c(()=>[l(Ue,{editMode:!0,onClose:h[3]||(h[3]=E=>f.value=!1),"on-submit":r})]),default:c(()=>[l(B,{rules:e,model:m.value,ref_key:"ruleFormRef",ref:d,"label-suffix":"：","label-width":u.value?120:100},{default:c(()=>[u.value?(g(),D(R,{key:0,label:"当前版本"},{default:c(()=>[U(G(u.value),1)]),_:1})):$("",!0),l(R,{label:`发布${u.value?"新":""}版本`,prop:"version"},{default:c(()=>[l(I,{placeholder:"请输入版本号",modelValue:m.value.version,"onUpdate:modelValue":h[0]||(h[0]=E=>m.value.version=E)},null,8,["modelValue"])]),_:1},8,["label"]),l(R,{label:"应用场景",prop:"appScenarios"},{default:c(()=>[l(ul,{modelValue:p.value,"onUpdate:modelValue":h[1]||(h[1]=E=>p.value=E),load:n(Za),onLoadFinish:a,"check-all":"",defaultCheckAll:o.value},null,8,["modelValue","load","defaultCheckAll"])]),_:1}),l(R,{label:`${u.value?"更新":""}说明`},{default:c(()=>[l(I,{placeholder:"请输入说明",type:"textarea",autosize:{minRows:3},modelValue:m.value.releaseRemark,"onUpdate:modelValue":h[2]||(h[2]=E=>m.value.releaseRemark=E)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","label-width"])]),_:1},8,["modelValue"])}}}),il=j({__name:"JsonParseDialog",props:{visible:{type:Boolean,default:!1},jsonSource:{}},emits:["update:visible","addParams"],setup(x,{emit:s}){const t=te(),v=T([]),i=x,e=s,m=ee(i,"visible",e),f=T(!1),d=async()=>{f.value=!0;try{const a=await Pe.getJsonPrase({apiId:t.ids.apiId??"",nodeType:i.jsonSource+""});v.value=a}finally{f.value=!1}},r=()=>{d()},u=a=>{const o=Number(a.paramType);return aa(o)},_=a=>{var o;if(a.paramType===q.arrayObject){const p=(o=a.subControls)==null?void 0:o.map(y=>{const{subControls:h,...R}=y;return{...y.paramType===q.object||y.paramType===q.arrayObject?{...R,subControls:[],paramType:q.text}:y,jsonPath:"@."+y.paramName}});e("addParams",{...a,subControls:p??[]})}else if(a.paramType===q.object){const{subControls:p,...y}=a;e("addParams",{...y,subControls:[],paramType:q.text})}else e("addParams",{...a})};return(a,o)=>{const p=qe,y=de,h=Oe,R=Le,I=Ve;return g(),D(R,{onOpen:r,modelValue:n(m),"onUpdate:modelValue":o[0]||(o[0]=B=>Z(m)?m.value=B:null),title:"JSON解析结果",width:"1100"},{default:c(()=>[Q((g(),D(h,{data:v.value,style:{width:"100%"},"row-key":"id",height:"50vh","tree-props":{children:"subControls"},"row-class-name":"jsonPath__table--hover","default-expand-all":""},{default:c(()=>[l(p,{prop:"name",label:"参数名",width:"270",showOverflowTooltip:""}),l(p,{width:"270",prop:"paramName",label:"参考值",showOverflowTooltip:""}),l(p,{prop:"paramType",label:"类型",formatter:u,width:"100"}),l(p,{prop:"jsonPath",label:"JSON Path"},{default:c(({row:B})=>[k("div",{class:"jsonPath"},[k("span",null,G(B.jsonPath),1),l(y,{onClick:N=>_(B),class:"jsonPath__button",type:"primary",underline:!1},{default:c(()=>[U(" 添加至输出参数 ")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[I,f.value]])]),_:1},8,["modelValue"])}}});const dl=K(il,[["__scopeId","data-v-908a55df"]]),pl=()=>{const x=te(),s=T({apiId:x.ids.apiId??"",errorConfig:{errorMsgList:[],validationField:""},outputs:[],enableFlag:1}),t=ye({JsonPraseResult:[],originData:null,saveLoading:!1}),v=async()=>{const r=await Pe.get(x.ids.apiId??"");s.value=r,s.value.outputs||(s.value.outputs=[]),s.value.errorConfig.errorMsgList||(s.value.errorConfig.errorMsgList=[]),setTimeout(()=>{t.originData=ne(s.value)})},i=()=>new Promise((r,u)=>{Pe.getJsonPrase({apiId:x.ids.apiId??"",nodeType:"50",current:0,limit:100}).then(_=>{t.JsonPraseResult=_,r(_)}).catch(_=>{u(_)})}),e=async()=>{t.saveLoading=!0;const r=s.value.outputs.filter(u=>{var _;return u.name&&(u.subControls=(_=u.subControls)==null?void 0:_.filter(a=>a.name)),!!u.name});s.value.outputs=Array.isArray(r)?r:[],await Pe.save(s.value),t.saveLoading=!1,X({type:"success",message:"保存成功"}),v()},m=r=>{const u=r.paramName,_=s.value.outputs;r.paramType===q.arrayObject?s.value.outputs.push(r):_.some(o=>o.paramName===u)?_.push({...r,paramName:r.paramName+ka(),controlId:r.controlId+"_"+Ee()}):_.push({...r,controlId:r.controlId+"_"+Ee()})},f=()=>Ce(t.originData,s.value)?Promise.resolve(!0):new Promise((u,_)=>{Te.confirm("您修改了表单但没有保存，是否需要保存表单并继续？","表单有修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(a,o,p){a==="confirm"?(o.confirmButtonLoading=!0,e().then(()=>{o.confirmButtonLoading=!1,u(!0),p()}).catch(()=>{o.confirmButtonLoading=!1,_(),p()})):a==="cancel"?(u(!0),p()):a==="close"&&(_(),p())}})}),d=async()=>(await Qa(x.ids.apiId??"")).map(u=>({label:u.nodeName,value:u.nodeType}));return{...Ne(t),queryOutput:v,queryJsonPrase:i,onSave:e,outPutInfo:s,onLeave:f,onAddParams:m,getSourceType:d}},cl=pl,ml=j({__name:"OutputParams",emits:["confirm"],setup(x,{expose:s,emit:t}){const v=t,{queryOutput:i,outPutInfo:e,queryJsonPrase:m,onLeave:f,onAddParams:d,onSave:r,saveLoading:u,getSourceType:_}=cl(),a=T(!1),o=T(!1),p=T(),y=async L=>{let w=null;return function V(C){let P=0;const b=C.length;for(P;P<b;P++){const S=C[P];S.controlId===L&&(w={info:S,siblingList:C}),Array.isArray(S.subControls)&&V(S.subControls)}}(e.value.outputs),w},h=async({row:L})=>{const w=L.controlId,V=L.paramName,C=await y(w);C&&C.siblingList.some(b=>b.controlId!==w&&b.paramName===V)&&(C.info.paramName+=ka())},R=ye({paramName:[{required:!0,message:"请输入参数名",trigger:"blur"}],paramType:[{required:!0,message:"请选择类型",trigger:"blur"}],jsonPath:[{required:!0,message:"请输入JSON Path",trigger:"blur"}]}),I=[{type:"input",key:"name",label:"名称",placeholder:"请输入名称",style:{marginRight:"20px",flex:1}},{type:"input",key:"paramName",label:"参数名",placeholder:"请输入参数名",style:{marginRight:"20px",flex:1},on:{handleBlur:L=>h(L)}},{type:"select",key:"paramType",label:"类型",placeholder:"请选择类型",load:"plugin_input_data_type",style:{marginRight:"20px",flex:1},on:{selectChange:L=>{var w;L.selectValue==q.arrayObject?(w=p.value)==null||w.handleSubAdd(L.controlId):p.value&&p.value.deleteSub(L.controlId)}}},{type:"input",key:"jsonPath",placeholder:"请输入json path",label:"json path",style:{marginRight:"20px",flex:1}},{type:"delIcon",label:"",key:""}],B=[{type:"input",key:"errorCode",label:"状态码：",placeholder:"请输入状态码",style:{marginRight:"20px",flex:1}},{type:"input",key:"message",label:"提示信息：",placeholder:"请输入提示信息",style:{marginRight:"20px",flex:2}},{type:"delIcon",label:"",key:""}],N=()=>m();i();const E=async()=>{var L;await((L=p.value)==null?void 0:L.validateForm()),await r()},O={};return ie(()=>e.value.jsonSource,(L,w)=>{w&&L&&(O[w]=e.value.outputs,e.value.outputs=O[L]??[])}),s({onLeave:f}),(L,w)=>{const V=me,C=Ge,P=Xa;return g(),M("div",{class:"output-params"},[k("div",{class:"output-params__header"},[k("span",{class:"tip"}," 设置输出参数，供表单设计调用插件时把输出参数赋值给表单控件 "),k("div",null,[l(V,{type:"primary",onClick:E,loading:n(u)},{default:c(()=>[U(" 保存 ")]),_:1},8,["loading"]),l(V,{type:"primary",onClick:w[0]||(w[0]=b=>o.value=!0)},{default:c(()=>[U(" 发布 ")]),_:1})])]),k("div",{class:"item flex-center mb-10"},[k("div",{class:"item-title"},"选择JSON来源："),l(Be,{modelValue:n(e).jsonSource,"onUpdate:modelValue":w[1]||(w[1]=b=>n(e).jsonSource=b),style:{width:"200px"},placeholder:"选择JSON来源",load:n(_)},{default:c(({options:b})=>[(g(!0),M(Y,null,le(b,S=>(g(),D(C,{key:S.value,label:S.label,value:S.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","load"])]),k("div",{class:"item flex-center mb-30"},[k("div",{class:"item-title"},"根据JSON返回结果自动赋值："),l(V,{link:"",type:"primary",onClick:w[2]||(w[2]=b=>a.value=!0)},{default:c(()=>[U(" 查看JSON解析结果 ")]),_:1})]),k("div",{class:"item"},[k("div",{class:"item-title mb-10"},"输出参数规则"),l(ce,{ref_key:"outputRef",ref:p,rules:R,list:I,model:n(e).outputs,"onUpdate:model":w[3]||(w[3]=b=>n(e).outputs=b),"is-empty":!1,"label-suffix":"：",subFiled:"subControls"},null,8,["rules","model"])]),k("div",{class:"item"},[k("div",{class:"item-title mb-10"},[U(" 错误消息自定义： "),l(P,{modelValue:n(e).enableFlag,"onUpdate:modelValue":w[4]||(w[4]=b=>n(e).enableFlag=b),"active-value":0,"inactive-value":1},null,8,["modelValue"])]),n(e).enableFlag!==1?(g(),M(Y,{key:0},[k("div",{class:"item-sub"},[k("span",{class:"sub-title"},"提示信息参数："),l(Be,{modelValue:n(e).errorConfig.validationField,"onUpdate:modelValue":w[5]||(w[5]=b=>n(e).errorConfig.validationField=b),style:{width:"200px"},placeholder:"请选择提示信息参数",load:N},{default:c(({options:b})=>[(g(!0),M(Y,null,le(b,S=>(g(),D(C,{key:S.id,label:S.paramName,value:S.paramName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),k("div",{class:"item-sub"},[k("span",{class:"sub-title"},"自定义提示信息："),k("div",{class:"flex1"},[l(ce,{class:"tip_form-table",list:B,model:n(e).errorConfig.errorMsgList,"onUpdate:model":w[6]||(w[6]=b=>n(e).errorConfig.errorMsgList=b),addText:"添加提示"},null,8,["model"])])])],64)):$("",!0)]),l(dl,{visible:a.value,"onUpdate:visible":w[7]||(w[7]=b=>a.value=b),jsonSource:n(e).jsonSource,onAddParams:n(d)},null,8,["visible","jsonSource","onAddParams"]),l(Ra,{onConfirm:w[8]||(w[8]=b=>v("confirm")),visible:o.value,"onUpdate:visible":w[9]||(w[9]=b=>o.value=b)},null,8,["visible"])])}}});const fl=j({__name:"CodeBlockEmpty",emits:["handleClick"],setup(x,{emit:s}){const t=s;return(v,i)=>{const e=de;return g(),M("div",{class:"empty"},[U(" 输入的参数格式或数据不符合要求？可 "),l(e,{type:"primary",onClick:i[0]||(i[0]=m=>t("handleClick"))},{default:c(()=>[U("插入代码块")]),_:1}),U(" 进行处理后传递给插件请求参数 ")])}}});const vl=K(fl,[["__scopeId","data-v-342b3e6b"]]),_l=j({__name:"CodeBlockBase",props:{modelValue:{}},emits:["update:modelValue"],setup(x,{expose:s,emit:t}){const e=ee(x,"modelValue",t),m=()=>{e.value.push({dataHandle:1,outputParam:"",paramName:"",paramValue:""})};ea(()=>{e.value.length<=0&&m()});const f={flex:"2 1 0%",marginRight:"20px"},d=async()=>(await et("DATA_HANDLE")).map(y=>(y.value=Number(y.value),y)),r=[{type:"paramInput",key:"paramValue",label:"参数值",style:{...f}},{type:"select",key:"dataHandle",label:"数据处理",placeholder:"请选择数据处理",load:d,style:{...f}},{type:"input",key:"outputParam",placeholder:"请输入",label:"输出参数",style:{...f}},{type:"delIcon",label:"",key:""}],_=T({paramValue:[{required:!0,message:"请输入参数名称",trigger:"blur"}],dataHandle:[{required:!0,message:"请选择数据处理",trigger:"blur"}],outputParam:[{required:!0,message:"请输入输出参数",trigger:"blur"},{validator:(p,y,h)=>{e.value.filter(I=>I.outputParam===y).length>=2?h(new Error):h()},message:"当前输出参数已存在",trigger:["blur","change"]}]}),a=T();return s({validHeader:()=>a.value.validateForm()}),(p,y)=>(g(),M("div",{class:"mt-30"},[l(ce,{ref_key:"formTableRef",ref:a,list:r,"label-suffix":"：",model:n(e),"onUpdate:model":y[0]||(y[0]=h=>Z(e)?e.value=h:null),rules:_.value},null,8,["model","rules"])]))}});const yl=K(_l,[["__scopeId","data-v-2987c592"]]),gl=j({__name:"CodeBlockParam",props:{modelValue:{}},emits:["update:modelValue"],setup(x,{expose:s,emit:t}){const e=ee(x,"modelValue",t),m=()=>{e.value.push({dataHandle:1,outputParam:"",paramName:"",paramValue:""})};ea(()=>{e.value.length<=0&&m()});const f={flex:"2 1 0%",marginRight:"20px"},d=[{type:"input",key:"paramName",placeholder:"请输入",label:"参数名称",style:{...f}},{type:"paramInput",key:"paramValue",label:"参数值",style:{...f}},{type:"delIcon",label:"",key:""}],r=T({paramValue:[{required:!0,message:"请输入参数值",trigger:"blur"}],paramName:[{required:!0,message:"请输入参数名称",trigger:"blur"}]}),u=T();return s({validHeader:()=>u.value.validateForm()}),(a,o)=>(g(),M("div",{class:"mt-30"},[l(ce,{ref_key:"formTableRef",ref:u,list:d,"label-suffix":"：",model:n(e),"onUpdate:model":o[0]||(o[0]=p=>Z(e)?e.value=p:null),rules:r.value},null,8,["model","rules"])]))}});const bl=K(gl,[["__scopeId","data-v-1b9c01db"]]),hl=j({__name:"CodeBlock",props:{blockPosition:{}},setup(x,{expose:s}){const t=x,v=te(),i={apiId:v.ids.apiId,block:"",blockPosition:t.blockPosition,blockType:v.nodeType===Re.BLOCK_PARAM_BEFORE?4:2,dataBasedirPath:"",inputList:[],outputList:[],testMap:{}},e=T({...i}),m=T({...i}),f=T(!1),d=T(),r=T(!1),u=async()=>{var L;e.value,await((L=d.value)==null?void 0:L.validHeader()),r.value=!0;try{await ve.saveCodeBlock(e.value),X.success("保存成功"),h(),Ae(v.ids)}finally{r.value=!1}},_=T(!1),a=T(!1),o=T([]),p=async()=>{var V;await((V=d.value)==null?void 0:V.validHeader());const L=e.value.inputList;if(L.some(C=>{const P=/\$.*?-.*?\$/g;return P.lastIndex=0,P.test(C.paramValue)})){const C=L.map(P=>P.paramValue);o.value=ta(C),a.value=!0}else{const C={...e.value},P=await ve.testCodeblock(C);N.value=P,X.success("测试成功")}},y=T(!1),h=async()=>{y.value=!0;try{const L=await ve.getBlockInfo({apiId:v.ids.apiId,blockPosition:t.blockPosition});L?(e.value={...L},N.value=L.outputList,f.value=!0):(f.value=!1,N.value=[]),setTimeout(()=>{m.value=ne(e.value)})}catch{f.value=!1}finally{y.value=!1}};h();const R=()=>{e.value=_e({...i}),f.value=!0},I=L=>{},B=async()=>{const L=e.value.id??"";L?(await ve.deleteCodeBlock(L),X.success("删除成功"),h()):(f.value=!1,e.value=_e({...i}))},N=T([]),E=async L=>{const w={...e.value,testMap:L},V=await ve.testCodeblock(w);N.value=V,e.value.testMap=L,X.success("测试成功")};return s({onLeave:()=>Ce(m.value,e.value)?Promise.resolve(!0):new Promise((w,V)=>{Te.confirm("您修改了表单但没有保存，是否需要保存表单并继续？","表单有修改，是否保存?",{confirmButtonText:"保存并继续",cancelButtonText:"不保存",type:"warning",distinguishCancelAndClose:!0,closeOnClickModal:!1,closeOnHashChange:!1,beforeClose(C,P,b){C==="confirm"?(P.confirmButtonLoading=!0,u().then(()=>{P.confirmButtonLoading=!1,w(!0),b()}).catch(()=>{P.confirmButtonLoading=!1,V(),b()})):C==="cancel"?(w(!0),b()):C==="close"&&(b(),V())}})})}),(L,w)=>{const V=Ze,C=Qe,P=me,b=de,S=tt,W=Ve;return f.value?Q((g(),M("div",{key:0},[k("div",{class:"codeBlock-header"},[l(C,{modelValue:e.value.blockType,"onUpdate:modelValue":w[0]||(w[0]=A=>e.value.blockType=A),onChange:I},{default:c(()=>[l(V,{label:2},{default:c(()=>[U("使用Javascript语言")]),_:1}),n(v).nodeType===n(Re).BLOCK_PARAM_BEFORE?(g(),D(V,{key:0,label:4},{default:c(()=>[U(" 从代码库中选择 ")]),_:1})):$("",!0)]),_:1},8,["modelValue"]),k("div",null,[l(P,{loading:_.value,onClick:p},{default:c(()=>[U("测试")]),_:1},8,["loading"]),l(P,{type:"primary",loading:r.value,onClick:u},{default:c(()=>[U(" 保存 ")]),_:1},8,["loading"]),l(S,{title:"您确定要删除当前代码块吗?",onConfirm:B},{reference:c(()=>[l(b,{class:"ml-12",underline:!1,type:"danger"},{default:c(()=>[U(" 删除 ")]),_:1})]),_:1})])]),e.value.blockType===4?(g(),D(yl,{key:0,ref_key:"codeBlockBaseRef",ref:d,modelValue:e.value.inputList,"onUpdate:modelValue":w[1]||(w[1]=A=>e.value.inputList=A)},null,8,["modelValue"])):(g(),M(Y,{key:1},[l(bl,{ref_key:"codeBlockBaseRef",ref:d,modelValue:e.value.inputList,"onUpdate:modelValue":w[2]||(w[2]=A=>e.value.inputList=A)},null,8,["modelValue"]),l(Vt,{codeType:e.value.blockType,modelValue:e.value.block,"onUpdate:modelValue":w[3]||(w[3]=A=>e.value.block=A),businessType:n(at).plugin},null,8,["codeType","modelValue","businessType"])],64)),l(Pa,{outputList:N.value},null,8,["outputList"]),l(la,{"input-list":o.value,testMap:e.value.testMap,"dialog-model":a.value,"onUpdate:dialogModel":w[4]||(w[4]=A=>a.value=A),onTestMap:E},null,8,["input-list","testMap","dialog-model"])])),[[W,y.value]]):Q((g(),D(vl,{key:1,onHandleClick:R},null,512)),[[W,y.value]])}}});const fa=K(hl,[["__scopeId","data-v-cab9bf05"]]),kl=j({__name:"EditName",props:{apiId:{}},emits:["confirm"],setup(x,{emit:s}){const t=x,v=s,i=te(),e=T({name:"未命名api",remark:"",id:""}),m=T({name:"未命名api",remark:"",id:""}),f=T(!1),d=T(),r=ye({name:[{required:!0,message:"请输入API名称",trigger:"blur"},{min:3,max:15,message:"长度为3-15个字符之间",trigger:"blur"}]}),u=async()=>{var p;await((p=d.value)==null?void 0:p.validate()),await he.updateApi(e.value),X.success("修改成功"),v("confirm"),o(t.apiId)},_=()=>{e.value={...m.value}},a=T(!1),o=async p=>{a.value=!0;try{const y=await he.getById(p);m.value={name:y.name,remark:y.remark,id:y.id},i.version=y.version,i.appScenarios=y.appScenarios??""}finally{a.value=!1}};return o(t.apiId),(p,y)=>{const h=Ke,R=ke,I=Ie,B=we,N=ha,E=Ve;return g(),D(N,{visible:f.value,"onUpdate:visible":y[3]||(y[3]=O=>f.value=O),placement:"bottom",width:400,onShow:_,trigger:"click"},{reference:c(()=>[Q((g(),M("div",{class:"editName"},[k("span",{class:"icon"},[l(h,null,{default:c(()=>[l(n(lt))]),_:1})]),k("span",{class:"title"},G(m.value.name),1)])),[[E,a.value]])]),default:c(()=>[Q((g(),D(B,{ref_key:"ruleFormRef",ref:d,model:e.value,rules:r,"label-width":"80px","status-icon":""},{default:c(()=>[l(I,{label:"API名称",prop:"name"},{default:c(()=>[l(R,{placeholder:"请输入API名称",modelValue:e.value.name,"onUpdate:modelValue":y[0]||(y[0]=O=>e.value.name=O)},null,8,["modelValue"])]),_:1}),l(I,{label:"描述"},{default:c(()=>[l(R,{placeholder:"请输入API描述",type:"textarea",modelValue:e.value.remark,"onUpdate:modelValue":y[1]||(y[1]=O=>e.value.remark=O)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[E,a.value]]),l(Ue,{"edit-mode":"",onClose:y[2]||(y[2]=O=>f.value=!1),"on-submit":u})]),_:1},8,["visible"])}}});const Cl=K(kl,[["__scopeId","data-v-bd247602"]]),Tl=j({__name:"pluginConfig",props:{dialogModel:{type:Boolean},ids:{}},emits:["update:dialogModel","refresh"],setup(x,{emit:s}){const t=s,v=x,i=te(),e=ee(v,"dialogModel",t),m=T(),f=J(()=>{var E;return((E=v.ids)==null?void 0:E.apiType)=="2"}),d=[{label:"输入参数",name:"1"},{label:"</>",name:"2",show:f},{label:"请求配置",name:"3"},{label:"</>",name:"4",show:f},{label:"输出参数",name:"5"}],r=()=>{e.value=!1,o.value=!1,_.value=_e(d)},u=T("1"),_=T([]),a=async()=>{_.value=_e(d),u.value="1",Ye(()=>{o.value=!0}),Ae({...v.ids}),i.ids={...v.ids}},o=T(!0),p=()=>{t("refresh")};ie(()=>u.value,()=>{if(u.value==="2"||u.value==="4"){const E=_.value.find(O=>O.name===u.value);E&&(u.value==="2"?E.label="前置处理(可选)":u.value==="4"?E.label="后置处理(可选)":E.label="</InstanceType>")}switch(u.value){case"2":i.nodeType=Re.BLOCK_PARAM_BEFORE;break;case"3":i.nodeType=Re.API_REQUEST_PARAM;break;case"4":i.nodeType=Re.BLOCK_PARAM_AFTER;break}});const y=J(()=>u.value==="2"?40:60),h=T(),R=T(),I=T(),B=T(),N=async(E,O)=>{const w=[m.value,h.value,R.value,I.value,B.value][parseInt(O)-1];return w?await(w==null?void 0:w.onLeave()):!0};return(E,O)=>(g(),M("div",{class:"p-config"},[l(st,{size:"90%",modelValue:n(e),"onUpdate:modelValue":O[2]||(O[2]=L=>Z(e)?e.value=L:null),"with-header":!1,direction:"btt","show-load":a,onClose:r},{default:c(()=>[l(Rt,{class:"tabs__header",modelValue:u.value,"onUpdate:modelValue":O[0]||(O[0]=L=>u.value=L),onBack:O[1]||(O[1]=L=>e.value=!1),tabs:_.value,"before-leave":N},{tabsName:c(()=>[o.value?(g(),D(Cl,{key:0,apiId:E.ids.apiId,onConfirm:p},null,8,["apiId"])):$("",!0)]),_:1},8,["modelValue","tabs"]),k("div",{class:"p-config__body"},[k("div",{class:"in_wrapper"},[u.value==="1"?(g(),D(Nt,{key:0,ref_key:"enterParamsRef",ref:m},null,512)):$("",!0),u.value==="2"?(g(),D(fa,{key:1,ref_key:"preCodeBlockRef",ref:h,blockPosition:y.value},null,8,["blockPosition"])):$("",!0),u.value==="3"?(g(),D(rl,{key:2,ref_key:"requestConfigRef",ref:R},null,512)):$("",!0),u.value==="4"?(g(),D(fa,{key:3,ref_key:"afterCodeBlockRef",ref:I,blockPosition:y.value},null,8,["blockPosition"])):$("",!0),u.value==="5"?(g(),D(ml,{key:4,onConfirm:p,ref_key:"outputParamsRef",ref:B},null,512)):$("",!0)])])]),_:1},8,["modelValue"])]))}});const Vl=K(Tl,[["__scopeId","data-v-480cf7a7"]]),xl=j({__name:"CardSelect",props:{visible:{type:Boolean}},emits:["update:visible","confirm"],setup(x,{emit:s}){const t=x,v=s,i=Ca(),e=ee(t,"visible",v),m=[{label:"HTTP/HTTPS",value:ue.HTTP},{label:"自定义",value:ue.CUSTOM}],f=T(ue.HTTP),d=u=>{f.value=u},r=()=>he.addApi({apiType:f.value,name:"未命名API",applicationId:typeof i.query.id=="string"?i.query.id:"",remark:""}).then(u=>{v("confirm",{id:u.id,apiType:f.value,applicationId:u.applicationId})});return(u,_)=>{const a=ot,o=Le;return g(),D(o,{modelValue:n(e),"onUpdate:modelValue":_[1]||(_[1]=p=>Z(e)?e.value=p:null),title:"选择API类型",width:"600px"},{footer:c(()=>[k("div",{class:"plugin_api_footer"},[l(Ue,{editMode:!0,onClose:_[0]||(_[0]=p=>e.value=!1),"on-submit":r})])]),default:c(()=>[k("div",{class:"card_list"},[(g(),M(Y,null,le(m,(p,y)=>l(a,{key:y,class:Xe(["card",{selected:p.value==f.value}]),shadow:"hover",onClick:h=>d(p.value)},{default:c(()=>[U(G(p.label),1)]),_:2},1032,["class","onClick"])),64))])]),_:1},8,["modelValue"])}}});const Pl=K(xl,[["__scopeId","data-v-65c20579"]]),Rl=j({__name:"routePage",props:{id:{}},setup(x,{expose:s}){const t=te(),v=x,i=J(()=>!!v.id),e=T(),m=Ca(),f=T(),d=i.value?v.id??"":typeof m.query.id=="string"?m.query.id:"",r=async()=>{const A=await it.getById(d);return f.value=A,R.value=A,A.apiList},u=[{type:"selection"},{prop:"name",label:"API名称"},{prop:"remark",minWidth:150,label:"描述",showOverflowTooltip:!0},{prop:"version",label:"版本号"},{prop:"version",label:"API类型",slots:{default({row:A}){return l("span",null,[(He==null?void 0:He[A.apiType||""])||"-"])}}},{prop:"apiStatus",label:"状态",slots:{default({row:A}){return l(_t,{disabled:i.value,modelValue:A.status,tip:"禁用后此API将不可用。确定要禁用？",updateFetch:async()=>{await he.updateStatus((A==null?void 0:A.id)||""),p()}},null)}}}],_=[{fixed:"right",width:200,label:"操作",slots:{default({row:A}){const ae=[{type:"primary",onClick:()=>{h.value={apiId:A.id||"",apiType:A.apiType||"",applicationId:A.applicationId||""},y.value=!0},text:"配置"},{type:"primary",onClick:()=>{t.ids={applicationId:A.applicationId??"",apiType:A.apiType??"",apiId:A.id??""},t.version=A.version,t.appScenarios=A.appScenarios??"",a.value=!0},text:"发布"},{type:"primary",onClick:()=>{ma(ft,{query:{apiId:A.id,releaseId:A==null?void 0:A.releaseId}})},text:"调用日志"},{type:"danger",text:"删除",popconfirmProps:{title:"删除后此插件将不可恢复。确定要删除？",confirm:async()=>{await he.del((A==null?void 0:A.id)||""),p()}}}];return l(yt,{num:3,rowId:A.id||"",list:ae},null)}}}],a=T(!1),o={id:"lowcode_pluginSetting",request:{api:()=>he.listAll({apiStatus:1,applicationId:d})},pagination:{hidePagination:!0},table:{tableCols:i.value?u:[...u,..._]}},p=()=>{var A;(A=e.value)==null||A.refresh()},y=T(!1),h=T({apiId:"",apiType:"",applicationId:""}),R=T(),I=T(!1),B=({id:A,apiType:F,applicationId:H})=>{h.value={apiId:A,applicationId:H,apiType:F},y.value=!0,p()},N=T(!1),E=()=>{ma(dt)},O=T(),L=T(!1),w=T(!1),V=T(!1),C=async()=>{var A,F;try{w.value=!0;const H=(A=e.value)==null?void 0:A.multipleSelection.map(ae=>ae.id);if(H.length>5){X.error("单次最多导出5条插件信息");return}const fe=((F=e.value)==null?void 0:F.multipleSelection.map(ae=>ae.name)).map(ae=>ze("p",{style:{"font-size":"12px","line-height":"1.6",color:"#5C6677"}},ae));Te.confirm(ze("p",null,[ze("span",{style:{color:"#020814","margin-bottom":"8px",display:"flex"}},"您正要导出以下API，这需要一点时间，确定现在导出?"),...fe]),"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{await pt(H.join(",")),X.success("导出成功"),p()})}finally{w.value=!1}},P=()=>{W.value="",b.value="",L.value=!0},b=T(),S=async(A,F)=>{try{V.value=!0,await ct({fileId:F.id,applicationId:d}),b.value="success",X.success("导入成功"),p()}catch(H){b.value=H.msg}finally{V.value=!1}},W=T("");return s({getInfo:r,refreshTable:p}),(A,F)=>{const H=me,xe=nt("az-page"),fe=mt,ae=Le,De=rt("premission");return g(),M(Y,null,[k("div",{class:"layout_box"},[l(ut,{class:"form_enter",ref:"loadingDataRef",load:r},{default:c(()=>{var z,Fe,sa,oa,na,ra,ua,ia;return[k("div",{class:"card-header"},[k("div",{class:"info"},[(z=f.value)!=null&&z.iconUrl?(g(),M("img",{key:0,src:(Fe=f.value)==null?void 0:Fe.iconUrl,alt:"logo"},null,8,["src"])):$("",!0),k("span",null,G((sa=f.value)==null?void 0:sa.name),1)]),i.value?$("",!0):(g(),D(H,{key:0,onClick:E},{default:c(()=>[U("返回")]),_:1}))]),k("div",{class:"card-body"},[k("p",{class:"remake"},G((oa=f.value)==null?void 0:oa.remark),1),k("div",{class:"items"},[k("div",{class:"item"},[k("span",{class:"label"},"服务商："),k("span",{class:"remake"},G(((na=f.value)==null?void 0:na.serviceName)||"-"),1)]),k("div",{class:"item"},[k("span",{class:"label"},"业务类型："),k("span",{class:"remake"},G(((ra=f.value)==null?void 0:ra.pluginTypeName)||"-"),1)])]),k("div",{class:"items"},[k("div",{class:"mr-15 item"},[k("span",{class:"label"},"鉴权认证："),k("span",{class:"remake"},G((ua=f.value)==null?void 0:ua.authMethodName),1)]),(ia=f.value)!=null&&ia.authMethod&&!i.value?(g(),D(H,{key:0,type:"primary",link:"",onClick:F[0]||(F[0]=Il=>I.value=!0)},{default:c(()=>[U(" 配置 ")]),_:1})):$("",!0)])])]}),_:1},512),l(xe,{ref_key:"azPageRef",ref:e,config:o},{operation:c(({multipleSelection:z})=>[i.value?$("",!0):(g(),D(H,{key:0,type:"primary",onClick:F[1]||(F[1]=Fe=>N.value=!0)},{default:c(()=>[U(" 添加API ")]),_:1})),Q((g(),D(H,{type:"warning",class:"azt_warning",onClick:P,loading:V.value},{default:c(()=>[U(" 导入 ")]),_:1},8,["loading"])),[[De,"workbench:plugin:import"]]),Q((g(),D(H,{onClick:C,type:"primary",disabled:z.length==0,loading:w.value},{default:c(()=>[U(" 导出 ")]),_:2},1032,["disabled","loading"])),[[De,"workbench:plugin:export"]])]),_:1},512)]),l(Vl,{"dialog-model":y.value,"onUpdate:dialogModel":F[2]||(F[2]=z=>y.value=z),onRefresh:p,ids:h.value},null,8,["dialog-model","ids"]),l(xt,{data:R.value,visible:I.value,"onUpdate:visible":F[3]||(F[3]=z=>I.value=z),onRefresh:r},null,8,["data","visible"]),l(Pl,{visible:N.value,"onUpdate:visible":F[4]||(F[4]=z=>N.value=z),onConfirm:B},null,8,["visible"]),a.value?(g(),D(Ra,{key:0,onConfirm:p,visible:a.value,"onUpdate:visible":F[5]||(F[5]=z=>a.value=z)},null,8,["visible"])):$("",!0),l(ae,{modelValue:L.value,"onUpdate:modelValue":F[7]||(F[7]=z=>L.value=z),title:"插件导入"},{default:c(()=>[b.value?(g(),M(Y,{key:1},[b.value==="success"?(g(),D(fe,{key:0,icon:"success",title:"导入成功"})):(g(),D(fe,{key:1,icon:"error",title:"导入失败","sub-title":b.value},{extra:c(()=>[l(H,{type:"primary",onClick:P},{default:c(()=>[U("重新导入")]),_:1})]),_:1},8,["sub-title"]))],64)):(g(),M("div",{key:0,style:{"text-align":"center"}},[k("div",{class:"upload_tips"},[k("img",{src:vt,alt:"下载提示"}),k("span",{class:"tips_16"},"上传本地API包，快速生成插件API")]),V.value?$("",!0):(g(),D(Me,{key:0,ref_key:"AzUploadRef",ref:O,limit:1,type:"file",onUploadFinish:S,modelValue:W.value,"onUpdate:modelValue":F[6]||(F[6]=z=>W.value=z),size:1024*10,isShowTip:!1,"show-file-list":!0,accept:["json"]},null,8,["modelValue"])),V.value?(g(),M("span",{key:1},"正在导入，请耐心等待...")):$("",!0)]))]),_:1},8,["modelValue"])],64)}}});const Ol=K(Rl,[["__scopeId","data-v-becc9a40"]]);export{Ol as default};

import{d as C,v as q,r as m,o as k,b as x,w as o,i as l,m as v,B as e,C as B,aN as N,Q as L,ac as F,bm as z,U as A,bn as P,bo as E,c as $,k as h,f as M,F as G,g as S,bp as H,bq as O,t as J,aa as K,q as X,br as Y,_ as Z,bs as ee,as as ae,bi as le,l as U}from"./index-b80d5ef5.js";import{a as Q}from"./LoadingData-195d0581.js";import{e as te,g as W,r as oe,l as se,d as re,a as ne}from"./appManage-8a2e3832.js";import{u as ue}from"./useExtractQuery-f96f705c.js";/* empty css                          */import"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";const pe=C({__name:"EditBackups",props:{modelValue:{type:Boolean},backupsId:{}},emits:["update:modelValue","refresh"],setup(w,{emit:V}){const f=w,g=V,n=q(f,"modelValue",g),d=m(!1),u=m({id:"",fileName:"",charactersDescribe:""}),s=m(),_=async()=>{var r;await((r=s.value)==null?void 0:r.validate());try{d.value=!0,await te(u.value),N.success("编辑成功"),n.value=!1,g("refresh")}finally{d.value=!1}},i=async()=>{u.value=await W(f.backupsId)};return(r,a)=>{const t=L,c=F,b=z,R=Q,I=A,T=P;return k(),x(T,{title:"编辑","append-to-body":"",width:"600px",modelValue:e(n),"onUpdate:modelValue":a[3]||(a[3]=y=>B(n)?n.value=y:null)},{footer:o(()=>[l(I,{onClick:a[2]||(a[2]=y=>n.value=!1)},{default:o(()=>[v("取消")]),_:1}),l(I,{type:"primary",loading:e(d),onClick:_},{default:o(()=>[v(" 确定 ")]),_:1},8,["loading"])]),default:o(()=>[l(R,{load:i},{default:o(()=>[l(b,{model:e(u),"label-width":"120px",ref_key:"backupsFormRef",ref:s},{default:o(()=>[l(c,{label:"备份文件名称",prop:"fileName",rules:[{required:!0,message:"备份文件名称不能为空",trigger:"blur"}]},{default:o(()=>[l(t,{placeholder:"请输入备份文件名称",modelValue:e(u).fileName,"onUpdate:modelValue":a[0]||(a[0]=y=>e(u).fileName=y)},null,8,["modelValue"])]),_:1}),l(c,{label:"说明"},{default:o(()=>[l(t,{placeholder:"请输入说明",modelValue:e(u).charactersDescribe,"onUpdate:modelValue":a[1]||(a[1]=y=>e(u).charactersDescribe=y),type:"textarea",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])}}}),de=C({__name:"Restore",props:{modelValue:{type:Boolean},backupsId:{}},emits:["update:modelValue","refresh"],setup(w,{emit:V}){const f=w,g=V,n=q(f,"modelValue",g),d=async()=>{const a=await W(f.backupsId);s.value.fileId=a.fileId,s.value.fileName=a.fileName,s.value.appId=a.appId},u={appId:"",fileId:"",isBackups:!1,restoreType:E.app,fileName:"",restoreReason:""},s=m({...u}),_=m(),i=$({get(){return s.value.restoreType?s.value.restoreType.split(","):[]},set(a){s.value.restoreType=a==null?void 0:a.join(",")}}),r=async()=>{var a;await((a=_.value)==null?void 0:a.validate()),K.confirm("您正在操作应用还原，确定要还原?","操作确认",{confirmButtonText:"还原",cancelButtonText:"取消",beforeClose:async(t,c,b)=>{if(t==="confirm"){c.confirmButtonLoading=!0;try{await oe(s.value),c.confirmButtonLoading=!1,g("refresh"),N.success("还原成功"),n.value=!1}finally{c.confirmButtonLoading=!1}b()}else b()}})};return(a,t)=>{const c=L,b=F,R=X,I=Y,T=z,y=Q,D=A,j=P;return k(),x(j,{title:"还原","append-to-body":"",width:"600px",modelValue:e(n),"onUpdate:modelValue":t[5]||(t[5]=p=>B(n)?n.value=p:null)},{footer:o(()=>[h("div",{class:"footer_wrapper"},[l(R,{modelValue:e(s).isBackups,"onUpdate:modelValue":t[3]||(t[3]=p=>e(s).isBackups=p)},{default:o(()=>[v("还原前备份当前版本")]),_:1},8,["modelValue"]),h("span",null,[l(D,{onClick:t[4]||(t[4]=p=>n.value=!1)},{default:o(()=>[v("取消")]),_:1}),l(D,{type:"primary",onClick:r},{default:o(()=>[v("还原")]),_:1})])])]),default:o(()=>[l(y,{load:d},{default:o(()=>[l(T,{model:e(s),"label-width":"120px",ref_key:"formRef",ref:_},{default:o(()=>[l(b,{label:"备份文件名称",prop:"fileName",rules:[{required:!0,message:"备份文件名称不能为空",trigger:"blur"}]},{default:o(()=>[l(c,{placeholder:"请输入备份文件名称",disabled:"",modelValue:e(s).fileName,"onUpdate:modelValue":t[0]||(t[0]=p=>e(s).fileName=p)},null,8,["modelValue"])]),_:1}),l(b,{label:"还原项",prop:"restoreType",rules:[{required:!0,message:"还原项不能为空",trigger:"change"}]},{default:o(()=>[l(I,{modelValue:e(i),"onUpdate:modelValue":t[1]||(t[1]=p=>B(i)?i.value=p:null)},{default:o(()=>[(k(!0),M(G,null,S(e(H)(e(O)),p=>(k(),x(R,{key:p.value,label:p.value,disabled:p.value==e(E).data},{default:o(()=>[v(J(p.label),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"还原原因",prop:"restoreReason",rules:[{required:!0,message:"还原原因不能为空",trigger:"blur"}]},{default:o(()=>[l(c,{placeholder:"请输入还原原因",modelValue:e(s).restoreReason,"onUpdate:modelValue":t[2]||(t[2]=p=>e(s).restoreReason=p),type:"textarea",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])}}});const ie=Z(de,[["__scopeId","data-v-e6fdb022"]]),ge=C({__name:"routePage",setup(w){const V=m(),f=m(),g=ue("appId"),n=m(""),d=m(!1),u=m(!1),s=$(()=>({query:{list:[{type:"input",label:"备份文件名称",prop:"fileName"},{type:"timerange",label:"备份时间",prop:["startTime","endTime"]}]},request:{api:se,extraParams:{appId:g.value}},table:{tableCols:[{prop:"fileName",label:"备份文件名称",showOverflowTooltip:!0,minWidth:"200px"},{prop:"backupsType",label:"类型",slots:{default({row:r}){return l("span",null,[ee(r.backupsType,O)])}}},{prop:"charactersDescribe",label:"说明",showOverflowTooltip:!0,minWidth:"200px"},{prop:"createUserName",label:"操作人员"},{prop:"createTime",label:"备份时间"},{fixed:"right",width:200,label:"操作",slots:{default({row:r}){return l(ae,{num:2,list:[{id:"restore",type:"primary",onClick:()=>{n.value=r.id,u.value=!0},text:"还原"},{id:"edit",type:"primary",onClick:()=>{n.value=r.id,d.value=!0},text:"编辑"},{id:"download",type:"primary",onClick:async()=>{await re(r.id),N.success("下载成功")},text:"下载"},{id:"delete",type:"danger",text:"删除",popconfirmProps:{title:"删除后备份文件不可恢复，确定要删除？",confirm:async()=>{await ne(r.id),N.success("删除成功"),_()}}}]},null)}}}]},operation:{fullEl:V}}));function _(){var i;(i=f.value)==null||i.refresh()}return(i,r)=>{const a=le("az-page");return k(),M("div",{class:"layout_box",ref_key:"pendingRef",ref:V},[l(a,{ref_key:"azPageRef",ref:f,config:e(s)},null,8,["config"]),e(d)?(k(),x(pe,{key:0,modelValue:e(d),"onUpdate:modelValue":r[0]||(r[0]=t=>B(d)?d.value=t:null),backupsId:e(n),onRefresh:_},null,8,["modelValue","backupsId"])):U("",!0),e(u)?(k(),x(ie,{key:1,modelValue:e(u),"onUpdate:modelValue":r[1]||(r[1]=t=>B(u)?u.value=t:null),backupsId:e(n),onRefresh:_},null,8,["modelValue","backupsId"])):U("",!0)],512)}}});export{ge as default};

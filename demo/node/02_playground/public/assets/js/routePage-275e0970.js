import{r as n,sX as I,c,bs as N,sY as _,d as w,s_ as D,s$ as A,sZ as L,bp as h,t0 as B,i as r,as as F,bi as E,o as v,f as O,k as x,B as s,C as T,w as P,m as $,b as z,l as S,fx as U,aN as R,U as q,_ as M}from"./index-b80d5ef5.js";import{A as W}from"./AppListTree-72b42f39.js";import{g as j,l as G,e as H}from"./log-64267fd3.js";import{_ as X}from"./DetailDrawer.vue_vue_type_script_setup_true_lang-c85f86c1.js";const Y=()=>{const g=n(!1),t=n(""),u=I(),m=c(()=>u.isPlatformAdmin),d=c(()=>{let a=[{label:"操作人",prop:"createName"},{label:"操作账号",prop:"account"},{label:"所属机构",prop:"orgName"},{label:"手机号码",prop:"phone"},{label:"操作时间",prop:"createTime"},{label:"应用/表单",prop:"appOrForm"},{label:"操作类型",prop:"operationType"},{label:"操作对象",prop:"module"},{label:"服务名称",prop:"serviceName"},{label:"操作详情",prop:"logDetail"},{label:"执行时长",prop:"executeTime"},{label:"IP",prop:"remoteAddr"},{label:"操作结果",prop:"isFail",formatter:p=>N(p.isFail,_)},{label:"失败原因",prop:"failInfo"}];return m.value||(a=a.filter(p=>p.prop!=="orgName")),a});return{detailVisible:g,items:d,logId:t,loadDetails:async()=>await j(t.value)}},Z=Y,J=w({__name:"routePage",setup(g){const t=n(""),u=n(),m=I(),d=c(()=>m.isPlatformAdmin),y=c(()=>{var l;const o={query:{list:[{label:"操作人",prop:"createName",type:"input"},{label:"手机号码",prop:"phone",type:"input"},{label:"表单名称",prop:"entryId",type:"select",options:async()=>(await D(t.value||"0")).map(i=>({label:i.name,value:i.id}))},{label:"操作类型",prop:"operationType",type:"select",options:A},{label:"操作对象",prop:"module",type:"select",options:L},{label:"操作时间",prop:["startTime","endTime"],type:"timerange"},{label:"操作结果",prop:"isFail",type:"select",options:h(_)}]},request:{api:G,extraParams:{logType:B.appOperation,appId:t.value}},table:{tableProps:{height:"100%"},tableCols:[{label:"操作人",prop:"createName"},{label:"操作账号",prop:"account"},{label:"所属机构",prop:"orgName"},{label:"手机号码",prop:"phone"},{label:"操作时间",prop:"createTime",minWidth:"100px"},{label:"应用/表单",prop:"appOrForm"},{label:"操作类型",prop:"operationType"},{label:"操作对象",prop:"module"},{label:"服务名称",prop:"serviceName"},{label:"操作详情",prop:"logDetail",minWidth:"200px",slots:{default({row:e}){return r("div",{innerHTML:e.logDetail},null)}}},{label:"执行时长",prop:"executeTime",slots:{default({row:e}){return r("div",null,[`${e.executeTime}ms`])}}},{label:"IP",prop:"remoteAddr"},{label:"操作结果",prop:"isFail",slots:{default({row:e}){return r("span",null,[N(e.isFail,_)])}}},{label:"失败原因",prop:"failInfo",showOverflowTooltip:!0},{label:"操作",slots:{default({row:e}){return r(F,{list:[{id:"view",type:"primary",text:"查看详情",onClick:()=>{C.value=e.id,a.value=!0}}]},null)}}}]}};return!d.value&&((l=o.table)!=null&&l.tableCols)&&(o.table.tableCols=o.table.tableCols.filter(e=>e.prop!=="orgName")),o}),{detailVisible:a,items:p,logId:C,loadDetails:V}=Z(),b=n(!1),k=async()=>{var o;try{b.value=!0;const l=(o=u.value)==null?void 0:o.handleGetParams();await H(U(l,["limit","current"])),R.success("导出成功")}finally{b.value=!1}};return(o,l)=>{const e=q,i=E("az-page");return v(),O("div",{class:"layout_box"},[x("div",{class:"left_wrapper"},[r(W,{modelValue:s(t),"onUpdate:modelValue":l[0]||(l[0]=f=>T(t)?t.value=f:null),class:"app-tree"},null,8,["modelValue"])]),x("div",{class:"main_wrapper"},[r(i,{ref_key:"azPageRef",ref:u,config:s(y)},{operation:P(()=>[r(e,{type:"warning",onClick:k,loading:s(b)},{default:P(()=>[$(" 导出 ")]),_:1},8,["loading"])]),_:1},8,["config"]),s(a)?(v(),z(X,{key:0,list:s(p),modelValue:s(a),"onUpdate:modelValue":l[1]||(l[1]=f=>T(a)?a.value=f:null),load:s(V)},null,8,["list","modelValue","load"])):S("",!0)])])}}});const le=M(J,[["__scopeId","data-v-c2ee802f"]]);export{le as default};

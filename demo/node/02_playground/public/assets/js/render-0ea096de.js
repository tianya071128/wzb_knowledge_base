import{d8 as W,n as oe,d as ie,hd as Ae,v as ke,c as _,iu as Ne,r as T,y as Z,ka as Ye,V as Ge,a9 as _e,bi as We,o as u,f as S,k as f,p as le,t as A,F as Q,g as H,b as M,w as i,m as ae,i as m,B as k,lE as Ue,l as $,a2 as Je,C as Qe,e as Ke,S as He,P as Xe,aU as Ze,q as et,dC as Oe,dD as $e,Q as ze,ac as Re,_ as qe,I as tt,R as Ie,L as se,a5 as lt,a4 as at,U as Fe,Y as je,a as ot,vY as ut,d2 as nt,d3 as st,bm as rt}from"./index-b80d5ef5.js";async function it(c){const y=await W.value.request.post(`${W.value.SYSTEMURL}/crm/findClientObject`,c);return oe(y)}async function dt(c){const y=await W.value.request.post(`${W.value.SYSTEMURL}/crm/findClientType`,c);return oe(y)}async function ct(c){const y=await W.value.request.post(`${W.value.SYSTEMURL}/crm/findProductService`,c);return oe(y)}async function pt(c){const y=await W.value.request.post(`${W.value.SYSTEMURL}/crm/findProductScheme`,c);return oe(y)}async function vt(c){const y=await W.value.request.post(`${W.value.SYSTEMURL}/crm/findProductEnforce`,c);return oe(y)}function ft(c){return W.value.request.post(`${W.value.SYSTEMURL}/crm/findAllEnforceProduct`,c)}function re(c){return["client_object_name","client_object_tablename","client_object_title","client_type_name","client_type_object","client_type_tablename","client_type_title","product_baojia","product_brief","product_enforce","product_name","product_object","product_scheme","product_tablename","scheme_enforce","scheme_name","scheme_service","scheme_tablename","scheme_title","service_name","service_object","service_tablename","service_title","tilte_danxuan","tilte_name","tilte_parent","tilte_pingji","tilte_required","tilte_tablename"].reduce((l,v)=>{var g,s;return{...l,[v]:(s=(g=c.params)==null?void 0:g.find(w=>w.key===v))==null?void 0:s.value}},{})}function ge(c,y){var l,v;return(v=(l=y.params)==null?void 0:l.find(g=>g.key===c))==null?void 0:v.value}function mt({setId:c,currentIds:y,isRadio:l=!1}){if(l)return[c];{const v=new Set(y);return v.has(c)?v.delete(c):v.add(c),[...v]}}function De(c){var y,l;return!!((y=c.entityDatas)!=null&&y.length)||!!((l=c.productDatas)!=null&&l.length)}const _t=ie({__name:"SelectGroup",props:{quotedData:{},modelValue:{},tableColumns:{},level:{default:1},titleLevel:{default:1},titleWidth:{default:"250px"},isTwo:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(c,{emit:y}){Ae(e=>({"244ae102":e.titleWidth}));const l=c,g=ke(l,"modelValue",y),s=_(()=>l.titleLevel+1),w=_(()=>l.quotedData.required==="1"),b=_(()=>{var e;return((e=l.quotedData)==null?void 0:e.danxuan)==="1"}),r=_(()=>{const e=l.quotedData.children??[];return e.length?Math.min(Math.max(...e.map(t=>Ne(t.name)+(t.required==="1"?10:0))),300):0}),p=T(new Set),q=_(()=>{var e;return l.isTwo&&((e=l.quotedData.subProductsDatas)==null?void 0:e.length)}),n=T(new Set),h=T(new Set),U=T(new Set),j=T(new Set);q.value&&(new Map(g.value.entries()).get(l.quotedData.id)??[]).forEach(t=>{var d;const o=(d=l.quotedData.entityDatas)==null?void 0:d.find(I=>I.id===t);o&&(o.name&&p.value.add(o.name),o.versionsType&&(n.value=new Set([o.versionsType])),o.purchaseMethod&&(h.value=new Set([o.purchaseMethod])),o.isBuymoreApp=="1"&&(U.value=new Set([1])),o.isBuymoreUser=="1"&&(j.value=new Set([1])))});const G=_(()=>{var d;const e=[],t=[l.quotedData];let o;for(;o=t.shift();)De(o)?e.push(...((d=o.entityDatas)==null?void 0:d.map(I=>I.id))??[]):t.push(...o.children??[]);return e}),F=_(()=>[...g.value.values()].flat().filter(t=>G.value.includes(t))),C=T(!0),J=T();Z([p,n,h],()=>{var e;C.value||(e=J.value)==null||e.validate("blur")});const P=_(()=>{const e=[];return q.value&&e.push({trigger:"blur",validator(t,o,d){const I=[];p.value.size&&R.value.length&&!n.value.size&&I.push("产品版本"),(p.value.size||n.value.size)&&E.value.length&&!h.value.size&&I.push("购买方式"),C.value=!I.length,I.length?d(new Error(`请选择${I.join("、")}`)):d()}}),w.value&&e.push({trigger:"change",validator(t,o,d){F.value.length?d():d(new Error("此项为必选项"))}}),e}),V=e=>{const t=new Map(g.value.entries());let o=t.get(l.quotedData.id);o&&(o=mt({setId:e.id,currentIds:o,isRadio:b.value}),t.set(l.quotedData.id,o),g.value=new Map(t.entries()))},D=_(()=>{var e;return((e=l.quotedData.subProductsDatas)==null?void 0:e.filter(t=>t.value))??[]}),x=_(()=>{const e=new Map;for(const t of D.value){const o=Ye(t.showLineNumbers)?Number(t.showLineNumbers):1/0,d=[...e.get(o)??[]];d.push(t),e.set(o,d)}return[...e].sort((t,o)=>t[0]-o[0]).map(t=>t[1])}),O=_(()=>{try{const e=l.quotedData.danxuan==="3"?JSON.parse(l.quotedData.selectedproperty??""):null;if(Ge(e))return e}catch(e){l.quotedData.selectedproperty,console.error(e)}}),z=_(()=>{const e=new Set(D.value.map(t=>t.value??""));return O.value&&Object.entries(O.value).forEach(([t,o])=>{p.value.has(t)&&Array.isArray(o)&&e.forEach(d=>{[...o,t].includes(d)||e.delete(d)})}),D.value.filter(t=>e.has(t.value??""))}),L=e=>{if(z.value.some(t=>t.value===e)){if(b.value)p.value.has(e)?p.value.clear():p.value=new Set([e]);else{const t=new Set(p.value);t.has(e)?t.delete(e):t.add(e),p.value=new Set(t)}p.value.size?(R.value.length===1&&R.value[0].value&&(n.value=new Set([R.value[0].value])),E.value.length===1&&E.value[0].value&&(h.value=new Set([E.value[0].value]))):(n.value.clear(),h.value.clear(),U.value=new Set([0]),j.value=new Set([0]))}};Z(z,(e,t)=>{if(_e(e,t))return;const o=new Set(p.value);o.forEach(d=>{z.value.some(I=>I.value===d)||o.delete(d)}),p.value=o},{immediate:!0});const ee=_(()=>{var t,o;const e=[...p.value][0];return((t=l.quotedData.subProductsDatas)==null?void 0:t.find(d=>d.value===e))??((o=l.quotedData.subProductsDatas)==null?void 0:o[0])}),R=_(()=>{var e;return((e=ee.value)==null?void 0:e.versionsTypeList)??[]}),X=_(()=>D.value.length&&!p.value.size),N=_(()=>!D.value.length),K=_(()=>!!R.value.length&&!(l.quotedData.verbuymethodDis=="1"&&R.value.length===1&&!N.value));Z(R,()=>{const e=new Set(n.value);e.forEach(t=>{R.value.some(o=>o.value===t)||e.delete(t)}),n.value=new Set(e)},{immediate:!0});const ue=e=>{X.value||(N.value&&n.value.has(e)?n.value.clear():n.value=new Set([e]),n.value.size?E.value.length===1&&E.value[0].value&&ne(E.value[0].value):(h.value.clear(),U.value=new Set([0]),j.value=new Set([0])))},E=_(()=>{var e;return((e=ee.value)==null?void 0:e.purchaseMethodList)??[]}),te=_(()=>R.value.length&&!n.value.size||X.value),he=_(()=>!D.value.length&&!R.value.length),ye=_(()=>!!E.value.length&&!(l.quotedData.verbuymethodDis=="1"&&E.value.length===1&&D.value.length));Z(E,()=>{const e=new Set(h.value);e.forEach(t=>{E.value.some(o=>o.value===t)||e.delete(t)}),h.value=new Set(e)},{immediate:!0});const ne=e=>{te.value||(he.value&&h.value.has(e)?h.value.clear():h.value=new Set([e]),h.value.size||(U.value=new Set([0]),j.value=new Set([0])))},de=_(()=>l.quotedData.isBuymoreAppList??[]),we=_(()=>R.value.length&&!n.value.size||E.value.length&&!h.value.size);Z(de,()=>{var t;if(!q.value)return;let e=new Set(U.value);e.forEach(o=>{de.value.some(d=>d.flag==o)||e.delete(o)}),e.size||(e=new Set([((t=de.value.find(o=>o.flag==0))==null?void 0:t.flag)??0])),U.value=new Set(e)},{immediate:!0});const xe=e=>{we.value||(U.value=new Set([e]))},ce=_(()=>l.quotedData.isBuymoreUserList??[]),Se=_(()=>R.value.length&&!n.value.size||E.value.length&&!h.value.size);Z(ce,()=>{var t;let e=new Set(j.value);e.forEach(o=>{ce.value.some(d=>d.flag===o)||e.delete(o)}),e.size||(e=new Set([((t=ce.value.find(o=>o.flag==0))==null?void 0:t.flag)??0])),j.value=new Set(e)},{immediate:!0});const Le=e=>{Se.value||(j.value=new Set([e]))};return Z(()=>[[...p.value],[...h.value],[...n.value],[...j.value],[...U.value]],()=>{var e;if(q.value){const t=(e=l.quotedData.entityDatas)==null?void 0:e.filter(I=>{const be=!I.name||p.value.has(I.name),pe=!I.purchaseMethod||h.value.has(I.purchaseMethod),ve=!I.versionsType||n.value.has(I.versionsType);return!!(be&&pe&&ve||[...j.value].some(fe=>fe==1)&&ve&&pe&&I.isBuymoreUser=="1"||[...U.value].some(fe=>fe==1)&&ve&&pe&&I.isBuymoreApp=="1")}),o=(t==null?void 0:t.map(I=>I.id))??[];l.quotedData;const d=new Map(g.value.entries());if(_e(o,d.get(l.quotedData.id)))return;d.set(l.quotedData.id,o),g.value=new Map(d.entries())}},{immediate:!0}),(e,t)=>{var Te,Ce,Pe,Ee,Me;const o=Xe,d=Ze,I=et,be=Oe,pe=$e,ve=We("SelectGroup",!0),fe=ze,Be=Re;return u(),S("div",{class:le(["select_group",{"select_group-flex":e.quotedData.pingji==="1"&&!q.value,"select_group-root":e.level===1,"select_group-required":w.value,"select_group-dashed":e.isTwo&&e.level===1}])},[q.value?(u(),S("div",{key:0,class:"select_group-two"},[f("div",{class:"two-item two-childProduct",style:Je({marginBottom:D.value.length?void 0:"10px"})},[f("div",{class:le(["group_title",{"is-alignment":!((Te=D.value)!=null&&Te.length)}])},A(e.quotedData.name),3),(Ce=D.value)!=null&&Ce.length?(u(),S("div",{key:0,class:"group_content"},[(u(!0),S(Q,null,H(x.value,(a,Y)=>(u(),S("div",{class:"group_opt",key:Y},[(u(!0),S(Q,null,H(a,B=>(u(),M(d,{key:B.id,effect:"dark",content:B.brief,disabled:!B.brief,placement:"top","show-after":100},{content:i(()=>[f("div",{style:{"max-width":"500px"}},A(B.brief),1)]),default:i(()=>[f("div",{class:le(["group_opt-item az-ellipsis",{active:p.value.has(B.value??""),"is-disable":!z.value.some(Ve=>Ve.value===B.value)}]),title:B.value??void 0,onClick:Ve=>L(B.value??"")},[ae(A(B.value)+" ",1),p.value.has(B.value??"")?(u(),S("label",{key:0,class:"group_opt-active"},[m(o,null,{default:i(()=>[m(k(Ue))]),_:1})])):$("",!0)],10,["title","onClick"])]),_:2},1032,["content","disabled"]))),128))]))),128))])):$("",!0)],4),K.value?(u(),S("div",{key:0,class:"two-item"},[f("div",{class:"group_title"},"产品版本："),f("div",{class:"group_content"},[f("div",{class:"group_opt"},[(u(!0),S(Q,null,H(R.value,a=>(u(),M(d,{key:a.id,effect:"dark",content:a.brief,disabled:!a.brief,placement:"top","show-after":100},{content:i(()=>[f("div",{style:{"max-width":"500px"}},A(a.brief),1)]),default:i(()=>[f("div",{class:le(["group_opt-item az-ellipsis",{active:n.value.has(a.value??"")&&!X.value,"is-disable":X.value}]),title:a.value??void 0,onClick:Y=>ue(a.value??"")},A(a.value),11,["title","onClick"])]),_:2},1032,["content","disabled"]))),128))])])])):$("",!0),ye.value?(u(),S("div",{key:1,class:"two-item"},[f("div",{class:"group_title"},"购买方式："),f("div",{class:"group_content"},[f("div",{class:"group_opt"},[(u(!0),S(Q,null,H(E.value,a=>(u(),M(d,{key:a.id,effect:"dark",content:a.brief,disabled:!a.brief,placement:"top","show-after":100},{content:i(()=>[f("div",{style:{"max-width":"500px"}},A(a.brief),1)]),default:i(()=>[f("div",{class:le(["group_opt-item az-ellipsis",{active:h.value.has(a.value??"")&&!te.value,"is-disable":te.value}]),title:a.value??void 0,onClick:Y=>ne(a.value??"")},A(a.value),11,["title","onClick"])]),_:2},1032,["content","disabled"]))),128))])])])):$("",!0),de.value.length?(u(),S("div",{key:2,class:"two-item"},[f("div",{class:"group_title"},"增购应用接入："),f("div",{class:"group_content"},[f("div",{class:"group_opt"},[(u(!0),S(Q,null,H(de.value,a=>(u(),M(d,{key:a.id,effect:"dark",content:a.brief,disabled:!a.brief,placement:"top","show-after":100},{content:i(()=>[f("div",{style:{"max-width":"500px"}},A(a.brief),1)]),default:i(()=>[f("div",{class:le(["group_opt-item az-ellipsis",{active:U.value.has(a.flag)&&!we.value,"is-disable":we.value}]),title:a.value??void 0,onClick:Y=>xe(a.flag)},A(a.value)+" ",11,["title","onClick"])]),_:2},1032,["content","disabled"]))),128))])])])):$("",!0),ce.value.length?(u(),S("div",{key:3,class:"two-item"},[f("div",{class:"group_title"},"增购用户："),f("div",{class:"group_content"},[f("div",{class:"group_opt"},[(u(!0),S(Q,null,H(ce.value,a=>(u(),M(d,{key:a.id,effect:"dark",content:a.brief,disabled:!a.brief,placement:"top","show-after":100},{content:i(()=>[f("div",{style:{"max-width":"500px"}},A(a.brief),1)]),default:i(()=>[f("div",{class:le(["group_opt-item az-ellipsis",{active:j.value.has(a.flag)&&!Se.value,"is-disable":Se.value}]),title:a.value??void 0,onClick:Y=>Le(a.flag)},A(a.value),11,["title","onClick"])]),_:2},1032,["content","disabled"]))),128))])])])):$("",!0)])):(u(),S(Q,{key:1},[f("div",{class:"group_title"},A(e.quotedData.name),1),f("div",{class:"group_content"},[(Pe=e.quotedData.entityDatas)!=null&&Pe.length?(u(),S("div",{key:0,class:"group_opt"},[(u(!0),S(Q,null,H(e.quotedData.entityDatas,a=>(u(),M(d,{key:a.id,effect:"dark",content:a.brief,disabled:!a.brief,placement:"top","show-after":100},{content:i(()=>[f("div",{style:{"max-width":"500px"}},A(a.brief),1)]),default:i(()=>{var Y,B;return[f("div",{class:le(["group_opt-item az-ellipsis",{active:(Y=k(g).get(e.quotedData.id))==null?void 0:Y.includes(a.id)}]),title:a.name,onClick:Ve=>V(a)},[ae(A(a.name)+" ",1),(B=k(g).get(e.quotedData.id))!=null&&B.includes(a.id)?(u(),S("label",{key:0,class:"group_opt-active"},[m(o,null,{default:i(()=>[m(k(Ue))]),_:1})])):$("",!0)],10,["title","onClick"])]}),_:2},1032,["content","disabled"]))),128))])):(Ee=e.quotedData.productDatas)!=null&&Ee.length?(u(),S("div",{key:1},[m(pe,{border:"",data:e.quotedData.productDatas},{default:i(()=>[m(be,{label:"选择",width:"60",align:"center"},{default:i(({row:a})=>{var Y;return[m(I,{modelValue:(Y=k(g).get(e.quotedData.id))==null?void 0:Y.includes(a.id),"onUpdate:modelValue":B=>V(a)},null,8,["modelValue","onUpdate:modelValue"])]}),_:1}),(u(!0),S(Q,null,H(e.tableColumns,a=>(u(),M(be,{key:a.key,prop:a.key,label:a.label,width:a.width},null,8,["prop","label","width"]))),128))]),_:1},8,["data"])])):(Me=e.quotedData.children)!=null&&Me.length?(u(),S("div",{key:2},[(u(!0),S(Q,null,H(e.quotedData.children,a=>(u(),M(ve,{modelValue:k(g),"onUpdate:modelValue":t[0]||(t[0]=Y=>Qe(g)?g.value=Y:null),isTwo:e.isTwo,quotedData:a,key:a.id,level:e.level+1,titleLevel:s.value,titleWidth:`${r.value}px`},null,8,["modelValue","isTwo","quotedData","level","titleLevel","titleWidth"]))),128))])):$("",!0)])],64)),m(Be,{prop:e.quotedData.id,rules:P.value,ref_key:"elFormItemRef",ref:J,class:"group_validate mt-10"},{default:i(()=>[Ke(m(fe,{modelValue:JSON.stringify(F.value)},null,8,["modelValue"]),[[He,!1]])]),_:1},8,["prop","rules"])],2)}}});const ht=qe(_t,[["__scopeId","data-v-b3399838"]]),me=ie({inheritAttrs:!1,__name:"SelectGroupWrapper",props:{modelValue:{},quotedDatas:{}},emits:["update:modelValue"],setup(c,{emit:y}){const l=c,v=y,g=ke(l,"modelValue",v),s=_(()=>{const b=new Map;return function r(p=[]){var q;for(const n of p)b.set(n.id,n),!De(n)&&((q=n.children)!=null&&q.length)&&r(n.children)}(l.quotedDatas),b}),w=_({get(){const b=new Map;return s.value.forEach((r,p)=>{var q,n;De(r)&&b.set(p,((n=(q=r.entityDatas)!=null&&q.length?r.entityDatas:r.productDatas)==null?void 0:n.map(h=>h.id).filter(h=>g.value.includes(h)))??[])}),b},set(b){const r=[...b.values()].flat();_e(r,g.value)||v("update:modelValue",r)}});return Z(()=>l.quotedDatas,b=>{if(b){const r=[...w.value.values()].flat();_e(r,g.value)||v("update:modelValue",r)}},{immediate:!0}),(b,r)=>(u(!0),S(Q,null,H(b.quotedDatas,p=>(u(),M(ht,tt({modelValue:w.value,"onUpdate:modelValue":r[0]||(r[0]=q=>w.value=q),key:p.id,quotedData:p},b.$attrs),null,16,["modelValue","quotedData"]))),128))}}),yt=ie({__name:"OneStep",props:{modelValue:{},options:{}},emits:["update:modelValue"],setup(c,{expose:y,emit:l}){const v=c,s=Ie(v,"modelValue",l),w=T(new Set),b=T(),r=async()=>{w.value.add(0),b.value=await it({appId:v.options.appId,crmTableInfo:re(v.options)}),w.value.delete(0)};Z(()=>s.value.clientObject,()=>{s.value.clientType=[],s.value.productService=[]});const p=T(),q=T(),n=async()=>{w.value.add(1);const G=await dt({appId:v.options.appId,clientObjectId:s.value.clientObject[0]??"",crmTableInfo:re(v.options)});q.value=G,w.value.delete(1)},h=T(),U=T(),j=async()=>{w.value.add(2),U.value=await ct({appId:v.options.appId,clientObjectId:s.value.clientObject[0]??"",clientTypeId:s.value.clientType[0]??"",crmTableInfo:re(v.options)}),w.value.delete(2)};return y({disabled:_(()=>!!w.value.size)}),(G,F)=>(u(),S("div",null,[m(se,{load:r},{default:i(()=>[m(me,{modelValue:k(s).clientObject,"onUpdate:modelValue":F[0]||(F[0]=C=>k(s).clientObject=C),quotedDatas:b.value},null,8,["modelValue","quotedDatas"])]),_:1}),k(s).clientObject[0]?(u(),M(se,{key:k(s).clientObject[0],load:n,ref_key:"clientTypeloadingDataRef",ref:p},{default:i(()=>[m(me,{quotedDatas:q.value,modelValue:k(s).clientType,"onUpdate:modelValue":F[1]||(F[1]=C=>k(s).clientType=C)},null,8,["quotedDatas","modelValue"])]),_:1})):$("",!0),k(s).clientType[0]?(u(),M(se,{key:k(s).clientType[0],load:j,ref_key:"productServiceRef",ref:h},{default:i(()=>[m(me,{quotedDatas:U.value,modelValue:k(s).productService,"onUpdate:modelValue":F[2]||(F[2]=C=>k(s).productService=C)},null,8,["quotedDatas","modelValue"])]),_:1})):$("",!0)]))}}),bt=ie({__name:"TwoStep",props:{modelValue:{},options:{}},emits:["update:modelValue"],setup(c,{expose:y,emit:l}){const v=c,s=Ie(v,"modelValue",l),w=T(new Set),b=T(),r=async()=>{w.value.add(0),b.value=await pt({appId:v.options.appId,crmTableInfo:re(v.options),serviceIds:s.value.productService,clientObjectId:s.value.clientObject[0],clientTypeId:s.value.clientType[0]}),w.value.delete(0)};return y({disabled:_(()=>!!w.value.size)}),(p,q)=>(u(),M(se,{load:r},{default:i(()=>[b.value?(u(),M(me,{key:0,isTwo:"",quotedDatas:b.value,modelValue:k(s).products,"onUpdate:modelValue":q[0]||(q[0]=n=>k(s).products=n)},null,8,["quotedDatas","modelValue"])):$("",!0)]),_:1}))}}),gt=ie({__name:"ThreeStep",props:{modelValue:{},options:{}},emits:["update:modelValue"],setup(c,{expose:y,emit:l}){const v=c,s=Ie(v,"modelValue",l),w=T(new Set),b=T(),r=async()=>{w.value.add(0),b.value=await vt({appId:v.options.appId,crmTableInfo:re(v.options),serviceIds:s.value.productService,clientObjectId:s.value.clientObject[0],clientTypeId:s.value.clientType[0]}),w.value.delete(0)};r();const p=()=>{s.value.customProducts.push({name:"",presentation:"",unit:""})};return y({disabled:_(()=>!!w.value.size)}),(q,n)=>{const h=Fe,U=ze,j=Re,G=Oe,F=$e;return u(),S("div",null,[m(se,{load:r},{default:i(()=>[b.value?(u(),M(me,{key:0,modelValue:k(s).productEnforces,"onUpdate:modelValue":n[0]||(n[0]=C=>k(s).productEnforces=C),quotedDatas:b.value,tableColumns:[{key:"name",label:"实施服务项",width:"200"},{key:"brief",label:"介绍"}]},null,8,["modelValue","quotedDatas"])):$("",!0)]),_:1}),f("div",{class:"custom_produce"},[f("div",{class:"custom_produce-title"},"其他产品与服务"),f("div",{class:"mb-10"},[m(h,{type:"primary",icon:k(lt),onClick:p},{default:i(()=>[ae(" 添加 ")]),_:1},8,["icon"])]),m(F,{border:"",data:k(s).customProducts},{default:i(()=>[m(G,{label:"名称",width:"200"},{default:i(({row:C,$index:J})=>[m(j,{class:"custom_produce-item",prop:`customProducts.${J}.name`,rules:[{required:!0,message:"此项为必填项",trigger:"change"}]},{default:i(()=>[m(U,{modelValue:C.name,"onUpdate:modelValue":P=>C.name=P,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),m(G,{label:"介绍",width:"200"},{default:i(({row:C,$index:J})=>[m(j,{class:"custom_produce-item",prop:`customProducts.${J}.presentation`,rules:[{required:!0,message:"此项为必填项",trigger:"change"}]},{default:i(()=>[m(U,{modelValue:C.presentation,"onUpdate:modelValue":P=>C.presentation=P,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),m(G,{label:"单位"},{default:i(({row:C,$index:J})=>[m(j,{class:"custom_produce-item",prop:`customProducts.${J}.unit`,rules:[{required:!0,message:"此项为必填项",trigger:"change"}]},{default:i(()=>[m(U,{modelValue:C.unit,"onUpdate:modelValue":P=>C.unit=P,placeholder:"请输入"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),m(G,{fixed:"right",label:"操作",width:"80"},{default:i(({$index:C})=>[m(h,{link:"",type:"danger",icon:k(at),onClick:J=>k(s).customProducts.splice(C,1)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])])}}});const wt=qe(gt,[["__scopeId","data-v-0069bdbe"]]),St=ie({__name:"render",props:{modelValue:{type:Boolean},options:{},footerTeleport:{}},emits:["update:modelValue"],setup(c,{emit:y}){const l=c,g=ke(l,"modelValue",y),s=T(),w=new Map([["clientObject","objectFieldId"],["clientType","typeFieldId"],["productService","servicesFieldId"],["products","productFieldId"],["customProducts","otherProductFieldId"]]),b=new Map([["name","otherNameFieldId"],["presentation","otherPresentFieldId"],["unit","otherUnitFieldId"]]),r=T(0),p=async(P=!0)=>{var V;P?(await((V=s.value)==null?void 0:V.validate()),r.value++):r.value--},q={clientObject:[],clientType:[],productService:[],products:[],productEnforces:[],customProducts:[]},n=T(je(q)),h=T(),U=T(),j=T(),G=_(()=>r.value===0?!h.value||!!h.value.disabled:r.value===1?!U.value||!!U.value.disabled:r.value===2?!j.value||!!j.value.disabled:!1),F=T(!1),C=async()=>{var P;F.value=!0;try{await((P=s.value)==null?void 0:P.validate())}catch{F.value=!1;return}setTimeout(()=>{g.value=!1,F.value=!1},500),setTimeout(()=>{w.forEach((V,D)=>{var z,L,ee,R,X;let x=[...n.value[D]];D==="products"&&x.push(...n.value.productEnforces),D==="customProducts"&&(x=x.map(N=>{const K={};return b.forEach((ue,E)=>{const te=ge(ue,l.options);te&&(K[te]=N[E])}),K}));const O=ge(V,l.options);if(O)if(D==="products"){const N=(L=(z=l.options.render)==null?void 0:z.matchField(O))==null?void 0:L.parentField;if((N==null?void 0:N.type)!==ot.subform){console.warn("参数异常, 请检查!");return}const K=(ee=l.options.render)==null?void 0:ee.getFieldVal(N.fieldId,void 0,{isFormat:!0}),ue=new Set;(R=l.options.render)==null||R.setFieldVal(N.fieldId,oe(x).map((E,te)=>{var ye;const he=(ye=K==null?void 0:K.find)==null?void 0:ye.call(K,ne=>_e(ne==null?void 0:ne[O],[E]));return he||ue.add(te),he??{[O]:E}})),setTimeout(()=>{var E;(E=l.options.render)==null||E.$bus.emit(ut,{fieldId:O,index:[...ue]})},400)}else(X=l.options.render)==null||X.setFieldVal(O,x,void 0,{isSonReset:!0,sonUseDefault:!0})})},40)},J=async()=>{r.value=0;const P=je(q);if(w.forEach((V,D)=>{var O;const x=ge(V,l.options);if(x){let z=(O=l.options.render)==null?void 0:O.getFieldVal(x,void 0,{isFormat:!0});z&&(z=oe(z).flat(),D==="customProducts"&&(z=z.map(L=>{const ee={};return b.forEach((R,X)=>{const N=ge(R,l.options);N&&(ee[X]=L[N]??"")}),ee})),P[D]=z)}}),P.products.length){const V=await ft({appId:l.options.appId,crmTableInfo:re(l.options)}),D=new Set(V.map(O=>O.id)),x=P.products;P.products=x.filter(O=>!D.has(O)),P.productEnforces=x.filter(O=>D.has(O))}n.value=P};return(P,V)=>{const D=nt,x=st,O=rt,z=Fe;return k(g)?(u(),M(se,{key:0,class:"quoted_price",load:J},{default:i(()=>[m(x,{class:"",active:r.value,"align-center":""},{default:i(()=>[m(D,{title:"选择客户对象"}),m(D,{title:"选择产品及服务"}),m(D,{title:"选择项目实施服务"})]),_:1},8,["active"]),m(O,{class:"quoted_content",ref_key:"ruleFormRef",ref:s,model:n.value,"scroll-to-error":"","scroll-into-view-options":{behavior:"smooth",block:"center"}},{default:i(()=>[r.value===0?(u(),M(yt,{key:0,modelValue:n.value,"onUpdate:modelValue":V[0]||(V[0]=L=>n.value=L),options:P.options,ref_key:"oneStepRef",ref:h},null,8,["modelValue","options"])):$("",!0),r.value===1?(u(),M(bt,{key:1,modelValue:n.value,"onUpdate:modelValue":V[1]||(V[1]=L=>n.value=L),options:P.options,ref_key:"twoStepRef",ref:U},null,8,["modelValue","options"])):$("",!0),r.value===2?(u(),M(wt,{key:2,modelValue:n.value,"onUpdate:modelValue":V[2]||(V[2]=L=>n.value=L),ref_key:"threeStepRef",ref:j,options:P.options},null,8,["modelValue","options"])):$("",!0)]),_:1},8,["model"]),f("div",{class:"quoted_btns"},[r.value===0?(u(),M(z,{key:0,onClick:V[3]||(V[3]=L=>g.value=!1)},{default:i(()=>[ae("取消")]),_:1})):$("",!0),r.value!==0?(u(),M(z,{key:1,type:"primary",onClick:V[4]||(V[4]=L=>p(!1))},{default:i(()=>[ae(" 上一步 ")]),_:1})):$("",!0),r.value!==2?(u(),M(z,{key:2,type:"primary",onClick:V[5]||(V[5]=L=>p(!0)),disabled:G.value},{default:i(()=>[ae(" 下一步 ")]),_:1},8,["disabled"])):$("",!0),r.value===2?(u(),M(z,{key:3,type:"primary",onClick:C,disabled:G.value,loading:F.value},{default:i(()=>[ae(" 确定 ")]),_:1},8,["disabled","loading"])):$("",!0)])]),_:1})):$("",!0)}}});const Dt=qe(St,[["__scopeId","data-v-e30c91f1"]]);export{Dt as default};

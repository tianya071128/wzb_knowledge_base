import{d as P,to as D,r as s,bi as E,iC as B,o as x,f as J,k as p,e as O,b as M,w,i as o,B as U,ae as R,m as T,tu as S,rT as L,cc as V,sk as $,rW as q,bh as F,as as H,uw as W,ux as G,uy as K,aN as j,P as Q,U as X,uz as Y,uA as Z,_ as ee}from"./index-b80d5ef5.js";import{O as ae}from"./OrgAddOrModifyForms-8e852a85.js";import"./SelectOrg.vue_vue_type_script_setup_true_lang-3e503345.js";const te={name:"OrgJob"},se=P({...te,setup(oe){const{menuId:A}=D(),i=s(!1),u=s(!1),g=s(),b=s(),c=s("add"),l=s({}),n=s([]),r=s({orgId:"",orgName:"",menuId:A.value}),C={query:{list:[{type:"input",label:"岗位名称",prop:"jobName"},{type:"select",label:"状态",prop:"status",options:"status",isAll:!0,initValue:V}]},request:{api:$,extraParams:r},operation:{fullEl:g},table:{tableCols:[{type:"index",width:55,label:"序号"},{prop:"jobName",label:"岗位名称"},{prop:"orgName",label:"所属部门"},{prop:"status",label:"状态",slots:{default({row:e}){return o(F,{disabled:!q("system:orgjob:enable"),modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,updateFetch:()=>k(e.id,e.status)},null)}}},{fixed:"right",width:200,label:"操作",slots:{default({row:e}){return o(H,{num:3,list:[{id:"system:orgjob:edit",type:"primary",premission:"system:orgjob:edit",onClick:()=>{v("edit",e)},text:"编辑"},{id:"system:orgjob:user",type:"primary",premission:"system:orgjob:user",onClick:async()=>{await I(e)},text:"岗位成员"},{id:"system:orgjob:detail",type:"primary",premission:"system:orgjob:detail",onClick:()=>{l.value={...e},c.value="view",i.value=!0},text:"查看"},{id:"system:orgjob:delete",type:"danger",text:"删除",premission:"system:orgjob:delete",popconfirmProps:{title:"您确定要删除该岗位吗?",confirm:async()=>{await Y(e.id),j.success("删除成功"),await m()}}}]},null)}}}]}},m=async()=>{var e;await((e=b.value)==null?void 0:e.refresh())},k=async(e,a)=>{a==V?await W(e):await G(e),m()},v=(e,a)=>{e==="add"?l.value={}:l.value={...a},c.value=e,i.value=!0},z=e=>{const a=e;r.value.orgName=a.name},I=async e=>{const a=e.id;l.value=e;const d=await Z(a);n.value=d,u.value=!0},N=async e=>{const a={userList:n.value,id:l.value.id};await K(a),j.success("保存成功")};return(e,a)=>{var h;const d=Q,_=X,y=E("az-page"),f=B("premission");return x(),J("div",{ref_key:"orgRef",ref:g,class:"layout_box az_layout_tree az_orgjob"},[p("div",{class:"az_page_tree"},[p("span",null,[O((x(),M(_,{type:"primary",onClick:a[0]||(a[0]=t=>v("add")),style:{"margin-bottom":"10px"}},{default:w(()=>[o(d,{size:16,style:{"margin-right":"8px"}},{default:w(()=>[o(U(R))]),_:1}),T(" 新增岗位 ")]),_:1})),[[f,"system:orgjob:add"]])]),o(S,{class:"org-tree",onOrgChange:z,modelValue:r.value.orgId,"onUpdate:modelValue":a[1]||(a[1]=t=>r.value.orgId=t),topTree:{id:"",name:"全部机构"}},null,8,["modelValue"])]),p("div",{class:"az_page_table"},[o(y,{ref_key:"azPageRef",ref:b,config:C,maxHeight:"var(--az-layout-main-height) - 40px"},null,512)]),o(ae,{onRefresh:m,"row-data":l.value,"com-state":c.value,"selected-org":r.value,"drawer-model":i.value,"onUpdate:drawerModel":a[2]||(a[2]=t=>i.value=t)},null,8,["row-data","com-state","selected-org","drawer-model"]),o(L,{modelValue:n.value,"onUpdate:modelValue":a[3]||(a[3]=t=>n.value=t),visible:u.value,"onUpdate:visible":a[4]||(a[4]=t=>u.value=t),label:"岗位成员","mini-title":(h=l.value)==null?void 0:h.jobName,multiple:!0,onChange:N,type:"member"},null,8,["modelValue","visible","mini-title"])],512)}}});const ne=ee(se,[["__scopeId","data-v-03cedd0b"]]);export{ne as default};

import{d as W,v as ie,aV as X,aW as A,ci as le,c as q,r as v,e as K,o,f as t,F as f,k as e,t as r,m as n,i as s,w as a,b as N,B as c,vS as V,fo as T,g as Q,C as re,l as D,vB as ce,U as Y,cr as Z,br as ee,bC as pe,ca as oe,q as te,_ as ae,l0 as ue,bx as j,y as de,cC as ve,vw as G,a2 as me,aN as J,b4 as ge,kX as ye,vT as be,vU as _e,vV as fe}from"./index-b80d5ef5.js";/* empty css                          */import{_ as H}from"./AutoJump.vue_vue_type_script_setup_true_lang-a3aa2601.js";import{S as ke}from"./SecondaryPage-60f4f4b3.js";import{r as he,t as Ce,v as Le,w as Ie}from"./cooperation-dbdc5052.js";import{_ as we}from"./CodeLogin.vue_vue_type_script_setup_true_lang-1be0bdce.js";import"./MobileFormItem.vue_vue_type_script_setup_true_lang-b23f5d06.js";const ne=""+new URL("../png/empty-ent-01bd8d92.png",import.meta.url).href,O=""+new URL("../png/cooperation-success-5dd68b88.png",import.meta.url).href,Ne=""+new URL("../png/cooperation-register-bb1b4027.png",import.meta.url).href,ze=W({__name:"MobileCooperation",props:{entName:{},type:{},loading:{type:Boolean},loginFlag:{type:Boolean},status:{type:Boolean},errorMessage:{},entList:{},beInvitedIds:{},connectLoading:{type:Boolean},connectSuccess:{type:Boolean}},emits:["update:beInvitedIds","handleConnect"],setup(F,{expose:M,emit:S}){const x=F,C=S,u=ie(x,"beInvitedIds",C),b=X(),E=A(),k=le(),L=q(()=>!!b.query.register),z=q(()=>!!b.query.login),I=()=>{E.push({path:b.path,query:{register:"true",...b.query}})},m=()=>{E.push({path:b.path,query:{login:"true",...b.query}})},p=v(!1),_=v("登录"),B=v(),U=async()=>{var i;try{p.value=!0,_.value="登 录 中...";const l=await((i=B.value)==null?void 0:i.submit());if(!l)return;_.value="登录成功，跳转中...",ce(l),await E.go(-1)}finally{_.value="登录",p.value=!1}};return M({goLogin:m}),(i,l)=>{const y=Y,d=Z,R=te,$=ee,h=pe,P=oe;return K((o(),t("div",{class:"mobile-cooperation"},[p.value?D("",!0):(o(),t(f,{key:0},[e("div",{class:"mobile-cooperation-header"},[e("div",{class:"header-h1"},r(i.entName),1),e("div",{class:"az-tip"},"邀请您建立协作协作关系，开展业务协作")]),!L.value&&!z.value?(o(),t("div",{key:0,class:"mobile-cooperation-content"},[i.loginFlag?i.status?i.connectSuccess?(o(),t(f,{key:2},[e("img",{class:"mobile-cooperation-img",src:O,alt:""}),e("div",{class:"mobile-cooperation-success-tip"},"协作关系建立成功"),e("div",{class:"mobile-cooperation-tip mb-15"}," 访问以下平台可一起开展业务协作。 "),e("div",{class:"mobile-cooperation-url"},r(c(k).pageName)+"："+r(c(V)()),1),s(y,{class:"mobile-cooperation-btn",type:"primary",round:"",size:"large",onClick:l[0]||(l[0]=g=>c(T)(c(V)()))},{default:a(()=>[n(" 复制地址，开始协作 ")]),_:1})],64)):(o(),t(f,{key:3},[!i.entList.length&&i.type==="enterprise"?(o(),t(f,{key:0},[e("img",{class:"mobile-cooperation-img",src:ne,alt:""}),e("div",{class:"mobile-cooperation-tip"},"您尚未加入任何企业/单位"),e("div",{class:"mobile-cooperation-tip"}," 请登录电脑端，使用浏览器打开以下地址，创建企业/单位 "),e("div",{class:"mobile-cooperation-url"},r(c(k).pageName)+"："+r(c(V)()),1),s(y,{class:"mobile-cooperation-btn",type:"primary",round:"",size:"large",onClick:l[1]||(l[1]=g=>c(T)(c(V)()))},{default:a(()=>[n(" 复制地址 ")]),_:1})],64)):(o(),t(f,{key:1},[e("div",{style:{color:"var(--el-color-primary)"}},[n(" 建立协作关系后，您可使用对方创建的应用和流程等内容，实现 "),e("span",{style:{"font-weight":"bold"}}," 企业与"+r(i.type==="enterprise"?"企业":"个人"),1),n(" 间的数据填报、流程审批等 ")]),i.entList.length>1?(o(),N(h,{key:0,class:"mobile-cooperation-card"},{header:a(()=>[e("div",{class:"card-header"}," 您有多个企业/单位，请选择需要建立协作关系的企业 ")]),default:a(()=>[s($,{modelValue:c(u),"onUpdate:modelValue":l[2]||(l[2]=g=>re(u)?u.value=g:null)},{default:a(()=>[(o(!0),t(f,null,Q(i.entList,g=>(o(),N(R,{label:g.id,key:g.id},{default:a(()=>[n(r(g.corpName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):(o(),t("img",{key:1,class:"mobile-cooperation-img",src:O,alt:""})),e("div",{class:"color1 mt-20 tc"}," 连接成功，您将成为与对方进行业务协作的对接人。 "),s(y,{class:"mobile-cooperation-btn mt-40",type:"primary",round:"",onClick:l[3]||(l[3]=g=>C("handleConnect")),loading:i.connectLoading,size:"large"},{default:a(()=>[n(" 建立协作关系 ")]),_:1},8,["loading"])],64))],64)):(o(),N(d,{key:1,icon:"error",title:"协作关系建立失败","sub-title":i.errorMessage},{extra:a(()=>[s(H,{round:"",size:"large"})]),_:1},8,["sub-title"])):(o(),t(f,{key:0},[e("div",{style:{color:"var(--el-color-primary)"}},[n(" 建立协作关系后，您可使用对方创建的应用和流程等内容，实现 "),e("span",{style:{"font-weight":"bold"}}," 企业与"+r(i.type==="enterprise"?"企业":"个人"),1),n(" 间的数据填报、流程审批等。 ")]),e("div",{class:"mobile-cooperation-alert"}," 1. 如果您已有账号，请直接登录进行连接；没有账号，请先注册。 "),e("div",{class:"mobile-cooperation-alert"}," 2. "+r(i.type==="enterprise"?"如果您只是以个人身份进行协作，请访问邀请个人协作的链接地址。":"如果您只是以企业身份进行协作，请访问邀请企业协作的链接地址。"),1),s(y,{class:"mobile-cooperation-btn",type:"primary",round:"",size:"large",onClick:m,style:{"margin-top":"40px"}},{default:a(()=>[n(" 已有账号，直接登录 ")]),_:1}),s(y,{class:"mobile-cooperation-btn",type:"primary",round:"",plain:"",size:"large",onClick:I},{default:a(()=>[n(" 注册新账号 ")]),_:1})],64))])):L.value?(o(),t("div",{key:1,class:"mt-40"},[e("img",{class:"mobile-cooperation-img",src:Ne,alt:""}),e("div",{class:"mobile-cooperation-tip mb-15 mt-15"}," 请登录电脑端，使用浏览器打开以下地址，注册新账号 "),e("div",{class:"mobile-cooperation-url"},r(c(k).pageName)+"："+r(c(V)("/register")),1),s(y,{class:"mobile-cooperation-btn",type:"primary",round:"",size:"large",onClick:l[4]||(l[4]=g=>c(T)(c(V)()))},{default:a(()=>[n(" 复制地址 ")]),_:1})])):z.value?(o(),t("div",{key:2,class:"mt-40"},[s(we,{ref_key:"codeLoginRef",ref:B,onSubmit:U},null,512),s(y,{class:"mobile-cooperation-btn mt-40",type:"primary",round:"",size:"large",onClick:U,loading:p.value},{default:a(()=>[n(r(_.value),1)]),_:1},8,["loading"])])):D("",!0)],64))])),[[P,p.value]])}}});const Be=ae(ze,[["__scopeId","data-v-ea49e754"]]),Re=W({__name:"cooperation",props:{type:{}},setup(F){const M=F,S=X(),x=A(),C=q(()=>!!ue()),u=q(()=>S.query.invitation_code),b=()=>{x.push({name:"Login",query:{invitation_redirect:S.fullPath}})},E=()=>{x.push({name:"Register",query:{invitation_redirect:S.fullPath}})},k=v(!0),L=v("");u.value||(k.value=!1,L.value="缺少参数, 请检查链接是否正确!"),j(async()=>{if(!u.value)return;await he(u.value)!=="true"&&(k.value=!1,L.value="链接已过期")});const z=v("");j(async()=>{u.value&&(z.value=await Ce(u.value)??"")});const I=v(!1),m=v([]);de(C,async()=>{C.value&&u.value&&M.type==="enterprise"&&(I.value=!0,m.value=await Ie(),m.value.length===1&&(p.value=[m.value[0].id]),I.value=!1)},{immediate:!0});const p=v([]),_=v(!1),B=v(!1),U=async()=>{if(!p.value.length&&M.type==="enterprise")return J.error("请选择需要建立协作关系的企业");_.value=!0;try{const d=M.type==="enterprise"?{beInvitedIds:p.value,corpCooperationInviteId:u.value??""}:{corpCooperationInviteId:u.value??""};await Le(d),B.value=!0,J.success("建立协作成功")}finally{_.value=!1}},i=()=>{ge(be)},l=()=>{x.replace(ye)},y=v();return _e(()=>{var d;G?(d=y.value)==null||d.goLogin():b()}),ve(()=>{fe()}),(d,R)=>{const $=Z,h=Y,P=te,g=ee,se=oe;return c(G)?(o(),N(Be,{key:1,beInvitedIds:p.value,"onUpdate:beInvitedIds":R[1]||(R[1]=w=>p.value=w),ref_key:"mobileCooperationRef",ref:y,onHandleConnect:U,entName:z.value,type:d.type,loading:I.value,loginFlag:C.value,status:k.value,errorMessage:L.value,entList:m.value,connectLoading:_.value,connectSuccess:B.value},null,8,["beInvitedIds","entName","type","loading","loginFlag","status","errorMessage","entList","connectLoading","connectSuccess"])):(o(),N(ke,{key:0,backLogin:!1},{headerTitle:a(()=>[e("div",{class:"cooperation-title"},[e("div",{class:"cooperation-title-h1"},r(z.value),1),e("div",{class:"cooperation-title-h2"},"邀请您建立协作关系，开展业务协作"),e("div",{class:"cooperation-title-h3"},[n(" 建立协作关系后，您可使用对方创建的应用和流程等内容，实现 "),e("span",{style:{"font-weight":"bold",color:"#fff"}}," 企业与"+r(d.type==="enterprise"?"企业":"个人"),1),n(" 间的数据填报、流程审批等 ")])])]),default:a(()=>[K((o(),t("div",{class:"cooperation layout_box"},[I.value?D("",!0):(o(),t("div",{key:0,class:"cooperation-wrapper"},[k.value?C.value?(o(),t("div",{key:2},[!m.value.length&&d.type==="enterprise"?(o(),t("div",{key:0,class:"cooperation-noent"},[e("img",{src:ne,alt:""}),e("div",{class:"cooperation-secondary-tip"}," 您尚未加入任何企业/单位，是否去创建企业/单位？ "),s(h,{type:"primary",onClick:i,size:"large"},{default:a(()=>[n(" 去创建企业/单位 ")]),_:1}),s(h,{text:"",type:"primary",onClick:l},{default:a(()=>[n("暂不创建")]),_:1})])):(o(),t("div",{key:1},[m.value.length>1?(o(),t("div",{key:0,class:"cooperation-manyent"},[e("div",{class:"cooperation-main-tip"}," 您有多个企业/单位，请选择需要建立协作关系的企业： "),s(g,{modelValue:p.value,"onUpdate:modelValue":R[0]||(R[0]=w=>p.value=w)},{default:a(()=>[(o(!0),t(f,null,Q(m.value,w=>(o(),N(P,{label:w.id,key:w.id},{default:a(()=>[n(r(w.corpName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):(o(),t("div",{key:1,class:"cooperation-oneent"},[e("img",{src:O,alt:""})])),e("div",{class:"cooperation-secondary-tip",style:me({marginBottom:m.value.length>1?"10px":"50px"})}," 连接成功，您将成为与对方进行业务协作的对接人。 ",4),B.value?(o(),N(H,{key:3,size:"large",style:{width:"250px"}})):(o(),t(f,{key:2},[s(h,{type:"primary",onClick:U,loading:_.value,style:{width:"250px"},size:"large"},{default:a(()=>[n(" 建立协作关系 ")]),_:1},8,["loading"]),s(h,{text:"",type:"primary",onClick:l},{default:a(()=>[n(" 暂不建立 ")]),_:1})],64))]))])):(o(),t("div",{key:1,class:"cooperation-nologin"},[e("div",{class:"cooperation-secondary-tip",style:{"margin-bottom":"10px"}}," 如果您已有账号，请直接登录进行连接；没有账号，请先注册。 "),e("div",{class:"cooperation-secondary-tip"},r(d.type==="enterprise"?"如果您只是以个人身份进行协作，请访问邀请个人协作的链接地址。":"如果您只是以企业身份进行协作，请访问邀请企业协作的链接地址。"),1),e("div",{class:"cooperation-btns"},[s(h,{type:"primary",onClick:b,size:"large"},{default:a(()=>[n(" 已有账号，直接登录 ")]),_:1}),s(h,{type:"primary",onClick:E,size:"large"},{default:a(()=>[n(" 注册新账号 ")]),_:1})])])):(o(),t("div",{key:0},[s($,{icon:"error",title:"协作关系建立失败","sub-title":L.value},{extra:a(()=>[s(H)]),_:1},8,["sub-title"])]))]))])),[[se,I.value]])]),_:1}))}}});const Fe=ae(Re,[["__scopeId","data-v-78091bcc"]]);export{Fe as default};
